!function (e) {
    function t(e) {
        Object.defineProperty(this, e, {
            enumerable: !0, get: function () {
                return this[u][e]
            }
        })
    }

    function n(e) {
        if ("undefined" != typeof System && System.isModule ? System.isModule(e) : "[object Module]" === Object.prototype.toString.call(e)) return e;
        var t = {default: e, __useDefault: e};
        if (e && e.__esModule) for (var n in e) Object.hasOwnProperty.call(e, n) && (t[n] = e[n]);
        return new i(t)
    }

    function i(e) {
        Object.defineProperty(this, u, {value: e}), Object.keys(e).forEach(t, this)
    }

    function r(e) {
        return "@node/" === e.substr(0, 6) ? c(e, n(h(e.substr(6)))) : d[e]
    }

    function o(t) {
        var n = r(t);
        if (!n) throw new Error('Module "' + t + '" expected, but not contained in build.');
        if (n.module) return n.module;
        var i = n.linkRecord;
        return function t(n, i) {
            if (!i.depLoads) {
                i.declare && function (t, n) {
                    var i = n.moduleObj, r = t.importerSetters, o = !1, a = n.declare.call(e, function (e, t) {
                        if (!o) {
                            if ("object" == typeof e) for (var n in e) "__useDefault" !== n && (i[n] = e[n]); else i[e] = t;
                            o = !0;
                            for (var a = 0; a < r.length; a++) r[a](i);
                            return o = !1, t
                        }
                    }, {id: t.key});
                    "function" != typeof a ? (n.setters = a.setters, n.execute = a.execute) : (n.setters = [], n.execute = a)
                }(n, i), i.depLoads = [];
                for (var o = 0; o < i.deps.length; o++) {
                    var a = r(i.deps[o]);
                    i.depLoads.push(a), a.linkRecord && t(a, a.linkRecord);
                    var s = i.setters && i.setters[o];
                    s && (s(a.module || a.linkRecord.moduleObj), a.importerSetters.push(s))
                }
                return n
            }
        }(n, i), l(n, i, []), n.module
    }

    function a(e, t, n) {
        return d[e] = {
            key: e,
            module: void 0,
            importerSetters: [],
            linkRecord: {deps: t, depLoads: void 0, declare: n, setters: void 0, execute: void 0, moduleObj: {}}
        }
    }

    function s(e, t, n, i) {
        var r = {};
        return d[e] = {
            key: e,
            module: void 0,
            importerSetters: [],
            linkRecord: {
                deps: t,
                depLoads: void 0,
                declare: void 0,
                execute: i,
                executingRequire: n,
                moduleObj: {default: r, __useDefault: r},
                setters: void 0
            }
        }
    }

    function l(t, n, r) {
        if (r.push(t), t.module) return t.module;
        if (n.setters) {
            for (var o = 0; o < n.deps.length; o++) {
                var a = n.depLoads[o], s = a.linkRecord;
                s && -1 === r.indexOf(a) && l(a, s, s.setters ? r : [])
            }
            n.execute.call(f)
        } else {
            var c = {id: t.key}, d = n.moduleObj;
            Object.defineProperty(c, "exports", {
                configurable: !0, set: function (e) {
                    d.default = d.__useDefault = e
                }, get: function () {
                    return d.__useDefault
                }
            });
            var u = (g = n.deps, v = n.depLoads, y = r, function (e) {
                for (var t = 0; t < g.length; t++) if (g[t] === e) {
                    var n, i = v[t], r = i.linkRecord;
                    return "__useDefault" in (n = r ? -1 === y.indexOf(i) ? l(i, r, y) : r.moduleObj : i.module) ? n.__useDefault : n
                }
            });
            if (!n.executingRequire) for (o = 0; o < n.deps.length; o++) u(n.deps[o]);
            var h = n.execute.call(e, u, d.__useDefault, c);
            void 0 !== h ? d.default = d.__useDefault = h : c.exports !== d.__useDefault && (d.default = d.__useDefault = c.exports);
            var p = d.__useDefault;
            if (p && p.__esModule) for (var m in p) Object.hasOwnProperty.call(p, m) && (d[m] = p[m])
        }
        var g, v, y;
        c = t.module = new i(n.moduleObj);
        if (!n.setters) for (o = 0; o < t.importerSetters.length; o++) t.importerSetters[o](c);
        return c
    }

    function c(e, t) {
        return d[e] = {key: e, module: t, importerSetters: [], linkRecord: void 0}
    }

    var d = {}, u = "undefined" != typeof Symbol ? Symbol() : "@@baseObject";
    i.prototype = Object.create(null), "undefined" != typeof Symbol && Symbol.toStringTag && (i.prototype[Symbol.toStringTag] = "Module");
    var h = "undefined" != typeof System && System._nodeRequire || "undefined" != typeof require && void 0 !== require.resolve && "undefined" != typeof process && process.platform && require,
        f = {};
    return Object.freeze && Object.freeze(f), function (e, t, r, l) {
        return function (u) {
            u(function (u) {
                var f = {
                    _nodeRequire: h, register: a, registerDynamic: s, registry: {
                        get: function (e) {
                            return d[e].module
                        }, set: c
                    }, newModule: function (e) {
                        return new i(e)
                    }
                };
                c("@empty", new i({}));
                for (var p = 0; p < t.length; p++) c(t[p], n(arguments[p]));
                l(f);
                var m = o(e[0]);
                if (e.length > 1) for (p = 1; p < e.length; p++) o(e[p]);
                return r ? m.__useDefault : (m instanceof i && Object.defineProperty(m, "__esModule", {value: !0}), m)
            })
        }
    }
}("undefined" != typeof self ? self : "undefined" != typeof global ? global : this)(["a"], [], !0, function ($__System) {
    var require = this.require, exports = this.exports, module = this.module;
    !function (e) {
        "use strict";
        var t = function () {
            },
            n = e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.msRequestAnimationFrame || function (e) {
                return setTimeout(e, 16)
            };

        function i() {
            this.reads = [], this.writes = [], this.raf = n.bind(e), t("initialized", this)
        }

        i.prototype = {
            constructor: i, measure: function (e, n) {
                t("measure");
                var i = n ? e.bind(n) : e;
                return this.reads.push(i), r(this), i
            }, mutate: function (e, n) {
                t("mutate");
                var i = n ? e.bind(n) : e;
                return this.writes.push(i), r(this), i
            }, clear: function (e) {
                return t("clear", e), a(this.reads, e) || a(this.writes, e)
            }, extend: function (e) {
                if (t("extend", e), "object" != typeof e) throw new Error("expected object");
                var n = Object.create(this);
                return function (e, t) {
                    for (var n in t) t.hasOwnProperty(n) && (e[n] = t[n])
                }(n, e), n.fastdom = this, n.initialize && n.initialize(), n
            }, catch: null
        };

        function r(e) {
            e.scheduled || (e.scheduled = !0, e.raf(function (e) {
                t("flush");
                var n, i = e.writes, a = e.reads;
                try {
                    t("flushing reads", a.length), o(a), t("flushing writes", i.length), o(i)
                } catch (e) {
                    n = e
                }
                e.scheduled = !1, (a.length || i.length) && r(e);
                if (n) {
                    if (t("task errored", n.message), !e.catch) throw n;
                    e.catch(n)
                }
            }.bind(null, e)), t("flush scheduled"))
        }

        function o(e) {
            t("run tasks");
            for (var n; n = e.shift();) n()
        }

        function a(e, t) {
            var n = e.indexOf(t);
            return !!~n && !!e.splice(n, 1)
        }

        var s = e.fastdom = e.fastdom || new i;
        "f" == "function"[0] ? $__System.registerDynamic("b", [], !1, function (e, t, n) {
            return function () {
                return s
            }.call(this)
        }) : "o" == (typeof module)[0] && (module.exports = s)
    }(window || this), function () {
        var e = {
            initialize: function () {
                this._tasks = new Map
            }, mutate: function (e, n) {
                return t(this, "mutate", e, n)
            }, measure: function (e, n) {
                return t(this, "measure", e, n)
            }, clear: function (e) {
                var t = this._tasks, n = t.get(e);
                this.fastdom.clear(n), t.delete(n)
            }
        };

        function t(e, t, n, i) {
            var r, o = e._tasks, a = e.fastdom, s = new Promise(function (e, l) {
                r = a[t](function () {
                    o.delete(s);
                    try {
                        e(i ? n.call(i) : n())
                    } catch (e) {
                        l(e)
                    }
                }, i)
            });
            return o.set(s, r), s
        }

        "f" == "function"[0] ? $__System.registerDynamic("c", [], !1, function (t, n, i) {
            return function () {
                return e
            }.call(this)
        }) : "o" == (typeof module)[0] ? module.exports = e : window.fastdomPromised = e
    }(), $__System.registerDynamic("d", ["e"], !0, function (e, t, n) {
        this || self;
        !function (e) {
            var t;
            t = function (e) {
                return e
            }, e.defaultLanguage = t(navigator.languages && navigator.languages.length > 0 ? navigator.languages[0] : navigator.language || navigator.userLanguage), e.localize = function (n, i) {
                var r, o, a, s, l, c, d, u, h, f, p, m, g, v, y, b, w, C;
                return null == i && (i = {}), C = this, s = {}, a = i.fileExtension || "json", o = e.Deferred(), d = function (e, t, n) {
                    switch (null == n && (n = 1), n) {
                        case 1:
                            return s = {}, l(t + ".lproj/" + e + "." + a, e, t, n);
                        default:
                            return o.resolve()
                    }
                }, l = function (t, n, r, o) {
                    var a, l, c;
                    return null != i.pathPrefix && (t = i.pathPrefix + "/" + t), c = function (t) {
                        return e.extend(s, t), g(s), d(n, r, o + 1)
                    }, l = function () {
                        return 2 === o && r.indexOf("-") > -1 ? d(n, r, o + 1) : i.fallback && i.fallback !== r ? d(n, i.fallback) : void 0
                    }, e.localize.data[n] ? c(e.localize.data[n]) : (a = {
                        url: t,
                        dataType: "json",
                        async: !0,
                        timeout: null != i.timeout ? i.timeout : 500,
                        success: c,
                        error: l
                    }, "file:" === window.location.protocol && (a.error = function (t) {
                        return c(t.responseText ? e.parseJSON(t.responseText) : {})
                    }), e.ajax(a))
                }, g = function (e) {
                    return null != i.callback ? i.callback(e, r) : r(e)
                }, r = function (t) {
                    return e.localize.data[n] = t, C.each(function () {
                        var n, i, r;
                        if (i = ((n = e(this)).data("localize") || n.data("afterContent") || n.attr("ty-hint") || "").replace(/\\n/g, "\n"), r = w(i, t)) return u(n, i, r)
                    })
                }, u = function (t, n, i) {
                    if (t.is("input") ? p(t, n, i) : t.is("textarea") ? p(t, n, i) : t.is("img") ? f(t, n, i) : t.is("optgroup") && m(t, n, i), t[0].hasAttribute("data-after-content")) t.attr("data-after-content", i); else if (t[0].hasAttribute("ty-hint")) t.attr("ty-hint", i).attr("aria-label", i); else if (t[0].hasAttribute("data-lt")) t.html(i); else {
                        if (e.isPlainObject(i)) return h(t, i);
                        t.text(i)
                    }
                }, p = function (t, n, i) {
                    var r;
                    if (r = e.isPlainObject(i) ? i.value : i, t.is("[placeholder]")) return t.attr("placeholder", r)
                }, h = function (e, t) {
                    return y(e, "title", t), b(e, "text", t)
                }, m = function (e, t, n) {
                    return e.attr("label", n)
                }, f = function (e, t, n) {
                    return y(e, "alt", n), y(e, "src", n)
                }, w = function (e, t) {
                    return t[e] || e
                }, y = function (e, t, n) {
                    if (null != (n = w(t, n))) return e.attr(t, n)
                }, b = function (e, t, n) {
                    if (null != (n = w(t, n))) return e.text(n)
                }, v = function (e) {
                    var t;
                    return "string" == typeof e ? "^" + e + "$" : null != e.length ? function () {
                        var n, i, r;
                        for (r = [], n = 0, i = e.length; n < i; n++) t = e[n], r.push(v(t));
                        return r
                    }().join("|") : e
                }, c = t(i.language ? i.language : e.defaultLanguage), i.skipLanguage && c.match(v(i.skipLanguage)) ? o.resolve() : d(n, c, 1), C.localizePromise = o, C
            }, e.fn.localize = e.localize, e.localize.getString = function (t, n) {
                return (e.localize.data[n || "Front"] || {})[t] || t
            }, e.localize.isLoaded = function (t) {
                return !!e.localize.data[t || "Front"]
            }, e.localize.data = {}
        }(e("e"))
    }), $__System.registerDynamic("f", ["e"], !0, function (e, t, n) {
        "use strict";
        this || self;
        if (window.jQuery || (window.$ = e("e"), window.jQuery = window.$), "undefined" == typeof jQuery) throw new Error("Bootstrap's JavaScript requires jQuery");
        !function (e) {
            var t = '[data-dismiss="alert"]', n = function (n) {
                e(n).on("click", t, this.close)
            };
            n.VERSION = "3.2.0", n.prototype.close = function (t) {
                var n = e(this), i = n.attr("data-target");
                i || (i = (i = n.attr("href")) && i.replace(/.*(?=#[^\s]*$)/, ""));
                var r = e(i);
                t && t.preventDefault(), r.length || (r = n.hasClass("alert") ? n : n.parent()), r.trigger(t = e.Event("close.bs.alert")), t.isDefaultPrevented() || (r.removeClass("in"), e.support.transition && r.hasClass("fade") ? r.one("bsTransitionEnd", o).emulateTransitionEnd(150) : o());

                function o() {
                    r.detach().trigger("closed.bs.alert").remove()
                }
            };
            var i = e.fn.alert;
            e.fn.alert = function (t) {
                return this.each(function () {
                    var i = e(this), r = i.data("bs.alert");
                    r || i.data("bs.alert", r = new n(this)), "string" == typeof t && r[t].call(i)
                })
            }, e.fn.alert.Constructor = n, e.fn.alert.noConflict = function () {
                return e.fn.alert = i, this
            }, e(document).on("click.bs.alert.data-api", t, n.prototype.close)
        }(jQuery), function (e) {
            var t = function (n, i) {
                this.$element = e(n), this.options = e.extend({}, t.DEFAULTS, i), this.isLoading = !1
            };
            t.VERSION = "3.2.0", t.DEFAULTS = {loadingText: "loading..."}, t.prototype.setState = function (t) {
                var n = this.$element, i = n.is("input") ? "val" : "html", r = n.data();
                t += "Text", null == r.resetText && n.data("resetText", n[i]()), n[i](null == r[t] ? this.options[t] : r[t]), setTimeout(e.proxy(function () {
                    "loadingText" == t ? (this.isLoading = !0, n.addClass("disabled").attr("disabled", "disabled")) : this.isLoading && (this.isLoading = !1, n.removeClass("disabled").removeAttr("disabled"))
                }, this), 0)
            }, t.prototype.toggle = function () {
                var e = !0, t = this.$element.closest('[data-toggle="buttons"]');
                if (t.length) {
                    var n = this.$element.find("input");
                    "radio" == n.prop("type") && (n.prop("checked") && this.$element.hasClass("active") ? e = !1 : t.find(".active").removeClass("active")), e && n.prop("checked", !this.$element.hasClass("active")).trigger("change")
                }
                e && this.$element.toggleClass("active")
            };

            function n(n) {
                return this.each(function () {
                    var i = e(this), r = i.data("bs.button"), o = "object" == typeof n && n;
                    r || i.data("bs.button", r = new t(this, o)), "toggle" == n ? r.toggle() : n && r.setState(n)
                })
            }

            var i = e.fn.button;
            e.fn.button = n, e.fn.button.Constructor = t, e.fn.button.noConflict = function () {
                return e.fn.button = i, this
            }, e(document).on("click.bs.button.data-api", '[data-toggle^="button"]', function (t) {
                var i = e(t.target);
                i.hasClass("btn") || (i = i.closest(".btn")), n.call(i, "toggle"), t.preventDefault()
            })
        }(jQuery), function (e) {
            var t = ".dropdown-backdrop", n = '[data-toggle="dropdown"]', i = function (t) {
                e(t).on("click.bs.dropdown", this.toggle)
            };
            i.VERSION = "3.2.0", i.prototype.toggle = function (t) {
                var n = e(this);
                if (!n.is(".disabled, :disabled")) {
                    var i = o(n), a = i.hasClass("open");
                    if (r(), !a) {
                        "ontouchstart" in document.documentElement && !i.closest(".navbar-nav").length && e('<div class="dropdown-backdrop"/>').insertAfter(e(this)).on("click", r);
                        var s = {relatedTarget: this};
                        if (i.trigger(t = e.Event("show.bs.dropdown", s)), t.isDefaultPrevented()) return;
                        n.trigger("focus"), i.toggleClass("open").trigger("shown.bs.dropdown", s)
                    }
                    return !1
                }
            }, i.prototype.keydown = function (t) {
                if (/(38|40|27)/.test(t.keyCode)) {
                    var i = e(this);
                    if (t.preventDefault(), t.stopPropagation(), !i.is(".disabled, :disabled")) {
                        var r = o(i), a = r.hasClass("open");
                        if (!a || a && 27 == t.keyCode) return 27 == t.which && r.find(n).trigger("focus"), i.trigger("click");
                        var s = " li:not(.divider):visible a",
                            l = r.find('[role="menu"]' + s + ', [role="listbox"]' + s);
                        if (l.length) {
                            var c = l.index(l.filter(":focus"));
                            38 == t.keyCode && c > 0 && c--, 40 == t.keyCode && c < l.length - 1 && c++, ~c || (c = 0), l.eq(c).trigger("focus")
                        }
                    }
                }
            };

            function r(i) {
                i && 3 === i.which || (e(t).remove(), e(n).each(function () {
                    var t = o(e(this)), n = {relatedTarget: this};
                    t.hasClass("open") && (t.trigger(i = e.Event("hide.bs.dropdown", n)), i.isDefaultPrevented() || t.removeClass("open").trigger("hidden.bs.dropdown", n))
                }))
            }

            function o(t) {
                var n = t.attr("data-target");
                n || (n = (n = t.attr("href")) && /#[A-Za-z]/.test(n) && n.replace(/.*(?=#[^\s]*$)/, ""));
                var i = n && e(n);
                return i && i.length ? i : t.parent()
            }

            var a = e.fn.dropdown;
            e.fn.dropdown = function (t) {
                return this.each(function () {
                    var n = e(this), r = n.data("bs.dropdown");
                    r || n.data("bs.dropdown", r = new i(this)), "string" == typeof t && r[t].call(n)
                })
            }, e.fn.dropdown.Constructor = i, e.fn.dropdown.noConflict = function () {
                return e.fn.dropdown = a, this
            }, e(document).on("click.bs.dropdown.data-api", "modal.fade.in", r).on("click.bs.dropdown.data-api", ".dropdown form", function (e) {
                e.stopPropagation()
            }).on("click.bs.dropdown.data-api", n, i.prototype.toggle).on("keydown.bs.dropdown.data-api", n + ', [role="menu"], [role="listbox"]', i.prototype.keydown)
        }(jQuery), function (e) {
            var t = function (t, n) {
                this.options = n, this.$body = e(document.body), this.$element = e(t), this.$backdrop = this.isShown = null, this.scrollbarWidth = 0, this.options.remote && this.$element.find(".modal-content").load(this.options.remote, e.proxy(function () {
                    this.$element.trigger("loaded.bs.modal")
                }, this))
            };
            t.VERSION = "3.2.0", t.DEFAULTS = {
                backdrop: !0,
                keyboard: !0,
                show: !0
            }, t.prototype.toggle = function (e) {
                return this.isShown ? this.hide() : this.show(e)
            }, t.prototype.show = function (t) {
                var n = this, i = e.Event("show.bs.modal", {relatedTarget: t});
                this.$element.trigger(i), this.isShown || i.isDefaultPrevented() || (this.isShown = !0, this.checkScrollbar(), this.$body.addClass("modal-open"), this.setScrollbar(), this.escape(), this.$element.on("click.dismiss.bs.modal", '[data-dismiss="modal"]', e.proxy(this.hide, this)), this.backdrop(function () {
                    var i = e.support.transition && n.$element.hasClass("fade");
                    n.$element.parent().length || n.$element.appendTo(n.$body), n.$element.show().scrollTop(0), i && n.$element[0].offsetWidth, n.$element.addClass("in").attr("aria-hidden", !1), n.enforceFocus();
                    var r = e.Event("shown.bs.modal", {relatedTarget: t});
                    i ? n.$element.find(".modal-dialog").one("bsTransitionEnd", function () {
                        n.$element.trigger("focus").trigger(r)
                    }).emulateTransitionEnd(300) : n.$element.trigger("focus").trigger(r)
                }))
            }, t.prototype.hide = function (t) {
                t && t.preventDefault(), t = e.Event("hide.bs.modal"), this.$element.trigger(t), this.isShown && !t.isDefaultPrevented() && (this.isShown = !1, this.resetScrollbar(), this.escape(), e(document).off("focusin.bs.modal"), this.$element.removeClass("in").attr("aria-hidden", !0).off("click.dismiss.bs.modal"), e.support.transition && this.$element.hasClass("fade") ? this.$element.one("bsTransitionEnd", e.proxy(this.hideModal, this)).emulateTransitionEnd(300) : this.hideModal())
            }, t.prototype.enforceFocus = function () {
                e(document).off("focusin.bs.modal").on("focusin.bs.modal", e.proxy(function (e) {
                    this.$element[0] === e.target || this.$element.has(e.target).length || this.$element.trigger("focus")
                }, this))
            }, t.prototype.escape = function () {
                this.isShown && this.options.keyboard ? this.$element.on("keyup.dismiss.bs.modal", e.proxy(function (e) {
                    27 == e.which && this.hide()
                }, this)) : this.isShown || this.$element.off("keyup.dismiss.bs.modal")
            }, t.prototype.hideModal = function () {
                var t = this;
                this.$element.hide(), this.backdrop(function () {
                    t.$element.trigger("hidden.bs.modal"), e("body").removeClass("modal-open")
                })
            }, t.prototype.removeBackdrop = function () {
                this.$backdrop && this.$backdrop.remove(), this.$backdrop = null
            }, t.prototype.backdrop = function (t) {
                var n = this, i = this.$element.hasClass("fade") ? "fade" : "";
                if (this.isShown && this.options.backdrop) {
                    var r = e.support.transition && i;
                    if (this.$backdrop = e('<div class="modal-backdrop ' + i + '" />').appendTo(this.$body), this.$element.on("click.dismiss.bs.modal", e.proxy(function (e) {
                        e.target === e.currentTarget && ("static" == this.options.backdrop ? this.$element[0].focus.call(this.$element[0]) : this.hide.call(this))
                    }, this)), r && this.$backdrop[0].offsetWidth, this.$backdrop.addClass("in"), !t) return;
                    r ? this.$backdrop.one("bsTransitionEnd", t).emulateTransitionEnd(150) : t()
                } else if (!this.isShown && this.$backdrop) {
                    this.$backdrop.removeClass("in");
                    var o = function () {
                        n.removeBackdrop(), t && t()
                    };
                    e.support.transition && this.$element.hasClass("fade") ? this.$backdrop.one("bsTransitionEnd", o).emulateTransitionEnd(150) : o()
                } else t && t()
            }, t.prototype.checkScrollbar = function () {
                document.body.clientWidth >= window.innerWidth || (this.scrollbarWidth = this.scrollbarWidth || this.measureScrollbar())
            }, t.prototype.setScrollbar = function () {
                var e = parseInt(this.$body.css("padding-right") || 0, 10);
                this.scrollbarWidth && this.$body.css("padding-right", e + this.scrollbarWidth)
            }, t.prototype.resetScrollbar = function () {
                this.$body.css("padding-right", "")
            }, t.prototype.measureScrollbar = function () {
                var e = document.createElement("div");
                e.className = "modal-scrollbar-measure", this.$body.append(e);
                var t = e.offsetWidth - e.clientWidth;
                return this.$body[0].removeChild(e), t
            };

            function n(n, i) {
                return this.each(function () {
                    var r = e(this), o = r.data("bs.modal"),
                        a = e.extend({}, t.DEFAULTS, r.data(), "object" == typeof n && n);
                    o || r.data("bs.modal", o = new t(this, a)), "string" == typeof n ? o[n](i) : a.show && o.show(i)
                })
            }

            var i = e.fn.modal;
            e.fn.modal = n, e.fn.modal.Constructor = t, e.fn.modal.noConflict = function () {
                return e.fn.modal = i, this
            }, e(document).on("click.bs.modal.data-api", '[data-toggle="modal"]', function (t) {
                var i = e(this), r = i.attr("href"),
                    o = e(i.attr("data-target") || r && r.replace(/.*(?=#[^\s]+$)/, "")),
                    a = o.data("bs.modal") ? "toggle" : e.extend({remote: !/#/.test(r) && r}, o.data(), i.data());
                i.is("a") && t.preventDefault(), o.one("show.bs.modal", function (e) {
                    e.isDefaultPrevented() || o.one("hidden.bs.modal", function () {
                        i.is(":visible") && i.trigger("focus")
                    })
                }), n.call(o, a, this)
            })
        }(jQuery), function (e) {
            var t = function (t) {
                this.element = e(t)
            };
            t.VERSION = "3.2.0", t.prototype.show = function () {
                var t = this.element, n = t.closest("ul:not(.dropdown-menu)"), i = t.data("target");
                if (i || (i = (i = t.attr("href")) && i.replace(/.*(?=#[^\s]*$)/, "")), !t.parent("li").hasClass("active")) {
                    var r = n.find(".active:last a")[0], o = e.Event("show.bs.tab", {relatedTarget: r});
                    if (t.trigger(o), !o.isDefaultPrevented()) {
                        var a = e(i);
                        this.activate(t.closest("li"), n), this.activate(a, a.parent(), function () {
                            t.trigger({type: "shown.bs.tab", relatedTarget: r})
                        })
                    }
                }
            }, t.prototype.activate = function (t, n, i) {
                var r = n.find("> .active"), o = i && e.support.transition && r.hasClass("fade");

                function a() {
                    r.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"), t.addClass("active"), o ? (t[0].offsetWidth, t.addClass("in")) : t.removeClass("fade"), t.parent(".dropdown-menu") && t.closest("li.dropdown").addClass("active"), i && i()
                }

                o ? r.one("bsTransitionEnd", a).emulateTransitionEnd(150) : a(), r.removeClass("in")
            };

            function n(n) {
                return this.each(function () {
                    var i = e(this), r = i.data("bs.tab");
                    r || i.data("bs.tab", r = new t(this)), "string" == typeof n && r[n]()
                })
            }

            var i = e.fn.tab;
            e.fn.tab = n, e.fn.tab.Constructor = t, e.fn.tab.noConflict = function () {
                return e.fn.tab = i, this
            }, e(document).on("click.bs.tab.data-api", '[data-toggle="tab"], [data-toggle="pill"]', function (t) {
                t.preventDefault(), n.call(e(this), "show")
            })
        }(jQuery)
    }), $__System.registerDynamic("10", ["11", "12", "13"], !0, function (e, t, n) {
        this || self, e("11");
        var i = e("12"), r = i.Node, o = i.NodeMap, a = i.TYPE, s = e("13"), l = /\uE027/gi, c = ["-", "+", "*"];
        r.UL_DEFAULT_START = c, r.prototype.toMark = function () {
            var e = u.call(this);
            return e instanceof Array ? e.join(File.useCRLF ? "\r\n" : "\n").replace(l, "") : e
        };
        var d = function (e, t) {
            return "right" == e ? "-".repeat(t - 1) + ":" : "center" == e ? ":" + "-".repeat(t - 2) + ":" : "left" == e ? ":" + "-".repeat(t - 1) : "-".repeat(t)
        }, u = function () {
            var e, t, n, i = [];

            function o(e) {
                if (e.get("children").length) return m(e.get("children"));
                var t = e.get("text") ? e.get("text") : "";
                return t = t.replace(/(\u200B*):(\u200B*)/g, ":").replace(/\u200B\$/, "$")
            }

            function c(e, t) {
                v(e, t.get("ahead") || 0)
            }

            function g(e, t, n) {
                void 0 === n && (n = t.get("after") ? 1 : 0), v(e, void 0 == t.get("tail") ? n : t.get("tail"))
            }

            function v(e, t) {
                for (var n = 0; n < t; n++) e.push("")
            }

            function y(e) {
                return r.isType(e.get("parent"), a.list_item) && !1 !== e.get("parent").get("tight")
            }

            function b(e, t) {
                var n = -1, i = "", o = this.get("alignText");
                for (z = 0; z < e.length; z++) if (Y = this.get("align")[z], o) {
                    var a = o[z];
                    if (a) i += a, n = z; else if (n > -1) {
                        var s = o[n], l = this.get("align")[n];
                        " " != s[0] || " " === s[s.length - 1] || l && "center" != l || (o[n] = s + " ", i += " "), i += r.adjustAlignText(this, n, Y)
                    } else i += ((W = t.getNthChild(z)).get("marginLeft") || "") + d(Y, 4) + (W.get("marginRight") || "");
                    i += "|"
                } else i += " " + d(Y, e[z]) + " |";
                return i
            }

            try {
                switch (this.get("type")) {
                    case a.meta_block:
                        return i.push("---"), (i = i.concat((this.get("text") || "").replace(/^---/gm, "​---").split(/\r*\n/))).push("---"), g(i, this), i;
                    case a.heading:
                        if (c(i, this), this.get("pattern")) i = i.concat(this.get("pattern").replace("{0}", o(this)).split(/\r*\n/)); else if (!r.isType(this.get("parent"), a.list_item) && (1 == File.option.headingStyle || 3 == File.option.headingStyle) && this.get("depth") <= 2) i.push(o(this)), 3 == File.option.headingStyle ? i.push((1 == this.get("depth") ? "=" : "-").repeat(Math.max(1, s.wcswidth(this.get("text"))))) : i.push(1 == this.get("depth") ? "===" : "---"); else {
                            var w = "#".repeat(this.get("depth")) + " " + o(this);
                            2 == File.option.headingStyle && (w += " " + "#".repeat(this.get("depth"))), i.push(w)
                        }
                        return g(i, this), i;
                    case a.paragraph:
                        c(i, this), t = this.get("text").split(/\r?\n/g), i = i.concat(t.map(function (e) {
                            return e.replace(/^( {4}|\t)/, "​$1")
                        }));
                        return void 0 === (O = this.get("tail")) && this.get("after") && r.isType(this.get("parent"), a.list_item) && (O = y(this) ? 0 : void 0), r.isType(this.get("after"), a.paragraph) && O < 1 && this.unset("tail"), r.isType(this.get("after"), a.math_block) && !this.get("tail") && (O = 0), void 0 === O ? g(i, this, O) : v(i, O), i;
                    case a.blockquote:
                        return c(i, this), t = o(this), (T = this.get("userIndent")) && T.length == t.length ? t.map(function (e, n) {
                            t[n] = (T[n] || "") + e
                        }) : (this.unset("userIndent"), n = p(a.blockquote, 0, this, this.get("pattern")), t.map(function (e, i) {
                            t[i] = e ? n + e : n.replace(/\s+$/, "")
                        })), g(i = i.concat(t), this), "" !== i.last() && r.isType(this.get("after"), a.blockquote) && i.push(""), i;
                    case a.list:
                        c(i, this);
                        var C = this.get("style"), x = this.isLoose(), k = this.get("children").length, S = this;
                        if (k) for (var E = this.getFirstChild(), F = Number.isNaN(Number.parseInt(this.get("start"))) ? 0 : Number.parseInt(this.get("start")) - 1, _ = 0; E;) {
                            E.set("tight", !x), t = u.call(E), e = this.get("pattern"), x && e && E.get("markindent") && (e = f(C, e.trim(), E.get("markindent")));
                            var T, M = E.get("prespace") || 0,
                                A = void 0 === this.get("isFixed") && File.option.olStyle || this.get("isFixed"),
                                N = (n = " ".repeat(M) + p(C, (A ? 0 : _) + F, E, e, (k + "").length)).length, L = "",
                                R = C == r.ListType.ol ? (_ + F + "").length - 1 : 0;
                            L = (N = E.get("subindent") ? Math.min(n.replace(/\s+$/, "").length + 4, E.get("subindent") + R) : S.get("subindent") ? Math.min(n.replace(/\s+$/, "").length + 4, S.get("subindent") + R) : File.option.indentByTab ? 0 : Math.max(N, File.option.indentSize)) ? " ".repeat(N) : "\t";
                            if ((T = E.get("userIndent")) && T.length == t.length) E.get("style") == r.ListType.task && (T[0].trim().length && -1 == T[0].indexOf("[") && (T[0] = T[0] + "[ ] "), E.get("checked") ? T[0] = T[0].replace("[ ]", "[x]") : T[0] = T[0].replace(/\[x\]/i, "[ ]")), t.map(function (e, n) {
                                t[n] = T[n] + e, i.push(t[n].replace(l, ""))
                            }); else {
                                E.unset("userIndent");
                                var D = n;
                                E.get("style") == r.ListType.task && (D = n + (E.get("checked") ? "[x] " : "[ ] ")), t.map(function (e, n) {
                                    t[n] = (n ? e ? L : "" : D) + t[n], i.push(t[n].replace(l, ""))
                                })
                            }
                            _++, E = E.get("after")
                        }
                        return r.isType(this.get("after"), a.list) && (!this.get("tail") || this.get("tail")) < 1 && this.get("pattern") == this.get("after").get("pattern") && this.get("style") == this.get("after").get("style") && (this.unset("tail"), i.push(""), y(this) && i.push("")), g(i, this, y(this) ? 0 : function (e) {
                            var t = S.get("tail"), n = S.get("after");
                            if (0 === t) {
                                if (r.isType(n, a.paragraph)) return void e.unset("tail");
                                if (r.isType(n, a.fences) && /^\s+$/.exec(n.get("pattern") || "")) return void e.unset("tail")
                            }
                            return t
                        }(this)), i;
                    case a.list_item:
                        "string" == typeof(t = o(this)) && (t = [t]), i = i.concat(t);
                        var O;
                        for (void 0 == (O = this.get("tail")) && !this.get("tight") && this.get("after") && (O = 1), O > 0 && i.push(""); i.length > 2 && "" === i.last() && "" === i[i.length - 2];) i.pop();
                        return i;
                    case a.fences:
                        c(i, this);
                        var I = this.getText();
                        t = I.split(/\r*\n/), this.get("lang") ? (this.get("pattern") || "").trim() ? e = this.get("pattern") : (this.unset("pattern"), e = /^\s*```/gm.exec(this.get("text") || "") ? "~~~{0}" : "```{0}") : e = this.get("pattern") || "```{0}";
                        var P, B = e.match(/^\s+$/), $ = (e.match(/[`~]/) || [])[0];
                        $ && (P = new RegExp("^(" + $ + "{3})"));
                        for (_ = 0; _ < t.length; _++) t[_] = (B ? e : "") + (P ? t[_].replace(P, "​$1") : t[_]), t[_] = t[_] || "";
                        return !B && i.push(e.replace(/\{0\}/, this.get("lang") || "")), i = i.concat(t), !B && i.push(e.replace(/\s*\{0\}/, "")), g(i, this), i;
                    case a.math_block:
                        return c(i, this), this.get("tagBefore") ? i.push("$$ {" + this.get("tagBefore") + "}") : i.push("$$"), i = i.concat(this.get("text").replace(/(^\n)|(\n$)/g, "").split(/\r?\n/).map(function (e) {
                            return e || ""
                        })), this.get("tagAfter") ? i.push("$$ {" + this.get("tagAfter") + "}") : i.push("$$"), g(i, this, r.isType(this.get("after"), a.paragraph) && r.isType(this.get("before"), a.paragraph) ? 0 : 1), i;
                    case a.hr:
                        return i.push(this.get("pattern") || "------"), g(i, this), i;
                    case a.def_footnote:
                        return c(i, this), i.push("[^" + this.get("ref") + "]: " + o(this)), g(i, this, !this.get("after") || r.isType(this.get("after"), r.TYPE.def_footnote) ? 0 : 1), i;
                    case a.def_link:
                        c(i, this);
                        var H, U = this.safeGetStrAttr("title").length;
                        if (this.get("pattern")) {
                            var j = this.get("pattern").split(";");
                            H = j[0] + this.get("ref") + j[1] + this.safeGetStrAttr("href") + j[2], U && (H += (j[3] || "\t") + '"' + this.get("title") + '"')
                        } else H = "[" + this.get("ref") + "]: " + this.safeGetStrAttr("href") + (U ? '\t"' + this.get("title") + '"' : "");
                        return i.push(H), g(i, this, !this.get("after") || r.isType(this.get("after"), r.TYPE.def_link) ? 0 : 1), i;
                    case a.table:
                        if (c(i, this), this.get("userText")) return g(i = i.concat(this.get("userText").clone()), this), i;
                        for (var W, q, z, V, K, Y, Q, G = [], J = [], X = 0, Z = this.getFirstChild(); Z;) {
                            for (q = Z.getFirstChild(), J[X] = [], z = 0; q;) J[X][z] = q.toMark().trim(), q = q.get("after"), 0 === X && (G[z] = 4), G[z] = Math.max(s.wcswidth(J[X][z]), G[z]), G[z] = Math.min(G[z], 60), z++;
                            Z = Z.get("after"), X++
                        }
                        var ee = "npTable" == this.get("style") && G.length > 1;
                        for (Z = this.getFirstChild(), X = 0; X < J.length; X++) {
                            for (V = "|", W = Z.getFirstChild(), z = 0; z < G.length; z++) void 0 !== W.get("marginLeft") ? (V += W.get("marginLeft") + J[X][z] + W.get("marginRight"), V += "|") : (V += " ", K = Math.max(G[z] - s.wcswidth(J[X][z]), 0), V += "right" == (Y = this.get("align")[z]) ? " ".repeat(K) + J[X][z] : "center" == Y ? " ".repeat(Q = ~~(K / 2)) + J[X][z] + " ".repeat(K - Q) : J[X][z] + " ".repeat(K), V += " |"), W = W.get("after");
                            ee ? i.push(V.replace(/(^\s*\|)|(\|\s*$)/g, "")) : i.push(V.replace(/\s$/, "")), 0 === X && (V = "|" + b.call(this, G, Z), ee ? i.push(V.replace(/(^\s*\|)|(\|\s*$)/g, "")) : i.push(V.replace(/\s$/, ""))), Z = Z.get("after")
                        }
                        return g(i, this), i;
                    case a.table_row:
                        return console.sendError("cannot call toMark on table_row"), "";
                    case a.table_cell:
                        return h(o(this));
                    case a.toc:
                        return c(i, this), i.push(this.get("pattern") || "[TOC]"), ~(this.get("pattern") || "").indexOf("\n") && this.get("after") ? g(i, this, 2) : g(i, this), i;
                    case a.html_block:
                        return c(i, this), g(i = i.concat(this.get("text").replace(/(^\n)|(\n$)/g, "").split(/\r?\n/).map(function (e) {
                            return e || ""
                        })), this), i;
                    default:
                        return o(this)
                }
            } catch (e) {
                return console.error(e.stack), i
            }
        }, h = function (e) {
            var t = "", n = "", i = [], r = 0, o = 0;
            return e = e.replace(/(^|[^\\])`[^`]*\|[^`]*`/g, function (e) {
                return i.push(e), [t, ++r - 1, n].join("")
            }), File.option.enableInlineMath && (e = e.replace(/(^|[^\\])\$[^$]*\|[^$]*\$/g, function (e) {
                return i.push(e), [t, ++r - 1, n].join("")
            })), e.replace(/\|/g, "\\|").replace(/\\\\\|/g, "\\|").replace(/\uE07A[^\uE07B]+\uE07B/g, function () {
                return i[++o - 1]
            })
        }, f = function (e, t, n) {
            var i = File.option.prettyIndent;
            return void 0 !== n ? n -= 0 : n = Math.max(File.option.indentSize - 0, 2), e == a.blockquote ? ">" + " ".repeat(Math.min(n - 1, i ? 4 : 1)) : e === r.ListType.ol ? "{0}." + " ".repeat(Math.min(n - 2, i ? 4 : 1) || 1) : e === r.ListType.ul ? (t || c[File.option.ulStyle]) + " ".repeat(Math.min(n - 1, i ? 4 : 1)) : c[File.option.ulStyle] + " "
        }, p = function (e, t, n, i) {
            var o = File.option.indentSize;
            return t++, i = i || f(e), (!$.isNumeric(o) || o < 2) && (o = 2), e == a.blockquote ? i : e === r.ListType.ol ? i.replace("{0}", t) : i
        };
        r.getIndentPrefix = p, r.getDefaultPrefixPattern = f, r.markFromArr = function (e) {
            var t = m(e);
            return t instanceof Array ? t.join(File.useCRLF ? "\r\n" : "\n").replace(l, "") : t
        };
        var m = function (e) {
            var t = [], n = "";

            function i(e) {
                var i = u.call(e);
                i instanceof Array ? t = t.concat(i) : n += i
            }

            if (e.length) if (e instanceof Array) e.map(function (e) {
                i(e)
            }); else {
                var r = e.sortedFirst();
                do {
                    i(r), r = r.get("after")
                } while (r)
            }
            return t.length ? t : n
        };
        o.prototype.toMark = function () {
            if (this.blocks.length > 0) {
                var e = this.blocks.sortedFirst();
                e = e.getLastBrother(!0);
                var t = [], n = "";
                do {
                    var i = u.call(e);
                    i instanceof Array ? t = t.concat(i) : n += i, e = e.get("after")
                } while (e);
                return t.length ? t.join(File.useCRLF ? "\r\n" : "\n").replace(l, "") : n
            }
            return ""
        }, r.getIndentPrefix = p
    }), $__System.registerDynamic("14", ["11", "12", "13", "15", "16", "17", "18"], !0, function (e, t, n) {
        this || self, e("11");
        var i = e("12"), r = i.Node, o = (i.NodeMap, i.TYPE), a = (i.NodeCollectionUtils, e("13")), s = e("15"),
            l = (e("16"), e("17")), c = e("18"), d = document.querySelector("#md-rawblock-tooltip-templ").innerHTML;
        r.prototype.toHTML = function (e, t) {
            var n, u = ["h1", "h2", "h3", "h4", "h5", "h6"];
            File.option.expandSimpleBlock && r.isType(this, o.paragraph) && (u.indexOf(t) > -1 ? this.set("depth", u.indexOf(t) + 1) : this.unset("depth"));

            function h(t, n) {
                var a, s = t.get("children");
                return void 0 !== e && null !== e ? e : s && s.length > 0 ? i.NodeCollectionUtils.toHTML(s, n) : (a = t.safeGetStrAttr("text"), r.isType(t, o.paragraph) && /^\u200b( {4}|\t)/g.exec(a) && (a = a.replace(/^\u200b( {4}|\t)/g, "$1"), t.set("text", a)), t.cursorDiff = [], c.parseInline(t.safeGetStrAttr("text"), {attr: !r.isType(t, o.heading)}, t.cursorDiff))
            }

            function f(e) {
                var n = function (e) {
                        try {
                            if (r.isType(e, o.fences, o.hr, o.def_link, o.def_footnote, o.table, o.math_block)) return !1;
                            if (r.isType(e, o.list_item) && e.get("style") == r.ListType.task) return !1;
                            if (e.canContainBlock()) return;
                            return File.inBusyMode ? 0 == e.get("children").length || void 0 : 0 == e.get("children").length || r.isType(e.get("parent"), o.list_item) || void 0
                        } catch (e) {
                        }
                    }(e), i = n ? " contenteditable='true' " : !1 === n ? " contenteditable='false' " : "",
                    a = t ? "mdlike='" + t + "' " : " ",
                    s = " cid = '" + e.id + "' mdtype = '" + e.get("type") + "' " + i + a;
                return (e.get("text") || "").length > 1e4 && (s += " spellcheck='false' "), s
            }

            switch (this.get("type")) {
                case o.meta_block:
                    var p = this.get("text") || "";
                    return p.match(/^\n/g) && (p = p.replace(/^\n/g, "\n\n")), "<pre " + f(this) + " class='md-meta-block md-end-block' >" + a.escape(p, !1, !0) + "\n</pre>";
                case o.paragraph:
                    return "<p " + f(this) + " class='md-end-block'>" + h(this) + "</p>";
                case o.raw_edit:
                    return "<p class='rawedit' contenteditable ='true' spellcheck='false' " + f(this) + ">" + this.safeGetStrAttr("text", !0) + "</p>";
                case o.heading:
                    return "<h" + this.get("depth") + f(this) + "class='md-end-block md-heading' >" + h(this) + "</h" + this.get("depth") + ">";
                case o.blockquote:
                    return "<blockquote " + f(this) + " >" + h(this) + "</blockquote>";
                case o.list:
                    var m = this.get("style"),
                        g = ((this.get("pattern") || r.UL_DEFAULT_START[File.option.ulStyle] || "-").match(/[*+-]/) || [])[0];
                    if (g = " data-mark='" + g + "' ", m == r.ListType.ol) {
                        var v = "" === this.get("start") ? void 0 : this.get("start") - 0;
                        return "<ol class='ol-list' " + (v = Number.isNaN(v) || 1 == v ? "" : "start='" + this.get("start") + "' ") + f(this) + " >" + h(this) + "</ol>"
                    }
                    return "<ul class='ul-list' " + f(this) + g + " >" + h(this) + "</ul>";
                case o.list_item:
                    return this.get("parent") && this.get("style") === r.ListType.task ? "<li class='md-list-item task-list-item  md-task-list-item task-list-" + (this.get("checked") ? "done" : "not-done") + " ' " + f(this) + "><input type='checkbox' " + (this.get("checked") ? "checked" : "") + "></input>" + h(this) + "</li>" : "<li class='md-list-item' " + f(this) + " >" + h(this) + "</li>";
                case o.fences:
                    var y = "<pre spellcheck='false' class='md-fences mock-cm md-end-block" + (File.option.showLineNumbersForFence ? " md-fences-with-lineno" : "") + "' lang='" + a.escape(this.get("lang") || "") + "' contenteditable='false'" + f(this) + ">" + (this.get("text") && this.get("text").trim().length ? a.escape(this.get("text")) + "\n" : "<br/>") + "</pre>";
                    if (s.isDiagramType(this.get("lang"))) {
                        var b = File.editor.findElemById(this.cid);
                        if (b.find("textarea").val() == this.get("text")) {
                            y = $(y).append(b.find(".md-diagram-panel").clone())[0].outerHTML
                        }
                    }
                    return y;
                case o.hr:
                    return "<div tabindex='-1' contenteditable='false' " + f(this) + " class='md-hr md-end-block' ><hr /></div>";
                case o.def_footnote:
                    return "<div class='footnotes md-def-footnote md-end-block' contenteditable='false'" + f(this) + "><span class='md-def-name' contenteditable='true'>" + a.escape(this.get("ref") ? this.get("ref") : "​") + "</span><span class='md-def-split md-def-f' contenteditable='false' >&nbsp;</span><span class='md-def-content' contenteditable='true'>" + h(this) + "</span></div>";
                case o.def_link:
                    return "<div class='footnotes md-def-link md-end-block' contenteditable='false'" + f(this) + "><span class='md-def-name' contenteditable='true'>" + a.escape(this.get("ref") ? this.get("ref") : "​") + "</span><span class='md-def-split md-def-f' contenteditable='false' >&nbsp;</span><span class='md-def-content md-def-url md-auto-disp' href='#' contenteditable='true'>" + a.escape(this.get("href")) + "</span><span class='md-def-split md-auto-hide' contenteditable='false'>&nbsp;</span><span class='md-def-title md-auto-disp md-auto-hide' contenteditable='true'>" + a.escape(this.get("title")) + "</span></div>";
                case o.table:
                    this.get("align").length, y = "<figure class='md-table-fig' contenteditable='false' " + f(this) + "><table class='md-table'>";
                    for (var w = this.getFirstChild(); w;) w.get("before") ? y += w.toHTML() : y += "<thead>" + w.toHTML() + "</thead><tbody>", (w = w.get("after")) || (y += "</tbody>");
                    return y += "</table></figure>";
                case o.table_row:
                    y = "<tr class='md-end-block' " + f(this) + ">", w = this.getFirstChild();
                    var C, x = this.get("parent").get("align") || [], k = 0, S = this.get("before") ? "td" : "th";
                    for (this.get("parent").get("align") || this.get("parent").set("align", []); w;) y += "<" + S + (C = (C = x[k]) ? " style='text-align:" + C + ";' " : "") + ">" + w.toHTML() + "</" + S + ">", w = w.get("after"), k++;
                    return y += "</tr>";
                case o.table_cell:
                    return "<span contenteditable='true' class='td-span' " + f(this) + ">" + h(this) + "</span>";
                case o.math_block:
                    return "<div contenteditable='false' spellcheck='false' class='mathjax-block md-end-block md-math-block md-rawblock' id='mathjax-" + this.cid + "' " + f(this) + ">" + d.replace("{type}", $.localize.getString("Math", "Menu")) + "<div class='md-rawblock-container md-math-container' tabindex='-1'><span class='md-math-source'>$$\n" + a.escape(a.useOrDefault(this.get("text"), "<Empty \\space Math \\space Block>")) + "\n$$</span></div></div>";
                case o.toc:
                    return n = this.get("in"), "<div contenteditable='false' tabindex='-1' class='md-toc md-end-block' " + f(this) + "><div class='md-tooltip-hide md-toc-tooltip'><span>" + $.localize.getString("Table of Contents") + "</span> <button type='button' class='btn md-delete-toc'><span class='ty-icon ty-delete'></span></button></div><p class='md-toc-content'>" + (n.toc ? n.toc.getTocInnerHTML() : "") + "</p></div>";
                case o.html_block:
                    return l.HIDDEN_TYPE.indexOf(this.get("displayStyle") || this.get("style")) > -1 && !l.checkIsWhiteList(this) ? "<div contenteditable='false' spellcheck='false' class='md-htmlblock md-rawblock md-end-block' " + f(this) + ">" + d.replace("{type}", "HTML") + "<div class='md-htmlblock-panel md-rawblock-control' style='display:none;' contenteditable='false'></div><div class='md-htmlblock-container md-rawblock-container md-raw-html-src' contenteditable='false'><div class='md-raw-html-src-content'>" + a.escape(this.get("text")) + "</div></div></div>" : "<div contenteditable='false' spellcheck='false' class='md-htmlblock md-rawblock md-end-block' " + f(this) + "><span style='position:absolute;'>​</span>" + d.replace("{type}", "HTML") + "<div class='md-htmlblock-panel md-rawblock-control' style='display:none;' contenteditable='false;'></div><div class='md-htmlblock-container md-rawblock-container' tabindex='-1' contenteditable='false'>" + l.buildHTML(this) + "</div><span style='position:absolute;'>​</span></div>";
                default:
                    return "<p " + f(this) + ">unknow type: " + this.get("type") + "</p>"
            }
        }
    }), $__System.registerDynamic("19", ["11", "12", "13", "1a", "15", "1b", "1c"], !0, function (e, t, n) {
        "use strict";
        this || self, e("11");
        var i = e("12"), r = i.Node, o = i.TYPE, a = (i.NodeCollectionUtils, e("13")), s = e("1a"), l = e("15"),
            c = e("1b"), d = e("1c");
        r.normalizeNode = function (e) {
            if (0 == e.get("children").length && r.isType(e, o.blockquote)) {
                var t = new r({type: o.paragraph, parent: e, in: e.get("in")});
                return r.normalizeNode(t)
            }
        };
        r.genNormalSplitExitFunc = function (e, t, n) {
            return function (e, i) {
                var a = {prev: e, next: i};
                return e.get("type") == o.paragraph && (!n && e.parseFrom({skips: {enableStartMatch: !0}}), r.isType(e, o.paragraph) || (a.oldCid = e.cid, a.prev = e)), i.get("type") == o.paragraph && (!t && function (e, t) {
                    try {
                        var n, i, a = !t.isDeleted() && t.get("parent");
                        if (a = r.isType(a, o.list_item) && a.get("parent"), !(n = r.isType(a, o.list) && a.get("style"))) return;
                        if ((i = e.get("text")).match(/^(\s{2, }|\t)/)) return;
                        n == r.ListType.ol ? i = i.replace(/^\s*\d+\.\s+/, "") : n == r.ListType.ul && (i = i.replace(/^\s*[+*-]\s+/, "")), e.set("text", i)
                    } catch (e) {
                    }
                }(i, e), !n && i.parseFrom(), r.isType(i, o.paragraph) || (a.next = i)), a
            }
        }, r.prototype.breakOn = function (e, t, n) {
            var i, a;
            if (r.isType(this, o.table, o.table_row, o.table_cell, o.blockquote, o.list, o.list_item)) return null;
            var l = t.selection.buildUndo();
            if (r.isType(this, o.def_footnote)) {
                var c = t.getJQueryElem(window.getSelection().baseNode);
                i = c.closest(".md-def-name").length ? t.selection.getOffset(c.closest(".md-def-name")) : this.get("ref").length + 1 + t.selection.getOffset(c.closest(".md-def-content"))
            } else {
                var d = t.findElemById(this.id);
                d.find(".md-emoji").each(function () {
                    var e = [];
                    this.childNodes.forEach(function (t) {
                        3 == t.nodeType && e.push(t)
                    });
                    for (var t = 0; t < e.length; t++) this.removeChild(e[t])
                }), d.find(".md-ruby-container").remove(), i = t.selection.getOffset(d)
            }
            if (!this.get("children").length && (a = this.getText(!1).length, r.isType(this, o.def_link, o.def_footnote) && (a += this.get("ref").length + 1), !this.get("children").length)) {
                var u;
                return (u = function (t) {
                    if (t = t.getClosetBlock(), a <= 1 && r.isType(t, o.def_footnote, o.def_footnote) && !e && !n && r.isEmptyBlock(t, null, !0)) return (c = s.makeEmptyCommand(l)).undo.push(s.buildReplaceUndo(t)), t.unset("ahead"), t.unset("tail"), t.set("type", o.paragraph), r.normalizeNode(t), c.redo.push(s.buildReplaceUndo(t)), c.redo.push({
                        type: "cursor",
                        id: t.getLastChild().cid,
                        start: 0
                    }), {command: c, nextFocus: t.getLastChild().cid, oldCid: t.cid, newHtml: t.toHTML()};
                    if (0 == i && 0 == a && !e && !n && t.closest(o.blockquote, o.list) && t.get("parent") && t.get("parent").canContainBlock(!0) && (t.get("parent").get("type") != o.list_item || !t.get("after")) && !function (e) {
                        var t = e.get("parent");
                        return r.isType(t, o.list_item) && !e.get("before") && !e.get("after") && !t.get("before") && !t.get("after") && t.get("parent").get("attachTo")
                    }(t)) {
                        var c;
                        (c = s.makeEmptyCommand()).undo.push(l);
                        var d = {}, u = t.get("before") && r.isEmptyBlock(t.get("before"));
                        return d = t.upStream(u), c.undo = c.undo.concat(d.command.undo), c.redo = c.redo.concat(d.command.redo), d.nextFocus = d.nextFocus || t.id, c.redo.push({
                            type: "cursor",
                            id: d.nextFocus,
                            start: 0
                        }), d.command = c, d
                    }
                }(this.getClosetBlock())) ? u : (u = function (e) {
                    if (i == a && e == t.nodeMap.getFirst() && r.isType(e, o.paragraph) && (l = e.get("text"), File.shouldRemapPunctuation() ? "---" == (l || "").replace(/\u2013/g, "--").replace(/\u2014/g, "---") : "---" == l)) {
                        var n = t.stylize.insertMetaBlock(!0);
                        return n.command.undo.push(s.buildReplaceUndo(e)), e.set("text", ""), n.command.redo.push(s.buildReplaceUndo(e)), n.newHtml = n.node.toHTML() + e.toHTML(), n.nextFocus = n.node.id, n.oldCid = e.id, n
                    }
                    var l
                }(this)) ? u : function (i, c, d) {
                    d = d || s.makeEmptyCommand();
                    var u = {}, p = c == a && c > 0, m = i.getClosetBlock();
                    return d.undo.push(l), r.isType(m.get("parent"), o.list_item) && !e ? d.undo.push(s.buildReplaceUndo(m.get("parent"))) : d.undo.push(s.buildReplaceUndo(m)), m.unset("ahead"), m.unset("tail"), n && r.isType(i, o.paragraph) ? h(i, c, d, p) : (u = r.splitAt(i, c, t, e), d.redo.push(t.undo.buildReplaceUndo(u.prev)), u.prev && u.prev.contains(i) || d.redo.push(t.undo.buildReplaceUndo(i)), i = u.insertArray[0] ? u.insertArray[0].get("before") : i, u.oldCid = i.cid, s.addUndoForInsertArray(d, u.insertArray), u.newHtml = i.toHTML() + u.insertArray.map(function (e) {
                        return e.toHTML()
                    }).join(""), f(u, p), d.redo.push({type: "cursor", id: u.nextFocus, start: 0}), u.command = d, u)
                }(this, i = Math.min(a, i))
            }

            function h(e, i, a, l) {
                if (n && r.isType(e, o.paragraph)) {
                    var c = e.get("text") || "";
                    if ("\n" == c[i] ? n = !1 : "\n" == c[i - 1] && (n = !1, i--), a.undo.push(s.buildReplaceUndo(e)), e.set("text", c.substring(0, i)), !n) return a.redo.push(s.buildReplaceUndo(e)), function (e, t, n) {
                        var i = new r({type: o.paragraph, text: n, in: e.get("in")});
                        return e.insert(i), s.addUndoForInsert(t, i), {
                            oldCid: e.cid,
                            prev: e,
                            next: i,
                            command: t,
                            nextFocus: i.cid,
                            newHtml: e.toHTML() + i.toHTML()
                        }
                    }(e, a, c.substring(i + 1));
                    var d = r.smartSplit(t.findElemById(e.id), i);
                    e.set("text", d[0]);
                    var u, h = e.parseFrom({skips: {enableStartMatch: !0}}, void 0, !0);
                    if (1 == h[1].length && r.isType(h[1][0], o.paragraph)) return e.set("text", d[0] + "\n" + d[1]), a.redo.push(s.buildReplaceUndo(e)), u = {
                        type: "cursor",
                        id: e.id,
                        start: d[0].length + 1
                    }, a.redo.push(u), {
                        oldCid: e.cid,
                        nextFocus: e.cid,
                        prev: e,
                        newHtml: e.toHTML(),
                        command: a,
                        cursor: u
                    };
                    a.redo.push(s.buildReplaceUndo(e));
                    var p = h[1], m = p.last(), g = m.getVeryFirst(!0).getClosetBlock();
                    r.isType(g, o.paragraph) ? (u = {
                        type: "cursor",
                        id: g.id,
                        start: g.get("text").length + 1
                    }, g.set("text", g.get("text") + "\n" + d[1])) : (u = {
                        type: "cursor",
                        id: (g = new r({type: o.paragraph, text: d[1]})).id,
                        start: 0
                    }, p.last().insert(g), p.push(g)), s.addUndoForInsertArray(a, p.subarray(1));
                    var v = {
                        oldCid: e.cid,
                        nextFocus: g.cid,
                        prev: m,
                        next: m.get("after"),
                        newHtml: p.map(function (e) {
                            return e.toHTML()
                        }).join(""),
                        command: a,
                        cursor: u
                    };
                    return 0 == u.start ? (v.cursor = void 0, f(v, l), a.redo.push({
                        type: "cursor",
                        id: v.nextFocus,
                        start: 0
                    })) : a.redo.push(u), v
                }
            }

            function f(e, t) {
                if (r.isType(e.prev, o.meta_block) && t && e.prev.get("text").match(/\n$/)) e.nextFocus = e.next.getVeryFirst().id; else if (t && r.isType(e.prev && e.prev.getLastChild() || e.prev, o.math_block, o.fences, o.meta_block, o.html_block)) {
                    var n = e.prev.getVeryFirst(!0);
                    !r.isType(n, o.html_block) || /\n/.exec(n.get("text")) || n.get("depth") ? e.nextFocus = n.id : e.nextFocus = e.next.getVeryFirst().cid
                } else t && r.isType(e.prev, o.table) ? e.nextFocus = e.prev.getLastChild().getVeryFirst().cid : e.nextFocus = e.next.getVeryFirst().cid
            }
        }, r.isEmptyBlock = function (e, t, n) {
            var i = n ? a.isNullOrBlank : a.isNullOrEmpty;
            if (r.isType(e, t || [])) return !1;
            if (e.get("children").length) {
                if (r.isType(e, o.paragraph)) return i(e.get("text"))
            } else {
                if (r.isType(e, o.def_link)) return i(e.get("ref")) && i(e.get("href")) && i(e.get("title"));
                if (r.isType(e, o.def_footnote)) return i(e.get("ref")) && i(e.get("text"));
                if (!r.isType(e, o.table_cell, o.table_row, o.hr)) return i(e.get("text"))
            }
            return !1
        };
        r.smartSplit = function (e, t, n) {
            var i, r, o, a = c.createRange();
            if (0 == t) return ["", e.rawText()];
            if (t == (e[0].textContent || e[0].innerText).length) {
                var s = e.rawText();
                return File.isMac && File.option.smartQuote && !File.option.convertSmartOnRender && /["']$/.exec(s) && s.length > 1 && (s = s.replace(/["']$/, function (e) {
                    return d.userQuote("'" == e ? 3 : 1, !1, !0)
                })), [s, ""]
            }
            n ? (o = $.parseHTML("<span />")[0], e[0].appendChild(o), e.prepend("<span />"), a.moveToBookmark({
                containerNode: e[0],
                start: t,
                end: t
            }), a.setEndAfter(o), r = (o = a.extractContents()).querySelectorAll("[md-inline='strong'], [md-inline='em'], [md-inline='del'], [md-inline='code']"), i = e[0].querySelectorAll("[md-inline='strong'], [md-inline='em'], [md-inline='del'], [md-inline='code']")) : (e[0].childElementCount < 3 && (o = $.parseHTML("<span />")[0], e[0].insertBefore(o, e[0].firstChild), e.append("<span />")), a.moveToBookmark({
                containerNode: e[0],
                start: 0,
                end: t
            }), o && a.setStart(o, 0), i = (o = a.extractContents()).querySelectorAll("[md-inline='strong'], [md-inline='em'], [md-inline='del'], [md-inline='code']"), r = e[0].querySelectorAll("[md-inline='strong'], [md-inline='em'], [md-inline='del'], [md-inline='code']"));
            for (var l = 0; l < i.length; l++) {
                (u = $(i[l])).find(":not(.md-meta)").text().length ? u.children(".md-after").length || u.append(u.children(".md-before").clone().removeClass("md-before").addClass("md-after")) : u.html("")
            }
            for (l = 0; l < r.length; l++) {
                var u;
                (u = $(r[l])).find(":not(.md-meta)").text().length ? u.children(".md-before").length || u.prepend(u.children(".md-after").clone().removeClass("md-after").addClass("md-before")) : u.html("")
            }
            var h = o.querySelectorAll("svg");
            for (l = 0; l < h.length; l++) h[l].parentElement.removeChild(h[l]);
            return [$(o).rawText(), e.rawText()]
        };
        r.splitAt = function (e, t, n, i, a, s) {
            if (s = s || !a, r.isType(e, o.def_link, o.def_footnote)) return function (e, t, n) {
                var i, a, s = e.clone(), l = e.get("ref");
                if (t <= l.length) e.set("ref", l.substring(0, t)), s.set("ref", l.substring(t)), s.set("href", e.get("href")), s.set("title", e.get("title")), e.set("href", ""), e.set("title", ""), i = "", a = e.get("text"); else if (r.isType(e, o.def_link)) {
                    var c = e.get("href") || "", d = e.get("title") || "";
                    t <= l.length + c.length ? (e.set("title", ""), s.set("ref", ""), e.set("href", c.substring(0, t - l.length - 1)), s.set("href", c.substring(t - l.length - 1))) : (s.set("ref", ""), s.set("href", ""), e.set("title", d.substring(0, t - l.length - c.length - 1)), s.set("title", d.substring(t - l.length - c.length - 1)))
                } else {
                    var u = e.get("text") || "";
                    s.set("ref", ""), i = u.substring(0, t - l.length - 1), a = u.substring(t - l.length - 1)
                }
                return e.set("text", i), r.isType(s, o.def_link) || s.set("text", a || ""), r.isEmptyBlock(s) && !r.isType(s, o.paragraph) && (s.set("type", o.paragraph), s.set("text", "")), e.insert(s), {
                    oldCid: e.cid,
                    prev: e,
                    next: s,
                    insertArray: [s]
                }
            }(e, t);
            var l, c, d, u = e.clone();
            if (e.get("children").length) return console.error("cannot do Node.split at this ndoe"), null;
            r.isType(e, o.paragraph, o.heading) ? (l = (d = r.smartSplit(n.findElemById(e.id), t))[0].replace(/\n$/, ""), c = d[1].replace(/^\n/, ""), r.isType(e.get("parent"), o.list_item) && e.get("parent").get("parent").get("children").toArray().forEach(function (e) {
                e.unset("tail")
            })) : (l = e.getText().substring(0, t), c = e.getText().substring(t)), e.set("text", l), u.set("text", c);
            var h = e, f = [h], p = [];
            a || r.isType(e, o.paragraph) && !a && (p = (f = e.parseFrom({skips: {enableStartMatch: !0}}, void 0, !0)[1]).subarray(1), h = f.last().getVeryFirst().getClosetBlock()), h.insert(u), f.last() == h && p.push(u), r.isEmptyBlock(u) ? u.set("type", o.paragraph) : r.isEmptyBlock(h) && h.set("type", o.paragraph);
            var m = {prev: h, next: u, insertArray: p};
            if (i) return m;
            if (s && r.isType(h.get("parent"), o.list_item) && !h.get("before")) {
                var g = h.get("parent"), v = g.clone();
                g.get("style") == r.ListType.task && v.set("checked", !1), g.insert(v), v.appendTillEnd(u), p = f.subarray(1), f.last() == h && (f = [g]), f.last() == g && p.push(v), m = {
                    prev: g,
                    next: v,
                    insertArray: p
                }
            }
            return m
        };
        r.getTreePosition = function (e, t) {
            function n(e) {
                return e.get("parent") ? 1 + n(e.get("parent")) : 0
            }

            if (e == t) return [e, e, t];
            var i = n(e) - n(t);
            if (i > 0) for (; i > 0;) e = e.get("parent"), i--; else if (i < 0) for (; i < 0;) t = t.get("parent"), i++;
            return function e(t, n) {
                return t == n ? [t, t, n] : t.get("parent") == n.get("parent") || !t.get("parent") && !t.get("parent") ? [t.get("parent"), t, n] : e(t.get("parent"), n.get("parent"))
            }(e, t)
        }, r.prototype.copyContentFrom = function (e) {
            var t = this;
            r.property.map(function (n) {
                t.set(n, e.get(n))
            })
        }, r.prototype.clone = function () {
            var e = new r;
            return e.copyContentFrom(this), e.set("in", this.get("in")), e
        };
        r.reverseAttrFromElem = function (e, t, n, i) {
            var s, l = t.attr("mdtype");
            e.set("type", l), n && (t.find("[data-emoji]").text(function () {
                return this.getAttribute("data-emoji")
            }), t.find(".md-meta, .md-content").remove()), e.set("text", !i && r.isType(l, o.paragraph, o.def_footnote, o.heading) ? (c = t, c.find("[md-inline='image'], [md-inline='imgtag']").each(function () {
                var e = $(this), t = e.attr("data-src");
                if (!/^[a-z0-9\-]+:/i.exec(t)) {
                    var n = e.find("img").attr("src") || "", i = e.text(),
                        r = File.editor.imgEdit.resolveImagePath(n.replace(/^file:\/\//, "").replace(/[#?]([^.]*)$/, ""));
                    i = "image" == this.getAttribute("md-inline") ? i.replace(/(\(<?)((?:\([^)]*\)|[^()])*?)(>?[ \t]*((['"])(.*?)\5[ \t]*)?\))/, "$1" + r + "$3") : i.replace(/(^<img(\s+.+)*?\s+src=)("([^"]+)"|'([^']+)')(.*?(\/?\s*>.*?(<\/img>)?))/, '$1"' + r + '"$6'), e.text(i)
                }
            }), c).text() : t.text());
            var c;
            switch (l) {
                case e.TYPE.heading:
                    e.set("depth", t[0].tagName.replace(/H/gi, ""));
                    break;
                case e.TYPE.list:
                    e.set("style", t[0].tagName.toLowerCase());
                    break;
                case e.TYPE.math_block:
                    break;
                case e.TYPE.fences:
                    e.set("lang", a.unescape(t.attr("lang")) || t.find(".ty-input").text()), e.set("text", t.find("textarea[id]").val() || t.text());
                    break;
                case e.TYPE.list_item:
                    t.hasClass("md-task-list-item") && e.set("style", r.ListType.task), e.set("checked", "checked" == t.children("input").attr("checked"));
                    break;
                case e.TYPE.def_link:
                    e.set("ref", t.find(".md-def-name").text()), e.set("title", t.find(".md-def-title").text()), e.set("href", t.find(".md-def-content").text());
                    break;
                case e.TYPE.def_footnote:
                    e.set("text", t.find(".md-def-content").text()), e.set("ref", t.find(".md-def-name").text());
                    break;
                case e.TYPE.table:
                    s = [], t.find("tbody>tr:first").children().toArray().map(function (e) {
                        s[e.cellIndex] = e.style.textAlign, "" == e.style.textAlign && (s[e.cellIndex] = null)
                    }), s.length || t.find("thead>tr:first").children().toArray().map(function (e) {
                        s[e.cellIndex] = e.style.textAlign, "" == e.style.textAlign && (s[e.cellIndex] = null)
                    }), e.set("align", s);
                    break;
                case e.TYPE.table_row:
                    e.set("header", t.closest("thead").length > 0);
                    break;
                case e.TYPE.html_block:
                    e.set("text", t.text()), e.set("style", t.attr("data-tag"))
            }
        }, r.reverse = function (e, t, n, i) {
            if (e.length && e[0].hasAttribute("mdtype")) {
                var o, a, s = new r({in: t});
                return r.reverseAttrFromElem(s, e, n, i), s.get("type") == s.TYPE.table ? (e.find("tr[mdtype]").toArray().map(function (e) {
                    (a = r.reverse($(e), t, n)).set("parent", s), a.set("before", o), o = a
                }), r.TableEdit.valify(s)) : s.get("type") == s.TYPE.table_row ? e.children().children("span[mdtype]").toArray().map(function (e) {
                    (a = r.reverse($(e), t, n)).set("parent", s), a.set("before", o), o = a
                }) : e.children("[mdtype]").toArray().map(function (e) {
                    (a = r.reverse($(e), t, n)).set("parent", s), a.set("before", o), o = a
                }), s
            }
        }, r.prototype.downStream = function (e) {
            var t = new r({
                type: e,
                parent: this.get("parent"),
                before: this.get("before"),
                after: this.get("after"),
                in: this.get("in"),
                attachTo: this.get("attachTo")
            });
            this.set("parent", t)
        }, r.prototype.upStream = function (e, t) {
            var n, i = this.get("parent"), a = {};
            if (a.command = t || s.makeEmptyCommand(), i) if (!r.isType(i, o.list_item) || this.get("before") || this.get("after")) {
                a.command.undo.push(s.buildReplaceUndo(i)), a.oldCid = i.id;
                var l = this.get("after"), c = this.get("before"), d = i.get("type") == o.list_item;
                if (this.set("parent", i.get("parent")), i.get("parent") || this.set("attachTo", this.get("in")), this.get("type") !== o.table && (this.get("type") == o.list_item && (this.set("type", o.paragraph), this.set("text", ""), this.clearChildren(), a.nextFocus = this.cid), i.get("type") == o.list_item)) {
                    this.set("type", i.get("type")), this.set("style", i.get("style"));
                    var u = new r({type: o.paragraph, in: this.get("in")});
                    u.clearChildren(), u.set("parent", this), r.normalizeNode(u)
                }
                if (a.newHtml = this.toHTML(), l) if (l.set("before", this.canContainBlock(!1) ? this.getFirstChild() : null), d) {
                    do {
                        l.set("parent", this), l = l.get("after")
                    } while (l);
                    a.newHtml = this.toHTML()
                } else {
                    n = i.clone();
                    do {
                        l.set("parent", n), l = l.get("after")
                    } while (l);
                    a.newHtml += n.toHTML()
                }
                c ? (a.command.redo.push(s.buildReplaceUndo(i)), i.insert(this), s.addUndoForInsert(a.command, this), a.newHtml = i.toHTML() + a.newHtml) : (i.insert(this, !0), s.addUndoForInsert(a.command, this), s.addUndoForRemove(a.command, i), i.remove()), n && (this.insert(n), s.addUndoForInsert(a.command, n))
            } else {
                var h = s.buildReplaceUndo(i);
                this.giveChildrenTo(i), this.remove(), (a = i.upStream()).command.undo.unshift(h), a.nextFocus = a.nextFocus || i.id
            }
            return a
        }, r.prototype.attr = function (e, t, n, i) {
            function s(i, r) {
                var o = n.undo.UndoManager.makeEmptyCommand();
                return o.undo.push({
                    type: "attr",
                    id: i.id,
                    key: e,
                    value: r || i.safeGetStrAttr(e)
                }), o.redo.push({type: "attr", key: e, id: i.id, value: t}), o
            }

            if (this.get(e) != t) {
                i || (n.store(), n.undo.completeSnap(!0));
                var c = s(this);
                switch (i || "align_idx" == e || n.undo.register(c), t = "string" == typeof t ? a.escape(t) : t, e) {
                    case"tagBefore":
                    case"tagAfter":
                        (u = n.mathBlock.currentCm) && u.cid == this.cid || n.mathBlock.startEditing(this.cid), this.set(e, t);
                        var d = $("[cid='" + this.id + "'] .md-rawblock-" + ("tagBefore" == e ? "before" : "after") + " .ty-input").text(t || "").focus();
                        n.selection.selectAllElem(d);
                        break;
                    case"lang":
                        var u;
                        if (!(u = n.fences.getCm(this.id))) {
                            Reporter.error("failed to get CodeMirror for " + this.id);
                            break
                        }
                        var h = $("[cid='" + this.id + "']");
                        if (u.options.mode == t) break;
                        l.isDiagramType(u.options.mode) && n.diagrams.cancelDiagram(this.id), u.setOption("mode", getCodeMirrorMode(t));
                        var f = n.fences.getOptionsFromFencesAttr(t);
                        if (File.option.showLineNumbersForFence || (f.lineNumbers ? (u.setOption("lineNumbers", !0), h.addClass("md-fences-with-lineno")) : h.removeClass("md-fences-with-lineno")), f.firstLineNumber && u.setOption("firstLineNumber", f.firstLineNumber), u.refresh(), this.set("lang", t), h.attr("lang", t).find(".CodeMirror").attr("lang", (t || "").toLowerCase()), i) {
                            var p = $("[cid='" + this.id + "'] .code-tooltip").show().find(".ty-input").text(t || "").focus();
                            n.selection.selectAllElem(p)
                        }
                        l.isDiagramType(t) && n.diagrams.updateDiagram(this.id);
                        break;
                    case"checked":
                        var m = document.querySelector("[cid='" + this.id + "']>input");
                        t ? (m.setAttribute("checked", "checked"), m.parentElement.classList.remove("task-list-not-done"), m.parentElement.classList.add("task-list-done")) : (m.removeAttribute("checked"), m.parentElement.classList.remove("task-list-done"), m.parentElement.classList.add("task-list-not-done")), m.checked = t || !1, this.set("checked", t || !1);
                        break;
                    case"href-title":
                        if (this.get("type") == o.image) {
                            var g = t.split(/\s/);
                            if (n.findElemById(this.id).find("img").attr("src", g[0]), this.set("href", g[0]), this.set("title", g[1]), i) {
                                (d = $("[cid='" + this.id + "']")).hasClass("onfocus") || (d.addClass("onfocus").focus(), n.EditHelper.showTooltipForImage(n, d), $("[cid='" + this.id + "'] input.t-bracket-input").val(t || "").focus())
                            }
                        }
                        break;
                    case"alt":
                        if (this.get("type") == o.image && (n.findElemById(this.id).find("img").attr("alt", t), this.set("alt", t), i)) {
                            (d = $("[cid='" + this.id + "']")).hasClass("onfocus") || (d.addClass("onfocus").focus(), n.EditHelper.showTooltipForImage(n, d), $("[cid='" + this.id + "'] input.t-alt-input").val(t || "").focus())
                        }
                        break;
                    case"align_idx":
                        if (this.get("type") == o.table) {
                            var v = t[0], y = t[1], b = t[2];
                            d = n.findElemById(this.id), c = s(this, [v, this.get("align")[v]]);
                            if (i || ((b = r.adjustAlignText(this, v, y)) && (c.undo.last().value.push(this.get("alignText")[v]), c.redo.last().value.push(b)), n.undo.register(c)), this.get("alignText") && (this.get("alignText")[v] = b), this.get("align")[v] = y, y = y || "", d.find("tbody>tr>td:nth-child(" + (v + 1) + ")").css("text-align", y), d.find("thead>tr>th:nth-child(" + (v + 1) + ")").css("text-align", y), i) n.tableEdit.showTableEdit(d); else {
                                var w = d.find(".md-align-gp[data-col='" + v + "']");
                                w.find("button").removeClass("active").blur(), w.find(".md-align-" + y).addClass("active").focus()
                            }
                        }
                }
                return c
            }
        }, r.adjustAlignText = function (e, t, n) {
            if (e.get("alignText")) {
                var i = e.get("alignText")[t];
                if (i) return i = "left" == n || "center" == n ? (i = i.replace(/(^\s*)-/, "$1:")).replace(/(^\s*):(\s*$)/, "$1:-$2") : i.replace(/(^\s*):/, "$1-"), i = "right" == n || "center" == n ? (i = i.replace(/-(\s*$)/, ":$1")).replace(/(^\s*):(\s*$)/, "$1-:$2") : i.replace(/:(\s*$)/, "-$1"), /^\s*::\s*$/.exec(i) && (i = i.replace("::", ":-:")), i
            }
        }, r.tryResetTable = function (e) {
            e && !e.isDeleted() && e.get("type") == o.table && e.get("userText") && e.set("userText", void 0)
        }, r.prototype.unwrap = function (e) {
            var t = [], n = this.getFirstChild();
            do {
                var r = n.get("after");
                n.set("parent", this.get("parent")), n.set("attachTo", this.get("attachTo")), n.get("before") || n.set("before", this.get("before")), n.get("after") || n.set("after", this.get("after")), t.push(n), n.get("pattern") && n.set("pattern", n.get("pattern").replace(/^\s+/, "")), n = r
            } while (n);
            return this.remove(!0), e && e.findElemById(this.cid).replaceWith(i.NodeCollectionUtils.toHTML(t)), t
        }, r.prototype.wrap = function (e, t, n, i) {
            for (var r, o = e, a = [], s = {
                parent: e.get("parent"),
                before: e.get("before"),
                after: t ? t.get("after") : e.get("after")
            }; o && o != s.after;) n && n.findElemById(o.id).remove(), r = o, o = o.get("after"), this.append(r);
            s.after && (s.after.insert(this, !0), i || (a = n.findElemById(s.after.id)).before(this.toHTML())), !a.length && s.before && (s.before.insert(this, !1), i || (a = n.findElemById(s.before.id)).after(this.toHTML())), a.length || (s.parent ? (this.set("parent", s.parent), !i && n && n.findElemById(s.parent.id).html(this.toHTML())) : i || 0 !== $(n.sessionStr).children().length || (this.set("attachTo", this.get("in")), n && ($(n.sessionStr).html(this.toHTML()), n.focusCid = null)))
        }
    }), $__System.registerDynamic("1d", ["1e"], !0, function (e, t, n) {
        "use strict";
        this || self;
        !function (e) {
            e.defineOption("styleSelectedText", !1, function (i, r, o) {
                var a = o && o != e.Init;
                r && !a ? (i.state.markedSelection = [], i.state.markedSelectionStyle = "string" == typeof r ? r : "CodeMirror-selectedtext", l(i), i.on("cursorActivity", t), i.on("change", n)) : !r && a && (i.off("cursorActivity", t), i.off("change", n), s(i), i.state.markedSelection = i.state.markedSelectionStyle = null)
            });

            function t(e) {
                e.state.markedSelection && e.operation(function () {
                    !function (e) {
                        if (!e.somethingSelected()) return s(e);
                        if (e.listSelections().length > 1) return l(e);
                        var t = e.getCursor("start"), n = e.getCursor("end"), r = e.state.markedSelection;
                        if (!r.length) return a(e, t, n);
                        var c = r[0].find(), d = r[r.length - 1].find();
                        if (!c || !d || n.line - t.line < i || o(t, d.to) >= 0 || o(n, c.from) <= 0) return l(e);
                        for (; o(t, c.from) > 0;) r.shift().clear(), c = r[0].find();
                        o(t, c.from) < 0 && (c.to.line - t.line < i ? (r.shift().clear(), a(e, t, c.to, 0)) : a(e, t, c.from, 0));
                        for (; o(n, d.to) < 0;) r.pop().clear(), d = r[r.length - 1].find();
                        o(n, d.to) > 0 && (n.line - d.from.line < i ? (r.pop().clear(), a(e, d.from, n)) : a(e, d.to, n))
                    }(e)
                })
            }

            function n(e) {
                e.state.markedSelection && e.state.markedSelection.length && e.operation(function () {
                    s(e)
                })
            }

            var i = 8, r = e.Pos, o = e.cmpPos;

            function a(e, t, n, a) {
                if (0 != o(t, n)) for (var s = e.state.markedSelection, l = e.state.markedSelectionStyle, c = t.line; ;) {
                    var d = c == t.line ? t : r(c, 0), u = c + i, h = u >= n.line, f = h ? n : r(u, 0),
                        p = e.markText(d, f, {className: l});
                    if (null == a ? s.push(p) : s.splice(a++, 0, p), h) break;
                    c = u
                }
            }

            function s(e) {
                for (var t = e.state.markedSelection, n = 0; n < t.length; ++n) t[n].clear();
                t.length = 0
            }

            function l(e) {
                s(e);
                for (var t = e.listSelections(), n = 0; n < t.length; n++) a(e, t[n].from(), t[n].to())
            }
        }(e("1e"))
    }), $__System.registerDynamic("1f", ["1e"], !0, function (e, t, n) {
        this || self;
        !function (e) {
            var t = {pairs: "()[]{}''\"\"", triples: "", explode: "[]{}"}, n = e.Pos;
            e.defineOption("autoCloseBrackets", !1, function (t, n, i) {
                i && i != e.Init && (t.removeKeyMap(o), t.state.closeBrackets = null), n && (t.state.closeBrackets = n, t.addKeyMap(o))
            });

            function i(e, n) {
                return "pairs" == n && "string" == typeof e ? e : "object" == typeof e && null != e[n] ? e[n] : t[n]
            }

            for (var r = t.pairs + "`", o = {
                Backspace: function (t) {
                    var r = l(t);
                    if (!r || t.getOption("disableInput")) return e.Pass;
                    for (var o = i(r, "pairs"), a = t.listSelections(), s = 0; s < a.length; s++) {
                        if (!a[s].empty()) return e.Pass;
                        var c = u(t, a[s].head);
                        if (!c || o.indexOf(c) % 2 != 0) return e.Pass
                    }
                    for (var s = a.length - 1; s >= 0; s--) {
                        var d = a[s].head;
                        t.replaceRange("", n(d.line, d.ch - 1), n(d.line, d.ch + 1), "+delete")
                    }
                }, Enter: function (t) {
                    var n = l(t), r = n && i(n, "explode");
                    if (!r || t.getOption("disableInput")) return e.Pass;
                    for (var o = t.listSelections(), a = 0; a < o.length; a++) {
                        if (!o[a].empty()) return e.Pass;
                        var s = u(t, o[a].head);
                        if (!s || r.indexOf(s) % 2 != 0) return e.Pass
                    }
                    if (t.getModeAt(t.getCursor()).indent || t.getMode().indent) return t.operation(function () {
                        t.replaceSelection("\n", null), t.execCommand("goCharLeft");
                        for (var e = 0; e < o.length; e++) {
                            var n = o[e].head.line;
                            t.indentLine(n, null, !0), t.indentLine(n + 1, null, !0)
                        }
                    }), e.Pass;
                    t.operation(function () {
                        t.replaceSelection("\n\n", null), t.execCommand("goCharLeft"), o = t.listSelections();
                        for (var e = 0; e < o.length; e++) {
                            var n = o[e].head.line;
                            t.indentLine(n, null, !0), t.indentLine(n + 1, null, !0), t.indentLine(n, "add", !0)
                        }
                    })
                }
            }, a = 0; a < r.length; a++) o["'" + r.charAt(a) + "'"] = s(r.charAt(a));

            function s(t) {
                return function (r) {
                    return function (t, r) {
                        var o = l(t);
                        if (!o || t.getOption("disableInput")) return e.Pass;
                        var a = i(o, "pairs"), s = a.indexOf(r);
                        if (-1 == s) return e.Pass;
                        for (var u, p = i(o, "triples"), m = a.charAt(s + 1) == r, g = t.listSelections(), v = s % 2 == 0, y = 0; y < g.length; y++) {
                            var b, w = g[y], C = w.head, x = t.getRange(C, n(C.line, C.ch + 1));
                            if (v && !w.empty()) b = "surround"; else if (!m && v || x != r) if (m && C.ch > 1 && p.indexOf(r) >= 0 && t.getRange(n(C.line, C.ch - 2), C) == r + r && (C.ch <= 2 || t.getRange(n(C.line, C.ch - 3), n(C.line, C.ch - 2)) != r)) b = "addFour"; else if (m) {
                                if (e.isWordChar(x) || !h(t, C, r)) return e.Pass;
                                b = "both"
                            } else {
                                if (!v || t.getLine(C.line).length != C.ch && !d(x, a) && !/\s/.test(x)) return e.Pass;
                                b = "both"
                            } else b = m && f(t, C) ? "both" : p.indexOf(r) >= 0 && t.getRange(C, n(C.line, C.ch + 3)) == r + r + r ? "skipThree" : "skip";
                            if (u) {
                                if (u != b) return e.Pass
                            } else u = b
                        }
                        var k = s % 2 ? a.charAt(s - 1) : r, S = s % 2 ? r : a.charAt(s + 1);
                        t.operation(function () {
                            if ("skip" == u) t.execCommand("goCharRight"); else if ("skipThree" == u) for (var e = 0; e < 3; e++) t.execCommand("goCharRight"); else if ("surround" == u) {
                                for (var n = t.getSelections(), e = 0; e < n.length; e++) n[e] = k + n[e] + S;
                                t.replaceSelections(n, "around"), n = t.listSelections().slice();
                                for (var e = 0; e < n.length; e++) n[e] = c(n[e]);
                                t.setSelections(n)
                            } else "both" == u ? (t.replaceSelection(k + S, null), t.triggerElectric(k + S), t.execCommand("goCharLeft")) : "addFour" == u && (t.replaceSelection(k + k + k + k, "before"), t.execCommand("goCharRight"))
                        })
                    }(r, t)
                }
            }

            function l(e) {
                var t = e.state.closeBrackets;
                if (!t || t.override) return t;
                return e.getModeAt(e.getCursor()).closeBrackets || t
            }

            function c(t) {
                var i = e.cmpPos(t.anchor, t.head) > 0;
                return {
                    anchor: new n(t.anchor.line, t.anchor.ch + (i ? -1 : 1)),
                    head: new n(t.head.line, t.head.ch + (i ? 1 : -1))
                }
            }

            function d(e, t) {
                var n = t.lastIndexOf(e);
                return n > -1 && n % 2 == 1
            }

            function u(e, t) {
                var i = e.getRange(n(t.line, t.ch - 1), n(t.line, t.ch + 1));
                return 2 == i.length ? i : null
            }

            function h(t, n, i) {
                var r = t.getLine(n.line), o = t.getTokenAt(n);
                if (/\bstring2?\b/.test(o.type) || f(t, n)) return !1;
                var a = new e.StringStream(r.slice(0, n.ch) + i + r.slice(n.ch), 4);
                for (a.pos = a.start = o.start; ;) {
                    var s = t.getMode().token(a, o.state);
                    if (a.pos >= n.ch + 1) return /\bstring2?\b/.test(s);
                    a.start = a.pos
                }
            }

            function f(e, t) {
                var i = e.getTokenAt(n(t.line, t.ch + 1));
                return /\bstring/.test(i.type) && i.start == t.ch
            }
        }(e("1e"))
    }), $__System.registerDynamic("20", ["1e"], !0, function (e, t, n) {
        this || self;
        var i = e("1e");
        !function () {
            i.defineOption("autoCloseTags", !1, function (a, s, l) {
                if (l != i.Init && l && a.removeKeyMap("autoCloseTags"), s) {
                    var c = {name: "autoCloseTags"};
                    ("object" != typeof s || s.whenClosing) && (c["'/'"] = function (e) {
                        return (t = e).getOption("disableInput") ? i.Pass : n(t, !0);
                        var t
                    }), ("object" != typeof s || s.whenOpening) && (c["'>'"] = function (n) {
                        return function (n) {
                            if (n.getOption("disableInput")) return i.Pass;
                            for (var a = n.listSelections(), s = [], l = 0; l < a.length; l++) {
                                if (!a[l].empty()) return i.Pass;
                                var c = a[l].head, d = n.getTokenAt(c), u = i.innerMode(n.getMode(), d.state),
                                    h = u.state;
                                if ("xml" != u.mode.name || !h.tagName) return i.Pass;
                                var f = n.getOption("autoCloseTags"), p = "html" == u.mode.configuration,
                                    m = "object" == typeof f && f.dontCloseTags || p && e,
                                    g = "object" == typeof f && f.indentTags || p && t, v = h.tagName;
                                d.end > c.ch && (v = v.slice(0, v.length - d.end + c.ch));
                                var y = v.toLowerCase();
                                if (!v || "string" == d.type && (d.end != c.ch || !/[\"\']/.test(d.string.charAt(d.string.length - 1)) || 1 == d.string.length) || "tag" == d.type && "closeTag" == h.type || d.string.indexOf("/") == d.string.length - 1 || m && r(m, y) > -1 || o(n, v, c, h, !0)) return i.Pass;
                                var b = g && r(g, y) > -1;
                                s[l] = {
                                    indent: b,
                                    text: ">" + (b ? "\n\n" : "") + "</" + v + ">",
                                    newPos: b ? i.Pos(c.line + 1, 0) : i.Pos(c.line, c.ch + 1)
                                }
                            }
                            for (var l = a.length - 1; l >= 0; l--) {
                                var w = s[l];
                                n.replaceRange(w.text, a[l].head, a[l].anchor, "+insert");
                                var C = n.listSelections().slice(0);
                                C[l] = {
                                    head: w.newPos,
                                    anchor: w.newPos
                                }, n.setSelections(C), w.indent && (n.indentLine(w.newPos.line, null, !0), n.indentLine(w.newPos.line + 1, null, !0))
                            }
                        }(n)
                    }), a.addKeyMap(c)
                }
            });
            var e = ["area", "base", "br", "col", "command", "embed", "hr", "img", "input", "keygen", "link", "meta", "param", "source", "track", "wbr"],
                t = ["applet", "blockquote", "body", "button", "div", "dl", "fieldset", "form", "frameset", "h1", "h2", "h3", "h4", "h5", "h6", "head", "html", "iframe", "layer", "legend", "object", "ol", "p", "select", "table", "ul"];

            function n(e, t) {
                for (var n = e.listSelections(), r = [], a = t ? "/" : "</", s = 0; s < n.length; s++) {
                    if (!n[s].empty()) return i.Pass;
                    var l = n[s].head, c = e.getTokenAt(l), d = i.innerMode(e.getMode(), c.state), u = d.state;
                    if (t && ("string" == c.type || "<" != c.string.charAt(0) || c.start != l.ch - 1)) return i.Pass;
                    var h;
                    if ("xml" != d.mode.name) if ("htmlmixed" == e.getMode().name && "javascript" == d.mode.name) h = a + "script"; else {
                        if ("htmlmixed" != e.getMode().name || "css" != d.mode.name) return i.Pass;
                        h = a + "style"
                    } else {
                        if (!u.context || !u.context.tagName || o(e, u.context.tagName, l, u)) return i.Pass;
                        h = a + u.context.tagName
                    }
                    ">" != e.getLine(l.line).charAt(c.end) && (h += ">"), r[s] = h
                }
                e.replaceSelections(r), n = e.listSelections();
                for (s = 0; s < n.length; s++) (s == n.length - 1 || n[s].head.line < n[s + 1].head.line) && e.indentLine(n[s].head.line)
            }

            i.commands.closeTag = function (e) {
                return n(e)
            };

            function r(e, t) {
                if (e.indexOf) return e.indexOf(t);
                for (var n = 0, i = e.length; n < i; ++n) if (e[n] == t) return n;
                return -1
            }

            function o(e, t, n, r, o) {
                if (!i.scanForClosingTag) return !1;
                var a = Math.min(e.lastLine() + 1, n.line + 500), s = i.scanForClosingTag(e, n, null, a);
                if (!s || s.tag != t) return !1;
                for (var l = r.context, c = o ? 1 : 0; l && l.tagName == t; l = l.prev) ++c;
                n = s.to;
                for (var d = 1; d < c; d++) {
                    var u = i.scanForClosingTag(e, n, null, a);
                    if (!u || u.tag != t) return !1;
                    n = u.to
                }
                return !0
            }
        }()
    }), $__System.registerDynamic("21", ["1e"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i = e("1e");
        i.overlayMode = function (e, t, n) {
            return {
                startState: function () {
                    return {
                        base: i.startState(e),
                        overlay: i.startState(t),
                        basePos: 0,
                        baseCur: null,
                        overlayPos: 0,
                        overlayCur: null,
                        streamSeen: null
                    }
                }, copyState: function (n) {
                    return {
                        base: i.copyState(e, n.base),
                        overlay: i.copyState(t, n.overlay),
                        basePos: n.basePos,
                        baseCur: null,
                        overlayPos: n.overlayPos,
                        overlayCur: null
                    }
                }, token: function (i, r) {
                    return (i != r.streamSeen || Math.min(r.basePos, r.overlayPos) < i.start) && (r.streamSeen = i, r.basePos = r.overlayPos = i.start), i.start == r.basePos && (r.base.lineBefore = r.lineBefore, r.base.lineAfter = r.lineAfter, r.baseCur = e.token(i, r.base), r.basePos = i.pos), i.start == r.overlayPos && (i.pos = i.start, r.overlayCur = t.token(i, r.overlay), r.overlayPos = i.pos), i.pos = Math.min(r.basePos, r.overlayPos), null == r.overlayCur ? r.baseCur : null != r.baseCur && r.overlay.combineTokens || n && null == r.overlay.combineTokens ? r.baseCur + " " + r.overlayCur : r.overlayCur
                }, indent: e.indent && function (t, n) {
                    return e.indent(t.base, n)
                }, electricChars: e.electricChars, innerMode: function (t) {
                    return {state: t.base, mode: e}
                }, blankLine: function (i) {
                    var r, o;
                    return e.blankLine && (r = e.blankLine(i.base)), t.blankLine && (o = t.blankLine(i.overlay)), null == o ? r : n && null != r ? r + " " + o : o
                }
            }
        }
    }), $__System.registerDynamic("22", ["1e"], !0, function (e, t, n) {
        this || self;
        var i = e("1e"), r = "CodeMirror-lint-markers";

        function o(e) {
            e.parentNode && e.parentNode.removeChild(e)
        }

        function a(e, t, n) {
            var r = function (e, t) {
                var n = document.createElement("div");
                n.className = "CodeMirror-lint-tooltip", n.appendChild(t.cloneNode(!0)), document.body.appendChild(n);

                function r(e) {
                    if (!n.parentNode) return i.off(document, "mousemove", r);
                    n.style.top = Math.max(0, e.clientY - n.offsetHeight - 5) + "px", n.style.left = e.clientX + 5 + "px"
                }

                return i.on(document, "mousemove", r), r(e), null != n.style.opacity && (n.style.opacity = 1), n
            }(e, t);

            function a() {
                i.off(n, "mouseout", a), r && ((e = r).parentNode && (null == e.style.opacity && o(e), e.style.opacity = 0, setTimeout(function () {
                    o(e)
                }, 600)), r = null);
                var e
            }

            var s = setInterval(function () {
                if (r) for (var e = n; ; e = e.parentNode) {
                    if (e && 11 == e.nodeType && (e = e.host), e == document.body) return;
                    if (!e) {
                        a();
                        break
                    }
                }
                if (!r) return clearInterval(s)
            }, 400);
            i.on(n, "mouseout", a)
        }

        function s(e, t, n) {
            this.marked = [], this.options = t, this.timeout = null, this.hasGutter = n, this.onMouseOver = function (t) {
                !function (e, t) {
                    var n = t.target || t.srcElement;
                    if (!/\bCodeMirror-lint-mark-/.test(n.className)) return;
                    for (var i = n.getBoundingClientRect(), r = (i.left + i.right) / 2, o = (i.top + i.bottom) / 2, s = e.findMarksAt(e.coordsChar({
                        left: r,
                        top: o
                    }, "client")), l = [], c = 0; c < s.length; ++c) {
                        var u = s[c].__annotation;
                        u && l.push(u)
                    }
                    l.length && function (e, t) {
                        for (var n = t.target || t.srcElement, i = document.createDocumentFragment(), r = 0; r < e.length; r++) {
                            var o = e[r];
                            i.appendChild(d(o))
                        }
                        a(t, i, n)
                    }(l, t)
                }(e, t)
            }, this.waitingFor = 0
        }

        function l(e) {
            var t = e.state.lint;
            t.hasGutter && e.clearGutter(r);
            for (var n = 0; n < t.marked.length; ++n) t.marked[n].clear();
            t.marked.length = 0
        }

        function c(e, t, n, r) {
            var o = document.createElement("div"), s = o;
            return o.className = "CodeMirror-lint-marker-" + t, n && ((s = o.appendChild(document.createElement("div"))).className = "CodeMirror-lint-marker-multiple"), 0 != r && i.on(s, "mouseover", function (t) {
                a(t, e, s)
            }), o
        }

        function d(e) {
            var t = e.severity;
            t || (t = "error");
            var n = document.createElement("div");
            return n.className = "CodeMirror-lint-message-" + t, n.appendChild(document.createTextNode(e.message)), n
        }

        function u(e) {
            var t = e.state.lint.options, n = t.options || t, r = t.getAnnotations || e.getHelper(i.Pos(0, 0), "lint");
            if (r) if (t.async || r.async) !function (e, t, n) {
                var r = e.state.lint, o = ++r.waitingFor;

                function a() {
                    o = -1, e.off("change", a)
                }

                e.on("change", a), t(e.getValue(), function (t, n) {
                    e.off("change", a), r.waitingFor == o && (n && t instanceof i && (t = n), h(e, t))
                }, n, e)
            }(e, r, n); else {
                var o = r(e.getValue(), n, e);
                if (!o) return;
                o.then ? o.then(function (t) {
                    h(e, t)
                }) : h(e, o)
            }
        }

        function h(e, t) {
            l(e);
            for (var n = e.state.lint, i = n.options, o = function (e) {
                for (var t = [], n = 0; n < e.length; ++n) {
                    var i = e[n], r = i.from.line;
                    (t[r] || (t[r] = [])).push(i)
                }
                return t
            }(t), a = 0; a < o.length; ++a) {
                var s = o[a];
                if (s) {
                    for (var u = null, h = n.hasGutter && document.createDocumentFragment(), f = 0; f < s.length; ++f) {
                        var p = s[f], m = p.severity;
                        m || (m = "error"), u = "error" == (g = u) ? g : m, i.formatAnnotation && (p = i.formatAnnotation(p)), n.hasGutter && h.appendChild(d(p)), p.to && n.marked.push(e.markText(p.from, p.to, {
                            className: "CodeMirror-lint-mark-" + m,
                            __annotation: p
                        }))
                    }
                    n.hasGutter && e.setGutterMarker(a, r, c(h, u, s.length > 1, n.options.tooltips))
                }
            }
            var g;
            i.onUpdateLinting && i.onUpdateLinting(t, o, e)
        }

        function f(e) {
            var t = e.state.lint;
            t && (clearTimeout(t.timeout), t.timeout = setTimeout(function () {
                u(e)
            }, t.options.delay || 500))
        }

        i.defineOption("lint", !1, function (e, t, n) {
            if (n && n != i.Init && (l(e), !1 !== e.state.lint.options.lintOnChange && e.off("change", f), i.off(e.getWrapperElement(), "mouseover", e.state.lint.onMouseOver), clearTimeout(e.state.lint.timeout), delete e.state.lint), t) {
                for (var o = e.getOption("gutters"), a = !1, c = 0; c < o.length; ++c) o[c] == r && (a = !0);
                var d = e.state.lint = new s(e, (h = t, h instanceof Function ? {getAnnotations: h} : (h && !0 !== h || (h = {}), h)), a);
                !1 !== d.options.lintOnChange && e.on("change", f), 0 != d.options.tooltips && "gutter" != d.options.tooltips && i.on(e.getWrapperElement(), "mouseover", d.onMouseOver), u(e)
            }
            var h
        }), i.defineExtension("performLint", function () {
            this.state.lint && u(this)
        }), i.clearMarks = l, i.updateLinting = h
    }), $__System.registerDynamic("23", ["1e", "13", "e", "11", "24", "12", "25", "1a", "15", "1d", "1f", "20", "21", "22"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i = e("1e"), r = e("13"), o = e("e"), a = e("11"), s = e("24"), l = e("12"), c = e("25"),
            d = (e("1a"), e("15")), u = c.map;
        Node = l.Node;
        var h = i.prototype.focus;
        i.prototype.focus = function () {
            i.signal(this, "focus", this), h.apply(this)
        };
        e("1d"), e("1f"), e("20"), e("21"), e("22");
        var f = ["js", "javascript", "java", "json", "typescript", "clojure", "coffeescript", "css", "less", "scss", "gfm", "markdown", "xaml", "xml", "haskell", "html", "lua", "lisp", "commonlisp", "pascal", "perl", "php", "php+HTML", "python", "cython", "ruby", "shell", "sh", "sql", "sqlite", "mssql", "mysql", "CQL", "mariadb", "cassandra", "plsql", "tiddlywiki", "wiki", "vb", "basic", "visual basic", "vbscript", "velocity", "verilog", "xquery", "yaml", "go", "groovy", "nginx", "octave", "c", "clike", "c++", "cpp", "objc", "objective-c", "csharp", "c#", "squirrel", "ceylon", "kotlin", "tex", "latex", "swift", "scala", "R", "D", "diff", "erlang", "http", "jade", "rst", "rust", "jinja2", "reStructuredText", "asp", "jsp", "erb", "ejs", "embeddedjs", "powershell", "dockerfile", "jsx", "tsx", "react", "vue", "nsis", "mathematica", "tiki wiki", "properties", "ini", "livescript", "assembly", "gas", "toml", "matlab", "ocaml", "F#", "fsharp", "elm", "pgp", "asciiarmor", "spreadsheet", "elixir", "cmake", "cypher", "dart", "django", "dtd", "xml-dtd", "dylan", "handlebars", "idl", "web-idl", "yacas", "mbox", "vhdl", "julia", "haxe", "hxml", "fortran", "protobuf", "makefile", "tcl", "scheme", "twig", "bash", "SAS", "pseudocode", "stylus"];
        !function (e) {
            var t = e.commands.delLineLeft;
            e.commands.delLineLeft = function (n) {
                try {
                    return 0 == n.getCursor().ch ? e.commands.delCharBefore(n) : t(n)
                } catch (e) {
                }
            }
        }(i);
        var p = function (e, t) {
            var n = [];
            return f.map(function (t) {
                0 == t.toLowerCase().indexOf(e.toLowerCase()) && n.push(t)
            }), n.sort(), n.length < 4 && f.map(function (t) {
                t.toLowerCase().indexOf(e.toLowerCase()) > 0 && n.push(t)
            }), t && 1 == n.length && n[0] == e ? [] : n
        };

        function m(e, t) {
            if (e) switch (e) {
                case"javascript":
                case"text/javascript":
                case"js":
                    return e = "javascript";
                case"json":
                    return t ? e : e = {name: "javascript", json: !0};
                case"jsonld":
                case"json-ld":
                    return t ? e : "application/ld+json";
                case"text/typescript":
                case"typescript":
                case"ts":
                    return t ? "typescript" : e = {name: "javascript", typescript: !0};
                case"clojure":
                    return e;
                case"coffee":
                case"coffeescript":
                case"css":
                    return e;
                case"less":
                    return t ? "less" : "text/x-less";
                case"scss":
                    return t ? "scss" : e = "text/x-scss";
                case"gfm":
                case"github flavored markdown":
                    return e = "gfm";
                case"markdown":
                case"md":
                case"mkd":
                    return e;
                case"xml":
                case"xaml":
                case"mjml":
                case"xul":
                case"enml":
                    return t ? e : "xml";
                case"haskell":
                    return e;
                case"htmlmixed":
                case"html":
                case"xhtml":
                case"svg":
                case"epub":
                    return t ? /^html/.exec(e) ? "html" : e : e = "htmlmixed";
                case"lua":
                    return e;
                case"lisp":
                case"commonlisp":
                case"common lisp":
                    return e = "commonlisp";
                case"pascal":
                case"perl":
                    return e;
                case"php+html":
                    return t ? "php" : "application/x-httpd-php";
                case"php":
                case"php3":
                case"php4":
                case"php5":
                case"php6":
                    return t ? e : "text/x-php";
                case"cython":
                    return t ? e : e = "text/x-cython";
                case"python":
                    return t ? e : e = "text/x-python";
                case"ruby":
                    return e;
                case"shell":
                case"sh":
                case"zsh":
                case"bash":
                    return e = "shell";
                case"sql":
                case"sql lite":
                case"sqlite":
                    return t ? e : e = "text/x-sql";
                case"mssql":
                    return t ? e : e = "text/x-mssql";
                case"mysql":
                    return t ? e : e = "text/x-mysql";
                case"mariadb":
                    return t ? e : e = "text/x-mariadb";
                case"cassandra":
                case"cql":
                    return t ? e : e = "text/x-cassandra";
                case"plsql":
                    return t ? e : e = "text/x-plsql";
                case"stex":
                case"tex":
                case"latex":
                    return t ? e : "text/x-stex";
                case"tiddlywiki":
                case"wiki":
                    return t ? e : e = "tiddlywiki";
                case"vb":
                case"visual basic":
                case"visualbasic":
                case"basic":
                    return t ? e : e = "vb";
                case"vbscript":
                case"velocity":
                    return e;
                case"verilog":
                    return t ? e : e = "text/x-verilog";
                case"xquery":
                    return e;
                case"yaml":
                case"yml":
                    return t ? e : "yaml";
                case"go":
                case"groovy":
                case"nginx":
                    return e;
                case"octave":
                case"matlab":
                    return t ? e : "text/x-octave";
                case"c":
                case"clike":
                case"csrc":
                    return t ? e : e = "text/x-csrc";
                case"c++":
                case"c++src":
                case"cpp":
                case"cc":
                case"hpp":
                case"h++":
                case"h":
                    return t ? e : e = "text/x-c++src";
                case"obj-c":
                case"objc":
                case"objective c":
                case"objective-c":
                case"objectivec":
                    return t ? e : e = "text/x-objectivec";
                case"text/x-scala":
                case"scala":
                    return t ? e : e = "text/x-scala";
                case"csharp":
                case"c#":
                case"cs":
                    return t ? e : e = "text/x-csharp";
                case"java":
                    return t ? e : e = "text/x-java";
                case"squirrel":
                    return t ? e : e = "text/x-squirrel";
                case"ceylon":
                    return t ? e : e = "text/x-ceylon";
                case"kotlin":
                    return t ? e : e = "text/x-kotlin";
                case"swift":
                    return e = "swift";
                case"r":
                case"rlang":
                case"r-lang":
                    return t ? e : e = "text/x-rsrc";
                case"d":
                case"diff":
                case"erlang":
                case"http":
                case"jade":
                    return e;
                case"rst":
                case"restructuredtext":
                    return e = "rst";
                case"rust":
                case"jinja2":
                    return e;
                case"aspx":
                case"asp":
                case"asp.net":
                    return t ? e : e = "application/x-aspx";
                case"jsp":
                    return t ? e : e = "application/x-jsp";
                case"erb":
                    return t ? e : e = "application/x-erb";
                case"ejs":
                case"embeddedjs":
                case"embedded javaScript":
                    return t ? e : e = "application/x-ejs";
                case"powershell":
                case"bat":
                case"cmd":
                    return t ? e : "application/x-powershell";
                case"dockerfile":
                    return t ? e : "text/x-dockerfile";
                case"jsx":
                case"react":
                    return t ? e : "text/jsx";
                case"tsx":
                    return t ? e : "text/typescript-jsx";
                case"vue.js":
                case"vue":
                case"vue-template":
                    return t ? e : "script/x-vue";
                case"nsis":
                    return t ? e : "text/x-nsis";
                case"mathematica":
                    return t ? e : "text/x-mathematica";
                case"tiki":
                case"tiki wiki":
                case"tiki-wiki":
                case"tikiwiki":
                    return "tiki";
                case"properties":
                case"ini":
                    return t ? e : "text/x-properties";
                case"livescript":
                    return t ? e : "text/x-livescript";
                case"asm":
                case"assembly":
                case"nasm":
                case"gas":
                    return t ? e : "assembly";
                case"toml":
                    return t ? e : "text/x-toml";
                case"sequence":
                    return "sequence";
                case"flow":
                case"flowchart":
                    return "flow";
                case"mermaid":
                    return "mermaid";
                case"ocaml":
                    return t ? e : "text/x-ocaml";
                case"f#":
                case"fsharp":
                    return t ? e : "text/x-fsharp";
                case"elm":
                    return t ? e : "text/x-elm";
                case"pgp":
                case"pgp-keys":
                case"pgp-key":
                case"pgp-signature":
                case"asciiarmor":
                case"ascii-armor":
                case"ascii armor":
                    return t ? e : "application/pgp";
                case"spreadsheet":
                case"excel":
                    return t ? e : "text/x-spreadsheet";
                case"elixir":
                    return "elixir";
                case"cmake":
                    return t ? e : "text/x-cmake";
                case"cypher":
                case"cypher-query":
                    return t ? e : "application/x-cypher-query";
                case"dart":
                    return "dart";
                case"django":
                    return t ? e : "text/x-django";
                case"dtd":
                case"xml-dtd":
                case"xml dtd":
                case"xmldtd":
                    return t ? e : "application/xml-dtd";
                case"dylan":
                    return t ? e : "text/x-dylan";
                case"handlebars":
                    return t ? e : "text/x-handlebars-template";
                case"idl":
                    return t ? e : "text/x-idl";
                case"webidl":
                case"web-idl":
                case"web idl":
                    return t ? e : "text/x-webidl";
                case"yacas":
                    return t ? e : "text/x-yacas";
                case"mbox":
                    return t ? e : "application/mbox";
                case"vhdl":
                    return t ? e : "text/x-vhdl";
                case"julia":
                    return "julia";
                case"haxe":
                    return t ? e : "text/x-haxe";
                case"hxml":
                    return t ? e : "text/x-hxml";
                case"fortran":
                    return t ? e : "text/x-fortran";
                case"protobuf":
                    return t ? e : "text/x-protobuf";
                case"makefile":
                    return t ? e : "text/x-makefile";
                case"tcl":
                    return t ? e : "text/x-tcl";
                case"scheme":
                    return t ? e : "text/x-scheme";
                case"twig":
                    return t ? e : "text/x-twig";
                case"sas":
                    return t ? e : "text/x-sas";
                case"pseudocode":
                    return t ? e : "text/x-pseudocode";
                case"julia":
                case"text/x-julia":
                case"stylus":
                    return e;
                default:
                    return ""
            }
        }

        var g = function (e) {
            if (!e) return {};
            if ("{" != e[0] || "}" != e[e.length - 1]) return {};
            var t = e.replace(/(^{)|(}$)/g, "").split(/\s+/);
            if (!t || !t.length) return {};
            var n = {};
            return t.forEach(function (e) {
                var t;
                (t = /^[.]number((-?l)|L)ines/.exec(e)) ? n.lineNumbers = !0 : (t = /^startFrom=['"](\d+)['"]$/.exec(e)) && (n.firstLineNumber = t[1] - 0)
            }), n
        };
        window.getCodeMirrorMode = function (e, t, n) {
            var i = ((e = (e = e ? e.toLowerCase() : "").replace(/^\s*\.*lang(uage)*-/g, "").replace(/[{}]/g, "").trim()).split(/\s+/) || [e])[0],
                r = m(e, n);
            return r || e == i || (r = m(i.replace(/(^[.])|(,$)/g, ""), n)), r || (n ? i : t ? null : e)
        };
        var v = a.Model.extend({
            initialize: function (e) {
                var t = this;
                this.editor = e, this.queue = {}, this.cachedCharWidth, this.$container = o("#fences-auto-suggest"), this.editor.diagrams = new d(e), File.option.enableDiagram && (f = f.concat(d.MODES)), o(document).on("losefocus", ".md-fences", function () {
                    var e = o(this), n = t.queue[e.attr("cid")];
                    n && (t.syncToNode(this.getAttribute("cid")), n.doc.setCursor(0, 0, {scroll: !1}), e.find(".md-tooltip-hide").hide(), e[0].style.marginBottom = "")
                }).on("mousedown", ".autoComplt-list li", function (t) {
                    var n = o(".ty-input:focus");
                    return n.text(this.textContent), e.selection.jumpIntoElemEnd(n), !1
                }), this.lazyload(), this.editor.diagrams.lazyload()
            }, getOptionsFromFencesAttr: g, showAutoSuggest: function (e, t) {
                if (t.token === e) return !1;
                var n = p(e, !0), i = "";
                if (t.type = "fences", t.token = e, t.match = n, t.found = n.length, t.pageNo = 0, t.pageCnt = Math.floor((n.length - 1) / 5 + 1), !t.found) return this.$container.hide(), !1;
                for (var r = 0; r < n.length && r < 40; r++) r % 5 == 0 && (i += (r > 0 ? "</ul>" : "") + "<ul data-page='" + r / 5 + "' style='display:none'>"), i += "<li data-content='" + n[r] + "' > " + n[r] + "</span></li>";
                return i += "</ul>", this.$container.html(i), this.$container
            }, clickEventHandled: function (e, t) {
                var n, i, r;
                this.queue[t] || (r = window.scrollY, this.getCm(t), r -= window.scrollY, window.scrollBy(0, r), (n = document.elementFromPoint(e.clientX, e.clientY)) && (e.stopPropagation(), (i = document.createEvent("MouseEvents")).initMouseEvent("mousedown", !0, !0, n.ownerDocument.defaultView, 1, e.screenX, e.screenY, e.clientX, e.clientY, e.ctrlKey, e.altKey, e.shiftKey, e.metaKey, e.button), n.dispatchEvent(i)), this.editor.refocus(t))
            }, getCm: function (e) {
                if (this.queue[e]) {
                    if (o("[cid='" + e + "'] textarea").length) return this.queue[e];
                    delete this.queue[e]
                }
                if (!this.queue[e]) return this.addCodeBlock(e)
            }, getValue: function (e) {
                return this.queue[e] ? this.queue[e].getValue() : this.editor.findElemById(e).text()
            }, addCodeBlock: function (e) {
                var t = this.editor, n = this;

                function r(e, r) {
                    var o, a = r.which || r.keyCode, s = i.keyName(r), l = !r.metaKey && !r.shiftKey && !r.ctrlKey;
                    if ("Up" == i.keyNames[a]) {
                        if ((o = e.getCursor()) && 0 == o.line) {
                            if (l) return t.selection.moveUpOrDown(!0, r), r.codemirrorIgnore;
                            if (0 == o.ch && !r.shiftKey && (File.isNode && r.ctrlKey || File.isMac && r.metaKey)) return void(r.codemirrorIgnore = !0)
                        }
                        r.stopPropagation()
                    } else if ("Down" == i.keyNames[a]) {
                        if ((o = e.getCursor()) && o.line >= e.lineCount() - 1) {
                            if (l) return t.selection.moveUpOrDown(!1, r), r.codemirrorIgnore;
                            if (o.ch == e.doc.getLine(o.line).length && !r.shiftKey && (File.isNode && r.ctrlKey || File.isMac && r.metaKey)) return void(r.codemirrorIgnore = !0)
                        }
                        r.stopPropagation()
                    } else t.selection.clearGlobalColumn();
                    if ("Left" == i.keyNames[a]) {
                        if (e.getSelection().length > 0) return;
                        if ((o = e.doc.getCursor()) && !o.line && !o.ch && l) return t.selection.moveUpOrDown(!0, r), r.codemirrorIgnore;
                        r.stopPropagation()
                    } else if ("Right" == i.keyNames[a]) {
                        if (e.getSelection().length > 0) return;
                        if ((o = e.doc.getCursor()) && o.line >= e.lineCount() - 1 && o.ch >= e.doc.getLine(o.line).length && l) return t.selection.moveUpOrDown(!1, r), r.codemirrorIgnore;
                        r.stopPropagation()
                    } else if ("Backspace" == i.keyNames[a]) {
                        if ((o = e.doc.getCursor()) && e.lineCount() <= 1 && !o.line && !o.ch && !e.getSelection().length) return function (e) {
                            var i = t.getNode(e.cid), r = t.undo.UndoManager, o = r.makeEmptyCommand();
                            n.beforeDeleteFences(e.cid), o.undo.push({
                                type: "fences-pos",
                                pos: e.getCursor(),
                                id: e.cid
                            }), r.append(o, t.UserOp.backToParagraph(t, i, !1)), t.undo.register(o)
                        }(e), r.preventDefault(), r.codemirrorIgnore;
                        r.stopPropagation()
                    } else if ("PageDown" == i.keyNames[a]) {
                        if (!(o = e.doc.getCursor(o)) || e.doc.indexFromPos(o) >= e.doc.getValue().length) return e.execCommand("goDocEnd"), t.selection.moveUpOrDown(!1), void(r.codemirrorIgnore = !0)
                    } else if ("PageUp" == i.keyNames[a]) {
                        if (!(o = e.doc.getCursor()) || 0 == o.line && 0 == o.ch) return e.execCommand("goDocStart"), t.selection.moveUpOrDown(!0), void(r.codemirrorIgnore = !0)
                    } else if ("Enter" == i.keyNames[a] && (File.isMac ? r.metaKey : r.ctrlKey)) {
                        if (e.getSelection().length > 0) return;
                        if (o = e.doc.getCursor(), e.lineCount() - 1 == o.line && o.ch >= e.doc.getLine(o.line).length) return t.UserOp.insertParagraph(!1), r.stopPropagation(), void(r.codemirrorIgnore = !0)
                    }
                    (i.keyMap.macDefault[s] || i.keyMap.pcDefault[s]) && r.stopPropagation()
                }

                function a(n) {
                    t.undo.completeSnap(!0), t.refocus(e.id), n.getWrapperElement().offsetHeight || n.refresh();
                    o(n.getTextArea()).closest(".md-fences").find(".md-tooltip-hide").show(), f(n), d.isDiagramType(n.options.mode) && t.diagrams.startPreview(n.cid), File.isMac && app.touchBar && app.touchBar.setFencesOnSetLang(!1)
                }

                function l(e, t) {
                    if (e.focus(), "" == e.getSelection()) {
                        i.posFromMouse(e, t);
                        var n = e.findWordAt(i.posFromMouse(e, t));
                        e.setSelection(n.head, n.anchor)
                    }
                    File.isNodeHtml && File.contextMenu.show(t, e.getWrapperElement())
                }

                function c(e, n) {
                    t.brush.updateWordCount(), t.selection.clearGlobalColumn(), d.isDiagramType(e.options.mode) && t.diagrams.updateDiagram(e.cid), File.isTypeWriterMode && !File.option.scrollWithCursor && t.selection.typeWriterScroll(e.cursorCoords(e.getCursor())), n.length && n[0].origin && t.syncChange([{
                        type: "sync",
                        id: e.cid,
                        cmChanges: n
                    }])
                }

                function h(e, n) {
                    d.isDiagramType(e.options.mode) && n.ranges.length && n.ranges[0].anchor.line != (e.getCursor() || {}).line && t.diagrams.attachError(e)
                }

                function f(e, n) {
                    File.isTypeWriterMode && File.option.scrollWithCursor && t.selection.typeWriterScroll(e.cursorCoords(e.getCursor())), t.brush.updateWordCountInSelection()
                }

                function m(e, t) {
                    File.isTypeWriterMode && t.preventDefault()
                }

                if ("string" == typeof e && (e = this.editor.getNode(e)), !this.queue[e.id] && e.get("type") == e.TYPE.fences) {
                    var v = "<textarea id = 'for-fence-" + e.id + "' />";
                    if (!(C = o("[cid = " + e.id + "]").removeClass("mock-cm")).length) return;
                    var y = C.find(".md-diagram-panel").clone();
                    C.addClass("ty-contain-cm").html(v), (v = o("#for-fence-" + e.id)[0]).value = e.safeGetStrAttr("text").replace(/\u200b```/gi, "```");
                    var b = getCodeMirrorMode(e.get("lang"));
                    e.id, this.modeLoaded;
                    var w = {
                        lineWrapping: !File.option.noLineWrapping,
                        mode: b,
                        styleSelectedText: !0,
                        maxHighlightLength: 1 / 0,
                        viewportMargin: 1 / 0,
                        styleActiveLine: !0,
                        autoCloseBrackets: !File.option.noPairingMatch,
                        autoCloseTags: !File.option.noPairingMatch,
                        theme: " inner",
                        lineNumbers: File.option.showLineNumbersForFence,
                        resetSelectionOnContextMenu: !0,
                        cursorScrollMargin: 60,
                        dragDrop: !1,
                        indentUnit: File.option.codeIndentSize,
                        tabSize: File.option.codeIndentSize,
                        scrollbarStyle: "null"
                    };
                    Object.assign(w, g(e.get("lang"))), this.queue[e.id] = i.fromTextArea(v, w, this.editor, e.id), e.get("history") && this.queue[e.id].setHistory(e.get("history")), this.queue[e.id].off("keydown", r), this.queue[e.id].on("keydown", r), this.queue[e.id].off("focus", a), this.queue[e.id].on("focus", a), this.queue[e.id].off("changes", c), this.queue[e.id].on("changes", c), this.queue[e.id].off("scrollCursorIntoView", m), this.queue[e.id].on("scrollCursorIntoView", m), this.queue[e.id].off("cursorActivity", f), this.queue[e.id].on("cursorActivity", f), this.queue[e.id].off("contextmenu", l), this.queue[e.id].on("contextmenu", l), this.queue[e.id].off("beforeSelectionChange", h), this.queue[e.id].on("beforeSelectionChange", h);
                    var C = o("[cid = " + e.id + "]"), x = document.createElement("div");
                    x.setAttribute("class", "code-tooltip md-tooltip-hide"), x.setAttribute("align", "right"), x.setAttribute("contenteditable", "false"), x.innerHTML = "<span class='ty-input ty-input-after ty-cm-lang-input' contenteditable='plaintext-only' tabindex='-1' autocorrect='false' placeholder='" + o.localize.getString("select a language") + "'></span>", x.childNodes[0].textContent = e.get("lang") || "", C[0].insertChildAtIndex(x, 1), C.children(".CodeMirror").attr("lang", (e.get("lang") || "").toLowerCase()), this.modeLoaded && C.addClass("modeLoaded"), !File.option.showLineNumbersForFence && w.lineNumbers && C.addClass("md-fences-with-lineno"), y.length && C.append(y), function (e, t) {
                        var n = this, i = e.find(".ty-input").change(function () {
                            o(this).val() != t.get("lang") && n.tryAddLangUndo(t, this)
                        }).keydown(function (e) {
                            var t = e.which || e.keyCode;
                            "Enter" == u[t] && o(this).trigger("change")
                        }).focus(function () {
                            n.editor.undo.completeSnap(!0), File.isMac && app.touchBar && app.touchBar.setFencesOnSetLang(!0)
                        }).on("keydown", function (e) {
                            var t, i = e.keyCode || e.which;
                            if ("Delete" == u[i]) {
                                if ((t = n.editor.selection.getRangy()).commonAncestorContainer.parentElement != this) return !1;
                                if (t.commonAncestorContainer == this || t.startOffset == t.endOffset && t.endOffset == this.textContent.length) return n.editor.selection.moveUpOrDown(!1), !1
                            } else if ("Backspace" == u[i]) {
                                if ((t = n.editor.selection.getRangy()).commonAncestorContainer.parentElement != this) return !1;
                                if (t.commonAncestorContainer == this || t.startOffset == t.endOffset && 0 == t.startOffset) return n.editor.selection.moveUpOrDown(!0), !1
                            } else if ("Return" == u[i] || "Enter" == u[i]) return n.editor.selection.moveUpOrDown(!1), !1
                        }).on("paste", function (e) {
                            setTimeout(function () {
                                e.target.textContent = e.target.textContent.replace(/(^\n+)|(\n+$)/g, "").split(/\r?\n/)[0], o(e.target).trigger("change")
                            }, 0)
                        }).on("input", function (e) {
                            this.querySelector("*") && (this.textContent = this.textContent.replace(/(^\n+)|(\n+$)/g, ""))
                        });
                        return s.enable(i[0], {
                            hintsFetcher: function (e, t) {
                                t(p(e));
                                var n = document.querySelector(".autoComplt-list");
                                n && (n.style.height = "auto")
                            }, maxHintNum: 5
                        }), e
                    }.call(this, C, e)
                }
                return this.queue[e.id]
            }, toggleFocusedComponent: function () {
                var e = document.activeElement, t = o(e).closest(".md-fences");
                if (t.length) if (e.classList && e.classList.contains("ty-cm-lang-input")) {
                    var n = t.attr("cid"), i = this.getCm(n), r = i.getCursor();
                    o("[cid = " + n + "] textarea").focus(), i.focus(), i.setCursor(r)
                } else t.find(".CodeMirror-focused").removeClass("CodeMirror-focused").end().find(".ty-input").show().focus()
            }, focus: function (e) {
                this.editor.undo.completeSnap(!0);
                var t = "string" == typeof e ? e : e.id;
                this.editor;
                this.editor.findElemById(t).addClass("md-focus"), this.getCm(t), window.getSelection().removeAllRanges(), setTimeout(function () {
                    o("[cid = " + t + "] textarea").focus()
                }, 50)
            }, getFocused: function () {
                for (var e in this.queue) if (this.queue.hasOwnProperty(e) && this.queue[e].hasFocus()) return this.queue[e]
            }, updateCodeNum: function () {
                for (var e in this.queue) this.editor.getNode(e) || delete this.queue[e]
            }, syncToNode: function (e) {
                var t, n;
                (t = "string" == typeof e ? this.editor.getNode(e) : e) && ((n = this.getCm(t.id)).save(), t.set("history", n.doc.getHistory()), this.editor.findElemById(t.id).children().length ? t.set("text", this.queue[t.id].getValue()) : t.set("text", ""))
            }, refreshEditor: function (e, t, n) {
                if (this.modeLoaded) {
                    var i = this, r = 0;
                    for (var o in this.queue) {
                        var a = this.editor.findElemById(o);
                        if (a.find(".CodeMirror").length && this.editor.getNode(o)) {
                            var s = this.queue[o];
                            if (a.hasClass("modeLoaded")) t && s.refresh(); else {
                                var l = this.editor.getNode(o);
                                s.setOption("mode", getCodeMirrorMode(l.get("lang"))), s.refresh()
                            }
                            r++
                        } else delete this.queue[o], Node.isType(this.editor.getNode(o), Node.TYPE.fences) && this.addCodeBlock(o)
                    }
                    var c = (n || document).querySelectorAll("\t[mdtype='fences']"), d = this.editor, u = 0;
                    c.length != r && c.forEach(function (t) {
                        d.getNode(t.getAttribute("cid")).get("lang") ? (u++, i.addCodeBlock(t.getAttribute("cid"))) : (e || u < 30) && (i.addCodeBlock(t.getAttribute("cid")), u++)
                    })
                }
            }, lazyload: function () {
                var e = this;
                o.getScript((File.isNode && !window.debugMode ? "./lib.asar" : "./lib") + "/codemirror/mode.min.js").then(function () {
                    e.modeLoaded = !0, e.refreshEditor()
                })
            }, addToUndoManager: function (e) {
                this.editor.undo.register({
                    undo: [{type: "fences", cmd: "undo", id: e.cid}],
                    redo: [{type: "fences", cmd: "redo", id: e.cid}]
                })
            }, jumpCmEnd: function (e) {
                var t = e, n = e;
                "string" == typeof t ? n = this.getCm(t) : t = n.cid;
                var i = 0, r = 0;
                n && (i = n.doc.lastLine(), r = n.doc.getLine(i).length, n.focus(), n.setCursor({line: i, ch: r}))
            }, jumpCmBegin: function (e) {
                var t = e;
                "string" == typeof t && (t = this.getCm(t)), t.focus(), t.setCursor({line: 0, ch: 0})
            }, beforeDeleteFences: function (e, t) {
                var n, i;
                "string" == typeof e ? (n = this.queue[e], i = this.editor.getNode(e)) : (i = e, n = this.queue[i.id]), n && (i.set("text", n.getValue()), i.set("history", n.doc.getHistory()), n.toTextArea(), n.doc.history = null, delete this.queue[i.id], t && t.map(function (e) {
                    e && (e.id == i.id && e.json && e.json.content && e.json.content.type == i.TYPE.fences ? (e.json.content.text = i.get("text"), e.json.content.history = i.get("history")) : Array.isArray(e.json) && e.json.map(function (e) {
                        e.id == i.id && e.content.type == i.TYPE.fences && (e.content.text = i.get("text"), e.content.history = i.get("history"))
                    }))
                }))
            }, searchOn: function (e, t, n) {
                this.searchStatus = this.searchStatus || {}, this.searchStatus.overlay = this.searchStatus.overlay || {}, this.searchStatus.queue = this.searchStatus.queue || [];
                var i = new RegExp("^" + r.escapeRegExp(t), n.caseSensitive ? "" : "i");
                this.searchStatus.overlay[e.cid || "source"] = (o = t, {
                    token: function (e) {
                        return n.wholeWord && e.pos && /[a-z_\\u00C0-\\u024f]/.exec(e.string.substring(e.pos - 1, e.pos)) || !e.match(i) || n.wholeWord && /[a-z_\\u00C0-\\u024f]/.exec(e.string.substr(e.pos, e.pos + 1)) ? (e.next(), e.pos = e.string.toLowerCase().indexOf(o, e.pos), !~e.pos && e.skipToEnd(), null) : "search-hit"
                    }
                });
                var o;
                e.addOverlay(this.searchStatus.overlay[e.cid || "source"]), this.searchStatus.queue.push(e)
            }, clearSearchOn: function (e) {
                this.searchStatus && (e.removeOverlay(this.searchStatus.overlay[e.cid || "source"]), this.searchStatus.queue.remove(e))
            }, clearSearchAll: function () {
                if (this.editor.sourceView.inSourceMode) return this.searchStatus && this.editor.sourceView.cm.removeOverlay(this.searchStatus.overlay.source), void(this.searchStatus = null);
                this.searchStatus && this.searchStatus.overlay && this.searchStatus.queue.forEach(function (e) {
                    this.searchStatus.overlay[e.cid] && e.removeOverlay(this.searchStatus.overlay[e.cid])
                }, this), this.searchStatus = null
            }, tryAddLangUndo: function (e, t) {
                if (t || (t = document.activeElement), !t.classList || !t.classList.contains("ty-cm-lang-input")) return !1;
                if (e || (e = this.editor.getNode(o(t).closest("[cid]").attr("cid"))), !e) return !1;
                var n = e.get("lang") || "", i = t.textContent || "";
                return n != i && (e.attr("lang", i, this.editor, !1), !0)
            }
        });
        n.exports = v, window.CodeMirror = i, window.Fences = v
    }), $__System.registerDynamic("26", ["1e", "e", "11", "12", "1a", "13", "25"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i = e("1e"), r = e("e"), o = e("11"), a = e("12"), s = a.Node, l = e("1a"), c = l.SnapFlag, d = e("13"),
            u = e("25"), h = u.map, f = a.TYPE,
            p = (h = u.map, document.querySelector("#md-rawblock-tooltip-templ").innerHTML);
        var m = !1;

        function g() {
            if (m || !window.MathJax) return !0;
            File.option.autoNumberingForMath && (MathJax.Hub.config.TeX.equationNumbers ? MathJax.Hub.config.TeX.equationNumbers.autoNumber = "all" : MathJax.Hub.config.TeX.equationNumbers = {
                autoNumber: "all",
                useLabelIds: !0
            }), function () {
                var e = [], t = [];
                MathJax.Hub.Register.MessageHook("Begin Attach MathJax", function (n) {
                    C() && (e = Object.keys(v.labels).clone(), t = Object.keys(v.eqlabels).clone())
                }), MathJax.Hub.Register.MessageHook("End Attach MathJax", function (n) {
                    var i = [], o = [], a = r(n[1]).closest("[mdtype='math_block']");
                    if (C() && a.length) {
                        var s = File.editor.findNodeByElem(a);
                        for (var l in v.labels) -1 == e.indexOf(l) && i.push(l);
                        for (var c in v.eqlabels) -1 == t.indexOf(c) && o.push(c);
                        s.set("mathLabel", i), s.set("mathEqLabel", o)
                    }
                })
            }(), m = !0
        }

        var v, y = o.Model.extend({
            initialize: function (e) {
                this.editor = e, this.queue = {}, this.preview, this.bindEvent()
            }, bindEvent: function () {
                var e = this, t = this.editor;
                r(this.editor.sessionStr).on("mousedown", ".md-math-container", function (e) {
                    t.undo.snap(t.focusCid, c.CURSOR_CHANGE)
                }).on("click startedit", ".md-math-container", function (t) {
                    if (void 0 === t.which || 1 == t.which) return e.startEditing(r(this).closest("[cid]"), "auto"), !1
                }).on("losefocus", ".md-math-block", function (n) {
                    e.stopEditing(this.getAttribute("cid")), t.selection.scrollAdjust()
                }).on("keydown", ".md-math-block", function (t) {
                    var n = event.keyCode || event.which;
                    if ("Enter" === h[n]) return e.startEditing(r(this), "auto"), t.stopPropagation(), t.preventDefault()
                }).on("focus", ".md-math-block .ty-input", function () {
                    e.editor.undo.completeSnap(!0)
                }).on("blur inline-change", ".md-math-block .ty-input", function () {
                    var t = e.editor.getNode(e.currentCm.cid);
                    e.tryAddTagUndo(t, r(this))
                }).on("keydown", ".md-math-block .ty-input", function (t) {
                    "Enter" == h[t.keyCode || t.which] && e.editor.selection.moveUpOrDown(!1, t)
                }).on("click", ".md-math-block .md-rawblock-after, .md-math-block .md-rawblock-before", function (e) {
                    e.target == this && this.querySelector(".ty-input").focus()
                }).on("keydown", ".md-math-block .ty-input", function (t) {
                    var n, i = t.keyCode || t.which;
                    if ("Delete" == h[i]) {
                        if ((n = e.editor.selection.getRangy()).commonAncestorContainer.parentElement != this) return !1;
                        if (n.startOffset == n.endOffset && n.endOffset == this.textContent.length) return e.editor.selection.moveUpOrDown(!1), !1
                    } else if ("Backspace" == h[i]) {
                        if ((n = e.editor.selection.getRangy()).commonAncestorContainer.parentElement != this) return !1;
                        if (n.startOffset == n.endOffset && 0 == n.startOffset) return e.editor.selection.moveUpOrDown(!0), !1
                    } else if ("Return" == h[i] || "Enter" == h[i]) return e.editor.selection.moveUpOrDown(!1), !1
                }).on("paste", ".md-math-block .ty-input", function (e) {
                    setTimeout(function () {
                        e.target.textContent = e.target.textContent.replace(/(^[\n{]+)|([\n}]+$)/g, "").split(/\r?\n/)[0], r(e.target).trigger("change")
                    }, 0)
                })
            }, tryAddTagUndo: function (e, t) {
                if (!t.hasClass("ty-input")) return !1;
                e || (e = this.editor.getNode(this.currentCm.cid));
                var n = t.hasClass("ty-input-before") ? "tagBefore" : "tagAfter", i = e.get(n), r = t.text();
                if (i != r) {
                    var o = l.makeEmptyCommand();
                    return o.undo.push({
                        id: e.cid,
                        type: "attr",
                        key: n,
                        value: i || ""
                    }), e.set(n, r), o.redo.push({
                        id: e.cid,
                        type: "attr",
                        key: n,
                        value: r
                    }), self.editor.undo.register(o), !0
                }
                return !1
            }, renderAll: function (e) {
                if (!this.currentCm) {
                    var t = (e || document).querySelectorAll(".md-math-block");
                    e || (g(), x.Init());
                    for (var n = 0; n < t.length; n++) {
                        var i = t[n], r = i.querySelector("script");
                        if (!r || !r.MathJax) {
                            if (File.option.autoNumberingForMath) return void this.forceRefresh();
                            var o = this.editor.getNode(i.getAttribute("cid"));
                            MathJax.Hub.Queue(["BeforeRender", x, o], ["Typeset", MathJax.Hub, i.getAttribute("id")], ["AfterRender", x, o])
                        }
                    }
                }
            }, getTex: function (e) {
                return this.editor.findElemById(e).find("script").text()
            }, getCidAndElem: function (e) {
                var t = e, n = e;
                return "string" == typeof e ? n = this.editor.findElemById(t) : t = n.attr("cid"), [t, n]
            }, syncToNode: function (e) {
                var t = "string" == typeof e ? this.editor.getNode(e) : e;
                return (this.currentCm || {}).cid === t.cid && (t.set("history", this.currentCm.doc.getHistory()), t.set("text", this.currentCm.getValue())), t
            }, remove: function (e) {
                var t, n = this.getCidAndElem(e), i = n[0], o = n[1], a = editor.getNode(i),
                    l = editor.undo.UndoManager, c = l.makeEmptyCommand(), d = (a.get("before"), this.currentCm);
                this.editor.undo.completeSnap(!0), this.beforeDeleteFences(a), d && d.cid === a.cid ? c.undo.push({
                    type: "fences-pos",
                    pos: d.getCursor(),
                    id: d.cid
                }) : c.undo.push(this.editor.selection.buildUndo()), c.undo.push(l.buildReplaceUndo(a)), a.set("type", a.TYPE.paragraph), a.set("text", ""), s.normalizeNode(a), c.redo.push(l.buildReplaceUndo(a)), t = r(r.parseHTML(a.toHTML())[0]), o.replaceWith(t), editor.selection.jumpIntoElemEnd(t), c.redo.push(editor.selection.buildUndo()), editor.undo.register(c), this.currentCm = void 0, this.renderAll()
            }, beforeDeleteFences: function (e, t) {
                var n = this.syncToNode(e);
                this.currentCm = void 0;
                var i = this.editor.findElemById(e);
                (i = i && i.find("script")[0]) && i.MathJax && File.option.autoNumberingForMath ? b.call(this) : C() && k(n), t && t.map(function (e) {
                    e && (e.id == n.id && e.json && e.json.content && e.json.content.type == n.TYPE.math_block ? (e.json.content.text = n.get("text"), e.json.content.history = n.get("history")) : Array.isArray(e.json) && e.json.map(function (e) {
                        e.id == n.id && e.content.type == n.TYPE.math_block && (e.content.text = n.get("text"), e.content.history = n.get("history"))
                    }))
                })
            }, stopEditing: function (e, t) {
                if (this.currentCm && this.currentCm.cid && e) {
                    var n = this.getCidAndElem(e), i = n[0], o = n[1], a = this.editor, s = this.currentCm,
                        d = o[0].querySelectorAll(".mathjax-candidate");
                    if (d) {
                        var u = l.makeEmptyCommand();
                        u.undo.push({
                            type: "fences-pos",
                            pos: s.getCursor(),
                            id: s.cid
                        }), this.editor.undo.snapFlag == c.CURSOR_CHANGE && this.editor.undo.clearSnap();
                        var h = "hidden" === d[0].style.visibility ? d[1] : d[0], f = this.syncToNode(i), m = this;
                        this.currentCm = void 0, o.html(p.replace("{type}", r.localize.getString("Math", "Menu")) + "<div class='md-rawblock-container md-math-container' tabindex='-1'>" + h.innerHTML + "</div>").removeClass("md-rawblock-on-edit"), t && a.selection.jumpToNextBlock(f, u), a.undo.register(u), File.option.autoNumberingForMath && x.isDirty ? (x.Init(), this.forceRefresh()) : (h.querySelector("script").MathJax = void 0, MathJax.Hub.Queue(["BeforeRender", x, f], ["Typeset", MathJax.Hub, h.getAttribute("id")], ["AfterRender", x, f]), MathJax.Hub.Queue(function () {
                            void 0 !== m.startNumber && (v.startNumber = Math.max(m.startNumber, v.startNumber), v.number = v.startNumber, m.startNumber = void 0, x.Init())
                        }))
                    }
                }
            }, startEditing: function (e, t) {
                var n = this.getCidAndElem(e), o = n[0], a = n[1], l = this.editor, d = this.editor.getNode(o);
                if (s.isType(d, f.math_block)) {
                    var u = document.querySelector("content"), h = null;
                    if (r(document.activeElement).closest(".md-math-block").length && (h = u.scrollHeight - u.scrollTop - u.clientHeight), o) {
                        if (this.currentCm && this.currentCm.cid === o) {
                            if (l.writingArea.contains(this.currentCm.getWrapperElement())) return this.currentCm.focus(), this.currentCm;
                            this.currentCm = null
                        }
                        this.currentCm && (this.stopEditing(this.currentCm.cid), window.getSelection().removeAllRanges()), function () {
                            if (File.option.autoNumberingForMath) {
                                var e = this.editor.findElemById(d.id).find("script")[0];
                                x.startNumber = this.startNumber = void 0, e && e.MathJax && void 0 !== e.MathJax.startNumber && (this.startNumber = C().startNumber, x.startNumber = e.MathJax.startNumber, e.MathJax = void 0), void 0 == x.startNumber && File.option.autoNumberingForMath && (x.startNumber = (C() || {}).startNumber || 0)
                            }
                        }.call(this), a.html(p.replace("{type}", r.localize.getString("Math", "Menu")) + document.querySelector("#md-mathblock-panel-templ").textContent).addClass("md-rawblock-on-edit"), d.get("tagBefore") && a.find(".md-rawblock-before .ty-input").text(d.get("tagBefore")), d.get("tagAfter") && a.find(".md-rawblock-after .ty-input").text(d.get("tagAfter"));
                        var m = a.children(".md-mathblock-panel");
                        this.currentCm = function (e) {
                            var t = i(m[0].querySelector(".md-rawblock-input"), {
                                styleSelectedText: !0,
                                styleActiveLine: !0,
                                lineWrapping: !0,
                                mode: "stex",
                                placeholder: r.localize.getString("Input Math TeX here"),
                                theme: " inner",
                                autoCloseBrackets: !File.option.noPairingMatch,
                                autoCloseTags: !File.option.noPairingMatch,
                                value: d.get("text").trim(),
                                lineNumbers: File.option.showLineNumbersForFence,
                                resetSelectionOnContextMenu: !0,
                                dragDrop: !1,
                                indentUnit: File.option.codeIndentSize,
                                tabSize: File.option.codeIndentSize
                            }, e, o);
                            return d.get("history") && t.setHistory(d.get("history")), t.doc.on("change", function (n) {
                                e.brush.updateWordCount(), x.getTextFunc && x.Update(), e.selection.clearGlobalColumn(), e.syncChange([{
                                    type: "sync",
                                    id: d.id,
                                    tex: t.getValue()
                                }]), File.isTypeWriterMode && !File.option.scrollWithCursor && e.selection.typeWriterScroll(t.cursorCoords(t.getCursor()))
                            }), t.on("cursorActivity", function () {
                                File.isTypeWriterMode && File.option.scrollWithCursor && e.selection.typeWriterScroll(t.cursorCoords(t.getCursor()))
                            }), t.on("blur", function (e) {
                                try {
                                    d.set("history", e.doc.getHistory()), d.set("text", e.getValue())
                                } catch (e) {
                                    console.warn(e.stack)
                                }
                            }), t.on("keydown", function (t, n) {
                                var r, o = n.which || n.keyCode, a = i.keyName(n);
                                if (!n.metaKey && !n.shiftKey && n.ctrlKey, "Up" == i.keyNames[o]) return e.selection.moveUpOrDown(!0, n), n.codemirrorIgnore;
                                if ("Down" == i.keyNames[o]) return e.selection.moveUpOrDown(!1, n), n.codemirrorIgnore;
                                if (e.selection.clearGlobalColumn(), "Backspace" == i.keyNames[o]) {
                                    if (!t.getValue().length) return e.mathBlock.remove(t.cid), n.preventDefault(), n.codemirrorIgnore
                                } else {
                                    if ("Enter" == i.keyNames[o] && (n.ctrlKey || n.metaKey) && v(t)) return setTimeout(function () {
                                        e.UserOp.insertParagraph()
                                    }, 20), n.stopPropagation(), n.codemirrorIgnore;
                                    if ("PageDown" == i.keyNames[o]) {
                                        if (v(t)) return t.execCommand("goDocEnd"), e.selection.moveUpOrDown(!1), void(n.codemirrorIgnore = !0)
                                    } else if ("PageUp" == i.keyNames[o] && (!(r = t.doc.getCursor()) || 0 == r.line && 0 == r.ch)) return t.execCommand("goDocStart"), e.selection.moveUpOrDown(!0), void(n.codemirrorIgnore = !0)
                                }
                                (i.keyMap.macDefault[a] || i.keyMap.pcDefault[a]) && n.stopPropagation()
                            }), e.refocus(d.id), t.focus(), t
                        }(this.editor), function (e, t, n, i) {
                            var r = e.querySelector(".CodeMirror").CodeMirror,
                                o = e.querySelector(".md-mathjax-preview");
                            o.textContent = "$$\n" + r.getValue() + "\n$$", x.Init(o, e.querySelector(".md-mathjax-buffer"), function () {
                                return "$$\n" + (t.doc.getValue().trim() || "<Empty \\space Math \\space Block>") + "\n$$"
                            }, n), x.startNumber = i, MathJax.Hub.Queue(["BeforeRender", x, n, !1], ["Typeset", MathJax.Hub, o]), x.Update()
                        }(a[0], this.currentCm, d, x.startNumber), (g = this.currentCm).focus(), t && ("<Empty \\space Math \\space Block>" == g.getValue() ? g.execCommand("selectAll") : "end" == t || "auto" == t ? g.execCommand("goDocEnd") : "start" == t && g.execCommand("goDocStart"), l.refocus(o), l.undo.snap(o, c.CURSOR_CHANGE), null === h || h > 100 ? l.selection.scrollAdjust() : u.scrollTop = u.scrollHeight - h - u.clientHeight)
                    }
                    var g;
                    return this.currentCm
                }

                function v(e) {
                    var t = e.doc.getCursor();
                    return !t || e.doc.indexFromPos(t) >= e.doc.getValue().length
                }
            }, copyAsTex: function (e) {
                var t = r(e || document.activeElement).closest("[cid]").find("script")[0].textContent.trim();
                this.editor.UserOp.setClipboard(null, null, t, !0)
            }, copyAsMathML: function (e, t) {
                var n = MathJax.Hub.getAllJax(r(e || document.activeElement).closest("[cid]")[0])[0], i = this.editor;
                w(n, function (e) {
                    if (t) i.UserOp.nativeCopyText(e); else {
                        var n = "<pre class='md-fences' lang='xml'>" + d.escape(e) + "</pre>";
                        i.UserOp.setClipboard(n, null, e, !0)
                    }
                })
            }, copyAsImage: function (e) {
                var t = (e && e.querySelector || document.activeElement).querySelector("svg"), n = this.editor,
                    i = n.EditHelper.SVG2HtmlImg(t);
                n.UserOp.setClipboard(i, null, i, !0)
            }, forceRefresh: function () {
                File.editor.sourceView.inSourceMode || (this.currentCm && (this.stopEditing(this.currentCm.cid), window.getSelection().removeAllRanges(), this.editor.refocus(null)), g(), window.svgCache = {}, this.editor.brush.clearAndPause(), b.call(this), File.option.enableInlineMath ? MathJax.Hub.Queue(["Typeset", MathJax.Hub, document.querySelector("#write")]) : r(".md-math-container").each(function () {
                    MathJax.Hub.Queue(["Typeset", MathJax.Hub, this])
                }), this.renderAll(document), MathJax.Hub.Queue(function () {
                    this.editor.brush.resume()
                }))
            }
        }), b = function () {
            this.currentCm && (self.stopEditing(self.currentCm.cid), window.getSelection().removeAllRanges(), this.editor.refocus(null));
            for (var e = document.querySelectorAll("script"), t = 0; t < e.length; t++) e[t].MathJax && (e[t].MathJax = void 0);
            C() && (v.labels = v.eqlabels = v.IDs = v.eqIDs = {}, v.refs = [], this.startNumber = v.number = v.startNumber = 0, x.Init())
        }, w = function (e, t) {
            var n;
            try {
                n = e.root.toMathML("")
            } catch (n) {
                if (!n.restart) throw n;
                return MathJax.Callback.After([w, e, t], n.restart)
            }
            MathJax.Callback(t)(n)
        }, C = function () {
            return v = MathJax.Extension["TeX/AMSmath"]
        }, x = {
            delay: 0,
            preview: null,
            buffer: null,
            timeout: null,
            mjRunning: !1,
            oldText: null,
            maxIgnored: 3,
            curIgnored: 0,
            startNumber: void 0,
            originalEnd: void 0,
            isDirty: !1,
            Init: function (e, t, n, i) {
                File.editor.mathBlock && !n && this.getTextFunc && File.editor.mathBlock.currentCm || (this.preview = e, this.buffer = t, this.getTextFunc = n, this.node = i, this.originalEnd = void 0, this.isDirty = !1, this.startNumber = void 0)
            },
            SwapBuffers: function () {
                var e = this.preview, t = this.buffer;
                this.buffer = e, this.preview = t, e && t && (e.style.visibility = "hidden", e.style.position = "absolute", t.style.position = "", t.style.visibility = "")
            },
            Update: function () {
                this.callback()
            },
            CreatePreview: function () {
                if (this.curIgnored = 0, x.timeout = null, !this.mjRunning) {
                    var e = this.getTextFunc();
                    e !== this.oldtext && (this.buffer.textContent = this.oldtext = e, this.mjRunning = !0, MathJax.Hub.Queue(["BeforeRender", this, this.node, !1], ["Typeset", MathJax.Hub, this.buffer], ["AfterRender", this, this.node], ["PreviewDone", this, this.node]))
                }
            },
            PreviewDone: function () {
                this.mjRunning = !1, this.SwapBuffers()
            },
            BeforeRender: function (e, t) {
                C() && (t ? (e.unset("mathLabel"), e.unset("mathEqLabel")) : k(e), void 0 !== this.startNumber && (v.startNumber = v.number = this.startNumber))
            },
            AfterRender: function (e) {
                File.option.autoNumberingForMath && C() && (this.isDirty || (void 0 === this.originalEnd ? this.originalEnd = v.startNumber : this.isDirty = this.originalEnd !== v.startNumber))
            }
        };

        function k(e) {
            (e.get("mathLabel") || []).map(function (e) {
                delete v.labels[e]
            }), (e.get("mathEqLabel") || []).map(function (e) {
                delete v.eqlabels[e]
            })
        }

        x.callback = MathJax.Callback(["CreatePreview", x]), x.callback.autoReset = !0, y.Preview = x, n.exports = y
    }), $__System.registerDynamic("27", ["e", "11", "12", "1a", "25", "28", "13", "1b", "29"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i = e("e"), r = e("11"), o = (e("12").Node, e("1a"), e("25")), a = e("28"), s = (o.map, e("13")),
            l = e("1b");
        e("29"), /Apple Computer/.test(navigator.vendor);
        window.svgCache = {};
        var c, d = function (e) {
            var t = i(e), n = t.rawText().replace(/\u200B*/g, "");
            if (!/^\$+$/.exec(n)) return MathJax.Hub.Queue(["Typeset", MathJax.Hub, e], function () {
                if (e.querySelector(".noError") && e.querySelector("script").classList.add("math-jax-error"), !e.classList.contains("math-jax-postprocess")) {
                    var i = t.parent().attr("pattern") || "$",
                        r = t.removeClass("math-jax-preprocess").addClass("math-jax-postprocess").before("<span class='md-before md-meta'>" + i + "</span>").after("<span class='md-math-after-sym'></span><span class='md-after md-meta'>" + i + "</span>");
                    if (/^\$/.exec(n) || (n = i + n + i), r.length) {
                        var o = r[0].cloneNode(!0);
                        o.children.forEach(function (e) {
                            e.hasAttribute("id") && e.removeAttribute("id")
                        }), svgCache[n] = a.processExportedSVG(o.innerHTML)
                    }
                }
            }), !0
        }, u = function (e, t, n, i) {
            if (t.length) {
                !i && MathJax.Hub.Queue(function () {
                    e.brush.pause()
                }), MathJax.Hub.Queue(["setRenderer", MathJax.Hub, "SVG"]);
                for (var r = 0; r < t.length; r++) d(t[r]);
                n && MathJax.Hub.Queue(function () {
                    e.undo.exeCommand(n)
                }), !i && MathJax.Hub.Queue(function () {
                    e.brush.resume()
                })
            }
        }, h = null, f = function (e, t) {
            c = t[0];
            var n = i("#math-inline-preview"), r = i("#math-inline-preview-content"),
                o = t.clone().find("svg").remove().end().text();
            h = function () {
                var t = MathJax.Hub.getAllJax(r[0])[0], o = i(".md-inline-math.md-expand"), s = o.attr("pattern"),
                    l = o.find("script"), c = o.rawText(!0), d = h;
                if (t) return l.height() ? void(svgCache[c] || MathJax.Hub.Queue(["Text", t, c.replace("$$" == s ? /(^\$\$)|(\$\$$)/g : /(^\$)|(\$$)/g, "")], function () {
                    a.fixPopoverPosition(l, n), o.find("svg").replaceWith(n.find("svg").clone())
                })) : i(e.sessionStr).off("inline-math-changed", d)
            }, (n.hasClass("md-math-inline-prep-preview") || "none" === n[0].style.display) && /^\$/.exec(o) && (n.removeClass("md-math-inline-prep-preview"), MathJax.Hub.Queue(["setRenderer", MathJax.Hub, "SVG"]), r.text(o), MathJax.Hub.Queue(["Typeset", MathJax.Hub, r[0]], function () {
                n.show(), a.fixPopoverPosition(t.find("script"), n), i(e.sessionStr).on("inline-math-changed", h)
            }))
        }, p = function (e) {
            c = null;
            var t = i("#math-inline-preview");
            "none" !== t[0].style.display && t.hide(), h && (i(e.sessionStr).off("inline-math-changed", h), h = null)
        }, m = function (e, t) {
            var n;
            try {
                n = e.root.toMathML("")
            } catch (n) {
                if (!n.restart) throw n;
                return MathJax.Callback.After([m, e, t], n.restart)
            }
            MathJax.Callback(t)(n)
        }, g = function () {
            MathJax.Hub.Queue(["Typeset", MathJax.Hub, document.querySelector("#math-preheat")])
        }, v = r.Model.extend({
            initialize: function (e) {
                this.editor = e, this.queue = {}, function () {
                    var e = this.editor;
                    i(this.editor.sessionStr).on("cursorChange", function (t) {
                        var n, r = t.cursor || e.selection.getRangy();
                        if (!r) return p(e);
                        (n = i(r.commonAncestorContainer).closest(".md-inline-math.md-expand")).find("script").length ? (c != n[0] && p(e), f(e, n)) : p(e)
                    }).on("mousedown", ".md-inline-math svg", function (t) {
                        p(e), i(".md-expand").removeClass("md-expand");
                        var n = i(this).closest(".md-inline-math"), r = n.addClass("md-expand").find("script");
                        e.selection.selectAllElem(r), f(e, n)
                    })
                }.call(this), this.mathPrepApplier = l.createClassApplier("md-math-prep"), File.option.enableInlineMath && setTimeout(g, 1e3)
            }, brushSpan: function (e) {
                u.call(this, this.editor, [e], null, !0)
            }, brush: function (e, t, n) {
                var i = e.querySelectorAll(".math-jax-preprocess");
                return u.call(this, this.editor, i, t && e.getAttribute("cid") === t.startId ? t : null), i.length
            }, showAutoSuggest: function (e) {
                if (File.option.enableInlineMath) {
                    i(".md-math-prep").removeClass("md-math-prep"), this.mathPrepApplier.applyToRange(e);
                    var t = i("#math-inline-preview").show().addClass("md-math-inline-prep-preview").css("width", "auto");
                    t.find("#math-inline-preview-content").text("<Empty Inline Math>"), a.fixPopoverPosition(i(".md-math-prep"), t)
                }
            }, renderAll: function (e, t) {
                e && i(".math-jax-postprocess").parent().toArray().forEach(function (e) {
                    var t = e.getAttribute("pattern") || "$";
                    e.innerHTML = "<span class='inline-math-svg math-jax-preprocess'>" + t + s.escape(e.querySelector("script").textContent) + t + "</span></span>"
                });
                var n = (t || document).querySelectorAll(".math-jax-preprocess");
                u.call(this, this.editor, n), this.renderInToc()
            }, renderInToc: function () {
                File.option.enableInlineMath && u.call(this, this.editor, document.querySelectorAll(".math-in-toc"))
            }, tryCloseInlinePreview: function () {
                p(this.editor)
            }, copyAsTex: function () {
                var e = function () {
                        var e = this.editor.selection.getRangy();
                        return i(e.commonAncestorContainer).closest(".md-inline-math")
                    }.call(this), t = e.attr("pattern"),
                    n = e.text().replace("$$" == t ? /(^\$\$)|(\$\$$)/g : /(^\$)|(\$$)/g, "");
                this.editor.UserOp.setClipboard(null, null, n, !0)
            }, copyAsMathML: function (e) {
                var t = i("#math-inline-preview-content")[0], n = MathJax.Hub.getAllJax(t)[0], r = this.editor;
                m(n, function (t) {
                    if (e) r.UserOp.nativeCopyText(t); else {
                        var n = "<pre class='md-fences' lang='xml'>" + s.escape(t) + "</pre>";
                        r.UserOp.setClipboard(n, null, t, !0)
                    }
                })
            }, copyAsImage: function () {
                var e = document.querySelector("#math-inline-preview-content svg"), t = this.editor,
                    n = t.EditHelper.SVG2HtmlImg(e);
                t.UserOp.setClipboard(n, null, n, !0)
            }
        });
        n.exports = v
    }), $__System.registerDynamic("2a", ["11", "13", "18", "12", "2b", "1a", "28", "2c", "1b"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i = e("11"), r = e("13"), o = e("18"), a = e("12"), s = a.Node, l = a.TYPE, c = e("2b"), d = e("1a"),
            u = d.SnapFlag, h = e("28"), f = (e("2c"), e("1b")), p = function (e) {
                this.editor = e, this.queue = [], this.interval = 200, this.inline = new o.InlineLexer, this.articleArea = document.querySelector(this.editor.sessionStr), b.call(this)
            }, m = null, g = null, v = {}, y = function (e, t) {
                if (e || t) {
                    try {
                        e.brush.pause(), g ? e.focusCid = g.id || g.startId : e.refocus(void 0, void 0, !0), e.undo.completeSnap(!0);
                        var n = m, i = f.createRange(), r = d.makeEmptyCommand(g || e.selection.buildUndo()),
                            o = e.getNode(e.focusCid);
                        if (r.undo.push(d.buildReplaceUndo(o)), i.moveToBookmark(n), e.selection.deRange(i), i.deleteContents(), i.insertNode(document.createTextNode(t)), n.start = n.start += t.length, n.end = n.start, e.store(e.focusCid, !0), i.moveToBookmark(n), r.redo.push(d.buildReplaceUndo(o)), e.selection.setRange(i, !0), r.redo.push(e.selection.buildUndo()), e.undo.register(r), "fences" == v.type) {
                            var a = o.breakOn(!1, e);
                            e.findElemById(a.oldCid).replaceWith(a.newHtml), e.selection.jumpIntoElemBegin(e.findElemById(a.nextFocus)), e.undo.register(a.command)
                        } else e.brush.addToQueue(e.focusCid, !0)
                    } catch (e) {
                        console.sendError(e.stack)
                    }
                    e.brush.hideAutoComplete(), e.brush.resume(!0)
                } else e.brush.hideAutoComplete()
            }, b = function () {
                this.autoCompleteShown = !1;
                var e = this.editor;
                $(document).click(function (t) {
                    document.activeElement !== e.brush.articleArea && e.brush.hideAutoComplete()
                }), $(".auto-suggest-container").on("mousedown", "li[data-content]", function (t) {
                    g = e.selection.buildUndo()
                }).on("click", "li[data-content]", function (t) {
                    y(e, this.getAttribute("data-content"))
                })
            }, w = function (e) {
                if (!e || !e.length) return !1;
                var t = window.getSelection().getRangeAt(0).getClientRects()[0], n = "none" == e[0].style.display,
                    i = document.querySelector("content").getBoundingClientRect(), r = t.left - 15;
                return n && (r = r + 200 > window.innerWidth ? window.innerWidth - 200 : r, e.css({
                    top: t.bottom + (File.isMac && app.shouldFixFontGlitch ? $("content").scrollTop() - i.top : 0),
                    left: r
                }).show()), e.find("[data-page]").hide().filter("[data-page=" + v.pageNo + "]").show(), this.autoCompleteShown = !0, !0
            };
        p.prototype = {
            addToQueue: function (e, t) {
                t = t || !1, r.isNullOrEmpty(e) || this.queue.push({cid: e, inlineOnly: t})
            }, run: function () {
                this.timerID || this.scheduleNext()
            }, scheduleNext: function () {
                var e = this;
                this.timerID = window.setTimeout(function () {
                    e.brushQueue(), e.scheduleNext()
                }, this.interval)
            }, clearAndPause: function () {
                this.queue = [], this.pause()
            }, pause: function () {
                clearTimeout(this.timerID), this.timerID = null
            }, resume: function (e) {
                e && this.brushQueue(), this.run()
            }, restart: function () {
                this.queue = [], this.run()
            }, updateWordCountInSelection: function () {
                this.updateWordCountInSelectionTimeout && (clearTimeout(this.updateWordCountInSelectionTimeout), this.updateWordCountInSelectionTimeout = null);
                var e = this, t = $.localize.getString("Words", "Panel");
                this.updateWordCountInSelectionTimeout = setTimeout(function () {
                    var n = e.editor.selection.getWordCountInSelection();
                    if (File.isMac) n && n < e.wordCount ? app.window.updateWordCountInSelection(n) : app.document && app.document.updateWordCount(e.wordCount); else if (File.isNodeHtml) {
                        var i = document.querySelector("#footer-word-count"), r = i.textContent,
                            o = ((n && n != e.wordCount ? n + "/" + e.wordCount : e.wordCount) || 0) + " " + t;
                        r != o && fastdom.mutate(function () {
                            i.textContent = o
                        })
                    }
                }, 50)
            }, updateWordCount: function () {
                this.updateWordCountTimeout && (clearTimeout(this.updateWordCountTimeout), this.updateWordCountTimeout = null);
                var e = this;
                this.updateWordCountTimeout = setTimeout(function () {
                    var t = "";
                    if (e.articleArea.querySelectorAll("[mdtype]").forEach(function (n) {
                        var i = n.getAttribute("[mdtype]");
                        i == l.toc ? t += "\ntoc" : s.isType(i, l.html_block, l.math_block, l.fences) ? t += "\n" + e.editor.getNode(this.getAttribute("cid")).get("text") : s.canContainBlock(i, !0) || (t += "\n" + n.textContent)
                    }), e.wordCount = h.getWordCount(t), File.isMac) app.document && app.document.updateWordCount(e.wordCount); else if (File.isNodeHtml) {
                        var n = e.wordCount, i = document.querySelector("#footer-word-count"),
                            r = document.querySelector("#footer-word-count-td");
                        fastdom.mutate(function () {
                            i.textContent = n + " " + $.localize.getString("Words", "Panel"), r.textContent = n
                        })
                    }
                }, File.inBusyMode ? 500 : 100)
            }, brushNode: function (e) {
                var t = this.editor.selection.buildUndo();
                S.call(this, e, {}, t, !1) && this.editor.undo.exeCommand(t)
            }, brushQueue: function () {
                var e = this, t = {}, n = e.queue.length;
                if (!this.editor.isIME && !this.editor.isMousePressed) {
                    if (e.queue.length > 0 && !File.isLocked) {
                        var i = e.editor.selection.buildUndo(), r = !1, o = !0;
                        e.queue.map(function (n) {
                            t[n.cid] || (r = S.call(e, n.cid, t, i, n.inlineOnly) || r, t[n.cid] = 1, o = o && n.inlineOnly)
                        }), e.queue = [], r && i && e.editor.undo.exeCommand(i), this.expand(!0, !1, o)
                    }
                    n && (this.updateWordCount(), this.triggerAutoComplete())
                }
            }, applyAutocompleteByKey: function () {
                g = null, this.autoCompleteShown && y(this.editor, ((document.querySelector(".auto-suggest-container .active") || {}).dataset || {}).content)
            }, triggerAutoComplete: function (e) {
                var t, n, i = null, r = this.editor.selection.getTextAround(), o = r[0], a = r[1], s = r[2],
                    l = this.editor.getJQueryElem((this.editor.selection.getRangy() || {}).commonAncestorContainer),
                    c = l.closest(".md-inline-math").length, d = e && File.option.enableInlineMath,
                    h = e || File.option.autoToggleEmojiAutoComplete || v.found && "emoji" == v.type,
                    f = this.editor.selection.getRangy();
                if (s && f && f.collapsed && (o || a)) {
                    if (n = function () {
                        if (f && f.collapsed) {
                            var e = $(f.endContainer).closest(".md-lang"), t = e.text(),
                                n = e.prev().text().length + e.parent().prevAll().text().length;
                            if (t) return m = {start: n, end: n + t.length, containerNode: e.closest("[mdtype]")[0]}, t
                        }
                    }.call(this)) return void w.call(this, this.editor.fences.showAutoSuggest(n, v));
                    if (h && (i = E.exec(o))) return void((t = /^(\w*:*)(\s|$)/.exec(a || "")) && (w.call(this, this.editor.emoji.showAutoSuggest(i[1] + t[1], v)), s.start -= i[1].length + 1, s.end += t[1].length, m = s));
                    if (d && (n = /\$?\$$/.exec(o)) && 0 == $(".md-expand.md-inline-math").length) {
                        var p, g = (/^\$+/.exec(a) || "").length;
                        if (g <= n[0].length) return (p = "$".repeat(n[0].length - g)).length && (this.editor.undo.snap(editor.focusCid, u.REPLACE), f.insertNode(document.createTextNode(p)), f.collapse(!0)), this.editor.lastCursor = this.editor.selection.buildUndo(), s.start -= n[0].length, s.end += n[0].length, f.moveToBookmark(s), this.editor.mathInline.showAutoSuggest(f), this.editor.restoreLastCursor(null, !0), void(m = null)
                    }
                } else {
                    if (!c) return this.hideAutoComplete();
                    l.trigger("inline-math-changed")
                }
                this.hideAutoComplete()
            }, changeAutoCompleteSelection: function (e, t) {
                if (this.isAutoCompleteShown()) {
                    var n, i = $(".auto-suggest-container"), r = i.find(".active");
                    i.length && v.pageCnt && (t && t.preventDefault(), r.length ? (r.length && (r = r.removeClass("active")[e ? "prev" : "next"]().addClass("active")), r.length || (v.pageNo += e ? -1 : 1, v.pageNo < 0 ? v.pageNo = v.pageCnt - 1 : v.pageNo >= v.pageCnt && (v.pageNo = 0), n = i.find("[data-page]").hide().filter("[data-page=" + v.pageNo + "]").show(), e ? n.find("li:last").addClass("active") : n.find("li:first").addClass("active"))) : r = i.find("ul:first>li:first").addClass("active"))
                }
            }, hideAutoComplete: function () {
                v = {}, m = null, this.autoCompleteShown = !1, $(".auto-suggest-container").hide()
            }, expandOnDelay: function (e) {
                var t = this;
                this.willExpandSoon && clearTimeout(this.willExpandSoon), this.willExpandSoon = setTimeout(function () {
                    t.expand(e)
                }, 10)
            }, closestExpandable: function (e) {
                var t = e.closest("[md-inline]"), n = t.parent().closest("[md-inline]");
                if (!n.length) return t;
                var i = t.attr("md-inline");
                return i && !s.isType(i, l.plain, l.br, l.tag, l.autolink, l.pants, l.attr, l.linebreak) && t.prevAll("[md-inline]").length || t.nextAll("[md-inline]").length ? t : this.closestExpandable(n)
            }, expand: function (e, t, n) {
                if (!t && this.updateWordCountInSelection(), this.willExpandSoon && (clearTimeout(this.willExpandSoon), this.willExpandSoon = null), !this.editor.isIME) {
                    var i = this.editor.selection, r = i.getRangy(), o = i.rangy, a = r ? r.cloneRange() : null;
                    if (a && (a.startContainer != this.editor.writingArea || 0 != a.startOffset)) {
                        var c;
                        if ($(".selected").removeClass("selected"), r && !File.isLocked) {
                            if (this.editor.selection.deRange(r), c = this.editor.getJQueryElem(r.commonAncestorContainer), this.editor.stylize.putBookmark(a, this.editor.stylize.buildBookmark(c)), !t && !n && function (e, t) {
                                var n = e.closest("[cid]");
                                if (n.length && e.closest("[md-inline]").length && !e.closest(".md-block-like").length) {
                                    var i = n.find(".md-block-like");
                                    if (!i.length) return !1;
                                    var r = editor.findNodeByElem(e.closest("[cid]")),
                                        o = editor.selection.buildUndo(t);
                                    if (r.cid != o.endId) return !1;
                                    var a = i.prevAll().rawText().length, s = i.rawText().length;
                                    if (!editor.lastCursor || editor.lastCursor.endId != o.endId || editor.lastCursor.startOffset > a + s || editor.lastCursor.endOffset < a + s) return !1;
                                    var l = !1;
                                    t.comparePoint(i[0], 0) < 0 && (o.start = o.end = o.end - a - s, l = !0), editor.undo.completeSnap(!0);
                                    var c = editor.simpleParse(r, !1);
                                    if (c) return editor.findElemById(c[2]).replaceWith(c[1]), l && c[3].length > 1 && (o.startId = o.endId = c[3].last().getVeryFirst().cid), editor.undo.exeCommand(o), c[0].undo[0] = editor.lastCursor, c[0].redo.push(editor.selection.buildUndo()), editor.undo.register(c[0]), editor.quickRefresh(), !0
                                }
                                return !1
                            }(c, r)) return;
                            if (isInputComponent(document.activeElement) || document.activeElement.hasAttribute("tabindex")) return $(".md-expand").removeClass("md-expand"), $(this.editor.sessionStr).trigger("cursorChange", this.editor.styleBookmark);
                            if (!c.closest("[cid]").length || s.isType(c.closest("[cid]").attr("mdtype"), l.fences, l.math_block, l.html_block)) return $(this.editor.sessionStr).trigger("cursorChange", this.editor.styleBookmark);
                            if (r.collapsed) {
                                var d, h = k(c), f = c.closest("[mdtype]"), p = (f.attr("contenteditable"), []),
                                    m = h.visibleText().length;
                                if (r.endOffset === m && m < h.text().length) d = h.addClass("md-expand"), (a = o.createRange()).collapseToPoint(h[0], h[0].childNodes.length), this.editor.selection.setRange(a, !0); else if (b(r, -1), d = f[0] != $(r.startContainer).closest("[mdtype]")[0] ? h : k(this.editor.getJQueryElem(r.startContainer)), r.startContainer === r.endContainer) if (r.toString().length && r.collapse(!1), 3 == r.endContainer.nodeType && r.endOffset == r.endContainer.textContent.length && w(r.endContainer.nextElementSibling)) r.endContainer.nextElementSibling.classList.add("selected"), r.selectNode(r.endContainer.nextElementSibling); else {
                                    b(r, 1);
                                    var g = r.getNodes([1], w);
                                    g.length && (a.setStart(g[0], 0), a.setEnd(g[0], 0), editor.selection.setRange(a, !0))
                                }
                            } else d = k(this.editor.getJQueryElem(r.startContainer));
                            if (!(p = k(this.editor.getJQueryElem(r.endContainer))).length && (p = d), d.length || p.length) {
                                var v = !1;
                                a.collapsed || (v = (a = function (t) {
                                    try {
                                        var n, i, r = t.commonAncestorContainer;
                                        if (0 == t.startOffset && d.length && (d = editor.getJQueryElem(t.startContainer)).length) if (d.closest(".md-expand").length || d[0].hasAttribute("cid") || d[0].querySelector("[cid]") || d.closest(".md-image:not(.md-img-loaded)").length) (i = d.closest(".md-expand")).length && (d = i); else {
                                            n = d.closest("[cid]")[0];
                                            var o = t.collapsed;
                                            d = function t(n, i) {
                                                if (!n.prevAll(":not(.md-meta, .md-content)").text().length) {
                                                    var r = n.parent();
                                                    return r.attr("mdtype") ? n : i.contains(r[0]) || e ? t(r, i) : k(n)
                                                }
                                                return k(n)
                                            }(d, r.contains && r.contains(n) ? n : r), t.setStartBefore(d[0]), o && t.collapse(!0)
                                        }
                                        if (t.endOffset == (t.endContainer.nodeType === document.TEXT_NODE ? t.endContainer.length : t.endContainer.childNodes.length)) {
                                            var a = editor.getJQueryElem(t.endContainer);
                                            if (a.length) if (a.closest(".md-expand").length || a[0].hasAttribute("cid") || a[0].querySelector("[cid]") || a.closest(".md-image:not(.md-img-loaded)").length) (i = a.closest(".md-expand")).length && (a = i); else {
                                                if (n = a.closest("[cid]")[0], !(a = function e(t, n) {
                                                    if (!t.nextAll(":not(.md-meta, .md-content)").text().length) {
                                                        var i = t.parent();
                                                        return i.hasClass("[mdtype]") || i[0].contains(n) ? k(t) : e(i, n)
                                                    }
                                                    return k(t)
                                                }(a, r.contains && r.contains(n) ? n : r)).length) return null;
                                                t.setEndAfter(a[0])
                                            }
                                        }
                                    } catch (e) {
                                        console.warn(e)
                                    }
                                    return t
                                }(a) || a) && !a.collapsed), fastdom.mutate(function () {
                                    $(".md-expand").removeClass("md-expand"), d.length ? x.call(this, d) : x.call(this, p), d.length && p.length && d.next().is(p) && !p.hasClass("md-img-loaded") && x.call(this, p, !0)
                                })
                            } else $(".md-expand").removeClass("md-expand");
                            if (v) this.editor.selection.deRange(a, !0, a); else {
                                var y = window.getSelection().anchorNode;
                                y && (3 === y.nodeType || y.hasAttribute && y.hasAttribute("contenteditable")) && (a = a || this.editor.selection.getRangy(), this.editor.selection.deRange(a, !0, a)), a.commonAncestorContainer.parentElement && a.commonAncestorContainer.parentElement.classList.contains("ty-focusable-btn") ? a.commonAncestorContainer.parentElement.classList.add("selected") : w(y) && y.classList.add("selected")
                            }
                            $(this.editor.sessionStr).trigger("cursorChange", this.editor.styleBookmark)
                        } else c = this.editor.getMarkElem(), $(".md-expand").removeClass("md-expand"), c.length && s.isType(c.attr("mdtype"), s.TYPE.hr, s.TYPE.toc) && (this.editor.stylize.putBookmark(null, this.editor.stylize.buildBookmark(c)), $(this.editor.sessionStr).trigger("cursorChange", this.editor.styleBookmark));
                        this.editor.lastCursor = this.editor.selection.buildUndo(), this.editor.undo.snapFlag == u.CURSOR_CHANGE && this.editor.undo.completeSnap(!0)
                    }
                }

                function b(e, t) {
                    return i.extendRange(e, t)
                }

                function w(e) {
                    return e && e.classList && e.classList.contains("ty-focusable-btn")
                }
            }, isAutoCompleteShown: function () {
                return this.autoCompleteShown
            }, focusContainer: function (e) {
                C.call(this, e)
            }
        };
        var C = function (e) {
            var t = e.closest("tr.md-end-block, li[cid]")[0], n = e[0];
            if (t && n) {
                for (; t !== n && t.contains(n);) {
                    if (n.previousSibling && n.previousSibling.hasAttribute && n.previousSibling.hasAttribute("cid")) return !1;
                    n = n.parentElement
                }
                t.classList.add("md-focus-container")
            }
        }, x = function (e, t) {
            t || $(".md-focus-container").removeClass("md-focus-container"), e.length && C(e.addClass("md-expand").trigger("expand").closest("[cid]").addClass("md-focus"))
        };

        function k(e) {
            var t = e.parent().closest("[md-inline]");
            return t.length ? k(t) : e.closest("[md-inline]")
        }

        var S = function (e, t, n, r) {
            function a(e) {
                for (var t = 0; t < e.attributes.length; t++) s.isType(e.attributes[t].name, "cid", "contenteditable", "id", "for", "onerror", "onload") && e.removeAttributeNode(e.attributes[t]);
                e.classList.remove("md-img-loaded"), e.classList.remove("md-img-error")
            }

            function d(e) {
                for (var t = e.querySelectorAll("*"), n = 0; n < t.length; n++) a(t[n]);
                a(e)
            }

            function h(e, t, n, r, o, a) {
                if (e.length) {
                    var s, l = n.innerHtml, c = e[0].cloneNode(!0), h = document.createElement("div");
                    a = n.cursorDiff;
                    return h.innerHTML = l, c.querySelectorAll(".md-inline-math").forEach(function (e) {
                        e.textContent = e.rawText()
                    }), c.querySelectorAll(".md-expand").forEach(function (e) {
                        e.classList.remove("md-expand")
                    }), h.querySelectorAll(".md-inline-math").forEach(function (e) {
                        e.textContent = e.rawText()
                    }), d(c), d(h), c.innerHTML.replace(/\s*class=\"\"/gi, "") != h.innerHTML.replace(/\s*class=\"\"/gi, "") ? (o.undo && o.undo.snap(t.cid, u.NONE, null, !0), e.html(l), n.mdlike ? e.attr("mdlike") != n.mdlike && e.attr("mdlike", n.mdlike) : e.attr("mdlike") && e.removeAttr("mdlike"), o.selection.clearGlobalColumn(), o.mathInline.brush(e[0], r, !0), s = !0) : (e.hasClass("unholdable") && e.removeClass("unholdable"), e.find(".math-jax-preprocess").length && o.mathInline.brush(e[0], r, !0)), function (e, t, n, r, o) {
                        if (t.length && o.focusCid === r.cid) return e && (n && n.undo.unshift(i.utils.clone(e)), e.start = p(t, e.start), e.end = p(t, e.end), n && n.redo.push(i.utils.clone(e))), o.undo && o.undo.register(n), !0;
                        return !1
                    }(r, a, n.command, t, o) || s
                }
            }

            function f(e, t, n, r, o) {
                return n.blockChanged ? function (e, t, n, r, o) {
                    var a = n.cursorDiff || [];
                    return o.selection.clearGlobalColumn(), n.replaceCid ? (o.findElemById(n.replaceCid).replaceWith(n.html), o.refreshUnder(o.findElemById(n.replaceCid)[0])) : e.closest("p").replaceWith(n.html), n.toRemove && n.toRemove.forEach(function (e) {
                        o.findElemById(e).remove()
                    }), o.focusCid && o.focusCid !== t.cid || (o.focusCid = n.focus, o.focusCid && C(o.findElemById(o.focusCid)), r && (n.command.undo.unshift(i.utils.clone(r)), a.length && (r.start = p(a, r.start), r.end = p(a, r.end)), r.startId = n.focus, r.endId = n.focus, r.start -= n.offset, r.end -= n.offset, n.command.redo.push(i.utils.clone(r))), o.undo.register(n.command)), !0
                }(e, t, n, r, o) : h(e, t, n, r, o)
            }

            function p(e, t) {
                var n = t;
                for (var i in e) void 0 !== i && i <= t && (n += e[i]);
                return n
            }

            try {
                var m, g, v = e, y = e;
                if ("string" == typeof e ? v = this.editor.getNode(e) : y = v.id, !v) return;
                if (s.isType(v, l.meta_block)) return;
                if (c.CONST.NoInline.indexOf(v.get("type")) > -1) return;
                if (v.get("children").length) return v.get("children").toArray().map(function (e) {
                    t && (t[e.id] = 1), S.call(this, e, t, n, r)
                }, this), !0;
                if (m = this.editor.findElemById(y), v.get("type") == l.def_footnote) {
                    var b = m.children(".md-def-content");
                    return g = b.rawText(), f(b, v, o.quickParse(g, this, v, !0), n, this.editor)
                }
                return g = m.rawText(), f(m, v, o.quickParse(g, this, v, r || !s.isType(v, l.paragraph), null, n), n, this.editor)
            } catch (e) {
                e.stack
            }
        }, E = /:(\w+)$/;
        n.exports = p
    }), $__System.registerDynamic("2d", ["e", "11", "12", "2e", "2f", "30", "1a", "28", "13", "31"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i = e("e"), r = e("11"), o = e("12"), a = o.Node, s = o.TYPE, l = e("2e"), c = e("2f"), d = e("30").rangy,
            u = e("1a"), h = e("28"), f = e("13"), p = e("31"), m = window.reqnode ? reqnode("electron").remote : null,
            g = null, v = {}, y = null, b = "typora-copy-images-to", w = "http://support.typora.io/Images/";
        window.imgLastModified = Math.floor((new Date - 0) / 1e3), window.uploadImageQueue = new Set, window.moveImageQueue = new Set, window.imagePreLoadAfterMove = {};

        function C(e, t, n) {
            if (n && e && t) {
                var i = n.clientHeight, r = n.clientWidth;
                i && r && (imagePreLoadAfterMove["file://" + e.replace(/^file:\/\//, "").replace(/\\/g, "/")] = {
                    src: t,
                    size: "height:" + i + "px;width:" + r + "px;"
                })
            }
        }

        function x(e, t) {
            return e.replace(/(\(<?)((?:\([^)]*\)|[^()])*?)(>?[ \t]*((['"])(.*?)\5[ \t]*)?\))/, "$1" + t + "$3")
        }

        function k(e, t) {
            return /src\s*=\s*['"]/.exec(e) ? e.replace(/(src\s*=\s*(["'])).+?(\2)/i, "$1" + t + "$3") : e.replace(/(src\s*=\s*)([^\s'"]+)(\s|$)/i, '$1"' + t + '"$3')
        }

        function S(e) {
            var t = i("[data-origin-path=" + JSON.stringify(e) + "]");
            t.length, uploadImageQueue.delete(e), moveImageQueue.delete(e), (n = t).removeClass("md-on-uploading").removeClass("md-on-moving"), n.find(".md-image-uploading-mask-wrapper").remove(), n.removeAttr("data-origin-path");
            var n;
            return t
        }

        var E = {};
        window.onImageDownloaded = function (e, t, n) {
            var i = E[e];
            i && (i.callbacks.map(function (e) {
                e(t, n)
            }), delete E[e])
        };

        function F(e, t, n, i) {
            var r = c.applyUploadingStyle;
            if (e.length) {
                var o = e.find("img")[0];
                loadedImgCache.remove(o.getAttribute("src") || ""), o.onload = null
            }
            return this.editor.brush.clearAndPause(!0), window.moveImageQueue.add(n), r(e, n, !0, !0), this.editor.brush.resume(), File.isMac ? function (e, t, n) {
                if (n = n.replace(/^file:\/\//, ""), !/^\w+:/.exec(n)) try {
                    n = decodeURI(n)
                } catch (e) {
                }
                return new Promise(function (e, r) {
                    app.ipic.copyImage(n, t, e, r, i || !1)
                })
            }.call(this, e, t, n) : function (e, t, n) {
                return new Promise(function (e, r) {
                    var o = reqnode("fs-extra"), a = null;

                    function s(t, n, i) {
                        if (/^(http(s?))|(ftp):\/\//.exec(t)) !function (e, t, n, i, r) {
                            var o = m.getCurrentWindow(), a = reqnode("fs-extra"), s = reqnode("path").dirname(t),
                                l = function (e, o) {
                                    "completed" === e ? (r && o != t ? a.renameSync(o, t) : t = o, n(t)) : i(e ? "Image download " + e : "")
                                };
                            E[e] ? E[e].callbacks.push(l) : E[e] = {
                                dest: t,
                                callbacks: [l]
                            }, m.app.download(o.webContents.id, e, s), setTimeout(function () {
                                E[e] && (E[e].callbacks.remove(l), E[e].callbacks.length || delete E[e]), i("Download timeout.")
                            }, 3e4)
                        }(t, n, e, r, i); else {
                            try {
                                t = decodeURI(t)
                            } catch (e) {
                            }
                            o.copy(t, n, {overwrite: i}, function (t) {
                                if (t) return r("Failed to copy image\n." + t.message);
                                e(n)
                            })
                        }
                    }

                    var l = File.isWin ? "\\" : "/";
                    if (i) s(n, a = t, !0); else {
                        var c = p.getFileNameFromPath(n);
                        c = f.removeInvalidPathCh(c.replace(/\?([^./]*)$/, "")), t = (t + l).replace(/[\/\\]{2}$/, l), a = t + c, o.access(a, o.R_OK, function (e) {
                            e || (a = function (e) {
                                var t = reqnode("path");
                                return e.replace(/(\.[^.\/\\]+?$)/, "") + "-" + (new Date - 0) + t.extname(e)
                            }(a)), s(n, a, !1)
                        })
                    }
                })
            }.call(this, e, t, n)
        }

        function _(e, t, n) {
            if (t = this.resolveImagePath(t), !e[0]) return this.editor.selection.buildUndo();
            var r = this.editor, o = r.selection.getRangy(), a = e[0].querySelector(".md-content").textContent,
                l = e.attr("md-inline") == s.imgtag ? k(a, t) : x(a, t), c = r.selection.buildUndo(o),
                d = u.makeEmptyCommand(c), h = i.extend({}, c), f = l.length - a.length,
                p = r.findNodeByElem(e.closest("[cid]"));
            r.undo.completeSnap(!0);
            var m = e.find(".md-content")[0];
            o && m && o.comparePoint && o.comparePoint(m, 1) < 0 && (h.start += f), o && m && o.comparePoint && o.comparePoint(m, 2) < 0 && (h.end += f), d.undo.push(u.buildReplaceUndo(p)), e.find(".md-content").text(l), r.store(p, !0);
            var g = r.findElemById(p.cid);
            return r.brush.brushNode(p.cid), g.removeClass("md-expand"), r.undo.exeCommand(h), d.redo.push(u.buildReplaceUndo(p)), d.redo.push(h), r.undo.register(d), h
        }

        function T(e, t, n, r) {
            var o = this;
            e && e.length && F.call(this, e, t, n, r).then(function (t) {
                e = S(n), C(t, n, e.find("img")[0]), _.call(o, e, t)
            }, function (t) {
                e = S(n), console.error(t), t && setTimeout(function () {
                    i("#md-notification").html("<p style='padding-right: 100px;'>" + i.localize.getString("Failed to Copy Image to Target Folder.") + " <code>" + f.escape(t) + "</code><span class='btn-default btn-xs btn ok-btn' style='right: 40px;position: absolute;bottom: 8px;'>" + i.localize.getString("Close") + "</span></p>").show()
                }, 500)
            })
        }

        var M = r.Model.extend({
            initialize: function (e) {
                var t = this;
                this.editor = e, i(e.sessionStr).on("mousemove", ".md-image>.md-meta", function (e) {
                    fastdom.measure(function () {
                        e.offsetX - e.target.offsetLeft < 20 && e.offsetY < 30 ? this.nextElementSibling && this.nextElementSibling.getAttribute("src").trim().length && fastdom.mutate(function () {
                            this.classList.add("md-show-hint")
                        }, this) : fastdom.mutate(function () {
                            this.classList.remove("md-show-hint")
                        }, this)
                    }, this)
                }).on("mouseleave", ".md-image>.md-meta", function () {
                    fastdom.mutate(function () {
                        this.classList.remove("md-show-hint")
                    }, this)
                }).on("click", "img", function (t) {
                    var n = i(t.target).closest(".md-image").addClass("md-expand");
                    if (n.length) {
                        var r = d.createRange();
                        r.moveToBookmark({
                            containerNode: n.children(".md-meta")[0],
                            start: 2,
                            end: 2 + (t.target.getAttribute("alt") || "").length
                        }), e.selection.setRange(r, !0)
                    }
                }).on("btn-action", ".md-image-input-src-btn", function (t) {
                    i("#ty-tooltip").hide();
                    var n = document.createRange();
                    n.setStart(this.parentElement, 0), n.setEnd(this.parentElement, 0), i(this).remove(), e.selection.setRange(n, !0)
                }).on("click btn-action", ".md-image-pick-file-btn", function (e) {
                    return i("#ty-tooltip").hide(), File.isMac ? app.controller.insertLocalImage() : File.isNode && t.insertImagesFromLocalFile(), !1
                }).on("cursorChange", function (t, n) {
                    n && -1 != n.style.inline.indexOf("image") || !document.querySelector("#user-context-menu.show") || e.contextMenu.hide("#user-context-menu")
                }), i(".context-menu").on("click", "[data-key='select-img-target'] a", function () {
                    File.editor.contextMenu.hide(), t.copyToSelectedFolderAction()
                }).on("click", "[data-key='upload-img'] a", function () {
                    File.editor.contextMenu.hide(), t.uploadAction()
                }).on("click", "[data-key='move-img-to-target'] a", function () {
                    File.editor.contextMenu.hide(), t.copyToTargetFolderAction()
                }).on("click", "[data-key='reveal-img-in-finder'] a", function () {
                    if (File.editor.contextMenu.hide(), File.isNode) {
                        var e = i(".md-expand.md-img-loaded");
                        if (!e) return;
                        var n = t.getAbsolutePath(e.attr("data-src"));
                        m.shell.showItemInFolder(n)
                    }
                })
            }, getLocalRootUrlForInsert: function () {
                return this.editor.docMenu.getLocalRootUrl() || File.option.useRelativePathForImg && p.getCurrentFileFolderPath() || ""
            }, getAbsolutePath: function (e, t) {
                if (!e) return e;
                var n = this.getRealSrc(e).replace(/^file:\/\//, "");
                return File.isWin && (n = n.replace(/^[\/\\]+/, "")), t && /^[\/\\]/.exec(n) ? "file://" + n : n
            }, getRealSrc: function (e) {
                if (!e) return e;
                if (/^data:/.exec(e)) return e;
                if (/^\/\//.exec(e)) return "http:" + e;

                function t(e, t) {
                    return "file://" + p.normalizePath(e.replace(/^file:\/\//, "").replace(/\/$/, "") + "/" + t.replace(/^\//gi, ""))
                }

                try {
                    if (/^(file|ftp|https?):(\/\/|\\\\)/gi.exec(e)) return e;
                    if (File.isNode) {
                        var n = reqnode("path"), i = this.editor.docMenu.getLocalRootUrl();
                        return File.isWin || !/^\//.exec(e) || i ? "file://" + n.resolve(this.editor.docMenu.getLocalRootUrl() || p.getCurrentFileFolderPath() || "", e.replace(/^\s*(\\\\|\/)/, "")) : "file://" + e
                    }
                    return /^(\/)|(\/\/)|(\\\\)|([a-z]+\:\\\\)/gi.exec(e) ? t(this.editor.docMenu.getLocalRootUrl() || "", e || "") : t(p.getCurrentFileFolderPath() || "", e || "")
                } catch (e) {
                }
                return e
            }, updateImgRef: function (e) {
                var t = this.editor.brush.inline;
                i("[data-ref='" + f.escape(e) + "']").each(function () {
                    var e = (this.querySelector(".md-content") || {}).textContent;
                    void 0 !== e && i(this).replaceWith(t.output(e))
                })
            }, willUpdateImgRef: function (e) {
                e && (y && clearTimeout(y), v[e] = !0, g = g || new Date, new Date - g > 200 ? setTimeout(function () {
                    Object.keys(v).map(this.updateImgRef, this)
                }.bind(this), 10) : y = setTimeout(function () {
                    Object.keys(v).map(this.updateImgRef, this)
                }.bind(this), 300))
            }, refreshLocalImg: function () {
                if (!File.inBusyMode) {
                    var e = Math.floor((new Date - 0) / 1e3);
                    i(".md-image img").each(function () {
                        var t = this.getAttribute("src");
                        if (/^file:/i.exec(t)) {
                            var n = t.replace(/\?lastModify=\d+$/, ""), i = n + "?lastModify=" + imgLastModified;
                            failImgCache.remove(i), loadedImgCache.remove(i), this.setAttribute("src", n + "?lastModify=" + e), this.dataset.localRefresh = !0, this.onload = onImageLoadedFunc, this.onError = onImageErrorFunc
                        }
                    }), imgLastModified = e
                }
            }, updateLocalRootUrl: function () {
                var e = this.editor.docMenu.getLocalRootUrl() || "";
                if (this.editor.localRootUrl != e) {
                    for (var t = document.querySelectorAll("[md-inline='image']"), n = 0; n < t.length; n++) {
                        var r = (l = t[n]).querySelector("img");
                        if (l.getAttribute("data-src") != r.getAttribute("src")) {
                            var a = i.parseHTML(c.decorate({
                                type: o.TYPE.image,
                                markdown: l.textContent,
                                alt: r.getAttribute("alt"),
                                href: l.getAttribute("data-src")
                            }))[0];
                            l.parentElement.replaceChild(a, l)
                        }
                    }
                    var s = document.querySelectorAll("[data-ty-watch-src]");
                    for (n = 0; n < s.length; n++) {
                        var l, d = (l = s[n]).dataset.src;
                        l.getAttribute("src") != d && (l.src = this.getAbsolutePath(d, !0), "VIDEO" == l.tagName && this.editor.htmlBlock.resetVideoDom(l))
                    }
                }
            }, selectComponent: function (e) {
                var t = this.editor.selection.getRangy(), n = i(t.startContainer).closest("[md-inline='image']"),
                    r = n.text(), o = t.getBookmark(n[0]), a = r.indexOf("]"),
                    s = u.makeEmptyCommand(this.editor.selection.buildUndo());
                e ? (o.start = a + 2, o.end = r.length - 1) : (o.start = 2, o.end = a), t.moveToBookmark(o), this.editor.selection.setRange(t, !0), s.redo.push(this.editor.selection.buildUndo()), this.editor.undo.register(s)
            }, buildImageMapToUpload: function () {
                N = {};
                for (var e, t, n = document.querySelectorAll(".md-image.md-img-loaded"), i = n.length, r = 0; r < i; r++) A(t = (e = n[r]).querySelector("img").getAttribute("src") || "") && (t = t.replace(/\?[^.\\\/]*$/, ""), N[t] = N[t] || [], N[t].push(e));
                return Object.keys(N)
            }, replaceImageMap: function (e, t) {
                var n = JSON.parse(e), r = u.makeEmptyCommand(this.editor.selection.buildUndo()), o = this.editor,
                    l = new Set;
                if (Object.keys(n).forEach(function (e) {
                    if (N[e]) {
                        var t = n[e];
                        N[e].forEach(function (e) {
                            e.querySelector("img").src = t, e.hasAttribute("data-src") && e.setAttribute("data-src", t);
                            var n, c, d = o.findNodeByElem(i(e).closest("[cid]")), h = e.getAttribute("md-inline");
                            if (!l.has(d) && a.isType(h, s.image, s.imgtag) && (l.add(d), r.undo.push(u.buildReplaceUndo(d))), n = e.querySelector(".md-content").textContent, h == s.image) c = x(n, t), e.querySelector(".md-content").textContent = c; else if (h == s.imgtag) c = k(n, t), e.querySelector(".md-content").textContent = c; else if (h == s.refimg) {
                                var f = /^!\[((?:\[[^\]]*\]|[^\[\]]|\](?=[^\[]*\]))*)\]\s*\[([^\]]*)\]/.exec(n),
                                    p = (f[2] || f[1]).replace(/\s+/g, " "), m = o.nodeMap.link_list.getNodeByRef(p);
                                if (l.has(m)) return;
                                l.add(m), r.undo.push(u.buildReplaceUndo(m)), m.set("href", t), o.findElemById(m.cid).replaceWith(m.toHTML())
                            }
                        })
                    }
                }), l.forEach(function (e) {
                    e.get("type") !== s.def_link && o.store(e, !0), r.redo.push(u.buildReplaceUndo(e))
                }), r.redo.push(o.selection.buildUndo()), o.undo.register(r), t) {
                    var c = Object.keys(n).length;
                    h.showNotification(i.localize.getString("Successfully uploaded {0} images.").format(c) + "<span class='btn-default btn-xs btn undo-btn' style='right: 40px;position: absolute;'>" + i.localize.getString("Undo") + "</span>")
                }
            }, insertImagesFromLocalFile: function () {
                if (!File.isLocked) {
                    var e = reqnode("electron").remote, t = e.getCurrentWindow(), n = e.dialog, i = this.editor;
                    n.showOpenDialog(t, {
                        filters: [{
                            name: "Images",
                            extensions: ["png", "jpg", "jpeg", "bmp", "svg", "tiff", "webp", "gif"]
                        }], properties: ["openFile", "multiSelections"], buttonLabel: "Select"
                    }, function (e) {
                        e && 0 != e.length && i.imgEdit.doInsertFromURLs(e)
                    })
                }
            }, shouldTriggerMove: function (e, t) {
                if (void 0 === t && (t = this.getTagetImageStorageFolder()), !e) return !1;
                if (/^\s*(https?|ftp):\/\//.exec(e)) return File.option.applyImageMoveForWeb;
                if (File.option.applyImageMoveForLocal) {
                    var n = this.getAbsolutePath(e);
                    if (0 != n.indexOf(t) || n.substring(t.length + 1).match(/[\\\/]/g)) return !0
                }
                return !1
            }, tryMoveImageDom: function (e, t) {
                if (t) {
                    var n = e.attr("data-src");
                    if (this.shouldTriggerMove(n, t)) if (File.isMac && "ipic" == t) this.uploadAction(e, !0); else {
                        var i = this.getAbsolutePath(n);
                        T.call(this, e, t, i)
                    }
                }
            }, prepImageMove: function (e, t) {
                var n = this;
                return new Promise(function (r, o) {
                    if (t) return r();

                    function a(e) {
                        e && alert(e.message || e), o()
                    }

                    if (File.isMac) {
                        if (void 0 === e && (e = n.getTagetImageStorageFolder()), "ipic" == e) return r();
                        var s = app.ipic.prepImageMove(e);
                        "success" != s ? a(s) : r()
                    } else {
                        var l = reqnode("fs-extra"), c = !1;
                        n.getTagetImageStorageFolder(!0) && (c = !0), void 0 === e && (e = n.getTagetImageStorageFolder()), function (e, t) {
                            var n = reqnode("fs-extra");
                            return new Promise(function (r, o) {
                                if (!t) return r();
                                n.stat(e, function (t) {
                                    if (!t) return r();
                                    if ("ENOENT" != t.code) return o(t.message);
                                    var n = i("#image-create-folder-confirm").find("#image-create-folder-target").text(e).end().modal({
                                        backdrop: "static",
                                        keyboard: !1
                                    });
                                    File.isLocked = !0, n.off("mousedown", ".image-create-folder-dialog-yes, .image-create-folder-dialog-no, .image-create-folder-dialog-help, .close").one("mousedown", ".image-create-folder-dialog-yes", function () {
                                        n.modal("hide"), File.isLocked = !1, File.freshMenu(), r()
                                    }).one("mousedown", ".image-create-folder-dialog-no", function () {
                                        n.modal("hide"), File.isLocked = !1, File.freshMenu(), o(!1)
                                    }).one("mousedown", ".close", function () {
                                        n.modal("hide"), File.isLocked = !1, File.freshMenu(), o(!1)
                                    }).on("mousedown", ".image-create-folder-dialog-help", function () {
                                        m.shell.openExternal(w)
                                    })
                                })
                            })
                        }(e, c).then(function () {
                            l.ensureDir(e, function (e) {
                                e ? a(e) : r()
                            })
                        }, a)
                    }
                })
            }, tryMoveImageInRange: function (e) {
                var t = this.editor, n = this.getTagetImageStorageFolder();
                if (n) {
                    this.editor.brush.clearAndPause();
                    var r = e.getNodes([document.ELEMENT_NODE], function (e) {
                        return "image" == e.getAttribute("md-inline")
                    });
                    !r.length && e && "image" == e.commonAncestorContainer.parentElement.getAttribute("md-inline") && (r = [e.commonAncestorContainer.parentElement]), r.length && this.prepImageMove(n).then(function () {
                        r.forEach(function (e) {
                            t.imgEdit.tryMoveImageDom(i(e), n)
                        })
                    }), this.editor.brush.resume()
                }
            }, generateAlt: function (e) {
                return (p.getFileNameFromPath(e) || "").replace(/(^\.)|(\.[^.]+$)/g, "")
            }, doInsertFromURL: function (e, t) {
                c.applyUploadingStyle;
                var n = e;

                function r() {
                    return File.editor.imgEdit.generateAlt(e)
                }

                function o() {
                    var e = window.getSelection(), t = "";
                    return !File.editor.sourceView.inSourceMode && e.startOffset > 0 && (t = " "), t
                }

                function a(e) {
                    var t = this.editor, n = t.getMarkElem();
                    if (!n.length || !t.stylize.canContainInline(n)) return !1;
                    l.backspaceHandler(t, null, "delSelection");
                    var a, s = r(), c = o(), d = t.getNode(n.attr("cid")), h = this.resolveImagePath(e),
                        f = c + "![" + s + "](" + h + ")", p = t.selection.getRangy();
                    if (!p) return null;
                    if ((a = i(p.startContainer).closest("[md-inline='image']")).length) return window.moveImageQueue.add(e), _.call(this, a, e), a.attr("data-src", h), this.selectComponent(!0), a;
                    var m = p.getBookmark(n[0]).start, g = u.makeEmptyCommand();
                    g.undo.push(t.selection.buildUndo()), l.insertInlineText(t, d, f, m, g, !0);
                    var v = t.findElemById(d.cid);
                    return t.brush.brushNode(d.cid), v.removeClass("md-expand"), p.moveToBookmark({
                        containerNode: v[0],
                        start: m + f.length,
                        end: m + f.length
                    }), (a = i(p.startContainer).closest(".md-image")).find("img").attr("src", "file://" + e), t.undo.register(g), window.getSelection(), a
                }

                if (e = this.resolveImagePath(e)) if (/\.(png|jpg|jpeg|svg|gif|bmp|webp|tiff)$/gi.exec(e)) {
                    var s, d = n, h = this, f = this.editor, m = this.getTagetImageStorageFolder();
                    if (this.shouldTriggerMove(e, m) && m) if (this.editor.undo.completeSnap(!0), File.isMac && "ipic" == m) {
                        if (app.ipic.validateBeforeUpload()) return this.editor.brush.clearAndPause(), s = a.call(this, d), h.uploadAction(s), void this.editor.brush.resume()
                    } else if (m && !t) return d = p.normalizePath(d), this.editor.brush.clearAndPause(), s = a.call(this, d), h.prepImageMove(m, File.isMac).then(function () {
                        T.call(h, s, m, d)
                    }), void this.editor.brush.resume();
                    (function () {
                        var t, a = r(), s = o(), c = f.selection.getRangy();
                        c && (t = i(c.startContainer).closest("[md-inline='image']")).length && !function (e) {
                            if (e.startContainer.parentElement.classList.contains("md-image-after-src") && e.startContainer.textContent.length == e.startOffset) return !0
                        }(c) ? (_.call(this, t, n, !0), this.selectComponent(!0)) : l.pasteHandler(this.editor, s + "![" + a + "](" + e + ")", !0, !0)
                    }).call(this)
                } else /\.(flv|mov|mp4|avi|ogg|webm)$/gi.exec(e) ? this.doInsertVideoFromURL(e) : /\.(wave|mp3|flac|aac)$/gi.exec(e) && this.doInsertAudioFromURL(e)
            }, doInsertVideoFromURL: function (e) {
                this.editor.undo.completeSnap(!0);
                var t = '<video src="{url}"></video>'.replace("{url}", e);
                l.pasteHandler(this.editor, t, !1, !0)
            }, doInsertAudioFromURL: function (e) {
                this.editor.undo.completeSnap(!0);
                var t = '<audio src="{url}"></audio>'.replace("{url}", e);
                l.pasteHandler(this.editor, t, !1, !0)
            }, doInsertFromURLs: function (e) {
                var t = this.editor;
                e.forEach(function (e, n) {
                    n > 0 && t.UserOp.insertParagraph(!1, t), t.imgEdit.doInsertFromURL(e)
                })
            }, resolveImagePath: function (e) {
                if (/^\/\//.exec(e)) return "https://" + e;
                if (/^[^:]+:\/\//.exec(e)) return e;
                var t = this.getLocalRootUrlForInsert(), n = p.getCurrentFileFolderPath();
                if (t && t.length) {
                    var i = f.getRelativePath(t, e);
                    t == n && (i = i.replace(/^\s*(\\\\|\/)/, "")), e = (!i.match(/^\.[\/\\]/) && this.editor.docMenu.getLocalRootUrl() ? "/" : "") + i
                } else {
                    if (!File.option.useRelativePathForImg || !n || 0 !== e.indexOf(n)) return e;
                    e = e.substring(n.length).replace(/^\//, "").replace(/\\/, "/")
                }
                return File.isWin && (e = e.replace(/[\/\\]{1,2}/g, "/")), e
            }, getTagetImageStorageFolder: function (e) {
                var t = this.editor.docMenu.getValueInMeta(b);
                if (t && !File.editor.sourceView.inSourceMode) {
                    if (File.option.allowImageUpload && "ipic" == t.toLowerCase()) return "ipic";
                    var n = p.getCurrentFileFolderPath();
                    if (n) return /[\\/]$/.exec(n[n.length - 1]) || (n += "/"), p.normalizePath(n + t.replace(/\${filename}/g, (File.getFileName() || "").replace(/\.[^.\/\\]+$/, "")), !0)
                }
                return e ? null : this.getTagetImageStorageFolderFromSetting()
            }, getTagetImageStorageFolderFromSetting: function () {
                if ("ipic" == File.option.defaultImageStorage) return "ipic";
                var e = p.getCurrentFileFolderPath();
                if (this.cachedFileImageStorage) return this.cachedFileImageStorage;
                var t = File.option.defaultImageStorage;
                if (e && (/[\\/]$/.exec(e[e.length - 1]) || (e += "/")), "folder" == t) {
                    if (e) return this.cachedFileImageStorage = p.normalizePath(e.replace(/[\\/]$/, ""), !0), this.cachedFileImageStorage
                } else if ("assert" == t) {
                    if (e) return this.cachedFileImageStorage = p.normalizePath(e + "assets", !0), this.cachedFileImageStorage
                } else if ("per-file-assert" == t) {
                    if (e) return this.cachedFileImageStorage = p.normalizePath(e + File.getFileName().replace(/\.[^.\/\\]+$/, "") + ".assets", !0), this.cachedFileImageStorage
                } else if (t && !a.isType(t, "ipic")) {
                    var n = File.getFileName();
                    if (t.indexOf("${filename}") > -1) {
                        if (!n) return null;
                        t = t.replace(/\${filename}/g, n.replace(/\.[^.\/\\]+$/, ""))
                    }
                    /^\.\.?[\\\/]/.exec(t) ? e && (this.cachedFileImageStorage = p.normalizePath(e + t, !0)) : this.cachedFileImageStorage = p.normalizePath(t, !0)
                }
                return this.cachedFileImageStorage || ""
            }, onFileMoved: function () {
                if ("per-file-assert" != !File.option.defaultImageStorage) {
                    this.getTagetImageStorageFolder();
                    this.cachedFileImageStorage = void 0
                }
            }, moveImageTo_: function (e, t, n, i) {
                T.call(this, e, t, n, i)
            }, copyToSelectedFolderAction: function () {
                var e = i(".md-expand.md-img-loaded");
                if (e) {
                    var t = this, n = t.getRealSrc(e.attr("data-src"));
                    /^file:\/\//.exec(n) && (n = n.replace(/^file:\/\//, "").replace(/[?#]([^.\/\\]*)$/, ""));
                    var r = p.getFileNameFromPath(n);
                    File.isMac ? app.ipic.selectImageSavePath(r, n, function (i, r) {
                        i && t.moveImageTo_(e, i, n, !0)
                    }) : m.dialog.showSaveDialog({
                        title: "Copy and update image srouce to..",
                        defaultPath: r
                    }, function (i) {
                        i && t.moveImageTo_(e, i, n, !0)
                    })
                }
            }, copyToTargetFolderAction: function () {
                this.editor.brush.clearAndPause();
                var e = i(".md-expand.md-img-loaded");
                if (e) {
                    var t = this.getAbsolutePath(e.attr("data-src")), n = this.getTagetImageStorageFolder(), r = this;
                    this.prepImageMove(n, File.isMac).then(function () {
                        r.moveImageTo_(e, n, t)
                    }), this.editor.brush.resume()
                }
            }, uploadAction: function (e, t) {
                if (e = e || i(".md-expand.md-img-loaded")) {
                    var n = this;
                    if (File.isMac && app.ipic.validateBeforeUpload()) {
                        var r = this.getRealSrc(e.attr("data-src")).replace(/^file:\/\//, "");
                        (function (e, t) {
                            return this.editor.brush.pause(), window.uploadImageQueue.add(t.replace(/^file:\/\//, "")), c.applyUploadingStyle(e, t, !1), t = t.replace(/^file:\/\//, ""), File.isWin && (t = t.replace(/^[\/\\]+/, "")), this.editor.brush.resume(), new Promise(function (e, n) {
                                app.ipic.upload(t, e, n)
                            })
                        }).call(n, e, r).then(function (i) {
                            t || C(i, r, e), e = S(r), _.call(n, e, i)
                        }, function (t) {
                            e = S(r), _.call(n, e, r), t && setTimeout(function () {
                                i("#md-notification").html("<p style='padding-right: 100px;'>" + i.localize.getString("Failed to upload image. Error Message:") + " <code>" + f.escape(t) + "</code><span class='btn-default btn-xs btn ok-btn' style='right: 40px;position: absolute;bottom: 8px;'>" + i.localize.getString("Close") + "</span></p>").show()
                            }, 500)
                        })
                    }
                }
            }, contextMenuItems: function (e) {
                var t = (e.getAttribute("src") || "").replace(/\?(.+)$/, ""), n = [],
                    i = this.getTagetImageStorageFolder();
                i && "ipic" != i && (i = i.replace(/[\\\/]$/, "") + (File.isWin ? "\\" : "/"));
                var r = f.escapeURL(i);
                if (i && "ipic" != i && (0 != t.replace(/^file:\/\//, "").indexOf(r) || t.replace(/^file:\/\//, "").substring(r.length + 1).match(/[\\\/]/g))) {
                    var o = f.getFolder(i);
                    o && n.push("copyImgToTarget-" + o.replace(/\|/g, ""))
                }
                return n.push("copyImgToSelect"), File.isMac && app.ipic.quickValidate() && ("ipic" == i ? n.unshift("uploadImg") : n.push("uploadImg")), /^file:\/\//.exec(t) && n.unshift("revealInFinder"), n
            }, afterUserInsertImage: function (e) {
                var t = (e.getAttribute("src") || "").replace(/\?(.+)$/, "");
                if (t != this.lastUrl && e.parentElement && e.parentElement.contains(window.getSelection().anchorNode)) {
                    var n = [], r = this.editor, o = this.getTagetImageStorageFolder();
                    if (o && "ipic" != o) {
                        o = o.replace(/[\\\/]$/, "") + (File.isWin ? "\\" : "/"), t = t.replace(/^file:\/\//, ""), File.isWin && (t = t.replace(/^[\/\\]+/, ""));
                        var a = f.escapeURL(o);
                        if (0 != t.replace(/[\\]/g, "/").indexOf(a) || t.substring(a.length + 1).match(/[\\\/]/g)) {
                            var s = f.getFolder(o);
                            s && n.push({label: "Copy to %@", key: "move-img-to-target", variable: s})
                        } else this.lastUrl = t
                    }
                    if (n.push({
                        label: "Copy Image to...",
                        key: "select-img-target"
                    }), File.isMac && app.ipic.quickValidate() && ("ipic" == o ? n.unshift({
                        label: "Upload via iPic",
                        key: "upload-img"
                    }) : n.push({label: "Upload via iPic", key: "upload-img"})), n.length) {
                        var l = r.selection.getRangy(), c = i(l.endContainer).closest("[md-inline='image']");
                        l && c.length && !c.hasClass("md-on-moving") && !c.hasClass("md-on-uploading") && r.contextMenu.showCustom(n, "image")
                    }
                }
            }, toggleCopyToFolder: function () {
                var e = reqnode("electron").remote, t = e.getCurrentWindow(), n = e.dialog, r = this,
                    o = this.getTagetImageStorageFolder(!0), a = p.getCurrentFileFolderPath();
                if (File.refreshImageCopyStatus(!0), !File.isLocked && !File.editor.sourceView.inSourceMode) if (o) this.doRemoveImageCopyToFolder(!1); else {
                    if (!a) return void n.showMessageBox(t, {
                        title: i.localize.getString("Document must be saved first.", "Panel"),
                        message: i.localize.getString("Typora will copy newly inserted image to folder by selected relative path, so please save the file first.", "Panel"),
                        buttons: [i.localize.getString("OK")]
                    });
                    n.showOpenDialog(t, {
                        defaultPath: p.getCurrentFileFolderPath(),
                        title: i.localize.getString("Select Container Folder"),
                        properties: ["openDirectory", "createDirectory"],
                        buttonLabel: i.localize.getString("Select")
                    }, function (e) {
                        e && 0 != e.length && r.doSetImageCopyToFolder(e[0])
                    })
                }
            }, toggleUseImageRootPath: function () {
                var e = reqnode("electron").remote, t = e.getCurrentWindow(), n = e.dialog,
                    r = this.editor.docMenu.getLocalRootUrl(), o = this.editor;
                r ? this.editor.docMenu.removeProperty("typora-root-url") : n.showOpenDialog(t, {
                    defaultPath: p.getCurrentFileFolderPath(),
                    title: i.localize.getString("Select Container Folder"),
                    properties: ["openDirectory", "createDirectory"],
                    buttonLabel: i.localize.getString("Select")
                }, function (e) {
                    e && 0 != e.length && o.imgEdit.doSetImageRootPath(e[0])
                })
            }, doSetImageCopyToFolder: function (e, t) {
                e = t && File.isMac ? "ipic" : f.getRelativePath(p.getCurrentFileFolderPath(), e, !0), this.editor.docMenu.writeProperty(b, e)
            }, doSetImageRootPath: function (e) {
                this.editor.docMenu.writeProperty("typora-root-url", f.getRelativePath(p.getCurrentFileFolderPath(), e, !0)), this.refreshLocalImg()
            }, doRemoveImageCopyToFolder: function (e) {
                return this.editor.docMenu.removeProperty(b, e)
            }
        });

        function A(e) {
            return !!/^\s*(file|data):/.exec(e)
        }

        var N = {};
        n.exports = M
    }), $__System.registerDynamic("30", ["13", "e", "1b", "1e", "12", "25"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i = e("13"), r = e("e"), o = e("1b"), a = e("1e"), s = e("12"), l = s.Node, c = e("25").map, d = l.TYPE,
            u = i.WESTERN_WORD_SPLITER, h = function (e) {
                this.rangy = o, o.init(), this.savedSel = {}, this.editor = e, r(document).on("selectionchange", function (t) {
                    e.selection.selectWordTime && new Date - e.selection.selectWordTime > 200 && (e.selection.selectWordTime = null)
                }), this.updateMetrics()
            }, f = !1, p = r.fn.scrollTop;
        r.fn.oldScrollTop = p, r.fn.scrollTop = function (e) {
            if (void 0 === e || !f) return p.apply(this, arguments)
        };
        var m;
        r(document.body).on("hidden.bs.modal", ".modal", function (e) {
            File.editor.restoreLastCursor()
        }).on(".show.bs.modal", ".modal", function () {
            var e = File.editor.selection.buildUndo();
            e && (File.editor.lastCursor = e)
        });

        function g(e) {
            return !1
        }

        function v(e) {
            r("content").on(e ? "scroll" : "DOMMouseScroll mousewheel", g), setTimeout(function () {
                r("content").off(e ? "scroll" : "DOMMouseScroll mousewheel", g)
            }, 500)
        }

        v(), o.rangePrototype.insertNodeAtEnd = function (e) {
            var t = this.cloneRange();
            t.collapse(!1), t.insertNode(e), t.detach(), this.setEndAfter(e)
        };
        var y;
        r("window").on("resize", function () {
            File.suppressResize || (y = document.querySelector("content").clientHeight)
        }), h.prototype = {
            preventScrollOnce: v, enableScroll: function (e) {
                r("content").off(e ? "scroll" : "DOMMouseScroll mousewheel", g)
            }, clearGlobalColumn: function () {
                m = void 0
            }, updateMetrics: function () {
                y = document.querySelector("content").clientHeight, r("content").offset().top, this.editor.defaultTextHeight = parseInt(r("#write p").css("line-height"))
            }, jumpIntoElemBegin: function (e, t) {
                try {
                    var n = this, i = this.editor, a = e.find(".CodeMirror")[0], s = e.children("[mdtype]");
                    if (!e || !e.length) return Reporter.error("cannot jumpIntoElemBegin to empty elem", {level: "warning"}), window.getSelection().removeAllRanges(), !1;
                    if (e.length > 1 && (e = r(e[0])), a) return a.CodeMirror.focus(), a.CodeMirror.execCommand("goDocStart");
                    if (S(i, !1, i.findNodeByElem(e))) return;
                    if (l.isType(e.attr("mdtype"), l.TYPE.image, l.TYPE.hr, l.TYPE.math_block)) return this.selectNode(null, e);
                    if (e.hasClass("footnotes")) return this.jumpIntoElemBegin(e.find(".md-def-name"));
                    if (s.length) return this.jumpIntoElemBegin(r(s[0]), t);
                    var c = o.createRange();
                    return c.setStart(e[0], 0), c.setEnd(e[0], 0), this.deRange(c), n.setRange(c, !0), t ? setTimeout(function () {
                        n.setRange(c, !0), n.editor.refocus()
                    }, 20) : !window.getSelection().anchorNode && e.length && (!function e(t) {
                        3 == t.nodeType ? (c.setStart(t, 0), c.setEnd(t, 0)) : t.childNodes.length ? e(t.childNodes[0]) : (c.setStart(t, 0), c.setEnd(t, 0))
                    }(e[0]), window.getSelection().addRange(c.nativeRange)), window.getSelection().anchorOffset
                } catch (t) {
                    Reporter.error("cursor may go wrong", {
                        level: "warning",
                        filename: "Selection.js",
                        extra: {dom: Reporter.sanitizeDom(e[0])}
                    })
                }
            }, jumpIntoElemEnd: function (e, t) {
                var n = e.find(".CodeMirror")[0];
                if (e.length > 1 && (e = r(e[0])), n) n.CodeMirror.execCommand("goDocEnd"); else {
                    if (S(this.editor, !0, this.editor.findNodeByElem(e))) return;
                    if (l.isType(e.attr("mdtype"), l.TYPE.image, l.TYPE.hr, l.TYPE.math_block)) return this.selectNode(null, e);
                    if (e.children("[mdtype]").length) return this.jumpIntoElemEnd(r(e.children("[mdtype]")[0]), t);
                    e.addClass("md-expand"), this.restoreSelection(e[0], e.text().length), e.removeClass("md-expand")
                }
            }, jumpInto: function (e, t) {
                if ("" == e.text()) return this.jumpIntoElemBegin(e);
                this.restoreSelection(e[0], t)
            }, setRange: function (e, t) {
                this.editor.brush.updateWordCountInSelection(), t || (this.editor.brush.closestExpandable(r(e.startContainer)).addClass("md-expand"), this.editor.brush.closestExpandable(r(e.endContainer)).addClass("md-expand")), e.commonAncestorContainer && e.commonAncestorContainer.getAttribute && "linebreak" == e.commonAncestorContainer.getAttribute("md-inline") && "\n" == e.toString() && e.collapse(!0), File.isTypeWriterMode && File.option.scrollWithCursor && this.typeWriterScroll(e.nativeRange || e), this.rangy.getSelection().setSingleRange(e, e.isBackward)
            }, getOffset: function (e, t) {
                if (t = t || this.getRangy()) try {
                    return t.getBookmark(e[0]).start
                } catch (e) {
                }
                return 0
            }, restoreEdge: function (e, t, n, i) {
                e.jquery && (e = e.length ? e[0] : null);
                var a, s = 0, l = {};
                if (!n) {
                    var c = r(e).closest("[mdtype='line'], [mdtype='heading']");
                    a = c.length && t < c.text().length
                }
                i = i || o.createRange();
                try {
                    e && function e(r) {
                        if (3 == r.nodeType) {
                            var o = s + r.textContent.length;
                            if (n) {
                                if (t >= s && t <= o) throw i.setEnd(r, t - s), l
                            } else if (a) {
                                if (t >= s && t < o) throw i.setStart(r, t - s), l
                            } else if (t >= s && t <= o) throw i.setStart(r, t - s), l;
                            s = o
                        } else {
                            r.childNodes.length || r.nodeType !== r.ELEMENT_NODE || r.appendChild(document.createTextNode(""));
                            for (var c = 0, d = r.childNodes.length; c < d; ++c) e(r.childNodes[c])
                        }
                    }(e)
                } catch (e) {
                    if (e == l) return i;
                    throw e
                }
                return i
            }, saveSelection: function (e, t) {
                if (e) {
                    e.jquery && (e = e[0]);
                    return (t = t || this.getRangy()) ? (this.savedSel = t.getBookmark(e), this.savedSel) : void 0
                }
            }, restoreSelection: function (e, t) {
                if (!e) return window.getSelection().removeAllRanges();
                if (e.jquery && (e = e[0]), !e) return window.getSelection().removeAllRanges();
                var n = "false" === e.getAttribute("contenteditable");
                if (void 0 === t || null === t || "" === t ? t = this.savedSel : "number" == typeof t && (t = {
                    start: t,
                    end: t
                }), !x(this.editor, e, t.start)) {
                    var i = o.createRange();
                    if (i.moveToBookmark({
                        start: t.start,
                        end: t.end,
                        containerNode: e
                    }), i.endContainer == e && 0 == i.endOffset && t.end > 0) {
                        var a = e.rawText().length;
                        t.end > a && i.moveToBookmark({
                            start: Math.min(t.start, a),
                            end: Math.min(t.end, a),
                            containerNode: e
                        })
                    }
                    if ("BODY" == document.activeElement.tagName || document.activeElement.hasAttribute("tabindex")) {
                        var s = r("content").scrollTop();
                        this.editor.writingArea.focus(), r("content").scrollTop(s)
                    }
                    return i.collapsed && this.deRange(i), n && e.setAttribute("contenteditable", "true"), this.setRange(i), n && e.setAttribute("contenteditable", "false"), i
                }
            }, getVeryFirstElem: function (e) {
                return e.children("[cid]").length > 0 ? this.getVeryFirstElem(e.children("[cid]").first()) : e
            }, getVeryLastElem: function (e) {
                return e.children("[cid]").length > 0 ? this.getVeryLastElem(e.children("[cid]").last()) : e
            }, getSelection: function () {
                return this.rangy.getSelection()
            }, prepNode: function (e, t, n, i) {
                var r, a = this.editor, c = this.getRangy(), u = this.editor.undo.UndoManager, h = u.SnapFlag,
                    f = c && !c.collapsed;
                m = void 0, File.inBusyMode && setAttributeOnlyNeeded(this.editor.writingArea, "contenteditable", "false");
                try {
                    if (f) {
                        if (n) return r;
                        if (a.undo.completeSnap(!0), a.UserOp.surroundPair(a, e, c)) return void(t && t.preventDefault());
                        r = a.UserOp.backspaceHandler(a, null, "delSelection", !0, !0)
                    }
                    c = this.getRangy();
                    var p, g, v = this.rangy.getSelection(), y = v.anchorOffset == o.dom.getNodeLength(v.anchorNode),
                        b = a.getJQueryElem(v.anchorNode), w = a.getMarkElem(v.anchorNode), C = a.findNodeByElem(w),
                        x = c.getBookmark(w[0]);
                    if (b.hasClass("ty-input")) return;
                    if (r || n || (a.undo.snap(C.cid, h.ADD, void 0, i), a.brush.addToQueue(C.cid)), File.inBusyMode) {
                        var k = b.closest("[contenteditable='true']");
                        document.activeElement !== k[0] && k.focus()
                    }
                    if (b.hasClass("md-def-url") && (e.match(/\s/g) || []).length) return y && this.jumpIntoElemBegin(w.find(".md-def-title")), t && t.preventDefault();
                    !n && r && a.undo.snap(w.attr("cid"), e.length || h.ADD, a.docMenu.getAttrByElem(b));
                    if ((w.is(".unholdable") ? w : w.closest(".unholdable")).find(".md-math-after-sym").text(""), C.get("type") == d.meta_block || C.get("type") == d.fences || (C.isBlock() && C.canNotDirectEdit() ? (window.getSelection().removeAllRanges(), t && t.preventDefault()) : b.hasClass("md-image") && (1 != c.startOffset || b.prev().length || (b.before("​"), c.setStartBefore(b.parent()), v.setSingleRange(c)))), C.get("children").length) {
                        var S = window.getSelection().anchorNode.childNodes, E = window.getSelection().anchorOffset,
                            F = E > 0 ? S[E - 1] : null, _ = E < S.length ? S[E] : null,
                            T = a.findNodeByElem(F ? a.getMarkElem(F) : []),
                            M = a.findNodeByElem(_ ? a.getMarkElem(_) : []);
                        if (e = e.replace("​", ""), l.isType(M, s.TYPE.table)) {
                            a.undo.completeSnap(!0), r = r || u.makeEmptyCommand();
                            var A = new l({type: s.TYPE.paragraph, text: e, in: M.get("in")});
                            M.insert(A, !0), u.addUndoForInsert(r, A), a.findElemById(M.id).before(A.toHTML()), a.selection.restoreSelection(a.findElemById(A.id)[0], e.length), p = A
                        } else if (l.isType(T, s.TYPE.table)) {
                            a.undo.completeSnap(!0), r = r || u.makeEmptyCommand();
                            A = new l({type: s.TYPE.paragraph, text: e, in: T.get("in")});
                            T.insert(A), u.addUndoForInsert(r, A), a.findElemById(T.id).after(A.toHTML()), a.selection.restoreSelection(a.findElemById(A.id)[0], e.length), p = A
                        } else M ? (M = M.getVeryFirst(), a.undo.snap(M.cid, h.ADD), M.set("text", e + M.safeGetStrAttr("text", !0)), a.findElemById(M.id).replaceWith(M.toHTML()), M && a.selection.jumpInto(a.findElemById(M.id), 1), r = null) : T && (T = T.getVeryFirst(!0), a.undo.snap(T.cid, h.ADD), T.set("text", T.safeGetStrAttr("text", !0) + e), a.findElemById(T.id).replaceWith(T.toHTML()), a.selection.jumpIntoElemEnd(a.findElemById(T.id)), r = null);
                        r && r.redo.push(this.buildUndo()), !n && a.refocus(p.id), t && t.preventDefault()
                    }
                    return n || (f ? r && (a.UserOp.insertInlineText(a, C, e, x.start, r, !0), u.append(r, a.undo.completeSnap(!0, !0)), t && t.preventDefault()) : (File.isMac || (g = a.UserOp.hanldePair(a, e, C, x, r, c)) || (g = a.UserOp.PunctuationOp.handlerCh(a, e, C, x, r, c)), g || (g = a.htmlBlock.autoCloseTagWhenInput(a, e, C, x, r, c)), g && ("object" == typeof g && (r = g), t && t.preventDefault()))), !n && r && this.editor.undo.register(r), r
                } catch (e) {
                    console.warn(e)
                }
            }, getPosBookmark: function () {
                var e = editor.getMarkElem();
                if (e.length) {
                    var t = this.editor.fences.queue[e.attr("cid")];
                    if (t) return {isCm: t, cid: t.cid, start: t.indexFromPos(t.getCursor())};
                    return null
                }
            }, getRangy: function (e) {
                var t = this.rangy.getSelection(), n = t.rangeCount ? t.getRangeAt(0) : null;
                return n && (n.isBackward = t.isBackward(), e && this.deRange(n)), n
            }, buildUndo: function (e, t) {
                var n = {};
                if (n.type = "cursor", this.editor.sourceView.inSourceMode) return n.pos = this.editor.sourceView.cm.getCursor(), n.inSourceMode = !0, n;
                try {
                    if ((t = ((e = e || this.getRangy()) && e.commonAncestorContainer ? this.editor.getMarkElem(e.commonAncestorContainer) : t) || this.editor.getMarkElem()).find(".CodeMirror").length) {
                        var i = t.find(".CodeMirror")[0].CodeMirror;
                        n.id = i.cid, n.pos = i.getCursor(), n.selections = i.listSelections()
                    } else if (t.attr("mdtype") && t.children("[tabindex]").addBack("[tabindex]").length) n.id = t.attr("cid"), n.focus = t.attr("mdtype"); else {
                        if (!e) return null;
                        var r = this.editor.getMarkElem(this.getDetailPos(e.startContainer, e.startOffset)[0]),
                            o = this.editor.getMarkElem(this.getDetailPos(e.endContainer, e.endOffset)[0]),
                            a = e.getBookmark(r[0]), s = e.startContainer.parentElement;
                        if (s.classList.contains("md-pants") && s.textContent[0] != s.dataset.content && s.textContent.length && (a.start--, a.end--), r === o) {
                            if (n.id = r.attr("cid"), !n.id) return null;
                            n.start = a.start, n.end = a.end
                        } else {
                            if (n.startId = r.attr("cid"), n.endId = o.attr("cid"), !n.startId || !n.endId) return null;
                            n.start = a.start, n.end = e.getBookmark(o[0]).end
                        }
                    }
                } catch (e) {
                    return e.stack, null
                }
                return n
            }, selectNode: function (e, t) {
                (t = t || editor.findElemById(e.id)).length && void 0 !== t.attr("tabindex") && (window.getSelection().removeAllRanges(), t.addClass("onfocus"), t.focus())
            }, extendToLineEdge: function (e, t, n) {
                t = t || this.editor.getMarkElem()[0];
                var i = this.getRangy();
                if (i && t && !isInputComponent(t)) {
                    var r = i.getBookmark(t), a = o.createRange();
                    return e ? r.end = t.textContent.length : r.start = 0, a.moveToBookmark(r), !n && this.setRange(a), a
                }
            }, extendCharFromCollapse: function (e, t) {
                var n, i = !1, r = !t;
                if (e.commonAncestorContainer.nodeType == document.TEXT_NODE && (t && e.startOffset > 0 && (e.setStart(e.startContainer, e.startOffset - 1), e.startOffset > 0 && (n = e.toString().charCodeAt(0)) >= 56320 && n <= 57343 && (e.setStart(e.startContainer, e.startOffset - 1), (n = e.toString().charCodeAt(0)) >= 55296 && n <= 56319 || e.setStart(e.startContainer, e.startOffset + 1)), i = !0), r && e.endOffset < e.commonAncestorContainer.textContent.length && (e.setEnd(e.endContainer, e.endOffset + 1), (n = e.toString().charCodeAt(e.toString().length)) >= 55296 && n <= 56319 && e.endOffset < e.commonAncestorContainer.textContent.length && e.setEnd(e.endContainer, e.endOffset + 1), i = !0)), !i) {
                    var o = this.editor.getMarkElem(e.startContainer)[0], a = e.getBookmark(o);
                    if (t && 0 === a.start || r && a.end >= o.textContent.length) return !1;
                    t ? a.start-- : a.end++, e.moveToBookmark(a)
                }
                return e
            }, moveLeftOrRight: function (e, t) {
                m = void 0;
                var n = this.editor.getMarkElem()[0], i = this.getRangy(), a = this.editor;
                if (!(t && isInputComponent(t.target) || !i) && n) {
                    !File.inBusyMode || i && !r(i.startContainer).closest("[contenteditable='false'][cid]").length || a.writingArea.setAttribute("contenteditable", "true");
                    var s;
                    if (!t || !(s = r(t.target).closest("[mdtype='table_cell']")).length || s.closest("th").length && !s.closest("th").prev().length) {
                        var l = i.getBookmark(n), c = o.createRange();
                        if (t && i.toString().length && !t.metaKey && !t.ctrlKey && !t.shiftKey) {
                            i.collapse(e), this.setRange(i, !0);
                            var d = this.editor.getMarkElem(i.startContainer);
                            return d.length && S(this.editor, !e, this.editor.findNodeByElem(d)), t.preventDefault(), !0
                        }
                        if (t && !t.metaKey) {
                            if (e && 0 === l.start) return this.moveUpOrDown(!0, t, !0);
                            if (!e && l.end >= n.textContent.length && (!n.classList.contains("md-def-link") || 0 != a.getJQueryElem(i.startContainer).closest(".md-def-title").length)) return this.moveUpOrDown(!1, t, !0);
                            var u = document.querySelector(".ty-focusable-btn.selected");
                            if (u && !t.ctrlKey && !t.shiftKey && l.end == l.start) return u.classList.remove("selected"), l.end += e ? -1 : 1, l.start += e ? -1 : 1, c.moveToBookmark(l), this.setRange(c, !0), t.preventDefault(), !0
                        }
                        if (File.isNodeHtml && !e && t && t.ctrlKey && !t.shiftKey) {
                            var h = n.textContent.substring(l.end) || "";
                            if (/^\w+$/.exec(h)) return l.start = l.end = n.textContent.length, c.moveToBookmark(l), this.setRange(c, !0), t.preventDefault(), !0
                        }
                        if (e ? (l.end = l.start, l.start--) : (l.start = l.end, l.end++), c.moveToBookmark(l), /\u200b|\007F/g.exec(c.toString())) return c.collapse(e), this.setRange(c, !0), !0;
                        if (f = c, r(e ? f.startContainer : f.endContainer).closest(".md-inline-math").addClass("md-expand").length && !t.ctrlKey && !t.metaKey && !t.altKey) return c.collapse(e), this.setRange(c, !0), t && t.preventDefault(), !0;
                        var f
                    }
                }
            }, addUnholdable: function (e, t, n, i) {
                this.editor.undo.completeSnap(!0);
                var o = function (e, t, n) {
                    var i = d.paragraph;
                    e.get("type") == d.list_item && (i = d.list_item);
                    var r = new l({type: i});
                    return e.insert(r, t), l.normalizeNode(r), r
                }(e, n), a = this.editor.findElemById(e.id), s = n ? e : void 0, c = n ? void 0 : e;
                return n ? a.before(o.toHTML()) : a.after(o.toHTML()), t = t || this.editor.undo.UndoManager.makeEmptyCommand(), r(".unholdable").removeClass("unholdable"), this.editor.findElemById(o.id).addClass(i ? "" : "unholdable"), this.editor.undo.UndoManager.addUndoForInsert(t, o, c, s), t.discardable = !0, o
            }, jumpToNextBlock: function (e, t) {
                var n, i = e.getClosetBlock(!0).getVeryFirstBrotherIncludeTopBlock(!1);
                if (i) ; else {
                    if (!t) return void window.getSelection().removeAllRanges();
                    i = this.addUnholdable(e, t)
                }
                n = this.editor.findElemById(i.cid), this.jumpIntoElemBegin(n), t.redo.push(this.buildUndo());
                var r = this.editor;
                setTimeout(function () {
                    r.refocus()
                }, 50)
            }, moveUpOrDown: function (e, t, n) {
                File.inBusyMode && t && (t.shiftKey || t.metaKey || t.ctrlK) && this.editor.writingArea.setAttribute("contenteditable", "true");
                var i, o = this.getRangy(), a = this, u = t && l.isType(c[t.keyCode || t.which], "Right", "Left"),
                    h = File.isNode && t && t.ctrlKey && !t.shiftKey;

                function f(e, t) {
                    return t ? !e || l.isType(e, d.fences, d.html_block, d.table, d.math_block, d.hr, d.toc) : l.isType(e, d.fences, d.html_block, d.table, d.math_block, d.hr, d.toc, d.def_footnote, d.def_link)
                }

                function p(e, t, n, i, r) {
                    var o = e.getVeryFirstBrotherIncludeTopBlock(t), s = a.editor.undo.UndoManager.makeEmptyCommand();
                    return (!u && !o && !e.get(t ? "before" : "after") || f(e) && f(e.get(t ? "before" : "after"), !0)) && (t && l.isType(e, e.TYPE.meta_block) || (o = a.addUnholdable(function e(t, n) {
                        if (l.isType(t, d.fences, d.html_block, d.table, d.hr, d.def_link, d.def_footnote)) return t;
                        var i = n ? "before" : "after";
                        return t.get("parent") ? t.get("parent").get(i) ? t : t.get(i) ? t : e(t.get("parent")) : t
                    }(e), s, t))), s.undo.push(a.buildUndo()), n && n(), h ? a.jumpIntoElemBegin(a.editor.findElemById(o.id), !0) : y(o, i, s, r), s
                }

                function g(e, n, i) {
                    T = p(e.getClosetBlock(), n, void 0, i), t && t.preventDefault(), a.editor.undo.UndoManager.isEmptyCommand(T) || (T.redo.push(a.buildUndo()), a.editor.undo.register(T)), a.scrollAdjust()
                }

                function v(e, n, s, l) {
                    var c, u = s || a.editor.fences.getCm(e.id),
                        f = (u.doc.getCursor(), l[0].contains(document.activeElement) && document.activeElement.classList.contains("ty-input")),
                        g = n && 0 == u.doc.getCursor().line, v = !n && u.doc.getCursor().line == u.lineCount() - 1;
                    if (g && n && (g = (c = u.cursorCoords().top) == u.cursorCoords({
                        line: 0,
                        ch: 0
                    }).top), v && !n && (v = (c = u.cursorCoords().top) == u.cursorCoords({
                        line: u.lineCount() - 1,
                        ch: u.getLine(u.lineCount() - 1).length
                    }).top), h && (g = !0), s || !r(".autoComplt-list").is(":visible")) {
                        if (void 0 == m && (m = f ? r(document.activeElement).offset().left + document.activeElement.clientWidth : u.cursorCoords(u.getCursor()).right), f) {
                            var y = document.activeElement.classList.contains("ty-input-before");
                            if (!y && n) return a.editor.fences.jumpCmEnd(u), k(u, m), b(t);
                            if (y && !n) return a.editor.fences.jumpCmBegin(u), k(u, m), b(t);
                            (v = v || document.activeElement.classList.contains("ty-input-after")) && r(document.activeElement).closest(".md-tooltip-hide").hide()
                        } else if (v && !n) {
                            if (e.get("type") == d.fences || e.get("type") == d.math_block && e.get("tagAfter")) return u.getInputField().blur(), setTimeout(function () {
                                a.selectAllElem(l.find(".ty-input-after").focus())
                            }, 0), b(t)
                        } else if (g && n && e.get("type") == d.math_block && e.get("tagBefore")) return u.getInputField().blur(), setTimeout(function () {
                            a.selectAllElem(l.find(".ty-input-before").focus())
                        }, 0), b(t);
                        if (g || v) {
                            var w = u.getCursor();
                            f || (h = !m && (0 == w.ch || c != u.cursorCoords({
                                line: w.line,
                                ch: w.ch - 1
                            }).top), i = E(o.nativeRange) || {}), T = p(e, n, function () {
                                u.getInputField().blur()
                            }, l, f ? m : i.x), n && !a.editor.undo.UndoManager.isEmptyCommand(T) && (T.redo.push(a.buildUndo()), a.editor.undo.register(T)), b(t)
                        }
                        t && t.stopPropagation()
                    }
                }

                function y(i, s, c, u) {
                    if (i) {
                        var h = a.editor.findElemById(i.id);
                        f = s.closest(".unholdable"), p = _, g = c, f.hasClass("unholdable") && p && (f.text().length ? f.removeClass("unholdable") : (a.editor.undo.UndoManager.addUndoForRemove(g, p), g.redo.push(a.buildUndo()), p.remove(), f.remove(), a.editor.undo.register(g)));
                        var f, p, g;
                        if (S(a.editor, e, i, t, c, m)) ; else {
                            if (C(h)) return b(t), h.find("img:first").trigger("click"), !0;
                            if (l.isType(i, d.table, d.table_row, d.table_cell)) a.jumpIntoElemBegin(h), b(t); else if (l.isType(i, d.paragraph, d.heading, d.def_link, d.def_footnote) && !i.get("text")) a.jumpIntoElemBegin(h), t && t.preventDefault(); else if (l.isType(i, d.meta_block) && e) a.jumpIntoElemEnd(h), t && t.preventDefault(); else if (h.length) {
                                if (n || 0 == s.closest("#write").length) e ? a.jumpIntoElemEnd(h) : a.jumpIntoElemBegin(h); else {
                                    editor.selection.scrollAdjust(h, void 0, !0, !0), File.inBusyMode && editor.writingArea.setAttribute("contenteditable", "true");
                                    var v = o && o.getBookmark(s[0]).end == s.text().length ? m : u;
                                    if (void 0 != v) {
                                        var y = a.getRangy(), w = null;
                                        if (y && y.nativeRange.getClientRects()[0] || void 0 != u) {
                                            var x = (h.children[0] || h[0]).getBoundingClientRect(),
                                                k = e ? x.y + x.height - 3 : x.y + 3;
                                            w = document.caretRangeFromPoint(v, k)
                                        }
                                        w && (h[0] == w.startContainer || h[0].contains(w.startContainer)) ? a.setRange(w) : void 0 != u ? e ? a.jumpIntoElemEnd(h) : a.jumpIntoElemBegin(h) : window.getSelection().modify("move", e ? "backward" : "forward", "line")
                                    } else e ? a.jumpIntoElemEnd(h) : a.jumpIntoElemBegin(h)
                                }
                                File.isFocusMode && (r(".md-focus").removeClass("md-focus"), h.addClass("md-focus")), b(t)
                            }
                        }
                    }
                }

                try {
                    var x = this.editor.getMarkElem(o && o.startContainer), F = x.attr("mdtype"),
                        _ = this.editor.findNodeByElem(x), T = a.editor.undo.UndoManager.makeEmptyCommand();
                    if (!_) return;
                    if (w(_, x) || x.hasClass("rawedit")) g(_, e, x); else if (F == s.TYPE.fences) v(_, e, void 0, x); else if (F == s.TYPE.html_block && this.editor.htmlBlock.currentCm) v(_, e, this.editor.htmlBlock.currentCm, x); else if (F == s.TYPE.math_block && this.editor.mathBlock.currentCm) v(_, e, this.editor.mathBlock.currentCm, x); else if (x.closest(".td-span").length) {
                        var M = function (e, t) {
                            var n, i = e.closest("td"), r = i.prevAll().length + 1;
                            if (!i.length) {
                                if (t) return [];
                                r = (i = e.closest("th")).prevAll().length + 1
                            }
                            return "TD" == i[0].tagName ? (n = i.closest("tr")[t ? "prev" : "next"]().find("td:nth-child(" + r + ")>.td-span"), t && !n.length && (n = i.closest("tbody").prev().find("tr:last > th:nth-child(" + r + ") > .td-span")), n) : t ? [] : i.closest("thead").next().find("tr:first > td:nth-child(" + r + ")>.td-span")
                        }(x.closest(".td-span"), e);
                        if (M.length) t && t.preventDefault(), e ? this.jumpIntoElemEnd(M) : this.jumpIntoElemBegin(M), this.scrollAdjust(void 0, void 0, !0); else {
                            if (u) return b(t), !1;
                            g(_, e, x)
                        }
                    } else if (x.closest(".md-meta-block").length && !e) !x.text().substring(window.getSelection().focusOffset).match(/\S+\n+/) && g(_, e, x); else {
                        void 0 == m && (m = (o.nativeRange.getClientRects()[0] || {}).left);
                        var A = _.getClosetBlock(!0).getVeryFirstBrotherIncludeTopBlock(e);
                        if (T.undo.push(this.editor.lastCursor), function (e, t, n) {
                            if ((n = n || this.getRangy()).collapsed) {
                                if (!(i = E(n.nativeRange)) || !e.length) return 0 == e.text().length;
                                var r = e[0].getBoundingClientRect();
                                return t ? !!function (e, t) {
                                    var n = t.endContainer.nodeType == document.TEXT_NODE ? t.endContainer.parentElement.parentElement : null;
                                    if (n && n.classList.contains("md-meta") && (n = n.parentElement), n && n.classList.contains("md-image")) {
                                        if (t.endContainer.textContent.length == t.endOffset && e.rawText().length == t.getBookmark(e[0]).end) return !0;
                                        var i = t.nativeRange.getClientRects();
                                        if (!i.length) return;
                                        var r = i[i.length - 1], o = document.elementFromPoint(r.x, r.y + 28);
                                        if (o && "IMG" == o.tagName && (t.collapseAfter(o), e.rawText().length == t.getBookmark(e[0]).end)) return !0
                                    }
                                }(e, n) || r.bottom - i.bottom < parseInt(e.css("paddingBottom")) + 10 : i.top - r.top < parseInt(e.css("paddingTop")) + 10
                            }
                        }.call(this, x, !e)) A ? y(A, x, T) : !e && x.text().trim().length && g(_, e, x); else {
                            var N = r(o.commonAncestorContainer.parentElement);
                            if (!e && N.hasClass("md-image-after-src")) {
                                var L = N.closest(".md-image").next();
                                return L.length ? (a.jumpIntoElemBegin(L), b(t)) : g(_, e, x), !1
                            }
                            if (!e && o.collapsed && o.startContainer.parentElement.classList.contains("md-def-name") && i && i.left) {
                                var R = i.left, D = e ? i.top - 9 : i.bottom + 9,
                                    O = document.caretRangeFromPoint(R, D);
                                this.setRange(O, !0), b(t)
                            } else if (File.isTypeWriterMode && File.option.scrollWithCursor && i && i.left) {
                                R = i.left, D = e ? i.top - 9 : i.bottom + 9, O = document.caretRangeFromPoint(R, D);
                                this.editor.writingArea.contains(O.startContainer) && (E(O) || {}).top != i.top && (this.setRange(O), b(t))
                            }
                        }
                    }
                } catch (e) {
                    e.stack
                }
            }, click: function (e, t, n) {
                window.getSelection().removeAllRanges();
                var i = document.createEvent("MouseEvent"), r = document.elementFromPoint(e, t);
                n = "click", i.initMouseEvent(n, !0, !0, window, null, e, t, 0, 0, !1, !1, !1, !1, 0, null), r.dispatchEvent(i)
            }, jumpDefComponent: function (e) {
                var t = this.editor.getMarkElem(), n = o.createRange();
                e ? (n.selectNodeContents(t.children(".md-def-name")[0]), this.deRange(n, !0)) : (n.selectNodeContents(t.children(".md-def-content")[0]), this.deRange(n, !0)), this.editor.refocus()
            }, jumpSelection: function () {
                return this.scrollAdjust(null, 20)
            }, jumpTop: function (e) {
                var t = this.editor;
                if (t.sourceView.inSourceMode) t.sourceView.cm.execCommand("goDocStart"); else {
                    var n = this.getRangy();
                    e && n ? (n.setStart(t.writingArea, 0), this.deRange(n, !0)) : t.nodeMap && this.jumpIntoElemBegin(t.findElemById((t.nodeMap.getFirst() || {}).cid)), File.isTypeWriterMode || r("content").animate({scrollTop: 0}, "100", "swing", function () {
                        t.docMenu.highlightVisibleHeader()
                    })
                }
            }, jumpBottom: function (e) {
                var t = this.editor;
                if (t.sourceView.inSourceMode) t.sourceView.cm.execCommand("goDocEnd"); else {
                    var n = this.getRangy();
                    if (e && n) {
                        n.setEnd(t.writingArea, t.writingArea.childNodes.length), n = this.deRange(n, !0);
                        try {
                            n.endContainer.parentElement.classList.contains("md-def-title") && "" == n.endContainer.parentElement.textContent && (n.setEndAfter(n.endContainer.parentElement.previousSibling.previousSibling), n = this.deRange(n, !0))
                        } catch (e) {
                        }
                    } else this.jumpIntoElemEnd(this.editor.findElemById(this.editor.nodeMap.getLast().getVeryFirst(!0).cid));
                    File.isTypeWriterMode || r("content").animate({scrollTop: document.querySelector(this.editor.sessionStr).scrollHeight - window.innerHeight}, "100", "swing", function () {
                        t.docMenu.highlightVisibleHeader()
                    })
                }
            }, lockScroll: function () {
                f = !0
            }, unlockScroll: function () {
                f = !1
            }, typeWriterScroll: function (e, t, n) {
                f = !1;
                var i = this.editor;

                function o(e) {
                    return !(!e || 0 == e.top && 0 == e.bottom) && (e = e.top - y / 2 + i.defaultTextHeight / 2, Math.abs(e) > 2 && (n ? r("content").animate({scrollTop: r("content").scrollTop() + e}, 120, "swing", n) : r("content").scrollTop(r("content").scrollTop() + e)), !0)
                }

                if (File.isTypeWriterMode) {
                    var a;
                    if (t) return void((a = e.jquery && e.length && e[0].getBoundingClientRect()) && (a = document.caretRangeFromPoint((a.left + a.right) / 2, a.bottom - 10), this.typeWriterScroll(a)));
                    if (!e || e.getBoundingClientRect) return void((a = e || window.getSelection().rangeCount && window.getSelection().getRangeAt(0)) && (a.startContainer.nodeType == document.TEXT_NODE && a.startContainer.parentElement.hasAttribute("cid") ? o(a.startContainer.parentElement.getBoundingClientRect()) : o(E(a))));
                    e.top ? o(e) : e.jquery && e.length && o(e[0].getBoundingClientRect())
                }
            }, scrollAdjust: function (e, t, n, i) {
                if (this.editor.sourceView && this.editor.sourceView.inSourceMode) this.editor.sourceView.scrollAdjust(); else {
                    if (File.isTypeWriterMode && !i) return this.typeWriterScroll(e);
                    try {
                        var o, a, s, l = window.innerHeight, c = r("content").scrollTop(), d = this.editor,
                            u = e && e.jquery && e.closest("[mdtype='heading']").toArray();
                        if (e && e.jquery) {
                            if (!e.length) return;
                            o = e.offset().top + c
                        } else if (e && void 0 !== e.startContainer) o = (e.nativeRange || e).getClientRects()[0].top + c; else {
                            if (r(document.activeElement).closest(".CodeMirror-focused").find(".CodeMirror-selected").length) return this.scrollAdjust(selectedCodeMirrorDom);
                            (a = window.getSelection().getRangeAt(0)) ? ((s = a.getClientRects()[0]) || (s = a.endContainer.nodeType === document.TEXT_NODE ? a.endContainer.parentElement.getClientRects()[0] : a.endContainer.getClientRects()[0]), o = s.top + c) : o = r(document.activeElement).offset().top
                        }
                        var h = (File.isNodeHtml ? r("#top-titlebar").height() : document.body.classList.contains("mac-seamless-mode") ? 30 : 0) + (r("#md-searchpanel:visible").height() || 0);
                        void 0 != t ? r("content").animate({scrollTop: o - t - h}, "500", "swing", function () {
                            d.docMenu.highlightVisibleHeader(u)
                        }) : o > l + c - (n ? 70 : 140) + h ? f(o - l + (n ? 70 : 140)) : o < c + h ? f(o - h - (n ? 70 : 140)) : d.docMenu.highlightVisibleHeader()
                    } catch (e) {
                    }
                }

                function f(e) {
                    r("content").scrollTop(e), d.docMenu.highlightVisibleHeader(), v()
                }
            }, selectAllElem: function (e) {
                if (!e[0] || "INPUT" != e[0].tagName && "TEXTAREA" != e[0].tagName) if (this.editor.sourceView.inSourceMode) this.editor.sourceView.cm.execCommand("selectAll"); else {
                    if (r("body").hasClass("typora-sourceview-on")) return this.editor.sourceView.cm.execCommand("selectAll");
                    r(".md-math-after-sym").text("​");
                    var t = o.createRange();
                    e.children().length ? (t.setStart(e.children()[0]), t.setEndAfter(e.children()[e.children().length - 1])) : t.selectNode(e[0]), this.deRange(t, !0)
                } else e[0].select()
            }, selectAll: function (e) {
                if (this.editor.sourceView.inSourceMode) this.editor.sourceView.cm.execCommand("selectAll"); else if (File.inBusyMode && !File.isLocked && this.editor.writingArea.setAttribute("contenteditable", "true"), r(".md-math-after-sym").text("​"), document.activeElement && l.isType(document.activeElement.tagName, "INPUT", "TEXTAREA")) document.activeElement.select(); else {
                    var t = this.editor.getMarkElem(), n = o.createRange();
                    if (t.hasClass("rawedit")) e || (n.selectNode(t[0]), this.setRange(n)); else {
                        if (e && l.isType(e.target.tagName, "INPUT", "TEXTAREA")) return e.target.select(), !0;
                        if (isInputComponent(e && e.target || document.activeElement)) return this.selectAllElem(r(e && e.target || document.activeElement)), !1;
                        if (t.find(".CodeMirror").length) {
                            t.find(".CodeMirror")[0].CodeMirror.execCommand("selectAll")
                        } else t.closest('[mdtype="table"]').length ? (this.selectAllElem(t.closest("[mdtype='table_cell']")), e && e.preventDefault()) : t.closest(".md-meta-block").length ? (this.selectAllElem(t.closest("[mdtype='meta_block']")), e && e.preventDefault()) : (r(this.editor.sessionStr).addClass("md-expand"), r(".footnotes, .md-fences, .hr, .md-rawblock").attr("contenteditable", !0), n.setStart(r(this.editor.sessionStr).children()[0]), r(this.editor.sessionStr).children()[0].classList.contains("md-hr") && n.setStart(r(this.editor.sessionStr).children()[1]), n.setEndAfter(r(this.editor.sessionStr).children().last()[0]), r(this.editor.sessionStr).removeClass("md-expand"), n = this.deRange(n), this.fixSafariRange(n), this.setRange(n), e && e.preventDefault(), File.isMac && setTimeout(function () {
                            r(".footnotes, .md-fences, .hr, .md-rawblock").prop("contenteditable", !1)
                        }, 10))
                    }
                    this.editor.lastCursor = this.buildUndo()
                }
            }, getEndNode: function (e) {
                return this.getDetailPos(e.endContainer, e.endOffset)[0]
            }, getDetailPos: function (e, t, n) {
                var i = {};

                function r(e) {
                    1 === e.nodeType && 0 === e.childNodes.length && e.appendChild(document.createTextNode(""))
                }

                function o(e) {
                    if (r(e), e.childNodes.length) return e.childNodes.length;
                    if (3 === e.nodeType) return e.textContent.length;
                    if (void 0 !== e.length) return e.length;
                    throw i
                }

                if (e.parentElement && e.parentElement.classList.contains("md-def-split")) return 0 == t ? this.getDetailPos(e.parentElement.previousElementSibling, e.parentElement.previousElementSibling.textContent.length, n) : this.getDetailPos(e.parentElement.nextElementSibling, 0, n);
                if (1 == e.nodeType) {
                    var a = e.childNodes;
                    if (e.classList.contains("md-image") && 2 === t && (t = 1), r(e), !a || !a.length || e.classList && e.classList.contains("md-fences")) return [e, t];
                    try {
                        var s = a[t] && a[t].getAttribute && "checkbox" === a[t].getAttribute("type");
                        return n ? (s && t++, t == a.length ? this.getDetailPos(a[t - 1], o(a[t - 1])) : this.getDetailPos(a[t], 0, !0)) : 0 == t ? (s && t++, this.getDetailPos(a[t], 0)) : this.getDetailPos(a[t - 1], o(a[t - 1]))
                    } catch (n) {
                        return [e, t]
                    }
                }
                return [e, t]
            }, fixSafariRange: function (e) {
                if (File.isSafari) {
                    var t, n, i = r(e.startContainer).closest(".md-meta, .md-content");
                    i.length && 0 == e.startOffset && (n = (t = i.closest("[contenteditable='true'], [cid]")).children()[0]) && e.setStart(n, 0), (i = r(e.endContainer).closest(".md-meta, .md-content")).length && ((t = i.closest("[contenteditable='true'], [cid]")).hasClass("md-meta") && (t = t.parent().closest("[contenteditable='true'], [cid]")), (n = t.children().last()[0]) && e.setEndAfter(n))
                }
            }, deRange: function (e, t, n) {
                var i = e.cloneRange();
                try {
                    var r = this.getDetailPos(e.startContainer, e.startOffset, !0),
                        o = this.getDetailPos(e.endContainer, e.endOffset, !1);
                    return t && r[0].parentElement && "HR" == r[0].parentElement.tagName && (r[0] = r[0].parentElement.parentElement), e.setStart.apply(e, r), e.setEnd.apply(e, o), n && n.equals(e) ? n : (t && this.setRange(e, !0), e)
                } catch (e) {
                }
                return i
            }, selectLine: function () {
                var e, t;
                if (this.editor.sourceView.inSourceMode) return t = (e = this.editor.sourceView.cm).getCursor(), void e.setSelection(a.Pos(t.line, 0), a.Pos(t.line, e.getLine(t.line).length));
                var n = r(document.activeElement).closest(".CodeMirror");
                if (n.length) return t = (e = n[0].CodeMirror).getCursor(), void e.setSelection(a.Pos(t.line, 0), a.Pos(t.line, e.getLine(t.line).length));
                if (document.activeElement && l.isType(document.activeElement.tagName, "INPUT")) document.activeElement.select(); else {
                    if (window.getSelection().rangeCount) {
                        var i = window.getSelection(), s = this.editor.getMarkElem(i.commonAncestorContainer),
                            c = o.createRange();
                        if (s.length) if (s.closest("tr[mdtype='table_row']").length) {
                            var d = s.closest("tr[mdtype='table_row']");
                            c.selectNode(d[0]), d.closest('[mdtype="table"]').attr("contenteditable", !0), this.deRange(c, !0), d.closest('[mdtype="table"]').attr("contenteditable", !1)
                        } else {
                            s.addClass("md-expand-on-selection"), window.getSelection().modify("move", "backward", "sentence"), window.getSelection().modify("extend", "forward", "sentence"), c = this.getRangy();
                            var u = r(c.commonAncestorContainer).closest(".md-meta");
                            u.length ? this.selectAllElem(u.closest("[md-inline]")) : (u = this.editor.getMarkElem(c.startContainer)).length && u[0] !== this.editor.getMarkElem(c.endContainer)[0] && (c.setEndAfter(u[0]), this.deRange(c, !0)), s.removeClass("md-expand-on-selection")
                        }
                    }
                    this.editor.brush.updateWordCountInSelection()
                }
            }, selectWord: function (e, t, n) {
                var o, a;
                if (this.editor.sourceView.inSourceMode) return a = (o = this.editor.sourceView.cm).findWordAt(o.getCursor()), void o.extendSelection(a.anchor, a.head);
                this.selectWordTime = new Date;
                var s = r(document.activeElement).closest(".CodeMirror");
                if (s.length) return a = (o = s[0].CodeMirror).findWordAt(o.getCursor()), void o.extendSelection(a.anchor, a.head);
                if (n = n || this.getRangy()) {
                    var l = null;
                    if (e && (l = r(n.startContainer).closest(".md-meta, .md-content")).length) return n.selectNode(l.closest("[md-inline]")[0]), void this.setRange(n);
                    if ((l = r(n.startContainer).closest(".md-content, [md-inline='url'], [md-inline='emoji'], [md-inline='escape']")).length) return n.selectNode(l.closest("[md-inline]")[0]), void this.setRange(n, !0);
                    if ((l = r(n.startContainer).closest("[md-inline]")).length || (l = r(n.startContainer).closest("[cid]")), l.length) {
                        var c = n.getBookmark(l[0]).start, d = l.text(), h = /[\u3040-\uABFF\uD7A4-\uFAFF]/, f = [],
                            p = null;
                        if (d.split(u).filter(function (e) {
                            return !!e
                        }).forEach(function (e) {
                            h.test(e) ? p ? p += e : p = e : (p && f.push(p), f.push(e), p = null)
                        }), p && f.push(p), f.length) {
                            var m = 0, g = d.length, v = 0, y = 0, b = !1;
                            for (y = 0; y < f.length; y++) {
                                var w = f[y].length;
                                if (v + w >= c) {
                                    b = v + w == c;
                                    break
                                }
                                v += w
                            }
                            if (y >= f.length - 1) {
                                if (m = (g = d.length) - f.last().length, e && i.NOT_WORD.exec(f.last())) return
                            } else if (b && !i.NOT_WORD.exec(f[y + 1])) g = (m = v + f[y].length) + f[1 + y].length, t && /\s/.exec(f[y + 2] || "a") && (g += 1); else if (i.NOT_WORD.exec(f[y])) {
                                if (e) return;
                                g = (m = v + f[y].length) + f[1 + y].length
                            } else g = (m = v) + f[y].length, t && /\s/.exec(f[y + 1] || "a") && (g += 1);
                            n.moveToBookmark({
                                containerNode: l[0],
                                start: m,
                                end: g
                            }), this.setRange(n, !0), this.editor.brush.updateWordCountInSelection()
                        }
                    }
                }
            }, selectPhrase: function () {
                if (this.editor.sourceView.inSourceMode) {
                    var e = this.editor.sourceView.cm, t = e.findWordAt(e.getCursor());
                    e.extendSelection(t.anchor, t.head)
                } else if (document.activeElement && l.isType(document.activeElement.tagName, "INPUT")) document.activeElement.select(); else {
                    var n, i = this.getRangy(!0), o = !1;
                    if (i) {
                        if (this.editor.styleBookmark.style) {
                            var a = this.editor.styleBookmark.style.block;
                            if (a.indexOf(d.def_footnote) > -1 || a.indexOf(d.def_link) > -1 ? /md-def-(name|url|title)|/gi.exec(document.activeElement.className) && (o = !0, n = r(i.startContainer).closest(".md-def-name, .md-def-url, .md-def-title")[0]) : a.indexOf(d.table) > -1 && (o = !0, n = r(i.startContainer).closest("[mdtype='table_cell']")[0]), n = n || function e(t) {
                                return t ? t.nodeType === t.ELEMENT_NODE ? t.hasAttribute("md-inline") && t.getAttribute("md-inline") !== d.plain ? t : t.hasAttribute("mdtype") ? t : t.classList.contains("md-def-name") || t.classList.contains("md-def-content") || t.classList.contains("md-def-title") ? t : e(t.parentElement) : t.nodeType === t.TEXT_NODE ? e(t.parentElement) : null : null
                            }(i.startContainer)) return c = i, u = o, (s = n).getAttribute("md-inline") == d.image && (u = !1, s = s.children[0]), u ? c.selectNodeContents(s) : (c.selectNode(s), editor.selection.deRange(c)), this.setRange(i, !0)
                        }
                        return this.selectWord()
                    }
                    var s, c, u
                }
            }, isCrossBlock: function (e) {
                return (e = e || this.getRangy()) ? !e.collapsed && this.editor.getJQueryElem(e.commonAncestorContainer).find("[mdtype]").length : e
            }, handleMouseSelection: function (e) {
                if ("false" == this.editor.writingArea.getAttribute("contenteditable")) {
                    this.getBlockFromMouseEvent(e).closest(".md-focus").length || this.editor.writingArea.setAttribute("contenteditable", "true")
                }
            }, getBlockFromMouseEvent: function (e) {
                var t = e.target;
                return this.editor.writingArea.contains(e.target) || (t = document.elementFromPoint(e.clientX, e.clientY)), r(t).closest("[cid]")
            }, getTextAround: function () {
                var e, t, n = this.getRangy();
                if (n && n.collapsed) {
                    var i = r(n.startContainer).closest("[md-inline='plain'], .md-lang")[0];
                    if (i) {
                        var o = n.getBookmark(i);
                        return n.setStartBefore(i), e = n.toString(), n.collapse(!1), n.setEndAfter(i), t = n.toString(), n.setStart(i, 0), [e, t, o]
                    }
                }
                return []
            }, getCharCountInSelection: function (e) {
                return (e = e || this.getTextInSelection()).length
            }, getWordCountInSelection: function (e) {
                var t = this.editor.EditHelper.getWordCount(e || this.getTextInSelection());
                return Math.min(t, this.editor.brush.wordCount)
            }, getTextInSelection: function () {
                var e = r(document.activeElement).closest(".CodeMirror");
                if (e.length) {
                    return e[0].CodeMirror.getSelection()
                }
                var t = this.getRangy();
                if (t && !t.collapsed && r(t.commonAncestorContainer).closest("#write").length) {
                    return r(r.parseHTML("<div>" + t.toHtml() + "</div>")).find("[mdtype]").after("\n").filter(".md-toc").text("[toc]").end().filter(".md-math-block").text(function () {
                        return r(this).find("script").html()
                    }).end().find(".CodeMirror-gutter-wrapper").remove().end().end().text()
                }
                return ""
            }, extendRange: function (e, t) {
                if (e.commonAncestorContainer.nodeType === document.TEXT_NODE) {
                    if (t > 0 && e.endOffset + t <= e.commonAncestorContainer.length) return e.setEnd(e.commonAncestorContainer, e.endOffset + t), e;
                    if (t < 0 && e.startOffset + t >= 0) return e.setStart(e.commonAncestorContainer, e.startOffset + t), e
                }
                var n = r(e.startContainer).closest("[cid]")[0], i = e.getBookmark(n);
                return t > 0 ? i.end += t : i.start += t, e.moveToBookmark(i), e
            }, createRange: function (e, t, n, i) {
                var r = o.createRange();
                return r.setStart(e, t), r.setEnd(n, i), r.startContainer ? r : null
            }, moveToSelectable: function (e, t) {
                return S(this.editor, e, t)
            }, includeTrailMeta: function (e) {
                if (!e || e.collapsed) return e;

                function t(n, i, o) {
                    var a = i ? n.previousElementSibling : n.nextElementSibling;
                    return n == e.commonAncestorContainer || n.parentElement == e.commonAncestorContainer || !n.parentElement || n.getAttribute && n.getAttribute("cid") ? o : (a && a.classList && a.classList.contains("md-meta") && !r(a.parentElement).closest(".md-expand").length && (o = a), t(n.parentElement, i, o))
                }

                var n;
                if (0 == e.startOffset) {
                    var i = t(e.startContainer, !0);
                    i && (n = !0, e.setStart(i, 0))
                }
                if (e.endContainer.childNodes && e.endOffset == e.endContainer.childNodes.length || e.endContainer.nodeType == document.TEXT_NODE && e.endOffset == e.endContainer.nodeValue.length) {
                    var o = t(e.endContainer, !1);
                    o && (n = !0, e.setEnd(o, o.childNodes.length))
                }
                return n && this.setRange(e, !0), e
            }
        };
        var b = function (e) {
            e && (e.codemirrorIgnore = !0, e.preventDefault(), e.stopPropagation())
        }, w = function (e, t) {
            return l.isType(e, l.TYPE.hr, l.TYPE.toc) && (!t || t[0].hasAttribute("tabindex"))
        }, C = function (e) {
            var t = e[0];
            return t.childElementCount > 0 && function () {
                for (var e = 0; e < t.childElementCount; e++) if (t.children[0].getAttribute("md-inline") !== d.image) return !1;
                return !0
            }()
        }, x = function (e, t, n) {
            var i;
            if (t.getAttribute("mdtype") === d.fences && (i = e.fences.getCm(t.getAttribute("cid"))), t.getAttribute("mdtype") === d.math_block && (i = e.mathBlock.startEditing(r(t))), t.getAttribute("mdtype") === d.html_block && (i = e.htmlBlock.startEditing(r(t))), i) return i.focus(), i.setCursor(n), !0
        }, k = function (e, t) {
            if (void 0 != t) {
                var n = e.cursorCoords(e.getCursor());
                n.left = n.right = t;
                var i = e.coordsChar(n);
                e.setCursor(i)
            }
        }, S = function (e, t, n, i, r, o) {
            if (!n) return !1;
            var a = e.findElemById(n.id);
            e.lastCursor = e.selection.buildUndo();
            var s = !r;
            if (l.isType(n, d.fences)) return (c = e.fences.getCm(n.id)).focus(), t ? setTimeout(function () {
                a.find(".ty-input-after").focus()
            }, 0) : (c.execCommand(t ? "goDocEnd" : "goDocStart"), k(c, o)), b(i), !0;
            if (l.isType(n, d.math_block)) return t ? (c = e.mathBlock.startEditing(a, !n.get("tagAfter") && "end", s), n.get("tagAfter") ? setTimeout(function () {
                e.selection.selectAllElem(a.find(".ty-input-after").focus())
            }, 0) : k(c, o)) : (c = e.mathBlock.startEditing(a, !n.get("tagBefore") && "start", s), n.get("tagBefore") ? setTimeout(function () {
                e.selection.selectAllElem(a.find(".ty-input-before").focus())
            }, 0) : k(c, o)), b(i), !0;
            if (l.isType(n, d.html_block)) {
                var c = e.htmlBlock.startEditing(a, t ? "end" : "start", s);
                return k(c, o), b(i), !0
            }
            return !!w(n) && (b(i), window.getSelection().removeAllRanges(), e.findElemById(n.id).focus(), e.refocus(), !0)
        }, E = function (e) {
            var t, n = e.getClientRects(), i = n.length && n[n.length - 1];
            {
                if (i || !e.collapsed) return i;
                if ("write" == (t = e.startContainer.nodeType == document.TEXT_NODE ? e.startContainer.parentElement : e.startContainer).getAttribute("id")) return null;
                if ((i = t.getBoundingClientRect()).height > 150) return null
            }
        };
        n.exports = h, n.exports.buildRange = function (e, t, n) {
            if (!e) return window.getSelection().removeAllRanges();
            var i = 0, r = o.createRange(), a = !1, s = {};
            r.collapseToPoint(e, 0);
            try {
                !function e(o) {
                    if (3 == o.nodeType) {
                        var l = i + o.textContent.length;
                        if (!a && t >= i && t <= l && (r.setStart(o, t - i), a = !0), a && n >= i && n <= l) throw r.setEnd(o, n - i), s;
                        i = l
                    } else for (var c = 0, d = o.childNodes.length; c < d; ++c) e(o.childNodes[c])
                }(e)
            } catch (e) {
                if (e == s) return r;
                throw e
            }
        }, n.exports.rangy = o
    }), $__System.registerDynamic("32", ["13", "11", "12", "e", "18", "30", "31", "1a", "2f"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i = e("13"), r = e("11"), o = e("12"), a = o.Node, s = o.TYPE, l = e("e"), c = e("18"),
            d = (e("30").rangy, e("31")), u = e("1a"), h = window.reqnode ? reqnode("electron").remote : null,
            f = e("2f"), p = h ? h.app : window.app, m = r.Collection.extend({
                model: a, getNodeByRef: function (e) {
                    for (var t in this.models) if (this.models.hasOwnProperty(t)) {
                        var n = this.models[t];
                        if (i.escape(n.get("ref")).toLowerCase() == i.escape(e).toLowerCase()) return n
                    }
                }, getFootHTMLByRef: function (e, t) {
                    var n = this.getNodeByRef(e);
                    return n ? (t && File.editor.store(n.cid, !0), "<div class='code-tooltip md-tooltip-remove md-hover-tip md-f-tooltip' contenteditable='false'><div class='md-arrow' /><div class='code-tooltip-content'>" + editor.brush.inline.output(n.get("text")) + "</div></div>") : null
                }, getHrefByRef: function (e, t) {
                    var n = this.getNodeByRef(e);
                    return n && t && File.editor.store(n.cid, !0), n ? i.escape(n.get("href")) : void 0
                }
            }), g = function (e) {
                switch (e.type) {
                    case s.strong:
                        return "<strong>" + e.inner + "</strong>";
                    case s.em:
                        return "<em>" + e.inner + "</em>";
                    case s.code:
                        return "<code>" + i.escape(e.text) + "</code>";
                    case s.plain:
                        return e.text;
                    case s.tag:
                        return "";
                    case s.imgtag:
                    case s.refimg:
                    case s.image:
                    case s.inline_math:
                        return f.decorateAsExport(e, {forPrint: !0});
                    case s.underline:
                        return "<u>" + e.inner + "</u>";
                    case s.del:
                        return "<del>" + e.inner + "</del>";
                    case s.footnote:
                        return "";
                    case s.escape:
                        return e.text;
                    case s.highlight:
                        return "<mark>" + e.inner + "</mark>";
                    case s.superscript:
                        return "<sup>" + e.inner + "</sup>";
                    case s.subscript:
                        return "<sub>" + e.inner + "</sub>";
                    case s.linebreak:
                        return "";
                    case s.tab:
                        return "<span>" + e.inner + "</span>";
                    default:
                        return e.inner || e.text || ""
                }
            };

        function v(e, t) {
            for (var n = e.find(".outline-item-wrapper"), i = 0; i < n.length; i++) n[i].querySelector(".outline-item-wrapper") ? t && n[i].classList.contains("outline-h1") && n[i].classList.add("outline-item-open") : n[i].classList.add("outline-item-signle")
        }

        var y;

        function b() {
            return y || (y = new c.InlineLexer(null, g)), y
        }

        var w = r.Model.extend({
            initialize: function (e) {
                this.nodeMap = e, this.refresh(), this.delay = 300, this.refreshTimeout = null
            }, remove: function (e) {
                var t = this.headers.indexOf(e);
                t > -1 && this.headers.splice(t, 1)
            }, updateHeaderText: function (e) {
                if (!this.refreshTimeout && !File._onInitPars && this.headers && -1 != this.headers.indexOf(e)) {
                    var t = y.output(e.get("text"));
                    l(".md-toc-item[data-ref='" + e.cid + "']").children(".md-toc-inner").html(t), l("#outline-content .outline-label[data-ref='" + e.cid + "']").html(t)
                }
            }, refresh: function (e, t) {
                if (!File._onInitParse) {
                    var n = this;
                    this.refreshTimeout && clearTimeout(this.refreshTimeout), this.refreshTimeout = null, e ? i.call(n) : this.refreshTimeout = setTimeout(function () {
                        i.call(n)
                    }, this.delay)
                }

                function i() {
                    var e = this.nodeMap.getFirst();
                    for (this.headers = []; e;) a.isType(e, a.TYPE.heading) ? this.headers.push(e) : File.option.expandSimpleBlock && a.isType(e, a.TYPE.paragraph) && e.get("depth") && this.headers.push(e), e = e.get("after");
                    !t && this.updateHTML(), this.refreshTimeout = null
                }
            }, getTocInnerHTML: function () {
                var e = "";
                return (this.headers || []).map(function (t) {
                    t.isDeleted() || (e += function (e) {
                        var t = e.get("text");
                        return a.isType(e, a.TYPE.paragraph) && (t = e.getText().replace(/(^#+\s*)|(#+\s*$)|\n.*/, "")), "<span class='md-toc-item md-toc-h" + e.get("depth") + "' data-ref='" + e.cid + "'><a class='md-toc-inner'>" + y.output(t) + "</a></span>"
                    }(t))
                }), e
            }, updateHTML: function () {
                var e = 0, t = document.querySelectorAll(".md-toc-content");
                if (t.length > 0) {
                    var n = this.getTocInnerHTML();
                    for (e = 0; e < t.length; e++) t[e].innerHTML != n && (t[e].innerHTML = n)
                }
                this.updateOutlineHtml()
            }, updateOutlineHtml: function () {
                if (document.body.classList.contains("pin-outline")) {
                    var e = document.querySelector("#outline-content"), t = x(this), n = e.scrollTop,
                        i = !document.body.classList.contains(".no-collapse-outline"), r = [],
                        o = 0 == e.innerHTML.trim().length;
                    if (function (e, t) {
                        var n = l(l.parseHTML("<div>" + e + "<div>")[0]), i = l(l.parseHTML("<div>" + t + "<div>")[0]);
                        return n.find(".outline-item-open, .outline-active").removeClass("outline-item-open").removeClass("outline-active"), i.find(".outline-item-open, .outline-active").removeClass("outline-item-open").removeClass("outline-active"), n.html() == i.html()
                    }(e.innerHTML, t)) return;
                    i && !o && l(e).find(".outline-item-open>.outline-item>.outline-label").map(function () {
                        r.push(this.getAttribute("data-ref"))
                    }), e.innerHTML = x(this), e.scrollTop = n, i && (v(l(e)), l(e.querySelector(".outline-active")).parents(".outline-item-wrapper:not(.outline-item-signle)").addClass("outline-item-open"), o ? 1 == e.children.length && e.children[0].classList.add("outline-item-open") : r.forEach(function (t) {
                        var n = e.querySelector("[data-ref='" + t + "']");
                        n && ((n = n.parentElement.parentElement).classList.contains("outline-item-signle") || n.classList.add("outline-item-open"))
                    })), File.editor.docMenu.highlightVisibleHeader()
                }
            }
        }), C = null, x = function (e) {
            var t = "", n = [], i = b();
            try {
                !function (e) {
                    for (var r = 0; r < e.length; r++) if (!e[r].isDeleted()) {
                        a = e[r], t += "<li class='outline-item-wrapper outline-h" + a.get("depth") + "'><div class='outline-item'><span class='outline-expander'></span><span class='outline-label' data-ref='" + a.cid + "'>" + i.output(a.get("text")) + "</span></div><ul class='outline-children'>", n.push(a.get("depth"));
                        var o = e[r + 1] && !e[r + 1].isDeleted() ? e[r + 1].get("depth") : 1;
                        if (o <= e[r].get("depth")) for (; n.last() && n.last() >= o;) t += "</ul></li>", n.pop()
                    }
                    var a
                }(e.headers)
            } catch (e) {
                window.debugMode && console.warn(e.stack), t = ""
            }
            return t
        }, k = r.Model.extend({
            initialize: function (e) {
                var t = this;
                b();
                this.headerStr = "h1, h2, h3, h4, h5, h6, [mdlike='h1'], [mdlike='h2'], [mdlike='h3'], [mdlike='h4'], [mdlike='h5'], [mdlike='h6']", this.expandedOutlineItem = [], e.nodeMap.foot_list = new m, e.nodeMap.link_list = new m, e.nodeMap.toc = new w(e.nodeMap), this.editor = e, function () {
                    var e, n, i = t.editor;

                    function r() {
                        e = !1, setTimeout(function () {
                            e || l(".md-f-tooltip").remove()
                        }, 500)
                    }

                    setTimeout(function () {
                        l(document).on("mouseenter mousemove", ".md-footnote", function () {
                            if (!e || n !== i.focusCid) {
                                if (window.getSelection().anchorNode && this.contains(window.getSelection().anchorNode.parentElement)) return;
                                e = !0, n = i.focusCid, t.showTooltipForSup(l(this))
                            }
                        }).on("mouseleave", ".md-footnote", r).on("mouseenter", ".md-f-tooltip", function () {
                            e = !0
                        }).on("mouseleave", ".md-f-tooltip", r)
                    }, 300)
                }(), l(document).on("mousedown", ".md-toc-inner", function (t) {
                    if (1 === t.which) {
                        var n = this.parentElement.getAttribute("data-ref"), i = e.findElemById(n);
                        return e.store(), e.undo.completeSnap(!0), e.selection.jumpIntoElemEnd(i), e.selection.scrollAdjust(i, 10), !1
                    }
                }).on("mousedown", ".md-delete-toc", function (t) {
                    1 === t.which && e.UserOp.deleteSelectable(e, l(this).closest(".md-toc"))
                }).on("click", "#md-notification .close-btn", function (e) {
                    l("#md-notification").hide()
                }).on("click", "#md-notification .ty-icon-close-btn", function (e) {
                    l("#md-notification").hide()
                }), l(document).on("click", ".outline-expander", function (e) {
                    var t = this.nextElementSibling.getAttribute("data-ref");
                    l(".outline-label[data-ref='" + t + "']").parent().parent().toggleClass("outline-item-open")
                }).on("click", ".outline-label", function (n) {
                    var i = this.getAttribute("data-ref"), r = e.findElemById(i);
                    return e.undo.completeSnap(!0), t.autoHideOutline(), e.focusAndRestorePos(), e.selection.scrollAdjust(r, 10), File.isFocusMode && e.updateFocusMode(!1), !1
                }).on("post-wheel", "content", function (e) {
                    document.querySelector(".dropmenu.open") && !File.editor.sourceView.inSourceMode && (C && clearTimeout(C), C = setTimeout(t.highlightVisibleHeader.bind(t), 100))
                }).on("click", "#close-outline-btn, #close-sidebar-btn", function () {
                    return e.focusAndRestorePos(), t.hideOutline(), !1
                }).on("click", "#pin-outline-btn", function () {
                    return e.focusAndRestorePos(), e.library.showSidebar("outline"), !1
                }).on("click", "#unpin-outline-btn", function () {
                    return e.focusAndRestorePos(), e.library.hideSidebar(), t.showOutline(), !1
                }), document.querySelector("#sidebar-content").addEventListener("mousewheel", function () {
                    C && clearTimeout(C)
                }, !!File.option.passiveEvents && {passive: !0})
            }, highlightVisibleHeader: function (e, t) {
                if (document.querySelector("#typora-sidebar.open")) {
                    var n = this, i = this.editor, r = e || l(i.writingArea).children(this.headerStr), o = 0,
                        a = r.length - 1, s = void 0 === t ? null : t;
                    if (r.length) {
                        for (o = 1 === u(r[r.length - 1]) ? 0 : r.length - 1; a - o > 1 && null == s;) {
                            var c = Math.floor((o + a) / 2), d = u(r[c]);
                            1 == d ? a = c : -1 == d ? o = c : s = h(c)
                        }
                        null == s && (s = o), s < r.length && function (e) {
                            if ((!n.editor.library || n.editor.library.isOutlineShown()) && e.length) {
                                var t, i, r = l("#outline-content:visible")[0];
                                r && (File.isNodeHtml || (r = r.parentElement), (t = e.offset().top - l(r).offset().top) < 0 ? i = t - 200 + r.scrollTop : t > r.offsetHeight - 20 && (i = t + 200 - r.offsetHeight + r.scrollTop), void 0 !== i && (r.scrollTop = i))
                            }
                        }(l("#outline-content .outline-label").removeClass("outline-active").filter("[data-ref='" + r[s].getAttribute("cid") + "']").addClass("outline-active"))
                    }
                    C = null
                }

                function u(e) {
                    var t = l("content").scrollTop(), n = e.offsetTop;
                    return n < t ? -1 : n > t + window.innerHeight ? 1 : 0
                }

                function h(e) {
                    for (e--; r[e] && 0 == u(r[e]);) e--;
                    return e + 1
                }
            }, getAttrByElem: function (e) {
                return e.hasClass("md-def-name") ? "ref" : e.hasClass("md-def-content") ? e.hasClass("md-def-url") ? "href" : "text" : e.hasClass("md-def-title") ? "title" : void 0
            }, addEmptyDef: function (e, t) {
                var n = this.editor;

                function i(i) {
                    var r = n.findNodeByElem(i), o = n.undo.UndoManager.makeEmptyCommand();
                    r.insert(new a({
                        type: t,
                        ref: e,
                        url: "",
                        text: ""
                    })), n.undo.UndoManager.addUndoForInsert(o, r.get("after")), i.after(r.get("after").toHTML()), n.selection.jumpIntoElemBegin(i.next().find(".md-def-content")), o.redo.push(n.selection.buildUndo()), n.undo.register(o), n.refocus()
                }

                var r = l(n.sessionStr).find(t == a.TYPE.def_link ? ".md-def-link" : ".md-def-footnote").last();
                !r.length || r.nextAll(":not(.footnotes)").length ? i(l(n.sessionStr).children().last()) : i(r)
            }, resizeFooter: function () {
            }, showTooltipForSup: function (e) {
                var t, n, i = this.editor;
                if (e.length) {
                    var r = e.find(".md-text").text();
                    t = i.nodeMap.foot_list.getFootHTMLByRef(r, !0), l(".md-tooltip-remove").remove(), t ? (n = l(l.parseHTML(t)[0]), l("body").append(n)) : File.isLocked || (t = "<div class='code-tooltip md-tooltip-remove md-hover-tip md-f-tooltip' contenteditable='false'><div class='md-arrow' /><div class='code-tooltip-content'><span class='fa text-warning fa-exclamation-triangle' title='warning' aria-hidden='true' /> " + l.localize.getString("Need to define the reference footnote <b>{0}</b> with syntax <a>[^{1}]: www.example.com</a>").format(r, r).trim() + " </div></div>", n = l(l.parseHTML(t)[0]), l("body").append(n), n.find(".code-tooltip-content a").unbind("click").click(function () {
                        i.docMenu.addEmptyDef(r, o.TYPE.def_footnote)
                    })), this.editor.EditHelper.fixPopoverPosition(e, n)
                }
            }, getLocalRootUrl: function (e) {
                var t = this.getMetaNode();
                if (e = e || "img", t) {
                    var n = (/^\s*typora-root-url\s*:\s*(.*)$/im.exec(t.get("text")) || [])[1];
                    if (n) {
                        var i = d.getCurrentFileFolderPath();
                        return i ? File.isMac ? p.path.resolvePathRelateTo(n, i) : reqnode("path").resolve(i, n) : n
                    }
                }
                return null
            }, buildMetaMap: function () {
                var e, t, n = this.getMetaNode(), i = /^\s*([^:]+)\s*:\s*(.*)$/, r = /^\s#/, o = {};

                function a(e) {
                    return e.replace(/(^\s*['"]*)(['"]*\s*$)/, "")
                }

                return n && ((n.get("text") || "").split(/\r|\n|\r\n/g).forEach(function (n) {
                    n.match(r) || ((t = i.exec(n)) ? (e = t[1], o[e] = t[2].replace(/^\s*[|>]\s*/, "")) : e && (o[e] += "\n" + n.trim()))
                }), Object.keys(o).forEach(function (e) {
                    o[e].match(/^\s*-/) ? o[e] = o[e].split(/(^|\n+)\s*-/g).filter(function (e) {
                        return e.match(/\S/)
                    }).map(function (e) {
                        return a(e)
                    }) : (t = o[e].match(/^\s*\[(.*)\]\s*$/)) ? o[e] = t[1].split(/\s*,\s*/).map(a) : o[e] = a(o[e])
                })), o
            }, getMetaNode: function () {
                var e = this.editor.nodeMap.getFirst(), t = a.isType(e, s.meta_block) ? e : null;
                return this.editor.undo && this.editor.undo.snapNode && t && t.cid == this.editor.undo.snapNode.cid && this.editor.undo.completeSnap(!0), t
            }, getValueInMeta: function (e, t) {
                if (t = t || this.getMetaNode()) {
                    var n = (new RegExp("^s*" + e + "s*:s*(.*)$", "mi").exec(t.get("text")) || [])[1];
                    return n ? n.trim() : n
                }
                return null
            }, renderOutline: function () {
                var e = x(this.editor.nodeMap.toc), t = l(".outline-content");
                if (t.html(e), v(t, !0), this.editor.inlineMath && this.editor.inlineMath.renderInToc(), this.expandedOutlineItem) this.expandedOutlineItem.forEach(function (e) {
                    try {
                        t.find("[data-ref='" + e + "']").parent().parent().addClass("outline-item-open")
                    } catch (e) {
                    }
                }), this.expandedOutlineItem = null; else {
                    var n = t.children();
                    n.length < 20 && n.addClass(".outline-item-open")
                }
            }, showOutline: function (e) {
                this.editor.library.isSidebarShown() ? l("#toc-content").html(l("#outline-content").html()).find(".outline-active").removeClass("outline-active") : this.renderOutline(), l(".dropdown-menu.open, .dropdown-menu.show").removeClass("open").removeClass("show"), document.querySelector("#toc-dropmenu").classList.add("open")
            }, storeOutline: function () {
                this.expandedOutlineItem = [];
                for (var e = document.querySelectorAll(".outline-item-open:not(.outline-h1)>.outline-item>.outline-label"), t = 0; t < e.length; t++) this.expandedOutlineItem.push(e[t].getAttribute("data-ref"));
                return this.expandedOutlineItem
            }, hideOutline: function (e) {
                this.storeOutline(), document.querySelector("#toc-dropmenu").classList.remove("open")
            }, autoHideOutline: function () {
                document.querySelector("#toc-dropmenu").classList.contains("open") && this.hideOutline()
            }, toggleOutline: function () {
                document.querySelector("#toc-dropmenu.open") ? this.hideOutline() : this.showOutline()
            }, getHeaderMatrix: function (e) {
                var t = [];
                return this.editor.nodeMap.toc.headers.map(function (n) {
                    var i = n.get("type") == s.heading ? n.get("text") : n.getText().replace(/(^#+)|(#+$)/g, ""),
                        r = y.output(i);
                    e && (r = l.parseHTML("<div>" + r + "<div>")[0].textContent), t.push([n.get("depth") - 0, r, n.cid])
                }), t
            }, writeProperty: function (e, t) {
                this.editor.undo.completeSnap(!0);
                var n = this.editor.docMenu.getMetaNode(), i = this.editor.selection.buildUndo() || {},
                    r = u.makeEmptyCommand(i), o = e + ": " + t, a = n && i && (i.id || i.startId) == n.id,
                    s = l.extend({}, i), c = 0;
                if (n) {
                    r.undo.push(u.buildReplaceUndo(n));
                    var d = n.get("text"), h = S(e, d);
                    if (h) {
                        s.start > h.index + h[0].length ? c = o.length - h[0].length : s.start > h.index && (c = s.start - h.index + o.length), s.end = s.start = s.start - c;
                        var f = new RegExp("^s*" + e + "s*:s*(.*)$", "mi");
                        n.set("text", d.replace(f, o))
                    } else n.set("text", d ? d.replace(/\n?$/, "\n" + o) : o);
                    r.redo.push(u.buildReplaceUndo(n)), this.editor.findElemById(n.cid).replaceWith(n.toHTML()), a && this.editor.undo.exeCommand(s)
                } else {
                    var p = this.editor.stylize.insertMetaBlock(!0, o);
                    n = p.node, u.append(r, p.command), this.editor.findElemById(n.get("after").cid).before(n.toHTML())
                }
                r.redo.push(s), this.editor.undo.register(r)
            }, removeProperty: function (e, t) {
                this.editor.undo.completeSnap(!0);
                var n = this.editor.docMenu.getMetaNode(), i = this.editor.selection.buildUndo(),
                    r = u.makeEmptyCommand(i), o = (i.id || i.startId) == n.id,
                    a = new RegExp("^s*" + e + "s*:s*(.*)$", "mi"), s = l.extend({}, i), c = 0;
                if (n) {
                    if (r.undo.push(u.buildReplaceUndo(n)), o) {
                        var d = S(e, n.get("text"));
                        d && (s.start > d.index + d[0].length ? c = d[0].length : s.start > d.index && (c = s.start - d.index), s.end = s.start = s.start - c)
                    }
                    n.set("text", n.get("text").replace(a, "")), r.redo.push(u.buildReplaceUndo(n)), this.editor.findElemById(n.cid).replaceWith(n.toHTML()), r.redo.push(s), o && this.editor.undo.exeCommand(s), !t && this.editor.undo.register(r)
                }
                return r
            }
        });

        function S(e, t) {
            return new RegExp("^s*" + e + "s*:s*(.*)$", "mig").exec(t)
        }

        n.exports = k
    }), $__System.registerDynamic("29", ["1b"], !0, function (e, t, n) {
        "use strict";
        this || self;
        e("1b").createModule("ClassApplier", ["WrappedSelection"], function (e, t) {
            var n = e.dom, i = n.DomPosition, r = n.arrayContains, o = n.isHtmlNamespace;

            function a(e, t) {
                for (var n in e) if (e.hasOwnProperty(n) && !1 === t(n, e[n])) return !1;
                return !0
            }

            function s(e, t) {
                return e.className && new RegExp("(?:^|\\s)" + t + "(?:\\s|$)").test(e.className)
            }

            function l(e, t) {
                e.className ? s(e, t) || (e.className += " " + t) : e.className = t
            }

            var c = function () {
                function e(e, t, n) {
                    return t && n ? " " : ""
                }

                return function (t, n) {
                    t.className && (t.className = t.className.replace(new RegExp("(^|\\s)" + n + "(\\s|$)"), e))
                }
            }();

            function d(e) {
                return e && e.split(/\s+/).sort().join(" ")
            }

            function u(e) {
                return d(e.className)
            }

            function h(e, t) {
                return u(e) == u(t)
            }

            function f(e, t, n, i, r) {
                var o = e.node, a = e.offset, s = o, l = a;
                o == i && a > r && ++l, o != t || a != n && a != n + 1 || (s = i, l += r - n), o == t && a > n + 1 && --l, e.node = s, e.offset = l
            }

            function p(e, t, i, r) {
                -1 == i && (i = t.childNodes.length);
                for (var o, a = e.parentNode, s = n.getNodeIndex(e), l = 0; o = r[l++];) f(o, a, s, t, i);
                t.childNodes.length == i ? t.appendChild(e) : t.insertBefore(e, t.childNodes[i])
            }

            function m(e, t) {
                for (var i, r = e.parentNode, o = n.getNodeIndex(e), a = 0; i = t[a++];) l = r, c = o, (s = i).node == l && s.offset > c && --s.offset;
                var s, l, c;
                e.parentNode.removeChild(e)
            }

            function g(e, t) {
                return function (e, t, n, i, r) {
                    for (var o, a = []; o = e.firstChild;) p(o, t, n++, r), a.push(o);
                    return i && m(e, r), a
                }(e, e.parentNode, n.getNodeIndex(e), !0, t)
            }

            function v(e, t) {
                var n = e.cloneRange();
                n.selectNodeContents(t);
                var i = n.intersection(e);
                return "" != (i ? i.toString() : "")
            }

            function y(e) {
                for (var t, n = e.getNodes([3]), i = 0; (t = n[i]) && !v(e, t);) ++i;
                for (var r = n.length - 1; (t = n[r]) && !v(e, t);) --r;
                return n.slice(i, r + 1)
            }

            function b(e, t) {
                if (e.attributes.length != t.attributes.length) return !1;
                for (var n, i, r, o = 0, a = e.attributes.length; o < a; ++o) if ("class" != (r = (n = e.attributes[o]).name)) {
                    if (null === n != (null === (i = t.attributes.getNamedItem(r)))) return !1;
                    if (n.specified != i.specified) return !1;
                    if (n.specified && n.nodeValue !== i.nodeValue) return !1
                }
                return !0
            }

            function w(e, t) {
                for (var n, i = 0, o = e.attributes.length; i < o; ++i) if (n = e.attributes[i].name, (!t || !r(t, n)) && e.attributes[i].specified && "class" != n) return !0;
                return !1
            }

            function C(e, t) {
                return a(t, function (t, n) {
                    if ("object" == typeof n) {
                        if (!C(e[t], n)) return !1
                    } else if (e[t] !== n) return !1
                })
            }

            var x = n.getComputedStyleProperty,
                k = "boolean" == typeof document.createElement("div").isContentEditable ? function (e) {
                    return e && 1 == e.nodeType && e.isContentEditable
                } : function (e) {
                    return !(!e || 1 != e.nodeType || "false" == e.contentEditable) && ("true" == e.contentEditable || k(e.parentNode))
                };

            function S(e) {
                var t;
                return e && 1 == e.nodeType && ((t = e.parentNode) && 9 == t.nodeType && "on" == t.designMode || k(e) && !k(e.parentNode))
            }

            function E(e) {
                return (k(e) || 1 != e.nodeType && k(e.parentNode)) && !S(e)
            }

            var F = /^inline(-block|-table)?$/i;

            function _(e) {
                return e && 1 == e.nodeType && !F.test(x(e, "display"))
            }

            var T = /[^\r\n\t\f \u200B]/;

            function M(e) {
                var t, n, r = [];
                for (t = 0; n = e[t++];) r.push(new i(n.startContainer, n.startOffset), new i(n.endContainer, n.endOffset));
                return r
            }

            function A(e, t) {
                for (var n, i, r, o = 0, a = e.length; o < a; ++o) n = e[o], i = t[2 * o], r = t[2 * o + 1], n.setStartAndEnd(i.node, i.offset, r.node, r.offset)
            }

            function N(e, i, r, o) {
                var a, s, l = 0 == r;
                if (n.isAncestorOf(i, e)) return e;
                if (n.isCharacterDataNode(i)) {
                    var c = n.getNodeIndex(i);
                    if (0 == r) r = c; else {
                        if (r != i.length) throw t.createError("splitNodeAt() should not be called with offset in the middle of a data node (" + r + " in " + i.data);
                        r = c + 1
                    }
                    i = i.parentNode
                }
                if (f = i, m = r, n.isCharacterDataNode(f) ? 0 == m ? f.previousSibling : m != f.length || f.nextSibling : m > 0 && m < f.childNodes.length) {
                    a = i.cloneNode(!1), s = i.parentNode, a.id && a.removeAttribute("id");
                    for (var d, u = 0; d = i.childNodes[r];) p(d, a, u++, o);
                    return p(a, s, n.getNodeIndex(i) + 1, o), i == e ? a : N(e, s, n.getNodeIndex(a), o)
                }
                if (e != i) {
                    a = i.parentNode;
                    var h = n.getNodeIndex(i);
                    return l || h++, N(e, a, h, o)
                }
                var f, m;
                return e
            }

            function L(e) {
                var t = e ? "nextSibling" : "previousSibling";
                return function (n, i) {
                    var r = n.parentNode, o = n[t];
                    if (o) {
                        if (o && 3 == o.nodeType) return o
                    } else if (i && (o = r[t]) && 1 == o.nodeType && (s = r, l = o, s.namespaceURI == l.namespaceURI && s.tagName.toLowerCase() == l.tagName.toLowerCase() && h(s, l) && b(s, l) && "inline" == x(s, "display") && "inline" == x(l, "display"))) {
                        var a = o[e ? "firstChild" : "lastChild"];
                        if (a && 3 == a.nodeType) return a
                    }
                    var s, l;
                    return null
                }
            }

            var R = L(!1), D = L(!0);

            function O(e) {
                this.isElementMerge = 1 == e.nodeType, this.textNodes = [];
                var t = this.isElementMerge ? e.lastChild : e;
                t && (this.textNodes[0] = t)
            }

            O.prototype = {
                doMerge: function (e) {
                    var t = this.textNodes, i = t[0];
                    if (t.length > 1) {
                        for (var r, o, a, s, l = n.getNodeIndex(i), c = [], d = 0, u = 0, h = t.length; u < h; ++u) {
                            if (o = (r = t[u]).parentNode, u > 0 && (o.removeChild(r), o.hasChildNodes() || o.parentNode.removeChild(o), e)) for (a = 0; s = e[a++];) s.node == r && (s.node = i, s.offset += d), s.node == o && s.offset > l && (--s.offset, s.offset == l + 1 && u < h - 1 && (s.node = i, s.offset = d));
                            c[u] = r.data, d += r.data.length
                        }
                        i.data = c.join("")
                    }
                    return i.data
                }, getLength: function () {
                    for (var e = this.textNodes.length, t = 0; e--;) t += this.textNodes[e].length;
                    return t
                }, toString: function () {
                    for (var e = [], t = 0, n = this.textNodes.length; t < n; ++t) e[t] = "'" + this.textNodes[t].data + "'";
                    return "[Merge(" + e.join(",") + ")]"
                }
            };
            var I = ["elementTagName", "ignoreWhiteSpace", "applyToEditableOnly", "useExistingElements", "removeEmptyElements", "onElementCreate"],
                P = {};

            function B(e, t, n) {
                var i, r, o, s, l = this;
                l.cssClass = l.className = e;
                var c = null, d = {};
                if ("object" == typeof t && null !== t) {
                    for (n = t.tagNames, c = t.elementProperties, d = t.elementAttributes, r = 0; s = I[r++];) t.hasOwnProperty(s) && (l[s] = t[s]);
                    i = t.normalize
                } else i = t;
                l.normalize = void 0 === i || i, l.attrExceptions = [];
                var u = document.createElement(l.elementTagName);
                l.elementProperties = l.copyPropertiesToElement(c, u, !0), a(d, function (e) {
                    l.attrExceptions.push(e)
                }), l.elementAttributes = d, l.elementSortedClassName = l.elementProperties.hasOwnProperty("className") ? l.elementProperties.className : e, l.applyToAnyTagName = !1;
                var h = typeof n;
                if ("string" == h) "*" == n ? l.applyToAnyTagName = !0 : l.tagNames = (f = n.toLowerCase(), f.replace(/^\s\s*/, "").replace(/\s\s*$/, "")).split(/\s*,\s*/); else if ("object" == h && "number" == typeof n.length) for (l.tagNames = [], r = 0, o = n.length; r < o; ++r) "*" == n[r] ? l.applyToAnyTagName = !0 : l.tagNames.push(n[r].toLowerCase()); else l.tagNames = [l.elementTagName];
                var f
            }

            B.prototype = {
                elementTagName: "span",
                elementProperties: {},
                elementAttributes: {},
                ignoreWhiteSpace: !0,
                applyToEditableOnly: !1,
                useExistingElements: !0,
                removeEmptyElements: !0,
                onElementCreate: null,
                copyPropertiesToElement: function (e, t, n) {
                    var i, r, o, a, s, c, u = {};
                    for (var h in e) if (e.hasOwnProperty(h)) if (a = e[h], s = t[h], "className" == h) l(t, a), l(t, this.className), t[h] = d(t[h]), n && (u[h] = t[h]); else if ("style" == h) {
                        r = s, n && (u[h] = o = {});
                        for (i in e[h]) r[i] = a[i], n && (o[i] = r[i]);
                        this.attrExceptions.push(h)
                    } else t[h] = a, n && (u[h] = t[h], c = P.hasOwnProperty(h) ? P[h] : h, this.attrExceptions.push(c));
                    return n ? u : ""
                },
                copyAttributesToElement: function (e, t) {
                    for (var n in e) e.hasOwnProperty(n) && t.setAttribute(n, e[n])
                },
                hasClass: function (e) {
                    return 1 == e.nodeType && r(this.tagNames, e.tagName.toLowerCase()) && s(e, this.className)
                },
                getSelfOrAncestorWithClass: function (e) {
                    for (; e;) {
                        if (this.hasClass(e)) return e;
                        e = e.parentNode
                    }
                    return null
                },
                isModifiable: function (e) {
                    return !this.applyToEditableOnly || E(e)
                },
                isIgnorableWhiteSpaceNode: function (e) {
                    return this.ignoreWhiteSpace && e && 3 == e.nodeType && function (e) {
                        if (0 == e.data.length) return !0;
                        if (T.test(e.data)) return !1;
                        switch (x(e.parentNode, "whiteSpace")) {
                            case"pre":
                            case"pre-wrap":
                            case"-moz-pre-wrap":
                                return !1;
                            case"pre-line":
                                if (/[\r\n]/.test(e.data)) return !1
                        }
                        return _(e.previousSibling) || _(e.nextSibling)
                    }(e)
                },
                postApply: function (e, t, n, i) {
                    for (var r, o, a, s = e[0], l = e[e.length - 1], c = [], d = s, u = l, h = 0, f = l.length, p = 0, m = e.length; p < m; ++p) o = e[p], (a = R(o, !i)) ? (r || (r = new O(a), c.push(r)), r.textNodes.push(o), o === s && (h = (d = r.textNodes[0]).length), o === l && (u = r.textNodes[0], f = r.getLength())) : r = null;
                    var g = D(l, !i);
                    if (g && (r || (r = new O(l), c.push(r)), r.textNodes.push(g)), c.length) {
                        for (p = 0, m = c.length; p < m; ++p) c[p].doMerge(n);
                        t.setStartAndEnd(d, h, u, f)
                    }
                },
                createContainer: function (e) {
                    var t = e.createElement(this.elementTagName);
                    return this.copyPropertiesToElement(this.elementProperties, t, !1), this.copyAttributesToElement(this.elementAttributes, t), l(t, this.className), this.onElementCreate && this.onElementCreate(t, this), t
                },
                applyToTextNode: function (e, t) {
                    var i = e.parentNode;
                    if (1 == i.childNodes.length && this.useExistingElements && o(i) && r(this.tagNames, i.tagName.toLowerCase()) && C(i, this.elementProperties)) l(i, this.className); else {
                        var a = this.createContainer(n.getDocument(e));
                        e.parentNode.insertBefore(a, e), a.appendChild(e)
                    }
                },
                isRemovable: function (e) {
                    return o(e) && e.tagName.toLowerCase() == this.elementTagName && u(e) == this.elementSortedClassName && C(e, this.elementProperties) && !w(e, this.attrExceptions) && this.isModifiable(e)
                },
                isEmptyContainer: function (e) {
                    var t = e.childNodes.length;
                    return 1 == e.nodeType && this.isRemovable(e) && (0 == t || 1 == t && this.isEmptyContainer(e.firstChild))
                },
                removeEmptyContainers: function (e) {
                    for (var t, n = this, i = e.getNodes([1], function (e) {
                        return n.isEmptyContainer(e)
                    }), r = [e], o = M(r), a = 0; t = i[a++];) m(t, o);
                    A(r, o)
                },
                undoToTextNode: function (e, t, n, i) {
                    if (!t.containsNode(n)) {
                        var r = t.cloneRange();
                        r.selectNode(n), r.isPointInRange(t.endContainer, t.endOffset) && (N(n, t.endContainer, t.endOffset, i), t.setEndAfter(n)), r.isPointInRange(t.startContainer, t.startOffset) && (n = N(n, t.startContainer, t.startOffset, i))
                    }
                    this.isRemovable(n) ? g(n, i) : c(n, this.className)
                },
                applyToRange: function (e, t) {
                    var n = M((t = t || []) || []);
                    e.splitBoundariesPreservingPositions(n), this.removeEmptyElements && this.removeEmptyContainers(e);
                    var i = y(e);
                    if (i.length) {
                        for (var r, o = 0; r = i[o++];) this.isIgnorableWhiteSpaceNode(r) || this.getSelfOrAncestorWithClass(r) || !this.isModifiable(r) || this.applyToTextNode(r, n);
                        r = i[i.length - 1], e.setStartAndEnd(i[0], 0, r, r.length), this.normalize && this.postApply(i, e, n, !1), A(t, n)
                    }
                },
                applyToRanges: function (e) {
                    for (var t = e.length; t--;) this.applyToRange(e[t], e);
                    return e
                },
                applyToSelection: function (t) {
                    var n = e.getSelection(t);
                    n.setRanges(this.applyToRanges(n.getAllRanges()))
                },
                undoToRange: function (e, t) {
                    var n = M(t = t || []);
                    e.splitBoundariesPreservingPositions(n), this.removeEmptyElements && this.removeEmptyContainers(e, n);
                    var i, r, o = y(e), a = o[o.length - 1];
                    if (o.length) {
                        for (var s = 0, l = o.length; s < l; ++s) i = o[s], (r = this.getSelfOrAncestorWithClass(i)) && this.isModifiable(i) && this.undoToTextNode(i, e, r, n), e.setStartAndEnd(o[0], 0, a, a.length);
                        this.normalize && this.postApply(o, e, n, !0), A(t, n)
                    }
                },
                undoToRanges: function (e) {
                    for (var t = e.length; t--;) this.undoToRange(e[t], e);
                    return e
                },
                undoToSelection: function (t) {
                    var n = e.getSelection(t), i = e.getSelection(t).getAllRanges();
                    this.undoToRanges(i), n.setRanges(i)
                },
                isAppliedToRange: function (e) {
                    if (e.collapsed || "" == e.toString()) return !!this.getSelfOrAncestorWithClass(e.commonAncestorContainer);
                    var t = e.getNodes([3]);
                    if (t.length) for (var n, i = 0; n = t[i++];) if (!this.isIgnorableWhiteSpaceNode(n) && v(e, n) && this.isModifiable(n) && !this.getSelfOrAncestorWithClass(n)) return !1;
                    return !0
                },
                isAppliedToRanges: function (e) {
                    var t = e.length;
                    if (0 == t) return !1;
                    for (; t--;) if (!this.isAppliedToRange(e[t])) return !1;
                    return !0
                },
                isAppliedToSelection: function (t) {
                    var n = e.getSelection(t);
                    return this.isAppliedToRanges(n.getAllRanges())
                },
                toggleRange: function (e) {
                    this.isAppliedToRange(e) ? this.undoToRange(e) : this.applyToRange(e)
                },
                toggleSelection: function (e) {
                    this.isAppliedToSelection(e) ? this.undoToSelection(e) : this.applyToSelection(e)
                },
                getElementsWithClassIntersectingRange: function (e) {
                    var t = [], n = this;
                    return e.getNodes([3], function (e) {
                        var i = n.getSelfOrAncestorWithClass(e);
                        i && !r(t, i) && t.push(i)
                    }), t
                },
                detach: function () {
                }
            }, B.util = {
                hasClass: s,
                addClass: l,
                removeClass: c,
                hasSameClasses: h,
                replaceWithOwnChildren: g,
                elementsHaveSameNonClassAttributes: b,
                elementHasNonClassAttributes: w,
                splitNodeAt: N,
                isEditableElement: k,
                isEditingHost: S,
                isEditable: E
            }, e.CssClassApplier = e.ClassApplier = B, e.createCssClassApplier = e.createClassApplier = function (e, t, n) {
                return new B(e, t, n)
            }
        })
    }), $__System.registerDynamic("33", ["11", "13", "1b", "25", "1e", "12", "29"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i = e("11"), r = e("13"), o = e("1b"), a = e("25"), s = e("1e"), l = e("12"), c = window.Node, d = l.Node,
            u = l.TYPE, h = (e("29"), /[A-Za-z_\\u00C0-\\u024f]/i);

        function f(e, t) {
            return new RegExp(r.escapeRegExp(e) + (t.wholeWord ? "(?![A-Za-z_\\u00C0-\\u024f])" : ""), t.caseSensitive ? "g" : "gi")
        }

        var p = null;
        var m = i.Model.extend({
            initialize: function (e) {
                this.editor = e, this.bindEvents(), this.curSel = null, this.searchTimer, this.applier = o.createClassApplier("md-search-hit"), this.selectApplier = o.createClassApplier("md-search-select")
            }, bindEvents: function () {
                var e, t = this, n = !1, i = a.map;
                !File.isMac && !File.isNode && a("command+f, ctrl+f", function (e) {
                    t.showPanel(), e.preventDefault()
                }), !File.isMac && !File.isNode && a("command+h, ctrl+h", function (e) {
                    t.showPanel(!0), e.preventDefault()
                }), $(document.body).on("keydown", function (e) {
                    var n = event.keyCode || event.which;
                    if ("Esc" == i[n] && t.isOpen) return t.closePanel(), !1
                }).on("mouseup", ".md-search-hit", function () {
                    t.closePanel(!1, $(this))
                }).on("mouseup", ".cm-search-hit", function (e) {
                    var n = $(e.target).closest(".CodeMirror")[0].CodeMirror, i = s.posFromMouse(n, e),
                        r = n.indexFromPos(i), o = t.searchStatus.hits.find(function (e) {
                            return e.isCm == n && e.start <= r && e.end >= r
                        });
                    if (t.closePanel(!0), o) return n.doc.setSelection(n.posFromIndex(o.start), n.posFromIndex(o.end)), !1
                }).on("mouseup", ".CodeMirror", function (e) {
                    t.closePanel(!0)
                }), $("#md-searchpanel").on("blur", function () {
                    t.closePanel()
                }).on("click", ".close-btn", function () {
                    t.closePanel()
                }).on("keydown", "input", function () {
                    var e = event.keyCode || event.which;
                    if ("Esc" == i[e]) return t.closePanel(), !1
                }).on("keydown", "#search-panel-input", function () {
                    var e = event.keyCode || event.which;
                    return "Enter" == i[e] ? (t.highlightNext(), !1) : "Tab" == i[e] ? $("#md-searchpanel.searchpanel-replace-mode").length ? ($("#search-panel-replace-input").focus(), !1) : (this.value += "\t", !1) : void 0
                }).on("keyup", "#search-panel-input", function () {
                    var r = event.keyCode || event.which;
                    (n = n && !(String.fromCharCode(r).match(/\s|[0-9]/g) || "Enter" == i[r])) || e == $(this).val() || (e = $(this).val(), t.doSearch(e))
                }).on("keydown", "#search-panel-replace-input", function () {
                    var e = event.keyCode || event.which;
                    if ((n = 229 == e) || "Enter" != i[e]) {
                        if ("Tab" == i[e] && !event.shiftKey) return !1
                    } else t.replaceSelection()
                }).on("mousedown", "#search-panel-prev", function () {
                    t.highlightNext(!0)
                }).on("mousedown", "#search-panel-next", function () {
                    t.highlightNext()
                }).on("click", "#md-search-type-label", function () {
                    $("#md-searchpanel").addClass("searchpanel-replace-mode"), $("#search-panel-replace-input").focus(), document.body.classList.add("on-replace-panel-open")
                }).on("click", "#md-replace-type-label", function () {
                    $("#md-searchpanel").removeClass("searchpanel-replace-mode").removeClass("searchpanel-msg-mode"), $("#search-panel-input").focus(), document.body.classList.remove("on-replace-panel-open"), $("content").removeClass("on-replace-panel-open")
                }).on("click", "#search-panel-replace-btn", function () {
                    t.replaceSelection(), $("#md-searchpanel").removeClass("searchpanel-msg-mode")
                }).on("click", "#search-panel-replaceall-btn", function () {
                    $("#md-searchpanel").removeClass("searchpanel-msg-mode"), t.replaceAll()
                }).on("click", "#searchpanel-msg-close-btn", function () {
                    $("#md-searchpanel").removeClass("searchpanel-msg-mode")
                }).on("click", "#searchpanel-msg-undo-btn", function () {
                    t.editor.undo.undo(), $("#md-searchpanel").removeClass("searchpanel-msg-mode"), !t.editor.sourceView.inSourceMode && t.doSearch($("#search-panel-input").val())
                }).on("mousedown", "#searchpanel-case-option-btn", function (e) {
                    return this.classList.toggle("active"), File.isMac && app.touchBar && app.touchBar.updateFindReplaceMode(), t.doSearch(), !1
                }).on("mousedown", "#searchpanel-word-option-btn", function () {
                    return this.classList.toggle("active"), File.isMac && app.touchBar && app.touchBar.updateFindReplaceMode(), t.doSearch(), !1
                })
            }, replaceAll: function () {
                if (this.searchStatus && this.searchStatus.hits.length) {
                    var e, t = this.searchStatus.searchText, n = $("#search-panel-replace-input").val(),
                        r = this.searchStatus.hits;
                    (function (e) {
                        p && clearTimeout(p), $("#md-searchpanel.searchpanel-replace-mode").addClass("searchpanel-msg-mode").find("#searchpanel-msg-content").text(e), p = setTimeout(function () {
                            $("#md-searchpanel").removeClass("searchpanel-msg-mode")
                        }, 5e3)
                    }).call(this, (o = this.searchStatus.hits.length, this.searchStatus.searchText, "Replaced " + o + " occurrence(s)"));
                    var o;
                    if (this.editor.sourceView.inSourceMode) {
                        var a = "", s = 0, l = r.length;
                        for (e = 0, t = this.editor.sourceView.cm.getValue(); s < l; s++) a = a + t.substring(e, r[s].start - 0) + n, e = r[s].end - 0;
                        return a += t.substring(e), this.editor.sourceView.cm.setValue(a), void this.clearSearch()
                    }
                    var c = this.editor.undo.UndoManager,
                        d = c.makeEmptyCommand(i.utils.extend(this.searchStatus.curSelection, {type: "cursor"})),
                        u = this.searchStatus, m = null;
                    this.clearSearch();
                    for (s = 0; s < r.length; s++) m != (e = r[s]).cid && (m = e.cid, v.call(this, e));
                    this.editor.undo.register(d)
                }

                function g(e, i) {
                    var r = e.get(i);
                    r && e.set(i, r.replace(f(t, u), function (e, t, i) {
                        return u.wholeWord && t > 0 && h.exec(i.substr(t - 1, 1)) ? e : n
                    }))
                }

                function v(e) {
                    var t = this.editor.getNode(e.cid);
                    d.undo.push(c.buildReplaceUndo(t)), g(t, "text"), g(t, "title"), g(t, "ref"), d.redo.push(c.buildReplaceUndo(t)), this.editor.findElemById(t.cid).replaceWith(t.toHTML())
                }
            }, replaceSelection: function () {
                if (this.editor.sourceView.inSourceMode && !this.searchStatus.curSelection && this.highlightNext(), this.searchStatus.curSelection && this.searchStatus.hits.length && $("#md-searchpanel.searchpanel-replace-mode").length) {
                    var e, t, n, i = $("#search-panel-replace-input").val(),
                        r = i.length - this.searchStatus.searchText.length, o = this.searchStatus.curPos,
                        a = this.editor.undo.UndoManager, s = a.makeEmptyCommand(), l = this.searchStatus.curSelection,
                        c = l.isCm;
                    n = r, this.searchStatus.lastRange ? (e = this.editor.nodeMap.allNodes.get(l.cid), s.undo.push({
                        type: "cursor",
                        id: e.cid,
                        start: l.start,
                        end: l.end
                    }), this.selectApplier.undoToRange(this.searchStatus.lastRange), this.applier.undoToRange(this.searchStatus.lastRange), n = i.length - (this.searchStatus.curSelection.end - this.searchStatus.curSelection.start), this.searchStatus.lastRange.deleteContents(), this.searchStatus.lastRange.insertNode(document.createTextNode(i)), this.searchStatus.lastRange = null, s.undo.push(a.buildReplaceUndo(e)), this.editor.store(e.cid), s.redo.push(a.buildReplaceUndo(e))) : c && c.doc.replaceSelection(i, "start", "+findReplace"), function (e) {
                        for (var t = e.curPos + 1; t < e.hits.length; t++) {
                            var i = e.hits[t];
                            i.cid == e.curSelection.cid && (i.start += n, i.end += n)
                        }
                    }(this.searchStatus), this.highlightNext(), this.searchStatus.hits.splice(o, 1), this.searchStatus.curPos--, this.searchStatus.curPos < 0 && (this.searchStatus.curPos = this.searchStatus.hits.length - 1), this.searchStatus.hits.length || this.clearSearch(), t = this.searchStatus.curSelection || this.searchStatus.initRange, this.editor.sourceView.inSourceMode || (t && s.redo.push({
                        type: "cursor",
                        id: t.cid,
                        start: t.start,
                        end: t.end
                    }), this.editor.undo.register(s))
                }
            }, isOpen: function () {
                return "block" == document.querySelector("#md-searchpanel").style.display
            }, showPanel: function (e) {
                if (!$("#md-searchpanel").is(":visible")) {
                    var t = editor.selection.getRangy();
                    editor.lastCursor = editor.selection.buildUndo(t), this.editor.undo.completeSnap(!0), this.clearSearch(), this.searchStatus.initPos = editor.selection.getPosBookmark(), $("#md-searchpanel").show();
                    var n = document.querySelector("#search-panel-input");
                    n.value || (n.value = t.toString()), n.focus(), n.select(), n.value && this.doSearch(n.value), document.body.classList.add("on-search-panel-open")
                }
                e ? ($("#md-searchpanel").addClass("searchpanel-replace-mode"), document.body.classList.add("on-replace-panel-open")) : ($("#md-searchpanel").removeClass("searchpanel-replace-mode"), document.body.classList.remove("on-replace-panel-open")), File.isMac && app.touchBar && (app.touchBar.showFindReplaceTouchBar(), app.touchBar.updateFindReplaceMode())
            }, closePanel: function (e, t) {
                t = t || $(".md-search-select");
                var n = this.editor.getMarkElem().length;
                if (document.body.classList.remove("on-replace-panel-open"), document.body.classList.remove("on-search-panel-open"), $("#md-searchpanel").removeClass("searchpanel-msg-mode").hide(), this.editor.sourceView.inSourceMode) return this.searchStatus && this.searchStatus.hits.length && (this.editor.fences.clearSearchAll(), this.editor.sourceView.cm.focus()), void this.resetSearchStatus();
                e ? n = !0 : t.length ? (this.editor.selection.selectAllElem(t), this.editor.lastCursor = this.editor.selection.buildUndo(), n = !1) : this.searchStatus && this.searchStatus.curSelection && this.searchStatus.curSelection.isCm && (this.searchStatus.curSelection.isCm.focus(), this.editor.lastCursor = this.editor.selection.buildUndo(), n = !1), this.clearSearch(), $(".md-search-hit").removeClass("md-search-hit"), !n && this.editor.restoreLastCursor(), !e && this.editor.refocus()
            }, doSearch: function (e) {
                this.clearSearch(void 0, !0);
                var t = this.editor, n = this, i = this.searchStatus, r = i && i.initPos,
                    a = r && document.querySelector("[cid='" + r.cid + "']");
                i.searchText = void 0 === e ? $("#search-panel-input").val() : e, i.caseSensitive = $("#searchpanel-case-option-btn.active").length, i.wholeWord = $("#searchpanel-word-option-btn.active").length;

                function s(e) {
                    var t = e.containerNode || document.querySelector("[cid='" + e.cid + "']");
                    return !!a && (a.compareDocumentPosition(t) == c.DOCUMENT_POSITION_PRECEDING || a == t && e.start < r.start)
                }

                function l(e, n) {
                    for (var r = f(n, i), o = e.getValue(), a = !1, l = null; r.exec(o);) a = !0, l = {
                        isCm: e,
                        cid: e.cid,
                        start: r.lastIndex - n.length,
                        end: r.lastIndex
                    }, i.wholeWord && l.start > 0 && h.exec(o.substr(l.start - 1, 1)) || (i.hits.push(l), s(l) && i.curPos++);
                    a && t.fences.searchOn(e, n, i)
                }

                function p(e) {
                    var t = $(e.commonAncestorContainer);
                    if (t.closest(".md-meta, .md-content, script").length || t.hasClass("md-meta") || t.hasClass("md-content") || t[0] && "script" == t[0].tagName) t.closest("[md-inline]").addClass("md-search-expand"); else {
                        e.getNodes([1], function (e) {
                            return e.classList.contains("md-meta") || e.classList.contains("md-content") || "script" == e.tagName
                        }).forEach(function (e) {
                            $(e).closest("[md-inline]").addClass("md-search-expand")
                        })
                    }
                }

                function m(e, n, r) {
                    e.get("children").length ? e.get("children").toArray().map(function (e) {
                        m(e, n)
                    }) : t.fences.queue[e.cid] ? l(t.fences.queue[e.cid], n) : d.isType(e, u.math_block) ? (t.mathBlock.currentCm || {}).cid === e.cid && (t.fences.clearSearchOn(t.mathBlock.currentCm), l(t.mathBlock.currentCm, n)) : function (e, n, r) {
                        for (var a, l, c = f(n, i), d = t.findElemById(e.cid)[0], u = d.textContent; c.exec(u);) l = {
                            cid: e.cid,
                            containerNode: d,
                            start: c.lastIndex - n.length,
                            end: c.lastIndex
                        }, i.wholeWord && l.start > 0 && h.exec(u.substr(l.start - 1, 1)) || ((a = a || o.createRange()).moveToBookmark(l), g.applyToRange(a), p(a), i.hits.push(l), s(l) && i.curPos++)
                    }(e, n)
                }

                if (i.searchText.match(/^([a-z]|\s)?$/gi)) $(".md-search-expand").removeClass("md-search-expand"); else {
                    n = this;
                    var g = this.applier;
                    if (this.editor.sourceView.inSourceMode) return void l(this.editor.sourceView.cm, i.searchText);
                    this.searchTimer && (clearTimeout(this.searchTimer), this.searchTimer = null), this.searchTimer = setTimeout(function () {
                        $(".md-search-expand").removeClass("md-search-expand");
                        for (var e = t.nodeMap.getFirst(); e;) m(e, i.searchText), e = e.get("after");
                        n.highlightNext()
                    }, 100)
                }
            }, highlightNext: function (e) {
                if (!$("#md-searchpanel").is(":visible")) return this.showPanel();
                $("#md-searchpanel").removeClass("searchpanel-msg-mode");
                var t, n = this.searchStatus, i = this.editor;
                if (n && n.hits.length) {
                    var r = null;
                    n.curSelection ? n.curPos += e ? -1 : 1 : function () {
                        if (i.lastCursor) if (void 0 != i.lastCursor.startId) {
                            var e = i.selection.rangy.createRange();
                            e.moveToBookmark({
                                containerNode: i.findElemById(i.lastCursor.startId)[0],
                                start: i.lastCursor.start,
                                end: i.lastCursor.start
                            }), n.curPos = 0;
                            for (var t = 0; t < n.hits.length; t++) {
                                if (!(a(e, r = n.hits[t]) > 0)) return;
                                n.curPos++
                            }
                        } else if (i.lastCursor.pos) for (n.curPos = 0, t = 0; t < n.hits.length; t++) {
                            var r = n.hits[t];
                            if (!(s(i.lastCursor, r) > 0)) return;
                            n.curPos++
                        }
                    }(), n.curPos >= n.hits.length ? n.curPos = 0 : n.curPos < 0 ? n.curPos = n.hits.length - 1 : isNaN(n.curPos - 0) && (n.curPos = 0), function (r) {
                        (function () {
                            n.curSelection && ((t = n.curSelection.isCm) ? t.execCommand(e ? "goDocStart" : "goDocEnd") : n.lastRange && this.selectApplier.undoToRange(this.searchStatus.lastRange))
                        }).call(this), n.curSelection = n.hits[n.curPos], $(".md-focus").removeClass("md-focus"), (t = n.curSelection.isCm) ? (n.lastRange = null, t.doc.setSelection(t.posFromIndex(n.curSelection.start), t.posFromIndex(n.curSelection.end)), File.isTypeWriterMode ? i.selection.typeWriterScroll($(".CodeMirror-selectedtext")) : i.selection.scrollAdjust($(".CodeMirror-selectedtext"), null, window.innerHeight - 200), $(".CodeMirror-selectedtext").closest("[cid]").addClass("md-focus")) : (n.lastRange = n.lastRange || o.createRange(), n.lastRange.moveToBookmark({
                            containerNode: document.querySelector("[cid='" + n.curSelection.cid + "']"),
                            start: n.curSelection.start,
                            end: n.curSelection.end
                        }), this.selectApplier.applyToRange(n.lastRange), File.isTypeWriterMode ? i.selection.typeWriterScroll(n.lastRange.nativeRange) : i.selection.scrollAdjust(n.lastRange, null, window.innerHeight - 200), $("[cid='" + n.curSelection.cid + "']").addClass("md-focus"))
                    }.call(this, n.curPos)
                }

                function a(e, t) {
                    try {
                        var n = i.selection.rangy.createRange();
                        if (t.containerNode) n.moveToBookmark(t); else {
                            if (!t.isCm) return 0;
                            n.selectNode(t.isCm.getWrapperElement())
                        }
                        return e.compareBoundaryPoints(Range.END_TO_END, n)
                    } catch (e) {
                        Reporter.error(e, {level: "warning"})
                    }
                }

                function s(e, t) {
                    try {
                        if (t.isCm && t.isCm.cid == e.id) return t.isCm.indexFromPos(e.pos) - t.end;
                        r || (r = i.selection.rangy.createRange()).selectNode(i.findElemById(e.id)[0]);
                        var n = i.selection.rangy.createRange();
                        if (t.containerNode) n.moveToBookmark(t); else {
                            if (!t.isCm) return 0;
                            n.selectNode(t.isCm.getWrapperElement())
                        }
                        return r.compareBoundaryPoints(Range.END_TO_END, n)
                    } catch (e) {
                        Reporter.error(e, {level: "warning"})
                    }
                }
            }, clearSearch: function (e, t) {
                if (this.editor.sourceView.inSourceMode) return this.editor.fences.clearSearchAll(), void this.resetSearchStatus(this.searchStatus && (this.searchStatus.curSelection || this.searchStatus.initPos));
                if (t || $(".md-search-expand").removeClass("md-search-expand"), this.searchStatus) {
                    try {
                        this.searchStatus.lastRange && this.selectApplier.undoToRange(this.searchStatus.lastRange)
                    } catch (e) {
                    }
                    for (var n, i = o.createRange(), r = 0; r < this.searchStatus.hits.length; r++) {
                        var a = this.searchStatus.hits[r];
                        a.isCm || (i.moveToBookmark({
                            containerNode: document.querySelector("[cid='" + a.cid + "']"),
                            start: a.start,
                            end: a.end
                        }), this.applier.undoToRange(i))
                    }
                    (n = this.searchStatus.curSelection && this.searchStatus.curSelection.isCm) && (n.doc.setSelection(n.posFromIndex(this.searchStatus.curSelection.start)), $(n.display.input.textarea).blur())
                }
                this.editor.fences.clearSearchAll(), clearTimeout(this.searchTimer), this.searchTimer = null;
                var s = this.searchStatus && (this.searchStatus.curSelection || this.searchStatus.initPos);
                this.resetSearchStatus(s)
            }, resetSearchStatus: function (e) {
                this.searchStatus = {
                    hits: [],
                    curPos: 0,
                    searchText: null,
                    lastRange: null,
                    initPos: e,
                    curSelection: null
                }
            }
        });
        n.exports = m
    }), $__System.registerDynamic("34", ["e", "11"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i = e("e"), r = e("11").Model.extend({
            initialize: function (e) {
                this.editor = e, this.$container = i("#word-auto-suggest")
            }, search: function (e, t, n, i) {
                var r = e.substring(t, t + n);
                if (!r) return [];
                var o = [];
                return File.isMac ? (o = app.word.getSpellSuggestionInContext(e, t, n), i.type = "word", i.token = r, i.match = o, i.found = o.length, i.pageNo = 0, i.pageCnt = Math.floor((o.length - 1) / 5 + 1)) : i.found = !1, o
            }, showAutoSuggest: function (e, t, n, r) {
                if (r.token === e.substring(t, t + n)) return !1;
                var o = this.search(e, t, n, r), a = "";
                if (!r.found) return this.$container.hide(), !1;
                for (var s = 0; s < o.length && s < 40; s++) s % 5 == 0 && (a += (s > 0 ? "</ul>" : "") + "<ul data-page='" + s / 5 + "' style='display:none'>"), a += i("<li/>").attr("data-content", o[s]).text(o[s])[0].outerHTML;
                return a += "</ul>", this.$container.html(a), this.$container
            }
        });
        n.exports = r
    }), $__System.registerDynamic("35", ["11", "12", "13", "15", "18", "28"], !0, function (e, t, n) {
        "use strict";
        this || self, e("11");
        var i, r, o = e("12"), a = o.Node, s = o.NodeMap, l = o.TYPE, c = e("13"), d = e("15"), u = e("18"),
            h = e("28"),
            f = {"\b": "\\b", "\t": "\\t", "\n": "\\n", "\f": "\\f", "\r": "\\r", '"': '\\"', "'": "'", "\\": "\\\\"};
        var p, m, g = "", v = {}, y = [], b = [];

        function w(e, t) {
            var n = document.querySelector("[cid='" + e + "'] svg"), i = $(n).closest("[lang='mermaid']").length;
            if (File.isMac && i) {
                var r = function (e) {
                    var t = "<html><body>$1</body></html>", n = e.getBoundingClientRect();
                    return n = {
                        x: 0,
                        y: 0,
                        width: n.width,
                        height: n.height
                    }, t = t.replace("$1", h.svg2DataURL(e, !0, !0)), app.controller.screenshotHTML(t, n)
                }(n);
                t(r)
            } else {
                var o = h.svg2DataURL(n, i), a = n.getBoundingClientRect(), s = new Image;
                s.onerror = function (e) {
                    t("")
                }, s.onload = function () {
                    var e = document.createElement("canvas"), n = e.getContext("2d"), i = File.canvasratio, r = s.width,
                        o = a.bottom - a.top;
                    e.width = s.width, e.height = a.bottom - a.top, i > 1.1 && (e.width = r * i, e.height = o * i, n.scale(i, i)), n.drawImage(s, 0, 0), e.style.width = r + "px", e.style.height = o + "px", setTimeout(function () {
                        var n = "";
                        try {
                            n = e.toDataURL("image/png")
                        } catch (e) {
                            console.warn(e)
                        }
                        !function (e, t) {
                            var n;
                            if (File.isNode) {
                                var i = e.replace(/^data:image\/png;base64,/, ""), r = reqnode("electron").remote.app;
                                n = r.getPath("temp").replace(/[/\\]$/, "") + (File.isWin ? "\\\\" : "/") + Number(new Date) + ".png", reqnode("fs").writeFile(n, i, "base64", function (e) {
                                    e ? console.sendError(e.stack) : (t(n), b.push(n))
                                })
                            } else {
                                if (!File.isMac) return "";
                                n = window.app.path.savePNG(e), t(n), b.push(n)
                            }
                        }(n, t)
                    }, 100)
                }, s.src = o
            }
        }

        function C(e, t, n, i) {
            var r = e.split(/(\uE040\d+)\uE041/g);
            r.length;
            if (!r) return t(e);
            Promise.all(r.map(function (e, t) {
                return new Promise(function (t) {
                    if (e.charAt(0) == g) {
                        var r = e.substring(1) - 0, o = p[r].cid;
                        w(o, function (e) {
                            m.delete(o), "latex" == n && (e = function (e, t) {
                                if (!t) return e;
                                var n = null;
                                File.isNode ? (n = reqnode("path").basename(e), reqnode("fs-extra").moveSync(e, t + "/" + n)) : File.isMac && (n = app.path.moveItem(e, t));
                                return n
                            }(e, i)), t(JSON.stringify(e))
                        })
                    } else t(e)
                })
            })).then(function (n) {
                e = n.join(""), t(e)
            }, function (n) {
                t(e)
            })
        }

        function x() {
            if (File.isNode) for (; b.length;) reqnode("fs").unlink(b.pop(), function () {
            }); else File.isMac && (app.path.removeTempFiles(JSON.stringify(b)), b = [])
        }

        var k, S = function (e) {
                return u.recoverEscape(e).replace(/["'\\\b\t\n\f\r]/g, function (e) {
                    return f[e]
                }).replace(/\u200b/g, "")
            }, E = {left: "AlignLeft", right: "AlignRight", center: "AlignCenter"}, F = function (e, t, n, i) {
                t = void 0 === t ? "," : t, i = i || v;
                for (var r, o = [], a = n || e.getFirstChild(); a;) (r = L(a, i)) && o.push(r), a = a.get("after");
                return o.join(t)
            }, _ = function (e, t) {
                return t = t || e.get("text"), k.output(t, null, e).replace(/, $/, "") || 'Str ""'
            }, T = function (e) {
                return a.isType(e, "epub", "rst", "opml", "textile")
            }, M = /([^\\]|^)\\tag{([^}]+)}\s*/, A = /([^\\]|^)\\label{([^}]+)}\s*/, N = /([^\\]|^)\\over[^\w\d]/,
            L = function (e, t) {
                var n;
                T(t.target);
                switch (e.get("type")) {
                    case l.paragraph:
                        return "Para [" + (n = _(e)) + "]";
                    case l.meta_block:
                        return "";
                    case l.heading:
                        var i = a.isType(t.target, "textile", "opml") ? "" : "header-" + e.cid;
                        return "Header " + e.get("depth") + ' ("' + i + '", [], []) [' + _(e) + "]";
                    case l.blockquote:
                        return "BlockQuote [" + (n = F(e)) + "]";
                    case l.list:
                        var o = e.get("style");
                        return n = F(e), o == a.ListType.ol ? "OrderedList (1,Decimal,Period) [" + n + "]" : "BulletList [" + n + "]";
                    case l.list_item:
                        return "[" + (n = F(e)) + "]";
                    case l.fences:
                        if (d.isDiagramType(e.get("lang")) && a.isType(t.target, "epub", "docx", "odt", "latex")) {
                            p.push(e), m.add(e.cid);
                            var s = document.querySelector("[cid='" + e.cid + "'] svg").getBoundingClientRect();
                            return 'Div ("",[],[("style","text-align:center"), ("align", "center")]) [Para [Image (' + JSON.stringify(e.get("lang")) + ',[],[("width", "' + (s.right - s.left) + '"), ("align", "center")]) [Str ""] (' + (g + (p.length - 1)) + ',"fig:")]] '
                        }
                        var h = u.parsePandocAttr(e.get("lang"));
                        if (Object.keys(h).length) {
                            var f = [];
                            for (var v in h.nativeAttr) f.push('("' + v.replace(/['"]/g, "") + '","' + h.nativeAttr[v].replace(/['"]/g, "") + '")');
                            return 'CodeBlock ("' + S(h.id || "") + '",[' + (h.class || "").trim().split(/\s+/).map(function (e) {
                                return '"' + S(e) + '"'
                            }).join(",") + "],[" + f.join(",") + ']) "' + S(e.get("text")) + '"'
                        }
                        return 'CodeBlock ("",["' + S(getCodeMirrorMode(e.get("lang") || "", !1, !0)) + '"],[]) "' + S(e.get("text")) + '"';
                    case l.math_block:
                        if (n = e.get("text").trim().replace(/\u200b/g, ""), "epub" == t.target) {
                            var y = r[n];
                            if (y) return 'RawBlock (Format "html") ' + JSON.stringify(function (e) {
                                try {
                                    var t = (new DOMParser).parseFromString(e, "text/html");
                                    return t.querySelectorAll("mtable").forEach(function (e) {
                                        e.hasAttribute("columnalign") && !e.getAttribute("columnalign") && e.removeAttribute("columnalign")
                                    }), t.body.innerHTML
                                } catch (e) {
                                }
                                return e
                            }(y)) + " "
                        } else if ("latex" == t.target) {
                            if (n.match(/^\\(begin|newcommand|renewcommand|newenvironment|renewenvironment|def|let){/)) return 'RawBlock (Format "latex") ' + JSON.stringify(n)
                        } else if ("docx" == t.target) {
                            var b = function (e, t) {
                                t.number = t.number || 1;
                                var n;
                                if (File.option.autoNumberingForMath && (n = t.number, t.number++), N.test(e)) return [e, n];
                                var i = M.exec(e);
                                return e = e.replace(/([^\\]|^)\\eqref{([^}]+)}\s*/g, "$1($2)"), i ? (n = i[2], [e = e.replace(/([^\\]|^)\\tag{([^}]+)}\s*/g, "$1") + "\\qquad\\text{(" + c.escapeInQuote(n) + ")}", n]) : (e = e += "\\qquad\\text{(" + c.escapeInQuote(n + "") + ")}", (i = A.exec(e)) && (n = i[2]), [e, n])
                            }(n, t);
                            return "Plain [" + ['RawInline (Format "openxml") "<w:bookmarkStart w:id=\\"0\\" w:name=\\"%s\\"/><w:r><w:t>" '.replace("%s", b[1]), 'Math DisplayMath "' + S(b[0]) + '" ', 'RawInline (Format "openxml") "</w:t></w:r><w:bookmarkEnd w:id=\\"0\\"/>"'].join(",") + "]"
                        }
                        return 'Plain [Math DisplayMath "' + S(n) + '"]';
                    case l.hr:
                        return "HorizontalRule";
                    case l.def_footnote:
                    case l.def_link:
                        return "";
                    case l.toc:
                        return "latex" == t.target ? 'RawBlock (Format "latex") "\\\\tableofcontents"' : "wiki" == t.target ? 'RawBlock (Format "mediawiki") "__TOC__", RawBlock (Format "mediawiki") ""' : "rst" == t.target ? 'RawBlock (Format "rst") ".. contents::", RawBlock (Format "rst") "\n"' : "opml" == t.target ? "" : "textile" == t.target ? 'RawBlock (Format "textile") "{toc}", RawBlock (Format "textile") "\n"' : function (e, t) {
                            try {
                                return 'Div ("toc", [], []) [Para [' + e.toc.headers.map(t ? function (e) {
                                    return 'Str "' + " ".repeat(e.get("depth") - 1) + '", Link ("", [], []) [' + _(e) + '] ("#header-' + e.cid + '","")'
                                } : function (e) {
                                    return 'Str "' + "\\t".repeat(e.get("depth") - 1) + '", Link ("", [], []) [' + _(e) + '] ("#header-' + e.cid + '","")'
                                }).join(",LineBreak,") + "]]"
                            } catch (e) {
                                return console.warn(e.stack), ""
                            }
                        }(e.get("in"), "epub" == t.target);
                    case l.table:
                        var w = e.get("align").map(function (e) {
                            return E[e] || "AlignDefault"
                        }), C = w.map(function () {
                            return "0.0"
                        }), x = e.getFirstChild();
                        return "Table [] [" + w.join(",") + "] [" + C.join(",") + "] [" + F(x) + "] [" + F(e, ",", x.get("after")) + "]";
                    case l.table_row:
                        return "[" + F(e) + "]";
                    case l.table_cell:
                        return "[Plain [" + _(e) + "]]";
                    default:
                        return ""
                }
            }, R = [];
        R[l.strong] = "Strong", R[l.em] = "Emph", R[l.del] = "Strikeout", R[l.subscript] = "Subscript", R[l.superscript] = "Superscript";
        var D, O = {
            html: 'RawInline (Format "html") "<u>", $0, RawInline (Format "html") "</u>", ',
            docx: 'RawInline (Format "openxml") "<w:r><w:rPr><w:u w:val=\\"single\\" /></w:rPr><w:t>$0</w:t></w:r>", ',
            rtf: 'RawInline (Format "rtf") "{\\\\ul ", $0, RawInline (Format "rtf") " }", ',
            latex: 'RawInline (Format "latex") "\\\\underline{", $0, RawInline (Format "latex") "}", '
        }, I = {
            html: 'RawInline (Format "html") "<mark>", $0, RawInline (Format "html") "</mark>", ',
            docx: 'RawInline (Format "openxml") "<w:r><w:rPr><w:shd w:val=\\"clear\\" w:fill=\\"ffff00\\" /></w:rPr><w:t>$0</w:t></w:r>", ',
            rtf: 'RawInline (Format "rtf") "{{\\\\colortbl;\\\\red255\\\\green255\\\\blue0;} \\\\cb1 ", $0, RawInline (Format "rtf") "}", ',
            latex: 'RawInline (Format "latex") "\\\\hl{", $0, RawInline (Format "latex") "}", '
        }, P = {atag: !1, imgtag: !1, comment: !0}, B = function (e, t) {
            var n = function (e) {
                if (a.isType(e.type, l.plain, l.escape, l.emoji)) return e.inner || e.text;
                if (t) return e.text || "";
                throw Error("caught styles")
            };
            D || (D = new u.InlineLexer({skipOp: P}, n));
            try {
                return D.output(e.text, n, !0)
            } catch (e) {
                return !1
            }
        }, H = function (e, t) {
            var n, i, o, a, s, d = /^(\S*)(?:(\n)|(\s*))/, u = function (e) {
                for (var t, n = ""; e.length && (t = d.exec(e));) e = e.substring(t[0].length), t[1] && (n += 'Str "' + S(t[1]) + '", '), t[2] ? n += File.option.preLinebreakOnExport ? "LineBreak, " : "SoftBreak, " : t[3] && (n += "Space, ");
                return n
            };
            e.inner && (e.inner = e.inner.replace(/, $/, ""));
            var h = /^file:[\\\/]{0,2}/i;
            switch (e.type) {
                case l.strong:
                case l.em:
                case l.del:
                case l.subscript:
                case l.superscript:
                    return R[e.type] + " [" + e.inner + "], ";
                case l.plain:
                case l.escape:
                case l.tab:
                case l.emptyline:
                    return u(e.text);
                case l.html_entity:
                    return u(c.decodeHtmlEntity(e.text) || e.text);
                case l.pants:
                    return u(e.inner);
                case l.softbreak:
                    return File.option.preLinebreakOnExport ? "LineBreak, " : "SoftBreak, ";
                case l.code:
                    return 'Code ("", [], []) "' + S(e.text.trim()) + '", ';
                case l.autolink:
                case l.url:
                    return 'Link ("", [], []) [Str "' + S(e.text) + '"] ("' + S(e.href) + '", ""), ';
                case l.atag:
                    if (!T(t.target)) return 'Link ("", [], []) [' + e.inner + '] ("' + S(e.href) + '", "' + S("") + '"), ';
                case l.imgtag:
                    if (!T(t.target)) {
                        var f = $($.parseHTML(e.text));
                        return 'Image ("",[],[]) [Str "' + S(f.attr("title") || f.attr("alt") || "") + '"] ("' + S(File.editor.imgEdit.getRealSrc(e.href).replace(h, "")) + '","fig:"), '
                    }
                case l.tag:
                case l.comment:
                case l.ruby:
                    return 'RawInline (Format "html") "' + S(e.text) + '", ';
                case l.link:
                    if ("#" == (e.href || "").trim()[0]) {
                        var p = e.href.substr(1), m = $("h1, h2, h3, h4, h5, h6").filter(function () {
                            return $(this).text().toLowerCase().trim() == p.toLowerCase().trim()
                        });
                        m.length && (e.href = "#header-" + m.attr("cid"))
                    }
                    return 'Link ("", [], []) [' + e.inner + '] ("' + S(e.href) + '", "' + S(e.title || "") + '"), ';
                case l.image:
                    return 'Image ("",[],[]) [Str "' + S(e.title || "") + '"] ("' + S(File.editor.imgEdit.getRealSrc(e.href).replace(h, "")) + '","fig:"), ';
                case l.refimg:
                    o = "Image";
                case l.reflink:
                    return i = (n = t.nodeMap.link_list.getNodeByRef(e.ref || e.text)) ? S(n.get("href").replace(h, "")) : "", p = S(n && n.get("title") || ""), "Image" == (o = o || "Link") && (e.inner = 'Str "' + S(p || "") + '"'), o + ' ("", [], []) [' + e.inner + '] ("' + i + '", "' + p + '"), ';
                case l.footnote:
                    var g = t.nodeMap.foot_list.getNodeByRef(e.text);
                    return g ? "Note [Para [" + _(g) + "]], " : u(e.text);
                case l.attr:
                    return u(e.text);
                case l.emoji:
                    return 'Str "' + S(e.inner) + '", ';
                case l.inline_math:
                    if ("epub" == t.target) {
                        var v = r[e.text.replace(/(^\s*\$+)|(\$+\s*$)|\u200b/g, "").trim()];
                        if (v) return 'RawInline (Format "html") ' + JSON.stringify(v) + ", "
                    }
                    return 'Math InlineMath "' + S(e.text.replace(/(^\s*\$+)|(\$+\s*$)|\u200b/g, "")) + '", ';
                case l.linebreak:
                    return "LineBreak, ";
                case l.highlight:
                    if ("latex" == t.target) y.push("\\usepackage{color}"), y.push("\\usepackage{soulutf8}"); else if ("docx" == t.target) return s = B(e, !0), I[t.target].replace("$0", S(c.escape(s)));
                    a = I;
                case l.underline:
                    return a = a || O, "docx" == t.target ? (s = B(e, !0), a[t.target].replace("$0", S(c.escape(s)))) : (a[t.target] || a.html).replace("$0", e.inner);
                default:
                    return u(e.text || "")
            }
        }, U = function (e) {
            var t = [];

            function n(e, t) {
                if (t instanceof Array) return n = t, '("' + S(e) + '", MetaList [' + n.map(function (e) {
                    return 'MetaInlines [RawInline (Format "tex") "' + S(e) + '"]'
                }).join(", ") + "])";
                var n;
                return '("' + S(e) + '", MetaInlines [ ' + (k.output(t).replace(/, $/, "") || 'Str ""') + "])"
            }

            e["header-includes"] && e["header-includes"] instanceof Array ? e["header-includes"] = e["header-includes"].concat(y) : y.length && (e["header-includes"] = y);
            for (var i in e) t.push(n(i, e[i]));
            return t.join(", ")
        };
        s.prototype.exportToNative = function (e, t, n) {
            File.editor.export.cleanUpTempFiles = x, function (e) {
                if (v = {
                    forExport: !0,
                    target: e,
                    nodeMap: this,
                    skipOp: P
                }, y = [], p = [], m = new Set, void 0 === File.canvasratio) {
                    File.canvasratio = 1;
                    var t = document.createElement("canvas").getContext("2d"), n = window.devicePixelRatio || 1,
                        i = t.webkitBackingStorePixelRatio || t.mozBackingStorePixelRatio || t.msBackingStorePixelRatio || t.oBackingStorePixelRatio || t.backingStorePixelRatio || 1;
                    File.canvasratio = n / i
                }
            }.call(this, e), "epub" == e && (r = Object.create(null), !i && File.option.enableInlineMath && (i = document.querySelector("#inline-math-export-jax"), MathJax.Hub.Typeset(i), i = MathJax.Hub.getAllJax(i)[0]), $(".md-inline-math, [mdtype='math_block']").each(function () {
                try {
                    var e, t = this.querySelector("script").textContent.trim().replace(/\u200b/g, "");
                    this.classList.contains("md-inline-math") ? (i.Text(t), e = i.root.toMathML("")) : e = MathJax.Hub.getAllJax(this)[0].root.toMathML(""), r[t] = e
                } catch (e) {
                }
            })), k && k.options.nodeMap === this || (k = new u.InlineLexer(v, H));
            var o = F(null, "\n ,", this.getFirst(), v),
                s = "Pandoc (Meta {unMeta = fromList [" + U(File.editor.docMenu.buildMetaMap()) + "]})\n [" + o + "]";
            return a.isType(e, "epub", "docx", "odt", "latex") ? C(s, t, e, n) : t(s), s
        }
    }), $__System.registerDynamic("36", ["11", "12", "13", "18", "2f", "35", "28", "17", "e", "37"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i, r, o = e("11"), a = e("12"), s = a.Node, l = a.TYPE, c = (a.NodeCollectionUtils, e("13")), d = e("18"),
            u = e("2f"), h = (e("35"), e("28")), f = e("17"), p = e("e"), m = (e("37"), File.isWin ? 8e3 : 960),
            g = File.isWin ? 5 : 40, v = function () {
                for (var e = document.querySelectorAll("#write figure"), t = 0; t < e.length; t++) {
                    var n = e[t];
                    n.style.zoom = Math.min(n.clientWidth / n.scrollWidth, 1), n.style.overflowX = "hidden", n.style.overflowy = "hidden"
                }
            }, y = function () {
                for (var e = document.querySelectorAll("#write a"), t = /^\s*#(.+)$/, n = {
                    "\b": "\\b",
                    "\t": "\\t",
                    "\n": "\\n",
                    "\f": "\\f",
                    "\r": "\\r",
                    '"': '\\"',
                    "'": "\\'",
                    "\\": "\\\\"
                }, i = function (e) {
                    return e.replace(/["\\\b\t\n\f\r]/g, function (e) {
                        return n[e]
                    }).replace(/\u200b/g, "")
                }, r = 0; r < e.length; r++) {
                    var o, a = e[r], s = a.getAttribute("name"), l = a.getAttribute("href");
                    if (s) {
                        var c = document.createElement("a"), d = document.createTextNode(" ");
                        c.appendChild(d), c.setAttribute("class", "md-print-anchor"), c.setAttribute("href", "uaf://" + i(s)), a.parentNode.insertBefore(c, a)
                    }
                    l && (o = t.exec(l)) && (l = o[1], a.setAttribute("href", "uat://" + i(l)))
                }
            };

        function b(e) {
            if (r) r.close(), r.destroy(), r = null; else if (!e) return;
            p("#md-notification").hide()
        }

        window.releaseCaptureWin_ = b;
        var w = o.Model.extend({
            initialize: function (e) {
                this.editor = e, window.debugMode && SystemJS.import("FileSaver.min.js").then(function (e) {
                    i = e
                })
            }, exportToNative: function (e, t, n) {
                return t = File.isMac ? function (e) {
                    app.controller.exportWithPandocCallback(e)
                } : t || function () {
                }, this.editor.nodeMap.exportToNative(e, t, n)
            }, exportToImage: function () {
                function e() {
                    b(!0), i && (i.postMessage("terminiate"), i.terminate(), i = null)
                }

                var t, n = File.option.imageExportWidth,
                    i = new Worker((window.debugMode ? "lib" : "lib.asar") + "/image-worker.js"),
                    o = reqnode("electron").remote, a = o.getCurrentWindow(), s = o.app, l = o.dialog,
                    c = o.BrowserWindow, d = this, u = o.screen.getPrimaryDisplay().scaleFactor || 1,
                    h = s.setting.get("zoomFactor") || 1, f = 0, v = null;
                i.onmessage = function (t) {
                    t.data.success ? (o.shell.showItemInFolder(v), e()) : (console.sendError(t.data.error), Reporter.error(t.data.error, {level: "warn"}), e())
                };
                try {
                    (function () {
                        File.editor.store(!0), b(!0);
                        var e = d.exportToHTML(!0, !1, !1, !0), t = o.app.setting.config;
                        return (r = new c({
                            skipTaskbar: !0,
                            show: !1,
                            webPreferences: {
                                devTools: !1,
                                webSecurity: !1,
                                allowDisplayingInsecureContent: !0,
                                allowRunningInsecureContent: !0,
                                nodeIntegration: !1,
                                directWrite: t.directWrite,
                                defaultFontFamily: t.defaultFontFamily,
                                zoomFactor: h
                            },
                            webgl: !1,
                            useContentSize: !0,
                            width: n,
                            height: m,
                            frame: !1,
                            enableLargerThanScreen: !!File.isWin,
                            offscreen: !0,
                            alwaysOnTop: !0,
                            minimizable: !1,
                            closable: !0
                        })).loadURL("data:text/html;charset=UTF-8,  " + encodeURIComponent(e)), r
                    })().webContents.once("did-finish-load", function () {
                        r.webContents.executeJavaScript("window.innerHeight").then(function (o) {
                            File.isLinux && (m = o), setTimeout(function () {
                                r.webContents.executeJavaScript("document.body.parentElement.scrollTop = document.body.clientHeight;\nMath.max(document.body.clientHeight, document.body.parentElement.scrollHeight)").then(function (o) {
                                    return o -= 0, isNaN(o) || null == o ? b(!0) : (t = o) > m * g ? (e(), l.showErrorBox(p.localize.getString("Export Failed", "Panel"), p.localize.getString("Generated Image too Large", "Panel")), !1) : void function o(a) {
                                        var s = t - a;
                                        s > m && (s = m), r.setSize(n, s), r.setContentSize(n, s), r.webContents.executeJavaScript("document.body.parentElement.scrollTop = {d}; document.body.parentElement.scrollHeight;".replace("{d}", a)).then(function (l) {
                                            setTimeout(function () {
                                                r ? ((l -= 0) > t + 100 && (i.postMessage({
                                                    action: "updateTotalHeight",
                                                    totalHeight: l
                                                }), t = l), r.webContents.capturePage(function (r) {
                                                    if (r.isEmpty()) return e();
                                                    u > 1 && (r = r.resize({
                                                        width: n,
                                                        quality: "best"
                                                    })), i.postMessage({
                                                        action: "addImage",
                                                        buffer: r.toDataURL(),
                                                        index: f,
                                                        position: {width: n, offset: a},
                                                        totalHeight: t,
                                                        total: Math.ceil(t / m)
                                                    }), a + s < t && (f++, o(a += s))
                                                })) : e()
                                            }, 50)
                                        })
                                    }(0)
                                })
                            }, 1e3)
                        })
                    })
                } catch (t) {
                    e()
                }
                l.showSaveDialog(a, {
                    properties: ["saveFile"],
                    title: "Export to…",
                    defaultPath: s.getPath("userDesktop") + "/" + File.getSuggestedFileName(!0) + ".png",
                    filters: [{name: "PNG", extensions: ["png"]}, {name: "JPEG", extensions: ["jpg", "jpeg"]}]
                }, function (t) {
                    if (!t) return e();
                    v = t, i.postMessage({
                        action: "setPath",
                        path: v
                    }), p("#md-notification").html("<p> " + p.localize.getString("Exporting in progress...", "Panel") + " </p>").show()
                })
            }, exportAndSaveHTML: function (e) {
                var t = new Blob([this.exportToHTML(e)], {type: "text/html;charset=utf-8"});
                i(t, "export.html")
            }, exportCollection: function (e, t, n, i, r, o, a) {
                var m = this.editor.nodeMap, g = this.editor, v = (o = o || new d.InlineLexer({
                    nodeMap: m,
                    count: 1,
                    footnoteList: [],
                    appendFootnote: function (e, n) {
                        if (!t[n]) {
                            t[n] = [""];
                            var i = o.output(e.get("text"), u.decorateAsExport, !1, {parent: e, skipFootnote: n});
                            t[n][0] = "<span class='md-fn-count'>" + n + "</span> " + i
                        }
                        var r = t[n].length - 1, a = n + (r ? "-" + r : "");
                        return t[n].push("<a name='dfref-footnote-" + a + "' href='#ref-footnote-" + a + "' title='" + p.localize.getString("back to document") + "' class='reversefootnote' >↩</a>"), a
                    },
                    noStyle: i,
                    forPrint: n,
                    skipOp: {atag: !0, underline: !0, comment: !0, imgtag: !0}
                }, u.decorateAsExport), ""), y = i ? "\n" : "", b = this;
                t = t || [];

                function w(e, a) {
                    if ("string" == typeof e) return o.output(e, u.decorateAsExport);
                    var l = e.get("children");
                    return s.canContainBlock(e.get("type")) ? l && l.length > 0 ? b.exportCollection(l, t, n, i, r, o) : o.output(e.get("text"), u.decorateAsExport) : o.output(e.get("text"), u.decorateAsExport, void 0, void 0, a)
                }

                function x(e) {
                    var t = null;

                    function r(e) {
                        return e ? m.toc.headers.findIndex(function (t) {
                            return t.cid == e
                        }) : -1
                    }

                    switch (e.get("type")) {
                        case l.paragraph:
                            if (-1 == e.get("text").indexOf("\n")) {
                                var o = s.parseFrom(e.getText(), null, {noTop: !0, skips: {fromP: !0}}, !0)[1][0];
                                if (s.isType(o, l.heading) && (o.cid = e.cid, -1 == r(o.cid) && e.isTopBlock())) {
                                    var u = g.findElemById(o.cid).prevAll(".md-heading").last().attr("cid");
                                    m.toc.headers.splice(r(u) + 1, 0, o)
                                }
                                if (s.isType(o, l.heading, l.def_footnote, l.def_link)) return o.cid = e.cid, x(o)
                            }
                            var v = {}, b = w(e, v);
                            return "" == b || v.hasContent ? "<p>" + (b || "&nbsp;") + "</p>" : b;
                        case l.heading:
                            var C = "";
                            return n && 1 == e.get("depth") && !e.get("parent") && e.get("before") && (C = " data-breakpage"), "<h" + e.get("depth") + C + ">" + (i || a ? "" : "<a name='header-" + e.cid + "' class='md-header-anchor " + (n ? "md-print-anchor' href='af://" + e.cid + "'> " : "'>") + "</a>") + w(e) + "</h" + e.get("depth") + ">";
                        case l.blockquote:
                            return "<blockquote>" + w(e) + "</blockquote>";
                        case l.list:
                            var k = e.get("style"), S = function () {
                                for (var t = e.get("children").toArray(), n = 0; n < t.length; n++) {
                                    var i = t[n].getFirstChild();
                                    if (!s.isType(i, l.paragraph) || i.get("after")) return !0
                                }
                                return !1
                            }();
                            e.set("loose", S);
                            var E = "";
                            return k == s.ListType.ol && (E = "" === e.get("start") ? void 0 : e.get("start") - 0, E = Number.isNaN(E) || 1 == E ? "" : " start='" + e.get("start") + "' "), "<" + k + E + ">" + y + w(e) + y + "</" + k + ">";
                        case l.list_item:
                            return e.get("style") === s.ListType.task ? "<li " + (i ? "" : "class='md-task-list-item task-list-item task-list-" + (e.get("checked") ? "done" : "not-done") + "'") + " ><input type='checkbox' disabled='disabled' " + (e.get("checked") ? "checked" : "") + "/>" + w(e) + "</li>" : "<li>" + (j = e, !1 === j.get("parent").get("loose") ? w(j.getFirstChild()) : w(j)) + "</li>";
                        case l.fences:
                            if (i) {
                                var F = e.get("lang") || "";
                                if (F) {
                                    return "<pre" + d.attrToString(d.parsePandocAttr(F)) + "><code class='language-" + (F = c.escapeInQuote(getCodeMirrorMode(F, !1, !0))) + "' lang='" + F + "'>" + c.escape(e.get("text")) + y + "</code></pre>"
                                }
                                return "<pre><code>" + c.escape(e.get("text")) + y + "</code></pre>"
                            }
                            var _, T = g.findElemById(e.id).clone();
                            if (File.option.enableDiagram && s.isType((e.get("lang") || "").toLowerCase(), "flow", "sequence", "mermaid")) {
                                _ = !1;
                                var M = g.findElemById(e.id).find("svg"), A = T.find("svg");
                                return M.attr("width") && !M.attr("viewBox") && (A.attr("viewBox", "0 0 " + M.attr("width") + " " + M.height()), A.css("max-width", "100%"), A.css("height", "auto")), h.processExportedSVG(T.find(".md-diagram-panel").html(T.find(".md-diagram-panel-preview").html())[0].outerHTML)
                            }
                            if (!1 !== _ && (_ = e.get("text").split(/\n/).length > 13), T.children(".CodeMirror").length && T.removeAttr("cid").removeAttr("contenteditable").removeAttr("mdtype").html(T.children(".CodeMirror")[0].outerHTML).find(".CodeMirror-cursors, .CodeMirror-hscrollbar, .CodeMirror-vscrollbar, .CodeMirror-selected").remove().end().find(".CodeMirror-sizer").css("min-height", "").end().find(".CodeMirror-selectedtext").removeClass("CodeMirror-selectedtext").end(), n && File.option.noLineWrapping && T.children(".CodeMirror").addClass("CodeMirror-wrap").find(".CodeMirror-sizer").css("min-width", ""), _ && T.css("page-break-inside", "unset"), n && File.isNode) {
                                var N = window.getComputedStyle(File.editor.writingArea).fontFamily || "initial";
                                N = N.replace(/'/g, "\\'"), T.find(".CodeMirror-line > span").each(function () {
                                    !function e(t, n) {
                                        if (t.nodeType == document.TEXT_NODE) {
                                            var i = t.textContent;
                                            (i = i.split(/(;|-)/).map(function (e) {
                                                return ";" == e || "-" == e ? "<span style='font-family:" + n + "'>" + e + "</span>" : c.escape(e)
                                            }).join("")) != t.textContent && (t.innerHTML = i)
                                        } else 1 == t.nodeType && t.childNodes.forEach(function (t) {
                                            e(t, n)
                                        })
                                    }(this, N)
                                })
                            }
                            return T[0].outerHTML;
                        case l.html_block:
                            return f.buildHTMLForExport(e, g, n);
                        case l.math_block:
                            if (a) {
                                var L = g.findElemById(e.id).find(".MathJax_SVG").clone();
                                return function (e, t) {
                                    if (e && t) {
                                        var n = (e.getAttribute("viewBox") || "").split(" ");
                                        if (n && 4 === n.length) {
                                            n = n.map(function (e) {
                                                return e - 0
                                            });
                                            var i = e.getBoundingClientRect(),
                                                r = e.querySelector("g").getBoundingClientRect();
                                            n[0] = n[0] + (r.left - i.left) / i.width * n[2], n[2] = r.width / i.width * n[2], t.setAttribute("viewBox", n.join(" ")), a ? t.setAttribute("width", Math.min(r.width, 640)) : t.setAttribute("width", r.width)
                                        }
                                    }
                                }(g.findElemById(e.id).find("svg")[0], L.find("svg")[0]), L[0] ? h.processExportedSVG(L[0].outerHTML) : "<p class='md-math-block'>$$" + c.escape(e.get("text")) + "$$</p>"
                            }
                            var R = g.findElemById(e.id), D = R.width(), O = R.find(".MathJax_SVG").width();
                            return (R = R.clone()).find(".md-rawblock-tooltip").remove(), D < O - 10 && (R = R.find(".MathJax_SVG").css("zoom", D / O)), "<p class='md-math-block'>{math}</p>".replace("{math}", R[0] ? h.processExportedSVG(R[0].outerHTML) : "$$\n" + c.escape(e.get("text")) + "\n$$");
                        case l.hr:
                            return "<hr />";
                        case l.def_footnote:
                        case l.def_link:
                            return "";
                        case l.table:
                            e.get("align").length;
                            for (var I = "<figure><table>" + y, P = e.getFirstChild(); P;) P.get("before") ? I += x(P) : I += "<thead>" + y + x(P) + "</thead>" + y + "<tbody>", (P = P.get("after")) || (I += "</tbody>" + y);
                            return I += "</table></figure>";
                        case l.table_row:
                            I = "<tr>", P = e.getFirstChild();
                            for (var B, $ = e.get("parent").get("align"), H = 0, U = e.get("before") ? "td" : "th"; P;) I += "<" + U + (B = (B = $[H]) ? " style='text-align:" + B + ";' " : "") + ">" + x(P) + "</" + U + ">", P = P.get("after"), H++;
                            return I += "</tr>";
                        case l.table_cell:
                            return w(e) || "&nbsp;";
                        case l.meta_block:
                            return "";
                        case l.toc:
                            return function () {
                                if (i) return "<div>[TOC]</div>";
                                if (!t) {
                                    var e = p(document.querySelector(".md-toc-content")).clone();
                                    e.find("[data-ref]").each(function () {
                                        this.querySelector("a").setAttribute("href", (n && File.isMac ? "at://" : "#header-") + this.getAttribute("data-ref"))
                                    }), e.find(".md-meta").remove(), t = "<div class='md-toc' mdtype='toc'>" + e[0].outerHTML + "</div>"
                                }
                                return t
                            }();
                        default:
                            return "<p>" + w(e) + "</p>"
                    }
                    var j
                }

                if ("string" == typeof e) return w(e);
                if (e.length) {
                    var k = e instanceof Array, S = k ? e[0] : e.sortedFirst();
                    do {
                        v += x(S) + y, S = S.get("after")
                    } while (S && (!k || e.indexOf(S) > -1))
                }
                return v + (r ? C(t) : "")
            }, exportToHTML: function (e, t, n, i, r) {
                var o = this.editor.nodeMap, a = this.editor, s = [],
                    l = File.editor.docMenu.getValueInMeta("title") || (File.getFileName() || "").replace(/\.(md|mmd|markdown|txt|text)$/i, ""),
                    d = File.option.enableDiagram && p(".md-fences[lang='mermaid']").length,
                    u = Object.keys(File.editor.fences.queue).length, h = "";
                File.option.showLineNumbersForFence && a.fences.refreshEditor(!0);

                function f(e, t) {
                    if (!e) return "";
                    t = t || [];
                    var n, i = /^\s*@include-when-export\s+(url)?([('"]+)([^\)"']+)([)'"]+)/im;

                    function r(e) {
                        File.isMac ? e && t.push(app.path.getFilePath(e)) : e && t.push(e)
                    }

                    try {
                        (n = e.match(/^\s*@include-when-export\s.+$/gim)) && n.map(function (e) {
                            r((i.exec(e) || [])[3])
                        })
                    } catch (e) {
                    }
                    i = /^\s*@import\s+(url)?([('"]+)([^\)"']+)([)'"]+)/im;
                    try {
                        (n = e.match(/^\s*@import\s.+$/gim)) && n.map(function (e) {
                            r((i.exec(e) || [])[3])
                        })
                    } catch (e) {
                    }
                    return t.map(function (e) {
                        return "<link href='" + e + "' rel='stylesheet' type='text/css' />"
                    }).join("\n")
                }

                function m(e) {
                    return File.isMac ? app.path.readText(e) : File.isNode ? reqnode("fs").readFileSync(e, "utf-8") : void 0
                }

                return function (o, a) {
                    a = c.escape(a) || "", s.length && (window.app && app.setting.get("split_pages"), o += "<div class='footnotes-area' " + (e ? "data-breakpage" : "") + " ><hr/>" + C(s) + "</div>");
                    var l = e ? "<script> window.setBreakPage = function(b){var node = document.querySelectorAll('[data-breakpage]'); for(var i=0;i<node.length;i++){node[i].style.pageBreakBefore = b ? 'always':'' }}; setBreakPage(" + (window.app && app.setting.get("split_pages") ? "true" : "false") + ");<\/script>" : "",
                        g = File.isMac ? "is-mac" : "is-node",
                        b = i ? File.option.imageExportFontSize : document.body.parentElement.style.fontSize || "";
                    if (b && (b = " style='font-size:" + b + " !important'"), e && File.isMac && (l += "<script>(" + y.toString() + ")();<\/script>"), e && (l += "<script>(" + v.toString() + ")();<\/script>"), t) return "<!doctype html>\n<html>\n<head>\n<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>\n<title>" + a + "</title></head>\n<body>" + o + "</body>\n</html>";
                    var w = function () {
                        var t, r, o, a = [];
                        if (h = "", e) {
                            if (document.querySelectorAll("link[css-include]").forEach(function (e) {
                                h += "<link rel='stylesheet' href='" + c.escapeInQuote(e.href) + "' type='text/css' />"
                            }), !i && File.colorBrightness < .5 && File.isNode) {
                                var s = reqnode("electron").remote.app.getPath("userData");
                                h += ["github.css", "base.user.css", "github.user.css"].map(function (e) {
                                    return "<link rel='stylesheet' href='file:///" + c.escapeInQuote(s + "/themes/" + e) + "' type='text/css' />"
                                }).join("\n")
                            } else !i && File.colorBrightness < .5 && n && File.isMac ? (app.path.getThemeFolderPath(), h += ["github.css", "base.user.css", "github.user.css"].map(function (e) {
                                return "<link rel='stylesheet' href='http://typora-theme/" + c.escapeInQuote(e) + "' type='text/css' />"
                            }).join("\n")) : h += ["theme_css", "base_user_css", "theme_user_css"].map(function (e) {
                                return File.isMac ? "<link rel='stylesheet' href='" + c.escapeInQuote(p("#" + e).attr("href")) + "' type='text/css' />" : "<link rel='stylesheet' href='file://" + (File.isWin ? "/" : "") + c.escapeInQuote(p("#" + e).attr("href")) + "' type='text/css' />"
                            }).join("\n");
                            return ""
                        }

                        function l(e) {
                            for (var t in e.cssRules) {
                                var n = e.cssRules[t];
                                if (n.styleSheet) {
                                    if (n.href.match(/mermaid/i) && !d) continue;
                                    if (n.href.match(/sourcemode\.dark\.css/i)) continue;
                                    l(n.styleSheet)
                                } else a.push((n.cssText || "").replace(/content: ([^;]{1});/g, "content: '$1';"))
                            }
                        }

                        var g, v, y;
                        File.isMac && (o = ["theme_css", "base_user_css", "theme_user_css"].map(function (e) {
                            return v = [], y = app.path.getFilePath(p("#" + e).attr("href")).replace(/^file:\/\//, ""), f(g = m(y), v), v.forEach(function (e) {
                                (/^\/\//.exec(e) || /.+:\/\//.exec(e)) && (h += "<link href='" + e + "' rel='stylesheet' type='text/css' />")
                            }), function e(t, n) {
                                var i = /^["']/, r = [];
                                File.isMac && (n = app.path.getFilePath(n).replace(/^file:\/\/?/, "")), n = (n || "").replace(/[\/\\][^\/\\]*$/, "");

                                function o(t) {
                                    var o = (t.match(i) || [""])[0];
                                    return t = decodeURI(o.length ? t.substring(1, t.length - 1) : t), (t = File.isMac ? app.path.resolvePathRelateTo(t, n) : reqnode("path").resolve(n, t)).match(/\.css$/) ? (r.push(e(m(t), t)), t = "") : t = (File.isMac ? "file://" : "file:///") + t, o + encodeURI(t) + o
                                }

                                return t = (t || "").replace(/(^|;|\n)[\s]*@import([^;\n]+)(;|$|\n)/, function (e, t) {
                                    var n = (/['"]([^"']+)['"]/.exec(e) || [])[0];
                                    return n ? e.replace(n, o(n)) : e
                                }).replace(/url\([^:)]+\)/gi, function (e) {
                                    return "url(" + o(e = e.substring(4, e.length - 1)) + ")"
                                }), t = r.join("\n") + t
                            }(g, y)
                        }).join("\n")), r = ["(base\\.css)"], o || r.push("(theme)"), u && r.push("(codemirror)"), d && r.push("(mermaid)"), r = new RegExp(r.join("|"), "i");
                        for (var b = 0; b < document.styleSheets.length; b++) if (t = document.styleSheets[b], r.exec(t.href) && (l(t), /themes/.exec(t.href))) try {
                            var w = t.href;
                            File.isMac && (w = app.path.getFilePath(w));
                            var C = decodeURI(w.replace(File.isWin ? /^[\w_-]+:[\/]+/ : /^[\w_-]+:\/\/?/, ""));
                            h += f(m(C))
                        } catch (e) {
                        }
                        return o && a.push(o), a.join("\n")
                    }(), x = ["typora-export"];
                    return i && (x.push("for-image"), w += " ::-webkit-scrollbar {display: none;} "), File.option.preLinebreakOnExport || (w += " .typora-export p, .typora-export .footnote-line {white-space: normal;} "), File.option.indentFirstLine && (g += " first-line-indent"), document.body.classList.contains("os-windows") && (x.push("os-windows"), File.option.monocolorEmoji && x.push("monocolor-emoji")), r && (w += " " + r), "<!doctype html>\n<html" + b + (e ? " class='blink-to-pdf' " : "") + ">\n<head>\n<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>\n<title>" + a + "</title>" + h + "<style type='text/css'>html {overflow-x: initial !important;}" + w + "\n</style>\n</head>\n<body class='" + x.join(" ") + "' >\n<div  id='write' " + (e ? "style='top:auto'" : "") + " class = '" + g + "'>" + o + "</div>\n" + l + "</body>\n</html>"
                }(this.exportCollection(o.blocks, s, e, t, void 0, void 0, i), l)
            }
        });

        function C(e) {
            return e.map(function (e) {
                return "<div class='footnote-line'>" + e.join("") + "</div>"
            }).join("\n")
        }

        n.exports = w
    }), $__System.registerDynamic("38", ["1e"], !0, function (e, t, n) {
        this || self;
        var i = e("1e"), r = "CodeMirror-activeline", o = "CodeMirror-activeline-background",
            a = "CodeMirror-activeline-gutter";
        i.defineOption("styleActiveLine", !1, function (e, t, n) {
            var r = n != i.Init && n;
            t != r && (r && (e.off("beforeSelectionChange", c), s(e), delete e.state.activeLines), t && (e.state.activeLines = [], l(e, e.listSelections()), e.on("beforeSelectionChange", c)))
        });

        function s(e) {
            for (var t = 0; t < e.state.activeLines.length; t++) e.removeLineClass(e.state.activeLines[t], "wrap", r), e.removeLineClass(e.state.activeLines[t], "background", o), e.removeLineClass(e.state.activeLines[t], "gutter", a)
        }

        function l(e, t) {
            for (var n = [], i = 0; i < t.length; i++) {
                var l = t[i], c = e.getOption("styleActiveLine");
                if ("object" == typeof c && c.nonEmpty ? l.anchor.line == l.head.line : l.empty()) {
                    var d = e.getLineHandleVisualStart(l.head.line);
                    n[n.length - 1] != d && n.push(d)
                }
            }
            (function (e, t) {
                if (e.length != t.length) return !1;
                for (var n = 0; n < e.length; n++) if (e[n] != t[n]) return !1;
                return !0
            })(e.state.activeLines, n) || e.operation(function () {
                s(e);
                for (var t = 0; t < n.length; t++) e.addLineClass(n[t], "wrap", r), e.addLineClass(n[t], "background", o), e.addLineClass(n[t], "gutter", a);
                e.state.activeLines = n
            })
        }

        function c(e, t) {
            l(e, t.ranges)
        }
    }), $__System.registerDynamic("39", ["1e"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i = e("1e");
        i.defineOption("visibleSpace", !1, function (e, t, n) {
            n == i.Init && (n = !1), n && !t ? e.removeOverlay("visiblespace") : !n && t && e.addOverlay({
                token: function (e, t) {
                    if (!t) return null;
                    if (t.atBlockStart && e.pos < t.atBlockStart) return e.eat(" ") ? "startspace startspace-" + (e.pos - 1) : e.eat("\t") ? "starttab startspace-" + (e.pos - 1) : (e.pos++, null);
                    var n = /(^[ \t]+)|(\s+$)/.exec(e.string), i = e.string.length, r = n && n[1] ? n[1].length : -1;
                    n && n[2] && n[2].length;
                    return r > 0 && r > e.pos ? (e.pos++, "startspace-" + (e.pos - 1) + ("\t" == e.string.charAt(e.pos - 1) ? " starttab" : " startspace")) : (e.pos = i, null)
                }, name: "visiblespace"
            })
        })
    }), $__System.registerDynamic("3a", ["1e", "38", "39", "e", "11", "12", "13", "18", "1a"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i = e("1e"), r = (e("38"), e("39"), e("e")), o = (e("11"), e("12")), a = e("13"), s = e("18"), l = e("1a"),
            c = window.reqnode ? reqnode("electron").remote : null, d = o.Node, u = o.TYPE, h = r("#typora-source"),
            f = (r("#toggle-sourceview-btn"), !1), p = null, m = function (e) {
                this.editor = e, this.cm = null, this.inSourceMode = !1, this.renderedHTML = ""
            };
        m.prototype.prep = function () {
            if (!this.cm) {
                var e = document.querySelector("#typora-source-input"), t = this;
                this.cm = i.fromTextArea(e, {
                    lineWrapping: !0,
                    mode: "gfm",
                    theme: "typora-default",
                    styleSelectedText: !0,
                    maxHighlightLength: 1 / 0,
                    styleActiveLine: !0,
                    visibleSpace: !0,
                    viewportMargin: 100,
                    autoCloseBrackets: !0,
                    autoCloseTags: !0,
                    resetSelectionOnContextMenu: !1,
                    extraKeys: {Enter: "newlineAndIndentContinueMarkdownList"},
                    lineNumbers: !0,
                    dragDrop: !1,
                    indentUnit: File.option.codeIndentSize,
                    tabSize: File.option.codeIndentSize
                }, this.editor), h.css("z-index", "2");
                var n = null, r = (this.cm, this.editor);
                File.isMac ? n = app.menu.getItem("Edit").submenu() : File.isNode && (n = reqnode("electron").remote.Menu.getApplicationMenu().getItem("Edit").submenu), this.cm.on("changes", function (e, i) {
                    if (t.inSourceMode && (document.querySelector(".on-search-panel-open") && "+findReplace" !== i[0].origin && "setValue" !== i[0].origin && t.editor.searchPanel.closePanel(), "begin" !== i[0].origin && "sync" !== i[0].origin)) {
                        f = !0;
                        var o = File.editor.sourceView.cm.doc.historySize();
                        n && n.getItem && (n.getItem("Undo").setEnabled(!File.isLocked && o.undo > 0), n.getItem("Redo").setEnabled(!File.isLocked && o.redo > 0)), "fromDisk" !== i[0].origin && File.updateChangeCount(File.ChangeType.NSChangeDone), r.syncChange([{
                            type: "sync",
                            srcChanges: i
                        }]), File.needsUpdateSnap()
                    }
                }), this.cm.on("contextmenu", function (e, n) {
                    if (t.inSourceMode) {
                        var i = e.getCursor("from"), r = e.getCursor("to");
                        setTimeout(function () {
                            e.setSelection(i, r, {scroll: !1})
                        }, 180)
                    }
                }), this.cm.on("cursorActivity", function (e, n) {
                    t.inSourceMode && (File.isFocusMode && r.updateFocusMode(!0), File.isTypeWriterMode && t.scrollAdjust())
                }), this.cm.on("scrollCursorIntoView", function (e, n) {
                    t.inSourceMode && !File.isTypeWriterMode || n.preventDefault()
                }), this.cm.display.scroller.addEventListener("wheel", function (e) {
                    Math.abs(e.deltaY) < 4 || File.isFocusMode && File.isTypeWriterMode && r.updateFocusMode(!1)
                }, {passive: !0})
            }
        }, m.prototype.show = function () {
            File.sync();
            var e = this.editor.getMarkdown();
            try {
                p = S.call(this)
            } catch (e) {
                p = null, console.warn(e.stack)
            }
            this.editor.refocus(null), this.editor.cleanTooltip(), this.editor.searchPanel.closePanel(!0), this.inSourceMode = !0, File.isNode && c.getCurrentWindow().setInSourceMode(!0), r("body").addClass("typora-sourceview-on"), r(".md-tooltip-hide").hide(), this.renderedHTML = "", this.prep(), this.cm.setValue(e, "begin"), f = !1, h.show(), E.call(this), this.cm.refresh(), this.cm.focus(), this.cm.getDoc().clearHistory(), this.cm.options.readOnly = File.isLocked, this.enableTypeWriterMode(File.isTypeWriterMode)
        };
        var g;
        m.prototype.enableTypeWriterMode = function (e) {
            if (this.cm) {
                if (e) {
                    var t = this.cm.defaultTextHeight();
                    g = document.querySelector("content").clientHeight, this.cm.display.lineSpace.parentNode.style.paddingTop = (g - t) / 2 + "px", this.cm.display.lineSpace.parentNode.style.paddingBottom = (g - t) / 2 + "px"
                } else this.cm.display.lineSpace.parentNode.style.paddingTop = "", this.cm.display.lineSpace.parentNode.style.paddingBottom = "";
                this.scrollAdjust()
            }
        }, m.prototype.setValue = function (e, t, n) {
            this.cm && (this.cm.setValue(e, n || "begin"), t && (f = !0))
        }, m.prototype.onSave = function () {
            if (this.cm.doc.history.lastModTime = 0, f) {
                var e = this.cm.getScrollInfo().top;
                File.reloadContent(this.cm.getValue(File.useCRLF ? "\r\n" : "\n"), !1, !0, !1, !0), this.cm.scrollTo(0, e)
            }
        }, m.prototype.hide = function () {
            var e = this.editor;
            r("body").removeClass("typora-sourceview-on"), this.inSourceMode = !1, File.isNode && c.getCurrentWindow().setInSourceMode(!1), (p = this.cm.getCursor()).lineText = this.cm.getLine(p.line), function () {
                var e = p.lineText.substring(0, p.ch);
                p.inRef = e.match(b) && !e.match(w), p.textBefore = e
            }(), f && (File.isMac && !app.document.isDocumentEdited() && this.renderedHTML ? (r(File.editor.sessionStr).html(this.renderedHTML), setTimeout(function () {
                File.editor.refresh()
            }, 500), File.editor.syncChange([{
                type: "sync",
                allHtml: this.renderedHTML,
                json: l.buildAllDoc(File.editor.nodeMap).json
            }])) : File.reloadContent(this.cm.getValue(File.useCRLF ? "\r\n" : "\n"), !1, !0, !1, !0)), h.hide(), k.call(this), e.selection.scrollAdjust()
        }, m.prototype.scrollAdjust = function () {
            var e = this.cm;
            if (File.isTypeWriterMode) {
                var t = e.cursorCoords(!0, "window"), n = t.top - (g + t.bottom - t.top) / 2;
                Math.abs(n) > 2 && e.scrollTo(null, e.getScrollInfo().top + n)
            } else {
                var i = this.cm.charCoords(this.cm.getCursor(), "local").top,
                    r = this.cm.getScrollerElement().offsetHeight / 2;
                this.cm.scrollTo(null, i - r - 5)
            }
        };

        function v(e, t) {
            var n = "number" == typeof e ? e : e.get("tail");
            return void 0 === n ? void 0 === t ? e.get("after") ? 1 : 0 : t : n
        }

        function y(e, t) {
            function n(e, t) {
                return e.get("children").toArray().reduce(function (e, n) {
                    return e + y(n, t)
                }, 0)
            }

            function i(e) {
                return d.isType(e.get("parent"), u.list_item) && !1 !== e.get("parent").get("tight")
            }

            switch (e.get("type")) {
                case u.meta_block:
                    return 2 + e.get("text").match(/(\n|$)/g).length + v(e);
                case u.heading:
                    return (e.get("ahead") || 0) + ((e.get("pattern") || (!d.isType(e.get("parent"), u.list_item) && (1 == File.option.headingStyle || 3 == File.option.headingStyle) && e.get("depth") <= 2 ? "===" : "#")).match(/[-=]/) ? 2 : 1) + v(e);
                case u.paragraph:
                    var r = e.get("tail");
                    return t && (r = 0), d.isType(e.get("after"), u.paragraph) && r < 1 && (e.unset("tail"), r = 1), void 0 !== r || !d.isType(e.get("after"), u.math_block) && e.get("after") || (r = 0), (e.get("ahead") || 0) + (e.get("text").split(/\n/g).length || 1) + v(void 0 === r ? e : r, r);
                case u.blockquote:
                    return (e.get("ahead") || 0) + n(e, !0) + v(e);
                case u.list:
                    var o = e.get("ahead") || 0;
                    return e.isLoose(!0), o += n(e), d.isType(e.get("after"), u.list) && (!e.get("tail") || e.get("tail")) < 2 && e.get("pattern") == e.get("after").get("pattern") && e.get("style") == e.get("after").get("style") && (e.unset("tail"), o++, i(e) && o++), t || (o += v(e, i(e) ? 0 : 1)), o;
                case u.list_item:
                    return e.toMark().split(/\n/).length;
                case u.html_block:
                    return (e.get("ahead") || 1) + (e.get("text").match(/\n/g) || []).length + v(e);
                case u.fences:
                    var a = /`|~/.exec(e.get("pattern") || "```");
                    return (e.get("ahead") || 0) + (a ? 3 : 1) + (e.get("text").match(/\n/g) || []).length + v(e);
                case u.math_block:
                    return (e.get("ahead") || 0) + 3 + (e.get("text").match(/\n/g) || []).length + v(e, d.isType(e.get("before"), u.paragraph) && d.isType(e.get("after"), u.paragraph) ? 0 : 1);
                case u.hr:
                    return v(e) + 1;
                case u.toc:
                    return (e.get("ahead") || 0) + 1 + v(e);
                case u.def_footnote:
                case u.def_link:
                    return (e.get("ahead") || 0) + 1 + v(e, !e.get("after") || d.isType(e.get("after"), d.TYPE.def_link) ? 0 : 1);
                case u.table:
                    return (e.get("ahead") || 0) + e.get("children").length + 1 + v(e);
                case u.table_row:
                    return e.get("before") ? 1 : 2;
                case u.table_cell:
                    return 0;
                default:
                    return 1
            }
        }

        var b = /\[/, w = /\]/;
        var C = function (e, t, n) {
            var i = null;

            function r(e, t, n) {
                return void 0 === n && (n = (n = t ? p.lineText.indexOf(e) : p.lineText.lastIndexOf(e)) < 0 ? 0 : n), Math.max(0, p.ch - n)
            }

            switch (t.get("type")) {
                case u.paragraph:
                    for (var o = t.get("text").split(/\n/), l = 0, c = 0; c < n && c < o.length; c++) l += o[c].length + 1;
                    e.undo.exeCommand({type: "cursor", id: t.cid, start: l + r(o[n])});
                    break;
                case u.heading:
                    e.undo.exeCommand({
                        type: "cursor", id: t.cid, start: function (e, t) {
                            var n = t;
                            for (var i in e) void 0 !== i && i <= t && (n += e[i]);
                            return n
                        }(t.cursorDiff || [], r(t.get("text")))
                    });
                    break;
                case u.hr:
                case u.toc:
                    t.get("after") ? e.selection.jumpIntoElemBegin(e.findElemById(t.get("after").getVeryFirst().cid)) : e.selection.selectNode(t);
                    break;
                case u.math_block:
                    i = e.mathBlock.startEditing(t.cid), n--;
                    break;
                case u.html_block:
                    i = e.htmlBlock.startEditing(t.cid);
                    break;
                case u.fences:
                    (t.get("pattern") || "```").match(/`/) && n--, i = e.fences.getCm(t.cid);
                    break;
                case u.def_link:
                case u.def_footnote:
                    if (p.inRef) e.undo.exeCommand({type: "cursor", id: t.cid, start: r(t.get("ref"), !0)}); else {
                        var d = new RegExp("(]:\\s*)" + a.escapeRegExp(t.get("href") || t.get("text"))).exec(p.lineText),
                            h = d ? d.index + d[1].length : 0;
                        e.undo.exeCommand({
                            type: "cursor",
                            id: t.cid,
                            start: t.get("ref").length + r(void 0, void 0, h)
                        })
                    }
                    break;
                case u.meta_block:
                    for (o = t.get("text").split(/\n/), h = p.ch, c = 0; c < n - 1; c++) h += (o[c] || "").length + 1;
                    e.undo.exeCommand({type: "cursor", id: t.cid, start: h});
                    break;
                case u.table_row:
                    !function () {
                        var e = p.textBefore;
                        p.cellsBefore = s.splitTableCell(e.replace(/^\s*\|/, ""), !0) || [e], p.cellsOffset = p.cellsBefore.last().length, p.cellsBefore = p.cellsBefore.length
                    }(), e.undo.exeCommand({
                        type: "cursor",
                        id: t.getNthChild(Math.max(0, p.cellsBefore - 1)).cid,
                        start: p.cellsOffset
                    });
                    break;
                default:
                    e.selection.jumpIntoElemEnd(e.findElemById(t.getVeryFirst(!0).cid))
            }
            i && (i.focus(), n >= i.lineCount() ? i.execCommand("goDocEnd") : i.setCursor({
                line: n,
                ch: r(i.getLine(n))
            }))
        }, x = function (e, t, n) {
            var i = 0;
            for (n + (t.get("ahead") || 0) > p.line && e.selection.jumpIntoElemBegin(e.findElemById(t.getVeryFirst().cid)), i = y(t); t.get("after") && n + i <= p.line;) n += i, i = y(t = t.get("after"));
            t.get("children").length && !d.isType(t, u.table_row) ? x(e, t.getFirstChild(), n + (t.get("ahead") || 0)) : n + i - (r = t, d.isType(r, u.table_row) ? 0 : v(r)) > p.line ? C(e, t, p.line - n - (t.get("ahead") || 0)) : e.selection.jumpIntoElemEnd(e.findElemById(t.getVeryFirst(!0).cid));
            var r
        }, k = function () {
            var e = this.editor;
            try {
                x(e, e.nodeMap.getFirst(), 0)
            } catch (e) {
                console.warn(e.stack)
            }
            e.refocus()
        }, S = function () {
            if (this.editor.focusCid) {
                var e = this.editor.findElemById(this.editor.focusCid), t = this.editor.getNode(this.editor.focusCid),
                    n = 0, i = "", r = "", o = this.editor.selection.getRangy();
                if (t) {
                    if (n = function e(t, n) {
                        return n = n || 0, t ? t.get("before") ? e(t.get("before"), n + y(t.get("before"))) : t.get("parent") ? e(t.get("parent"), n + (t.get("parent").get("ahead") || 0)) : n : n
                    }(t) + (t.get("ahead") || 0), d.isType(t, u.fences)) {
                        var s = !/`|~/.exec(t.get("pattern") || "```");
                        return !s && n++, (p = document.activeElement.classList.contains("ty-cm-lang-input") ? {
                            line: -1,
                            before: t.get("pattern") || "```"
                        } : this.editor.fences.getCm(t.cid).doc.getCursor()).before = (s ? t.get("pattern") : "") + this.editor.fences.getCm(t.cid).getLine(p.line).substring(0, p.ch), p.line = p.line + n, p.ch = void 0, p
                    }
                    if (d.isType(t, u.math_block)) return this.editor.mathBlock.currentCm ? ((p = this.editor.mathBlock.currentCm.doc.getCursor()).line = p.line + n + 1, p) : {
                        line: n,
                        ch: -1
                    };
                    if (d.isType(t, u.toc)) return {line: n, before: "]"};
                    if (d.isType(t, u.hr)) return {line: n, before: this.get("pattern") || "------"};
                    if (d.isType(t, u.def_link, u.def_footnote)) {
                        var l, c = this.editor.getJQueryElem(o.startContainer);
                        if ((l = c.closest(".md-def-content")).length) return o.setStartBefore(l[0]), {
                            line: n,
                            before: i = "]: " + o.toString()
                        };
                        if ((l = c.closest(".md-def-title")).length && c.text().length) return o.setStartBefore(l[0]), {
                            line: n,
                            before: i = '"' + o.toString()
                        }
                    }
                    if (d.isType(t, u.table, u.table_row)) return {line: n, ch: -1};
                    if (o.setStartBefore(e[0]), i = o.toString().replace(/(\u200B*):(\u200B*)/g, ":").replace(/\200B\$/, "$"), d.isType(t, u.table_cell)) {
                        for (r = "", t = t.get("before"); t;) r = "\\|[^|]*" + r, t = t.get("before");
                        return {line: n, beforeRegExp: i = r + "\\|\\s*" + a.escapeRegExp(i)}
                    }
                    if (d.isType(t, u.meta_block)) return {
                        line: n = ((i = i.replace(/^---/gm, "​---").replace(/\n$/g, "")).match(/\n/g) || []).length + 1,
                        before: i = i.substring(i.lastIndexOf("\\n"))
                    };
                    if (d.isType(t, u.html_block)) return this.editor.htmlBlock.currentCm ? ((p = this.editor.htmlBlock.currentCm.doc.getCursor()).line = p.line + n, p) : {
                        line: n + 2,
                        ch: -1
                    };
                    if ("" === i && d.isType(t, u.paragraph, u.heading)) {
                        if (d.isType(t, u.heading)) {
                            var h = t.toMark();
                            if (/^\s*#/.exec(h)) return {line: n, beforeRegExp: "^\\s*#+\\s*"}
                        }
                        var f = t.getTopBlock();
                        if (d.isType(f, u.list, u.blockquote)) return {line: n, ch: 0, afterIndent: !0}
                    }
                    var m = i.split(/\n/) || [i];
                    return i = m.last(), {line: n + m.length - 1, before: i}
                }
            }
        }, E = function () {
            if (p) try {
                var e = p.ch;
                if (p.line < 0 && (p.line = this.cm.doc.lineCount() - 1), p.afterIndent) {
                    var t = this.cm.doc.getLine(p.line);
                    e = (/^((\s+)|([-+*]\s)|(\[( |x)\])|>|(\d+\.\s))+/i.exec(t) || [""])[0].length
                }
                if (void 0 === e) {
                    t = this.cm.doc.getLine(p.line);
                    if (p.before) e = t.indexOf(p.before) + p.before.length; else if (p.beforeRegExp) {
                        var n = new RegExp(p.beforeRegExp, "g");
                        n.exec(t), e = n.lastIndex
                    }
                }
                this.cm.doc.setCursor({line: p.line, ch: e > 0 ? e : 0}), e < 0 && this.cm.execCommand("goLineEnd")
            } catch (e) {
                console.warn(e.stack)
            }
        };
        n.exports = m
    }), $__System.registerDynamic("3b", ["e", "13", "25"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i, r = e("e"), o = e("13"), a = e("25").map,
            s = window.reqnode ? reqnode("electron").remote.app : window.app, l = function (e) {
                this.editor = e, this.worker = null
            }, c = r(r("#typora-quick-open-item-templ").html()), d = r(r("#typora-quick-loading-item-templ").html()),
            u = r(".typora-quick-open-list"), h = r(".typora-quick-open-list-inner"),
            f = r("#typora-quick-open-input input"), p = [], m = [], g = [], v = "", y = [], b = 40, w = 5, C = -1,
            x = null, k = window.app && new RegExp("^" + o.escapeRegExp(s.path.home)), S = 0, E = !0, F = -1, _ = 20;

        function T(e) {
            File.isMac && s.path.openURL(e, void 0, !0), File.isNode && s.openFileOrFolder(e, {
                mountFolder: function (e, t) {
                    var n = File.isWin ? "\\" : "/";
                    return e && t && 0 == t.indexOf(e.replace(/[\/\\]$/, "") + n)
                }(File.getMountFolder(), e) ? File.getMountFolder() : void 0
            })
        }

        function M(e, t, n) {
            var i = /[^\\\/]+$/.exec(e), r = i[0], a = e.substring(0, i.index);
            y.length && (r = o.escape(r).replace(new RegExp("((" + y.join(")|(") + "))", "gi"), "<b>$1</b>")), t.append(c.find(".typora-quick-open-item-title").html(r).end().find(".typora-quick-open-item-path").text((s = a, (s = s.replace(k, "~")).length > 60 ? s.substring(0, 30) + "..." + s.substring(s.length - 30, s.length) : s)).end().clone().attr("data-original", e).attr("data-index", n + "").addClass(F == n ? "active" : "")).css("translate3d", "(0, 0, 0)");
            var s
        }

        l.prototype.init = function () {
            var e = this;
            f.on("input", function () {
                var t = r(this).val();
                t != v && (p = [], v = t.replace(/[()'"%\\\/.?]/, " "), D.call(e, v))
            }).on("keydown", function (t) {
                var n = t.keyCode || t.which;
                if ("Esc" == a[n] || "o" == a[n] && t.shiftKey && t.metaKey) return e.close(), !1;
                if ("Tab" == a[n]) return !1;
                if ("Up" == a[n]) return A(-1), !1;
                if ("Down" == a[n]) return A(1), !1;
                if ("Enter" == a[n] && r(".typora-quick-open-item.active").length) return T(p[F]), e.close(), !1;
                if (File.isMac && t.ctrlKey && !t.metaKey && !t.shiftKey) {
                    if ("P" == String.fromCharCode(n)) return A(-1), !1;
                    if ("N" == String.fromCharCode(n)) return A(1), !1
                }
                t.stopPropagation()
            }).on("blur", function () {
                setTimeout(e.close, 200)
            }), u.on("mousedown", ".typora-quick-open-item", function (e) {
                1 == e.which && T(this.getAttribute("data-original"))
            }).on("scroll", N), File.isMac ? s.quickOpen.cacheRecentFiles() : File.isNode && (this.initWorker(), E = !1, this.setRecentFiles((s.setting.getRecentDocuments() || []).map(function (e) {
                return e.path
            })), this.cacheFolder(File.getMountFolder()))
        };

        function A(e) {
            if (p.length) {
                F = -1 == F ? 0 : (F + e) % p.length, r(".typora-quick-open-item.active").removeClass("active"), r(".typora-quick-open-item[data-index='" + F + "']").addClass("active");
                var t = F * b, n = u.scrollTop();
                (t < n || t > n + b * w - 10) && u.scrollTop(Math.min(t, (p.length - w) * b))
            }
        }

        function N(e, t) {
            t = t || h;

            function n(e) {
                if (!(e < 0)) {
                    t.find("[data-block-index='" + e + "']").remove();
                    var n = r("<div class='quick-open-group-block' data-block-index='" + e + "'>").css("position", "absolute").css("top", e * _ * 40 + "px").css("width", "100%"),
                        o = p.length;
                    i = Math.min(o + S, e * _ + _ + S);
                    for (var a = e * _; a < i; a++) a == o ? (s = o, n.append(d.clone().find(".typora-quick-open-info").text(r.localize.getString(s ? "Gathering more results" : "Searching")).end())) : M(p[a], n, a);
                    var s;
                    t.append(n)
                }
            }

            var o = u.scrollTop(), a = Math.floor(o / 40), s = Math.floor(a / _);
            s != C && (n((C = s) - 1), n(C), n(C + 1))
        }

        function L() {
            C = -1, h.html("").height(b * (p.length + S)), N(0, h)
        }

        function R(e, t) {
            e = o.removeDiacritics(e);
            var n = t.exec(e);
            return n ? (n[1] = n[1] || "", n[3] = n[3] || "", 4 - n[1].length - (/\w/.test(n[1]) ? 1 : 0) - (/\w/.test(n[3]) ? 1 : 0)) : 0
        }

        function D(e) {
            x = (p[F] || {}).p, E ? (this.setSearchState(1), File.isMac && s.quickOpen.query(e), File.isNode && File.mountFolder_ && this.worker.postMessage(["quickFind", File.mountFolder_, e])) : this.setSearchState(0), function (e) {
                var t = [], n = (y = e.split(/\s+/).filter(o.isNotNullOrEmpty).map(function (e) {
                    return e.replace(/[.+?^${}()|[\]\\]/g, "\\$&").replace("*", ".*")
                })).map(function (e) {
                    return new RegExp("(.)?" + e + "(.)?", "i")
                }), i = [];
                y.length ? (m.forEach(function (e) {
                    for (var i, r = 0, o = 0; o < n.length; o++) {
                        if (!(i = R(e.n, n[o]))) return;
                        r += i
                    }
                    e.s = r, t.push(e)
                }), t.sort(function (e, t) {
                    var n = t.s - e.s;
                    return n || t.d - e.d
                }), t = g.filter(function (e) {
                    for (var t = 0; t < n.length; t++) {
                        if (e.p.indexOf(File.getMountFolder() + (File.isWin ? "\\" : "/")) > -1) return !1;
                        if (!R(e.n, n[t])) return !1
                    }
                    return !0
                }).concat(t)) : t = (g || []).clone().concat(m), t.forEach(function (e) {
                    -1 == i.indexOf(e.p) && i.push(e.p)
                }), this.initResult(i)
            }.call(this, e), File.isMac && s.quickOpen.reindexFolderIfNeeded()
        }

        l.prototype.stopQuery = function () {
            File.isMac && s.quickOpen.stopQuery(), File.isNode && this.worker.postMessage(["stopQuery"])
        }, l.prototype.initWorker = function () {
            this.worker = new Worker("app/finder-worker.js");
            var e = this;
            this.worker.onmessage = function (t) {
                switch (t.data.type) {
                    case"initFileCache":
                        e.initFileCache.apply(e, t.data.detail);
                        break;
                    case"addInitFiles":
                        e.addInitFiles.apply(e, t.data.detail);
                        break;
                    case"removeInitFiles":
                        e.removeInitFiles.apply(e, t.data.detail);
                        break;
                    case"queryMatch":
                        e.updateResult.apply(e, t.data.detail);
                        break;
                    case"queryEnd":
                        e.setSearchState.apply(e, [0])
                }
            }
        }, l.prototype.cacheFolder = function (e) {
            File.isNode && (E = !0, m = [], this.worker.postMessage(["listAllFiles", e]))
        }, l.prototype.show = function () {
            var e = r("#typora-quick-open:not(:visible)").show();
            this.editor.searchPanel.closePanel(!0), e.length && (f[0].select(), F = -1, D.call(this, f.val().replace(/[()'"%\\\/.?]/, " ")))
        }, l.prototype.close = function () {
            r("#typora-quick-open:visible").hide().length && File.isMac && s.quickOpen.stopQuery(), F = -1
        }, l.prototype.appendResultAtEnd = function (e, t) {
            var n = h.children().last();
            return !!(n.hasClass("quick-open-group-block") && n[0].childElementCount + e.length <= _) && (e.forEach(function (e, i) {
                M(e, n, t + i)
            }), !0)
        }, l.prototype.updateResult = function (e) {
            e = e.filter(function (e) {
                return -1 == p.indexOf(e)
            });
            var t = p.length;
            e.length && ((p = p.concat(e)).length - t == e.length && this.appendResultAtEnd(e, t) || L.call(this))
        }, l.prototype.initResult = function (e) {
            F = x ? p.indexOf(x) : e.length ? 0 : -1, p = e, L.call(this)
        }, l.prototype.addInitFiles = function (e, t, n) {
            m = m.concat(e.map(function (e, i) {
                return {n: t[i], p: e, d: n[i]}
            }))
        }, l.prototype.removeInitFiles = function (e) {
            var t = e.length;
            m = m.filter(function (n) {
                return n.p.substring(0, t) != e
            })
        }, l.prototype.initFileCache = function (e, t, n, i, r) {
            m = e.map(function (e, i) {
                return {n: t[i], p: e, d: n[i]}
            }), r && (g = r.map(function (e) {
                return {n: (/[^\\\/]+$/.exec(e) || [])[0] || "", p: e}
            })), E = i > e.length
        }, l.prototype.setRecentFiles = function (e) {
            g = e.map(function (e) {
                return {n: (/[^\\\/]+$/.exec(e) || [])[0] || "", p: e}
            })
        }, l.prototype.setSearchState = function (e) {
            S !== e && (e && i == p.length ? (r(".typora-quick-open-item:last").after(d.clone().find(".typora-quick-open-info").text(r.localize.getString(i ? "Gathering more results" : "Searching")).end()), i++) : e || (r(".typora-quick-open-info-item").remove().length && h.height(h.height() - 40), i == p.length + 1 && i--), S = e)
        }, n.exports = l
    }), $__System.registerDynamic("3c", ["37", "e", "25"], !0, function (e, t, n) {
        "use strict";
        this || self, e("37");
        var i = e("e"), r = e("25").map, o = window.reqnode ? reqnode("electron").remote : null, a = o ? o.app : null,
            s = [{code: "en-US", userLang: "en-US", label: "English (US)", enLabel: "English (US)"}, {
                code: "en-GB",
                userLang: "en-GB",
                label: "English (UK)",
                enLabel: "English (UK)"
            }, {code: "cs", userLang: "cs-CZ", label: "Čeština", enLabel: "Czech"}, {
                code: "de",
                userLang: "de-DE",
                label: "Deutsch",
                enLabel: "German"
            }, {code: "es", userLang: "es-ES", label: "Española", enLabel: "Spanish"}, {
                code: "el",
                userLang: "el-GR",
                label: "Ελληνικά",
                enLabel: "Greek"
            }, {code: "fr", userLang: "fr-FR", label: "Français", enLabel: "French"}, {
                code: "hr",
                userLang: "hr-HR",
                label: "Hrvatski",
                enLabel: "Croatian"
            }, {code: "it", userLang: "it-IT", label: "Italiana", enLabel: "Italian"}, {
                code: "nl",
                userLang: "nl-NL",
                label: "Nederlands",
                enLabel: "Dutch"
            }, {code: "hu", userLang: "hu-HU", label: "Magyar", enLabel: "Hungarian"}, {
                code: "pl",
                userLang: "pl-PL",
                label: "Polski",
                enLabel: "Polish"
            }, {code: "pt", userLang: "pt-BR", label: "Português", enLabel: "Portuguese"}, {
                code: "ru",
                userLang: "ru-RU",
                label: "Ру́сский",
                enLabel: "Russian"
            }, {code: "sv", userLang: "sv-SE", label: "Svenska", enLabel: "Swedish "}, {
                code: "ko",
                userLang: "jo-KR",
                label: "한국어",
                enLabel: "Korean"
            }, {code: "zh", userLang: "zh", label: "中文", enLabel: "Chinese"}, {
                code: "ja",
                userLang: "ja-JP",
                label: "日本語",
                enLabel: "Janapese"
            }], l = "disabled", c = function (e) {
                this.editor = e, this.perFileSettingCache_ = new Map, this.langMode_ = File.option.presetSpellCheck, this.missingLocale_, this.clear_(), this.init_(), this.reset()
            };
        c.prototype.useHunSpell = function () {
            return !/Windows NT (8|10)\./.exec(navigator.userAgent)
        }, c.prototype.loadEnvLang_ = function () {
            var e = new Map;
            this.labelMap = {}, s.forEach(function (t) {
                e.set(t.userLang, t.code), this.labelMap[t.code] = t.label
            }, this);
            var t = File.option.userLocale, n = e.get(t);
            n || (n = /^zh/.exec(t) ? "zh" : e.get(a.getLocale() || "en-US") || "en-US"), this.envLang_ = n
        }, c.prototype.loadSettingForFile_ = function () {
            if (this.spellCheckFactory) {
                File.filePath ? this.perFileSettingCache_.has(File.filePath) ? this.langMode_ = this.perFileSettingCache_.get(File.filePath) || File.option.presetSpellCheck : (this.langMode_ = localStorage.getItem("[spellcheck]" + File.filePath), this.perFileSettingCache_.set(File.filePath, this.langMode_), this.langMode_ = this.langMode_ || File.option.presetSpellCheck) : this.langMode_ = File.option.presetSpellCheck;
                var e = this;
                "auto" != this.langMode_ && this.langMode_ != l && File.isNode && setTimeout(function () {
                    e.curSpellchecker = e.spellCheckFactory.getSpellChecker(/^(zh|ja)/.exec(e.langMode_ || "") ? "en-US" : e.langMode_)
                }, 1e3)
            }
        }, c.prototype.init_ = function () {
            File.isNodeHtml && (this.$label = document.querySelector("#footer-spell-check"), this.bindUI_(), File.isNode && (this.detectTimer_ = null, this.loadEnvLang_(), this.bindSpellChecker_()))
        }, c.prototype.bindUI_ = function () {
            var e = this;
            i("#footer-spell-check").on("click", function () {
                document.body.classList.contains("ty-show-spell-check") ? e.hide() : e.show()
            }), i("#spell-check-panel").on("click", "[data-spell-lang]", function () {
                e.setLangMode(this.dataset.spellLang, !0), e.hide(), document.querySelector("#footer-spell-check").classList.contains("ty-spell-check-dict-error") && e.showDictMissing()
            }).on("click", "#ty-spell-check-global-setting", function () {
                File.megaMenu.highlight("spellcheck-option-wrapper")
            }), i("#md-notification").on("click", ".dropdown-toggle", function () {
                i("#md-notification .dropdown-menu:visible").length ? i("#md-notification .dropdown-menu").parent().removeClass("open") : i("#md-notification .dropdown-menu").dropdown("toggle")
            }).on("blur", ".dropdown-toggle", function () {
                i("#md-notification .dropdown-menu").parent().removeClass("open")
            }).on("shown.bs.dropdown", function (e) {
                var t = i(this), n = t.find(".dropdown-toggle-split"), r = t.find(".dropdown-menu"), o = n.offset();
                o.top += n[0].clientHeight + 4, o.left += n[0].clientWidth - r[0].clientWidth + 2, r.offset(o)
            }).on("click", "#ty-spell-check-dict-missing-disable-btn", function () {
                e.setLangMode(l, !0), i("#md-notification").fadeOut()
            }).on("click", "#ty-spell-check-dict-missing-close-btn", function () {
                i("#md-notification").fadeOut()
            }).on("click", "#ty-spell-check-dict-missing-primary-btn", function () {
                e.useHunSpell() ? e.askDownloadDict_() : o.shell.openExternal("http://support.typora.io/Line-Break/")
            }).on("mousedown", "#ty-spell-check-dict-missing-secondary-btn", function () {
                e.useHunSpell() ? o.shell.openExternal("http://support.typora.io/Spellcheck/") : e.askDownloadDict_()
            }), i("#dict-install-dialog").on("click", ".btn-primary", function () {
                e.doDownloadDict_()
            })
        }, c.prototype.postSetSpellChecker_ = function (e, t) {
            if (this.resetSepllCheckProvider_(), this.userDictPath) if (null == this.curSpellchecker && this.downloadDicts[e] <= 1) i("#footer-spell-check").attr("ty-hint", i.localize.getString("Spell Check (%@ downloading)").replace("%@", this.labelMap[e])).removeClass("ty-spell-check-dict-error").addClass("ty-spell-check-dict-downloading"); else if (i("#footer-spell-check").removeClass("ty-spell-check-dict-downloading"), null == this.curSpellchecker && t) i("#footer-spell-check").attr("ty-hint", i.localize.getString("Spell Check (%@ unavailable)").replace("%@", this.labelMap[e])).addClass("ty-spell-check-dict-error"); else {
                var n;
                n = this.labelMap[e] ? (i.localize.getString("Spell Check") + " (%@)").replace("%@", this.labelMap[e]) : this.langMode_ == l ? i.localize.getString("Spell Check (Disabled)") : i.localize.getString("Spell Check"), i("#footer-spell-check").attr("ty-hint", n).removeClass("ty-spell-check-dict-error"), i("#md-notification").fadeOut()
            }
        }, c.prototype.setLangMode = function (e, t) {
            this.spellCheckFactory || (e = l, t = !1), this.langMode_ = e, File.filePath && t && (localStorage.setItem("[spellcheck]" + File.filePath, e), this.perFileSettingCache_.set(File.filePath, this.langMode_));
            var n, r = this.curSpellchecker, o = !1;
            this.langMode_ == l ? this.curSpellchecker = null : "auto" == this.langMode_ ? this.langAuto_ ? (n = this.langAuto_, this.curSpellchecker = this.getSpellChecker(this.langAuto_), o = !0) : (this.curSpellchecker = null, this.scheduleAutoUpdateLang()) : (n = this.langMode_, this.curSpellchecker = this.getSpellChecker(this.langMode_), o = !0), this.postSetSpellChecker_(n, o), r && r != this.curSpellchecker && (r || {}).lang != (this.curSpellchecker || {}).lang && i("[contenteditable='true']").prop("contenteditable", !1).prop("contenteditable", !0), this.updatePanel()
        }, c.prototype.buildPanel_ = function () {
            if (!this.panelBuilt_) {
                this.$panel = i("#spell-check-panel"), this.renderLangCandicate_(s);
                var e = this;
                this.panelBuilt_ = !0;
                var t = null;
                i("#ty-spell-check-panel-item-label").on("keydown", function (t) {
                    t.stopPropagation();
                    var n = t.keyCode || t.which;
                    if ("Esc" == r[n]) e.hide(); else {
                        if ("Tab" == r[n]) return !1;
                        if ("Up" == r[n] || "Down" == r[n]) return e.selectMove_("Up" == r[n]), !1;
                        "Enter" == r[n] ? i("[data-spell-lang].ty-active").trigger("click") : "Backspace" != r[n] && "Delete" != r[n] || i(this).trigger("input")
                    }
                }).on("input cut copy", function (n) {
                    t && clearTimeout(t), t = setTimeout(function () {
                        e.updateLangCandicate_(), t = null
                    }, 50)
                }), this.updatePanel()
            }
        }, c.prototype.renderLangCandicate_ = function (e) {
            var t = this.$panel[0].querySelector(".ty-lang-list"),
                n = this.$panel[0].querySelector("#ty-spell-check-panel-item-temp").innerText.trim(),
                i = this.langMode_, r = e.map(function (e) {
                    return n.replace("%label", e.label).replace(/%code/g, e.code).replace(/%select/, i == e.code ? "ty-checked" : "")
                }).join("");
            t.innerHTML = r
        }, c.prototype.updateLangCandicate_ = function () {
            var e = i("#ty-spell-check-panel-item-label").val().trim().toLocaleLowerCase();
            if (!e) return this.renderLangCandicate_(s), void this.ensureHighlight_();
            if (!this.$panel[0].style.height) {
                var t = this.$panel[0];
                t.style.height = t.clientHeight + "px"
            }
            var n = {}, r = s.filter(function (t) {
                var i = [t.code, t.userLang, t.label, t.enLabel].map(function (t) {
                    var n = t.toLocaleLowerCase().indexOf(e);
                    return ~n ? n : 99
                }).sort()[0];
                return 99 != i && (n[t.code] = i, !0)
            });
            r = r.sort(function (e, t) {
                return n[e.code] - n[t.code]
            }), this.renderLangCandicate_(r), this.ensureHighlight_()
        }, c.prototype.ensureHighlight_ = function () {
            var e = this.$panel.find(".ty-active");
            return e.length || (e = this.$panel.find(".ty-lang-list>.ty-spell-check-panel-item").first().addClass("ty-active")), e
        }, c.prototype.selectMove_ = function (e) {
            var t = this.ensureHighlight_(), n = e ? t.prev() : t.next();
            t.removeClass("ty-active"), n.addClass("ty-active")
        }, c.prototype.getSpellCheckLang_ = function () {
            return this.langMode_ == l ? null : "auto" == this.langMode_ ? this.langAuto_ || "" : this.langMode_
        }, c.prototype.updatePanel = function () {
            var e = this.getSpellCheckLang_();
            i("#footer-spell-check-label").html((e || "").toUpperCase() || '<span class="ty-icon ty-spellcheck" style="font-size: 1.1em;vertical-align: middle;"></span>'), this.panelBuilt_ && (this.$panel.find(".ty-checked").removeClass("ty-checked"), this.$panel.find("[data-spell-lang='" + this.langMode_ + "']").addClass("ty-checked"), this.$panel.find("[data-spell-lang='auto'] .ty-spell-check-panel-item-code").text(this.langAuto_ || ""))
        }, c.prototype.show = function () {
            this.loadSpellCheckErr && this.showLoadModuleError_(), this.editor.lastCursor = this.editor.selection.buildUndo(), this.buildPanel_(), document.body.classList.add("ty-show-spell-check"), document.body.classList.remove("ty-show-word-count"), this.autoUpdateLang(!0), document.querySelector("#footer-spell-check").classList.contains("ty-spell-check-dict-error") && this.showDictMissing(), setTimeout(function () {
                document.querySelector("#ty-spell-check-panel-item-label").focus()
            }, 10);
            this.$panel[0].style.height = ""
        }, c.prototype.hide = function () {
            document.body.classList.remove("ty-show-spell-check"), this.editor.restoreLastCursor(), i("#ty-spell-check-panel-item-label").val(""), this.$panel.find(".ty-active").removeClass("ty-active"), this.$panel[0].style.height = "", this.renderLangCandicate_(s)
        }, c.prototype.askDownloadDict_ = function () {
            var e = i("#dict-install-dialog"), t = this.missingLocale_;
            e.find("#dict-install-dialog-title").text(i.localize.getString("Download dictionary file for %@").replace("%@", t.label));
            var n = "https://dict.typora.io/" + t.code + "/LICENSE";
            e.modal({backdrop: "static"}).focus(), setTimeout(function () {
                e.find("webview").attr("src", n)
            }, 100)
        }, c.prototype.onFinishDownloadProgress_ = function (e) {
            this.getSpellCheckLang_() == e && (this.downloadDicts[e] = void 0, this.spellCheckFactory.clearCache(), i("#footer-spell-check").addClass("ty-spell-check-dict-downloaded"), this.setLangMode(e), setTimeout(function () {
                i("#footer-spell-check").removeClass("ty-spell-check-dict-downloaded")
            }, 1e3))
        }, c.prototype.onUpdateDownloadProgress_ = function (e, t, n) {
            var r = this.downloadDictsDetail_, o = t || 0;
            t < 0 ? (r[e] = void 0, this.downloadDicts[e] = void 0) : (r[e] || (r[e] = [0, 0]), void 0 !== t && (r[e][0] = t), void 0 !== n && (r[e][1] = n), o = (r[e][0] + r[e][1]) / 2, this.downloadDicts[e] = o), this.getSpellCheckLang_() == e && (t < 0 ? (i("#footer-spell-check").attr("ty-hint", i.localize.getString("Spell Check (%@ unavailable)").replace("%@", this.labelMap[e])).addClass("ty-spell-check-dict-error").removeClass("ty-spell-check-dict-downloading"), document.querySelector("#footer-spell-check-download-process").innerText = "") : (i("#footer-spell-check").attr("ty-hint", i.localize.getString("Spell Check (%@ downloading)").replace("%@", this.labelMap[e])).removeClass("ty-spell-check-dict-error").addClass("ty-spell-check-dict-downloading"), document.querySelector("#footer-spell-check-download-process").innerText = "#footer-spell-check.ty-spell-check-dict-downloading:before {width: " + 100 * o + "%;}"))
        }, c.prototype.doDownloadDict_ = function () {
            var e = this.missingLocale_.code;
            a.setting.downloadDict(e, o.getCurrentWindow().id), this.onUpdateDownloadProgress_(e, 0, 0), i("#md-notification").fadeOut()
        }, c.prototype.bindSpellChecker_ = function () {
            var e = this;
            try {
                var t = reqnode("electron").ipcRenderer;
                t.on("dict-loaded", function (t, n) {
                    e.langMode_, e.userDictPath = n, e.spellCheckFactory.setUserDictionaryPath(e.userDictPath), e.langMode_ && e.setLangMode(e.langMode_)
                }), this.downloadDicts = {}, this.downloadDictsDetail_ = {}, t.on("dict-download-start", function (t, n) {
                    e.onUpdateDownloadProgress_(n, 0, 0)
                }), t.on("dict-download-process", function (t, n) {
                    e.onUpdateDownloadProgress_(n.locale, "dic" == n.type ? n.process : void 0, "dic" == n.type ? void 0 : n.process)
                }), t.on("dict-download-end", function (t, n) {
                    e.onUpdateDownloadProgress_(n, 1, 1), e.onFinishDownloadProgress_(n)
                }), t.on("dict-download-err", function (t, n) {
                    e.onUpdateDownloadProgress_(n, -1)
                });
                a.setting.getDownloadingDicts().forEach(function (t) {
                    e.onUpdateDownloadProgress_(t, 0, 0)
                }), this.spellCheckFactory = reqnode("spellchecker"), this.curSpellchecker = null, this.userDictPath = a.setting.getUserDictionaryPath(), this.userDictPath, this.userDictPath && this.spellCheckFactory.setUserDictionaryPath(this.userDictPath);
                var n = new (reqnode("events").EventEmitter);
                n.add = function (e, n) {
                    t.send("user-dict-add", {lang: e, word: n})
                }, n.remove = function (e, n) {
                    t.send("user-dict-remove", {lang: e, word: n})
                }, n.loadUserDict = function () {
                    return a.setting.userDict || {}
                }, t.on("user-dict-update", function (e, t) {
                    n.emit("update", t)
                }), this.spellCheckFactory.setUserDictProvider(n), this.resetSepllCheckProvider_()
            } catch (e) {
                this.loadSpellCheckErr = e.stack || e.message, console.error(e)
            }
            this.spellCheckFactory || i("#footer-spell-check").off("click").on("click", function () {
                e.showLoadModuleError_()
            })
        }, c.prototype.showLoadModuleError_ = function () {
            this.editor.EditHelper.getDialog(i.localize.getString("Failed to load spellcheck module"), this.loadSpellCheckErr.split(/\n/).map(function (e) {
                return e.replace(/\((.+)(TypeMark|app)/, "(")
            }).join("\n"), !1, "error-dialog").modal({backdrop: "static"})
        }, c.prototype.resetSepllCheckProvider_ = function (e) {
            var t = this;
            if (this.langMode_ != l) {
                var n = this.getSpellCheckLang_() || this.envLang_ || "en-US";
                /^(zh|ja)/.exec(n) && (n = "en-US"), reqnode("electron").webFrame.setSpellCheckProvider(n, !1, {
                    spellCheck: function (e) {
                        return t.curSpellchecker ? !t.curSpellchecker.isMisspelled(e) : (t.scheduleAutoUpdateLang(), !0)
                    }
                })
            } else this.curSpellchecker = null
        }, c.prototype.autoDetectLang_ = function () {
            var e = this.editor;
            var t = this.getSpellCheckLang_() || this.envLang_;
            return this.spellCheckFactory ? this.spellCheckFactory.detectLanguageForText(function () {
                for (var t = e.writingArea.querySelectorAll("p, h1, h2, h3, h4, h5, h6"), n = Math.min(t.length, 4), i = "", r = 0; r < n && ((t[r].querySelectorAll("[md-inline='plain']") || []).forEach(function (e) {
                    i += e.textContent
                }), !((i += "\n").length > 100)); r++) ;
                return i
            }(), {httpHint: t}) : Promise.resolve("")
        }, c.prototype.getSpellChecker = function (e) {
            return this.spellCheckFactory.getSpellChecker(/^(zh|ja)/.exec(e || "") ? "en-US" : e)
        }, c.prototype.autoUpdateLang = function (e) {
            if (!0 === e || !this.langAuto_ && this.langMode_ != l) {
                var t = this;
                this.autoDetectLang_().then(function (n, i) {
                    if (i) Reporter.error(i); else if (n && (/^en/.exec(n) ? n = /^en/.exec(t.envLang_) ? t.envLang_ : "en-US" : /^zh/.exec(n) ? n = "zh" : t.labelMap[n] || (n = null)), n) {
                        if (t.langAuto_ = n, t.updatePanel(), "auto" != t.langMode_) return;
                        t.curSpellchecker = t.getSpellChecker(n), t.postSetSpellChecker_(n, !0)
                    } else e && t.langAuto_ && (t.langAuto_ = null, t.updatePanel())
                }), this.detectTimer_ = null
            }
        }, c.prototype.scheduleAutoUpdateLang = function (e) {
            if ("auto" == this.langMode_ || e) {
                this.detectTimer_ && clearTimeout(this.detectTimer_);
                var t = this;
                this.detectTimer_ = setTimeout(function () {
                    t.autoUpdateLang(e)
                }, 2e3)
            }
        }, c.prototype.autoSet_ = function () {
            this.loadSettingForFile_(), this.autoUpdateLang()
        }, c.prototype.clear_ = function () {
            this.langAuto_ = "", this.curSpellchecker = null, this.detectTimer_ && clearTimeout(this.detectTimer_)
        }, c.prototype.reset = function (e) {
            File.isNode && (this.clear_(), this.loadSettingForFile_(), this.setLangMode(this.langMode_), e && this.scheduleAutoUpdateLang(!0))
        }, c.prototype.showDictMissing = function () {
            var e = s.find(function (e) {
                return e.code == ("auto" == this.langMode_ ? this.langAuto_ : this.langMode_)
            }, this);
            if (e) {
                this.missingLocale_ = e;
                var t = document.querySelector("#ty-spell-check-dict-missing-temp").innerText;
                i("#md-notification").html(t.replace("$1", i.localize.getString("Dictionary file is missing to enable spellcheck support for %@.")).replace("%@", e.label).replace("$2", i.localize.getString("Install Language Support")).replace("$3", i.localize.getString("Disable Spell Check")).replace("$4", i.localize.getString("Dismiss"))).show(), this.useHunSpell() ? i("#ty-spell-check-dict-missing-secondary-btn").text(i.localize.getString("Learn More…")) : i("#ty-spell-check-dict-missing-secondary-btn").text(i.localize.getString("Install dictionary file only for Typora"))
            }
        }, n.exports = c
    }), $__System.registerDynamic("3d", ["13", "11", "12", "31", "3e", "25", "e"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i, r = e("13"), o = e("11"), a = e("12"), s = (a.Node, a.TYPE, e("31")), l = e("3e"),
            c = (r = e("13"), e("25").map, e("e")), d = window.reqnode ? reqnode("electron").remote : null,
            u = d ? d.app : window.app, h = !1, f = (d && d.getCurrentWindow(), "_recent"), p = [];
        var m = s.statWrapper;
        s.allowedExtensions;

        function g(e, t) {
            return File.isMac ? new Promise(function (t, n) {
                t(v(e))
            }) : y(e, !1, t)
        }

        function v(e) {
            var t = u.library.listDocsUnder(e.path);
            if (!t) return null;
            var n = JSON.parse(t);
            return e.fetched = !0, e.subdir = n.subdir, e.lastModified = n.lastModified, e.subdir.forEach(function (e) {
                e.fetched = !0
            }), e.content = n.content, e.isDirectory = n.isDirectory, e.isFile = n.isFile, e.name = n.name, e
        }

        function y(e, t, n) {
            var i = reqnode("fs-plus"), r = reqnode("path"), o = File.isWin ? "\\" : "/";
            return new Promise(function (a, l) {
                var c = e.path;
                if (e.name = r.basename(c) || c, e.subdir = [], e.content = [], e.fetched = !t, "." == e.name[0]) return a();
                m(c, function (r) {
                    if (!r || r.shouldIgnore) return a();
                    if (e.isDirectory = r.isDir, e.isFile = r.isFile, e.lastModified = r.mtime, r.isFile) return e.fetched = !0, s.isSupportedFile(e.name) ? a(e) : a();
                    if (r.isDir) {
                        if (l = c, File.filePath && l && 0 == File.filePath.indexOf(l.replace(/[\/\\]$/, "") + o)) e.isOpen = !0; else if (t) return a(e);
                        e.isDirectory && (e.fetched || e.isOpen) && File.isUnixNode && n.addFolderWatchByUnix(e), i.list(c, void 0, function (t, i) {
                            if (t) return a();
                            Promise.all(i.map(function (t) {
                                return y({path: t}, !e.isOpen, n)
                            })).then(function (t) {
                                if (e.subdir.length + e.content.length > 0) return e.fetched = !0, void a(e);
                                t.forEach(function (t) {
                                    t && (t.isDirectory ? e.subdir.push(t) : e.content.push(t))
                                }), e.fetched = !0, a(e)
                            })
                        })
                    }
                    var l
                })
            })
        }

        var b = o.Model.extend({
            initialize: function (e) {
                this.parent = e, this.editor = e.editor, this.$template = c(document.querySelector("#file-library-node-template").textContent), this.root, this.unixWatchers = {}
            }, getRoot: function () {
                return this.parent.root
            }, setRoot: function (e) {
                return this.parent.root = e
            }, renderNode: function (e) {
                if (!e) return c();
                var t = this.$template.clone(), n = this.parent;
                e.subdir && e.subdir.sort(n.compareItem.bind(n)), e.content && e.content.sort(n.compareItem.bind(n)), e == this.getRoot() ? (e.isOpen = !0, t.find(".file-node-open-state").remove()) : e.isDirectory && e.subdir && (e.subdir.length || e.content.length) && t.attr("data-has-sub", "true").addClass(e.isOpen ? "file-node-expanded" : "file-node-collapsed");
                var i = e.name.lastIndexOf(".");
                if ((i < 0 || e.isDirectory) && (i = e.name.length), t.find(".file-node-title-name-part").text(e.name.substr(0, i)), t.find(".file-node-title-ext-part").text(e.name.substr(i)), t.attr("data-path", e.path).attr("data-is-directory", e.isDirectory), t.find(".file-node-icon").addClass(function (e) {
                    return e == this.getRoot() ? e.path == f ? "fa fa-history" : "fa fa-folder" : e.isDirectory ? "fa fa-folder" : "fa fa-file-text-o"
                }.call(this, e)), e.isDirectory || t.addClass("file-library-file-node"), e == this.getRoot() ? t.addClass("file-node-root") : e.isDirectory || e.path != s.getCurrentFilePath() || t.addClass("active"), e.isDirectory && e.subdir) {
                    var r = t.find(".file-node-children");
                    r.html(""), e.isOpen && (e.subdir.forEach(function (e) {
                        r.append(this.renderNode(e))
                    }, this), e.content.forEach(function (e) {
                        r.append(this.renderNode(e))
                    }, this))
                }
                return t
            }, renderIfNeed: function () {
                return !h && (this.render(), File.isWin && this.parent.addFolderWatchByWin(File.getMountFolder()), !0)
            }, render: function (e) {
                h = !0;
                var t = this, n = File.getMountFolder();

                function i() {
                    h = "complete", c("#file-library-tree").html("").append(this.renderNode(this.getRoot())).attr("data-state", ""), this.parent.markCurrentFile()
                }

                this.getRoot() || (this.parent.root = {
                    path: this.parent.calcMountFolder(),
                    isOpen: !0
                }, this.getRoot().path ? g(this.getRoot(), t).then(function (e) {
                    t.parent.root = e, e ? i.call(t) : File.getMountFolder() && t.parent.onLoadFolderFailed(!n), t.parent.slient = !1
                }) : t.parent.onLoadFolderFailed(!0)), this.getRoot() ? e ? i.call(t) : c("#file-library-tree").attr("data-state", "rendering").html("") : c("#file-library-tree").html("")
            }, findElemFromPath: function (e) {
                return c(".file-tree-node[data-path='" + r.escapeSelector(e) + "']")
            }, focusToFile: function (e) {
                if (this.getRoot() && e && !0 !== h) {
                    var t = File.getMountFolder(), n = (File.isWin, window.innerHeight, c(".sidebar-content"));
                    n.scrollTop();
                    e.indexOf(t)
                }
            }, markOpenedFile: function (e) {
                return this.parent.markOpenedFile(e).filter(".file-tree-node")
            }, needRepaint: function () {
                h = !1
            }, addFolderWatchByUnix: function (e) {
                var t = this, n = reqnode("pathwatcher"), r = this.unixWatchers[e.path];
                r && (r.close(), r = null);

                function o() {
                    var e = p.clone();
                    i = null, p = [];
                    var n = [];
                    t.parent.isSuppressOnChange() || e.forEach(function (e) {
                        t.onChangeForLinux(e[0], e[1], n)
                    })
                }

                try {
                    this.unixWatchers[e.path] = n.watch(e.path, function (n) {
                        r = n, a = e, t.parent.isSuppressOnChange() || (i && clearTimeout(i), p.push([r, a]), i = setTimeout(o, 200));
                        var r, a
                    })
                } catch (t) {
                    console.warn("Unable to watch path " + e.path)
                }
            }, findNodeFromPath: function (e, t) {
                if (e && this.getRoot()) {
                    File.isWin;
                    return t = t || [], function e(n, i) {
                        if (n) {
                            if (n.path == i) return n;
                            t.push(n);
                            for (var r = 0; r < n.subdir.length; r++) {
                                var o = n.subdir[r];
                                if (o.path == i) return o;
                                if (0 == i.indexOf(o.path + (File.isWin ? "\\" : "/"))) return e(o, i)
                            }
                            return n.content.find(function (e) {
                                return e.path == i
                            })
                        }
                        return null
                    }(this.getRoot(), e)
                }
            }, expandNode: function (e, t, n) {
                if (!0 !== h) {
                    var i = this.findNodeFromPath(t, []), r = this;
                    i && (i.isOpen = !0, e.children(".file-node-children").children().length ? e.removeClass("file-node-collapsed").addClass("file-node-expanded") : !i.fetched || i.subdir.length > 0 && !i.subdir[0].fetched ? g(i, r).then(function (t) {
                        t && (e.replaceWith(r.renderNode(t)), c(".file-library-node.active").length || r.markOpenedFile(s.getCurrentFilePath()), n && n())
                    }) : e.replaceWith(this.renderNode(i)), c(".file-library-node.active").length || this.markOpenedFile(s.getCurrentFilePath()), n && n())
                }
            }, setSortType: function () {
                "complete" === h && this.getRoot() && this.getRoot().fetched && this.render(!0)
            }, onChangeForMac: function (e) {
                if (h) {
                    var t, n = [], i = new Set, o = new Set, a = this;
                    if (e.forEach(function (e) {
                        if (t = this.findNodeFromPath(e.path, n), this.getRoot()) if ("removed" == e.type) e.path == this.getRoot().path ? this.parent.root = null : t && n.length && d.call(this, t, n.last()); else if ("rename" == e.type) {
                            if (e.oldPath == this.getRoot().path) return void(this.parent.root = null);
                            n = [], t = this.findNodeFromPath(e.oldPath, n), d.call(this, t, n.last()), u(e.newPath, e.isDir)
                        } else "created" != e.type || t || t == this.getRoot() || u(e.path, e.isDir)
                    }, this), this.getRoot()) {
                        o.forEach(function (e) {
                            (e = v(e)) && c.call(this, e)
                        }, this), i.forEach(function (e) {
                            c.call(this, e)
                        }, this);
                        var l = s.getCurrentFilePath();
                        this.parent.markOpenedFile(l), this.focusToFile(l)
                    } else this.parent.onRootChanged()
                }

                function c(e) {
                    var t = a.findElemFromPath(e.path);
                    t.length && t.replaceWith(this.renderNode(e))
                }

                function d(e, t) {
                    e && (e.isDirectory ? t.subdir.remove(e) : t.content.remove(e), t.subdir.length + t.content.length == 0 ? (e.isOpen = !1, c.call(this, t)) : a.findElemFromPath(e.path).remove())
                }

                function u(e, t) {
                    var n = r.pathByDeleteLastComponent(e), s = a.findNodeFromPath(n);
                    s && function (e, t, n) {
                        if (t.fetched && !o.has(t)) {
                            var r;
                            if (t.content.length + t.subdir.length == 0 && o.add(t), n) {
                                if (t.subdir.findIndex(function (t) {
                                    return t.path == e
                                }) > -1) return;
                                (r = v({path: e})) && t.subdir.push(r)
                            } else {
                                if (t.content.findIndex(function (t) {
                                    return t.path == e
                                }) > -1) return;
                                r = {
                                    path: e,
                                    isDirectory: !1,
                                    name: e.split("/").last(),
                                    lastModified: (new Date).getTime() / 1e3
                                }, t.content.push(r)
                            }
                            i.add(t)
                        }
                    }.call(a, e, s, t)
                }
            }, isPathTooDeepToDisplay: function (e, t) {
                if (t = t || [], this.findNodeFromPath(e, t), !t.length) return !0;
                return !!e.substr(t.last().path.length).replace(/^[\\/]+/, "").match(/[\\/]/)
            }, onChangeForWin: function (e, t) {
                if (h && !this.parent.isSuppressOnChange()) {
                    var n = [], i = File.isWin ? "\\" : "/", r = this;
                    this.isPathTooDeepToDisplay(e, n) || function (e, n) {
                        if (n = n || [], !t.find(function (t) {
                            return t == e || 0 == e.indexOf(t + i)
                        })) {
                            t.push(e);
                            var o = reqnode("path").dirname(e), a = r.findNodeFromPath(o);
                            if (a && a.fetched) {
                                var s = !a.isOpen;
                                y({path: e}, s, r).then(function (t) {
                                    t ? function (e, t, n) {
                                        var i = r.findNodeFromPath(e);
                                        if (!i || !i.fetched) {
                                            var o = n.content.length + n.subdir.length == 0,
                                                a = t.isDirectory ? n.subdir : n.content, s = a.findIndex(function (e) {
                                                    return r.parent.compareItem(t, e) > 0
                                                });
                                            if (s < 0 && (s = a.length), a.splice(s, 0, t), t.isDirectory || (s += n.subdir.length), o) r.findElemFromPath(n.path).replaceWith(r.renderNode(n)); else {
                                                var l = r.findElemFromPath(n.path).children(".file-node-children");
                                                (n.isOpen || l.children().length) && l[0].insertChildAtIndex(r.renderNode(t)[0], s)
                                            }
                                        }
                                    }(e, t, a) : function (e, t) {
                                        t = t || [];
                                        var n = r.findNodeFromPath(e, t);
                                        if (n) {
                                            var i = t.last();
                                            i.subdir.remove(n), i.content.remove(n), i.subdir.length + i.content.length == 0 ? r.findElemFromPath(i.path).replaceWith(r.renderNode(i)) : r.findElemFromPath(e).remove()
                                        }
                                    }(e, n)
                                })
                            }
                        }
                    }(e, n)
                }
            }, onChangeForLinux: function (e, t, n) {
                var i = this;
                n.find(function (e) {
                    return e == t.path || 0 == t.path.indexOf(e + "/")
                }) || (n.push(t.path), "change" == e && y(t, !1, this).then(function (e) {
                    if (e) {
                        var t = i.findElemFromPath(e.path);
                        t.length && t.replaceWith(i.renderNode(e)), i.parent.markCurrentFile()
                    }
                }), "rename" == e && t == i.getRoot() && i.parent.onRootChanged(), "delete" == e && t == i.getRoot() && i.parent.onRootChanged())
            }, newFile: function (e) {
                this.newFileCommand(this.findElemFromPath(e), !1)
            }, newFolderCommand: function (e) {
                this.newFileCommand(e, !0)
            }, newFileCommand: function (e, t) {
                var n = this.editor.getJQueryElem(e).closest(".file-library-node"), i = n.attr("data-path"),
                    o = "true" == n.attr("data-is-directory"), a = this;
                if (i) if (o || (i = r.pathByDeleteLastComponent(i)), o) {
                    a = this;
                    this.expandNode(n, i, function () {
                        s.call(a)
                    })
                } else s.call(this);

                function s() {
                    var e = this.findNodeFromPath(i);
                    if (e) {
                        var n = function (e, t) {
                            var n = 0;
                            return t ? (e.subdir.forEach(function (e) {
                                var t = /^untitled folder( (\d+))?$/i.exec(e.name);
                                t && (n = Math.max(n, (t[2] || 0) - 0 + 1))
                            }), "Untitled Folder" + (n ? " " + n : "")) : (e.content.forEach(function (e) {
                                var t = /^untitled( (\d+))?\./i.exec(e.name);
                                t && (n = Math.max(n, (t[2] || 0) - 0 + 1))
                            }), "Untitled" + (n ? " " + n : "") + ".md")
                        }(e, t), r = File.isNode && reqnode("fs");
                        try {
                            var o = this.findElemFromPath(i), s = i + (File.isWin ? "\\" : "/") + n,
                                l = {fetched: !0, subdir: [], content: [], isDirectory: !!t, name: n, path: s};
                            if (t) {
                                if (File.isNode) r.mkdirSync(s); else {
                                    if (!u.library.newFolder(s)) return
                                }
                                a.parent.pauseOnChange(!0), e.subdir.push(l)
                            } else {
                                if (File.isNode) {
                                    var c = r.openSync(s, "wx");
                                    r.close(c)
                                } else {
                                    if (!u.library.newFile(s)) return
                                }
                                if (a.parent.pauseOnChange(!0), e.content.push(l), a.parent.isDiscardableUntitled()) return a.parent.openFile(s), o.replaceWith(this.renderNode(e)), a.focusToFile(l.path), void setTimeout(function () {
                                    a.parent.markCurrentFile(), a.parent.resumeOnChange(), a.renameFileCommand(a.findElemFromPath(l.path)[0])
                                }, 10)
                            }
                            o.replaceWith(this.renderNode(e)), this.focusToFile(l.path), this.renameFileCommand(this.findElemFromPath(l.path)[0])
                        } catch (e) {
                        }
                    }
                }
            }, renameFileCommand: function (e, t) {
                c(".file-node-on-edit").removeClass("file-node-on-edit");
                var n = this.editor.getJQueryElem(e).closest(".file-library-node").addClass("file-node-on-edit"),
                    i = n.attr("data-path"),
                    o = (n.attr("data-is-directory"), n.children(".file-node-content").children(".file-tree-rename-div")),
                    a = o.prev().text().trim(), h = o.children("input").val(a), f = this;
                this.parent.bindRename(h, function (e) {
                    File.isMac ? function (e) {
                        var t = e.val().replace(/[\/\\]/g, ""), o = r.pathByDeleteLastComponent(i) + "/" + t;
                        f.parent.pauseOnChange(!0);
                        var l = i == s.getCurrentFilePath();
                        i != o && u.library.renameFile(i, o) ? (n.children(".file-node-content").children(".file-node-title").text(t), l && setTimeout(function () {
                            f.parent.markOpenedFile(o, !0), f.focusToFile(o, !0)
                        }, 200)) : e.val(a), n.removeClass("file-node-on-edit"), f.editor.restoreLastCursor()
                    }(e) : function (e) {
                        var t = e.val();
                        f.parent.resumeOnChange(), t = File.isWin ? t.replace(/[\\\/:*?"<>\|\000-\031]/g, "").trim() : t.replace(/[\/\\\000-\031]/g, "");
                        var o = r.pathByDeleteLastComponent(i) + (File.isWin ? "\\" : "/") + t;
                        e.closest(".file-node-on-edit").removeClass("file-node-on-edit");
                        var s = File.filePath && (reqnode("fs-plus").isCaseInsensitive ? 0 == File.filePath.toLowerCase().indexOf(i.toLowerCase()) : 0 == File.filePath.indexOf(i)),
                            h = d.getCurrentWindow().id, p = reqnode("fs");
                        File.filePath;

                        function m(e) {
                            d.dialog.showErrorBox(c.localize.getString("Rename Failed"), c.localize.getString('Failed to rename from "{0}" to "{1}"').format(a, t) + "\n" + e), s && l.watchFileChange(File.filePath)
                        }

                        i.toLowerCase() != o.toLowerCase() && p.existsSync(o) ? m(c.localize.getString("File with same name already exists at target path.")) : (u.sendEvent("willRename", {
                            oldPath: i,
                            fromWin: h
                        }), p.rename(i, o, function (e) {
                            if (n.removeClass("file-node-on-edit"), f.editor.restoreLastCursor(), e && (o = i), u.sendEvent("didRename", {
                                oldPath: i,
                                newPath: o,
                                fromWin: h
                            }), File.isWin && !f.parent.folderWatchedOnWin) {
                                n.attr("data-path", o);
                                var t = reqnode("path").basename(o), r = t.lastIndexOf(".");
                                r < 0 && (r = t.length), n.find(".file-node-title-name-part").text(t.substr(0, r)), n.find(".file-node-title-ext-part").text(t.substr(r))
                            }
                            if (e) m(e); else if (!File.filePath){

                            }
                        }))
                    }(e)
                }, function () {
                    h.closest(".file-node-on-edit").removeClass("file-node-on-edit")
                }), h.focus()
            }, bindEvents: function () {
                var e = this;
                c("#file-library-tree").on("click", ".file-node-content", function (t) {
                    if (1 === t.which) {
                        t.preventDefault(), t.stopPropagation(), document.activeElement.blur();
                        var n = c(this).parent(), i = n.attr("data-path"), r = n.attr("data-is-directory");
                        if (n.hasClass("file-node-on-edit")) return !1;
                        if ("false" == r) (File.isMacOrMacNode ? t.metaKey : t.ctrlKey) ? e.parent.openFileInNewWindow(i) : e.parent.openFile(i); else if ("true" == n.attr("data-has-sub")) {
                            n.hasClass("file-node-expanded") ? (o = n, a = i, e.findNodeFromPath(a).isOpen = !1, o.addClass("file-node-collapsed").removeClass("file-node-expanded")) : e.expandNode(n, i)
                        }
                        var o, a
                    }
                }).on("dragstart", ".file-tree-node", function (e) {
                })
            }
        });
        n.exports = b
    }), $__System.registerDynamic("3f", ["13", "11", "12", "31", "3e", "25", "28", "e"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i, r, o, a, s, l = e("13"), c = e("11"), d = e("12"), u = d.Node, h = (d.TYPE, e("31")),
            f = (e("3e"), l = e("13"), e("25").map, e("28")), p = e("e"),
            m = window.reqnode ? reqnode("electron").remote : null, g = m ? m.app : window.app,
            v = p("#file-library-list-children"), y = p("#file-library-list"), b = [], w = function (e) {
                return e.replace(/^\s*(([\n#>]+)|([-=*`\s]{3,}))/gm, "").replace(/\s*[*_`$=]+\s*/gm, " ").replace(/\[([^\]]+)\]\([^)]*\)/gm, "$1")
            }, C = function (e, t, n, i) {
                for (var r = t + 1; r < i; r++) {
                    if (e[r].indexOf(":") >= 0) return n;
                    n += "\n" + e[r]
                }
                return n
            }, x = function (e, t) {
                var n = t.lastIndexOf(".");
                n < 0 && (n = t.length), e.find(".file-list-item-file-name-part").text(t.substr(0, n)), e.find(".file-list-item-file-ext-part").text(t.substr(n))
            }, k = function (e, t) {
                var n, i = e.split(/\r*\n+/), r = i.length;
                if ("---" == i[0]) {
                    for (var o, a = [], s = 1; s < r; s++) {
                        if ("---" == i[s]) return a.length < 3 && a.push(w(i.slice(s + 1).join("\n") || e)), a.join("\n");
                        (n = /^\s*(title)\s*:(.+)$/.exec(i[s])) ? (o = C(i, s, n[2], r)) && a.push(o.trim()) : (n = /^\s*(subtitle)\s*:(.+)$/.exec(i[s])) ? (o = C(i, s, n[2], r)) && a.push(o.trim()) : (n = /^\s*(overview|summary|description|excerpt)\s*:(.+)$/.exec(i[s])) && (o = C(i, s, n[2], r)) && a.push(o.trim())
                    }
                    return w(e)
                }
                return w(e)
            }, S = h.statWrapper;

        function E(e, t, n) {
            var i = File.isWin ? "\\" : "/";
            if (t.find(function (t) {
                return t == e || 0 == e.indexOf(t + i)
            })) return !0;
            !n && t.push(e)
        }

        var F = 400, _ = c.Model.extend({
            initialize: function (e) {
                this.parent = e, this.editor = e.editor, this.$template = p(document.querySelector("#file-list-item-template").textContent), this.expandFolders = (t = "not_group_by_folders", File.isMac ? g.setting.getBool(t) || !1 : !!File.isNode && (g.setting.get(t) || !1));
                var t;
                this.setGroupByFolder(this.expandFolders), this.unixWatchers = {}, this.needRepaint(), File.isNode && (F = Number.parseInt(g.setting.config.maxFetchCountOnFileList) || 200, Number.isNaN(F) && (F = 200))
            }, isShown: function () {
                return this.parent.isFileTabShown() && !this.parent.useTreeStyle
            }, isRendering: function () {
                return i
            }, renderIfNeed: function () {
                return !i && (this.render(), File.isWin && this.parent.addFolderWatchByWin(File.getMountFolder()), !0)
            }, appendTreeByNode: function (e, t, n, r) {
                var o = reqnode("fs-plus"), a = reqnode("path"), s = (reqnode("util"), this),
                    l = File.option.useFsQueue;
                n = n || 0, t = t || function () {
                };
                var c = !!r;
                r = r || y;
                var d = [], u = 0, f = function () {
                    d = []
                }, p = function () {
                    if ("oversize" != i) for (var e = 0; e < 20 && d.length;) {
                        e++;
                        var t = d.shift();
                        t[1] ? m(t[0], t[2]) : g(t[0], t[2])
                    } else f()
                }, m = function (e, t) {
                    u++, o.readdir(e, function (e, n) {
                        u--, l && u < 50 && p(), t(e, n)
                    })
                }, g = function (e, t) {
                    u++, S(e, function (e) {
                        u--, l && u < 50 && p(), t(e)
                    })
                }, v = function (e, t, o, c) {
                    if (!e) return c();
                    h = e, p = function (h, p) {
                        if (h) return c(void 0, h);
                        !File.isWin && s.addFileWatchByUnix(e, !0);
                        var m = p.length;
                        m || c();
                        var y = function () {
                            --m <= 0 && c()
                        };
                        p.forEach(function (c) {
                            var h = a.join(e, c);
                            p = h, m = function (a) {
                                if (i) {
                                    if (!a || a.shouldIgnore) return y();
                                    if (50 == n && !0 === i && "rendering" != r.attr("data-state") && r.attr("data-state", "rendering"), n > F) return f(), void s.endRender(!0);
                                    a.isFile ? t(a, c, e, h, y) && n++ : a.isDir && o(a, c, e, h) ? v(h, t, o, y) : y()
                                }
                            }, l && u >= 50 ? d.push([p, !1, m]) : g(p, m);
                            var p, m
                        })
                    }, l && u >= 50 ? d.push([h, !0, p]) : m(h, p);
                    var h, p
                };
                v(e, function (e, t, n, i, o) {
                    if (!e.shouldIgnore) {
                        var a = {
                            folderPath: n,
                            folderName: h.getFileNameFromPath(n),
                            name: t,
                            path: i,
                            lastModified: e.mtime
                        };
                        return s.fetchSummaryByNode(i, function (e) {
                            a.summary = e, s.appendItemToView(a, !1, c ? r[0] : void 0), !File.isWin && s.addFileWatchByUnix(a.path, !1, a), o()
                        }), !0
                    }
                    o()
                }, function (e, t, n, i) {
                    return !e.shouldIgnore
                }, t)
            }, fecthAllDocsByNode: function () {
                this.appendTreeByNode(this.parent.calcMountFolder(!0), this.endRender.bind(this))
            }, fetchSummaryByNode: function (e, t) {
                var n;
                reqnode("fs-plus").createReadStream(e, {start: 0, end: 600}).on("data", function (e) {
                    if ("string" == typeof e) n = e; else {
                        var t = h.detectEncodeByNode(e), i = h.getContentFromBuffer(e, t);
                        n = i
                    }
                }).on("end", function () {
                    void 0 === n && (n = ""), t(n)
                })
            }, render: function (e) {
                if (e && this.needRepaint(), !i) {
                    i = !0, r = new Date, o = !1;
                    var t = this;
                    setTimeout(function () {
                        !0 === i && "rendering" != y.attr("data-state") && y.attr("data-state", "rendering")
                    }, 500), v.html("").removeClass("show-folder-name"), File.isMac ? g.library.fetchAllDocs(this.parent.calcMountFolder(!0) || "") : File.isNode && this.fecthAllDocsByNode(), setTimeout(function () {
                        !0 === i && new Date - r > 8e3 && (console.warn("render file list timeout"), t.endRender(!0))
                    }, 1e4)
                }
            }, endRender: function (e, t, n) {
                if ("oversize" != i || !e) {
                    if (i = e ? "oversize" : "complete", p("#file-library-list").attr("data-state", i), a && clearTimeout(a), a = setTimeout(function () {
                        "oversize" == i && p("#file-library-list").attr("data-state", "oversize-end")
                    }, 2e3), e) (File.isLinux || File.isMacNode) && Object.values(this.unixWatchers || {}).map(function (e) {
                        try {
                            e && e.close()
                        } catch (e) {
                        }
                    }); else {
                        if (t && File.getMountFolder()) return void this.parent.onLoadFolderFailed();
                        this.parent.markCurrentFile(!1, !0)
                    }
                    this.parent.slient = !1
                }
            }, setSortType: function () {
                if ("complete" === i) {
                    v.html("");
                    var e = document.createDocumentFragment();
                    this.expandFolders ? (this.files.sort(this.parent.compareItem.bind(this)), this.files.forEach(function (t) {
                        this.appendItemToView(t, !1, e)
                    }, this)) : this.dirArr.forEach(function (t) {
                        var n = t.content;
                        t.content = [], n.forEach(function (t) {
                            this.appendItemToView(t, !1, e)
                        }, this)
                    }, this), v.append(e)
                }
            }, setGroupByFolder: function (e) {
                if (e ? p("#ty-group-by-folder-btn").removeClass("active") : p("#ty-group-by-folder-btn").addClass("active"), this.expandFolders != e) {
                    this.expandFolders = e, g && g.setting.put("not_group_by_folders", e), v.html("");
                    var t = document.createDocumentFragment();
                    e ? (this.files = [], this.dirArr.forEach(function (e) {
                        this.files = this.files.concat(e.content)
                    }, this), this.dirArr = [], this.dirMap = {}, this.files.sort(this.parent.compareItem.bind(this)), this.files.forEach(function (e) {
                        this.appendItemToView(e, !1, t)
                    }, this)) : (this.dirArr = [], this.dirMap = {}, this.files.forEach(function (e) {
                        this.appendItemToView(e, !1, t)
                    }, this), this.files = []), v.append(t), "oversize" == i ? this.endRender(!0) : "complete" == i && this.endRender(!1)
                }
            }, getItem: function (e) {
                if (this.expandFolders) for (var t = this.files.length, n = 0; n < t; n++) {
                    if (this.files[n].path == e) return this.files[n];
                    if (this.files[n].folderPath == e) return {path: e, isDir: !0}
                } else {
                    if (this.dirMap[e]) return {path: e, isDir: !0};
                    var i = l.pathByDeleteLastComponent(e);
                    if (this.dirMap[i]) return this.dirMap[i].content.find(function (t) {
                        return t.path == e
                    })
                }
            }, computeIndex: function (e) {
                return (this.expandFolders ? function (e) {
                    for (var t = 0, n = 0; n < this.files.length && !(this.parent.compareItem(this.files[n], e) > 0); n++) t++;
                    return this.files.splice(t, 0, e), t
                } : function (e) {
                    var t = e.folderPath, n = this.dirMap[t], i = 0, r = 0;
                    n || (n = {path: t, content: []}, this.dirArr.push(n), this.dirMap[t] = n);
                    for (var o = 0; o < this.dirArr.length - 1; o++) {
                        var a = this.dirArr[o];
                        if (a.path == t) break;
                        i += a.content.length
                    }
                    for (o = 0; o < n.content.length && !(this.parent.compareItem(n.content[o], e) > 0); o++) r++;
                    return n.content.splice(r, 0, e), r + i
                }).call(this, e)
            }, appendItemToView: function (e, t, n, r) {
                if ("oversize" != i && i) {
                    var a = r || {}, s = a.forceMark, c = a.skipAnim, d = this.$template.clone();
                    this.parent.calcMountFolder(!0);
                    if (e && e.path) {
                        o || File.getMountFolder() != e.folderPath && (o = !0, v.addClass("show-folder-name")), d.attr("data-path", e.path), d.attr("data-parent-path", e.folderPath), d.children(".file-list-item-parent-loc").text(e.folderName), d.children(".file-list-item-time").text(l.date2NatrualLang(new Date(e.lastModified), !0)), x(d, e.name);
                        var u = d.children(".file-list-item-summary");
                        u.text(k(e.summary, e.name)), u.html(u.html().replace(/([^\s]+)\s*\n+/g, "$1<br/>")), e.path == h.getCurrentFilePath() && d.addClass("active");
                        var f;
                        if (n) this.expandFolders ? n.appendChild(d[0]) : (f = this.computeIndex(e), n.insertChildAtIndex(d[0], f)); else {
                            if (t) {
                                var p, m, g = this.removeItemFromView(e, !0), y = g.hasClass("active");
                                if (g && g.length) return m = g.prevAll().length, f = this.computeIndex(e), m != f || e.oldPath ? (e.oldPath = void 0, p = g[0].clientHeight, g.remove(), v[0].insertChildAtIndex(d[0], f), (y || s) && d.addClass("active"), c || v.children().each(function (e) {
                                    var t = this;
                                    if (t == d[0]) t.style.transition = "transform 0s", t.style.transform = "translate(0px, " + p * (m - e) + "px)"; else if (e >= f && e < m) t.style.transition = "transform 0s", t.style.transform = "translate(0px, -" + p + "px)"; else {
                                        if (!(e >= m && e < f)) return;
                                        t.style.transform = "translate(0px, " + p + "px)"
                                    }
                                    requestAnimationFrame(function () {
                                        t.style.transform = "", t.style.transition = "transform 400ms"
                                    })
                                }), h.getCurrentFilePath() == e.path && this.parent.markCurrentFile(), d[0]) : g.find("input").length ? g[0] : (g.replaceWith(d), d[0])
                            }
                            f = this.computeIndex(e), v[0].insertChildAtIndex(d[0], f)
                        }
                        return d[0]
                    }
                }
            }, removeFileOrFolder: function (e, t) {
                var n = this, i = File.isWin ? "\\" : "/";

                function r(e) {
                    var i = n.findElemFromPath(e);
                    i.length && (t ? i.remove() : i.hide("slow", function () {
                        i.remove()
                    }))
                }

                if (n.expandFolders) return o = e, void n.files.removeIf(function (e) {
                    if (e.path == o || 0 == e.path.indexOf(o + i)) return r(e.path), !0
                });
                var o;
                n.findElemFromPath(e).length ? n.removeItemFromView({path: e}, !1, t) : function (e) {
                    var t = 0;
                    n.dirArr.removeIf(function (n) {
                        return t++, n.path == e || 0 == n.path.indexOf(e + i)
                    }), 0 != t && Object.keys(n.dirMap).clone().forEach(function (t) {
                        t != e && 0 != t.indexOf(e + i) || (n.dirMap[t].content.forEach(function (e) {
                            r(e.path)
                        }), delete n.dirMap[t])
                    })
                }(e)
            }, removeItemFromView: function (e, t, n) {
                function i(e, t) {
                    ~e.indexOf(t) ? e.remove(t) : e.removeIf(function (e) {
                        return e.path.toLowerCase() == (t.oldPath || t.path).toLowerCase()
                    }, !0)
                }

                var r = this.findElemFromPath(e.oldPath || e.path);
                if (e.folderPath || (e.folderPath = r.attr("data-parent-path")), !r.length) return p();
                if (this.expandFolders) i(this.files, e); else {
                    var o = this.dirMap[e.folderPath];
                    o && i(o.content, e)
                }
                if (!t) {
                    r.nextAll(), r[0].offsetHeight;
                    n ? r.remove() : r.hide("slow", function () {
                        r.remove()
                    })
                }
                return r
            }, appendItemToViewByMac: function (e, t, n) {
                this.appendItemToView(JSON.parse(e), t, void 0, {forceMark: n})
            }, bindEvents: function () {
                var e = this;
                v.on("mousedown", ".file-list-item", function (t) {
                    if ("INPUT" == document.activeElement.tagName && p(document.activeElement).trigger("blur"), 1 == event.which) return event.ctrlKey || event.metaKey ? e.parent.openFileInNewWindowCommand(this) : (p(".file-list-item:focus").blur(), e.parent.openFile(this.getAttribute("data-path"))), !1
                }), p("#switch-to-tree-on-oversize").on("click", function (t) {
                    e.parent.switch("file-tree")
                });
                var t = !1;

                function n() {
                    e.editor.dropTargetDom = null, document.querySelector("#sidebar-content").classList.remove("on-drop")
                }

                p("#file-library").on("dragenter", function (n) {
                    if (!e.parent.useTreeStyle) {
                        var i = n.originalEvent.dataTransfer.files[0];
                        t = !1, File.isMac ? (window.focus(), t = (n.originalEvent.dataTransfer.types || []).indexOf("Files") > -1) : i && File.getMountFolder() && (t = h.isSupportedFile(i.path)), t && (e.editor.dropTargetDom = this, document.querySelector("#sidebar-content").classList.add("on-drop"))
                    }
                }).on("dragend mouseleave dragfileLeave", function (e) {
                    n()
                }).on("dragfile", function (e) {
                    e.stopPropagation(), n();
                    var t = e.originalEvent.data.folders, i = e.originalEvent.data.urls;
                    if (!File.getMountFolder() || 1 == t.length && 0 == i.length) t[0] && g.controller.switchFolder(t[0]); else {
                        g.controller.moveFilesToLibrary(i) ? e.stopPropagation() : e.originalEvent.data.resultFromFront = "cancel"
                    }
                }).on("dragover", function (e) {
                    e.preventDefault(), e.stopPropagation()
                }).on("drop", function (i) {
                    if (!File.isNode || !t || !File.getMountFolder()) return n();
                    i.stopPropagation(), i.preventDefault();
                    var r, o, a = i.originalEvent.dataTransfer.files, s = i.originalEvent.dataTransfer.items,
                        l = reqnode("fs-extra"), c = reqnode("path"),
                        d = File.fileHasModified && File.changeCounter.isDocumentEdited();

                    function u(e) {
                        return c.join(File.getMountFolder(), c.basename(e))
                    }

                    function m(t) {
                        var n = u(t);
                        l.move(t, n, function (t) {
                            t || d || (d = !0, e.parent.openFile(n))
                        })
                    }

                    if (0 == a.length) return n();
                    if (0 != a[0].path.toLowerCase().indexOf(File.getMountFolder())) {
                        for (var g = 0; g < a.length; g++) {
                            var v = a[g], y = s[g];
                            if (v.path, y.webkitGetAsEntry().isFile) if (!r && l.existsSync(u(v.path))) {
                                if (o) continue;
                                var b = f.getDialog(p.localize.getString("Save"), p.localize.getString("Should continue moving and overwrite exisiting file(s) ?"), !0, "two-way-dialog", "Continue & Overwrite");
                                b.modal({backdrop: !1, keyboard: !0}), b.find(".btn-primary").one("click", function () {
                                    r = !0, m(v.path), b.modal("hide")
                                }), b.one("hidden.bs.modal", function () {
                                    o = !0
                                })
                            } else m(v.path)
                        }
                        n()
                    } else s[0].webkitGetAsEntry().isDirectory || h.isSupportedFile(a[0].path) && e.parent.openFile(a[0].path)
                })
            }, needRepaint: function (e) {
                (e || !0 !== i) && (i = !1, this.dirArr = [], this.dirMap = {}, this.files = [])
            }, findElemFromPath: function (e) {
                return p(".file-list-item[data-path='" + l.escapeSelector(e) + "']")
            }, onChangeForMac: function (e) {
                if ("complete" == i && !this.parent.isSuppressOnChange()) {
                    for (var t = [], n = 0; n < e.length; n++) {
                        var r = e[n];
                        if (u.isType(r.type, "created", "modified") && E(r.path, t)) return;
                        if ("rename" == r.type) {
                            if (r.isDir) {
                                this.needRepaint();
                                break
                            }
                            var o = h.getCurrentFilePath() == r.oldPath;
                            this.removeFileOrFolder(r.oldPath), g.library.updateListItem(r.newPath, o)
                        } else "removed" == r.type && this.removeFileOrFolder(r.path);
                        if (r.isDir && "modified" != r.type) {
                            this.needRepaint();
                            break
                        }
                        "created" == r.type ? g.library.updateListItem(r.path) : "modified" != r.type || r.isDir || ("oversize" != i || g.library.isOpened(r.path)) && g.library.updateListItem(r.path)
                    }
                    !i && this.isShown() && this.render()
                }
            }, onChangeForWin: function (e, t, n) {
                if ("complete" == i && !this.parent.isSuppressOnChange()) {
                    var r = this;
                    t ? E(a = e, n, !0) || 0 != r.findElemFromPath(a).length && S(a, function (e) {
                        if (e && !e.shouldIgnore && e.isFile) {
                            var t = r.getItem(a);
                            if (!t) return;
                            r.fetchSummaryByNode(a, function (n) {
                                t.summary = n, t.lastModified = e.mtime, r.appendItemToView(t, !0)
                            }), n.push(a)
                        }
                    }) : (o = e, File.getMountFolder() && 0 == o.indexOf(File.getMountFolder()) && S(o, function (e) {
                        e && !e.shouldIgnore ? E(o, n) || function (e, t) {
                            if (t.isFile) {
                                var n = l.pathByDeleteLastComponent(e), i = {
                                    folderPath: n,
                                    folderName: h.getFileNameFromPath(n),
                                    name: h.getFileNameFromPath(e),
                                    path: e
                                };
                                r.fetchSummaryByNode(e, function (e) {
                                    i.summary = e, i.lastModified = t.mtime, r.appendItemToView(i, !0)
                                })
                            } else t.isDir && r.appendTreeByNode(e)
                        }(o, e) : r.removeFileOrFolder(o)
                    }));
                    var o, a
                }
            }, addFileWatchByUnix: function (e, t) {
                if (!File.isMac && !File.isWin && "oversize" != i) {
                    var n = this, r = reqnode("pathwatcher"), o = (reqnode("fs-plus"), reqnode("util"), "/"),
                        a = this.unixWatchers[e];
                    try {
                        a && (a.close(), a = null), this.unixWatchers[e] = r.watch(e, function (i) {
                            r = i, o = e, a = t, n.parent.isSuppressOnChange() || (s && clearTimeout(s), b.push([r, o, a]), s = setTimeout(l, 200));
                            var r, o, a
                        })
                    } catch (e) {
                        console.warn(e)
                    }
                }

                function l() {
                    var e = b.clone();
                    s = null, b = [];
                    var t = [];
                    if (!n.parent.isSuppressOnChange()) {
                        for (var i = [], r = [], a = !1, l = 0; l < e.length; l++) {
                            var c = e[l], d = c[1];
                            if (c[2]) {
                                if ("change" != c[0]) {
                                    a = !1;
                                    break
                                }
                                -1 == r.indexOf(d) && r.push(d)
                            } else if (-1 == i.indexOf(d)) a = c[0], i.push(d); else if (a != c[0]) {
                                a = !1;
                                break
                            }
                        }
                        a && 1 == i.length && 1 == r.length && 0 == i[0].indexOf(r[0]) && ("delete" == a ? e.length <= 2 && (e = [[a, i[0], !1]]) : "change" == a && (e = [[a, i[0], !1]])), e.forEach(function (e) {
                            !function (e, t, i, r) {
                                if (!r.find(function (e) {
                                    return e == t || 0 == t.indexOf(e + o)
                                })) if (r.push(t), "rename" != e && "delete" != e || t != File.getMountFolder()) {
                                    if ("change" == e) if (i) {
                                        var a = File.getMountFolder() == t, s = p("#file-library").scrollTop();
                                        y.clone(), n.removeFileOrFolder(t, a), n.appendTreeByNode(t, function () {
                                            a && p("#file-library").scrollTop(s)
                                        })
                                    } else {
                                        var l = n.getItem(t);
                                        if (!l) return;
                                        h.statWrapper(t, function (e) {
                                            e && !e.shouldIgnore && n.fetchSummaryByNode(t, function (t) {
                                                l.summary = t, l.lastModified = e.mtime, n.appendItemToView(l, !0)
                                            })
                                        })
                                    } else if ("delete" == e) n.removeFileOrFolder(t); else if ("rename" == e) ;
                                } else n.parent.onRootChanged()
                            }(e[0], e[1], e[2], t)
                        })
                    }
                }
            }, update: function (e, t) {
                if (void 0 !== t) {
                    var n = this.parent.findElemFromPath(e).children(".file-list-item-summary");
                    n.text(k(t.substr(0, 500))), n.html(n.html().replace(/([^\s]+)\s*\n+/g, "$1<br/>"))
                }
            }, focusToFile: function (e, t) {
                var n = this.findElemFromPath(e)[0];
                if (n) {
                    var i = n ? n.offsetTop : 0, r = n.clientHeight, o = n ? {scrollTop: Math.max(0, i - r)} : null,
                        a = p(File.isMac ? ".sidebar-content" : "#file-library"), s = a.parent().height();
                    !o || a.scrollTop() < i + 40 && s + a.scrollTop() > i + 40 || (t ? a.scrollTop(o.scrollTop) : a.animate(o, 500))
                }
            }, newFile: function () {
                var e = this;

                function t(t, n) {
                    var i = this.appendItemToView({
                        folderPath: File.getMountFolder(),
                        folderName: h.getFileNameFromPath(File.getMountFolder()),
                        name: n,
                        path: t,
                        lastModified: new Date,
                        summary: ""
                    }, !0);
                    if (e.parent.isDiscardableUntitled()) return e.parent.openFile(t), void setTimeout(function () {
                        e.renameFileCommand(i, !0)
                    }, 100);
                    e.renameFileCommand(i, !0)
                }

                if (File.getMountFolder()) if (o) File.isMac ? g.library.newFileUnder(File.getMountFolder()) : m.dialog.showSaveDialog(File.isLinux ? null : m.getCurrentWindow(), {
                    title: "New",
                    defaultPath: File.getMountFolder() + "/Untitled.md",
                    buttonLabel: "Create",
                    filters: [{name: "Markdown", extensions: ["md", "markdown", "mmd", "mdown", "txt", "text"]}]
                }, function (t) {
                    t && reqnode("fs").writeFile(t, "", function () {
                        e.parent.openFile(t)
                    })
                }); else {
                    var n = function (e) {
                        var t = 0;
                        return p(".file-list-item[data-parent-path='" + JSON.stringify(e).replace(/(^")|("$)/g, "") + "']").each(function () {
                            var e = /^untitled( (\d+))?\./i.exec(this.querySelector(".file-list-item-file-name").textContent.trim());
                            e && (t = Math.max(t, (e[2] || 0) - 0 + 1))
                        }), "Untitled" + (t ? " " + t : "") + ".md"
                    }(File.getMountFolder()), i = File.getMountFolder() + (File.isWin ? "\\" : "/") + n;
                    if (this.parent.pauseOnChange(!0), File.isMac) this.parent.pauseOnChange(!0), g.library.newFile(i) ? t.call(this, i, n) : (this.parent.resumeOnChange(), g.library.newFileUnder(File.getMountFolder())); else {
                        var r = reqnode("fs");
                        i = reqnode("path").resolve(i);
                        var a = r.openSync(i, "wx");
                        r.close(a), this.parent.pauseOnChange(!0), t.call(this, i, n)
                    }
                }
            }, newFileCommand: function (e) {
                this.newFile()
            }, renameFileCommand: function (e, t) {
                e = p(e).closest(".file-library-node")[0], File.isMac && g.window.focus();
                var n = this, i = p("<input class='file-list-item-file-name' />"),
                    r = p(e).find(".file-list-item-file-name"), o = r.clone(), a = e.getAttribute("data-path"),
                    s = r.children().text();
                r.replaceWith(i), i.val(s);

                function c(t, r) {
                    if (x(o, t), i.replaceWith(o), a != r) {
                        var s = p(e);
                        n.appendItemToView({
                            path: r,
                            folderPath: e.getAttribute("data-parent-path"),
                            folderName: p(e).children(".file-list-item-parent-loc").text(),
                            lastModified: new Date,
                            name: t,
                            summary: (l = s.children(".file-list-item-summary"), l.length ? l[0].textContent || l[0].innerText : ""),
                            oldPath: a
                        }, !0)
                    }
                    var l;
                    n.editor.restoreLastCursor()
                }

                this.parent.bindRename(i, function (e) {
                    return File.isMac ? function (e) {
                        var t = e.val().replace(/[\/\\]/g, ""), i = l.pathByDeleteLastComponent(a) + "/" + t;
                        n.parent.pauseOnChange(!0), a != i && g.library.renameFile(a, i) ? (c(t, i), a == h.getCurrentFilePath() && setTimeout(function () {
                            n.parent.markOpenedFile(i, !0), n.focusToFile(i, !0)
                        }, 200)) : c(s, a)
                    }(e) : function (e) {
                        var t = e.val();
                        t = File.isWin ? t.replace(/[\\\/:*?"<>\|\000-\031]/g, "").trim() : t.replace(/[\/\\\000-\031]/g, "");
                        var i = reqnode("path").resolve(l.pathByDeleteLastComponent(a) + (File.isWin ? "\\" : "/") + t),
                            r = m.getCurrentWindow().id, o = reqnode("fs");
                        a != i ? a.toLowerCase() != i.toLowerCase() && o.existsSync(i) ? d(p.localize.getString("File with same name already exists at target path.")) : (n.parent.pauseOnChange(!0), g.sendEvent("willRename", {
                            oldPath: a,
                            fromWin: r
                        }), o.rename(a, i, function (e) {
                            g.sendEvent("didRename", {oldPath: a, newPath: e ? a : i, fromWin: r}), e ? d(e) : c(t, i)
                        })) : c(s, a);

                        function d(e) {
                            c(s, a), m.dialog.showErrorBox(p.localize.getString("Rename Failed"), p.localize.getString('Failed to rename from "{0}" to "{1}"').format(s, t) + "\n" + e)
                        }
                    }(e)
                }, function () {
                    c(s, a)
                }, t), i.focus()
            }
        });
        n.exports = _
    }), $__System.registerDynamic("40", ["13", "11", "12", "31", "3e", "25", "3d", "3f", "41", "e"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i, r, o = e("13"), a = e("11"), s = e("12"), l = (s.Node, s.TYPE, e("31")), c = e("3e"), d = e("25").map,
            u = e("3d"), h = e("3f"), f = (e("41"), e("e")), p = window.reqnode ? reqnode("electron").remote : null,
            m = p ? p.app : window.app, g = p ? p.getCurrentWindow() : null;
        window.onWindowFocus = function (e) {
            try {
                if (File.isNode && (File.getCurrentDocByNode().setActiveWindow(g), e = e || m.getCurrentFocusWindowId() == p.getCurrentWindow().id), File.isMac ? m.document.isLocked() || (File.freshMenu(!0), File.unlock()) : e || File.freshMenu(!0), !File.editor) return;
                if (File.editor.imgEdit.refreshLocalImg(), File.isNode) {
                    if (!r && File.filePath && !reqnode("fs-plus").isFileSync(File.filePath)) return void c.onPresentationMoved();
                    File.getMountFolder() && (reqnode("fs-plus").isDirectorySync(File.getMountFolder()) || File.editor.library.onRootChanged())
                }
                if (!e && File.editor.selection) {
                    var t = File.editor.selection.buildUndo();
                    File.restoreEditStateFromData(File.getDocumentSnap(), !0) ? Reporter.record({
                        message: "Restore state from other window",
                        category: "window.focus"
                    }) : (File.editor.lastCursor = t, File.editor.restoreLastCursor())
                }
                File.isMac && File.editor.library.markOpenedFile(l.getCurrentFilePath())
            } catch (e) {
                console.sendError(e), Reporter.error(e, {level: "warning"})
            } finally {
                return "DONE"
            }
        }, window.onWindowBlur = function () {
            try {
                if (!window.File || !File.editor || !File.editor.sourceView) return;
                !!File.editor.sourceView.inSourceMode || (File.editor.selection.buildUndo() || !0), File.isMac && (window.File.isLocked = !0), File.backupDocumentSnap()
            } catch (e) {
                console.sendError(e)
            } finally {
                return "DONE"
            }
        };
        f(".sidebar-content"), f(".sidebar-mac-tab");
        var v, y = function (e) {
            File.isBroken || (e = e || "").toLowerCase() != (File.filePath || "").toLowerCase() && l.tryLeaveDocument(function (t) {
                if (!t) {
                    var n = p.getCurrentWindow(), i = m.getDocumentController();
                    File.contentSnapRestoredTime = -1, File.buildDocumentSnap();
                    var r = i.switchDocument(n.id, e).getSnap();
                    r ? (c.setFileTitle(e, r.fileEncode), File.onSwitchDocumentTarget(r)) : (File.fileName = void 0, File.onSwitchDocumentTarget(null, e))
                }
            }, !0)
        }, b = [], w = {Natural: 0, Alphabet: 1, Date: 2}, C = a.Model.extend({
            initialize: function (e) {
                this.editor = e, this.root, this.items, this.fsWatcher, this.fileTree = new u(this), this.fileList = new h(this), this.useTreeStyle = File.option.useTreeStyle, this.supportResize_, this.onInit_ = !0, this.sortType = File.option.sortType, this.SortType = w, this.bindLiveResize(), this.defaultTab = File.option.sidebarTab || (File.isMac ? "file-list" : "outline"), "outline" == this.defaultTab ? document.querySelector("#typora-sidebar").classList.add("active-tab-outline") : document.querySelector("#typora-sidebar").classList.add("active-tab-files"), File.isNode && f("#reveal-folder-from-sidebar-menu").text(f.localize.getString("Reveal in File Explorer")), File.option.pinFolder && (this.setMountFolder(File.option.pinFolder, !0, "pinFolder"), File.option.pinFolder = void 0), this.setSortType(this.sortType)
            }, supportResize: function () {
                return void 0 === this.supportResize_ ? (this.supportResize_ = !(!window.CSS || !window.CSS.supports || !window.CSS.supports("--sidebar-width", 0) && !window.CSS.supports("(--foo: red)")), this.supportResize_) : this.supportResize_
            }, bindLiveResize: function () {
                var e = f("#typora-sidebar-resizer"), t = this, n = File.option.sidebarWidth;
                if (n && this.setSidebarWidth(n - 0, !1), this.supportResize()) {
                    var i, r, o = !1;
                    e.on("mousedown", function (e) {
                        1 === e.which && (i = !0)
                    }).on("mousemove", function (t) {
                        if (1 === t.which && i) {
                            o || (o = !0, e.addClass("dragging"), r = window.innerWidth - 220);
                            var n = Math.min(Math.max(160, t.pageX), r);
                            e.children().css("left", n)
                        }
                    }).on("mouseup", function (n) {
                        if (o) {
                            i = !1, o = !1, e.removeClass("dragging"), e.children().css("left", "");
                            var a = Math.min(Math.max(160, n.pageX), r);
                            t.setSidebarWidth(a, !0)
                        }
                    })
                } else e.remove()
            }, setSidebarWidth: function (e, t) {
                var n = e ? e + "px" : "";
                if (document.documentElement.style.setProperty("--sidebar-width", n), File.isMac) {
                    "true" != (window.getComputedStyle(document.body).getPropertyValue("--typora-center-window-title") || "").trim() && document.body.classList.contains("pin-outline") ? m.window.setTitlebarTextMarginLeft(e) : m.window.setTitlebarTextMarginLeft(void 0)
                }
                t && setTimeout(function () {
                    m.setting.put("sidebar-width", e)
                }, 10)
            }, isSuppressOnChange: function () {
                return i
            }, markFocusOnDialogClose: function () {
                r = !0, setTimeout(function () {
                    r = !1
                }, 200)
            }, pauseOnChange: function (e) {
                i = !0, e && setTimeout(function () {
                    i = !1
                }, File.isMac ? 800 : 200)
            }, resumeOnChange: function () {
                i = !1
            }, isFileTabShown: function () {
                return !!document.querySelector(".pin-outline .active-tab-files")
            }, isSidebarShown: function () {
                return document.body.classList.contains("pin-outline")
            }, isOutlineShown: function () {
                return f(".pin-outline .active-tab-outline").length > 0
            }, getActiveTab: function () {
                return this.isSidebarShown() ? this.isFileTabShown() ? this.useTreeStyle ? "file-tree" : "file-list" : "outline" : ""
            }, togglePanel: function (e) {
                this.isSidebarShown();
                this.getActiveTab() == e ? this.toggleSidebar() : this.showSidebar(e)
            }, toggleSidebar: function () {
                this.isSidebarShown() ? this.hideSidebar() : this.showSidebar()
            }, tmpHideSidebar: function (e) {
                this.savedSidebarStatus = this.isSidebarShown(), this.editor.docMenu.autoHideOutline(), this.hideSidebar(!e)
            }, recoverSidebar: function () {
                this.savedSidebarStatus && this.showSidebar()
            }, updateMenu: function (e) {
                var t = {};
                t["View→Outline"] = {state: "outline" == e}, t["View→Articles"] = {state: "file-list" == e}, t["View→File Tree"] = {state: "file-tree" == e}, File.updateMenuToUI(t)
            }, hideSidebar: function (e) {
                this.editor.docMenu.storeOutline(), document.querySelector("#typora-sidebar").classList.remove("open"), document.body.classList.remove("pin-outline"), !e && m && m.setting.put("sidebar_tab", ""), f(window).trigger("resize"), File.isMac ? (m.window.setTitlebarTextMarginLeft(void 0), this.updateMenu("")) : window.ClientCommand.refreshViewMenu()
            }, showSidebar: function (e, t) {
                this.editor.docMenu.autoHideOutline(), t && this.isSidebarShown() ? this.switch(e) : this.show(e)
            }, show: function (e) {
                document.querySelector("#typora-sidebar").classList.add("open"), document.body.classList.add("pin-outline"), this.switch(e || this.getActiveTab() || this.defaultTab), this.editor.docMenu.renderOutline(), f(window).trigger("resize"), File.isMac && "true" != (window.getComputedStyle(document.body).getPropertyValue("--typora-center-window-title") || "").trim() && m.window.setTitlebarTextMarginLeft(document.querySelector("#typora-sidebar").getBoundingClientRect().width)
            }, switchTreeOrList: function (e) {
                (this.useTreeStyle !== e || this.onInit_) && (this.onInit_ = !1, this.useTreeStyle = e, f(".sidebar-content").scrollTop(0), this.useTreeStyle ? f("#typora-sidebar").addClass("use-file-tree-style").removeClass("use-file-list-style").find("#sidepanel-segmented-input-files").data("localize", "Files").text(f.localize.getString("Files")) : f("#typora-sidebar").addClass("use-file-list-style").removeClass("use-file-tree-style").find("#sidepanel-segmented-input-files").data("localize", "Articles").text(f.localize.getString("Articles")), f.localize.isLoaded() || f("#sidepanel-segmented-input-files").localize("Front", {
                    language: File.language,
                    pathPrefix: "locales"
                }), File.isNode ? window.ClientCommand.refreshViewMenu() : this.updateMenu(e ? "file-tree" : "file-list"), m && m.setting.put("useTreeStyle", e)), this.isFileTabShown() && !this.renderIfNeed() && this.markCurrentFile(!0), f("[data-side-mode]").removeClass("selected-folder-menu-item"), this.useTreeStyle ? f("[data-side-mode='file-tree']").addClass("selected-folder-menu-item") : f("[data-side-mode='file-list']").addClass("selected-folder-menu-item"), this.refreshMenuVisibility(), m && m.setting.put("sidebar_tab", e ? "file-tree" : "file-list")
            }, openFile: function (e) {
                e && !File.isBroken && (f("#sidebar-files-menu").trigger("blur"), File.isMac ? m.controller.switchDocumentTarget(e) : (File.megaMenu.hide(), y(e)))
            }, openFileInNewWindow: function (e, t) {
                e && (File.backupDocumentSnap(), File.isMac ? t ? m.app.openFolder(e) : m.app.openInTypora(e, !0) : p.app.openFileOrFolder(e, {
                    forceCreateWindow: !0,
                    mountFolder: File.getMountFolder()
                }))
            }, onLoadFolderFailed: function (e) {
                var t = this;
                (e = e || this.slient) ? "pinFolder" == this.slient && p.dialog.showMessageBox({
                    type: "question",
                    message: f.localize.getString("Cannot open folder {0}").format(File.mountFolder_),
                    buttons: [f.localize.getString("Ignore", "Panel"), f.localize.getString("Choose Default Folder", "Panel")],
                    defaultId: 1,
                    normalizeAccessKeys: !0
                }, function (e) {
                    p.app.setting.put("restoreWhenLaunch", 0), 1 == e && p.dialog.showOpenDialog({
                        defaultPath: File.mountFolder_,
                        properties: ["openDirectory", "promptToCreate"]
                    }, function (e) {
                        e && e.length > 0 && (p.app.setting.put("restoreWhenLaunch", 3), p.app.setting.put("pinFolder", e[0]), t.setMountFolder(e[0]))
                    })
                }) : alert(f.localize.getString("Cannot open folder {0}").format(File.mountFolder_)), File.isNode && p.app.setting.removeRecentFolder(File.getMountFolder()), f("#file-library-tree, #file-library-list-children").attr("data-state", "").html(""), File.mountFolder_ = null, this.root = null, this.slient = !1, this.refreshMenuVisibility()
            }, addFolderWatchByWin: function (e, t) {
                if (e) {
                    var n = this;
                    this.fsWatcher && (this.fsWatcher.close(), this.fsWatcher = null), this.folderWatchedOnWin = !0, this.fsWatcher = reqnode("fs").watch(e, {recursive: !0}, function (t, n) {
                        if (!i) {
                            n = e + "\\" + n;
                            if ("rename" == t && File.filePath && 0 == File.filePath.indexOf(n + "\\")) {
                                var o = n + "\\" + File.filePath.substr(n.length);
                                doApplyRename(o)
                            }
                            a = n, s = "rename" !== t, v && clearTimeout(v), b.push([a, s]), v = setTimeout(r, 200);
                            var a, s
                        }
                    })
                }

                function r() {
                    var e = b.clone();
                    v = null, b = [];
                    var t = [], i = [];
                    e.forEach(function (e) {
                        e[1] || n.fileTree.onChangeForWin(e[0], t), n.fileList.onChangeForWin(e[0], e[1], i)
                    })
                }
            }, bindContext: function () {
                var e, t = this;
                f("#file-menu").on("mousedown", "[data-key]", function (n) {
                    var i = this.getAttribute("data-action");
                    if (i && 1 == n.which) {
                        switch (f(".context-menu").removeClass("show").find(".active").removeClass("active"), i) {
                            case"open":
                                t.openFileCommand(e);
                                break;
                            case"open_in_new_window":
                                t.openFileInNewWindowCommand(e);
                                break;
                            case"new_file":
                                return t.newFileCommand(e), !1;
                            case"new_folder":
                                return t.newFolderCommand(e), !1;
                            case"delete":
                                t.deleteFileCommand(e);
                                break;
                            case"rename":
                                return t.getDelegate().renameFileCommand(e), !1;
                            case"copy_path":
                                t.copyFullPathCommand(e);
                                break;
                            case"reveal":
                                t.revealFileInFinderCommand(e);
                                break;
                            default:
                                return
                        }
                        t.editor.restoreLastCursor(null, !0)
                    }
                });

                function n(n) {
                    if (e = this, this == document.querySelector("#file-library") && t.useTreeStyle) {
                        if (n.target != this || !File.editor.library.root) return !1;
                        e = t.findElemFromPath(File.editor.library.root.path)[0], f("#file-menu").children("li").hide().end().find('[data-action="new_file"],[data-action="new_folder"]').show()
                    } else f("#file-menu li").show();
                    File.sync(), t.editor.lastCursor = t.editor.selection.buildUndo(), f("#write").blur(), f(".context-menu").removeClass("show").find(".active").removeClass("active");
                    var i = f(e).closest(".file-library-node").focus(), r = f("#file-menu").addClass("show");
                    t.useTreeStyle ? (r.find('[data-action="new_folder"]').show(), i.attr("data-path") == File.getMountFolder() ? r.find("[for-file]").hide() : "true" == i.attr("data-is-directory") ? r.find("[for-file]:not([for-folder])").hide() : r.find("[for-folder]:not([for-file])").hide()) : (r.find('[data-action="new_folder"]').hide(), r.find("[for-folder]:not([for-file])").hide());
                    var o = r.height() + 48,
                        a = n.clientX > window.innerWidth - 220 ? window.innerWidth - 220 : n.clientX,
                        s = n.clientY > window.innerHeight - o ? window.innerHeight - o : n.clientY - f("#top-titlebar").height() + 8;
                    return r.css({top: s + "px", left: a + "px"}), i.one("blur", function () {
                        document.activeElement && document.activeElement.classList.contains("file-node-content") || f(".context-menu").removeClass("show")
                    }), !1
                }

                f("#file-library").on("contextmenu", ".file-node-content, .file-list-item", n).on("contextmenu", n)
            }, bindEvents: function () {
                var e = this, t = this.editor;

                function n() {
                    f(".show-sidebar-footer-context").removeClass("show-sidebar-footer-context")
                }

                File.isNodeHtml, f("#sidepanel-segmented-input-files").click(function () {
                    e.switch("files", !0)
                }), f("#sidepanel-segmented-input-outline").click(function () {
                    e.switch("outline", !0)
                }), f("#typora-sidebar").on("keydown", "[tabindex]", function (t) {
                    "Esc" == d[t.keyCode || t.which] && e.editor.focusCid && e.editor.restoreLastCursor(null, !0)
                }).on("mousedown", "[tabindex]", function (t) {
                    if ("INPUT" != t.target.tagName) {
                        var n = e.editor.selection.buildUndo();
                        n && (e.editor.lastCursor = n)
                    }
                }), f("#ty-sidebar-footer").on("click", "#sidebar-new-file-btn", function () {
                    return t.focusAndRestorePos(), e.newFile(File.getMountFolder()), !1
                }).on("click", "#switch-file-list-btn", function () {
                    return t.focusAndRestorePos(), e.switchTreeOrList(!e.useTreeStyle), !1
                }).on("click", "#target-cur-file-btn", function () {
                    return t.focusAndRestorePos(), File.getMountFolder() && e.getDelegate().focusToFile(l.getCurrentFilePath()), !1
                }).on("click", "#sidebar-menu-btn", function () {
                    return t.focusAndRestorePos(), f(".show-sidebar-footer-context").length ? n() : e.showSidebarMenu(), !1
                }), f(".sidebar-tabs").on("click", "#hide-sidebar-btn", function () {
                    return t.focusAndRestorePos(), e.hideSidebar(), !1
                }).on("click", "#switch-sidebar-icon", function () {
                    return t.focusAndRestorePos(), e.switch(e.isFileTabShown() ? "outline" : "files"), !1
                }), f("#sidebar-files-menu").on("blur", function () {
                    n()
                }).on("mousedown", "#close-sidebar-menu-btn", function () {
                    n()
                }).on("mousedown", "#new-file-from-sidebar-menu", function (t) {
                    1 == t.which && e.newFile(File.getMountFolder())
                }).on("mousedown", "#reveal-folder-from-sidebar-menu", function (e) {
                    1 == e.which && File.getMountFolder() && (File.isMac ? m.path.openFolderInFinder(File.getMountFolder()) : p.shell.openItem(File.getMountFolder()))
                }).on("mousedown", "#refresh-from-sidebar-menu", function (t) {
                    1 == t.which && File.getMountFolder() && e.refreshPanelCommand()
                }).on("mousedown", "#open-folder-from-sidebar-menu", function (t) {
                    1 == t.which && setTimeout(e.selectFolder.bind(e), 0)
                }).on("mousedown", "[data-side-mode]", function (t) {
                    1 == t.which && e.switch(this.getAttribute("data-side-mode"))
                }).on("mousedown", ".folder-menu-item", function (e) {
                    1 == e.which && File.getMountFolder() != this.getAttribute("data-path") && (File.isMac ? m.controller.switchFolder(this.getAttribute("data-path")) : m.switchFolder(this.getAttribute("data-path"), p.getCurrentWindow()))
                }).on("click", "#ty-group-by-folder-btn", function (t) {
                    return e.getDelegate().setGroupByFolder(!e.fileList.expandFolders), !1
                }).on("click", "#ty-sort-by-natural-btn", function () {
                    return e.setSortType(0), !1
                }).on("click", "#ty-sort-by-name-btn", function () {
                    return e.setSortType(1), !1
                }).on("click", "#ty-sort-by-date-btn", function () {
                    return e.setSortType(2), !1
                }).on("keydown", function (e) {
                    "Esc" == d[e.keyCode || e.which] && this.blur()
                }), this.fileTree.bindEvents(), this.fileList.bindEvents(), File.isNodeHtml && this.bindContext()
            }, compareItem: function (e, t) {
                var n = /\.[^.]+$/;
                return this.sortType == w.Alphabet ? e.name.replace(n, "").localeCompare(t.name.replace(n, "")) : this.sortType == w.Date ? t.lastModified - e.lastModified : o.naturalSort(e.name.replace(n, ""), t.name.replace(n, ""))
            }, setSortType: function (e) {
                f(".ty-side-sort-btn2").removeClass("active"), e == w.Alphabet ? f("#ty-sort-by-name-btn").addClass("active") : e == w.Date ? f("#ty-sort-by-date-btn").addClass("active") : f("#ty-sort-by-natural-btn").addClass("active"), this.sortType != e && (m && m.setting.put("file_sort_type", e), this.sortType = e, this.fileList && this.fileList.setSortType(e), this.fileTree && this.fileTree.setSortType(e))
            }, selectFolder: function () {
                if (File.isMac) m.controller.selectFolder(); else {
                    var e = p.dialog, t = p.getCurrentWindow(), n = this;
                    e.showOpenDialog(t, {
                        buttonLabel: f.localize.getString("Select"),
                        properties: ["openDirectory"]
                    }, function (e) {
                        var t = (e || [])[0];
                        t && n.onRootChanged(t)
                    })
                }
            }, showSidebarMenu: function () {
                f(".sidebar-footer").addClass("show-sidebar-footer-context");
                var e = f("#sidebar-files-menu").focus();

                function t(e, t) {
                    var n = f(f("#folder-menu-item-template").html());
                    return n.find("span").text(l.getFileNameFromPath(e)), n.attr("data-path", e), n.attr("ty-hint", o.abbreviatingWithTilde(e)), t.before(n), n
                }

                !function () {
                    e.find(".folder-menu-item").remove().end().find(".folder-menu-group").show();
                    var n = f(".sidebar-content").height(),
                        i = e.find("#reveal-folder-from-sidebar-menu")[0].clientHeight, r = e[0].clientHeight,
                        o = Math.max(0, Math.min(6, Math.floor((n - r - 20) / i))),
                        a = File.isMac ? m.controller.getRecentFolders() : m.setting.getRecentFolders().map(function (e) {
                            return e.path
                        });
                    a = a.slice(0), File.getMountFolder() ? (a.remove(File.getMountFolder()), a = a.slice(0, (o || 1) - 1)) : a = a.slice(0, o);
                    for (var s = f("#folder-menu-item-after"), l = 0; l < a.length; l++) t(a[l], s);
                    File.getMountFolder() ? t(File.getMountFolder(), s).addClass("selected-folder-menu-item") : 0 == a.length && e.find(".folder-menu-group").removeClass("show")
                }()
            }, init: function () {
                if (File.option.sidebarTab && this.show(File.option.sidebarTab), this.bindEvents(), File.isMac && m.controller.isLoadFolder() && !l.getCurrentFilePath() && (this.isFileTabShown() || this.show(this.useTreeStyle ? "file-tree" : "file-list"), this.useTreeStyle)) {
                    m.controller.setLoadFolder(!1)
                }
            }, switch: function (e, t) {
                if (f(".sidebar-content").scrollTop(0), "outline" == e) {
                    f("#typora-sidebar").addClass("active-tab-outline").removeClass("active-tab-files"), f("[data-side-mode]").removeClass("selected-folder-menu-item"), f("[data-side-mode='outline']").addClass("selected-folder-menu-item"), f("#sidebar-footer-main-item-label").text(f.localize.getString("Outline")), this.editor.docMenu.highlightVisibleHeader();
                    var n;
                    this.useTreeStyle ? (n = f.localize.getString("Switch to File Tree view"), f("#switch-sidebar-icon").html('<span class="ty-icon ty-file-tree"></span>').attr("ty-hint", n).attr("aria-label", n)) : (n = f.localize.getString("Switch to File List view"), f("#switch-sidebar-icon").html('<span class="ty-icon ty-three-cells"></span>').attr("ty-hint", n).attr("aria-label", n))
                } else {
                    f("#typora-sidebar").removeClass("active-tab-outline").addClass("active-tab-files");
                    var i = this.useTreeStyle || !1;
                    "file-list" == e ? i = !1 : "file-tree" == e ? i = !0 : e = i ? "file-tree" : "file-list", this.switchTreeOrList(i), this.refreshMenuVisibility(), f("#switch-sidebar-icon").html('<span class="ty-icon ty-list"></span>').attr("ty-hint", f.localize.getString("Switch to Outline view"))
                }
                f("#switch-sidebar-icon").localize("Front", {
                    language: File.language,
                    pathPrefix: "locales"
                }), m && m.setting.put("sidebar_tab", e), File.isNode ? window.ClientCommand.refreshViewMenu() : (this.updateMenu(e), f(".sidebar-tab").removeClass("active").filter("outline" == e ? "#sidepanel-segmented-input-outline" : "#sidepanel-segmented-input-files").addClass("active"))
            }, calcMountFolder: function (e) {
                File.getMountFolder();
                if (File.isMac) File.mountFolder_ = m.controller.mountFolder(); else {
                    if (!File.isNode) return null;
                    if (!File.getMountFolder()) try {
                        File.mountFolder_ = function (t) {
                            var n = reqnode("path"), i = reqnode("fs"), r = t;
                            if (!t) return null;
                            for (; r && /^\w*\/+\w/.exec(r);) {
                                var o = i.readdirSync(r);
                                if (o.indexOf(".git") > -1 || o.indexOf(".svn") > -1 || o.indexOf(".hg") > -1 || o.indexOf("package.json") > -1) return r;
                                if (/((dropbox\/apps\/[^\/]+)|pages|articles?|blogs?|content)\/?$/i.exec(r)) return r;
                                if (/(_?posts?|_?drafts?)\/?$/i.exec(r)) return r;
                                if (/(node_modules)\/[^\/]+\/?$/i.exec(r)) return r;
                                var a = r;
                                if ((r = n.join(r, "../")) == a || e) break
                            }
                            return /^\w*\/+\w/.exec(t) ? t.replace(/[\/\\]$/, "") || null : t
                        }(l.getCurrentFileFolderPath()), File.editor.quickOpenPanel.cacheFolder(File.mountFolder_)
                    } catch (e) {
                    }
                }
                return this.isFileTabShown() && this.refreshMenuVisibility(), File.getMountFolder()
            }, fetchRecentFile: function () {
            }, renderIfNeed: function () {
                return this.useTreeStyle ? this.fileTree.renderIfNeed() : this.fileList.renderIfNeed()
            }, findElemFromPath: function (e) {
                return f(".file-library-node[data-path='" + o.escapeSelector(e) + "']")
            }, revealInSidebar: function () {
                this.isFileTabShown() ? this.markCurrentFile() : l.getCurrentFilePath() && this.showSidebar("files")
            }, revealInFileList: function () {
                this.showSidebar("file-list"), this.markCurrentFile()
            }, revealInFileTree: function () {
                this.showSidebar("file-tree"), this.markCurrentFile()
            }, markCurrentFile: function (e, t) {
                var n = l.getCurrentFilePath();
                n && (this.markOpenedFile(n, t), this.getDelegate().focusToFile(n, e))
            }, markOpenedFile: function (e, t) {
                if (!e) return f();
                var n = this.findElemFromPath(e);
                return n.length && (f(".file-library-node.active").removeClass("active"), n.addClass("active")), n
            }, end: function () {
                this.fileTree.needRepaint(), this.fileList.needRepaint(!0), this.root = null, File.mountFolder_ = null, this.fsWatcher ? (this.fsWatcher.close(), this.fsWatcher = null, v && clearTimeout(v)) : File.isUnixNode && (this.fileTree.unixWatchers = {}, this.fileList.unixWatchers = {}, reqnode("pathwatcher").closeAllWatchers())
            }, refreshMenuVisibility: function () {
                var e = f("#ty-sidebar-footer");
                File.getMountFolder() ? (e.find(".empty-menu-group").removeClass("show"), e.find(".not-empty-menu-group").addClass("show"), f("#typora-sidebar").removeClass("ty-no-mount-folder")) : (e.find(".empty-menu-group").addClass("show"), e.find(".not-empty-menu-group").removeClass("show"), f("#typora-sidebar").addClass("ty-no-mount-folder")), f("#sidebar-footer-main-item-label").text(l.getFileNameFromPath(File.getMountFolder()) || f.localize.getString("Open Folder..."))
            }, onRootChanged: function (e) {
                if (this.end(), File.isNode && (File.mountFolder_ = e, e && p.app.setting.addRecentFolder(e)), f("#file-library:visible").length && this.renderIfNeed(), this.editor.quickOpenPanel) this.editor.quickOpenPanel.cacheFolder(e); else {
                    var t = this.editor;
                    setTimeout(function () {
                        t.quickOpenPanel && t.quickOpenPanel.cacheFolder(e)
                    }, 1e3)
                }
                this.refreshMenuVisibility()
            }, setMountFolder: function (e, t, n) {
                this.slient = n, this.onRootChanged(e), t && this.showSidebar(this.useTreeStyle ? "file-tree" : "file-library", !0)
            }, onFileChanges: function (e) {
                if (File.getMountFolder()) {
                    var t = JSON.parse(e);
                    this.fileTree.onChangeForMac(t), this.fileList.onChangeForMac(t)
                }
            }, getDelegate: function () {
                return this.useTreeStyle ? this.fileTree : this.fileList
            }, isDiscardableUntitled: function () {
                return !(File.isDocumentEdited() || (File.isMac ? m.document.currentFilePath() : File.filePath))
            }, newFile: function (e) {
                File.getMountFolder() && this.getDelegate().newFile(e)
            }, openFileCommand: function (e) {
                e || retrun;
                var t = this.editor.getJQueryElem(e).closest(".file-library-node").attr("data-path");
                this.openFile(t), this.editor.docMenu.autoHideOutline()
            }, openFileInNewWindowCommand: function (e) {
                if (e = this.editor.getJQueryElem(e).closest(".file-library-node")[0]) {
                    var t = "true" == e.dataset.isDirectory, n = e.dataset.path;
                    this.openFileInNewWindow(n, t)
                }
            }, copyFullPathCommand: function (e) {
                var t = this.editor.getJQueryElem(e).closest(".file-library-node").attr("data-path");
                this.editor.UserOp.setClipboard("<span>" + t + "</span>", null, t, !0)
            }, revealFileInFinderCommand: function (e) {
                var t = "string" == typeof e ? e : this.editor.getJQueryElem(e).closest(".file-library-node").attr("data-path");
                File.isMac ? m.path.showInFinder(t) : p.shell.showItemInFolder(t)
            }, renameFileCommand: function (e, t) {
                this.getDelegate().renameFileCommand(e, t)
            }, newFileCommand: function (e, t) {
                this.getDelegate().newFileCommand(e, t)
            }, newFolderCommand: function (e) {
                this.fileTree.newFolderCommand(e)
            }, deleteFileCommand: function (e) {
                var t = this.editor.getJQueryElem(e).closest(".file-library-node"), n = t.attr("data-path");
                if (n == l.getCurrentFilePath()) {
                    var i = this.useTreeStyle ? f() : t.filter(".file-list-item").next();
                    i.length ? this.openFileCommand(i[0]) : File.isNode ? y(null) : m.controller.switchDocumentTarget("")
                }
                t.hide(), File.isMac ? m.library.trashItem(n) : File.isNode && p.shell.moveItemToTrash(n)
            }, refreshPanelCommand: function () {
                var e = File.getMountFolder();
                this.end(), File.isNode ? File.mountFolder_ = e : (m.controller.switchFolder(e), m.controller.bindFolderMonitor()), this.renderIfNeed(), this.refreshMenuVisibility()
            }, bindRename: function (e, t, n, i) {
                var r, o, a = e.val(), s = this;

                function l(e) {
                    return File.isWin ? e.replace(/[\\\/:*?"<>\|\000-\031]/g, "").trim() : e.replace(/[\/\\\000-\031]/g, "")
                }

                function c() {
                    if (!o) {
                        o = !0;
                        var i = l(e.val());
                        i.length > 0 && i != a ? (e.val(i), t(e)) : n()
                    }
                }

                function u(t) {
                    var n = e.val(), i = n.lastIndexOf(".");
                    i < 0 && t && (i = n.length), i > 0 && e[0].setSelectionRange(0, i)
                }

                e.one("blur", function () {
                    if (!r) {
                        r = !0, i ? c() : ((t = e).val(l(t.val())), a != t.val() ? File.isLinux ? p.dialog.showMessageBox(null, {
                            title: f.localize.getString("Confirm"),
                            message: f.localize.getString('Rename to "{0}" ?').format(t.val()),
                            type: "question",
                            buttons: ["OK", "Cancel"]
                        }, function (e) {
                            0 == e ? (s.markFocusOnDialogClose(), c()) : n()
                        }) : confirm(f.localize.getString('Rename to "{0}" ?').format(t.val())) ? (s.markFocusOnDialogClose(), c()) : n() : n());
                        var t
                    }
                }).on("keydown", function (e) {
                    return "Enter" == d[e.keyCode || e.which] ? (r = !0, c(), !1) : "Esc" == d[e.keyCode || e.which] ? (r = !0, n(), !1) : "A" == d[e.keyCode || e.which] && (File.isMacOrMacNode ? e.metaKey : e.ctrlKey) ? (u(!0), !1) : void 0
                }).on("mousedown", function (e) {
                    e.stopPropagation()
                }).on("click", function (e) {
                    e.stopPropagation()
                }).on("mouseup", function (e) {
                    1 == e.which && this.selectionEnd == this.selectionStart && this.selectionEnd == this.value.length && u()
                }).on("focus", u)
            }
        });
        n.exports = C
    }), $__System.registerDynamic("42", ["37", "e", "13", "11", "12", "18", "10", "14", "19", "23", "26", "27", "2a", "30", "28", "17", "43", "2d", "1a", "25", "2e", "3e", "44", "32", "2b", "33", "45", "34", "36", "3a", "31", "3b", "46", "3c", "40", "2c"], !0, function ($__require, exports, module) {
        "use strict";
        var global = this || self, GLOBAL = global, _polyfill = $__require("37"), $ = $__require("e"),
            StringUtils = $__require("13"), Backbone = $__require("11"), NodeDef = $__require("12"),
            Node = NodeDef.Node, TYPE = NodeDef.TYPE, MarkParser = $__require("18"), Node2Mark = $__require("10"),
            Node2HTML = $__require("14"), NodeOperation = $__require("19"), Fences = $__require("23"),
            MathBlock = $__require("26"), MathInline = $__require("27"), Brush = $__require("2a"),
            Selection = $__require("30"), rangy = Selection.rangy, EditHelper = $__require("28"),
            HTMLBlock = $__require("17"), TableEdit = $__require("43"), ImageEdit = $__require("2d"),
            UndoManager = $__require("1a"), SnapFlag = UndoManager.SnapFlag, KeyMaster = $__require("25"),
            keyNames = KeyMaster.map, UserOp = $__require("2e"), FileInfoPanel = $__require("3e"),
            File = $__require("44"), DocMenu = $__require("32"), Stylize = $__require("2b"),
            SearchPanel = $__require("33"), Emoji = $__require("45"), Word = $__require("34"),
            Export = $__require("36"), SourceView = $__require("3a"), FileHelper = $__require("31"),
            QuickOpenPanel = $__require("3b"), ContextMenu = $__require("46"), SpellCheck = $__require("3c"),
            Library = $__require("40"), morphdom = $__require("2c"),
            electron = window.reqnode ? reqnode("electron").remote : null;
        !function () {
            var e = $.fn.replaceWith;
            $.fn.oldReplaceWith = e, $.fn.replaceWith = function (t) {
                var n = this.parent();
                if (e.apply(this, arguments), this[0] && "LI" == this[0].tagName) {
                    var i = n.closest("li");
                    i.length && (i.css("margin", "0.1px"), i.css("margin", ""))
                }
            }
        }(), window.setAttributeOnlyNeeded = function (e, t, n) {
            e.getAttribute(t) != n && e.setAttribute(t, n)
        };
        var DBCLICK_DELAY = 180, clicks = 0, clickTimer = null, $curLinkElem, $imeWrapperDom, dropContents,
            isInputComponent = function (e) {
                return !!e && ("TEXTAREA" == e.tagName || "INPUT" == e.tagName || "SELECT" == e.tagName || e.classList && e.classList.contains("ty-input"))
            };
        window.isInputComponent = isInputComponent;
        var Editor = Backbone.Model.extend({
            constructor: function (e, t) {
                this.sessionStr = e, this.EditHelper = EditHelper, this.MarkParser = MarkParser, t.setTheme(), t.setEditor(this), this.nodeMap = new NodeDef.NodeMap, this.writingArea = document.querySelector(this.sessionStr), t.readOption();
                var n = void 0, i = t.getDocumentSnap();
                this.imgEdit = new ImageEdit(this), this.docMenu = new DocMenu(this), this.undo = new UndoManager(this), t.exitOversize(), (i || {}).nodeMap ? (t.isNode && FileInfoPanel.setFileTitle(t.getFilePathUseNode(), i.fileEncode), t.restoreEditStateFromData(i, !1, !0)) : t.recoverFromBackup() || (n = t.tryEnterOversize(t.getContent()), this.reset(n)), t.onFileOpened(), this.library = new Library(this), this.library.init(), this.timerPool_ = {}, this._bindGlobal(), this._bindKeyEvents(), this._bindMouseEvents(), this.focusCid = null, this.selection = new Selection(this), this.keypressMsg = "", this.mathInline = new MathInline(this), this.brush = new Brush(this), this.tableEdit = new TableEdit(this), this.fences = new Fences(this), this.mathBlock = new MathBlock(this), this.htmlBlock = new HTMLBlock(this), this.stylize = new Stylize(this);
                var r = this;
                setTimeout(function () {
                    r.selection.unlockScroll()
                }, 500), this.brush.run(), this.UserOp = UserOp, this.searchPanel = new SearchPanel(this), this.writingArea.focus(), this.sourceView = new SourceView(this), void 0 != n && n.trim().length ? (this.selection.lockScroll(), this.selection.jumpIntoElemEnd($("[cid]").last())) : ($(this.sessionStr + ">*:first-child").addClass("md-focus"), this.selection.jumpTop()), this.emoji = new Emoji(this), this.word = new Word(this), this.export = new Export(this), (t.isMac || t.isNode) && setTimeout(t.bindMenu, 200), t.freshLock(), this.quickOpenPanel = new QuickOpenPanel(this), this.quickOpenPanel.init(), this.spellChecker = new SpellCheck(this), this.contextMenu = new ContextMenu(this.sessionStr), this.dropTargetDom = null, this.strollingBySelect = !1, this.updateFocusMode(t.isFocusMode, !0, !0), this.setTypeWriterMode(t.isTypeWriterMode, !1, !0), setTimeout(function () {
                    t.option.slientOpenFailure = !1
                }, 400)
            }, tryEnterBusyMode: function (e) {
                var t = this.writingArea;

                function n() {
                    File.inBusyMode = !0, setAttributeOnlyNeeded(t, "contenteditable", "false")
                }

                function i() {
                    File.inBusyMode = !1, File.isLocked || setAttributeOnlyNeeded(t, "contenteditable", "true")
                }

                void 0 !== e ? e.length > 5e4 ? n() : i() : t.innerHTML.length > 2e6 ? n() : i()
            }, runAllScript: function () {
                this.scriptTimer && (clearTimeout(this.scriptTimer), this.scriptTimer = null);
                var writingArea = this.writingArea;
                this.scriptTimer = setTimeout(function () {
                    writingArea.querySelectorAll("script[data-run]").forEach(function (d) {
                        d.removeAttribute("data-run"), eval(d.textContent)
                    })
                }, 100)
            }, reset: function (e) {
                File._onInitParse = !0, File.unsupported && (e = "");
                var t = new NodeDef.Node({
                    type: NodeDef.TYPE.raw_edit,
                    in: this.nodeMap,
                    attachTo: this.nodeMap,
                    text: e
                });
                this.tryEnterBusyMode(e), this.writingArea.innerHTML = t.parseFrom({skips: {old_code: !1}})[0], this.focusCid = null, this.lastCursor = null, File._needsUpdateSnap = !0, File._onInitParse = !1, setTimeout(this.refresh.bind(this), 0), this.spellChecker && this.spellChecker.reset()
            }, quickRefresh: function () {
                this.refresh(!1, !0)
            }, refreshUnder: function (e, t) {
                this.mathBlock.renderAll(e), this.mathInline.renderAll(!1, e), this.fences.modeLoaded && this.fences.refreshEditor(!1, t, e), this.diagrams.modeLoaded && this.diagrams.refreshDiagram(t, e), !t && this.htmlBlock && this.htmlBlock.refreshUnder(e)
            }, refresh: function (e, t) {
                if (!File._onInitParse) {
                    var n = File.isActiveWindow();
                    this.sourceView && this.sourceView.inSourceMode ? e && this.sourceView.cm.refresh() : this.brush && ($(this.writingArea).find(".md-mathblock-panel").length || (this.mathBlock.currentCm = void 0), t || (this.nodeMap.toc.refresh(!0), this.docMenu.resizeFooter()), this.refreshUnder(void 0, e), n && (this.brush && this.stylize && (this.brush.expand(void 0, !0), this.brush.updateWordCount(), File.isNode && File.refreshImageCopyStatus(!0)), this.runAllScript(), $("#typora-table-row-tracker, #typora-table-col-tracker").hide()))
                }
            }, getJQueryElem: function (e) {
                return e ? e.nodeType == e.ELEMENT_NODE ? $(e) : $(e.parentNode) : $()
            }, getMarkElem: function (e) {
                if (!e && document.activeElement.nodeType == window.Node.ELEMENT_NODE && (document.activeElement.hasAttribute("tabindex") || Node.isType(document.activeElement.tagName, "TEXTAREA", "INPUT"))) return $(document.activeElement).closest("[cid]");
                if (!(e = e || window.getSelection().anchorNode || document.activeElement)) return [];
                var t = e.nodeType == e.ELEMENT_NODE ? $(e) : $(e.parentNode);
                return !t.length || "TH" !== t[0].tagName && "TD" !== t[0].tagName || (t = t.children(".td-span")), StringUtils.isNullOrEmpty(t.attr("cid")) && (t = t.closest("[cid]")), t
            }, autoRemoveUnholdable: function (e) {
                var t = this.focusCid && this.findElemById(this.focusCid).closest(".unholdable");
                if (t && t.length) try {
                    var n = this.findNodeByElem(t);
                    e = e || UndoManager.makeEmptyCommand(this.selection.buildUndo());
                    t.text().length ? t.removeClass("unholdable") : (this.undo.UndoManager.addUndoForRemove(e, n), e.redo.push(this.selection.buildUndo()), n.remove(), t.remove(), this.undo.register(e), this.focusCid = null)
                } catch (e) {
                    console.warn(e.stack)
                }
            }, store: function (e, t) {
                if ((!this.sourceView || !this.sourceView.inSourceMode) && (e = e || this.focusCid)) {
                    var n = e.id ? e : this.nodeMap.get("allNodes").get(e);
                    if (n) {
                        var i = this.findElemById(n.id);
                        if (i.length > 0) {
                            var r = i.rawText(!0);
                            return Node.isType(n, TYPE.hr, TYPE.toc) || (Node.isType(n, TYPE.meta_block) ? (r = r.replace(/\n$/, ""), n.set("text", r)) : Node.isType(n, TYPE.math_block) ? i.find(".CodeMirror-code").length && this.mathBlock.syncToNode(n) : Node.isType(n, TYPE.fences) ? i.find(".CodeMirror-code").length && this.fences.syncToNode(n) : Node.isType(n, TYPE.html_block) ? i.find(".CodeMirror-code").length && this.htmlBlock.syncToNode(n) : Node.isType(n, TYPE.def_footnote, TYPE.def_link) ? (Node.reverseAttrFromElem(n, i), !t && this.docMenu.resizeFooter()) : Node.isType(n, TYPE.heading, TYPE.raw_edit, TYPE.paragraph, TYPE.table_cell) && !i[0].querySelector("[cid]") ? Node.isType(n, TYPE.paragraph) ? n.set("text", r.replace(/^( {4}|\t)/, "​$1")) : n.set("text", r) : t && n.get("children").map(function (e) {
                                i[0].querySelector("[cid='" + e.cid + "']") ? this.store(e) : e.remove()
                            }, this)), Node.isType(n, n.TYPE.meta_block) && !t && this.imgEdit.updateLocalRootUrl(), n
                        }
                        this.focusCid = null
                    }
                }
            }, cleanTooltip: function () {
                $(this.sessionStr).find(".md-tooltip-hide").hide(), normalCleanTooltip_(), this.mathBlock.stopEditing()
            }, refocus: function (e, t, n, i, r) {
                if (this.isIME) return e;
                if (!this.sourceView || !this.sourceView.inSourceMode) {
                    var o, a, s = e ? this.findElemById(e) : this.getMarkElem(), l = this,
                        c = this.nodeMap.allNodes.get(this.focusCid), d = l.findElemById(this.focusCid);
                    if (l.docMenu.autoHideOutline(), e = void 0 === e ? s.attr("cid") : e, t && e && l.store(e), this.focusCid != e || !s.hasClass("md-focus")) {
                        if (this.focusCid != e && (l.findElemById(l.focusCid).trigger("blur").trigger("losefocus").find(".md-tooltip-hide").hide(), normalCleanTooltip_(), Node.isType(c, Node.TYPE.paragraph) && c.unset("depth")), this.focusCid == e) return s.hasClass("md-focus") || s.addClass("md-focus").trigger("refocus"), e;
                        if (this.undo.noStashedUndo() ? (a = this.undo.completeSnap(!0, !0), this.store(this.focusCid), this.lastCursor && this.lastCursor.startId === this.lastCursor.endId && this.lastCursor.startId && (this.lastCursor.id = this.lastCursor.startId), a && this.lastCursor && this.focusCid == this.lastCursor.id && (a.redo.push(this.lastCursor), l.undo.register(a, !0), a = null)) : this.undo.completeSnap(!0), s.addClass("md-focus").trigger("refocus"), $(document.activeElement).trigger("focus"), File.option.expandSimpleBlock && (this.focusCid = UserOp.simpleExpand(this, e)) ? ("block" == document.querySelector("#md-searchpanel").style.display && this.searchPanel.closePanel(), e = this.focusCid) : (n || r || this.brush.expandOnDelay(!1), this.focusCid = e), File.isLocked) return this.focusCid;
                        (this.focusCid && c && !($.contains(d, s) || $.contains(s, d) || s.length && s.is(d)) || c && !this.focusCid) && (c.clearEmptyChar(), (o = !r && this.simpleParse(c, i)) && (o[0].undo[0] = l.lastCursor, setTimeout(function () {
                            o[0].redo.push(l.selection.buildUndo()), l.findElemById(o[2]).replaceWith(o[1]), a && (UndoManager.append(a, o[0]), o[0] = a), l.undo.noStashedUndo() ? l.undo.register(o[0], !0) : l.undo.stashUndo(o[0]), l.quickRefresh(), l.selection.scrollAdjust(), l.undo.exeCommand(o[0].redo.last())
                        }, 50))), !o && a && this.undo.register(a, !0), this.docMenu.highlightVisibleHeader(), this.focusCid && this.brush.focusContainer(s)
                    }
                    return l.isIME = 0, n || r || this.brush.expandOnDelay(), e
                }
            }, focusAndRestorePos: function () {
                if (document.activeElement != this.writingArea || !this.writingArea.contains(document.activeElement)) {
                    var e = $("content"), t = e.scrollTop();
                    this.writingArea.focus(), e.scrollTop(t)
                }
            }, _bindGlobal: function () {
                var e, t = this;
                KeyMaster("command+=", function (e) {
                    var n = t.getMarkElem(), i = n.attr("mdtype");
                    Node.isType(i, TYPE.heading, TYPE.line) && t.stylize.changeHeadingLevel(t.findNodeByElem(n), !0), e.preventDefault(), e.stopPropagation()
                }), KeyMaster("command+-", function (e) {
                    var n = t.getMarkElem(), i = n.attr("mdtype");
                    Node.isType(i, TYPE.heading, TYPE.line) && t.stylize.changeHeadingLevel(t.findNodeByElem(n), !1), e.preventDefault(), e.stopPropagation()
                }), File.isNodeHtml ? (KeyMaster("ctrl+home", function (e) {
                    File.editor.selection.jumpTop()
                }), KeyMaster("ctrl+end", function (e) {
                    File.editor.selection.jumpBottom()
                }), KeyMaster("ctrl+z, command+z", function (e) {
                    return ClientCommand.undo(e), !1
                }), KeyMaster("ctrl+y, command+y, command+shift+z, ctrl+shift+z", function (e) {
                    return ClientCommand.redo(e), !1
                })
                    , KeyMaster("ctrl+1", function (e) {
                    t.stylize.changeBlock("header1")
                })
                    , KeyMaster("ctrl+2", function (e) {
                    t.stylize.changeBlock("header2")
                })
                    , KeyMaster("ctrl+3", function (e) {
                    t.stylize.changeBlock("header3")
                })
                    , KeyMaster("ctrl+4", function (e) {
                    t.stylize.changeBlock("header4")
                })
                    , KeyMaster("ctrl+5", function (e) {
                    t.stylize.changeBlock("header5")
                })
                    , KeyMaster("ctrl+6", function (e) {
                    t.stylize.changeBlock("header6")
                })
                    ,KeyMaster("ctrl+k", function (e) {
                    File.editor.stylize.toggleFences();
                })
                    , function () {
                    var e = File.isMac || File.isMacNode;
                    KeyMaster(e ? "command+b" : "ctrl+b", function (e) {
                        if (File.isLocked) return !1;
                        e.preventDefault(), t.stylize.toggleStyle(NodeDef.TYPE.strong)
                    }), KeyMaster(e ? "command+i" : "ctrl+i", function (e) {
                        if (File.isLocked) return !1;
                        e.preventDefault(), t.stylize.toggleStyle(NodeDef.TYPE.em)
                    }), KeyMaster(e ? "command+u" : "ctrl+u", function (e) {
                        if (File.isLocked) return !1;
                        e.preventDefault(), t.stylize.toggleStyle(NodeDef.TYPE.underline)
                    }), KeyMaster(e ? "command+a" : "ctrl+a", function (e) {
                        e.preventDefault(), File.isNodeHtml && ClientCommand.selectAll()
                    }), File.isNode && KeyMaster("shift+ctrl+v", function (e) {
                        ClientCommand.pasteAsPlain(), e.preventDefault()
                    }), File.isLinux && KeyMaster("ctrl+/", function (e) {
                        File.toggleSourceMode(), e.preventDefault()
                    })
                }()) : (KeyMaster("ctrl+k", function (e) {
                    var n = t.selection.getRangy();
                    if (n && !isInputComponent(document.activeElement)) {
                        if (n.collapsed) {
                            var i = t.getMarkElem();
                            n.setEnd(i[0], i[0].childNodes.length), t.selection.setRange(n, !0)
                        }
                        n.toString().length ? UserOp.backspaceHandler(t, e, "delSelection") : UserOp.backspaceHandler(t, e, !0), e.preventDefault(), e.stopPropagation()
                    }
                }), KeyMaster("command+left, command+right, shift+command+left, shift+command+right", function (e) {
                    t.brush.expandOnDelay(!0)
                }), KeyMaster("command+up, command+down", function (e) {
                    t.refocus()
                }), KeyMaster("ctrl+h", function (e) {
                    t.selection.getRangy() && !isInputComponent(document.activeElement) && UserOp.backspaceHandler(t, e, "Backspace")
                }), KeyMaster("ctrl+d", function (e) {
                    t.selection.getRangy() && !isInputComponent(document.activeElement) && UserOp.backspaceHandler(t, e, "Delete")
                }), KeyMaster("ctrl+tab", function (e) {
                    File.isMac && app.window.selectNextTab()
                }), KeyMaster("ctrl+shift+tab", function (e) {
                    File.isMac && app.window.selectPreviousTab()
                }), KeyMaster("command+y", function (e) {
                    if (File.isLocked) return !1;
                    t.undo.completeSnap(!0), File.editor.undo.redo(e), File.freshMenu()
                })), File.isMac || File.isNode || (File.isNodeHtml || (KeyMaster("command+z, ctrl+z", function (e) {
                    if (File.isLocked) return !1;
                    t.writingArea.contains(e.target) && t.undo.undo(e)
                }), KeyMaster("command+y, ctrl+y", function (e) {
                    if (File.isLocked) return !1;
                    t.writingArea.contains(e.target) && t.undo.redo(e)
                })), KeyMaster("command+l, ctrl+l", function (e) {
                    e.preventDefault(), t.selection.selectLine()
                }), KeyMaster("command+d, ctrl+d", function (e) {
                    e.preventDefault(), t.selection.selectWord()
                }), KeyMaster("command+e, ctrl+e", function (e) {
                    e.preventDefault(), t.selection.selectPhrase()
                }), KeyMaster("command+a, ctrl+a", function (e) {
                    e.preventDefault(), t.selection.selectAll()
                }), KeyMaster("shift+command+d, shift+ctrl+d", function (e) {
                    if (File.isLocked) return !1;
                    e.preventDefault(), t.selection.selectWord(), UserOp.backspaceHandler(t, null, "delSelection")
                })), $(document).on("dragover", function (e) {
                    e.originalEvent.dataTransfer.dropEffect = "none"
                }).on("dragstart", function (e) {
                    if (t.writingArea.contains(e.target)) return !1
                }).on("drop", function (e) {
                    var n;
                    if (File.isMac) return !0;
                    n = e.originalEvent.dataTransfer.getData("text/html");
                    var i, r = e.originalEvent.dataTransfer.files, o = e.originalEvent.dataTransfer.items;

                    function a(e) {
                        if (ClientCommand.validatePandocInstall()) if (!i && File.changeCounter.isDiscardableUntitled()) i = !0, window.getSelection().removeAllRanges(), ClientCommand.doImport(e); else {
                            var t = electron.app.openFile().activeWindow;
                            t.webContents.once("did-finish-load", function () {
                                t.webContents.executeJavaScript('setTimeout(function(){window.getSelection().removeAllRanges();ClientCommand.doImport("' + StringUtils.escapeInQuote(e) + '")}, 200)')
                            })
                        }
                    }

                    if (n) {
                        if (File.isLocked) return !1;
                        UserOp.pasteHandler(t, n)
                    } else if (r && r.length && File.isNodeHtml) for (var s = 0; s < o.length; s++) {
                        var l, c = o[s].webkitGetAsEntry(), d = r[s], u = electron.getCurrentWindow();
                        if (!c || c.isFile) {
                            if (l = d.path.match(/(?:^|\.)([^.]+)$/)) {
                                if (l = (l[1] || "").toLowerCase(), ~["latex", "ltx", "tex", "wiki", "dokuwiki", "docx", "rst", "rest", "org", "textile", "opml"].indexOf(l)) {
                                    a(d.path);
                                    continue
                                }
                                if (~FileHelper.allowedExtensions.indexOf(l)) {
                                    electron.app.openFile(d.path, {curWindow: u});
                                    continue
                                }
                            }
                        } else c.isDirectory && (File.filePath || File.getMountFolder() ? electron.app.openFolder(d.path) : electron.app.switchFolder(d.path, u));
                        if (File.isLocked) return !1;
                        if (s > 0) t.UserOp.insertParagraph(!1, t); else {
                            var h = document.caretRangeFromPoint(e.originalEvent.x, e.originalEvent.y);
                            h && h.startContainer && (t.writingArea == h.startContainer || t.writingArea.contains(h.startContainer)) && (t.selection.setRange(h), t.refocus())
                        }
                        handlerFileInsert(d.path)
                    }
                    e.stopPropagation(), e.preventDefault()
                }).on("dragfile", function (e) {
                    e.originalEvent.data.resultFromFront = "continue", dropContents = e.originalEvent.data
                }).on("dragfileLeave", function (e) {
                    dropContents = null
                }).on("paste", this.sessionStr, function (e) {
                    if (File.isLocked) return !1;
                    if (!t.sourceView.inSourceMode) return UserOp.pasteHandler(t, e.originalEvent, File._PasteContentFlag)
                }).on("pasteAsPlainText", this.sessionStr, function (e) {
                    if (File.isLocked) return !1;
                    {
                        if (!t.sourceView.inSourceMode) return UserOp.pasteHandler(t, e.originalEvent, !0);
                        File.isMac && app.window.pasteAsPlainText()
                    }
                }).on("copy", this.sessionStr, function (e) {
                    isInputComponent(document.activeElement) || UserOp.copyHandler(t, e.originalEvent)
                }).on("cut", this.sessionStr, function (e) {
                    return !File.isLocked && (!!isInputComponent(document.activeElement) || (File.isNode ? (File._CopyContentFlag = "cut_before", electron.getCurrentWindow().webContents.copy(), !1) : (t.refocus(void 0, !0), t.snapSelection = t.selection.buildUndo(), UserOp.copyHandler(t, e.originalEvent), void UserOp.backspaceHandler(t, e, "delSelection"))))
                }).on("contextmenu", this.sessionStr, function (e) {
                    var n, i = $(e.target);
                    if (i.closest(".CodeMirror")[0] || (Node.isType(t.getMarkElem(e.target).attr("mdtype"), Stylize.CONST.Selectable) ? window.getSelection().removeAllRanges() : ((n = t.selection.getRangy()) && "" == n.toString() && (n.collapse(!0), n.select(n.isBackward)), File.isNodeHtml && File.editor.brush.expand())), "IMG" === e.target.tagName && 0 == i.closest(".md-image.md-expand").length) {
                        $(".md-expand").removeClass("md-expand");
                        var r = i.closest(".md-image").addClass("md-expand");
                        if (!r.length) return;
                        var o = r.children(".md-meta")[0].length;
                        (n = rangy.createRange()).moveToBookmark({
                            containerNode: r.children(".md-meta")[0],
                            start: o - 1,
                            end: o - 1
                        }), t.selection.setRange(n, !0), File.editor.brush.expand()
                    }
                    File.isNodeHtml && File.contextMenu.show(e)
                }).on("inline-input", function (e) {
                    t.selection.scrollAdjust()
                }).on("click", "#md-notification .undo-btn", function () {
                    t.undo.undo(), $("#md-notification").fadeOut()
                }).on("click", "#md-notification .ok-btn", function () {
                    $("#md-notification").fadeOut()
                }).on("focus", "body", function (e) {
                    if (e.target == document.body) return !1
                }).on("click", EditHelper.resetClick);

                function n() {
                    $(".ty-table-edit").length && t.tableEdit.resizeTableEdit($(".ty-table-edit").next()), $(".typora-table-tracker").hide(), t.setTypeWriterMode(File.isTypeWriterMode, !0), e = null
                }

                $(window).on("resize", function () {
                    File.suppressResize || (e && clearTimeout(e), e = setTimeout(n, 300))
                }).on("mouseup", function (e) {
                    t.selection.clearGlobalColumn(), t.stopScrolling(), 1 == e.which && t.brush.updateWordCountInSelection()
                }), File.isMac && ($("#top-hotpot").on("mouseenter", function (e) {
                    1 == e.which && t.startScrolling(!0)
                }), $("#bottom-hotpot").on("mouseenter", function (e) {
                    1 == e.which && t.startScrolling(!1)
                }), $("#top-hotpot").on("mouseleave", function (e) {
                    t.stopScrolling()
                }), $("#bottom-hotpot").on("mouseleave", function (e) {
                    e.screenY + 4 > window.innerHeight || t.stopScrolling()
                }), app.window.isFullScreen() && $("#top-hotpot, #bottom-hotpot").show()), $(t.sessionStr).on("change", "[type='checkbox']", function () {
                    var e = this.parentElement.getAttribute("cid"), n = this.checked;
                    n ? this.setAttribute("checked", "checked") : this.removeAttribute("checked"), t.getNode(e).attr("checked", n, t, !1)
                }), document.addEventListener("selectionchange", function (e) {
                    var n;
                    File.isNodeHtml && (n = t.selection.getRangy(), $("svg.in-text-selection").attr("class", ""), n && n.getNodes([1], function (e) {
                        "svg" === e.tagName && e.classList.add("in-text-selection")
                    })), File.isFocusMode && enterFocusMode.call(t)
                }, !1)
            }, _bindKeyEvents: function () {
                var e, t, n = this, i = !1, r = !1, o = !1;
                n.isIME = 0;

                function a(e) {
                    fastdom.mutate(function () {
                        document.querySelector("#write").querySelectorAll("a, .md-def-url, .md-url").forEach(function (t) {
                            t.style.cursor = e ? "pointer" : ""
                        })
                    })
                }

                var s;
                $(document.body).on("keydown", function (e) {
                    fastdom.strict && fastdom.strict(!0), n.docMenu.autoHideOutline();
                    var t = document.body.classList;
                    (t.contains("ty-show-word-count") || t.contains("ty-show-spell-check")) && (t.remove("ty-show-word-count"), t.remove("ty-show-spell-check"));
                    var i = e.keyCode || e.which;
                    if (EditHelper.keyOnControl(keyNames[i])) return !1;
                    if (document.activeElement == document.body) {
                        var r = $("content").scrollTop();
                        $(n.sessionStr).focus(), "Delete" != keyNames[i] && "Backspace" != keyNames[i] && "Enter" != keyNames[i] || (e.originalEvent != s && (e.target = n.writingArea, s = e.originalEvent, $(n.sessionStr).trigger(e)), e.preventDefault()), $("content").scrollTop(r)
                    }
                    return !(n && n.contextMenu && n.contextMenu.handleKeyEvent(e)) && void 0
                });
                var l = 0, c = function (e) {
                    if (n.isIME && !isInputComponent(document.activeElement)) {
                        e && (l = -1, setTimeout(function () {
                            l = 0
                        }, 0));
                        var t = n.getMarkElem();
                        n.focusCid = t.attr("cid"), $imeWrapperDom && ($imeWrapperDom.attr("contenteditable", "true"), $imeWrapperDom = null), n.brush.addToQueue(n.focusCid), n.isIME = 0, setTimeout(function () {
                            n.isIME || (t.trigger("inline-input"), n.brush.brushQueue())
                        }, 10)
                    }
                }, d = function (e) {
                    if (e && (l = -1), !isInputComponent(document.activeElement)) if (n.isIME) n.undo.snap(n.focusCid, SnapFlag.ADD, void 0, !0); else {
                        if (n.isIME = 1, File.isMac) {
                            var t = n.selection.getRangy(), i = n.getMarkElem(t.commonAncestorContainer);
                            i.length && !i.find("[cid]").length || t.collapsed || (UserOp.backspaceHandler(n, null, "delSelection"), i = n.getMarkElem()), "false" == ($imeWrapperDom = i.parent()).attr("contenteditable") ? $imeWrapperDom = null : $imeWrapperDom.attr("contenteditable", "false"), Node.isType(i.attr("mdtype"), TYPE.hr) && i.attr("contenteditable", "true")
                        }
                        n.selection.prepNode("", e, void 0, !0), n.undo.snap(n.focusCid, SnapFlag.ADD, void 0, !0)
                    }
                };
                $(n.sessionStr).on("keydown", function (e) {
                    s = e.originalEvent, n.keypressMsg = null;
                    var t = e.keyCode || e.which, r = isInputComponent(e.target);
                    if (229 != t) {
                        if (n && n.contextMenu && n.contextMenu.handleKeyEvent(e)) return !1;
                        if (EditHelper.keyOnControl(keyNames[t])) return !1;
                        if (document.body.classList.contains("megamenu-opened")) "Esc" === keyNames[t] && File.megaMenu.hide(); else {
                            if ($(".dropdown-menu.open:not(#typora-sidebar), .dropdown-menu.show").removeClass("open").removeClass("show").find(".active").removeClass("active"), "Ctrl" != keyNames[t] && "Command" != keyNames[t] || a(!0), Node.isType(keyNames[t], "Right", "Left", "Up", "Down")) {
                                if ($(".context-menu:visible").length && n.contextmenu.handleArrowKey(keyNames[t]), e.target.classList && e.target.classList.contains("ty-input") && !e.ctrlKey && !e.metaKey) {
                                    if (m = n.selection.getRangy(), "Left" == keyNames[t] && 0 == m.startOffset && 0 == m.endOffset) return n.selection.moveUpOrDown(!0, e, !0), !1;
                                    if ("Right" == keyNames[t] && m.startOffse == m.endOffset && m.endOffset == e.target.textContent.length) return n.selection.moveUpOrDown(!1, e, !0), !1
                                }
                                if (r && Node.isType(keyNames[t], "Right", "Left")) return;
                                if (File.isLocked) return !0;
                                if (File.inBusyMode && e && (e.shiftKey || e.metaKey || e.ctrlK) && setAttributeOnlyNeeded(n.writingArea, "contenteditable", "true"), $((n.selection.getRangy() || {}).commonAncestorContainer).closest("table.md-table").length && !1 === n.tableEdit.keydownHandler(e)) return !1;
                                if (e.ctrlKey || e.metaKey) {
                                    if (File.isMac && e.metaKey && ("Up" == keyNames[t] || "Down" == keyNames[t])) return "Up" == keyNames[t] ? n.selection.jumpTop(e.shiftKey) : n.selection.jumpBottom(e.shiftKey), !1;
                                    if (e.target.classList && e.target.classList.contains("md-def-name") && "Right" === keyNames[t]) return n.selection.jumpIntoElemEnd($(e.target).closest("[mdtype]")), !1
                                }
                                if (File.isMac && e.metaKey) {
                                    var c = {};
                                    $.extend(c, e), c.type = "keyup", setTimeout(function () {
                                        $(e.target).trigger(c)
                                    }, 10)
                                }
                                e.shiftKey && $(".md-focus .md-math-after-sym").text("​"), "Right" == keyNames[t] || "Left" == keyNames[t] ? (n.lastCursor = n.selection.buildUndo(), n.brush.isAutoCompleteShown() && n.brush.triggerAutoComplete(), !e.shiftKey && n.selection.moveLeftOrRight("Left" == keyNames[t], e)) : "Up" != keyNames[t] && "Down" != keyNames[t] || (n.lastCursor = n.selection.buildUndo(), n.brush.isAutoCompleteShown() ? e.shiftKey ? n.brush.hideAutoComplete() : n.brush.changeAutoCompleteSelection("Up" == keyNames[t], e) : !e.shiftKey && n.selection.moveUpOrDown("Up" == keyNames[t], e))
                            }
                            if (!r) {
                                if ("Esc" == keyNames[t]) {
                                    if ($("#table-insert-dialog:visible").modal("hide").length) return void $(File.editor.sessionStr).trigger("cursorChange");
                                    n.brush.autoCompleteShown_ ? n.brush.hideAutoComplete() : n.brush.triggerAutoComplete(!0), e.preventDefault()
                                } else if ("Tab" == keyNames[t]) {
                                    if (e.metaKey || e.ctrlKey || e.altKey) return;
                                    e.preventDefault();
                                    if (!(e.shiftKey ? UserOp.lessIndent(n) : UserOp.moreIndent(n))) {
                                        (p = n.getMarkElem()).hasClass("md-def-link");
                                        if (p.closest(".md-table").length) n.tableEdit.moveToNextCell(!0, e.shiftKey); else if (p.hasClass("md-def-link") || p.hasClass("md-def-footnote")) {
                                            var u = n.getJQueryElem(window.getSelection().anchorNode).closest("span[contenteditable]");
                                            e.shiftKey ? n.selection.selectAllElem($(u.prevAll("span[contenteditable='true']")[0])) : n.selection.selectAllElem($(u.nextAll("span[contenteditable='true']")[0]))
                                        } else e.shiftKey || (n.selection.prepNode("\t", e), UserOp.insertInlineText(n, null, "\t", n.selection.getOffset(p), null, !0), n.refocus(), n.brush.addToQueue(n.focusCid))
                                    }
                                } else if ("Backspace" == keyNames[t] || "Delete" == keyNames[t]) {
                                    if (File.isNodeHtml) {
                                        var h = !0;
                                        if (o) e.preventDefault(); else if (o = !0, e.ctrlKey && (n.selection.getRangy() || {}).collapsed ? UserOp.backspaceHandler(n, e, keyNames[t]) : h = UserOp.backspaceHandler(n, e, keyNames[t], !1, !0), null === h) {
                                            o = !1;
                                            var f = n.focusCid || n.getMarkElem().attr("cid");
                                            n.undo.snap(f, SnapFlag.DELETE), n.brush.addToQueue(n.focusCid)
                                        } else e.preventDefault(), setTimeout(function () {
                                            o = !1
                                        }, 20)
                                    } else {
                                        if (e.metaKey) {
                                            var p;
                                            (p = n.getMarkElem(window.getSelection().commonAncestorContainer)).hasClass("md-expand");
                                            p.addClass("md-expand"), window.getSelection().modify("extend", "backward", "lineboundary")
                                        }
                                        UserOp.backspaceHandler(n, e, keyNames[t])
                                    }
                                    e.stopPropagation()
                                } else if ("Enter" == keyNames[t] || File.isMac && !e.shiftKey && !e.metaKey && e.ctrlKey && "O" == String.fromCharCode(t)) {
                                    if (n.brush.isAutoCompleteShown() && document.querySelector(".auto-suggest-container .active")) return n.brush.applyAutocompleteByKey(), void e.preventDefault();
                                    if (1 == $(".ty-focusable-btn.selected").length) {
                                        var m;
                                        if ((m = n.selection.getRangy()).startContainer.classList && m.startContainer.classList.contains("ty-focusable-btn")) return $(m.startContainer).trigger("btn-action"), void e.preventDefault();
                                        $(".ty-focusable-btn.selected").trigger("btn-action")
                                    }
                                    pressReturn.call(n, e.metaKey || e.ctrlKey, e.shiftKey), e.preventDefault(), e.stopPropagation()
                                }
                                i && t == this.lastKey && [224, 17, 91, 93].indexOf(t) > -1 && this.lastKeyTime && performance.now() - this.lastKeyTime < 300 ? (e.preventDefault(), n.refocus(void 0, !0), this.lastKey = 0) : (this.lastKey = e.keyCode, this.lastKeyTime = performance.now()), i = !1
                            }
                        }
                    } else r || n.isIME || l || (l = 1, d())
                }).on("keypress", function (e) {
                    var t = e.keyCode || e.which;
                    if (File.isLocked && e.charCode > 0) return e.ctrlKey || e.metaKey;
                    if (!isInputComponent(e.target) && !KeyMaster.isCommand(e)) if ("Enter" == keyNames[t]) e.preventDefault(); else if (e.charCode > 0 && window.getSelection().rangeCount) {
                        n.lastKeyPressOn = new Date, n.selection.prepNode(String.fromCharCode(e.charCode), e);
                        var i = n.getMarkElem().attr("cid");
                        i != n.focusCid && n.refocus(i), n.brush.addToQueue(n.focusCid)
                    }
                }).on("keyup", function (e) {
                    i = !0;
                    var t = e.keyCode || e.which;
                    "CTRL" != keyNames[t] && "Command" != keyNames[t] || a(!1), isInputComponent(e.target) || ("Right" == keyNames[t] || "Left" == keyNames[t] || "Up" == keyNames[t] || "Down" == keyNames[t] ? !(r = e.shiftKey) && !n.isIME && !e.metaKey && n.refocus() : r && "Shift" == keyNames[t] ? (r = !1, !n.isIME && !e.metaKey && n.refocus()) : "Enter" == keyNames[t] && function () {
                        var t = $("#write .md-focus");
                        if (0 == t.length) {
                            var i = n.selection.getRangy();
                            if (!i) return;
                            t = $(i.startContainer).closest("[cid]"), t = $("[cid='" + t.attr("cid") + "']")
                        }
                        t.length > 1 && t.get(0).getAttribute("cid") === t.get(1).getAttribute("cid") ? (t.filter(function (e) {
                            return e > 0
                        }).remove(), n.selection.jumpIntoElemEnd($(t.get(0))), pressReturn.call(n, File.isMacOrMacNode ? e.metaKey : e.ctrlKey, e.shiftKey)) : t.next("div:not('[mdtype]')").remove().length && pressReturn.call(n, File.isMacOrMacNode ? e.metaKey : e.ctrlKey, e.shiftKey)
                    }())
                }).on("compositionend", c).on("compositionstart", d).on("compositionupdate", function () {
                }).on("input", function (i) {
                    n.selection.clearGlobalColumn(), isInputComponent(i.target) || ((!i.originalEvent || "insertCompositionText" != i.originalEvent.inputType) && l > 0 ? (l = 0, c()) : n.brush.addToQueue(n.focusCid), i.originalEvent && n.UserOp.PunctuationOp.clearLastQuoteState(), n.focusCid && (e && (clearTimeout(e), e = null), t && n.focusCid != t && r(t), t = n.focusCid, e = setTimeout(function () {
                        r(t), t = null, e = null
                    }, 200)));

                    function r(e) {
                        n.syncChange([{type: "sync", id: e, html: n.findElemById(e).html()}])
                    }
                })
            }, setCurLinkElem: function (e) {
                $curLinkElem = e
            }, tryOpenLink: function (e, t) {
                if (t && (e = $curLinkElem), e.length) {
                    var n = e.attr("href"),
                        i = $.localize.getString("Need to define the reference link <b>[{0}]</b> with syntax <b>[{1}]: www.example.com</b>");
                    if (this.undo.completeSnap(!0), e.hasClass("md-def-url")) this.tryOpenUrl_(e.text()); else if (e[0].hasAttribute("data-ref")) {
                        var r = e.data("ref");
                        if (void 0 === (n = this.nodeMap.link_list.getHrefByRef(r, !0))) return EditHelper.showNotification(i.format(r, r), "warning"), !File.isLocked && this.docMenu.addEmptyDef(r, NodeDef.TYPE.def_link), !1;
                        if ("" === n) return EditHelper.showNotification(i.format(r, r), "warning"), !1
                    }
                    n && this.tryOpenUrl_(n, e.closest("[md-inline='autolink'], [md-inline='url']").length)
                }
            }, tryOpenUrl_: function (e, t) {
                function n(e) {
                    var t = reqnode("path").extname(e);
                    [".md", ".markdown", ".mmd", ".text", ".txt", ".mdown"].indexOf(t) > -1 ? electron.app.openFileOrFolder(e, {
                        forceCreateWindow: !0,
                        mountFolder: File.getMountFolder()
                    }) : electron.shell.openItem(a)
                }

                var i = e;
                if (e.match(/^#/)) {
                    var r = EditHelper.findAnchorElem(e);
                    this.selection.jumpIntoElemBegin(r), this.selection.scrollAdjust(r, 10)
                } else {
                    if (StringUtils.isFullUrl(e)) {
                        if (File.isNode && /^file:/.exec(e)) try {
                            e = decodeURI(e)
                        } catch (e) {
                        }
                    } else {
                        if (e = e.replace(/([#?][^.]+)$/, ""), File.isMac && window.app.path.openURL(decodeURIComponent(e), (FileHelper.getCurrentFileFolderPath() || "") + "/")) return;
                        if (File.isNode) {
                            var o = reqnode("fs-plus"),
                                a = reqnode("path").resolve(FileHelper.getCurrentFileFolderPath() + "/", decodeURIComponent(e));
                            if (o.isFileSync(a)) return void n(a);
                            if (o.isFileSync(a + ".md")) return void n(a + ".md");
                            if (o.isFileSync(a + ".markdown")) return void n(a + ".markdown")
                        }
                        if (!t) return EditHelper.showNotification($.localize.getString("Cannot open location <code>$1</code>, do you mean <a href='https://$3'>https://$2</a> ? ").replace("$3", StringUtils.escapeForPreWrap(i)).replace("$2", StringUtils.escape(i)).replace("$1", StringUtils.escape(a || i)) + "<a href='http://support.typora.io/Links#faq' class='default-btn'>" + $.localize.getString("Learn More…") + "</a>"), !1;
                        e = /^[A-Za-z.+-]+:/.exec(i) ? i : "http://" + i
                    }
                    File.isNode ? reqnode("electron").shell.openExternal(e) : window.open(e)
                }
            }, _bindMouseEvents: function () {
                var e = this, t = !1;
                var n = '.footnotes, [mdtype="table"], .md-task-list-item, .md-image';
                window.addEventListener("mouseup", function (t) {
                    e.isMousePressed && 1 === t.which && e.brush.expandOnDelay(), e.isMousePressed = !1
                }), $(this.sessionStr).on("mouseenter", ".md-htmlblock-container", function (t) {
                    if (1 == t.which && File.isNodeHtml) {
                        var n = e.selection.getRangy();
                        !n || this == n.commonAncestorContainer || this.contains(n.commonAncestorContainer) || n.commonAncestorContainer.contains(this) || this.parentElement.classList.contains("md-rawblock-on-edit") || -1 == n.comparePoint(this.parentElement, this.parentElement.childNodes.length) && (this.parentElement.setAttribute("contenteditable", "true"), n.setStartBefore(this), n.select())
                    }
                }).on("mouseover mouseleave", n, function (e) {
                    1 == e.which && $(this).attr("contenteditable", !0)
                }).on("mouseover mouseleave", ".td-span", function (e) {
                    1 == e.which && $(this).closest('[mdtype="table"]').attr("contenteditable", "true")
                }).on("mousedown", function (n) {
                    t = !1, e.selection.clearGlobalColumn();
                    var i = document.body.classList;
                    (i.contains("ty-show-word-count") || i.contains("ty-show-spell-check")) && (i.remove("ty-show-word-count"), i.remove("ty-show-spell-check")), File.isNode && i.contains("typora-fullscreen") && i.contains("native-window") && electron.getCurrentWindow().setMenuBarVisibility(!1);
                    var r;
                    if ("UL" == n.target.tagName) if ((r = e.getMarkElem(n.target)).attr("mdtype") == TYPE.list) {
                        var o = document.caretRangeFromPoint(r.find("li").offset().left + 1, n.clientY);
                        setTimeout(function () {
                            e.selection.setRange(o)
                        }, 10), r = $(o.startContainer).closest("[cid]")
                    } else r = null;
                    if (File.inBusyMode || r) {
                        r = r || e.getMarkElem(n.target), !n.shiftKey && r.length ? setAttributeOnlyNeeded(e.writingArea, "contenteditable", "false") : (r.hasClass("md-focus") || (document.querySelectorAll(".md-focus").forEach(function (e) {
                            e.classList.remove("md-focus")
                        }), setAttributeOnlyNeeded(e.writingArea, "contenteditable", "true")), r.length);
                        var a = r.attr("mdtype");
                        !r.length || Node.canContainBlock(a, !0) || Node.isType(a, TYPE.fences, TYPE.hr, TYPE.def_link, TYPE.def_footnote, TYPE.math_block) || (r.hasClass("md-focus") || r.addClass("md-focus"), setAttributeOnlyNeeded(r[0], "contenteditable", "true"))
                    }
                    var s = $(n.target);
                    if (Node.isType(s.attr("mdtype"), TYPE.paragraph, TYPE.heading) && s.find(".md-math-after-sym").last().text("​"), $(".dropdown-menu.open:not(#typora-sidebar), .dropdown-menu.show").removeClass("open").removeClass("show").find(".active").removeClass("active"), s.closest("a").length && !s.closest("img").length && (File.isMacOrMacNode ? n.metaKey : n.ctrlKey)) return n.stopPropagation(), n.preventDefault(), !1;
                    s.closest(".md-fences:not(.CodeMirror)").length, e.lastCursor = e.selection.buildUndo(), e.isMousePressed = 1 === n.which
                }).on("click", "[md-inline='link']>.md-content, .md-def-url", function (t) {
                    if (t.ctrlKey || t.metaKey) return e.tryOpenUrl_($(this).text()), !1
                }).on("mousemove", function (n) {
                    t = !0, 1 == n.which && File.inBusyMode && e.selection.handleMouseSelection(n)
                }).on("click", function (t) {
                    (t.originalEvent || t).detail;
                    var n = e.getMarkElem(t.target);
                    if (e.docMenu.autoHideOutline(), e.brush.isAutoCompleteShown() && e.brush.triggerAutoComplete(), e.searchPanel.isOpen() && e.searchPanel.closePanel(!0), "INPUT" !== t.target.tagName || "checkbox" !== t.target.getAttribute("type")) {
                        if (isInputComponent(t.target) || t.target.classList && t.target.classList.contains("code-tooltip")) return t.preventDefault(), void $(t.target).trigger("focus");
                        if (n.hasClass("md-fences") && e.fences.clickEventHandled.call(e.fences, t, n.attr("cid"))) return !1;
                        var i = $(t.target).closest("a");
                        if (i.length) {
                            if (t.stopPropagation(), t.preventDefault(), (File.isMacOrMacNode ? t.metaKey : t.ctrlKey) || File.isLocked || i.closest(".md-htmlblock-container").length) return e.tryOpenLink(i), !1;
                            var r = $(t.target).closest(".md-image"), o = r.closest('[md-inline="link"]');
                            (o.length ? o : r).addClass("md-expand")
                        }
                        var a = e.findNodeByElem(n);
                        Node.isType(a, NodeDef.TYPE.paragraph, NodeDef.TYPE.heading) && $(".md-tooltip-remove").remove();
                        var s = e.selection.getRangy();
                        return s && s.commonAncestorContainer == e.writingArea && !s.collapsed ? (t.stopPropagation(), !1) : void 0
                    }
                }).on("dblclick", function (t) {
                    if (function (t) {
                        var n = $(t.target).closest("[md-inline='image'],[md-inline='imgtag']");
                        if (n.length) {
                            if ("image" == n.attr("md-inline")) {
                                var i = e.selection.getRangy(), r = $(t.target);
                                if (r.hasClass("md-image-src-span") || (r = r.closest(".md-image-src-span")), r.length) {
                                    if (i) {
                                        var o = (r.text().match(/\s['"]/) || {}).index;
                                        if (i.setStart(r[0], 0), o) {
                                            if (i.endOffset > o) return !0;
                                            i.setEnd(r[0].childNodes[0], o)
                                        } else i.setEnd(r[0], 1);
                                        return e.selection.setRange(i), !0
                                    }
                                } else r = $(t.target).closest(".md-content");
                                if (r.length && i) {
                                    var a = r.text(), s = a.indexOf("]") + 2;
                                    if (i.startOffset > s) return i.setStart(r[0].childNodes[0], s), i.setEnd(r[0].childNodes[0], a.length - 1), i.select(i.isBackward), !0;
                                    if (i.startOffset >= 2 && i.endOffset > i.startOffset && i.endOffset < s - 1) return i.setStart(r[0].childNodes[0], 2), i.setEnd(r[0].childNodes[0], s - 2), i.select(i.isBackward), !0
                                }
                                return e.selection.selectAllElem(n), !0
                            }
                            if ("IMG" == t.target.tagName) e.selection.selectAllElem(n)
                        }
                    }(t), File.isMac && !/\S\s+\S/.exec(window.getSelection().toString())) return e.selection.selectWord(!1), !1
                }).on("mouseup", function (i) {
                    if (e.isMousePressed = !1, !File.isLocked && !isInputComponent(document.activeElement) && !isInputComponent(i.target)) {
                        $(n + ", .md-rawblock").filter(function () {
                            return !(this == i.target || this.contains(i.target)) && "false" != this.getAttribute("contenteditable")
                        }).attr("contenteditable", "false");
                        var r = e.selection.getRangy();
                        r && !r.collapsed && Node.isType(r.commonAncestorContainer.tagName, "LI", "UL", "QUOTEBLOCK", "ARTICLE") && e.refocus(null);
                        var o = r ? r.commonAncestorContainer : i.target;
                        if (o == e.writingArea || e.writingArea.contains(o)) {
                            var a = e.getMarkElem(i.target), s = a[0],
                                l = s && !s.querySelector("[cid]") ? s.getAttribute("cid") : void 0;
                            if (a.closest(".md-fences:not(.CodeMirror)").length && e.fences.focus(s.getAttribute("cid")), !a.length && i.target == e.writingArea && (!t || !r || r.collapsed)) try {
                                var c = e.nodeMap.getLast(), d = e.findElemById(c.cid);
                                if (i.pageY - d.offset().top - d.height() > 0) {
                                    if (Node.isType(c, TYPE.paragraph, TYPE.heading)) e.selection.jumpIntoElemEnd(e.findElemById(c.getVeryFirst(!0).cid)), a = d; else {
                                        var u = UndoManager.makeEmptyCommand(e.selection.buildUndo()),
                                            h = e.selection.addUnholdable(c, u), f = e.findElemById(h.cid);
                                        e.undo.register(u), e.selection.jumpIntoElemBegin(f), a = f
                                    }
                                    a.length && File.inBusyMode && (setAttributeOnlyNeeded(e.writingArea, "contenteditable", "false"), a[0].focus()), e.refocus(a.attr("cid")), i.stopPropagation()
                                }
                            } catch (e) {
                            }
                            try {
                                clearTimeout(clickTimer), "BODY" == document.activeElement.tagName ? clicks = 0 : window.getSelection().toString().length ? (clicks = 0, p()) : 1 === clicks ? (clicks = 0, p()) : 0 === clicks && (clickTimer = setTimeout(function t() {
                                    e.isMousePressed ? clickTimer = setTimeout(t, DBCLICK_DELAY) : (clicks = 0, p())
                                }, DBCLICK_DELAY), clicks++), function () {
                                    var t = e.writingArea.querySelector(".unholdable");
                                    if (t && t.getAttribute("cid") != e.focusCid) if (t.textContent.length) fastdom.mutate(function () {
                                        t.classList.removeClass("unholdable")
                                    }); else {
                                        var n = UndoManager.makeEmptyCommand(e.selection.buildUndo()),
                                            i = e.getNode(t.getAttribute("cid"));
                                        e.undo.UndoManager.addUndoForRemove(n, i), n.redo.push(e.selection.buildUndo()), i.remove(), t.remove(), e.undo.register(n)
                                    }
                                }()
                            } catch (e) {
                                console.warn(e.stack)
                            }
                            File.isLocked || File.inBusyMode || setAttributeOnlyNeeded(e.writingArea, "contenteditable", "true")
                        }
                    }

                    function p() {
                        File.isTypeWriterMode && File.option.scrollWithCursor ? e.selection.typeWriterScroll(null, null, function () {
                            e.refocus(l)
                        }) : e.refocus(l)
                    }
                }), $(document).on("mouseup", function (t) {
                    isInputComponent(t.target) || "SELECT" == t.target.tagName || isInputComponent(document.activeElement) || (0 == $(t.target).closest("#write").length && (window.getSelection().toString().length && (clicks = 0), File.isLocked || File.inBusyMode || setAttributeOnlyNeeded(e.writingArea, "contenteditable", "true"), fastdom.mutate(function () {
                        $(".md-tooltip-hide").hide()
                    })), $(t.target).closest(".context-menu").length || e.contextMenu && e.contextMenu.hide())
                });
                var i, r = function () {
                    i && clearTimeout(i), i = setTimeout(exitFocusMode.bind(e), 500)
                }, o = document.querySelector("content");
                o.addEventListener("wheel", function (t) {
                    Math.abs(t.deltaY) < 4 || e.lazyFireEvent_(o, "post-wheel", 500)
                }, !!File.option.passiveEvents && {passive: !0}), o.addEventListener("scroll", function () {
                    if (File.preventScroll) return !1
                }), o.addEventListener("scroll", function (t) {
                    e.isMousePressed && File.isFocusMode && File.isTypeWriterMode && r(), e.lazyFireEvent_(o, "post-scroll")
                }, !!File.option.passiveEvents && {passive: !0});
                var a;
                o.addEventListener("mousedown", function (e) {
                    a = e.target
                }), o.addEventListener("click", function (t) {
                    if (t.target == o || t.target == e.writingArea) a == t.target && e.forceClick(t); else if (t.target.hasAttribute && t.target.getAttribute("mdtype") == TYPE.paragraph) {
                        if (a !== t.target) return void(a = null);
                        var n = e.selection.getRangy(), i = t.target, r = n.commonAncestorContainer;
                        if (r && r.classList && r.classList.contains("MathJax_SVG") || i != n.startContainer && i != n.endContainer && !i.contains(n.startContainer) && !i.contains(n.endContainer)) {
                            if (!i || !i.lastElementChild) return;
                            t.clientX > i.lastElementChild.getBoundingClientRect().right && e.selection.jumpIntoElemEnd($(i))
                        }
                    }
                    a = null
                }), $(o).on("post-scroll", function () {
                    $(".auto-suggest-container, .autoComplt-list").hide()
                }).on("post-wheel", function () {
                    File.isFocusMode && File.isTypeWriterMode && r()
                })
            }, forceClick: function (e) {
                function t(t, i) {
                    i ? n.selection.jumpIntoElemEnd(t) : n.selection.jumpIntoElemBegin(t), e.preventDefault(), e.stopPropagation()
                }

                var n = this, i = n.selection.getRangy();
                if (!(i && i.startContainer && $(i.startContainer.parentElement).offset().top > e.clientY - 30)) {
                    File.isLocked || setAttributeOnlyNeeded(n.writingArea, "contenteditable", "true");
                    for (var r, o = window.innerHeight, a = document.querySelector("#write > *").getBoundingClientRect(), s = e.pageX > a.right - 2, l = e.pageX < a.left + 2, c = (a.left + a.right) / 2, d = e.pageY; d < o; d += 20) if (!(r = $(document.elementFromPoint(c, d))).find("[mdtype]").length && r.closest("[mdtype]").addBack("[mdtype]").length) return t(r, s), n.refocus(r.attr("cid")), void(File.inBusyMode && r.focus());
                    for (d = e.pageY; d > 0; d -= 20) if (!(r = $(document.elementFromPoint(c, d))).find("[mdtype]").length && r.closest("[mdtype]").addBack("[mdtype]").length) return t(r, !l), n.refocus(r.attr("cid")), void(File.inBusyMode && r.focus())
                }
            }, lazyFireEvent_: function (e, t, n) {
                var i = this.timerPool_, r = this.timerPool_[t];
                n = n || 100, r && clearTimeout(r), r = setTimeout(function () {
                    $(e).trigger(t), i[t] = null
                }, 100)
            }, simpleParse: function (e, t) {
                var n = Node.isType(e, TYPE.paragraph);
                if (Node.isType(e, TYPE.raw_edit, TYPE.paragraph) && /(^[<\u2013\u2014`~>#|\-+*1-9=\[])|\n\s*\S/gm.test(e.safeGetStrAttr("text"))) {
                    this.brush.pause();
                    var i, r, o = this.undo.UndoManager.makeEmptyCommand();
                    return o.undo.push(this.selection.buildUndo()), o.undo.push(UndoManager.buildReplaceUndo(e)), i = e.parseFrom(t ? {
                        skips: {
                            enableStartMatch: !0,
                            enableRemap: !0
                        }
                    } : {skips: {enableRemap: !0}}), n && Node.isType(e, TYPE.paragraph) && 1 == i[1].length ? (this.brush.restart(), null) : (o.redo.push(this.undo.buildReplaceUndo(i[1][0])), UndoManager.addUndoForInsertArray(o, i[1].slice(1)), r = i[0], this.brush.restart(), [o, r, e.cid, i[1]])
                }
            }, findElemById: function (e) {
                return e ? $(this.writingArea.querySelector('[cid="' + e + '"]')) : $()
            }, findNodeByElem: function (e) {
                return e.length ? this.getNode(e.attr("cid"), !1) : null
            }, beforeInsertTextFromCandidate: function (e) {
                var t = !1, n = {
                    preventDefault: function () {
                        t = !0
                    }
                };
                return this.selection.prepNode(e, n), !t
            }, replaceText: function (e, t, n, i, r, o) {
                try {
                    if (this.sourceView.inSourceMode || isInputComponent(document.activeElement)) return "SmartReplace" != o;
                    if (document.activeElement.contains(this.writingArea) && !this.writingArea.contains(document.activeElement)) return !1;
                    var a, s, l, c, d, u, h, f = this.selection.rangy.createRange(), p = this.selection.getRangy(),
                        m = 0;
                    if (f.setStart(t, n), f.setEnd(i, r), t && t.hasAttribute && t.hasAttribute("cid") && !t.querySelector("cid") && $(t).find("br").remove(), this.isIME) return this.selection.deRange(f, !0), !0;
                    if (e.match(/\n/) || "WebViewInsertActionPasted" == o || "WebViewInsertActionDropped" == o) return UserOp.pasteHandler(this, e, !0), !1;
                    if (l = this.getJQueryElem(f.commonAncestorContainer), "SmartReplace" == o) return !File.option.convertSmartOnRender && (/[–—…]/.exec(e) ? File.option.smartDash && this.UserOp.PunctuationOp.shouldTriggerReplace(this, f) : File.option.smartQuote && this.UserOp.PunctuationOp.shouldTriggerReplace(this, f));
                    if (!p.collapsed) return UserOp.pasteHandler(this, e, !0), !1;
                    if (c = l.closest("[cid]"), !(d = c.attr("cid"))) return !1;
                    if (u = p.getBookmark(c[0]), f.collapsed) {
                        var g;
                        return 1 != e.length || !(g = this.UserOp.hanldePair(this, e, this.getNode(d), u, void 0, f)) || (this.undo.register(g), !1)
                    }
                    var v = function () {
                        this.undo.snap(d, SnapFlag.REPLACE, void 0, !0), h = e.length - f.toString().length, f.deleteContents(), f.insertNode(document.createTextNode(e)), u.start += h, u.end += h, p.moveToBookmark(u), this.selection.setRange(p), this.brush.addToQueue(d)
                    };
                    if (f.commonAncestorContainer == p.commonAncestorContainer && p.startOffset - f.endOffset >= 0 && p.startOffset - f.endOffset <= 2 || p.equals(f)) return v.call(this), !1;
                    (s = this.selection.rangy.createRange()).setEnd(p.startContainer, p.startOffset), s.setStart(f.endContainer, f.endOffset), a = s.toString();
                    var y = function (e) {
                        this.selection.deRange(e);
                        var t = $(e.startContainer).closest(".md-meta"), n = $(e.endContainer).closest(".md-meta");
                        e.collapsed || !t.length && !n.length || m > 3 || t[0] != n[0] && (t.length && e.setStartAfter(t[0]), n.length && e.setEndBefore(n[0]), m++, y.call(this, e))
                    };
                    a.length && a.replace(/[*_\s\]]/g, "").length < 2 && (y.call(this, f), v.call(this))
                } catch (a) {
                    Reporter.error(a, {extra: {argv: [e, t, n, i, r, o]}})
                }
                return !1
            }, finishRawBlockEdit: function (e) {
                var t = null,
                    n = (t = e ? $(e.target).closest(".md-rawblock") : $(document.activeElement).closest(".md-rawblock")).attr("mdtype");
                n == TYPE.html_block && this.htmlBlock.stopEditing(t.attr("cid"), !0), n == TYPE.math_block && this.mathBlock.stopEditing(t.attr("cid"), !0), $(".ty-tooltip").removeClass("shown")
            }, getMarkdown: function (e) {
                if (this.sourceView.inSourceMode) return this.sourceView.cm.getValue();
                var t = this.nodeMap.toMark();
                return e ? t.replace(/\n+$/, "") : t
            }, getNode: function (e, t) {
                return t && !(e = e || this.focusCid) && (e = this.refocus()), this.nodeMap.get("allNodes").get(e)
            }, restoreLastCursor: function (e, t) {
                if (e && e.preventDefault(), this.lastCursor) {
                    if (document.activeElement != this.writingArea) {
                        var n = $("content").scrollTop();
                        this.writingArea.focus(), $("content").scrollTop(n)
                    }
                    this.undo.exeCommand(this.lastCursor, t ? [] : void 0)
                }
            }, toggleFocusMode: function () {
                File.isFocusMode = !File.isFocusMode;
                (electron ? electron.app : window.app).setting.put("isFocusMode", File.isFocusMode), this.updateFocusMode(File.isFocusMode, !0, !0)
            }, updateFocusMode: function (e, t, n) {
                e ? enterFocusMode.call(this) : exitFocusMode.call(this);
                var i = electron ? electron.app : window.app;
                t && (File.isNode ? window.ClientCommand.refreshViewMenu() : File.isMac && i.menu.getItem("View").submenu().getItem("Focus Mode").setState(File.isFocusMode)), i && e && n && !i.setting.get("noWarnigForFocusMode") && EditHelper.showFocusModeWarning()
            }, setTypeWriterMode: function (e, t, n) {
                if (File.isTypeWriterMode != e || t) {
                    File.isTypeWriterMode = e;
                    if (e) {
                        document.body.classList.add("ty-on-typewriter-mode");
                        var i = (document.querySelector("content").clientHeight - this.defaultTextHeight) / 2;
                        document.querySelector("#write-style").innerHTML = "#write { \npadding-top: $1px;\npadding-bottom: 0;\n}\n#write:after {\nheight: $2px;\n}".replace(/\$1/g, i - this.defaultTextHeight).replace(/\$2/g, i + this.defaultTextHeight), File.editor.sourceView && File.editor.sourceView.inSourceMode || this.selection.typeWriterScroll(null, null)
                    } else t || (document.querySelector("#write-style").innerHTML = 0, document.body.classList.remove("ty-on-typewriter-mode"), this.selection.scrollAdjust());
                    File.editor.sourceView.enableTypeWriterMode(e), t || (File.isNode ? window.ClientCommand.refreshViewMenu() : File.isMac && r.menu.getItem("View").submenu().getItem("Typewriter Mode").setState(File.isTypeWriterMode))
                }
                var r = electron ? electron.app : window.app;
                e && n && !r.setting.get("noWarnigForTypeWriterMode") && EditHelper.showTypeWriterModeWarning()
            }, toggleTypeWriterMode: function (e) {
                void 0 === e && (e = !File.isTypeWriterMode), this.setTypeWriterMode(e, !1, !0);
                (electron ? electron.app : window.app).setting.put("isTypeWriterMode", e)
            }, syncFullContent: function () {
                var e = File.editor.sourceView.inSourceMode || !1;
                File.isMac ? app.controller.syncFullContent(e) : File.isNode && File.isActiveWindow() && File.getCurrentDocByNode().syncFullContent(e)
            }, applyFullContent: function (e) {
                if (!File.isActiveWindow()) {
                    var t = File.isMac ? app.document.content : File.getCurrentDocByNode().getContent();
                    if (void 0 === t) return;
                    this.undo.exeCommand({type: "sync", content: t, fromSourceMode: e}, void 0, !0), this.refresh()
                }
            }, syncChange: function (e) {
                function t(e, t) {
                    return e.map(function (e) {
                        return e ? "fences" == e.type ? null : e : null
                    }, t)
                }

                if (e) if (File.isMac) app.controller.shouldTriggerSyncChange() && (scheduleFullContentSync(), app.document.syncChange(JSON.stringify(t(e, this)))); else if (File.isNode) {
                    var n = File.getCurrentDocByNode();
                    File.shouldTriggerSyncChange() && (scheduleFullContentSync(), n.syncChange(t(e, this) || []))
                }
            }, applyChange: function (e) {
                try {
                    if (!e || File.isActiveWindow()) return;
                    var t = "string" == typeof e ? JSON.parse(e) : e, n = !1;
                    window.debugMode && (i = t[0]) && ("sync" != i.type ? i.type : void 0 !== i.html || void 0 !== i.allHtml || void 0 !== i.cmChanges || void 0 !== i.tex || void 0 !== i.srcChanges || i.content), t.forEach(function (e) {
                        n = this.undo.exeCommand(e, void 0, !0) || n
                    }, this), n && this.refresh()
                } catch (e) {
                    console.error(e)
                }
                var i
            }, startScrolling: function (e) {
                this.strollingBySelect = !0;
                var t = $("content"), n = t[0].scrollHeight - window.innerHeight, i = e ? 0 : n;
                t.stop(!0).animate({scrollTop: i}, Math.abs(i - t.scrollTop()) / 256 * 1e3, "linear")
            }, stopScrolling: function () {
                this.strollingBySelect && ($("content").stop(!0), this.strollingBySelect = !1)
            }, onDropContent: function (e, t) {
                if (!File.isMac || !File.isActiveWindow()) return dropContents = null, !1;
                if (t && this.selection.setRange(t), dropContents) {
                    var n, i = dropContents.urls || [], r = dropContents.folders || [];
                    r.length ? (r.map(function (e) {
                        app.controller.openFolder(e)
                    }), File.getMountFolder() && File.editor.library.showSidebar("files")) : app.document.isLocked() || i.map(function (e, t) {
                        try {
                            if ((n = e.match(/(?:^|\.)([^.]+)$/)) && (n = n[1], ~["txt", "text", "latex", "ltx", "tex", "wiki", "dokuwiki", "docx", "rst", "rest", "org", "textile", "opml", "md", "mmd", "markdown", "mdown", "multimarkdown", ""].indexOf(n))) return app.app.openInTypora(e), !1;
                            t > 0 && editor.UserOp.insertParagraph(!1, editor), handlerFileInsert(e)
                        } catch (e) {
                            console.warn(e)
                        }
                    })
                } else UserOp.insertDom(e)
            }
        }), syncTimer, doSync = function () {
            editor.syncFullContent(), syncTimer = null
        }, scheduleFullContentSync = function () {
            syncTimer && clearTimeout(syncTimer), syncTimer = setTimeout(doSync, 500)
        };
        Editor.prototype.scheduleFullContentSync = scheduleFullContentSync;
        var pressReturn = function (e, t) {
            this.brush.hideAutoComplete(), this.undo.completeSnap(!0);
            var n = this.getMarkElem();
            if (this.brush.brushNode(n.attr("cid")), n = this.getMarkElem(), Node.isType(n.attr("mdtype"), NodeDef.TYPE.fences, NodeDef.TYPE.footnote)) return !0;
            this.brush.pause(), r = o = UserOp.backspaceHandler(this, null, "delSelection", !0, !1);
            var i, r, o, a = (n = this.getMarkElem()).closest(".md-table").length, s = a, l = this, c = n.attr("cid"),
                d = this.store(c);
            if (File.isTypeWriterMode && this.selection.lockScroll(), function (i) {
                if (n.attr("mdtype") == NodeDef.TYPE.meta_block) try {
                    var r = i.selection.getRangy();
                    return !(!e && !t && r.collapsed && r.endContainer.textContent.replace(/\n$/, "").length <= r.endOffset && r.endContainer.textContent.match(/\n{2,}$/g))
                } catch (e) {
                    return !0
                }
                return !1
            }(this)) (r = r || UndoManager.makeEmptyCommand()).undo.push(this.selection.buildUndo()), UserOp.insertInlineText(this, null, "\n", this.selection.getOffset(n), r, !0), this.undo.register(r), this.brush.addToQueue(c); else if (function (e) {
                var t = e.getNode(c);
                if (Node.isType(t, TYPE.def_link, TYPE.def_footnote) && Node.isEmptyBlock(t)) return !0
            }(this)) r = this.UserOp.backToParagraph(l, this.getNode(c), !0, !1), o && (r = UndoManager.append(o, r)), this.undo.register(r); else if (a) if (t) this.UserOp.pasteHandler(this, "<br />", !0); else if (e) r = this.tableEdit.addRow(!1, o), o && (r = UndoManager.append(o, r), this.undo.register(r)); else {
                for (; o.undo.length;) this.undo.exeCommand(o.undo.pop());
                this.tableEdit.moveToBelowCell(!0)
            } else if (!s && d && (i = d.breakOn(e, this, t))) {
                var u, h = this.findElemById(i.oldCid), f = $.parseHTML(i.newHtml), p = [];
                if (f.length) {
                    var m = morphdom(h[0], f[0], {
                        getNodeKey: function (e) {
                            return e.getAttribute && e.getAttribute("cid")
                        }, onBeforeElUpdated: function (e, t) {
                            return (!e.classList.contains("md-fences") || !t.classList.contains("md-fences")) && ((!e.classList.contains("md-rawblock") || !t.classList.contains("md-rawblock")) && void 0)
                        }
                    });
                    (u = $(m)).after(f.subarray(1)), p = (p = [u]).concat(f.subarray(1))
                } else h.remove();
                if (Node.isType(this.getNode(i.nextFocus), TYPE.math_block)) i.command.redo.push({
                    type: "fences-pos",
                    id: i.nextFocus,
                    pos: {line: 0, ch: 0}
                }), setTimeout(function () {
                    l.mathBlock.startEditing(i.nextFocus, "begin")
                }, 0); else if (Node.isType(this.getNode(i.nextFocus), TYPE.html_block)) i.command.redo.push({
                    type: "fences-pos",
                    id: i.nextFocus,
                    pos: {line: 0, ch: 0}
                }), setTimeout(function () {
                    l.htmlBlock.startEditing(i.nextFocus, "auto")
                }, 0); else {
                    var g = this.findElemById(i.nextFocus);
                    i.cursor ? this.undo.exeCommand(i.cursor) : (this.selection.jumpIntoElemBegin(g), i.command.redo.push(this.selection.buildUndo()))
                }
                this.focusCid = this.refocus(i.nextFocus, void 0, void 0, !0), this.findElemById(i.nextFocus).addClass("md-focus"), o && (i.command = UndoManager.append(o, i.command)), this.undo.register(i.command), u && u.length ? p.forEach(function (e) {
                    this.refreshUnder(e[0], !1)
                }, this) : this.quickRefresh()
            }
            return (!i || !i.nextFocus) && this.refocus(), this.brush.resume(), this.selection.scrollAdjust(), !0
        }, normalCleanTooltip_ = function () {
            $(".md-tooltip-remove").remove(), $(".md-focus").removeClass("md-focus"), $(".md-focus-container").removeClass("md-focus-container");
            var e = document.body.classList;
            (e.contains("ty-show-word-count") || e.contains("ty-show-spell-check")) && (e.remove("ty-show-word-count"), e.remove("ty-show-spell-check"))
        }, viewInFocusMode = !1, exitFocusModeTimer, enterFocusMode = function () {
            exitFocusModeTimer && (clearTimeout(exitFocusModeTimer), exitFocusModeTimer = null), viewInFocusMode || (viewInFocusMode = !0, document.body.classList.add("on-focus-mode"))
        }, exitFocusMode = function () {
            viewInFocusMode && (viewInFocusMode = !1, document.body.classList.remove("on-focus-mode"))
        };

        function handlerFileInsert(e) {
            if (window.app) {
                if (app.document.isLocked()) return
            } else if (File.isLocked) return !1;
            File.editor.sourceView.inSourceMode || (editor.focusAndRestorePos(), File.editor.imgEdit.doInsertFromURL(e, File.isMac))
        }

        function performClick(e, t, n, i) {
            var r = document.createEvent("MouseEvents");
            r.initMouseEvent("mousedown", !0, !0, t.ownerDocument.defaultView, 1, e.screenX + n, e.screenY + i, e.clientX + n, e.clientY + i, e.ctrlKey, e.altKey, e.shiftKey, e.metaKey, e.button), t.dispatchEvent(r)
        }

        module.exports = Editor
    }), $__System.registerDynamic("47", ["e", "b", "c", "d", "f", "44", "42"], !0, function (e, t, n) {
        this || self;
        window.$ = e("e"), window.jQuery = window.$, window.fastdom = e("b"), window.fastdomPromised = e("c"), fastdom = fastdom.extend(fastdomPromised), fastdom.strict && fastdom.strict(!1), e("d"), e("f");
        var i = e("44"), r = e("42"), o = "Base";
        window.reqnode ? (window._options = reqnode("electron").remote.app.setting.buildOption(), o = window._options.userLocale) : window.app && (o = app.app.getLocale());
        var a = {language: o, pathPrefix: "locales"};
        if ($.localize.localeOption = a, $("[data-lg='Front'], [data-after-content], [ty-hint]").localize("Front", a), window.reqnode && window._options.sidebarTab && window.innerWidth > 540) {
            var s = document.querySelector("#typora-sidebar");
            s.classList.add("open"), s.style.transition = "0s", document.body.classList.add("pin-outline"), _options.sidebarWidth && document.documentElement.style.setProperty("--sidebar-width", _options.sidebarWidth + "px")
        }
        $.fn.rawText = function (e) {
            return this.length ? this[0].rawText(e) : ""
        };
        window.setWritingContent = function (e, t) {
            for (; e.lastChild;) e.removeChild(e.lastChild);
            var n = document.createElement("div");
            n.innerHTML = t;
            for (var i = document.createDocumentFragment(); n.firstChild;) i.appendChild(n.firstChild);
            e.appendChild(i)
        }, window.File = i, i.language = o, init = function () {
            var e = new r("#write", i);
            t = e, window.getMarkdown = function () {
                return t.getMarkdown()
            };
            var t;
            window.editor = e, setTimeout(function () {
                document.querySelector("#typora-sidebar").style.transition = "", $("[data-lg='Panel']").localize("Panel", a), i.isNode && $("[data-lg='Menu']").localize("Menu", a)
            }, 20)
        }, t.init = init, i.isNodeHtml || init()
    }), $__System.registerDynamic("48", ["11", "13", "12", "1a", "1b"], !0, function (e, t, n) {
        "use strict";
        this || self, e("11"), e("13");
        var i = e("12"), r = e("1a"), o = (r.SnapFlag, i.Node), a = i.TYPE, s = i.NodeCollectionUtils,
            l = (e("1b"), function (e, t) {
                if (t(e)) return e;
                var n = e.get("parent");
                return n ? l(n, t) : null
            }), c = function (e, t) {
                if (o.isType(e, a.list) && o.isType(e.get("before"), a.list) && e.get("style") == e.get("before").get("style")) return e.get("before").appendTillEnd(e.getFirstChild(), !0), e.remove(), t && t.remove.push(e.cid), !0
            };

        function d(e, t) {
            var n, i;
            if (!e) return e;
            if (o.isType(e.get("before"), a.list)) return e;
            if (!(n = l(e, function (e) {
                return o.isType(e.get("parent"), a.list_item)
            })) && t) for (i = t; i;) {
                if (i == e || i.contains(e)) return i;
                i = i.get("after")
            }
            return n
        }

        function u(e) {
            return e ? l(e, function (e) {
                return o.isType(e.get("parent"), a.list_item)
            }) : e
        }

        function h(e) {
            return l(e, function (e) {
                return o.isType(e.get("parent"), a.blockquote)
            })
        }

        function f(e, t) {
            return e ? e.get("after") ? t(e.get("after").getVeryFirst()) : f(e.get("parent"), t) : null
        }

        var p = function (e, t, n, i, s, l) {
            l = l || {replace: [], remove: []};

            function u(e) {
                var t, n, s, d = e.get("before");
                if (o.isType(d, a.list)) return s = e.get("after"), i.undo.push(r.buildReplaceUndo(d)), r.addUndoForRemove(i, e), d.getLastChild().getLastChild().set("tail", d.get("tail") || d.getLastChild().get("tail") || d.getLastChild().getLastChild().get("tail")), m(d, 2), d.getLastChild().append(e), m(e), o.isType(s, a.list) && s.get("style") == d.get("style") && (r.addUndoForRemove(i, s), c(s, l)), i.redo.push(r.buildReplaceUndo(d)), l.remove.push(e.cid), l.replace.push(d), !0;
                if (n = (t = e.get("parent")).get("before"), !d && n) {
                    var u = n.getLastChild();
                    return i.undo.push(r.buildReplaceUndo(n)), o.isType(u, a.list) ? (u.getLastChild().set("tail", n.get("tail") || u.get("tail")), n.set("tail", e.get("tail"))) : (n.getLastChild().set("tail", n.get("tail")), m(n), (u = t.get("parent").clone()).unset("start"), m(u), n.append(u), n.set("tail", e.get("tail")), m(e)), function (e, t, n) {
                        var o, a = n.get("parent");
                        r.addUndoForRemove(i, a), o = n.get("after"), e.append(a), o && (o.set("before", null), t.set("tail", a.get("tail")), m(a), t.appendTillEnd(o), m(t.getLastChild(), 2), c(o, l));
                        m(a, 2), i.redo.push(r.buildReplaceUndo(t)), l.remove.push(a.cid), l.replace.push(t)
                    }(u, n, e), !0
                }
            }

            var h, g, v, y = t.get("parent");
            if (t.get("before")) v = u(t); else {
                if (!y.get("before")) {
                    if (h = (g = y.get("parent")).get("before"), !o.isType(h, a.list) || h.get("style") != g.get("style")) return !1;
                    i.undo.push(r.buildReplaceUndo(h)), r.addUndoForRemove(i, g), h.getLastChild().set("tail", Math.min(h.get("tail"), 1)), h.set("tail", g.get("tail")), c(g, l), i.redo.push(r.buildReplaceUndo(h)), l.remove.push(g.cid), l.replace.push(h)
                }
                s.containsNode(document.querySelector("[cid='" + y.getLastChild().cid + "']"), !0) ? (v = function (e) {
                    var t, n = e.get("before");
                    return !!n && (i.undo.push(r.buildReplaceUndo(n)), t = n.getLastChild(), o.isType(t, a.list) ? t.getLastChild().set("tail", n.get("tail") || t.get("tail")) : ((t = n.get("parent").clone()).unset("start"), n.getLastChild().set("tail", n.get("tail")), n.append(t), m(t)), r.addUndoForRemove(i, e), t.append(e), n.set("tail", e.get("tail")), m(e, 2), i.redo.push(r.buildReplaceUndo(n)), l.remove.push(e.cid), l.replace.push(n), !0)
                }(y), t = y) : v = u(t)
            }
            return !v || t == n || t.contains(n) || n.contains(t) || (t = f(t, d)) && p(e, t, n, i, s, l), v && l
        };

        function m(e, t) {
            for (t = t || 1; t > 0 && e;) e.unset("tail"), e = e.getLastChild(), t--
        }

        var g = function (e, t, n, i, o, a) {
            a = a || [];

            function l() {
                var e, n, o = t.get("parent"), l = {}, c = [];
                l.oldCid = o.cid, i.undo.push(r.buildReplaceUndo(o)), t.get("before") ? (n = [t], c.push(o), t.get("after") && (e = o.clone(), n.push(e), e.appendTillEnd(t.get("after")), o.insert(e)), o.insert(t), o.set("tail", o.getLastChild().get("tail")), m(o.getLastChild()), c.push(t), e && c.push(e), i.redo.push(r.buildReplaceUndo(o)), r.addUndoForInsertArray(i, n)) : (r.addUndoForRemove(i, t), o.insert(t, !0), r.addUndoForInsert(i, t), c.push(t), o.get("children").length ? (i.redo.push(r.buildReplaceUndo(o)), c.push(o)) : (r.addUndoForRemove(i, o), o.remove())), l.html = s.toHTML(c), a.push(l)
            }

            for (l(); t && t != n && !t.contains(n) && !n.contains(t);) t && (t = f(t, h)), l();
            return a
        }, v = function (e, t) {
            for (var n = [], i = e; i != t;) n.push(i), i = i.get("after");
            return t && n.push(t), n
        }, y = function (e, t, n, i, l, d) {
            d = d || [];
            var h, p, g, b = t.get("before"), w = t.get("parent"), C = {};
            if (b) p = t.getLastBrother(), i.undo.push(r.buildReplaceUndo(w)), C.oldCid = w.get("parent").cid, w.get("after") && (g = v(w.get("after")), r.addUndoForRemoveArray(i, g), (h = w.get("parent").clone()).unset("start"), w.get("parent").set("tail", w.getLastChild().get("tail")), m(w, 2), h.appendTillEnd(w.get("after")), w.append(h), c(h)), m(t.get("before")), g = v(t), w.get("parent").insertTillEnd(t), i.redo.push(r.buildReplaceUndo(w)), r.addUndoForInsertArray(i, g), t = p, g.unshift(w.get("parent")), C.html = s.toHTML(g), d.push(C); else {
                var x = w.get("parent").get("parent"), k = x && x.get("parent");
                if (!o.isType(k, a.list)) return !1;
                if (w.get("parent").get("before") || w.get("before")) {
                    if (i.undo.push(r.buildReplaceUndo(k)), p = w.getLastChild(), !l.containsNode(document.querySelector("[cid='" + w.getLastChild().cid + "']"), !0) && o.isType(n.get("before"), a.list)) {
                        var S = n.get("before");
                        S.getLastChild().getLastChild().set("tail", S.get("tail"), S.getLastChild().get("tail")), m(S, 2), S.set("tail", n.getLastBrother().get("tail")), m(n.getLastBrother()), S.getLastChild().appendTillEnd(n)
                    }
                    !function () {
                        var e, t;
                        if (w.get("after")) {
                            (e = w.get("parent").clone()).unset("start"), w.getLastChild().set("tail", w.get("tail")), m(w);
                            var n = w.get("after");
                            m(n), function (e) {
                                if (e) {
                                    var t = v(e), n = t[0].get("userIndent");
                                    n && !/^\s*1\./.exec(n) && t.forEach(function (e) {
                                        e.unset("userIndent")
                                    })
                                }
                            }(n), e.appendTillEnd(n), w.append(e)
                        }
                        t = (e = w.get("parent")).get("parent"), e.get("after") && (m(e), w.set("tail", t.get("tail") || w.get("tail")), e.getLastChild().appendTillEnd(e.get("after"))), t.insert(w), 0 == e.get("children").length && e.remove(), t.set("tail", t.getLastChild().get("tail")), m(t.getLastChild()), C.oldCid = t.cid, C.html = s.toHTML(v(t, w)), d.push(C)
                    }(), t = p, i.redo.push(r.buildReplaceUndo(k))
                } else i.undo.push(r.buildReplaceUndo(x)), p = w.getLastChild(), function () {
                    var e, t;
                    t = (e = w.get("parent")).get("parent"), w.detach(), 0 == e.get("children").length && e.remove();
                    for (var n, i = w.getLastChild(); i;) n = i.get("before"), t.append(i, !0), i = n;
                    C.oldCid = t.cid, C.html = t.toHTML(), d.push(C)
                }(), t = p, i.redo.push(r.buildReplaceUndo(x))
            }
            return p = f(t, u), d && p && l.containsNode(document.querySelector("[cid='" + p.cid + "']"), !0) && y(e, p, n, i, l, d), d
        };
        t.moreIndent = function (e) {
            var t = e.selection.getRangy();
            if (!t || File.isLocked) return !0;
            if (o.isType(isInputComponent(document.activeElement))) {
                var n = $(document.activeElement).closest(".CodeMirror")[0];
                return n && n.CodeMirror.execCommand("indentMore"), !0
            }
            var i = e.getMarkElem(t.startContainer), s = d(e.findNodeByElem(i)), l = e.getMarkElem(t.endContainer),
                c = d(e.findNodeByElem(l), s);
            e.undo.completeSnap(!0), e.brush.pause(), s && !c && (c = s.closest(a.list).getLastChild().getFirstChild());
            var u = !1;
            if (s && c) {
                var h = e.selection.buildUndo(), f = r.makeEmptyCommand(h);
                return (u = p(e, s, c, f, t)) && (f.redo.push(h), u.remove.forEach(function (t) {
                    e.findElemById(t).remove()
                }), u.replace.forEach(function (t) {
                    t.isDeleted() || e.findElemById(t.cid).replaceWith(t.toHTML())
                }), e.undo.exeCommand(h), e.undo.register(f)), e.refresh(), e.selection.scrollAdjust(), e.brush.resume(), u || s !== c
            }
            return e.brush.resume(), !1
        }, t.lessIndent = function (e) {
            var t = e.selection.getRangy();
            if (!t || File.isLocked) return !0;
            if (isInputComponent(document.activeElement)) {
                var n = $(t.startContainer).closest(".CodeMirror")[0];
                return n && n.CodeMirror.execCommand("indentLess"), !0
            }
            t = e.selection.deRange(t);
            var i, s, l = e.getMarkElem(t.startContainer), c = u(e.findNodeByElem(l)),
                d = e.getMarkElem(t.endContainer), f = u(e.findNodeByElem(d));
            c && !f && (f = c.closest(a.list).getLastChild().getFirstChild());

            function p() {
                e.undo.completeSnap(!0), e.brush.pause(), i = e.selection.buildUndo(), s = r.makeEmptyCommand(i)
            }

            var m = !1;
            if (c && f && (p(), m = y(e, c, f, s, t)), m || (c = h(e.findNodeByElem(l)), f = h(e.findNodeByElem(d)), o.isType(c, a.paragraph, a.def_footnote, a.def_link, a.heading) && f && (p(), m = g(e, c, f, s, t))), m) {
                for (var v = 0; v < m.length; v++) Object.keys(m[v])[0], e.findElemById(m[v].oldCid).replaceWith(m[v].html);
                e.undo.exeCommand(i), s.redo.push(i), e.mathBlock.renderAll(), e.undo.register(s)
            }
            return e.brush.resume(), m && c != f
        }
    }), $__System.registerDynamic("43", ["e", "11", "12", "1a", "37", "41", "25"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i = e("e"), r = e("11"), o = e("12"), a = o.TYPE, s = o.Node, l = e("1a"), c = (e("37"), e("41")),
            d = e("25").map, u = 99, h = 20, f = r.Model.extend({
                initialize: function (e) {
                    var t = this;
                    this.editor = e, this.TableEdit = f;
                    i(e.sessionStr).on("click", ".md-align-gp button", function (t) {
                        var n, r = /md-align-\S+/g.exec(this.className)[0].substring(9),
                            o = i(this).closest(".md-align-gp").attr("data-col"), a = i(this).closest('[mdtype="table"]'),
                            s = e.findNodeByElem(a);
                        void 0 != o && (o -= 0, n = s.get("align")[o] == r ? null : r, s.attr("align_idx", [o, n], e), t.stopPropagation(), e.lastCursor && e.undo.exeCommand(e.lastCursor))
                    }).on("click", ".md-delete-table", function () {
                        e.tableEdit.deleteTable(i(this).closest("[mdtype='table']"))
                    }).on("click", ".md-resize-table", function (n) {
                        i(this).next(".md-table-resize-popover").length ? (i(".md-table-resize-popover").remove(), e.lastCursor && e.undo.exeCommand(e.lastCursor)) : function (n) {
                            var r,
                                o = '<div class="popover bottom md-table-resize-popover" style="display:block; bottom:auto; top:20px; margin-left:-10px;" contenteditable="false">\t\t\t\t<div class="arrow" style="left:20px;"></div>\t\t\t\t<div class="md-grid-board-wrap md-reset code-tooltip-content">\t\t\t\t\t<table role="grid" class="md-grid-board md-reset">\t\t\t\t\t\t<tbody>\t\t\t\t\t\t\t<tr class="md-reset" row="1">\t\t\t\t\t\t\t\t<td class="md-reset" col="1"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="2"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="3"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="4"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="5"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="6"><a href="#"></a></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr class="md-reset" row="2">\t\t\t\t\t\t\t\t<td class="md-reset" col="1"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="2"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="3"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="4"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="5"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="6"><a href="#"></a></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr class="md-reset" row="3">\t\t\t\t\t\t\t\t<td class="md-reset" col="1"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="2"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="3"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="4"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="5"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="6"><a href="#"></a></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr class="md-reset" row="4">\t\t\t\t\t\t\t\t<td class="md-reset" col="1"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="2"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="3"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="4"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="5"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="6"><a href="#"></a></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr class="md-reset" row="5">\t\t\t\t\t\t\t\t<td class="md-reset" col="1"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="2"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="3"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="4"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="5"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="6"><a href="#"></a></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr class="md-reset" row="6">\t\t\t\t\t\t\t\t<td class="md-reset" col="1"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="2"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="3"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="4"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="5"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="6"><a href="#"></a></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr class="md-reset" row="7">\t\t\t\t\t\t\t\t<td class="md-reset" col="1"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="2"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="3"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="4"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="5"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="6"><a href="#"></a></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr class="md-reset" row="8">\t\t\t\t\t\t\t\t<td class="md-reset" col="1"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="2"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="3"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="4"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="5"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="6"><a href="#"></a></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr class="md-reset" row="9">\t\t\t\t\t\t\t\t<td class="md-reset" col="1"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="2"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="3"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="4"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="5"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="6"><a href="#"></a></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr class="md-reset" row="10">\t\t\t\t\t\t\t\t<td class="md-reset" col="1"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="2"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="3"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="4"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="5"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="6"><a href="#"></a></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t</tbody>\t\t\t\t\t</table>\t\t\t\t\t<div class="popover-title">\t\t\t\t\t\t<input id="md-grid-width" type="text"  max="20" size="2" min="1" value="0" /> x <input id="md-grid-height" maxlength="2" size="2" min="1" value="0"/><button id="md-resize-grid" class="btn btn-primary btn-xs">' + i.localize.getString("OK") + "</button>\t\t\t\t\t</div>\t\t\t\t</div>\t\t\t</div>",
                                a = n.closest('[mdtype="table"]'), s = e.findNodeByElem(a), l = s.get("align").length,
                                c = a.children("table").children("tbody").children("tr").length + 1;

                            function p() {
                                i(this).val().trim().length || i(this).val(2);
                                var e = r.find("#md-grid-width").val(), t = r.find("#md-grid-height").val();
                                r.find("a.md-active").removeClass("md-active"), r.find("tr:nth-child(-n+" + t + ")>td:nth-child(-n+" + e + ")>a").addClass("md-active")
                            }

                            i(".md-table-resize-popover").remove(), n.append(o), (r = n.find(".md-table-resize-popover")).find("tr:nth-child(-n+" + c + ")>td:nth-child(-n+" + l + ")").addClass("md-grid-ext"), r.find("#md-grid-width, #md-grid-height").off("keydown keypress").on("keypress", function (e) {
                                if (!/\d/.exec(String.fromCharCode(e.which))) return !1
                            }).on("keydown", function (e) {
                                var t = e.keyCode || e.which;
                                return "Up" === d[t] ? (this.value = this.value - 0 + 1, this.value = Math.min("md-grid-height" == this.getAttribute("id") ? u : h, this.value), !1) : "Down" === d[t] ? (this.value = this.value - 1, this.value = Math.max(2, this.value), !1) : void 0
                            }), r.find("#md-grid-width").val(l).off("blur focus").blur(p).focus(function () {
                                r.find("#md-resize-grid").show()
                            }).blur(function () {
                                this.value > h ? this.value = h : this.value < 2 && (this.value = 2)
                            }).on("keydown", function (e) {
                                var t = e.keyCode || e.which;
                                if ("Tab" === d[t] && !e.ctrlKey) return r.find("#md-grid-height").focus(), !1;
                                "Enter" === d[t] && r.find("#md-grid-height").focus()
                            }), r.find("#md-grid-height").val(c).off("blur focus").blur(p).focus(function () {
                                r.find("#md-resize-grid").show()
                            }).blur(function () {
                                this.value > u ? this.value = u : this.value < 2 && (this.value = 2)
                            }).on("keydown", function (e) {
                                var t = e.keyCode || e.which;
                                if ("Tab" === d[t] && !e.ctrlKey) return r.find("#md-grid-width").focus(), !1;
                                "Enter" === d[t] && r.find("#md-resize-grid").click()
                            }), r.find(".md-grid-board a").off("mouseenter mouseleave click").hover(function () {
                                var e = i(this).closest("td"), t = e.prevAll().length + 1,
                                    n = e.closest("tr").prevAll().length + 1;
                                n = 1 === n ? 2 : n, r.find("a.md-active").removeClass("md-active"), r.find("tr:nth-child(-n+" + n + ")>td:nth-child(-n+" + t + ")>a").addClass("md-active"), r.find("#md-grid-width").val(t), r.find("#md-grid-height").val(n), r.find("#md-resize-grid").hide()
                            }).click(function (e) {
                                e.stopPropagation(), e.preventDefault(), r.find("#md-resize-grid").click()
                            }), r.find(".md-grid-board").off("mouseleave").on("mouseleave", function (e) {
                                i(this).find("a").removeClass("md-active"), i("#md-grid-width").val(l), i("#md-grid-height").val(c)
                            }), r.find("#md-resize-grid").off("click").click(function (n) {
                                var i, o = (r.find("#md-grid-width").val() || 0) - 0,
                                    l = (r.find("#md-grid-height").val() || 0) - 0, c = s.getFirstChild(),
                                    d = s.get("align").length, u = 0, h = e.undo.UndoManager.makeEmptyCommand();
                                for (h.undo.push(e.undo.buildReplaceUndo(s)); c || u < l;) u < l ? (c ? f.resizeRow(c, o, s) : c = f.newEmptyRowAfter(i, o, s), c = (i = c).get("after")) : c && (i = c, c = c.get("after"), i.delete()), u++;
                                o < d ? s.set("align", s.get("align").slice(0, o)) : s.set("align", s.get("align").concat([].repeat(null, o - d))), a.replaceWith(s.toHTML()), e.lastCursor ? e.undo.exeCommand(e.lastCursor) : window.getSelection().removeAllRanges(), t.showTableEdit(s), h.redo.push(e.undo.buildReplaceUndo(s)), e.undo.register(h)
                            })
                        }(i(this).parent()), n.stopPropagation()
                    }).on("click", ".ty-table-edit", function (t) {
                        i(t.target).closest(".md-table-resize-popover").length || (i(".md-table-resize-popover").remove(), e.lastCursor && i(".md-table-resize-popover").length && e.undo.exeCommand(e.lastCursor)), t.stopPropagation()
                    }).on("mousedown", ".ty-table-edit button", function () {
                        File.editor.lastCursor = File.editor.selection.buildUndo() || File.editor.lastCursor
                    }).on("refocus", "[mdtype='table']", function () {
                        i(document.activeElement).closest("[md-inline='image']").length || t.showTableEdit(i(this))
                    }).on("mouseup", ".ty-table-edit", function (e) {
                        e.stopPropagation()
                    }).on("click", ".md-table-more", function () {
                        i(File.editor.sessionStr).trigger("cursorChange"), File.editor.lastCursor = File.editor.selection.buildUndo(), File.editor.contextMenu.updateTableVisiblity(), File.editor.contextMenu.showExtMenu("#table-menu", i(this)), this.focus()
                    }), function () {
                        var t = i("#table-insert-dialog");
                        t.find("#table-insert-col, #table-insert-row").off("keydown keypress keyup change").on("keypress", function (e) {
                            if (!/\d/.exec(String.fromCharCode(e.which))) return !1
                        }).on("keydown", function (e) {
                            var n = e.keyCode || e.which;
                            return "Up" === d[n] ? (this.value = this.value - 0 + 1, this.value = Math.min("table-insert-row" == this.getAttribute("id") ? u : h, this.value), !1) : "Down" === d[n] ? (this.value = this.value - 1, this.value = Math.max(2, this.value), !1) : void("ESC" === d[n] && t.modal("hide"))
                        }).on("keyup", function () {
                            i(this).trigger("change")
                        }).on("change", function () {
                            File.isMac && app.touchBar && app.touchBar.updateInsertTableTouchBar()
                        }), t.find("#table-insert-col").blur(function () {
                            0 === i(this).val().trim().length && i(this).val(2), this.value > h ? this.value = h : this.value < 1 && (this.value = 1)
                        }).on("keydown", function (e) {
                            var n = e.keyCode || e.which;
                            if ("Tab" === d[n] && !event.ctrlKey || "Enter" === d[n]) return t.find("#table-insert-row").focus(), !1
                        }), t.find("#table-insert-row").blur(function () {
                            0 === i(this).val().trim().length && i(this).val(2), this.value > u ? this.value = u : this.value < 2 && (this.value = 2)
                        }).on("keydown", function (e) {
                            var n = e.keyCode || e.which;
                            if ("Tab" === d[n] && !event.ctrlKey) return t.find("#table-insert-col").focus(), !1;
                            "Enter" === d[n] && t.find(".btn-primary").trigger("click")
                        }), t.find(".btn-primary").click(function () {
                            t.modal("hide"), e.restoreLastCursor(), i(File.editor.sessionStr).trigger("cursorChange");
                            var n = new s({type: s.TYPE.table, in: e.nodeMap});
                            f.valify(n, t.find("#table-insert-col").val(), t.find("#table-insert-row").val()), e.stylize.insertBlock(s.TYPE.table, n)
                        }), t.on("hidden.bs.modal", function () {
                            File.isMac && setTimeout(function () {
                                c.refreshBlockMenu(null, !0)
                            }, 100)
                        })
                    }();
                    var n, r, o, a, l, m, g, v, y, b, w, C, x = 0;
                    setTimeout(function () {
                        a = i("content").offset().top
                    }, 200), function () {
                        var t = i("#typora-table-row-tracker"), a = i("#typora-table-col-tracker");
                        i(e.sessionStr).on("mouseenter click", "th, td", function (e) {
                            if (0 != (o = i(this)).children("[mdtype]").length) {
                                r = o.closest("tr"), n = r.closest("[mdtype='table']"), y = o.prevAll().length;
                                var s = r.offset(), l = o.offset();
                                t.show().offset(s).find(".typora-table-drag-area").height(r[0].offsetHeight + 1), l.top = n.offset().top, a.show().offset(l).find(".typora-table-drag-area").width(o[0].offsetWidth + 1)
                            }
                        }), i(document).on("mousedown", "#typora-table-row-tracker", k).on("mousedown", "#typora-table-col-tracker", S).on("mousemove", E).on("mouseup", A)
                    }();

                    function k(e) {
                        if (!File.isLocked) {
                            t.editor.focusCid = null, l = !0, window.getSelection().removeAllRanges(), _();
                            var o = r.children();
                            i("#typora-table-row-tracker .typora-table-data-area").html(function () {
                                var e = r.height();
                                return r.closest("thead").length ? "<table class='md-table' style='margin:0 ; padding:0; margin-left:0; height:" + e + "px;'><thead>" + r[0].outerHTML + "</thead></table>" : "<table class='md-table' style='margin:0 ; padding:0; margin-left:0; height:" + e + "px;'><tbody>" + r[0].outerHTML + "</tbody></table>"
                            }()).find("td, th").each(function (e) {
                                this.style.width = o[e].offsetWidth + "px"
                            }), w = e.offsetX, C = e.offsetY, v = g = r.closest("thead").length ? 0 : r.prevAll().length + 1, b = [];
                            var a = n.offset().top;
                            return r.closest("table").find("[mdtype='table_row']").each(function () {
                                b.push(this.offsetTop + a)
                            }), b.push(b.last() + n.find("tbody tr:last-child")[0].offsetHeight), !1
                        }
                    }

                    function S(e) {
                        if (!File.isLocked) {
                            t.editor.focusCid = null, m = !0, window.getSelection().removeAllRanges();
                            var r = T(v = g = y), a = i(r[0]).offset();
                            i("#typora-table-col-tracker .typora-table-data-area").offset(a).html(function (e) {
                                var t = o[0].offsetWidth;
                                return "<table class='md-table' style='margin:0 ; padding:0; height:" + n.height() + "px; width:" + t + "px;'><thead><tr>" + e[0].outerHTML + "</tr></thead><tbody>" + e.toArray().map(function (e, t) {
                                    return t ? "<tr style='width:" + e.offsetWidth + "px; height:" + e.offsetHeight + "px;'>" + e.outerHTML + "</tr>" : ""
                                }).join("") + "</tbody></table>"
                            }(r)), _(!0), w = e.offsetX, C = e.offsetY, x = i("content").offset().left, b = [];
                            var s = n.offset().left;
                            n.find("thead:last-of-type th").each(function () {
                                b.push(this.offsetLeft + s)
                            }), b.push(b.last() + n.find("thead [mdtype='table_row'] th:last-child")[0].offsetWidth)
                        }
                    }

                    function E(e) {
                        l ? function (e) {
                            if (!l) return;
                            i("#typora-table-row-tracker").css("top", e.clientY - C - a + document.querySelector("content").scrollTop);
                            var t;
                            (t = b.findIndex(function (t, n) {
                                return b[n] > e.clientY
                            })) > 0 && (t -= 1);
                            -1 == t && (t = b.length - 1);
                            g != t && function (e) {
                                var t;
                                if (e >= b.length - 1) (t = n.find("tbody tr:last-child").offset()).top += n.find("tbody tr:last-child")[0].offsetHeight; else {
                                    var o = i(n.find("tr[mdtype]")[e]);
                                    if (o[0] == r[0] || !o.length) return void F();
                                    t = o.offset()
                                }
                                i("#typora-table-row-insert-marker").width(n[0].offsetWidth).show().offset(t)
                            }(g = t)
                        }(e) : m && function (e) {
                            if (!m) return;
                            i("#typora-table-col-tracker").css("left", e.clientX - w - x);
                            var t, r = n.scrollLeft();
                            (t = b.findIndex(function (t, n) {
                                return b[n] > e.clientX + r
                            })) > 0 && (t -= 1);
                            -1 == t && (t = b.length - 1);
                            g != t && function (e) {
                                var t;
                                if (e >= b.length - 1) (t = n.offset()).left += n[0].offsetWidth; else {
                                    if (v == e || v + 1 == e) return void F();
                                    t = T(e).offset()
                                }
                                n.find(".ty-table-edit").remove(), i("#typora-table-col-insert-marker").height(n[0].offsetHeight).show().offset(t)
                            }(g = t)
                        }(e)
                    }

                    function F() {
                        i(".typora-table-insert-marker").hide()
                    }

                    function _(e) {
                        i("#write").addClass("no-selection"), File.preventScroll = !0, e ? (T(y).addClass("typora-on-moving"), i("#typora-table-row-tracker").hide()) : (r.addClass("typora-on-moving"), i("#typora-table-col-tracker").hide())
                    }

                    function T(e) {
                        return n.find("[mdtype='table_row']>*:nth-child(" + (e + 1) + ")")
                    }

                    function M(e) {
                        File.preventScroll = !1, i("#write").removeClass("no-selection"), i("content").removeClass("prevent-scroll"), i(".typora-on-moving").removeClass("typora-on-moving"), F()
                    }

                    function A(e) {
                        l ? function (e) {
                            if (!l) return;
                            l = !1, M(), p(), t.moveTableRow(v, g, n), N()
                        }() : m && function (e) {
                            if (!m) return;
                            m = !1, M(), p(), t.moveTableCol(v, g, n), t.showAlignCol(n), N()
                        }()
                    }

                    function N() {
                        l = !1, m = !1, n = null, r = null, o = null, v = null, g = null
                    }
                }, moveTableRow: function (e, t, n) {
                    if (this.editor.undo.completeSnap(!0), e != t && e + 1 != t) {
                        n = n || this.editor.getMarkElem().closest("[mdtype='table']");
                        var i = this.editor, r = i.selection.buildUndo(), o = l.makeEmptyCommand(r),
                            a = i.findNodeByElem(n), c = a.getNthChild(e);
                        o.undo.push(l.buildReplaceUndo(a)), s.tryResetTable(a), e < --t && t--, c.detach(), t >= 0 ? a.getNthChild(t).insert(c) : a.getFirstChild().insert(c, !0), o.redo.push(l.buildReplaceUndo(a)), n.replaceWith(a.toHTML()), r && (i.undo.exeCommand(r), o.redo.push(i.selection.buildUndo())), i.undo.register(o), this.showTableEdit(a)
                    }
                }, moveTableCol: function (e, t, n) {
                    this.editor.undo.completeSnap(!0), n = n || this.editor.getMarkElem().closest(".md-table");
                    var i = this.editor, r = i.selection.buildUndo(), o = l.makeEmptyCommand(r), a = i.findNodeByElem(n),
                        c = a.getFirstChild();
                    if (e != t && e + 1 != t) {
                        for (o.undo.push(l.buildReplaceUndo(a)), s.tryResetTable(a), e < --t && t--; c;) {
                            var d = c.getNthChild(e);
                            d.detach(), t >= 0 ? c.getNthChild(t).insert(d) : c.getFirstChild().insert(d, !0), c = c.get("after")
                        }
                        var u = a.get("align").splice(e, 1)[0];
                        a.get("align").splice(t + 1, 0, u), a.get("alignText") && (u = a.get("alignText").splice(e, 1)[0], a.get("alignText").splice(t + 1, 0, u)), o.redo.push(l.buildReplaceUndo(a)), n.replaceWith(a.toHTML()), r && (i.undo.exeCommand(r), o.redo.push(i.selection.buildUndo())), i.undo.register(o), this.showTableEdit(a)
                    } else this.showTableEdit(a)
                }, moveRowUpOrDown: function (e) {
                    var t = this.editor.selection.getRangy();
                    if (t && !File.isLocked) {
                        var n = i(t.commonAncestorContainer).closest("[mdtype='table_row']").closest("tr");
                        if (0 != n.length) {
                            var r = n.closest("thead").length ? 0 : n.prevAll().length + 1;
                            e && 0 == r || !e && r && 0 == n.nextAll().length || this.moveTableRow(r, e ? r - 1 : r + 2, n.closest("[mdtype='table']"))
                        }
                    }
                }, moveColLeftOrRight: function (e) {
                    var t = this.editor.selection.getRangy();
                    if (t && !File.isLocked) {
                        var n = i(t.commonAncestorContainer).closest("[mdtype='table_cell']").closest("td, th");
                        if (0 != n.length) {
                            var r = n.prevAll().length;
                            e && 0 == r || !e && 0 == n.nextAll().length || this.moveTableCol(r, e ? r - 1 : r + 2, n.closest("[mdtype='table']"))
                        }
                    }
                }, insertTable: function () {
                    File.isLocked || document.body.classList.contains("modal-open") || (this.editor.lastCursor = this.editor.selection.buildUndo(), i("#table-insert-dialog").modal({keyboard: !0}), File.isMac && app.touchBar && app.touchBar.showInsertTableTouchBar(), setTimeout(function () {
                        i("#table-insert-col").focus()
                    }, 500))
                }, resizeTableEdit: function (e) {
                    var t = e.parent().children(".ty-table-edit"), n = e.parent()[0].getBoundingClientRect(),
                        i = t.length && t[0].getBoundingClientRect();
                    t.length && (t[0].style.marginTop = "-" + i.height + "px", t[0].style.width = n.width + 10 + "px")
                }, showTableEdit: function (e) {
                    var t = e, n = e;
                    e.jquery ? t = editor.findNodeByElem(e) : n = editor.findElemById(t.id), n.children(".md-table").length && (n = n.children(".md-table"));

                    function r(e) {
                        var t = [], n = i.localize.getString("Align Left"), r = i.localize.getString("Align Center"),
                            o = i.localize.getString("Align Right"), a = i.localize.getString("Resize Table"),
                            s = i.localize.getString("Delete Table"), l = i.localize.getString("More Actions"),
                            c = '<span class="btn-group btn-group-xs md-align-gp"><button type="button" class="btn btn-default md-align-left" ty-hint="' + n + '" aria-label="' + n + '"><span class="ty-icon ty-left-alignment"></span></button><button type="button" class="btn btn-default md-align-center" ty-hint="' + r + '" aria-label="' + r + '"><span class="ty-icon ty-justify-align"></span></button><button type="button" class="btn btn-default md-align-right" ty-hint="' + o + '" aria-label="' + o + '"><span class="ty-icon ty-right-alignment"></span></button></span>';
                        return t.push("<div class='ty-table-edit md-table-edit md-tooltip-remove' contenteditable='false'>"), t.push('<span class="md-th-button btn-group-xs md-resize-table-th"><button type="button" class="btn btn-default md-resize-table" ty-hint="' + a + '" aria-label="' + a + '"><span class="ty-icon ty-menu"></span></button></span>'), t.push(c), t.push('<span class="md-th-button right-th-button btn-group-xs"><button type="button" class="btn btn-default md-delete-table" ty-hint="' + s + '" aria-label="' + s + '"><span class="ty-icon ty-delete"></span></button></span>'), t.push('<span class="md-th-button right-th-button"><button type="button" class="btn btn-default md-table-more" aria-label="' + l + '"><span class="md-table-more-label">More Actions</span><span class="ty-icon ty-dots-v" style="margin-left:8px;"></span></button></span>'), t.push("</div>"), t.join("")
                    }

                    n.prev(".ty-table-edit").length || (i(".ty-table-edit").remove(), r(), n.before(r())), this.resizeTableEdit(n), this.showAlignCol(n)
                }, showAlignCol: function (e) {
                    var t = this.editor.selection.getRangy(), n = t && i(t.commonAncestorContainer).closest("td, th");
                    if (n && n.length) {
                        File.isMac || i(".md-table-more").show();
                        var r = this.editor.findNodeByElem(e.closest("[cid]")).get("align"), o = n.prevAll().length;
                        !function (t, n) {
                            var i = e.closest("figure").find(".md-align-gp").show();
                            i.find("button").removeClass("active"), i.attr("data-col", t), "left" !== n && "right" !== n && "center" !== n || i.find(".md-align-" + n).addClass("active")
                        }(o, r[o])
                    } else i(".md-align-gp, .md-table-more").hide()
                }, keydownHandler: function (e) {
                    var t = e.keyCode || e.which;
                    if ("Tab" === d[t] && !e.ctrlKey) return this.moveToNextCell(!0, e.shiftKey), !1;
                    if ("Enter" === d[t]) {
                        var n = this.editor.UserOp.backspaceHandler(this.editor, null, "delSelection");
                        if (e.shiftKey) this.editor.UserOp.pasteHandler(this.editor, "<br />", !0); else if (File.isMacOrMacNode ? e.metaKey : e.ctrlKey) {
                            var i = this.addRow(!1, this.editor.undo.commandStack.indexOf(n) > -1);
                            l.append(n, i)
                        } else this.moveToBelowCell(l.isEmptyCommand(n));
                        return !1
                    }
                    return File.isMac && s.isType(d[t], "Left", "Right", "Up", "Down") && e.metaKey && e.ctrlKey ? ("Up" == d[t] ? this.moveRowUpOrDown(!0) : "Down" == d[t] ? this.moveRowUpOrDown(!1) : "Left" == d[t] ? this.moveColLeftOrRight(!0) : "Right" == d[t] && this.moveColLeftOrRight(!1), !1) : File.isNode && s.isType(d[t], "Left", "Right", "Up", "Down") && e.shiftKey && e.ctrlKey ? ("Up" == d[t] ? this.moveRowUpOrDown(!0) : "Down" == d[t] ? this.moveRowUpOrDown(!1) : "Left" == d[t] ? this.moveColLeftOrRight(!0) : "Right" == d[t] && this.moveColLeftOrRight(!1), !1) : (File.isMacOrMacNode ? e.metaKey : e.ctrlKey) && ("Left" === d[t] || "Right" === d[t]) ? (this.moveToNextCell(e.shiftKey, "Left" === d[t], !0), !1) : void 0
                }, moveToNextCell: function (e, t, n) {
                    try {
                        var i,
                            r = this.editor.getMarkElem(window.getSelection().anchorNode).closest("[mdtype='table_cell']").parent(),
                            o = (t ? r.prev() : r.next()).children("[mdtype='table_cell']"), a = this.editor.selection,
                            s = this.editor.selection.getRangy();
                        if (n) {
                            var l = s.getBookmark(r[0]);
                            if (t && l.start > 0) return e ? a.extendToLineEdge(!1, r[0]) : a.jumpIntoElemBegin(r), this.editor.refocus(), !0;
                            if (!t && l.end < r.text().length) return e ? a.extendToLineEdge(!0, r[0]) : a.jumpIntoElemEnd(r), this.editor.refocus(), !0
                        }
                        if (!o.length && r.length && (i = r.parent(), (o = (t ? i.prev().children(":last") : i.next().children(":first")).children("[mdtype='table_cell']")).length || (t && "TD" === r[0].tagName ? o = i.closest("table").find("thead>tr>th:last>[mdtype='table_cell']") : t || "TH" !== r[0].tagName || (o = i.closest("table").find("tbody>tr:first>td:first>[mdtype='table_cell']")))), o.focus(), o.length) {
                            if (e) if (n) {
                                var c = this.editor.selection.extendToLineEdge(!t, o[0], !0);
                                t ? s.setStart(c.startContainer, c.startOffset) : s.setEnd(c.endContainer, c.endOffset), this.editor.selection.setRange(s)
                            } else this.editor.selection.selectAllElem(o); else t ? this.editor.selection.jumpIntoElemEnd(o) : this.editor.selection.jumpIntoElemBegin(o);
                            return this.editor.refocus(), !0
                        }
                    } catch (e) {
                    }
                }, moveToBelowCell: function (e, t, n) {
                    try {
                        var i = this.editor.getMarkElem(window.getSelection().anchorNode).closest("[mdtype='table_cell']"),
                            r = this.editor.findNodeByElem(i), o = f.getNextCellInColumn(r, t),
                            a = o && this.editor.findElemById(o.cid);
                        o ? a.length && (e ? this.editor.selection.selectAllElem(a) : t ? this.editor.selection.jumpIntoElemEnd(a) : this.editor.selection.jumpIntoElemBegin(a)) : this.editor.selection.moveUpOrDown()
                    } catch (e) {
                    }
                }, getSibling: function (e, t, n) {
                    return f.getSibling(e, t, n)
                }, unfocusAll: function (e) {
                    e ? i(".ty-table-edit").fadeOut(function () {
                        i(".ty-table-edit").remove()
                    }) : i(".ty-table-edit").remove(), i(".typora-table-tracker").hide()
                }, deleteRow: function () {
                    f.deleteRow(this.editor)
                }, addRow: function (e, t) {
                    return f.addRow(this.editor, e, t)
                }, deleteCol: function () {
                    f.deleteCol(this.editor)
                }, addCol: function (e) {
                    f.addCol(this.editor, e)
                }, copyTable: function () {
                    var e = this.editor.getMarkElem(window.getSelection().anchorNode).closest(".md-table-fig");
                    if (e.length) {
                        (e = e.clone()).find(".md-tooltip-remove").remove(), e.find("td, th").attr("style", function (e, t) {
                            return "border: 1px solid rgb(204, 204, 204);min-height:1ch;min-width:4ch;" + (this.style.textAlign ? "text-align:" + this.style.textAlign + ";" : "")
                        });
                        var t = e.html(), n = this.editor.UserOp.prepMarkHtml(e[0].outerHTML, editor),
                            i = this.editor.UserOp.getMarkdownSourceFrom(n.html());
                        this.editor.UserOp.setClipboard(t, "", i, !0)
                    }
                }, deleteTable: function (e, t) {
                    p(), i("#ty-tooltip").hide(), editor.undo.completeSnap(!0), e = e || editor.getMarkElem(window.getSelection().anchorNode).closest("[mdtype='table']");
                    var n = this.editor.getNode(e.attr("cid")),
                        r = editor.undo.UndoManager.makeEmptyCommand(this.editor.selection.buildUndo()), o = n.get("after"),
                        c = n.get("before");
                    return o || c ? (l.addUndoForRemove(r, n), n.remove(), e.remove()) : (r.undo.push(l.buildReplaceUndo(n)), n.set("type", a.paragraph), n.set("text", ""), n.clearChildren(), s.normalizeNode(n), e.replaceWith(n.toHTML()), r.redo.push(l.buildReplaceUndo(n))), editor.focusCid = null, o ? this.editor.selection.jumpIntoElemBegin(this.editor.findElemById(o.id)) : this.editor.selection.jumpIntoElemEnd(this.editor.findElemById((c || n).id)), this.editor.lastCursor = null, r.redo.push(this.editor.selection.buildUndo()), !t && this.editor.undo.register(r), r
                }, isTableEmpty: function (e) {
                    function t(e) {
                        for (var t = 0, n = e.get("children").length; t < n; t++) if (e.get("children").at(t).get("text")) return !1;
                        return !0
                    }

                    for (var n = 0, i = e.get("children").length; n < i; n++) if (!t(e.get("children").at(n))) return !1;
                    return !0
                }, reformatTable: function (e) {
                    if (this.editor.undo.completeSnap(!0), (e = e || editor.getMarkElem(window.getSelection().anchorNode).closest("[mdtype='table']")).length) {
                        var t = this.editor.getNode(e.attr("cid")),
                            n = editor.undo.UndoManager.makeEmptyCommand(this.editor.selection.buildUndo());
                        n.undo.push(l.buildReplaceUndo(t)), t.set("userText", void 0), t.set("style", void 0), t.set("alignText", void 0);
                        for (var i = t.getFirstChild(); i;) {
                            for (var r = i.getFirstChild(); r;) r.set("marginRight", void 0), r.set("marginLeft", void 0), r = r.get("after");
                            i = i.get("after")
                        }
                        n.redo.push(l.buildReplaceUndo(t)), n.redo.push(this.editor.selection.buildUndo()), this.editor.undo.register(n)
                    }
                }
            });
        f.deleteRow = function (e) {
            i(".md-tooltip-hide").hide();
            var t, n, r, o, a, l = e.getMarkElem(window.getSelection().anchorNode).closest("td"),
                c = e.getMarkElem(window.getSelection().anchorNode).closest("tr[mdtype='table_row']"),
                d = c.prevAll().length;
            if (c.siblings().length) {
                for (n = e.findNodeByElem(c).get("parent"), e.undo.completeSnap(!0), (t = e.undo.UndoManager.makeEmptyCommand()).undo.push(e.selection.buildUndo()), t.undo.push(e.undo.UndoManager.buildReplaceUndo(n)), s.tryResetTable(n), o = n.getNthChild(1), r = d; r;) o = o.get("after"), r--;
                o.remove(), t.redo.push(e.undo.UndoManager.buildReplaceUndo(n)), e.findElemById(n.id).replaceWith(n.toHTML()), d ? d-- : d++, a = document.createRange();
                try {
                    a.setStart(e.findElemById(n.id).find("tbody>tr:nth-child(" + (d + 1) + ")>td:nth-child(" + (l.prevAll().length + 1) + ")>span")[0], 0), window.getSelection().removeAllRanges(), window.getSelection().addRange(a), t.redo.push(e.selection.buildUndo())
                } catch (e) {
                }
                e.undo.register(t), e.tableEdit.showTableEdit(n)
            }
        }, f.addRow = function (e, t, n) {
            i(".md-tooltip-hide").hide();
            var r, o, a = e.getMarkElem(window.getSelection().anchorNode).closest("tr[mdtype='table_row']"),
                l = (e.getMarkElem(window.getSelection().anchorNode).closest("td, th").prevAll().length, "TBODY" == (a.parent()[0] || {}).tagName),
                c = l ? a.prevAll().length + 1 : 0, d = e.undo.UndoManager.makeEmptyCommand();
            if (!t || l) {
                r = e.findNodeByElem(a).get("parent"), e.undo.completeSnap(!0), d.undo.push(e.selection.buildUndo()), d.undo.push(e.undo.UndoManager.buildReplaceUndo(r)), s.tryResetTable(r), o = r.getNthChild(c), o = f.newEmptyRowAfter(t ? o.get("before") : o, o.get("children").length, r), l ? a[t ? "before" : "after"](o.toHTML()) : e.findElemById(r.id).replaceWith(r.toHTML());
                var u = e.findElemById(o.getFirstChild().id);
                e.selection.jumpIntoElemBegin(u), e.selection.scrollAdjust(), d.redo.push(e.undo.UndoManager.buildReplaceUndo(r)), d.redo.push(e.selection.buildUndo()), !n && e.undo.register(d), e.tableEdit.showTableEdit(r)
            }
            return d
        }, f.addCol = function (e, t) {
            i(".md-tooltip-hide").hide();
            var n, r, o = e.getMarkElem(window.getSelection().anchorNode).closest("td, th"),
                a = o.find("[cid]").attr("cid"), l = o.prevAll().length;
            if (o.length) {
                if (r = e.findNodeByElem(o.children("[cid]")).get("parent").get("parent"), e.undo.completeSnap(!0), (n = e.undo.UndoManager.makeEmptyCommand()).undo.push(e.selection.buildUndo()), n.undo.push(e.undo.UndoManager.buildReplaceUndo(r)), s.tryResetTable(r), r.get("children").toArray().map(function (e) {
                    var n = e.getNthChild(l);
                    n.insert(new s({
                        type: s.TYPE.table_cell,
                        text: "",
                        marginLeft: n.get("marginLeft"),
                        marginRight: n.get("marginRight")
                    }), t)
                }), r.get("align").splice(t ? l : l + 1, 0, null), r.get("alignText")) {
                    var c = s.adjustAlignText(r, 0, null);
                    r.get("align").splice(t ? l : l + 1, 0, c)
                }
                e.findElemById(r.id).replaceWith(r.toHTML()), o = e.findElemById(a).closest("th, td"), e.selection.jumpIntoElemBegin(t ? o.prev() : o.next()), n.redo.push(e.undo.UndoManager.buildReplaceUndo(r)), e.undo.register(n), e.tableEdit.showTableEdit(r)
            }
        }, f.deleteCol = function (e) {
            i(".md-tooltip-hide").hide();
            var t, n, r = e.getMarkElem(window.getSelection().anchorNode).closest("td, th"), o = r.prevAll().length,
                a = r.nextAll().length, l = r.closest("tr"),
                c = "TBODY" == l.parent()[0].tagName ? l.prevAll().length + 1 : 0;
            if (o || a) {
                n = e.findNodeByElem(r.children("[cid]")).get("parent").get("parent"), e.undo.completeSnap(!0), (t = e.undo.UndoManager.makeEmptyCommand()).undo.push(e.selection.buildUndo()), t.undo.push(e.undo.UndoManager.buildReplaceUndo(n)), s.tryResetTable(n), n.get("children").toArray().map(function (e) {
                    e.getNthChild(o).remove()
                }), n.get("align").splice(o, 1), n.get("alignText") && n.get("alignText").splice(o, 1), e.findElemById(n.id).replaceWith(n.toHTML());
                var d = document.createRange();
                try {
                    c ? d.setStart(e.findElemById(n.id).find("tbody>tr:nth-child(" + c + ")>td:nth-child(" + (o + 1) + ")>span")[0], 0) : d.setStart(e.findElemById(n.id).find("thead>tr[mdtype]>th:nth-child(" + (o + 1) + ")>span")[0], 0), window.getSelection().removeAllRanges(), window.getSelection().addRange(d), t.redo.push(e.selection.buildUndo())
                } catch (e) {
                }
                t.redo.push(e.undo.UndoManager.buildReplaceUndo(n)), e.undo.register(t), e.tableEdit.showTableEdit(n)
            }
        }, f.getSibling = function (e, t, n) {
            if (s.isType(e, s.TYPE.table_cell)) {
                t = t || "after";
                var i = e.get(t), r = e.get("parent").get(t);
                return i || !r || n || (i = "after" == t ? r.getFirstChild() : r.getLastChild()), i
            }
        }, f.getColumnIndex = function (e) {
            return e.get("before") ? 1 + f.getColumnIndex(e.get("before")) : 0
        }, f.getCellAt = function (e, t) {
            if (s.isType(e, s.TYPE.table_row)) {
                for (var n = e.getFirstChild(); t > 0;) t--, n = n.get("after");
                return n
            }
        }, f.getNextCellInColumn = function (e, t, n) {
            if (s.isType(e, s.TYPE.table_cell)) {
                n = n || f.getColumnIndex(e), t = t || "after";
                var i = e.get("parent").get(t);
                return i ? f.getCellAt(i, n) : void 0
            }
        }, f.resizeRow = function (e, t) {
            var n, i = e.getFirstChild(), r = 0, o = e.get("before"), a = o ? o.getFirstChild() : null,
                l = e.get("parent");
            s.tryResetTable(l);

            function c(e) {
                return e.length > 1 ? e[0] : e
            }

            for (var d = Math.max(t, e.get("children").length); r < d;) r < t ? (i || (i = new s({
                type: s.TYPE.table_cell,
                in: e.get("in"),
                parent: e,
                before: n
            }), a && void 0 !== a.get("marginLeft") ? (i.set("marginLeft", c(a.get("marginLeft"))), i.set("marginRight", c(a.get("marginRight")))) : !o && n && void 0 !== n.get("marginLeft") && (i.set("marginLeft", c(n.get("marginLeft"))), i.set("marginRight", c(n.get("marginRight")))), l.get("alignText") && !l.get("alignText")[r] && (l.get("alignText")[r] = s.adjustAlignText(l, 0, null))), i = (n = i).get("after")) : i && (i = (n = i).get("after"), n.delete()), r++, a && (a = a.get("after"))
        }, f.newEmptyRowAfter = function (e, t, n) {
            var i = new s({
                type: s.TYPE.table_row,
                in: n.get("in"),
                parent: n,
                before: e,
                after: e ? e.get("after") : null
            });
            return f.resizeRow(i, t), i
        };

        function p() {
            i("#typora-table-row-tracker, #typora-table-col-tracker").hide().find(".typora-table-data-area").html("")
        }

        f.valify = function (e, t, n, i) {
            var r;
            if (n = n || 2, void 0 === t && (t = (t = e.get("children").at(0)) ? t.get("children").length : 1), i && 1 == e.get("children").length && 1 == t) i(e, e.get("children").at(0).get("children").at(0).get("text")); else {
                e.get("children").map(function (e) {
                    for (var n = e.get("children").length; n < t; n++) n === e.get("children").length && (r = e.getLastChild()), r = new s({
                        type: s.TYPE.table_cell,
                        parent: e,
                        in: e.get("in"),
                        before: r,
                        text: ""
                    })
                });
                for (var o = e.get("children").length; o < n; o++) f.newEmptyRowAfter(e.get("children").at(o - 1), t, e);
                e.get("align") || e.set("align", new Array(t - 0))
            }
        }, s.TableEdit = f, n.exports = f
    }), $__System.registerDynamic("49", ["11", "13", "12", "43", "18", "17", "e"], !0, function (e, t, n) {
        "use strict";
        this || self, e("11");
        var i = e("13"), r = e("12"), o = r.Node, a = r.TYPE, s = (r.NodeCollectionUtils, e("43")), l = e("18"),
            c = e("17"), d = e("e"),
            u = ["CONTENT", "HEADER", "FOOTER", "ARTICLE", "SECTION", "DIV", "P", "BLOCKQUOTE", "PRE", "UL", "OL", "TABLE", "HR", "H1", "H2", "H3", "H4", "H5", "H6", "DL", "DT", "DD", "TBODY", "THEAD", "TFOOT", "ASID", "LI", "HTML", "BODY", "IFRAME", "STYLE", "SCRIPT", "FIGURE", "VIDEO", "AUDIO"],
            h = ["TITLE", "SELECT", "TEXTAREA", "INPUT", "BUTTON", "SELECT", "SCRIPT", "CANVAS", "META", "PROGRESS", "HEAD", "EMBED", "STYLE", "TEMPLATE", "LINK", "NOSCRIPT", "MENU", "EMBED", "OBJECT"],
            f = function (e) {
                var t = e.find(".gist-file>.gist-data .blob-wrapper");
                if (!t.length) return null;
                var n = t.find(".blob-code.blob-code-inner").map(function () {
                    return this.textContent
                }).toArray().join("\n"), i = /\stype-([^\s]+)/.exec(t.attr("class") || ["", ""])[1];
                return "text" == i && (i = ""), {type: a.fences, text: n, lang: i}
            }, p = /^\s*<(iframe|div|p|table|details|figure|img|a|video|audio|script|style|meta|svg|pre|code)(\s|\/?>)/,
            m = /(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)/,
            g = /\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)/, v = {NORMAL: "normal", HTML: "html"},
            y = function (e, t, n, r) {
                n = n || File.editor;

                function o(e) {
                    var t = ["", e, ""], n = /^(\s*)/.exec(e);
                    return n && (e = e.substring(n[0].length), t[0] = n[0]), (n = /(\s*)$/.exec(e)) && (e = e.substring(0, e.length - n[0].length), t[2] = n[0]), t[1] = e, t
                }

                var a, s, l, c;
                e.find("img").each(function () {
                    (a = d(this)).text("![" + (a.attr("alt") || a.attr("title") || "img").replace(/\r?\n/gi, " ") + "](" + (e = a.attr("src") || "", File.isMac && (0 == e.indexOf("file:///") && -1 == e.substring("file:///".length).indexOf("/") ? (e = e.substring("file:///".length), e = i.getAbsoluteURL(r, e)) : 0 == e.indexOf("webkit-fake-url:") && (e = app.controller.convertFakeUrl(e))), -1 == e.indexOf(":/") && n && n.imgEdit && (e = n.imgEdit.resolveImagePath(e)), e) + ")");
                    var e;
                    a.replaceWith(a[0].childNodes[0])
                }), e.find("strong, b").each(function () {
                    a = d(this), "normal" !== this.style.fontWeight && ((c = o(a.text()))[1] = c[1] ? "**" + c[1].replace(/([^\\])\*/, "$1\\*") + "**" : "", a.text(c.join("")))
                }), e.find("em, i").each(function () {
                    a = d(this), (c = o(a.text()))[1] = c[1] ? "*" + c[1].replace(/([^\\])\*/, "$1\\*") + "*" : "", a.text(c.join(""))
                }), e.find("code, pre, tt").each(function () {
                    (a = d(this)).text("`" + a.text() + "`")
                }), e.find("del, strike").each(function () {
                    (a = d(this)).text("~~" + a.text() + "~~")
                }), e.find("br").each(function () {
                    (a = d(this)).replaceWith("")
                }), e.find("a[href]:not(:empty)").each(function () {
                    a = d(this), s = i.getAbsoluteURL(r, a.attr("href")), 0 == (l = a.text()).length ? a.replaceWith("") : s == l ? a.replaceWith("&lt;" + s.replace(/</g, encodeURI("<")).replace(/>/g, encodeURI(">")) + "&gt;") : a.replaceWith("[" + l.replace(/([^\\])]([^(]|$)/, "$1\\]$2").replace(/\r?\n/gi, " ") + "](" + s + ")")
                }), File.option.highlight && e.find("mark").each(function () {
                    (a = d(this)).text("==" + a.text().replace(/([^\\])\=/, "\\=") + "==")
                });
                var u = (e[0].innerText || e[0].textContent || "").replace(/(\r?\n)|\u00a0/gi, " ");
                return t ? u.split(/\uE033/g) : u.replace(/\uE033/g, " ")
            };
        t.parseInlineHTML = function (e, t, n) {
            var i = d(d.parseHTML("<div>" + e + "</div>")[0]);
            i.find("head, meta, script, css, .gutter, style, title, template, wbr, menu").remove(), i[0].normalize && i[0].normalize();
            for (var r = 0; r < i[0].childNodes.length; r++) {
                var o = i[0].childNodes[r];
                o.nodeType == o.TEXT_NODE ? /^[\s\r\n]*$/.exec(o.textContent) && (o.remove(), r--) : o.nodeType !== o.ELEMENT_NODE && (o.remove(), r--)
            }
            return y(i, void 0, t, n)
        }, t.convertToPlain = function (e) {
            function t(e, t) {
                for (var i = (e instanceof Array ? e[0] : e.first()).getLastBrother(!0), r = [], o = 0; o < e.length; o++) r = r.concat(n(i, t)), i = i.get("after");
                return r
            }

            function n(e, i) {
                var r, s = [];

                function l(e) {
                    return i ? [e] : [e, ""]
                }

                switch (e.get("type")) {
                    case a.fences:
                        s = e.get("text").replace(/\u200B/g, "").split("\n");
                        for (var c = 0; c < s.length; c++) s[c] = "    " + s[c];
                        return i || s.push(""), s;
                    case a.list:
                        var d = e.get("style"), u = e.get("children").length;
                        if (u) {
                            var h = e.getFirstChild();
                            for (c = 0; h;) {
                                var f = n(h, !0), p = o.getIndentPrefix(d, c, h, void 0, (u + "").length);
                                f.map(function (e, t) {
                                    f[t] = (t ? " ".repeat(p.length) : p) + f[t], s.push(f[t])
                                }), c++, h = h.get("after")
                            }
                        }
                        return i || s.push(""), s;
                    case a.table:
                        for (var m, g, v, y, b, w, C = [], x = [], k = 0, S = e.getFirstChild(); S;) {
                            for (m = S.getFirstChild(), x[k] = [], g = 0; m;) x[k][g] = m.toMark().trim(), m = m.get("after"), 0 === k && (C[g] = 4), C[g] = Math.max(x[k][g].length, C[g]), C[g] = Math.min(C[g], 40), g++;
                            S = S.get("after"), k++
                        }
                        for (k = 0; k < x.length; k++) {
                            for (v = "  ", g = 0; g < C.length; g++) y = Math.max(C[g] - x[k][g].length, 0), v += "right" == (b = e.get("align")[g]) ? " ".repeat(y) + x[k][g] : "center" == b ? " ".repeat(w = ~~(y / 2)) + x[k][g] + " ".repeat(y - w) : x[k][g] + " ".repeat(y), v += "\t";
                            s.push(v.replace(/\s$/, ""))
                        }
                        return i || s.push(""), s;
                    case a.hr:
                        return l("---");
                    case a.def_link:
                        return r = "[" + e.get("ref") + "]: " + e.safeGetStrAttr("href") + (e.safeGetStrAttr("title").length ? '\t"' + e.get("title") + '"' : ""), o.isType(e.get("after"), a.def_link) ? [r] : l(r);
                    case a.def_footnote:
                        return r = "[" + e.get("ref") + "]: " + e.get("text"), o.isType(e.get("after"), a.def_footnote) ? [r] : l(r);
                    default:
                        return e.get("children") && e.get("children").length > 0 ? t(e.get("children"), i) : l(e.get("text"))
                }
            }

            return t(e).join("\n")
        }, t.parseHTML = function (e, t, n, r) {
            var b = d(d.parseHTML("<div>" + e + "</div>")[0]), w = [];

            function C(e, n, i) {
                e.in = t, e.parent = n, e.before = i.last(), e && e.text && (e.text = e.text.replace(/\u200b/g, "").replace(/\u00a0/g, " "));
                var r = new o(e);
                return i.push(r), r
            }

            function x(e, t, i) {
                var s = [];
                if (t) for (var l = 0; l < e[0].childNodes.length; l++) F(d(e[0].childNodes[l]), i, s); else o.isType(i, a.blockquote, a.list_item) ? S(e, i, s) : i.set("text", y(e, void 0, n, r))
            }

            function k(e, t, n) {
                for (var r, o = [], s = null, c = 0; c < e.length; c++) r = e[c], (o = l.reDefLink.exec(r)) ? (s = null, C({
                    type: a.def_link,
                    ref: o[1],
                    href: o[3],
                    title: o[7]
                }, t, n)) : (o = l.reDefFootnote.exec(r)) ? (s = null, C({
                    type: a.def_footnote,
                    ref: o[1],
                    text: (o[2] || "").trim()
                }, t, n)) : null == s ? s = C({
                    type: a.paragraph,
                    text: i.escapeHead(r)
                }, t, n) : r ? s.set("text", s.get("text") + "\n" + i.escapeHead(r)) : s = null
            }

            function S(e, t, i) {
                if (e.find("br").length) k(y(e, !0, n.baseURL), t, i); else {
                    if (3 == e[0].nodeType && !e.text().trim().length) return;
                    if (1 == e[0].nodeType && "BR" == e[0].tagName) return;
                    k([y(e, void 0, n, r)], t, i)
                }
            }

            var E = {center: "center", left: "left", right: "right"};

            function F(e, i, l, b) {
                var w, k, _ = function (e) {
                    if (!e[0] || !e[0].tagName) return !1;
                    if (-1 == u.indexOf(e[0].tagName)) return e[0].querySelector("video, div, p");
                    var t = !1;
                    return e.children().each(function () {
                        t = t || this.tagName && (u.indexOf(this.tagName) > -1 || "BLOCK" == this.style.display)
                    }), t || e[0].querySelector("video, div, p")
                }(e), T = e[0].tagName;
                if (!(e.data("skip") || h.indexOf(T) > -1 || e[0].nodeType === document.COMMENT_NODE)) {
                    if (b && b.length) b.push(("P" == T ? "\n" : "") + e.text()); else if ("BLOCKQUOTE" === T) x(e, _, w = C({type: a.blockquote}, i, l)); else if ("LI" === T && o.isType(i, a.list)) x(e, _, w = C({type: a.list_item}, i, l)); else if ("UL" === T || "OL" === T) x(e, _, w = C({
                        type: a.list,
                        style: T.toLowerCase()
                    }, i, l)); else if ("DL" === T) w = C({type: a.list, style: "ul"}, i, l), function (e, t) {
                        for (var i, o = [], s = 0; s < e.length; s++) "DT" == e[s].tagName && ((i = C({type: a.list_item}, t, o)).itemList = [], C({
                            type: a.paragraph,
                            text: y(d(e[s]), void 0, n, r)
                        }, i, i.itemList)), "DD" == e[s].tagName && i && C({
                            type: a.paragraph,
                            text: y(d(e[s]), void 0, n, r)
                        }, i, i.itemList)
                    }(e.children(), w); else if ("TABLE" === T) (k = e.children().children("tr").add(e.children("tr"))).length && (w = C({type: a.table}, i, l), l = [], w.cols = 1, k.toArray().map(function (e) {
                        F(d(e), w, l)
                    }), w.set("align", new Array(w.cols - 0)), s.valify(w, w.cols, 2, function (e, t) {
                        var n = t.split(/(\r|\n)+/);
                        e.set("type", a.paragraph), e.set("text", n[0]);
                        for (var r = 1; r < n.length; r++) n[r].trim().length && C({
                            type: a.paragraph,
                            text: n[r]
                        }, i, l)
                    })); else if ("THEAD" === T || "TBODY" === T || "TFOOTER" === T) {
                        for (var A = [e], N = $elem.next(); N.length && o.isType(N[0].tagName, "THEAD", "TBODY", "TFOOTER");) A.push(N), N.data("skip", !0);
                        e.wrap("<table></table>"), F(e.parent(), i, l)
                    } else if ("TR" === T && o.isType(i, a.table)) {
                        var L;
                        L = (k = e.children("th")).length, k = k.add(e.children("td")), i.cols = k.length > i.cols ? k.length : i.cols, w = C({
                            type: a.table_row,
                            isHeader: L
                        }, i, l), l = [], k.toArray().map(function (e) {
                            F(d(e), w, l)
                        })
                    } else if ("TD" !== T && "TH" !== T || !o.isType(i, a.table_row)) if ("HR" === T) C({type: a.hr}, i, l); else if (/H[1-6]/g.exec(T)) C({
                        type: a.heading,
                        text: y(e, void 0, n, r),
                        depth: e[0].tagName[1]
                    }, i, l); else if ("CODE" === T || "PRE" === T && 0 == e.find("pre").length || "FIGURE" == T && e.hasClass("highlight")) {
                        M = "";
                        var R = e.attr("class") + " " + e.children("code").attr("class"),
                            D = (/lang(?:uage)?\-([^\s]+)/.exec(R) || [])[1], O = e.find("tr");
                        O.length > 1 ? M = O.map(function () {
                            return this.innerText
                        }).toArray().join("\n") : (e.find("div").each(function () {
                            d(this).before("<br/>")
                        }), M = e[0].innerText.replace(/(^\s*\n+)|([\r\n]+$)/g, "")), C({
                            type: a.fences,
                            text: M,
                            lang: D
                        }, i, l)
                    } else {
                        if (o.isType(T, "VIDEO", "AUDIO", "IFRAME", "DETAILS", "svg")) return M = e[0].outerHTML, C({
                            type: a.html_block,
                            text: M
                        }, i, l), M;
                        if ("P" != T && _) {
                            if (_) {
                                var I, P;
                                if (e.is("div.gist") && (P = f(e))) return void C(P, i, l);
                                var B = [];
                                if (e[0].childNodes.forEach(function (e, t) {
                                    (e.nodeType != e.TEXT_NODE || e.nodeValue.trim().length) && (e.nodeType == e.TEXT_NODE || c.ALL_INLINE_TYPE.indexOf((e.tagName || "").toUpperCase()) > -1 ? I ? I.append(d(e)) : I = d(e).wrap("<p></p>").parent() : e.nodeType == e.ELEMENT_NODE && (I && (F(I, i, l, B), I = null), F(d(e), i, l, B)))
                                }), B.length) {
                                    var $ = B.join("\n"), H = o.parseFrom($, t, void 0, !0)[1];
                                    return l.splice.apply(l, [l.length, 0].concat(H)), $
                                }
                                I && (F(I, i, l), I = null)
                            }
                        } else {
                            var U = function (e) {
                                e = e || "";
                                var t = !1;
                                try {
                                    t = (t = (e.match(/\n\s*(\!?\[|#{1,5}|>|```|([-+*]\s)|(\d+\.\s))/gm) || "").length > 3 || e.match(g) || e.match(m)) ? v.NORMAL : null
                                } catch (e) {
                                }
                                return t || (t = (t = p.exec(e)) ? v.HTML : null), t || (t = (t = (e.match(/(\/\w*>)|(\n\s+<)/g) || []).length > 6) ? v.HTML : null), t
                            }(M = e[0].innerText || e[0].textContent || "");
                            if (U) {
                                var j = new o({
                                    type: a.paragraph,
                                    text: M.replace(/^[\r\n]+\s*/, "").replace(/\s*[\r\n]+$/, ""),
                                    in: t
                                });
                                if (i) i.append(j); else {
                                    var W = (j.parseFrom(void 0, void 0, !0) || [])[1];
                                    W && W.length && (b && 1 == W.length && !l.length && W[0].get("type") == a.html_block ? b.push(M) : l.splice.apply(l, [l.length, 0].concat(W)))
                                }
                            } else S(e, i, l);
                            if (U) return M
                        }
                    } else w = C({type: a.table_cell, text: y(e, void 0, n, r)}, i, l), "TH" === T && function (e, t) {
                        if ("TH" === e[0].tagName) {
                            var n = e.attr("style") || "", i = /text\-align:([^;]+)($|;)/.exec(n), r = null;
                            if (i && (r = E[i[1].replace(/;/g, "").trim()] || null), r) {
                                var o = e.prevAll("th").length;
                                (t.get("parent").get("parent").get("align") || [])[o] = r
                            }
                        }
                    }(e, w);
                    return null
                }
            }

            b.find("head, meta, script, css, .gutter, style, title, template, wbr, menu").remove(), b[0].normalize && b[0].normalize();
            var _ = F(b, null, w);
            if (_) return _;
            if (w.length && (function e(t, n, i, r) {
                var s, l = n, c = [];
                if (n && n !== i) {
                    for (; l && l !== i && o.isType(l, a.paragraph) && o.isEmptyBlock(l);) s = l, l = l.get("after"), s.remove(), r && r.splice(r.indexOf(s), 1), l = l.get("after");
                    for (n = l.get("before") || l, l = i; l && l !== n && o.isType(l, a.paragraph) && o.isEmptyBlock(l);) s = l, l = l.get("before"), s.remove(), r && r.splice(r.indexOf(s), 1), l = l.get("before")
                }
                for (l = n; l;) {
                    var d = null;
                    if (o.isType(l, a.blockquote, a.list_item)) e(l, l.getFirstChild(), l.getLastChild()); else if (o.isType(l, a.fences) && o.isType(l.get("before"), a.fences)) c.push(l), l.head = l.get("before").head || l.get("before"), l.head.set("text", l.head.get("text") + "\n" + l.get("text")); else if (o.isType(l, a.list) && 0 === l.get("children").length) l.set("type", a.paragraph); else if (o.isType(l, a.paragraph) && (d = /^(`+)([\s\S]*?[^`])\1(?!`)\s*$/g.exec(l.get("text")))) {
                        l.set("type", a.fences), l.set("text", d[2]);
                        continue
                    }
                    l = l.get("after")
                }
                c.map(function (e) {
                    r && r.splice(r.indexOf(e), 1), e.remove()
                })
            }(0, w[0], w.last(), w), 1 === w.length && o.isType(w[0], a.paragraph))) {
                b.find("br").replaceWith(""), b.html(b.html().replace(/^\s+/gm, ""));
                var T = (M = b.text()).indexOf("") > -1,
                    M = M.replace(/^(\s*\n)+/, "").replace(/(\r?\n)+$/, "").replace(/\u00a0/g, " ").replace(/\u200b/g, "");
                return T && (M = M.replace(/\uE033/g, "\n").replace(/(\r?\n){2,}/g, "\n")), w[0].delete(), M.indexOf(/\n/) > -1 ? o.parseFrom(M, t, {
                    noTop: !0,
                    skips: {old_code: !0}
                }, !0)[1] : M
            }
            return w
        }
    }), $__System.registerDynamic("2f", ["13", "12", "28", "31", "16", "17"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i = e("13"), r = e("12"), o = e("28"), a = e("31"), s = e("16"), l = e("17"), c = (r.Node, r.TYPE);
        window.failImgCache = [], window.loadedImgCache = [], window.removeLastModifyQuery = function (e) {
            return (e || "").replace(/\?lastModify=(.+)$/, "")
        };
        var d = function (e) {
            return i.escapeForPreWrap(e)
        }, u = function (e, t) {
            if (/%[0-9a-f]{2}/i.exec(e)) return e.replace(/'/, "%27").replace('"', "%22");
            var n;
            try {
                n = decodeURI(e)
            } catch (t) {
                n = e
            }
            try {
                /^file:/.exec(n) && (n = n.replace(/\\/g, "/")), n = encodeURI(n).replace(/'/, "%27").replace('"', "%22")
            } catch (t) {
                Reporter.error("unable to process escapeURL " + e, {level: "warning"}), n = ""
            }
            return t ? n.replace(/#/g, "%23") : n
        };

        function h(e) {
            var t = e.target;
            if (document.body.contains(t)) {
                var n = window.removeLastModifyQuery(t.getAttribute("src"));
                imagePreLoadAfterMove[n] ? setTimeout(function () {
                    delete imagePreLoadAfterMove[n]
                }, 200) : File.editor.imgEdit.afterUserInsertImage(t), File.editor.imgEdit.afterUserInsertImage(t)
            }
        }

        window.onImageLoadedFunc = function (e) {
            var t = e.target;
            if (document.body.contains(t)) {
                var n = window.removeLastModifyQuery(t.getAttribute("src"));
                n.trim() && (-1 == loadedImgCache.indexOf(n) && n.trim().length && loadedImgCache.push(n), t.onload = h, $(t).closest(".md-image").addClass("md-img-loaded").removeClass("md-img-error"), t.dataset.localRefresh || (t.getAttribute("aftermove") && (t.style.background = "", t.style.width = "", t.style.height = "", t.removeAttribute("aftermove")), imagePreLoadAfterMove[n] ? setTimeout(function () {
                    delete imagePreLoadAfterMove[n]
                }, 200) : File.editor.imgEdit.afterUserInsertImage(t)))
            }
        }, window.onImageErrorFunc = function (e) {
            var t = e.target;
            if (document.body.contains(t)) {
                var n = window.removeLastModifyQuery(t.getAttribute("src"));
                n.trim() && (failImgCache.length > 5e3 && (failImgCache = []), -1 == failImgCache.indexOf(n) && n.trim().length && failImgCache.push(n), loadedImgCache.remove(n), $(t).closest(".md-image").addClass("md-img-error").removeClass("md-img-loaded"), t.setAttribute("onerror", null))
            }
        }, window.onLoadedFuncForQuickAction = h;
        var f = 'onerror="window.onImageErrorFunc(event)" onload ="window.onImageLoadedFunc(event)"';

        function p(e, t, n, r, o) {
            var a, s, l, h, p, g = File.editor, v = "", y = "", b = t.indexOf("\n") > -1 ? " md-image-multi-line " : "";
            if (o) {
                o[1].trim().length;
                p = "<span class='md-image-before-src ty-focusable'>" + i.escape(o[0]) + "</span><span class='md-image-src-span ty-focusable'>" + (o[1].trim().length ? o[1] : "<span class='md-image-btn ty-focusable-btn md-image-input-src-btn' content='" + $.localize.getString("input image URL", "Front") + "'></span><span class='md-image-btn ty-focusable-btn md-image-pick-file-btn' ty-hint='" + $.localize.getString("Select image from local file", "Front") + "'></span>") + "</span><span class='md-image-after-src'>" + i.escape(o[2]) + "</span>"
            } else p = i.escape(t);
            var w = (r || {}).width, C = (r || {}).height, x = (r || {}).zoom;
            if (e == c.refimg) {
                if (s = n, a = g.nodeMap.link_list.getHrefByRef(s) || "", v = " data-ref='" + d(s) + "' ", !a) return "<span md-inline='refimg' class='md-image md-no-ref" + b + "' " + v + "><span class='md-meta md-before md-content' contenteditable='true' data-hint='" + $.localize.getString("Please define image reference by \n[{0}]: http://example.png").format(d(s)) + "' >" + p + "</span></span>"
            } else a = n;
            w && (y += "width:" + w.replace(/['";\\]/g, "") + ";"), C && (y += "height:" + C.replace(/['";\\]/g, "") + ";"), x && (y += "zoom:" + x.replace(/['";\\]/g, "") + ";"), y && (y = " style =' " + y + "' ");
            var k = " data-src='" + u(a, !0) + "' ", S = g.imgEdit.getRealSrc(a), E = S.replace(/^file:\/\//, ""),
                F = /^data:/.exec(S), _ = /^file:\/\//i.exec(S || ""), T = S,
                M = imagePreLoadAfterMove[S.replace(/\\/g, "/")];
            if (F ? k = " " : _ && (T = T.replace(/\\/g, "/")), S = u(T, !0), _ && (S += "?lastModify=" + imgLastModified), F || loadedImgCache.indexOf(T) > -1 || loadedImgCache.indexOf(u(T, !0)) > -1) l = "<span md-inline='" + e + "'" + k + " contenteditable='false' class='md-image md-img-loaded" + b + "' " + v + "><span class='md-meta md-before md-content' contenteditable='true'>" + p + "</span><img referrerPolicy='no-referrer' src='" + S + "' " + y + 'onerror="onImageErrorFunc(event)" onload="onLoadedFuncForQuickAction(event)"></span>'; else if (failImgCache.indexOf(T) > -1) l = "<span md-inline='" + e + "'" + k + " contenteditable='false' class='md-image md-img-error" + b + "' " + v + "><span class='md-meta md-content md-before' contenteditable='true'>" + p + "</span><img referrerPolicy='no-referrer' src='' " + y + "></span>"; else {
                var A = "";
                !y.trim().length && M && (y = " style='" + M.size + "background-image:url(" + u(M.src, !0) + ");' aftermove='true' ", A = " md-img-loaded"), l = "<span md-inline='" + e + "'" + k + " contenteditable='false' class='md-image" + (A += b) + "' data-src='" + S + "' " + v + "><span class='md-meta md-before md-content' contenteditable='true'>" + p + "</span><img referrerPolicy='no-referrer' src='" + S + "' " + f + " " + y + " /></span>"
            }
            return e == c.image && -1 == failImgCache.indexOf(S) && (window.uploadImageQueue.has(E) ? (m(h = $(l), E, !1), l = h[0].outerHTML) : window.moveImageQueue.has(E) && (m(h = $(l), E, !0), l = h[0].outerHTML)), l
        }

        function m(e, t, n, i) {
            function r() {
                var t = n ? "md-img-loaded md-on-moving" : "md-img-loaded md-on-uploading";
                e.addClass(t), e.append($("#typora-uploading-image-templ").html().replace(/\s*\n\s*/g, ""))
            }

            i ? setTimeout(function () {
                (n ? moveImageQueue : uploadImageQueue).has(t) && document.body.contains(e[0]) && r()
            }, 1e3) : r(), e.attr("data-origin-path", t)
        }

        t.applyUploadingStyle = m, t.decorateAsExport = function (e, t) {
            var n, r, s, l, h, f;

            function p(e, n) {
                if (n && !i.isFullUrl(e)) return "http://" + e;
                if (t.forPrint && !i.isFullUrl(e) && !e.match(/^#/) && (e = e.replace(/([#?][^.]+)$/, ""), File.isNode)) {
                    var r = reqnode("fs-plus"), o = reqnode("path").resolve(a.getCurrentFileFolderPath() + "/", e);
                    return r.isFileSync(o) ? "file://" + o : r.isFileSync(o + ".md") ? "file://" + o + ".md" : r.isFileSync(o + ".markdown") ? "file://" + o + ".markdown" : r.isFileSync(o + ".pdf") ? "file://" + o + ".pdf" : "http://" + e
                }
                return e
            }

            switch (e.type) {
                case c.strong:
                    return "<strong>" + e.inner + "</strong>";
                case c.em:
                    return "<em>" + e.inner + "</em>";
                case c.plain:
                    return i.escape(e.text);
                case c.softbreak:
                    return "\n";
                case c.code:
                    return t.forPrint && File.isNode ? (t.defaultFont || (t.defaultFont = window.getComputedStyle(File.editor.writingArea).fontFamily || "initial"), n = "<code>" + e.text.trim().split(/([\-;]+)/).map(function (e) {
                        return e ? /\-|;/.exec(e) ? "<span style='font-family:" + t.defaultFont.replace(/'/g, "\\'") + "'>" + e + "</span>" : i.escape(e, !1, !0) : ""
                    }).join("") + "</code>") : n = "<code>" + i.escape(e.text.trim(), !1, !0) + "</code>", n;
                case c.del:
                    return "<del>" + e.inner + "</del>";
                case c.autolink:
                case c.url:
                    return "<a href='" + u(p(e.href, !0)) + "' target='_blank' class='url'>" + e.text + "</a>";
                case c.tag:
                    return /^<img/.test(e.text) && t.forPrint && (r = /(\ssrc=)(['"])([^"']*)(\2)/.exec(e.text)) ? (r = File.editor.imgEdit.getRealSrc(r[3]).replace(/^file:\/\/\/?/i, "file:///").replace(/\\/g, "/"), e.text.replace(/(\ssrc=)(['"])([^"']*)(\2)/, "$1$2" + r + "$4")) : e.text;
                case c.br:
                case c.imgtag:
                case c.html_inline:
                case c.ruby:
                    return e.text;
                case c.link:
                    return "#" == (e.href || "").trim()[0] && (f = o.findAnchorElem(e.href, !0)).length && (e.href = "#header-" + f.attr("cid")), "<a href='" + u(p(e.href)) + "'" + (e.title ? " title='" + d(e.title) + "'" : "") + ">" + e.inner + "</a>";
                case c.image:
                    return r = t.forPrint ? File.editor.imgEdit.getRealSrc(e.href) : e.href, n = t.forPrint && failImgCache.indexOf(r) > -1 ? "" : "<img src='" + (r = t.forPrint ? u(r, !0) : d(r)) + "' alt='" + d(e.alt) + "' referrerPolicy='no-referrer' />", !t.noStyle && e.onlyChild && (n = "<span class='md-image'>" + n + "</span>"), n;
                case c.footnote:
                    if (h = t.nodeMap.foot_list.getNodeByRef(e.text)) {
                        var m, g = t.footnoteList.indexOf(e.text) + 1;
                        return 0 == g && (t.footnoteList.push(e.text), g = t.footnoteList.length), n = "<sup class='md-footnote'><a href='#dfref-footnote-" + (m = t.appendFootnote(h, g)) + "' name='ref-footnote-" + m + "'>" + g + "</a></sup>"
                    }
                    return "[^" + i.escape(e.text) + "]";
                case c.escape:
                    return i.escape(e.text);
                case c.refimg:
                    return l = (s = t.nodeMap.link_list.getNodeByRef(e.ref || e.text)) ? d(s.get("title")) : void 0, void 0 !== (r = s ? s.get("href") : void 0) ? (r = t.forPrint ? u(File.editor.imgEdit.getRealSrc(r), !0) : d(r), n = "<img alt='" + e.text + "' src='" + r + "'" + (l ? " title='" + l + "'" : "") + " referrerPolicy='no-referrer'></img>", t.noStyle || (n = "<span class='md-image'>" + n + "</span>"), t.forPrint && failImgCache.indexOf(r) > -1 && (n = ""), n) : "![" + e.inner + "][" + i.escape(e.ref) + "]";
                case c.reflink:
                    return r = (s = t.nodeMap.link_list.getNodeByRef(e.ref || e.text)) ? d(p(s.get("href"))) : void 0, l = s ? d(s.get("title")) : void 0, void 0 !== r ? "<a href='" + r + "' target='_blank'" + (l ? " title='" + l + "'" : "") + ">" + e.inner + "</a>" : "[" + e.inner + "][" + i.escape(e.ref) + "]";
                case c.attr:
                    return "";
                case c.emoji:
                    return File.option.monocolorEmoji ? "<span class='md-emoji'>" + e.inner + "</span>" : e.inner;
                case c.inline_math:
                    return t.noStyle ? e.text : o.processExportedSVG(svgCache[e.text.replace(/\u200B/g, "")] || "<span class='math-in-toc'>" + i.escapeForPreWrap(e.text) + "</span>");
                case c.subscript:
                    return "<sub>" + e.inner + "</sub>";
                case c.superscript:
                    return "<sup>" + e.inner + "</sup>";
                case c.underline:
                    return "<u>" + e.inner + "</u>";
                case c.tab:
                    return t.noStyle ? e.inner : "<span>" + e.inner + "</span>";
                case c.linebreak:
                    return "<br/>";
                case c.highlight:
                    return "<mark>" + e.inner + "</mark>";
                default:
                    return e.inner || e.text || ""
            }
        }, t.decorate = function (e, t) {
            switch (e.type) {
                case"block":
                    return "<span class='md-block-like'>" + e.inner + "</span>";
                case c.heading:
                    return "<span class='md-block-like'><span class='md-blockmeta'>" + e.meta_before + "</span><span class='md-header-span'>" + e.inner + "</span>" + (e.meta_after ? "<span class='md-blockmeta'>" + e.meta_after + "</span>" : "") + "</span>";
                case c.paragraph:
                    return e.inner;
                case c.blockquote:
                    return "<span class='md-block-like'><span class='md-blockmeta'>" + e.pattern + "</span>" + e.inner + "</span>";
                case c.fences:
                    return "<span class='md-block-like' mdlike='" + e.type + "'><span class='md-blockmeta'>" + e.pattern + "</span><span class='md-lang'>" + i.escape(e.lang) + "</span></span>";
                case c.def_footnote:
                    return "<span class='md-block-like' mdlike='" + e.type + "'><span class='md-blockmeta'>[^</span>" + e.ref + "<span class='md-blockmeta'>]: </span><span class='md-def-content'>" + e.inner + "</span></span>";
                case c.def_link:
                    return "<span class='md-block-like' mdlike='" + e.type + "'><span class='md-blockmeta'>[</span>" + e.ref + "<span class='md-blockmeta'>]: </span><span class='md-def-content'>" + e.inner + "</span></span>";
                case c.strong:
                    return "<span md-inline='strong' class='" + (e.inner ? "" : "md-empty") + "'><span class='md-meta md-before'>" + e.pattern + "</span><strong>" + e.inner + "</strong><span class='md-meta md-after'>" + e.pattern + "</span></span>";
                case c.em:
                    return "<span md-inline='em' class='" + (e.inner ? "" : "md-empty") + "'><span class='md-meta md-before'>" + e.pattern + "</span><em>" + e.inner + "</em><span class='md-meta md-after'>" + e.pattern + "</span></span>";
                case c.highlight:
                    return "<span md-inline='highlight'><span class='md-meta md-before'>==</span><mark>" + e.inner + "</mark><span class='md-meta md-after'>==</span></span>";
                case c.plain:
                    return "<span md-inline='plain'>" + i.escape(e.text) + "</span>";
                case c.code:
                    var n = e.text.match(/^\s+/) || "";
                    e.text = e.text.replace(/^\s+/, "");
                    var r = e.text.match(/\s+$/) || "";
                    return "<span md-inline='code' spellcheck='false'><span class='md-meta md-before'>" + e.pattern + n + "</span><code>" + i.escapeForPreWrap(e.text.trim(), !1, !0) + "</code><span class='md-meta md-after'>" + r + e.pattern + "</span></span>";
                case c.del:
                    return "<span md-inline='del'><span class='md-meta md-before'>" + e.pattern + "</span><del>" + e.inner + "</del><span class='md-meta md-after'>" + e.pattern + "</span></span>";
                case c.autolink:
                    return "<span md-inline='autolink' class='md-link'><span class='md-meta md-before'>&lt;</span><a href='" + u(e.href) + "'>" + i.escape(e.text) + "</a><span class='md-meta md-after'>&gt;</span></span>";
                case c.url:
                    return "<span md-inline='url' class='md-link' spellcheck='false'><a href='" + u(e.href) + "'>" + i.escape(e.text) + "</a></span>";
                case c.br:
                    return "<span md-inline='br' class='md-br md-tag' spellcheck='false'><span class='md-br-content md-raw-inline'>" + i.escapeForPreWrap(e.text, !1, !0) + "</span></span>";
                case c.comment:
                    return "<span md-inline='comment' class='md-comment' spellcheck='false'>" + i.escapeForPreWrap(e.text, !1, !0) + "</span>";
                case c.underline:
                    return "<span md-inline='underline'><span class='md-meta md-before md-raw-inline'>&lt;u&gt;</span><u>" + e.inner + "</u><span class='md-meta md-after md-raw-inline'>&lt;/u&gt;</span></span>";
                case c.ruby:
                    return "<span md-inline='ruby' class='md-ruby'><span contenteditable='false' class='md-ruby-container'>" + s.sanitize(e.text, l.getDomPurifyConfig()).innerHTML + "</span><span class='md-meta md-content md-raw-inline'>" + i.escape(e.text) + "</span></span>";
                case c.html_inline:
                    var o = [];
                    return e.isMeta || (o = function (e) {
                        var t = s.sanitize(e.before + "" + e.after, l.getDomPurifyConfig()),
                            n = t.innerHTML.replace(/\uE066/, e.inner);
                        return t.innerHTML = n, "" != (void 0 === t.textContent ? t.innerText : t.textContent) || t.querySelector("img, svg, video, audio") ? [n, n] : [n, ""]
                    }(e)), o[1] ? "<span md-inline='html_inline' class='md-html-inline' spellcheck='false'><span class='md-meta md-before md-raw-inline'>" + i.escapeForPreWrap(e.before, !1, !0) + "</span>" + o[0] + "<span class='md-meta md-after md-raw-inline'>" + i.escapeForPreWrap(e.after, !1, !0) + "</span></span>" : "<span md-inline='html_inline' class='md-html-inline md-raw-inline' spellcheck='false'>" + o[0] + "<span class='md-raw-inline'>" + i.escapeForPreWrap(e.before, !1, !0) + e.inner + i.escapeForPreWrap(e.after, !1, !0) + "</span></span>";
                case c.tag:
                    return "<span md-inline='tag' class='md-tag md-raw-inline' spellcheck='false'>" + i.escapeForPreWrap(e.text, !1, !0) + "</span>";
                case c.atag:
                    return "<span md-inline='atag' class='md-atag'><span class='md-meta md-before md-raw-inline'>" + i.escapeForPreWrap(e.left, !1, !0) + "</span><a href='" + u(e.href) + "'>" + e.inner + "</a><span class='md-meta md-after md-raw-inline'>" + i.escapeForPreWrap(e.right, !1, !0) + "</span></span>";
                case c.link:
                    var a = e.meta.replace(/^\((<?(?:\([^)]*\)|[^()])*?>?)([ \t]*)((['"])(.*?)\4)?([ \t]*)\)/, function (e, t, n, r, o, a, s) {
                        return "(</span><span class='md-content md-url'>" + i.escape(t) + "</span><span class='md-meta'>" + i.escape(n) + "</span><span class='md-content md-link-title'>" + i.escape(r) + "</span><span class='md-meta md-after'>" + i.escape(s) + ")</span>"
                    });
                    return "<span md-inline='link' class='" + (e.inner ? "" : "md-empty-link") + " md-link'><span class='md-meta md-before'>[</span><a spellcheck='false' href='" + u(e.href) + "' >" + e.inner + "</a><span class='md-meta md-before'>]" + a + "</span>";
                case c.imgtag:
                    return p(e.type, e.text, e.href, e);
                case c.refimg:
                    return p(e.type, e.markdown, e.ref || e.text);
                case c.image:
                    return p(e.type, e.markdown, e.href, void 0, e.components);
                case c.footnote:
                    return "<sup md-inline='footnote' class='md-footnote'><span class='md-meta md-before'>[^</span><span class='md-text'>" + e.inner + "</span><span class='md-meta md-after'>]</span></sup>";
                case c.escape:
                    return "<span md-inline='escape'><span class='md-meta md-before'>\\</span>" + i.escape(e.text) + "</span>";
                case c.reflink:
                    return "<span md-inline='reflink' class='md-link'><span class='md-meta md-before'>[</span><a data-ref='" + i.escapeForPreWrap(e.ref || e.text) + "' href='#'>" + e.inner + "</a><span class='md-meta md-after'>]</span><span class='md-meta md-before'>[</span><span class='md-content'>" + e.ref + "</span><span class='md-meta md-after'>]</span></span>";
                case c.attr:
                    return "<span md-inline='attr' class='md-attr'>" + i.escape(e.text) + "</span>";
                case c.emoji:
                    return "<span md-inline='emoji' data-content='" + e.text + "' class='md-emoji' >​<span data-emoji='" + e.inner + "' class='md-emoji-span'></span><span class='md-meta'>:" + e.text + ":</span>​</span>";
                case c.inline_math:
                    return e.text = e.text.replace(/\u200B*/g, ""), !/^\$+$/.exec(e.text) && svgCache[e.text] ? "<span class='md-inline-math' md-inline='inline_math' pattern='" + e.pattern + "'><span class='md-before md-meta'>" + e.pattern + "</span><span class='inline-math-svg math-jax-postprocess'>" + svgCache[e.text] + "</span><span class='md-math-after-sym'></span><span class='md-after md-meta'>" + e.pattern + "</span></span>" : "<span class='md-inline-math' md-inline='inline_math' pattern='" + e.pattern + "'><span class='md-math-tex inline-math-svg math-jax-preprocess'>" + i.escape(e.text) + "</span></span>";
                case c.subscript:
                    return "<sub md-inline='subscript'><span class='md-meta md-before'>~</span>" + e.inner + "<span class='md-meta md-after'>~</span></sub>";
                case c.superscript:
                    return "<sup md-inline='superscript'><span class='md-meta md-before'>^</span>" + e.inner + "<span class='md-meta md-after'>^</span></sup>";
                case c.html_entity:
                    return "<span md-inline='html_entity' data-content='" + e.text + "' class='md-entity'><span class='md-meta'>" + i.escape(e.text) + "</span></span>";
                case c.pants:
                    return "<span md-inline='pants' data-text='" + d(e.text) + "' data-content='" + d(e.inner) + "' class='md-pants' data-desc='" + e.desc + "'><span class='md-meta-none' contenteditable='false'>" + (e.meta || "") + "</span>" + e.inner + "</span>";
                case c.tab:
                    return "<span md-inline='tab' class='md-tab'>" + e.inner + "</span>";
                case c.linebreak:
                    return "<span md-inline='linebreak' class='md-linebreak'>  <span class='md-linebreak-mark'></span>\n" + (e.isLast ? "<br/>" : "") + "</span>";
                case c.emptyline:
                    return File.option.ignoreLineBreak ? "<span md-inline='softbreak' class='md-softbreak md-softbreak-emptyline'><span contenteditable='false'></span>\n</span>" : "&#10;<span md-inline='emptyline' class='md-emptyline'>&#10;</span>";
                case c.softbreak:
                    return "<span md-inline='softbreak' class='md-softbreak'>" + (File.option.ignoreLineBreak ? "<span contenteditable='false'></span>" : "") + "\n</span>";
                default:
                    return console.sendError("unknow type " + e.type), e.text
            }
        }
    }), $__System.registerDynamic("16", [], !0, function (e, t, n) {
        this || self;
        var i = ["a", "abbr", "acronym", "address", "area", "article", "aside", "audio", "b", "bdi", "bdo", "big", "blink", "blockquote", "body", "br", "button", "canvas", "caption", "center", "cite", "code", "col", "colgroup", "content", "data", "datalist", "dd", "decorator", "del", "details", "dfn", "dir", "div", "dl", "dt", "element", "em", "fieldset", "figcaption", "figure", "font", "footer", "form", "h1", "h2", "h3", "h4", "h5", "h6", "header", "hgroup", "hr", "i", "img", "input", "ins", "kbd", "label", "legend", "li", "main", "map", "mark", "marquee", "menu", "menuitem", "meter", "nav", "nobr", "ol", "optgroup", "option", "output", "p", "pre", "progress", "q", "rp", "rt", "ruby", "s", "samp", "section", "select", "shadow", "small", "source", "spacer", "span", "strike", "strong", "style", "sub", "summary", "sup", "table", "tbody", "td", "template", "textarea", "tfoot", "th", "thead", "time", "tr", "track", "tt", "u", "ul", "var", "video", "wbr", "iframe", "dialog", "embed"],
            r = ["svg", "a", "altglyph", "altglyphdef", "altglyphitem", "animatecolor", "animatemotion", "animatetransform", "audio", "canvas", "circle", "clippath", "defs", "desc", "ellipse", "filter", "font", "g", "glyph", "glyphref", "hkern", "image", "line", "lineargradient", "marker", "mask", "metadata", "mpath", "path", "pattern", "polygon", "polyline", "radialgradient", "rect", "stop", "style", "switch", "symbol", "text", "textpath", "title", "tref", "tspan", "video", "view", "vkern"],
            o = ["feBlend", "feColorMatrix", "feComponentTransfer", "feComposite", "feConvolveMatrix", "feDiffuseLighting", "feDisplacementMap", "feDistantLight", "feFlood", "feFuncA", "feFuncB", "feFuncG", "feFuncR", "feGaussianBlur", "feMerge", "feMergeNode", "feMorphology", "feOffset", "fePointLight", "feSpecularLighting", "feSpotLight", "feTile", "feTurbulence"],
            a = ["math", "menclose", "merror", "mfenced", "mfrac", "mglyph", "mi", "mlabeledtr", "mmuliscripts", "mn", "mo", "mover", "mpadded", "mphantom", "mroot", "mrow", "ms", "mpspace", "msqrt", "mystyle", "msub", "msup", "msubsup", "mtable", "mtd", "mtext", "mtr", "munder", "munderover"],
            s = ["#text"],
            l = ["accept", "action", "align", "alt", "autocomplete", "background", "bgcolor", "border", "cellpadding", "cellspacing", "checked", "cite", "class", "clear", "color", "cols", "colspan", "coords", "crossorigin", "datetime", "default", "dir", "disabled", "download", "enctype", "face", "for", "headers", "height", "hidden", "high", "href", "hreflang", "id", "integrity", "ismap", "label", "lang", "list", "loop", "low", "max", "maxlength", "media", "method", "min", "multiple", "name", "noshade", "novalidate", "nowrap", "open", "optimum", "pattern", "placeholder", "poster", "preload", "pubdate", "radiogroup", "readonly", "rel", "required", "rev", "reversed", "role", "rows", "rowspan", "spellcheck", "scope", "selected", "shape", "size", "sizes", "span", "srclang", "start", "src", "srcset", "step", "style", "summary", "tabindex", "title", "type", "usemap", "valign", "value", "width", "xmlns", "charset", "async", "srcdoc"],
            c = ["accent-height", "accumulate", "additivive", "alignment-baseline", "ascent", "attributename", "attributetype", "azimuth", "basefrequency", "baseline-shift", "begin", "bias", "by", "class", "clip", "clip-path", "clip-rule", "color", "color-interpolation", "color-interpolation-filters", "color-profile", "color-rendering", "cx", "cy", "d", "dx", "dy", "diffuseconstant", "direction", "display", "divisor", "dur", "edgemode", "elevation", "end", "fill", "fill-opacity", "fill-rule", "filter", "flood-color", "flood-opacity", "font-family", "font-size", "font-size-adjust", "font-stretch", "font-style", "font-variant", "font-weight", "fx", "fy", "g1", "g2", "glyph-name", "glyphref", "gradientunits", "gradienttransform", "height", "href", "id", "image-rendering", "in", "in2", "k", "k1", "k2", "k3", "k4", "kerning", "keypoints", "keysplines", "keytimes", "lang", "lengthadjust", "letter-spacing", "kernelmatrix", "kernelunitlength", "lighting-color", "local", "marker-end", "marker-mid", "marker-start", "markerheight", "markerunits", "markerwidth", "maskcontentunits", "maskunits", "max", "mask", "media", "method", "mode", "min", "name", "numoctaves", "offset", "operator", "opacity", "order", "orient", "orientation", "origin", "overflow", "paint-order", "path", "pathlength", "patterncontentunits", "patterntransform", "patternunits", "points", "preservealpha", "preserveaspectratio", "r", "rx", "ry", "radius", "refx", "refy", "repeatcount", "repeatdur", "restart", "result", "rotate", "scale", "seed", "shape-rendering", "specularconstant", "specularexponent", "spreadmethod", "stddeviation", "stitchtiles", "stop-color", "stop-opacity", "stroke-dasharray", "stroke-dashoffset", "stroke-linecap", "stroke-linejoin", "stroke-miterlimit", "stroke-opacity", "stroke", "stroke-width", "style", "surfacescale", "tabindex", "targetx", "targety", "transform", "text-anchor", "text-decoration", "text-rendering", "textlength", "type", "u1", "u2", "unicode", "values", "viewbox", "visibility", "vert-adv-y", "vert-origin-x", "vert-origin-y", "width", "word-spacing", "wrap", "writing-mode", "xchannelselector", "ychannelselector", "x", "x1", "x2", "xmlns", "y", "y1", "y2", "z", "zoomandpan"],
            d = ["accent", "accentunder", "align", "bevelled", "close", "columnsalign", "columnlines", "columnspan", "denomalign", "depth", "dir", "display", "displaystyle", "fence", "frame", "height", "href", "id", "largeop", "length", "linethickness", "lspace", "lquote", "mathbackground", "mathcolor", "mathsize", "mathvariant", "maxsize", "minsize", "movablelimits", "notation", "numalign", "open", "rowalign", "rowlines", "rowspacing", "rowspan", "rspace", "rquote", "scriptlevel", "scriptminsize", "scriptsizemultiplier", "selection", "separator", "separators", "stretchy", "subscriptshift", "supscriptshift", "symmetric", "voffset", "width", "xmlns"],
            u = ["xlink:href", "xml:id", "xlink:title", "xml:space", "xmlns:xlink"];

        function h(e, t) {
            for (var n = t.length; n--;) "string" == typeof t[n] && (t[n] = t[n].toLowerCase()), e[t[n]] = !0;
            return e
        }

        function f(e) {
            var t = {}, n = void 0;
            for (n in e) Object.prototype.hasOwnProperty.call(e, n) && (t[n] = e[n]);
            return t
        }

        var p = /\{\{[\s\S]*|[\s\S]*\}\}/gm, m = /<%[\s\S]*|[\s\S]*%>/gm, g = /^data-[\-\w.\u00B7-\uFFFF]/,
            v = /^aria-[\-\w]+$/,
            y = /^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,
            b = /^(?:\w+script|data):/i, w = /[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,
            C = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) {
                return typeof e
            } : function (e) {
                return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
            };

        function x(e) {
            if (Array.isArray(e)) {
                for (var t = 0, n = Array(e.length); t < e.length; t++) n[t] = e[t];
                return n
            }
            return Array.from(e)
        }

        var k = function () {
            return "undefined" == typeof window ? null : window
        };
        var S = function e() {
            var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : k(), n = function (t) {
                return e(t)
            };
            if (n.version = "1.0.4", n.removed = [], !t || !t.document || 9 !== t.document.nodeType) return n.isSupported = !1, n;
            var S = t.document, E = !1, F = !1, _ = t.document, T = t.DocumentFragment, M = t.HTMLTemplateElement,
                A = t.Node, N = t.NodeFilter, L = t.NamedNodeMap,
                R = void 0 === L ? t.NamedNodeMap || t.MozNamedAttrMap : L, D = t.Text, O = t.Comment, I = t.DOMParser,
                P = t.XMLHttpRequest, B = void 0 === P ? t.XMLHttpRequest : P, $ = t.encodeURI,
                H = void 0 === $ ? t.encodeURI : $;
            if ("function" == typeof M) {
                var U = _.createElement("template");
                U.content && U.content.ownerDocument && (_ = U.content.ownerDocument)
            }
            var j = _, W = j.implementation, q = j.createNodeIterator, z = j.getElementsByTagName,
                V = j.createDocumentFragment, K = S.importNode, Y = {};
            n.isSupported = W && void 0 !== W.createHTMLDocument && 9 !== _.documentMode;
            var Q = p, G = m, J = g, X = v, Z = b, ee = w, te = y, ne = null,
                ie = h({}, [].concat(x(i), x(r), x(o), x(a), x(s))), re = null,
                oe = h({}, [].concat(x(l), x(c), x(d), x(u))), ae = null, se = null, le = !0, ce = !0, de = !1, ue = !1,
                he = !1, fe = !1, pe = !1, me = !1, ge = !1, ve = !1, ye = !1, be = !0, we = !0, Ce = {},
                xe = h({}, ["audio", "head", "math", "script", "style", "template", "svg", "video"]),
                ke = h({}, ["audio", "video", "img", "source", "image", "iframe"]),
                Se = h({}, ["alt", "class", "for", "id", "label", "name", "pattern", "placeholder", "summary", "title", "value", "style", "xmlns"]),
                Ee = null, Fe = _.createElement("form"), _e = function (e) {
                    "object" !== (void 0 === e ? "undefined" : C(e)) && (e = {}), ne = "ALLOWED_TAGS" in e ? h({}, e.ALLOWED_TAGS) : ie, re = "ALLOWED_ATTR" in e ? h({}, e.ALLOWED_ATTR) : oe, ae = "FORBID_TAGS" in e ? h({}, e.FORBID_TAGS) : {}, se = "FORBID_ATTR" in e ? h({}, e.FORBID_ATTR) : {}, Ce = "USE_PROFILES" in e && e.USE_PROFILES, le = !1 !== e.ALLOW_ARIA_ATTR, ce = !1 !== e.ALLOW_DATA_ATTR, de = e.ALLOW_UNKNOWN_PROTOCOLS || !1, ue = e.SAFE_FOR_JQUERY || !1, he = e.SAFE_FOR_TEMPLATES || !1, fe = e.WHOLE_DOCUMENT || !1, ge = e.RETURN_DOM || !1, ve = e.RETURN_DOM_FRAGMENT || !1, ye = e.RETURN_DOM_IMPORT || !1, me = e.FORCE_BODY || !1, be = !1 !== e.SANITIZE_DOM, we = !1 !== e.KEEP_CONTENT, te = e.ALLOWED_URI_REGEXP || te, he && (ce = !1), ve && (ge = !0), Ce && (ne = h({}, [].concat(x(s))), re = [], !0 === Ce.html && (h(ne, i), h(re, l)), !0 === Ce.svg && (h(ne, r), h(re, c), h(re, u)), !0 === Ce.svgFilters && (h(ne, o), h(re, c), h(re, u)), !0 === Ce.mathMl && (h(ne, a), h(re, d), h(re, u))), e.ADD_TAGS && (ne === ie && (ne = f(ne)), h(ne, e.ADD_TAGS)), e.ADD_ATTR && (re === oe && (re = f(re)), h(re, e.ADD_ATTR)), e.ADD_URI_SAFE_ATTR && h(Se, e.ADD_URI_SAFE_ATTR), we && (ne["#text"] = !0), Object && "freeze" in Object && Object.freeze(e), Ee = e
                }, Te = function (e) {
                    n.removed.push({element: e});
                    try {
                        e.parentNode.removeChild(e)
                    } catch (t) {
                        e.outerHTML = ""
                    }
                }, Me = function (e, t) {
                    try {
                        n.removed.push({attribute: t.getAttributeNode(e), from: t})
                    } catch (e) {
                        n.removed.push({attribute: null, from: t})
                    }
                    t.removeAttribute(e)
                }, Ae = function (e) {
                    var t = void 0, n = void 0;
                    if (me && (e = "<remove></remove>" + e), F) {
                        try {
                            e = H(e)
                        } catch (e) {
                        }
                        var i = new B;
                        i.responseType = "document", i.open("GET", "data:text/html;charset=utf-8," + e, !1), i.send(null), t = i.response
                    }
                    if (E) try {
                        t = (new I).parseFromString(e, "text/html")
                    } catch (e) {
                    }
                    return t && t.documentElement || ((n = (t = W.createHTMLDocument("")).body).parentNode.removeChild(n.parentNode.firstElementChild), n.outerHTML = e), z.call(t, fe ? "html" : "body")[0]
                };
            n.isSupported && function () {
                var e = Ae('<svg><g onload="this.parentNode.remove()"></g></svg>');
                e.querySelector("svg") || (F = !0);
                try {
                    (e = Ae('<svg><p><style><img src="</style><img src=x onerror=alert(1)//">')).querySelector("svg img") && (E = !0)
                } catch (e) {
                }
            }();
            var Ne = function (e) {
                return q.call(e.ownerDocument || e, e, N.SHOW_ELEMENT | N.SHOW_COMMENT | N.SHOW_TEXT, function () {
                    return N.FILTER_ACCEPT
                }, !1)
            }, Le = function (e) {
                return "object" === (void 0 === A ? "undefined" : C(A)) ? e instanceof A : e && "object" === (void 0 === e ? "undefined" : C(e)) && "number" == typeof e.nodeType && "string" == typeof e.nodeName
            }, Re = function (e, t, i) {
                Y[e] && Y[e].forEach(function (e) {
                    e.call(n, t, i, Ee)
                })
            }, De = function (e) {
                var t = void 0;
                if (Re("beforeSanitizeElements", e, null), !((i = e) instanceof D || i instanceof O || "string" == typeof i.nodeName && "string" == typeof i.textContent && "function" == typeof i.removeChild && i.attributes instanceof R && "function" == typeof i.removeAttribute && "function" == typeof i.setAttribute)) return Te(e), !0;
                var i, r = e.nodeName.toLocaleLowerCase();
                if (Re("uponSanitizeElement", e, {tagName: r, allowedTags: ne}), !ne[r] || ae[r]) {
                    if (we && !xe[r] && "function" == typeof e.insertAdjacentHTML) try {
                        e.insertAdjacentHTML("AfterEnd", e.innerHTML)
                    } catch (e) {
                    }
                    return Te(e), !0
                }
                return !ue || e.firstElementChild || e.content && e.content.firstElementChild || !/</g.test(e.textContent) || (n.removed.push({element: e.cloneNode()}), e.innerHTML = e.textContent.replace(/</g, "&lt;")), he && 3 === e.nodeType && (t = (t = (t = e.textContent).replace(Q, " ")).replace(G, " "), e.textContent !== t && (n.removed.push({element: e.cloneNode()}), e.textContent = t)), Re("afterSanitizeElements", e, null), !1
            }, Oe = function (e) {
                var t = void 0, i = void 0, r = void 0, o = void 0, a = void 0, s = void 0, l = void 0;
                if (Re("beforeSanitizeAttributes", e, null), s = e.attributes) {
                    var c = {attrName: "", attrValue: "", keepAttr: !0, allowedAttributes: re};
                    for (l = s.length; l--;) {
                        if (i = (t = s[l]).name, r = t.value.trim(), o = i.toLocaleLowerCase(), c.attrName = o, c.attrValue = r, c.keepAttr = !0, Re("uponSanitizeAttribute", e, c), r = c.attrValue, "name" === o && "IMG" === e.nodeName && s.id) a = s.id, s = Array.prototype.slice.apply(s), Me("id", e), Me(i, e), s.indexOf(a) > l && e.setAttribute("id", a.value); else {
                            if ("INPUT" === e.nodeName && "type" === o && "file" === r && (re[o] || !se[o])) continue;
                            "id" === i && e.setAttribute(i, ""), Me(i, e)
                        }
                        if (c.keepAttr && (!be || "id" !== o && "name" !== o || !(r in _ || r in Fe))) {
                            if (he && (r = (r = r.replace(Q, " ")).replace(G, " ")), ce && J.test(o)) ; else if (le && X.test(o)) ; else {
                                if (!re[o] || se[o]) continue;
                                if (Se[o]) ; else if (te.test(r.replace(ee, ""))) ; else if ("src" !== o && "xlink:href" !== o || 0 !== r.indexOf("data:") || !ke[e.nodeName.toLocaleLowerCase()]) if (de && !Z.test(r.replace(ee, ""))) ; else if (r) continue
                            }
                            try {
                                e.setAttribute(i, r), n.removed.pop()
                            } catch (e) {
                            }
                        }
                    }
                    Re("afterSanitizeAttributes", e, null)
                }
            }, Ie = function e(t) {
                var n = void 0, i = Ne(t);
                for (Re("beforeSanitizeShadowDOM", t, null); n = i.nextNode();) Re("uponSanitizeShadowNode", n, null), De(n) || (n.content instanceof T && e(n.content), Oe(n));
                Re("afterSanitizeShadowDOM", t, null)
            };
            return n.sanitize = function (e, i) {
                var r = void 0, o = void 0, a = void 0, s = void 0, l = void 0;
                if (e || (e = "\x3c!--\x3e"), "string" != typeof e && !Le(e)) {
                    if ("function" != typeof e.toString) throw new TypeError("toString is not a function");
                    if ("string" != typeof(e = e.toString())) throw new TypeError("dirty is not a string, aborting")
                }
                if (!n.isSupported) {
                    if ("object" === C(t.toStaticHTML) || "function" == typeof t.toStaticHTML) {
                        if ("string" == typeof e) return t.toStaticHTML(e);
                        if (Le(e)) return t.toStaticHTML(e.outerHTML)
                    }
                    return e
                }
                if (pe || _e(i), n.removed = [], e instanceof A) 1 === (o = (r = Ae("\x3c!--\x3e")).ownerDocument.importNode(e, !0)).nodeType && "BODY" === o.nodeName ? r = o : r.appendChild(o); else {
                    if (!ge && !fe && -1 === e.indexOf("<")) return e;
                    if (!(r = Ae(e))) return ge ? null : ""
                }
                me && Te(r.firstChild);
                for (var c = Ne(r); a = c.nextNode();) 3 === a.nodeType && a === s || De(a) || (a.content instanceof T && Ie(a.content), Oe(a), s = a);
                if (ge) {
                    if (ve) for (l = V.call(r.ownerDocument); r.firstChild;) l.appendChild(r.firstChild); else l = r;
                    return ye && (l = K.call(S, l, !0)), l
                }
                return fe ? r.outerHTML : r.innerHTML
            }, n.setConfig = function (e) {
                _e(e), pe = !0
            }, n.clearConfig = function () {
                Ee = null, pe = !1
            }, n.addHook = function (e, t) {
                "function" == typeof t && (Y[e] = Y[e] || [], Y[e].push(t))
            }, n.removeHook = function (e) {
                Y[e] && Y[e].pop()
            }, n.removeHooks = function (e) {
                Y[e] && (Y[e] = [])
            }, n.removeAllHooks = function () {
                Y = {}
            }, n
        }();
        n.exports = S
    }), $__System.registerDynamic("24", ["e"], !0, function (e, t, n) {
        this || self;
        var i = e("e"), r = function () {
            var e = "autoComplt-list", t = "autoComplt-hint", n = "active", r = 10, o = 100,
                a = {attr: "data-listStatus", open: "open"},
                s = {up: 38, down: 40, esc: 27, enter: 13, left: 37, right: 39}, l = {
                    autoCompltList: {
                        maxHeight: "none",
                        border: "1px solid #aaa",
                        padding: "0",
                        margin: "0",
                        zIndex: 99,
                        overflowX: "hidden",
                        overflowY: "auto",
                        display: "none",
                        position: "absolute",
                        backgroundColor: "#fff"
                    },
                    autoCompltHint: {
                        height: "1.5em",
                        padding: "2px 6px 2px 10px",
                        margin: "6px 0",
                        overflow: "hidden",
                        listStyleType: "none",
                        color: "#000",
                        backgroundColor: "#fff",
                        cursor: "default",
                        fontSize: "1em"
                    },
                    autoCompltHintSelected: {color: "#fff", backgroundColor: "#3399ff"}
                }, c = function (e) {
                    return (e = e || window.event).target = e.target || e.srcElement, e
                }, d = function (e, t, n) {
                    e.addEventListener ? e.addEventListener(t, n) : e.attachEvent && e.attachEvent("on" + t, n)
                }, u = function (e, t, n) {
                    e.removeEventListener ? e.removeEventListener(t, n) : e.detachEvent && e.detachEvent("on" + t, n)
                }, h = function (e, t) {
                    var n = null;
                    if (window.getComputedStyle) n = window.getComputedStyle(e)[t] || null; else if (e.currentStyle) {
                        n = e.currentStyle && e.currentStyle[t];
                        var i, r, o = e.style;
                        null == n && o && o[t] && (n = o[t]), i = o.left, (r = e.runtimeStyle && e.runtimeStyle.left) && (e.runtimeStyle.left = e.currentStyle.left), o.left = "fontSize" === t ? "1em" : n, n = o.pixelLeft + "px", o.left = i, r && (e.runtimeStyle.left = r)
                    }
                    return n
                }, f = {
                    buildElem: function (e) {
                        var t = document.createElement("DIV");
                        return t.innerHTML = e, t.firstChild.cloneNode(!0)
                    }, buildHint: function (e, n) {
                        if ("string" == typeof e && e) {
                            return e = this.buildElem('<li class="' + t + '">' + e + "</li>")
                        }
                        return null
                    }, buildList: function (t) {
                        return this.buildElem('<div class="auto-suggest-container md-tooltip-hide"><ul class="' + e + '"></ul></div>')
                    }
                }, p = function (e) {
                    this.uiElem = null, this.assocInput = e, this.mouseOnList = !1, this.pauseMouseoverSelection = !1, this.pauseMouseoutDeselection = !1, this.maxHintNum = r, this.styles = JSON.parse(JSON.stringify(l))
                };
            p.prototype.genList = function () {
                if (!this.uiElem) {
                    var e = this;
                    this.uiElem = f.buildList(this.styles), d(this.uiElem, "mouseover", function (t) {
                        t = c(t), e.isHint(t.target) && (e.select(t.target), e.autoScroll())
                    }), d(this.uiElem, "mouseout", function (t) {
                        t = c(t), e.deselect()
                    }), d(this.uiElem, "mousedown", function (t) {
                        e.mouseOnList = !0, "INPUT" !== e.assocInput.tagName && e.getSelected() && t.preventDefault()
                    }), d(this.uiElem, "mouseup", function (t) {
                        t = c(t), e.isHint(t.target) && (e.select(t.target), g(e.assocInput, e.getSelected().innerHTML), e.assocInput.autoComplt.close(), i(e.assocInput).trigger("change"))
                    }), document.body.appendChild(this.uiElem)
                }
            }, p.prototype.isHint = function (e) {
                if (e && "object" == typeof e && 1 === e.nodeType) {
                    return (" " + e.className + " ").indexOf(" " + t + " ") >= 0
                }
                return !1
            }, p.prototype.putHints = function (e) {
                var t = 0;
                if (e instanceof Array) {
                    var n, i, r = [];
                    for (i = Math.min(e.length, this.maxHintNum), n = 0; n < i; n++) r.push(f.buildHint(e[n], this.styles)), r[r.length - 1] || r.pop();
                    if (r.length > 0) {
                        var o = document.createDocumentFragment();
                        for (n = 0, t = r.length; n < t; n++) o.appendChild(r[n]);
                        this.clearHints(), this.genList(), this.uiElem.querySelector("ul").appendChild(o)
                    }
                }
                return t
            }, p.prototype.clearHints = function () {
                this.uiElem && (this.uiElem.querySelector("ul").innerHTML = "")
            }, p.prototype.isOpen = function () {
                return !!this.uiElem && this.uiElem.getAttribute(a.attr) == a.open
            }, p.prototype.open = function () {
                var e;
                if (this.uiElem && (e = this.uiElem.querySelectorAll("." + t)) && e.length) {
                    var n, i;
                    for (i = this.assocInput.getBoundingClientRect(), this.uiElem.style.top = (document.documentElement && document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + i.bottom + "px", this.uiElem.style.left = i.left + "px", i = i.right - i.left - parseFloat(h(this.uiElem, "borderLeftWidth")) - parseFloat(h(this.uiElem, "borderRightWidth")), this.uiElem.style.width = i + "px", n = 0, i = 0; n < e.length; n++) i += parseFloat(h(e[n], "height")) + parseFloat(h(e[n], "paddingTop")) + parseFloat(h(e[n], "paddingBottom")), e[n + 1] && (i += Math.max(parseFloat(h(e[n], "marginBottom")), parseFloat(h(e[n + 1], "marginTop"))));
                    i += parseFloat(h(e[0], "marginTop")) + parseFloat(h(e[e.length - 1], "marginBottom")), this.uiElem.style.height = i + 1 + "px", this.uiElem.setAttribute(a.attr, a.open), this.uiElem.style.display = "block"
                }
            }, p.prototype.close = function () {
                this.uiElem && (this.mouseOnList = !1, this.uiElem.parentNode.removeChild(this.uiElem), this.uiElem = null, i(this.assocInput).trigger("change"))
            }, p.prototype.autoScroll = function () {
                var e = this.getSelected();
                if (e) {
                    var t, n = 0, i = 0, r = e.clientHeight, o = parseFloat(h(e, "marginTop")),
                        a = parseFloat(h(e, "marginBottom"));
                    for (i = r + ((t = e.previousSibling) ? Math.max(o, a) : o); t;) n += r, n += (t = t.previousSibling) ? Math.max(o, a) : o;
                    (this.uiElem.clientHeight + this.uiElem.scrollTop - n < i || n - this.uiElem.scrollTop < i) && (this.uiElem.scrollTop = n)
                }
            }, p.prototype.select = function (e) {
                if (this.uiElem) {
                    var i = null;
                    if (this.isHint(e)) i = e; else if ("number" == typeof e && (e >= 0 || -1 === e)) {
                        var r = this.uiElem.querySelectorAll("." + t);
                        r.length > 0 && (i = r[i = -1 === (i = +e) || i > r.length - 1 ? r.length - 1 : i])
                    }
                    null !== i && (this.deselect(), i.className += " " + n)
                }
            }, p.prototype.deselect = function () {
                if (this.uiElem) {
                    var e = this.getSelected();
                    e && (e.className = t)
                }
            }, p.prototype.getSelected = function () {
                return this.uiElem ? this.uiElem.querySelector("." + n) || null : null
            };
            var m = function (e) {
                return "INPUT" == e.tagName ? e.value : e.textContent
            }, g = function (e, t) {
                if ("INPUT" == e.tagName) e.value = t; else if (e.textContent = t, t) {
                    var n = document.createRange();
                    n.setStart(e.childNodes[0], t.length), n.setEnd(e.childNodes[0], t.length);
                    var i = window.getSelection();
                    i.removeAllRanges(), i.addRange(n)
                }
            };
            return {
                enable: function (e, t) {
                    if (e && 1 === e.nodeType && !e.autoComplt) {
                        e.autoComplt = {};
                        var n = o, r = !0, a = "", l = null, c = new p(e), h = function () {
                            if (r) {
                                var e = c.getSelected();
                                g(this, e ? e.innerHTML : a)
                            }
                        }, f = function (t) {
                            c.mouseOnList && "INPUT" == e.tagName && (e.focus(), c.mouseOnList = !1), e.autoComplt.close()
                        }, v = function (t) {
                            if (r) if ("keydown" == t.type) {
                                if (t.keyCode === s.enter) return t.preventDefault();
                                if (c.isOpen() && (t.keyCode === s.up || t.keyCode === s.down)) {
                                    var o = c.getSelected();
                                    t.keyCode === s.up ? (t.preventDefault(), o ? o.previousSibling ? c.select(o.previousSibling) : c.deselect() : c.select(-1)) : t.keyCode === s.down && (t.preventDefault(), o ? o.nextSibling ? c.select(o.nextSibling) : c.deselect() : c.select(0)), c.autoScroll(), h.call(e)
                                }
                            } else if ("keyup" == t.type) {
                                var d = !1;
                                switch (t.keyCode) {
                                    case s.up:
                                    case s.down:
                                        t.preventDefault();
                                        break;
                                    case s.left:
                                    case s.right:
                                        break;
                                    case s.esc:
                                        c.isOpen() && (e.value = a, e.autoComplt.close());
                                        break;
                                    case s.enter:
                                        c.isOpen() && (h.call(e), e.autoComplt.close(), i(e).trigger("change"));
                                        break;
                                    default:
                                        d = !0
                                }
                                d && function () {
                                    if (m(this).length > 0 && r && "function" == typeof l && a !== m(this)) {
                                        var t = {};
                                        t.call = function () {
                                            l.call(t.that, t.compltTarget, t.openHint)
                                        }, t.that = e, t.compltTarget = a = m(this), t.openHint = function (n) {
                                            if (t.compltTarget === a) if (c.putHints(n)) {
                                                var r = i(e).offset();
                                                r.top += e.offsetHeight + 5, c.open(), i(c.uiElem).css("min-width", 100), i(c.uiElem).offset(r)
                                            } else t.that.autoComplt.close()
                                        }, setTimeout(t.call, n)
                                    }
                                }.call(e)
                            }
                        };
                        return e.autoComplt.setHintsFetcher = function (e) {
                            return "function" == typeof e && (l = e, !0)
                        }, e.autoComplt.config = function (e) {
                            if (e instanceof Object) {
                                var t, i = {};
                                return (t = Math.floor(e.delay)) > 0 && (n = i.delay = t), (t = Math.floor(e.maxHintNum)) > 0 && (c.maxHintNum = i.maxHintNum = t), i
                            }
                            return !1
                        }, e.autoComplt.close = function () {
                            a = "", c.close()
                        }, e.autoComplt.enable = function () {
                            r = !0
                        }, e.autoComplt.disable = function () {
                            this.close(), r = !1
                        }, e.autoComplt.destroy = function () {
                            u(e, "blur", f), u(e, "keyup", v), u(e, "keydown", v), this.close(), delete e.autoComplt
                        }, d(e, "blur", f), d(e, "keyup", v), d(e, "keydown", v), t instanceof Object && (e.autoComplt.config(t), e.autoComplt.setHintsFetcher(t.hintsFetcher)), e
                    }
                    return null
                }
            }
        }();
        n.exports = r
    }), $__System.registerDynamic("1e", [], !0, function (e, t, n) {
        this || self;
        n.exports = function () {
            "use strict";
            var e = navigator.userAgent, t = navigator.platform, n = /gecko\/\d/i.test(e), i = /MSIE \d/.test(e),
                r = /Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(e), o = /Edge\/(\d+)/.exec(e), a = i || r || o,
                s = a && (i ? document.documentMode || 6 : +(o || r)[1]), l = !o && /WebKit\//.test(e),
                c = l && /Qt\/\d+\.\d+/.test(e), d = !o && /Chrome\//.test(e), u = /Opera\//.test(e),
                h = /Apple Computer/.test(navigator.vendor), f = /Mac OS X 1\d\D([8-9]|\d\d)\D/.test(e),
                p = /PhantomJS/.test(e), m = !o && /AppleWebKit/.test(e) && /Mobile\/\w+/.test(e),
                g = /Android/.test(e), v = m || g || /webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(e),
                y = m || /Mac/.test(t), b = /\bCrOS\b/.test(e), w = /win/i.test(t),
                C = u && e.match(/Version\/(\d*\.\d*)/);
            C && (C = Number(C[1])), C && C >= 15 && (u = !1, l = !0);
            var x = y && (c || u && (null == C || C < 12.11)), k = n || a && s >= 9;

            function S(e) {
                return new RegExp("(^|\\s)" + e + "(?:$|\\s)\\s*")
            }

            var E = function (e, t) {
                var n = e.className, i = S(t).exec(n);
                if (i) {
                    var r = n.slice(i.index + i[0].length);
                    e.className = n.slice(0, i.index) + (r ? i[1] + r : "")
                }
            };

            function F(e) {
                for (var t = e.childNodes.length; t > 0; --t) e.removeChild(e.firstChild);
                return e
            }

            function _(e, t) {
                return F(e).appendChild(t)
            }

            function T(e, t, n, i) {
                var r = document.createElement(e);
                if (n && (r.className = n), i && (r.style.cssText = i), "string" == typeof t) r.appendChild(document.createTextNode(t)); else if (t) for (var o = 0; o < t.length; ++o) r.appendChild(t[o]);
                return r
            }

            function M(e, t, n, i) {
                var r = T(e, t, n, i);
                return r.setAttribute("role", "presentation"), r
            }

            var A;
            A = document.createRange ? function (e, t, n, i) {
                var r = document.createRange();
                return r.setEnd(i || e, n), r.setStart(e, t), r
            } : function (e, t, n) {
                var i = document.body.createTextRange();
                try {
                    i.moveToElementText(e.parentNode)
                } catch (e) {
                    return i
                }
                return i.collapse(!0), i.moveEnd("character", n), i.moveStart("character", t), i
            };

            function N(e, t) {
                if (3 == t.nodeType && (t = t.parentNode), e.contains) return e.contains(t);
                do {
                    if (11 == t.nodeType && (t = t.host), t == e) return !0
                } while (t = t.parentNode)
            }

            function L() {
                var e;
                try {
                    e = document.activeElement
                } catch (t) {
                    e = document.body || null
                }
                for (; e && e.shadowRoot && e.shadowRoot.activeElement;) e = e.shadowRoot.activeElement;
                return e
            }

            function R(e, t) {
                var n = e.className;
                S(t).test(n) || (e.className += (n ? " " : "") + t)
            }

            function D(e, t) {
                for (var n = e.split(" "), i = 0; i < n.length; i++) n[i] && !S(n[i]).test(t) && (t += " " + n[i]);
                return t
            }

            var O = function (e) {
                e.select()
            };
            m ? O = function (e) {
                e.selectionStart = 0, e.selectionEnd = e.value.length
            } : a && (O = function (e) {
                try {
                    e.select()
                } catch (e) {
                }
            });

            function I(e) {
                var t = Array.prototype.slice.call(arguments, 1);
                return function () {
                    return e.apply(null, t)
                }
            }

            function P(e, t, n) {
                t || (t = {});
                for (var i in e) !e.hasOwnProperty(i) || !1 === n && t.hasOwnProperty(i) || (t[i] = e[i]);
                return t
            }

            function B(e, t, n, i, r) {
                null == t && -1 == (t = e.search(/[^\s\u00a0]/)) && (t = e.length);
                for (var o = i || 0, a = r || 0; ;) {
                    var s = e.indexOf("\t", o);
                    if (s < 0 || s >= t) return a + (t - o);
                    a += s - o, a += n - a % n, o = s + 1
                }
            }

            var $ = function () {
                this.id = null
            };
            $.prototype.set = function (e, t) {
                clearTimeout(this.id), this.id = setTimeout(t, e)
            };

            function H(e, t) {
                for (var n = 0; n < e.length; ++n) if (e[n] == t) return n;
                return -1
            }

            var U = 0, j = {
                toString: function () {
                    return "CodeMirror.Pass"
                }
            }, W = {scroll: !1}, q = {origin: "*mouse"}, z = {origin: "+move"};

            function V(e, t, n) {
                for (var i = 0, r = 0; ;) {
                    var o = e.indexOf("\t", i);
                    -1 == o && (o = e.length);
                    var a = o - i;
                    if (o == e.length || r + a >= t) return i + Math.min(a, t - r);
                    if (r += o - i, i = o + 1, (r += n - r % n) >= t) return i
                }
            }

            var K = [""];

            function Y(e) {
                for (; K.length <= e;) K.push(Q(K) + " ");
                return K[e]
            }

            function Q(e) {
                return e[e.length - 1]
            }

            function G(e, t) {
                for (var n = [], i = 0; i < e.length; i++) n[i] = t(e[i], i);
                return n
            }

            function J() {
            }

            function X(e, t) {
                var n;
                return Object.create ? n = Object.create(e) : (J.prototype = e, n = new J), t && P(t, n), n
            }

            var Z = /[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;

            function ee(e) {
                return /\w/.test(e) || e > "" && (e.toUpperCase() != e.toLowerCase() || Z.test(e))
            }

            function te(e, t) {
                return t ? !!(t.source.indexOf("\\w") > -1 && ee(e)) || t.test(e) : ee(e)
            }

            function ne(e) {
                for (var t in e) if (e.hasOwnProperty(t) && e[t]) return !1;
                return !0
            }

            var ie = /[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;

            function re(e) {
                return e.charCodeAt(0) >= 768 && ie.test(e)
            }

            function oe(e, t, n) {
                for (; (n < 0 ? t > 0 : t < e.length) && re(e.charAt(t));) t += n;
                return t
            }

            function ae(e, t, n) {
                for (; ;) {
                    if (Math.abs(t - n) <= 1) return e(t) ? t : n;
                    var i = Math.floor((t + n) / 2);
                    e(i) ? n = i : t = i
                }
            }

            function se(e, t) {
                if ((t -= e.first) < 0 || t >= e.size) throw new Error("There is no line " + (t + e.first) + " in the document.");
                for (var n = e; !n.lines;) for (var i = 0; ; ++i) {
                    var r = n.children[i], o = r.chunkSize();
                    if (t < o) {
                        n = r;
                        break
                    }
                    t -= o
                }
                return n.lines[t]
            }

            function le(e, t, n) {
                var i = [], r = t.line;
                return e.iter(t.line, n.line + 1, function (e) {
                    var o = e.text;
                    r == n.line && (o = o.slice(0, n.ch)), r == t.line && (o = o.slice(t.ch)), i.push(o), ++r
                }), i
            }

            function ce(e, t, n) {
                var i = [];
                return e.iter(t, n, function (e) {
                    i.push(e.text)
                }), i
            }

            function de(e, t) {
                var n = t - e.height;
                if (n) for (var i = e; i; i = i.parent) i.height += n
            }

            function ue(e) {
                if (null == e.parent) return null;
                for (var t = e.parent, n = H(t.lines, e), i = t.parent; i; t = i, i = i.parent) for (var r = 0; i.children[r] != t; ++r) n += i.children[r].chunkSize();
                return n + t.first
            }

            function he(e, t) {
                var n = e.first;
                e:do {
                    for (var i = 0; i < e.children.length; ++i) {
                        var r = e.children[i], o = r.height;
                        if (t < o) {
                            e = r;
                            continue e
                        }
                        t -= o, n += r.chunkSize()
                    }
                    return n
                } while (!e.lines);
                for (var a = 0; a < e.lines.length; ++a) {
                    var s = e.lines[a].height;
                    if (t < s) break;
                    t -= s
                }
                return n + a
            }

            function fe(e, t) {
                return t >= e.first && t < e.first + e.size
            }

            function pe(e, t) {
                return String(e.lineNumberFormatter(t + e.firstLineNumber))
            }

            function me(e, t, n) {
                if (void 0 === n && (n = null), !(this instanceof me)) return new me(e, t, n);
                this.line = e, this.ch = t, this.sticky = n
            }

            function ge(e, t) {
                return e.line - t.line || e.ch - t.ch
            }

            function ve(e, t) {
                return e.sticky == t.sticky && 0 == ge(e, t)
            }

            function ye(e) {
                return me(e.line, e.ch)
            }

            function be(e, t) {
                return ge(e, t) < 0 ? t : e
            }

            function we(e, t) {
                return ge(e, t) < 0 ? e : t
            }

            function Ce(e, t) {
                return Math.max(e.first, Math.min(t, e.first + e.size - 1))
            }

            function xe(e, t) {
                if (t.line < e.first) return me(e.first, 0);
                var n = e.first + e.size - 1;
                return t.line > n ? me(n, se(e, n).text.length) : function (e, t) {
                    var n = e.ch;
                    return null == n || n > t ? me(e.line, t) : n < 0 ? me(e.line, 0) : e
                }(t, se(e, t.line).text.length)
            }

            function ke(e, t) {
                for (var n = [], i = 0; i < t.length; i++) n[i] = xe(e, t[i]);
                return n
            }

            var Se = !1, Ee = !1;

            function Fe(e, t, n) {
                this.marker = e, this.from = t, this.to = n
            }

            function _e(e, t) {
                if (e) for (var n = 0; n < e.length; ++n) {
                    var i = e[n];
                    if (i.marker == t) return i
                }
            }

            function Te(e, t) {
                for (var n, i = 0; i < e.length; ++i) e[i] != t && (n || (n = [])).push(e[i]);
                return n
            }

            function Me(e, t) {
                if (t.full) return null;
                var n = fe(e, t.from.line) && se(e, t.from.line).markedSpans,
                    i = fe(e, t.to.line) && se(e, t.to.line).markedSpans;
                if (!n && !i) return null;
                var r = t.from.ch, o = t.to.ch, a = 0 == ge(t.from, t.to), s = function (e, t, n) {
                    var i;
                    if (e) for (var r = 0; r < e.length; ++r) {
                        var o = e[r], a = o.marker;
                        if (null == o.from || (a.inclusiveLeft ? o.from <= t : o.from < t) || o.from == t && "bookmark" == a.type && (!n || !o.marker.insertLeft)) {
                            var s = null == o.to || (a.inclusiveRight ? o.to >= t : o.to > t);
                            (i || (i = [])).push(new Fe(a, o.from, s ? null : o.to))
                        }
                    }
                    return i
                }(n, r, a), l = function (e, t, n) {
                    var i;
                    if (e) for (var r = 0; r < e.length; ++r) {
                        var o = e[r], a = o.marker;
                        if (null == o.to || (a.inclusiveRight ? o.to >= t : o.to > t) || o.from == t && "bookmark" == a.type && (!n || o.marker.insertLeft)) {
                            var s = null == o.from || (a.inclusiveLeft ? o.from <= t : o.from < t);
                            (i || (i = [])).push(new Fe(a, s ? null : o.from - t, null == o.to ? null : o.to - t))
                        }
                    }
                    return i
                }(i, o, a), c = 1 == t.text.length, d = Q(t.text).length + (c ? r : 0);
                if (s) for (var u = 0; u < s.length; ++u) {
                    var h = s[u];
                    if (null == h.to) {
                        var f = _e(l, h.marker);
                        f ? c && (h.to = null == f.to ? null : f.to + d) : h.to = r
                    }
                }
                if (l) for (var p = 0; p < l.length; ++p) {
                    var m = l[p];
                    if (null != m.to && (m.to += d), null == m.from) {
                        _e(s, m.marker) || (m.from = d, c && (s || (s = [])).push(m))
                    } else m.from += d, c && (s || (s = [])).push(m)
                }
                s && (s = Ae(s)), l && l != s && (l = Ae(l));
                var g = [s];
                if (!c) {
                    var v, y = t.text.length - 2;
                    if (y > 0 && s) for (var b = 0; b < s.length; ++b) null == s[b].to && (v || (v = [])).push(new Fe(s[b].marker, null, null));
                    for (var w = 0; w < y; ++w) g.push(v);
                    g.push(l)
                }
                return g
            }

            function Ae(e) {
                for (var t = 0; t < e.length; ++t) {
                    var n = e[t];
                    null != n.from && n.from == n.to && !1 !== n.marker.clearWhenEmpty && e.splice(t--, 1)
                }
                return e.length ? e : null
            }

            function Ne(e) {
                var t = e.markedSpans;
                if (t) {
                    for (var n = 0; n < t.length; ++n) t[n].marker.detachLine(e);
                    e.markedSpans = null
                }
            }

            function Le(e, t) {
                if (t) {
                    for (var n = 0; n < t.length; ++n) t[n].marker.attachLine(e);
                    e.markedSpans = t
                }
            }

            function Re(e) {
                return e.inclusiveLeft ? -1 : 0
            }

            function De(e) {
                return e.inclusiveRight ? 1 : 0
            }

            function Oe(e, t) {
                var n = e.lines.length - t.lines.length;
                if (0 != n) return n;
                var i = e.find(), r = t.find(), o = ge(i.from, r.from) || Re(e) - Re(t);
                if (o) return -o;
                var a = ge(i.to, r.to) || De(e) - De(t);
                return a || t.id - e.id
            }

            function Ie(e, t) {
                var n, i = Ee && e.markedSpans;
                if (i) for (var r = void 0, o = 0; o < i.length; ++o) (r = i[o]).marker.collapsed && null == (t ? r.from : r.to) && (!n || Oe(n, r.marker) < 0) && (n = r.marker);
                return n
            }

            function Pe(e) {
                return Ie(e, !0)
            }

            function Be(e) {
                return Ie(e, !1)
            }

            function $e(e, t, n, i, r) {
                var o = se(e, t), a = Ee && o.markedSpans;
                if (a) for (var s = 0; s < a.length; ++s) {
                    var l = a[s];
                    if (l.marker.collapsed) {
                        var c = l.marker.find(0), d = ge(c.from, n) || Re(l.marker) - Re(r),
                            u = ge(c.to, i) || De(l.marker) - De(r);
                        if (!(d >= 0 && u <= 0 || d <= 0 && u >= 0) && (d <= 0 && (l.marker.inclusiveRight && r.inclusiveLeft ? ge(c.to, n) >= 0 : ge(c.to, n) > 0) || d >= 0 && (l.marker.inclusiveRight && r.inclusiveLeft ? ge(c.from, i) <= 0 : ge(c.from, i) < 0))) return !0
                    }
                }
            }

            function He(e) {
                for (var t; t = Pe(e);) e = t.find(-1, !0).line;
                return e
            }

            function Ue(e, t) {
                var n = se(e, t), i = He(n);
                return n == i ? t : ue(i)
            }

            function je(e, t) {
                if (t > e.lastLine()) return t;
                var n, i = se(e, t);
                if (!We(e, i)) return t;
                for (; n = Be(i);) i = n.find(1, !0).line;
                return ue(i) + 1
            }

            function We(e, t) {
                var n = Ee && t.markedSpans;
                if (n) for (var i = void 0, r = 0; r < n.length; ++r) if ((i = n[r]).marker.collapsed) {
                    if (null == i.from) return !0;
                    if (!i.marker.widgetNode && 0 == i.from && i.marker.inclusiveLeft && qe(e, t, i)) return !0
                }
            }

            function qe(e, t, n) {
                if (null == n.to) {
                    var i = n.marker.find(1, !0);
                    return qe(e, i.line, _e(i.line.markedSpans, n.marker))
                }
                if (n.marker.inclusiveRight && n.to == t.text.length) return !0;
                for (var r = void 0, o = 0; o < t.markedSpans.length; ++o) if ((r = t.markedSpans[o]).marker.collapsed && !r.marker.widgetNode && r.from == n.to && (null == r.to || r.to != n.from) && (r.marker.inclusiveLeft || n.marker.inclusiveRight) && qe(e, t, r)) return !0
            }

            function ze(e) {
                for (var t = 0, n = (e = He(e)).parent, i = 0; i < n.lines.length; ++i) {
                    var r = n.lines[i];
                    if (r == e) break;
                    t += r.height
                }
                for (var o = n.parent; o; n = o, o = n.parent) for (var a = 0; a < o.children.length; ++a) {
                    var s = o.children[a];
                    if (s == n) break;
                    t += s.height
                }
                return t
            }

            function Ve(e) {
                if (0 == e.height) return 0;
                for (var t, n = e.text.length, i = e; t = Pe(i);) {
                    var r = t.find(0, !0);
                    i = r.from.line, n += r.from.ch - r.to.ch
                }
                for (i = e; t = Be(i);) {
                    var o = t.find(0, !0);
                    n -= i.text.length - o.from.ch, n += (i = o.to.line).text.length - o.to.ch
                }
                return n
            }

            function Ke(e) {
                var t = e.display, n = e.doc;
                t.maxLine = se(n, n.first), t.maxLineLength = Ve(t.maxLine), t.maxLineChanged = !0, n.iter(function (e) {
                    var n = Ve(e);
                    n > t.maxLineLength && (t.maxLineLength = n, t.maxLine = e)
                })
            }

            var Ye = null;

            function Qe(e, t, n) {
                var i;
                Ye = null;
                for (var r = 0; r < e.length; ++r) {
                    var o = e[r];
                    if (o.from < t && o.to > t) return r;
                    o.to == t && (o.from != o.to && "before" == n ? i = r : Ye = r), o.from == t && (o.from != o.to && "before" != n ? i = r : Ye = r)
                }
                return null != i ? i : Ye
            }

            var Ge = function () {
                var e = "bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",
                    t = "nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111";
                var n = /[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/, i = /[stwN]/, r = /[LRr]/, o = /[Lb1n]/,
                    a = /[1n]/;

                function s(e, t, n) {
                    this.level = e, this.from = t, this.to = n
                }

                return function (l, c) {
                    var d = "ltr" == c ? "L" : "R";
                    if (0 == l.length || "ltr" == c && !n.test(l)) return !1;
                    for (var u = l.length, h = [], f = 0; f < u; ++f) h.push((p = l.charCodeAt(f)) <= 247 ? e.charAt(p) : 1424 <= p && p <= 1524 ? "R" : 1536 <= p && p <= 1785 ? t.charAt(p - 1536) : 1774 <= p && p <= 2220 ? "r" : 8192 <= p && p <= 8203 ? "w" : 8204 == p ? "b" : "L");
                    for (var p, m = 0, g = d; m < u; ++m) {
                        var v = h[m];
                        "m" == v ? h[m] = g : g = v
                    }
                    for (var y = 0, b = d; y < u; ++y) {
                        var w = h[y];
                        "1" == w && "r" == b ? h[y] = "n" : r.test(w) && (b = w, "r" == w && (h[y] = "R"))
                    }
                    for (var C = 1, x = h[0]; C < u - 1; ++C) {
                        var k = h[C];
                        "+" == k && "1" == x && "1" == h[C + 1] ? h[C] = "1" : "," != k || x != h[C + 1] || "1" != x && "n" != x || (h[C] = x), x = k
                    }
                    for (var S = 0; S < u; ++S) {
                        var E = h[S];
                        if ("," == E) h[S] = "N"; else if ("%" == E) {
                            var F = void 0;
                            for (F = S + 1; F < u && "%" == h[F]; ++F) ;
                            for (var _ = S && "!" == h[S - 1] || F < u && "1" == h[F] ? "1" : "N", T = S; T < F; ++T) h[T] = _;
                            S = F - 1
                        }
                    }
                    for (var M = 0, A = d; M < u; ++M) {
                        var N = h[M];
                        "L" == A && "1" == N ? h[M] = "L" : r.test(N) && (A = N)
                    }
                    for (var L = 0; L < u; ++L) if (i.test(h[L])) {
                        var R = void 0;
                        for (R = L + 1; R < u && i.test(h[R]); ++R) ;
                        for (var D = "L" == (L ? h[L - 1] : d), O = D == ("L" == (R < u ? h[R] : d)) ? D ? "L" : "R" : d, I = L; I < R; ++I) h[I] = O;
                        L = R - 1
                    }
                    for (var P, B = [], $ = 0; $ < u;) if (o.test(h[$])) {
                        var H = $;
                        for (++$; $ < u && o.test(h[$]); ++$) ;
                        B.push(new s(0, H, $))
                    } else {
                        var U = $, j = B.length;
                        for (++$; $ < u && "L" != h[$]; ++$) ;
                        for (var W = U; W < $;) if (a.test(h[W])) {
                            U < W && B.splice(j, 0, new s(1, U, W));
                            var q = W;
                            for (++W; W < $ && a.test(h[W]); ++W) ;
                            B.splice(j, 0, new s(2, q, W)), U = W
                        } else ++W;
                        U < $ && B.splice(j, 0, new s(1, U, $))
                    }
                    return 1 == B[0].level && (P = l.match(/^\s+/)) && (B[0].from = P[0].length, B.unshift(new s(0, 0, P[0].length))), 1 == Q(B).level && (P = l.match(/\s+$/)) && (Q(B).to -= P[0].length, B.push(new s(0, u - P[0].length, u))), "rtl" == c ? B.reverse() : B
                }
            }();

            function Je(e, t) {
                var n = e.order;
                return null == n && (n = e.order = Ge(e.text, t)), n
            }

            function Xe(e, t, n) {
                var i = oe(e.text, t + n, n);
                return i < 0 || i > e.text.length ? null : i
            }

            function Ze(e, t, n) {
                var i = Xe(e, t.ch, n);
                return null == i ? null : new me(t.line, i, n < 0 ? "after" : "before")
            }

            function et(e, t, n, i, r) {
                if (e) {
                    var o = Je(n, t.doc.direction);
                    if (o) {
                        var a, s = r < 0 ? Q(o) : o[0], l = r < 0 == (1 == s.level) ? "after" : "before";
                        if (s.level > 0) {
                            var c = An(t, n);
                            a = r < 0 ? n.text.length - 1 : 0;
                            var d = Nn(t, c, a).top;
                            a = ae(function (e) {
                                return Nn(t, c, e).top == d
                            }, r < 0 == (1 == s.level) ? s.from : s.to - 1, a), "before" == l && (a = Xe(n, a, 1))
                        } else a = r < 0 ? s.to : s.from;
                        return new me(i, a, l)
                    }
                }
                return new me(i, r < 0 ? n.text.length : 0, r < 0 ? "before" : "after")
            }

            function tt(e, t, n, i) {
                var r = Je(t, e.doc.direction);
                if (!r) return Ze(t, n, i);
                n.ch >= t.text.length ? (n.ch = t.text.length, n.sticky = "before") : n.ch <= 0 && (n.ch = 0, n.sticky = "after");
                var o = Qe(r, n.ch, n.sticky), a = r[o];
                if ("ltr" == e.doc.direction && a.level % 2 == 0 && (i > 0 ? a.to > n.ch : a.from < n.ch)) return Ze(t, n, i);
                var s, l = function (e, n) {
                    return Xe(t, e instanceof me ? e.ch : e, n)
                }, c = function (n) {
                    return e.options.lineWrapping ? (s = s || An(e, t), function (e, t, n, i) {
                        var r = Hn(e, t, Nn(e, n, i), "line").top;
                        return Kn(e, t, n, r)
                    }(e, t, s, n)) : {begin: 0, end: t.text.length}
                }, d = c("before" == n.sticky ? l(n, -1) : n.ch);
                if ("rtl" == e.doc.direction || 1 == a.level) {
                    var u = 1 == a.level == i < 0, h = l(n, u ? 1 : -1);
                    if (null != h && (u ? h <= a.to && h <= d.end : h >= a.from && h >= d.begin)) {
                        var f = u ? "before" : "after";
                        return new me(n.line, h, f)
                    }
                }
                var p = function (e, t, i) {
                    for (var o = function (e, t) {
                        return t ? new me(n.line, l(e, 1), "before") : new me(n.line, e, "after")
                    }; e >= 0 && e < r.length; e += t) {
                        var a = r[e], s = t > 0 == (1 != a.level), c = s ? i.begin : l(i.end, -1);
                        if (a.from <= c && c < a.to) return o(c, s);
                        if (c = s ? a.from : l(a.to, -1), i.begin <= c && c < i.end) return o(c, s)
                    }
                }, m = p(o + i, i, d);
                if (m) return m;
                var g = i > 0 ? d.end : l(d.begin, -1);
                return null == g || i > 0 && g == t.text.length || !(m = p(i > 0 ? 0 : r.length - 1, i, c(g))) ? null : m
            }

            var nt = [], it = function (e, t, n) {
                if (e.addEventListener) e.addEventListener(t, n, !1, {passive: !0}); else if (e.attachEvent) e.attachEvent("on" + t, n); else {
                    var i = e._handlers || (e._handlers = {});
                    i[t] = (i[t] || nt).concat(n)
                }
            };

            function rt(e, t) {
                return e._handlers && e._handlers[t] || nt
            }

            function ot(e, t, n) {
                if (e.removeEventListener) e.removeEventListener(t, n, !1); else if (e.detachEvent) e.detachEvent("on" + t, n); else {
                    var i = e._handlers, r = i && i[t];
                    if (r) {
                        var o = H(r, n);
                        o > -1 && (i[t] = r.slice(0, o).concat(r.slice(o + 1)))
                    }
                }
            }

            function at(e, t) {
                var n = rt(e, t);
                if (n.length) for (var i = Array.prototype.slice.call(arguments, 2), r = 0; r < n.length; ++r) n[r].apply(null, i)
            }

            function st(e, t, n) {
                return "string" == typeof t && (t = {
                    type: t, preventDefault: function () {
                        this.defaultPrevented = !0
                    }
                }), at(e, n || t.type, e, t), ft(t) || t.codemirrorIgnore
            }

            function lt(e) {
                var t = e._handlers && e._handlers.cursorActivity;
                if (t) for (var n = e.curOp.cursorActivityHandlers || (e.curOp.cursorActivityHandlers = []), i = 0; i < t.length; ++i) -1 == H(n, t[i]) && n.push(t[i])
            }

            function ct(e, t) {
                return rt(e, t).length > 0
            }

            function dt(e) {
                e.prototype.on = function (e, t) {
                    it(this, e, t)
                }, e.prototype.off = function (e, t) {
                    ot(this, e, t)
                }
            }

            function ut(e) {
                e.preventDefault ? e.preventDefault() : e.returnValue = !1
            }

            function ht(e) {
                e.stopPropagation ? e.stopPropagation() : e.cancelBubble = !0
            }

            function ft(e) {
                return null != e.defaultPrevented ? e.defaultPrevented : 0 == e.returnValue
            }

            function pt(e) {
                ut(e), ht(e)
            }

            function mt(e) {
                return e.target || e.srcElement
            }

            function gt(e) {
                var t = e.which;
                return null == t && (1 & e.button ? t = 1 : 2 & e.button ? t = 3 : 4 & e.button && (t = 2)), y && e.ctrlKey && 1 == t && (t = 3), t
            }

            var vt, yt = function () {
                if (a && s < 9) return !1;
                var e = T("div");
                return "draggable" in e || "dragDrop" in e
            }();

            function bt(e) {
                if (null == vt) {
                    var t = T("span", "​");
                    _(e, T("span", [t, document.createTextNode("x")])), 0 != e.firstChild.offsetHeight && (vt = t.offsetWidth <= 1 && t.offsetHeight > 2 && !(a && s < 8))
                }
                var n = vt ? T("span", "​") : T("span", " ", null, "display: inline-block; width: 1px; margin-right: -1px");
                return n.setAttribute("cm-text", ""), n
            }

            var wt;

            function Ct(e) {
                if (null != wt) return wt;
                var t = _(e, document.createTextNode("AخA")), n = A(t, 0, 1).getBoundingClientRect(),
                    i = A(t, 1, 2).getBoundingClientRect();
                return F(e), !(!n || n.left == n.right) && (wt = i.right - n.right < 3)
            }

            var xt = 3 != "\n\nb".split(/\n/).length ? function (e) {
                for (var t = 0, n = [], i = e.length; t <= i;) {
                    var r = e.indexOf("\n", t);
                    -1 == r && (r = e.length);
                    var o = e.slice(t, "\r" == e.charAt(r - 1) ? r - 1 : r), a = o.indexOf("\r");
                    -1 != a ? (n.push(o.slice(0, a)), t += a + 1) : (n.push(o), t = r + 1)
                }
                return n
            } : function (e) {
                return e.split(/\r\n?|\n/)
            }, kt = window.getSelection ? function (e) {
                try {
                    return e.selectionStart != e.selectionEnd
                } catch (e) {
                    return !1
                }
            } : function (e) {
                var t;
                try {
                    t = e.ownerDocument.selection.createRange()
                } catch (e) {
                }
                return !(!t || t.parentElement() != e) && 0 != t.compareEndPoints("StartToEnd", t)
            }, St = function () {
                var e = T("div");
                return "oncopy" in e || (e.setAttribute("oncopy", "return;"), "function" == typeof e.oncopy)
            }(), Et = null;
            var Ft = {}, _t = {};

            function Tt(e) {
                if ("string" == typeof e && _t.hasOwnProperty(e)) e = _t[e]; else if (e && "string" == typeof e.name && _t.hasOwnProperty(e.name)) {
                    var t = _t[e.name];
                    "string" == typeof t && (t = {name: t}), (e = X(t, e)).name = t.name
                } else {
                    if ("string" == typeof e && /^[\w\-]+\/[\w\-]+\+xml$/.test(e)) return Tt("application/xml");
                    if ("string" == typeof e && /^[\w\-]+\/[\w\-]+\+json$/.test(e)) return Tt("application/json")
                }
                return "string" == typeof e ? {name: e} : e || {name: "null"}
            }

            function Mt(e, t) {
                t = Tt(t);
                var n = Ft[t.name];
                if (!n) return Mt(e, "text/plain");
                var i = n(e, t);
                if (At.hasOwnProperty(t.name)) {
                    var r = At[t.name];
                    for (var o in r) r.hasOwnProperty(o) && (i.hasOwnProperty(o) && (i["_" + o] = i[o]), i[o] = r[o])
                }
                if (i.name = t.name, t.helperType && (i.helperType = t.helperType), t.modeProps) for (var a in t.modeProps) i[a] = t.modeProps[a];
                return i
            }

            var At = {};

            function Nt(e, t) {
                P(t, At.hasOwnProperty(e) ? At[e] : At[e] = {})
            }

            function Lt(e, t) {
                if (!0 === t) return t;
                if (e.copyState) return e.copyState(t);
                var n = {};
                for (var i in t) {
                    var r = t[i];
                    r instanceof Array && (r = r.concat([])), n[i] = r
                }
                return n
            }

            function Rt(e, t) {
                for (var n; e.innerMode && (n = e.innerMode(t)) && n.mode && n.mode != e;) t = n.state, e = n.mode;
                return n && !n.mode && (n = void 0), n || {mode: e, state: t}
            }

            function Dt(e, t, n) {
                return !e.startState || e.startState(t, n)
            }

            var Ot = function (e, t) {
                this.pos = this.start = 0, this.string = e, this.tabSize = t || 8, this.lastColumnPos = this.lastColumnValue = 0, this.lineStart = 0
            };
            Ot.prototype.eol = function () {
                return this.pos >= this.string.length
            }, Ot.prototype.sol = function () {
                return this.pos == this.lineStart
            }, Ot.prototype.peek = function () {
                return this.string.charAt(this.pos) || void 0
            }, Ot.prototype.next = function () {
                if (this.pos < this.string.length) return this.string.charAt(this.pos++)
            }, Ot.prototype.eat = function (e) {
                var t = this.string.charAt(this.pos);
                if ("string" == typeof e ? t == e : t && (e.test ? e.test(t) : e(t))) return ++this.pos, t
            }, Ot.prototype.eatWhile = function (e) {
                for (var t = this.pos; this.eat(e);) ;
                return this.pos > t
            }, Ot.prototype.eatSpace = function () {
                for (var e = this.pos; /[\s\u00a0]/.test(this.string.charAt(this.pos));) ++this.pos;
                return this.pos > e
            }, Ot.prototype.skipToEnd = function () {
                this.pos = this.string.length
            }, Ot.prototype.skipTo = function (e) {
                var t = this.string.indexOf(e, this.pos);
                if (t > -1) return this.pos = t, !0
            }, Ot.prototype.backUp = function (e) {
                this.pos -= e
            }, Ot.prototype.column = function () {
                return this.lastColumnPos < this.start && (this.lastColumnValue = B(this.string, this.start, this.tabSize, this.lastColumnPos, this.lastColumnValue), this.lastColumnPos = this.start), this.lastColumnValue - (this.lineStart ? B(this.string, this.lineStart, this.tabSize) : 0)
            }, Ot.prototype.indentation = function () {
                return B(this.string, null, this.tabSize) - (this.lineStart ? B(this.string, this.lineStart, this.tabSize) : 0)
            }, Ot.prototype.match = function (e, t, n) {
                if ("string" != typeof e) {
                    var i = this.string.slice(this.pos).match(e);
                    return i && i.index > 0 ? null : (i && !1 !== t && (this.pos += i[0].length), i)
                }
                var r = function (e) {
                    return n ? e.toLowerCase() : e
                };
                if (r(this.string.substr(this.pos, e.length)) == r(e)) return !1 !== t && (this.pos += e.length), !0
            }, Ot.prototype.current = function () {
                return this.string.slice(this.start, this.pos)
            }, Ot.prototype.hideFirstChars = function (e, t) {
                this.lineStart += e;
                try {
                    return t()
                } finally {
                    this.lineStart -= e
                }
            };

            function It(e, t, n, i) {
                var r = [e.state.modeGen], o = {}, a = ue(t);
                "object" == typeof n && (n.lineBefore = e.getLine(a - 1), n.lineAfter = e.getLine(a + 1)), qt(e, t.text, e.doc.mode, n, function (e, t) {
                    return r.push(e, t)
                }, o, i);
                for (var s = function (i) {
                    var a = e.state.overlays[i], s = 1, l = 0;
                    qt(e, t.text, a.mode, "visiblespace" !== a.mode.name || n, function (e, t) {
                        for (var n = s; l < e;) {
                            var i = r[s];
                            i > e && r.splice(s, 1, e, r[s + 1], i), s += 2, l = Math.min(e, i)
                        }
                        if (t) if (a.opaque) r.splice(n, s - n, e, "overlay " + t), s = n + 2; else for (; n < s; n += 2) {
                            var o = r[n + 1];
                            r[n + 1] = (o ? o + " " : "") + "overlay " + t
                        }
                    }, o)
                }, l = 0; l < e.state.overlays.length; ++l) s(l);
                return {styles: r, classes: o.bgClass || o.textClass ? o : null}
            }

            function Pt(e, t, n) {
                if (!t.styles || t.styles[0] != e.state.modeGen) {
                    var i = Bt(e, ue(t)),
                        r = It(e, t, t.text.length > e.options.maxHighlightLength ? Lt(e.doc.mode, i) : i);
                    t.stateAfter = i, t.styles = r.styles, r.classes ? t.styleClasses = r.classes : t.styleClasses && (t.styleClasses = null), n === e.doc.frontier && e.doc.frontier++
                }
                return t.styles
            }

            function Bt(e, t, n) {
                var i = e.doc, r = e.display;
                if (!i.mode.startState) return !0;
                var o = function (e, t, n) {
                    for (var i, r, o = e.doc, a = n ? -1 : t - (e.doc.mode.innerMode ? 1e3 : 100), s = t; s > a; --s) {
                        if (s <= o.first) return o.first;
                        var l = se(o, s - 1);
                        if (l.stateAfter && (!n || s <= o.frontier)) return s;
                        var c = B(l.text, null, e.options.tabSize);
                        (null == r || i > c) && (r = s - 1, i = c)
                    }
                    return r
                }(e, t, n), a = o > i.first && se(i, o - 1).stateAfter;
                return a = a ? Lt(i.mode, a) : Dt(i.mode), i.iter(o, t, function (n) {
                    "object" == typeof a && (a.lineBefore = e.getLine(t - 1), a.lineAfter = e.getLine(t + 1)), $t(e, n.text, a);
                    var s = o == t - 1 || o % 5 == 0 || o >= r.viewFrom && o < r.viewTo;
                    n.stateAfter = s ? Lt(i.mode, a) : null, ++o
                }), n && (i.frontier = o), a
            }

            function $t(e, t, n, i) {
                var r = e.doc.mode, o = new Ot(t, e.options.tabSize);
                for (o.start = o.pos = i || 0, n.lineBefore = n.lineBefore || "", n.lineAfter = n.lineAfter || "", "" == t && Ht(r, n); !o.eol();) Ut(r, o, n), o.start = o.pos
            }

            function Ht(e, t) {
                if (e.blankLine) return e.blankLine(t);
                if (e.innerMode) {
                    var n = Rt(e, t);
                    return n.mode.blankLine ? n.mode.blankLine(n.state) : void 0
                }
            }

            function Ut(e, t, n, i) {
                for (var r = 0; r < 10; r++) {
                    i && (i[0] = Rt(e, n).mode);
                    var o = e.token(t, n);
                    if (t.pos > t.start) return o
                }
                if ("gfm" == e.name) return t.pos = t.start + 1, null;
                throw new Error("Mode " + e.name + " failed to advance stream.")
            }

            function jt(e, t, n, i) {
                var r, o = function (e) {
                    return {
                        start: u.start,
                        end: u.pos,
                        string: u.current(),
                        type: r || null,
                        state: e ? Lt(a.mode, d) : d
                    }
                }, a = e.doc, s = a.mode;
                t = xe(a, t);
                var l, c = se(a, t.line), d = Bt(e, t.line, n), u = new Ot(c.text, e.options.tabSize);
                for (i && (l = []); (i || u.pos < t.ch) && !u.eol();) u.start = u.pos, r = Ut(s, u, d), i && l.push(o(!0));
                return i ? l : o()
            }

            function Wt(e, t) {
                if (e) for (; ;) {
                    var n = e.match(/(?:^|\s+)line-(background-)?(\S+)/);
                    if (!n) break;
                    e = e.slice(0, n.index) + e.slice(n.index + n[0].length);
                    var i = n[1] ? "bgClass" : "textClass";
                    null == t[i] ? t[i] = n[2] : new RegExp("(?:^|s)" + n[2] + "(?:$|s)").test(t[i]) || (t[i] += " " + n[2])
                }
                return e
            }

            function qt(e, t, n, i, r, o, a) {
                var s = n.flattenSpans;
                null == s && (s = e.options.flattenSpans);
                var l, c = 0, d = null, u = new Ot(t, e.options.tabSize), h = e.options.addModeClass && [null];
                for ("" == t && Wt(Ht(n, i), o); !u.eol();) {
                    if (u.pos > e.options.maxHighlightLength ? (s = !1, a && $t(e, t, i, u.pos), u.pos = t.length, l = null) : l = Wt(Ut(n, u, i, h), o), h) {
                        var f = h[0].name;
                        f && (l = "m-" + (l ? f + " " + l : f))
                    }
                    if (!s || d != l) {
                        for (; c < u.start;) r(c = Math.min(u.start, c + 5e3), d);
                        d = l
                    }
                    u.start = u.pos
                }
                for (; c < u.pos;) {
                    var p = Math.min(u.pos, c + 5e3);
                    r(p, d), c = p
                }
            }

            var zt = function (e, t, n) {
                this.text = e, Le(this, t), this.height = n ? n(this) : 1
            };
            zt.prototype.lineNo = function () {
                return ue(this)
            }, dt(zt);
            var Vt = {}, Kt = {};

            function Yt(e, t) {
                if (!e || /^\s*$/.test(e)) return null;
                var n = t.addModeClass ? Kt : Vt;
                return n[e] || (n[e] = e.replace(/\S+/g, "cm-$&"))
            }

            function Qt(e, t) {
                var n = M("span", null, null, l ? "padding-right: .1px" : null), i = {
                    pre: M("pre", [n], "CodeMirror-line"),
                    content: n,
                    col: 0,
                    pos: 0,
                    cm: e,
                    trailingSpace: !1,
                    splitSpaces: (a || l) && e.getOption("lineWrapping")
                };
                t.measure = {};
                for (var r = 0; r <= (t.rest ? t.rest.length : 0); r++) {
                    var o = r ? t.rest[r - 1] : t.line, s = void 0;
                    i.pos = 0, i.addToken = Jt, Ct(e.display.measure) && (s = Je(o, e.doc.direction)) && (i.addToken = Xt(i.addToken, s)), i.map = [];
                    en(o, i, Pt(e, o, t != e.display.externalMeasured && ue(o))), o.styleClasses && (o.styleClasses.bgClass && (i.bgClass = D(o.styleClasses.bgClass, i.bgClass || "")), o.styleClasses.textClass && (i.textClass = D(o.styleClasses.textClass, i.textClass || ""))), 0 == i.map.length && i.map.push(0, 0, i.content.appendChild(bt(e.display.measure))), 0 == r ? (t.measure.map = i.map, t.measure.cache = {}) : ((t.measure.maps || (t.measure.maps = [])).push(i.map), (t.measure.caches || (t.measure.caches = [])).push({}))
                }
                if (l) {
                    var c = i.content.lastChild;
                    (/\bcm-tab\b/.test(c.className) || c.querySelector && c.querySelector(".cm-tab")) && (i.content.className = "cm-tab-wrap-hack")
                }
                return at(e, "renderLine", e, t.line, i.pre), i.pre.className && (i.textClass = D(i.pre.className, i.textClass || "")), i
            }

            function Gt(e) {
                var t = T("span", "•", "cm-invalidchar");
                return t.title = "\\u" + e.charCodeAt(0).toString(16), t.setAttribute("aria-label", t.title), t
            }

            function Jt(e, t, n, i, r, o, l) {
                if (t) {
                    var c, d = e.splitSpaces ? function (e, t) {
                        if (e.length > 1 && !/  /.test(e)) return e;
                        for (var n = t, i = "", r = 0; r < e.length; r++) {
                            var o = e.charAt(r);
                            " " != o || !n || r != e.length - 1 && 32 != e.charCodeAt(r + 1) || (o = " "), i += o, n = " " == o
                        }
                        return i
                    }(t, e.trailingSpace) : t, u = e.cm.state.specialChars, h = !1;
                    if (u.test(t)) {
                        c = document.createDocumentFragment();
                        for (var f = 0; ;) {
                            u.lastIndex = f;
                            var p = u.exec(t), m = p ? p.index - f : t.length - f;
                            if (m) {
                                var g = document.createTextNode(d.slice(f, f + m));
                                a && s < 9 ? c.appendChild(T("span", [g])) : c.appendChild(g), e.map.push(e.pos, e.pos + m, g), e.col += m, e.pos += m
                            }
                            if (!p) break;
                            f += m + 1;
                            var v = void 0;
                            if ("\t" == p[0]) {
                                var y = e.cm.options.tabSize, b = y - e.col % y;
                                (v = c.appendChild(T("span", Y(b), "cm-tab"))).setAttribute("role", "presentation"), v.setAttribute("cm-text", "\t"), e.col += b
                            } else "\r" == p[0] || "\n" == p[0] ? ((v = c.appendChild(T("span", "\r" == p[0] ? "␍" : "␤", "cm-invalidchar"))).setAttribute("cm-text", p[0]), e.col += 1) : ((v = e.cm.options.specialCharPlaceholder(p[0])).setAttribute("cm-text", p[0]), a && s < 9 ? c.appendChild(T("span", [v])) : c.appendChild(v), e.col += 1);
                            e.map.push(e.pos, e.pos + 1, v), e.pos++
                        }
                    } else e.col += t.length, c = document.createTextNode(d), e.map.push(e.pos, e.pos + t.length, c), a && s < 9 && (h = !0), e.pos += t.length;
                    if (e.trailingSpace = 32 == d.charCodeAt(t.length - 1), n || i || r || h || l) {
                        var w = n || "";
                        i && (w += i), r && (w += r);
                        var C = T("span", [c], w, l);
                        return o && (C.title = o), e.content.appendChild(C)
                    }
                    e.content.appendChild(c)
                }
            }

            function Xt(e, t) {
                return function (n, i, r, o, a, s, l) {
                    r = r ? r + " cm-force-border" : "cm-force-border";
                    for (var c = n.pos, d = c + i.length; ;) {
                        for (var u = void 0, h = 0; h < t.length && !((u = t[h]).to > c && u.from <= c); h++) ;
                        if (u.to >= d) return e(n, i, r, o, a, s, l);
                        e(n, i.slice(0, u.to - c), r, o, null, s, l), o = null, i = i.slice(u.to - c), c = u.to
                    }
                }
            }

            function Zt(e, t, n, i) {
                var r = !i && n.widgetNode;
                r && e.map.push(e.pos, e.pos + t, r), !i && e.cm.display.input.needsContentAttribute && (r || (r = e.content.appendChild(document.createElement("span"))), r.setAttribute("cm-marker", n.id)), r && (e.cm.display.input.setUneditable(r), e.content.appendChild(r)), e.pos += t, e.trailingSpace = !1
            }

            function en(e, t, n) {
                var i = e.markedSpans, r = e.text, o = 0;
                if (i) for (var a, s, l, c, d, u, h, f = r.length, p = 0, m = 1, g = "", v = 0; ;) {
                    if (v == p) {
                        l = c = d = u = s = "", h = null, v = 1 / 0;
                        for (var y = [], b = void 0, w = 0; w < i.length; ++w) {
                            var C = i[w], x = C.marker;
                            "bookmark" == x.type && C.from == p && x.widgetNode ? y.push(x) : C.from <= p && (null == C.to || C.to > p || x.collapsed && C.to == p && C.from == p) ? (null != C.to && C.to != p && v > C.to && (v = C.to, c = ""), x.className && (l += " " + x.className), x.css && (s = (s ? s + ";" : "") + x.css), x.startStyle && C.from == p && (d += " " + x.startStyle), x.endStyle && C.to == v && (b || (b = [])).push(x.endStyle, C.to), x.title && !u && (u = x.title), x.collapsed && (!h || Oe(h.marker, x) < 0) && (h = C)) : C.from > p && v > C.from && (v = C.from)
                        }
                        if (b) for (var k = 0; k < b.length; k += 2) b[k + 1] == v && (c += " " + b[k]);
                        if (!h || h.from == p) for (var S = 0; S < y.length; ++S) Zt(t, 0, y[S]);
                        if (h && (h.from || 0) == p) {
                            if (Zt(t, (null == h.to ? f + 1 : h.to) - p, h.marker, null == h.from), null == h.to) return;
                            h.to == p && (h = !1)
                        }
                    }
                    if (p >= f) break;
                    for (var E = Math.min(f, v); ;) {
                        if (g) {
                            var F = p + g.length;
                            if (!h) {
                                var _ = F > E ? g.slice(0, E - p) : g;
                                t.addToken(t, _, a ? a + l : l, d, p + _.length == v ? c : "", u, s)
                            }
                            if (F >= E) {
                                g = g.slice(E - p), p = E;
                                break
                            }
                            p = F, d = ""
                        }
                        g = r.slice(o, o = n[m++]), a = Yt(n[m++], t.cm.options)
                    }
                } else for (var T = 1; T < n.length; T += 2) t.addToken(t, r.slice(o, o = n[T]), Yt(n[T + 1], t.cm.options))
            }

            function tn(e, t, n) {
                this.line = t, this.rest = function (e) {
                    for (var t, n; t = Be(e);) e = t.find(1, !0).line, (n || (n = [])).push(e);
                    return n
                }(t), this.size = this.rest ? ue(Q(this.rest)) - n + 1 : 1, this.node = this.text = null, this.hidden = We(e, t)
            }

            function nn(e, t, n) {
                for (var i, r = [], o = t; o < n; o = i) {
                    var a = new tn(e.doc, se(e.doc, o), o);
                    i = o + a.size, r.push(a)
                }
                return r
            }

            var rn = null;
            var on = null;

            function an(e, t) {
                var n = rt(e, t);
                if (n.length) {
                    var i, r = Array.prototype.slice.call(arguments, 2);
                    rn ? i = rn.delayedCallbacks : on ? i = on : (i = on = [], setTimeout(sn, 0));
                    for (var o = function (e) {
                        i.push(function () {
                            return n[e].apply(null, r)
                        })
                    }, a = 0; a < n.length; ++a) o(a)
                }
            }

            function sn() {
                var e = on;
                on = null;
                for (var t = 0; t < e.length; ++t) e[t]()
            }

            function ln(e, t, n, i) {
                for (var r = 0; r < t.changes.length; r++) {
                    var o = t.changes[r];
                    "text" == o ? un(e, t) : "gutter" == o ? fn(e, t, n, i) : "class" == o ? hn(e, t) : "widget" == o && pn(e, t, i)
                }
                t.changes = null
            }

            function cn(e) {
                return e.node == e.text && (e.node = T("div", null, null, "position: relative"), e.text.parentNode && e.text.parentNode.replaceChild(e.node, e.text), e.node.appendChild(e.text), a && s < 8 && (e.node.style.zIndex = 2)), e.node
            }

            function dn(e, t) {
                var n = e.display.externalMeasured;
                return n && n.line == t.line ? (e.display.externalMeasured = null, t.measure = n.measure, n.built) : Qt(e, t)
            }

            function un(e, t) {
                var n = t.text.className, i = dn(e, t);
                t.text == t.node && (t.node = i.pre), t.text.parentNode.replaceChild(i.pre, t.text), t.text = i.pre, i.bgClass != t.bgClass || i.textClass != t.textClass ? (t.bgClass = i.bgClass, t.textClass = i.textClass, hn(e, t)) : n && (t.text.className = n)
            }

            function hn(e, t) {
                !function (e, t) {
                    var n = t.bgClass ? t.bgClass + " " + (t.line.bgClass || "") : t.line.bgClass;
                    if (n && (n += " CodeMirror-linebackground"), t.background) n ? t.background.className = n : (t.background.parentNode.removeChild(t.background), t.background = null); else if (n) {
                        var i = cn(t);
                        t.background = i.insertBefore(T("div", null, n), i.firstChild), e.display.input.setUneditable(t.background)
                    }
                }(e, t), t.line.wrapClass ? cn(t).className = t.line.wrapClass : t.node != t.text && (t.node.className = "");
                var n = t.textClass ? t.textClass + " " + (t.line.textClass || "") : t.line.textClass;
                t.text.className = n || ""
            }

            function fn(e, t, n, i) {
                if (t.gutter && (t.node.removeChild(t.gutter), t.gutter = null), t.gutterBackground && (t.node.removeChild(t.gutterBackground), t.gutterBackground = null), t.line.gutterClass) {
                    var r = cn(t);
                    t.gutterBackground = T("div", null, "CodeMirror-gutter-background " + t.line.gutterClass, "left: " + (e.options.fixedGutter ? i.fixedPos : -i.gutterTotalWidth) + "px; width: " + i.gutterTotalWidth + "px"), e.display.input.setUneditable(t.gutterBackground), r.insertBefore(t.gutterBackground, t.text)
                }
                var o = t.line.gutterMarkers;
                if (e.options.lineNumbers || o) {
                    var a = 0 === n || n === e.lineCount() - 1 || (n + 1) % 10 == 0 ? " CodeMirror-linenumber-show" : "",
                        s = cn(t),
                        l = t.gutter = T("div", null, "CodeMirror-gutter-wrapper", "left: " + (e.options.fixedGutter ? i.fixedPos : -i.gutterTotalWidth) + "px");
                    if (e.display.input.setUneditable(l), s.insertBefore(l, t.text), t.line.gutterClass && (l.className += " " + t.line.gutterClass), !e.options.lineNumbers || o && o["CodeMirror-linenumbers"] || (t.lineNumber = l.appendChild(T("div", pe(e.options, n), "CodeMirror-linenumber CodeMirror-gutter-elt" + a, "left: " + i.gutterLeft["CodeMirror-linenumbers"] + "px; width: " + e.display.lineNumInnerWidth + "px"))), o) for (var c = 0; c < e.options.gutters.length; ++c) {
                        var d = e.options.gutters[c], u = o.hasOwnProperty(d) && o[d];
                        u && l.appendChild(T("div", [u], "CodeMirror-gutter-elt", "left: " + i.gutterLeft[d] + "px; width: " + i.gutterWidth[d] + "px"))
                    }
                }
            }

            function pn(e, t, n) {
                t.alignable && (t.alignable = null);
                for (var i = t.node.firstChild, r = void 0; i; i = r) r = i.nextSibling, "CodeMirror-linewidget" == i.className && t.node.removeChild(i);
                gn(e, t, n)
            }

            function mn(e, t, n, i) {
                var r = dn(e, t);
                return t.text = t.node = r.pre, r.bgClass && (t.bgClass = r.bgClass), r.textClass && (t.textClass = r.textClass), hn(e, t), fn(e, t, n, i), gn(e, t, i), t.node
            }

            function gn(e, t, n) {
                if (vn(e, t.line, t, n, !0), t.rest) for (var i = 0; i < t.rest.length; i++) vn(e, t.rest[i], t, n, !1)
            }

            function vn(e, t, n, i, r) {
                if (t.widgets) for (var o = cn(n), a = 0, s = t.widgets; a < s.length; ++a) {
                    var l = s[a], c = T("div", [l.node], "CodeMirror-linewidget");
                    l.handleMouseEvents || c.setAttribute("cm-ignore-events", "true"), yn(l, c, n, i), e.display.input.setUneditable(c), r && l.above ? o.insertBefore(c, n.gutter || n.text) : o.appendChild(c), an(l, "redraw")
                }
            }

            function yn(e, t, n, i) {
                if (e.noHScroll) {
                    (n.alignable || (n.alignable = [])).push(t);
                    var r = i.wrapperWidth;
                    t.style.left = i.fixedPos + "px", e.coverGutter || (r -= i.gutterTotalWidth, t.style.paddingLeft = i.gutterTotalWidth + "px"), t.style.width = r + "px"
                }
                e.coverGutter && (t.style.zIndex = 5, t.style.position = "relative", e.noHScroll || (t.style.marginLeft = -i.gutterTotalWidth + "px"))
            }

            function bn(e) {
                if (null != e.height) return e.height;
                var t = e.doc.cm;
                if (!t) return 0;
                if (!N(document.body, e.node)) {
                    var n = "position: relative;";
                    e.coverGutter && (n += "margin-left: -" + t.display.gutters.offsetWidth + "px;"), e.noHScroll && (n += "width: " + t.display.wrapper.clientWidth + "px;"), _(t.display.measure, T("div", [e.node], null, n))
                }
                return e.height = e.node.parentNode.offsetHeight
            }

            function wn(e, t) {
                for (var n = mt(t); n != e.wrapper; n = n.parentNode) if (!n || 1 == n.nodeType && "true" == n.getAttribute("cm-ignore-events") || n.parentNode == e.sizer && n != e.mover) return !0
            }

            function Cn(e) {
                return e.lineSpace.offsetTop
            }

            function xn(e) {
                return e.mover.offsetHeight - e.lineSpace.offsetHeight
            }

            function kn(e) {
                if (e.cachedPaddingH) return e.cachedPaddingH;
                var t = _(e.measure, T("pre", "x")),
                    n = window.getComputedStyle ? window.getComputedStyle(t) : t.currentStyle,
                    i = {left: parseInt(n.paddingLeft), right: parseInt(n.paddingRight)};
                return isNaN(i.left) || isNaN(i.right) || (e.cachedPaddingH = i), i
            }

            function Sn(e) {
                return U - e.display.nativeBarWidth
            }

            function En(e) {
                return e.display.scroller.clientWidth - Sn(e) - e.display.barWidth
            }

            function Fn(e) {
                return e.display.scroller.clientHeight - Sn(e) - e.display.barHeight
            }

            function _n(e, t, n) {
                if (e.line == t) return {map: e.measure.map, cache: e.measure.cache};
                for (var i = 0; i < e.rest.length; i++) if (e.rest[i] == t) return {
                    map: e.measure.maps[i],
                    cache: e.measure.caches[i]
                };
                for (var r = 0; r < e.rest.length; r++) if (ue(e.rest[r]) > n) return {
                    map: e.measure.maps[r],
                    cache: e.measure.caches[r],
                    before: !0
                }
            }

            function Tn(e, t, n, i) {
                return Nn(e, An(e, t), n, i)
            }

            function Mn(e, t) {
                if (t >= e.display.viewFrom && t < e.display.viewTo) return e.display.view[ii(e, t)];
                var n = e.display.externalMeasured;
                return n && t >= n.lineN && t < n.lineN + n.size ? n : void 0
            }

            function An(e, t) {
                var n = ue(t), i = Mn(e, n);
                i && !i.text ? i = null : i && i.changes && (ln(e, i, n, Xn(e)), e.curOp.forceUpdate = !0), i || (i = function (e, t) {
                    var n = ue(t = He(t)), i = e.display.externalMeasured = new tn(e.doc, t, n);
                    i.lineN = n;
                    var r = i.built = Qt(e, i);
                    return i.text = r.pre, _(e.display.lineMeasure, r.pre), i
                }(e, t));
                var r = _n(i, t, n);
                return {line: t, view: i, rect: null, map: r.map, cache: r.cache, before: r.before, hasHeights: !1}
            }

            function Nn(e, t, n, i, r) {
                t.before && (n = -1);
                var o, l = n + (i || "");
                return t.cache.hasOwnProperty(l) ? o = t.cache[l] : (t.rect || (t.rect = t.view.text.getBoundingClientRect()), t.hasHeights || (!function (e, t, n) {
                    var i = e.options.lineWrapping, r = i && En(e);
                    if (!t.measure.heights || i && t.measure.width != r) {
                        var o = t.measure.heights = [];
                        if (i) {
                            t.measure.width = r;
                            for (var a = t.text.firstChild.getClientRects(), s = 0; s < a.length - 1; s++) {
                                var l = a[s], c = a[s + 1];
                                Math.abs(l.bottom - c.bottom) > 2 && o.push((l.bottom + c.top) / 2 - n.top)
                            }
                        }
                        o.push(n.bottom - n.top)
                    }
                }(e, t.view, t.rect), t.hasHeights = !0), (o = function (e, t, n, i) {
                    var r, o = Rn(t.map, n, i), l = o.node, c = o.start, d = o.end, u = o.collapse;
                    if (3 == l.nodeType) {
                        for (var h = 0; h < 4; h++) {
                            for (; c && re(t.line.text.charAt(o.coverStart + c));) --c;
                            for (; o.coverStart + d < o.coverEnd && re(t.line.text.charAt(o.coverStart + d));) ++d;
                            if ((r = a && s < 9 && 0 == c && d == o.coverEnd - o.coverStart ? l.parentNode.getBoundingClientRect() : Dn(A(l, c, d).getClientRects(), i)).left || r.right || 0 == c) break;
                            d = c, c -= 1, u = "right"
                        }
                        a && s < 11 && (r = function (e, t) {
                            if (!window.screen || null == screen.logicalXDPI || screen.logicalXDPI == screen.deviceXDPI || !function (e) {
                                if (null != Et) return Et;
                                var t = _(e, T("span", "x")), n = t.getBoundingClientRect(),
                                    i = A(t, 0, 1).getBoundingClientRect();
                                return Et = Math.abs(n.left - i.left) > 1
                            }(e)) return t;
                            var n = screen.logicalXDPI / screen.deviceXDPI, i = screen.logicalYDPI / screen.deviceYDPI;
                            return {left: t.left * n, right: t.right * n, top: t.top * i, bottom: t.bottom * i}
                        }(e.display.measure, r))
                    } else {
                        c > 0 && (u = i = "right");
                        var f;
                        r = e.options.lineWrapping && (f = l.getClientRects()).length > 1 ? f["right" == i ? f.length - 1 : 0] : l.getBoundingClientRect()
                    }
                    if (a && s < 9 && !c && (!r || !r.left && !r.right)) {
                        var p = l.parentNode.getClientRects()[0];
                        r = p ? {left: p.left, right: p.left + Jn(e.display), top: p.top, bottom: p.bottom} : Ln
                    }
                    for (var m = r.top - t.rect.top, g = r.bottom - t.rect.top, v = (m + g) / 2, y = t.view.measure.heights, b = 0; b < y.length - 1 && !(v < y[b]); b++) ;
                    var w = b ? y[b - 1] : 0, C = y[b], x = {
                        left: ("right" == u ? r.right : r.left) - t.rect.left,
                        right: ("left" == u ? r.left : r.right) - t.rect.left,
                        top: w,
                        bottom: C
                    };
                    r.left || r.right || (x.bogus = !0);
                    e.options.singleCursorHeightPerLine || (x.rtop = m, x.rbottom = g);
                    return x
                }(e, t, n, i)).bogus || (t.cache[l] = o)), {
                    left: o.left,
                    right: o.right,
                    top: r ? o.rtop : o.top,
                    bottom: r ? o.rbottom : o.bottom
                }
            }

            var Ln = {left: 0, right: 0, top: 0, bottom: 0};

            function Rn(e, t, n) {
                for (var i, r, o, a, s, l, c = 0; c < e.length; c += 3) if (s = e[c], l = e[c + 1], t < s ? (r = 0, o = 1, a = "left") : t < l ? o = (r = t - s) + 1 : (c == e.length - 3 || t == l && e[c + 3] > t) && (r = (o = l - s) - 1, t >= l && (a = "right")), null != r) {
                    if (i = e[c + 2], s == l && n == (i.insertLeft ? "left" : "right") && (a = n), "left" == n && 0 == r) for (; c && e[c - 2] == e[c - 3] && e[c - 1].insertLeft;) i = e[2 + (c -= 3)], a = "left";
                    if ("right" == n && r == l - s) for (; c < e.length - 3 && e[c + 3] == e[c + 4] && !e[c + 5].insertLeft;) i = e[(c += 3) + 2], a = "right";
                    break
                }
                return {node: i, start: r, end: o, collapse: a, coverStart: s, coverEnd: l}
            }

            function Dn(e, t) {
                var n = Ln;
                if ("left" == t) for (var i = 0; i < e.length && (n = e[i]).left == n.right; i++) ; else for (var r = e.length - 1; r >= 0 && (n = e[r]).left == n.right; r--) ;
                return n
            }

            function On(e) {
                if (e.measure && (e.measure.cache = {}, e.measure.heights = null, e.rest)) for (var t = 0; t < e.rest.length; t++) e.measure.caches[t] = {}
            }

            function In(e) {
                e.display.externalMeasure = null, F(e.display.lineMeasure);
                for (var t = 0; t < e.display.view.length; t++) On(e.display.view[t])
            }

            function Pn(e) {
                In(e), e.display.cachedCharWidth = e.display.cachedTextHeight = e.display.cachedPaddingH = null, e.options.lineWrapping || (e.display.maxLineChanged = !0), e.display.lineNumChars = null
            }

            function Bn() {
                return d && g ? -(document.body.getBoundingClientRect().left - parseInt(getComputedStyle(document.body).marginLeft)) : window.pageXOffset || (document.documentElement || document.body).scrollLeft
            }

            function $n() {
                return d && g ? -(document.body.getBoundingClientRect().top - parseInt(getComputedStyle(document.body).marginTop)) : window.pageYOffset || (document.documentElement || document.body).scrollTop
            }

            function Hn(e, t, n, i, r) {
                if (!r && t.widgets) for (var o = 0; o < t.widgets.length; ++o) if (t.widgets[o].above) {
                    var a = bn(t.widgets[o]);
                    n.top += a, n.bottom += a
                }
                if ("line" == i) return n;
                i || (i = "local");
                var s = ze(t);
                if ("local" == i ? s += Cn(e.display) : s -= e.display.viewOffset, "page" == i || "window" == i) {
                    var l = e.display.lineSpace.getBoundingClientRect();
                    s += l.top + ("window" == i ? 0 : $n());
                    var c = l.left + ("window" == i ? 0 : Bn());
                    n.left += c, n.right += c
                }
                return n.top += s, n.bottom += s, n
            }

            function Un(e, t, n) {
                if ("div" == n) return t;
                var i = t.left, r = t.top;
                if ("page" == n) i -= Bn(), r -= $n(); else if ("local" == n || !n) {
                    var o = e.display.sizer.getBoundingClientRect();
                    i += o.left, r += o.top
                }
                var a = e.display.lineSpace.getBoundingClientRect();
                return {left: i - a.left, top: r - a.top}
            }

            function jn(e, t, n, i, r) {
                return i || (i = se(e.doc, t.line)), Hn(e, i, Tn(e, i, t.ch, r), n)
            }

            function Wn(e, t, n, i, r, o) {
                i = i || se(e.doc, t.line), r || (r = An(e, i));

                function a(t, a) {
                    var s = Nn(e, r, t, a ? "right" : "left", o);
                    return a ? s.left = s.right : s.right = s.left, Hn(e, i, s, n)
                }

                var s = Je(i, e.doc.direction), l = t.ch, c = t.sticky;
                if (l >= i.text.length ? (l = i.text.length, c = "before") : l <= 0 && (l = 0, c = "after"), !s) return a("before" == c ? l - 1 : l, "before" == c);

                function d(e, t, n) {
                    var i = s[t].level % 2 != 0;
                    return a(n ? e - 1 : e, i != n)
                }

                var u = Qe(s, l, c), h = Ye, f = d(l, u, "before" == c);
                return null != h && (f.other = d(l, h, "before" != c)), f
            }

            function qn(e, t) {
                var n = 0;
                t = xe(e.doc, t), e.options.lineWrapping || (n = Jn(e.display) * t.ch);
                var i = se(e.doc, t.line), r = ze(i) + Cn(e.display);
                return {left: n, right: n, top: r, bottom: r + i.height}
            }

            function zn(e, t, n, i, r) {
                var o = me(e, t, n);
                return o.xRel = r, i && (o.outside = !0), o
            }

            function Vn(e, t, n) {
                var i = e.doc;
                if ((n += e.display.viewOffset) < 0) return zn(i.first, 0, null, !0, -1);
                var r = he(i, n), o = i.first + i.size - 1;
                if (r > o) return zn(i.first + i.size - 1, se(i, o).text.length, null, !0, 1);
                t < 0 && (t = 0);
                for (var a = se(i, r); ;) {
                    var s = Yn(e, a, r, t, n), l = Be(a), c = l && l.find(0, !0);
                    if (!l || !(s.ch > c.from.ch || s.ch == c.from.ch && s.xRel > 0)) return s;
                    r = ue(a = c.to.line)
                }
            }

            function Kn(e, t, n, i) {
                var r = function (i) {
                    return Hn(e, t, Nn(e, n, i), "line")
                }, o = t.text.length, a = ae(function (e) {
                    return r(e - 1).bottom <= i
                }, o, 0);
                return {
                    begin: a, end: o = ae(function (e) {
                        return r(e).top > i
                    }, a, o)
                }
            }

            function Yn(e, t, n, i, r) {
                r -= ze(t);
                var o, a = 0, s = t.text.length, l = An(e, t);
                if (Je(t, e.doc.direction)) {
                    if (e.options.lineWrapping) {
                        var c;
                        a = (c = Kn(e, t, l, r)).begin, s = c.end
                    }
                    o = new me(n, a);
                    var d, u, h = Wn(e, o, "line", t, l).left, f = h < i ? 1 : -1, p = h - i;
                    do {
                        if (d = p, u = o, null == (o = tt(e, t, o, f)) || o.ch < a || s <= ("before" == o.sticky ? o.ch - 1 : o.ch)) {
                            o = u;
                            break
                        }
                        p = Wn(e, o, "line", t, l).left - i
                    } while (f < 0 != p < 0 && Math.abs(p) <= Math.abs(d));
                    if (Math.abs(p) > Math.abs(d)) {
                        if (p < 0 == d < 0) throw new Error("Broke out of infinite loop in coordsCharInner");
                        o = u
                    }
                } else {
                    var m = ae(function (n) {
                        var o = Hn(e, t, Nn(e, l, n), "line");
                        return o.top > r ? (s = Math.min(n, s), !0) : !(o.bottom <= r) && (o.left > i || !(o.right < i) && i - o.left < o.right - i)
                    }, a, s);
                    o = new me(n, m = oe(t.text, m, 1), m == s ? "before" : "after")
                }
                var g = Wn(e, o, "line", t, l);
                return (r < g.top || g.bottom < r) && (o.outside = !0), o.xRel = i < g.left ? -1 : i > g.right ? 1 : 0, o
            }

            var Qn;

            function Gn(e) {
                if (null != e.cachedTextHeight) return e.cachedTextHeight;
                if (null == Qn) {
                    Qn = T("pre");
                    for (var t = 0; t < 49; ++t) Qn.appendChild(document.createTextNode("x")), Qn.appendChild(T("br"));
                    Qn.appendChild(document.createTextNode("x"))
                }
                _(e.measure, Qn);
                var n = Qn.offsetHeight / 50;
                return n > 3 && (e.cachedTextHeight = n), F(e.measure), n || 1
            }

            function Jn(e) {
                if (null != e.cachedCharWidth) return e.cachedCharWidth;
                var t = T("span", "xxxxxxxxxx"), n = T("pre", [t]);
                _(e.measure, n);
                var i = t.getBoundingClientRect(), r = (i.right - i.left) / 10;
                return r > 2 && (e.cachedCharWidth = r), r || 10
            }

            function Xn(e) {
                for (var t = e.display, n = {}, i = {}, r = t.gutters.clientLeft, o = t.gutters.firstChild, a = 0; o; o = o.nextSibling, ++a) n[e.options.gutters[a]] = o.offsetLeft + o.clientLeft + r, i[e.options.gutters[a]] = o.clientWidth;
                return {
                    fixedPos: Zn(t),
                    gutterTotalWidth: t.gutters.offsetWidth,
                    gutterLeft: n,
                    gutterWidth: i,
                    wrapperWidth: t.wrapper.clientWidth
                }
            }

            function Zn(e) {
                return e.scroller.getBoundingClientRect().left - e.sizer.getBoundingClientRect().left
            }

            function ei(e) {
                var t = Gn(e.display), n = e.options.lineWrapping,
                    i = n && Math.max(5, e.display.scroller.clientWidth / Jn(e.display) - 3);
                return function (r) {
                    if (We(e.doc, r)) return 0;
                    var o = 0;
                    if (r.widgets) for (var a = 0; a < r.widgets.length; a++) r.widgets[a].height && (o += r.widgets[a].height);
                    return n ? o + (Math.ceil(r.text.length / i) || 1) * t : o + t
                }
            }

            function ti(e) {
                var t = e.doc, n = ei(e);
                t.iter(function (e) {
                    var t = n(e);
                    t != e.height && de(e, t)
                })
            }

            function ni(e, t, n, i) {
                var r = e.display;
                if (!n && "true" == mt(t).getAttribute("cm-not-content")) return null;
                var o, a, s = r.lineSpace.getBoundingClientRect();
                try {
                    o = t.clientX - s.left, a = t.clientY - s.top
                } catch (t) {
                    return null
                }
                var l, c = Vn(e, o, a);
                if (i && 1 == c.xRel && (l = se(e.doc, c.line).text).length == c.ch) {
                    var d = B(l, l.length, e.options.tabSize) - l.length;
                    c = me(c.line, Math.max(0, Math.round((o - kn(e.display).left) / Jn(e.display)) - d))
                }
                return c
            }

            da.posFromMouse = ni;

            function ii(e, t) {
                if (t >= e.display.viewTo) return null;
                if ((t -= e.display.viewFrom) < 0) return null;
                for (var n = e.display.view, i = 0; i < n.length; i++) if ((t -= n[i].size) < 0) return i
            }

            function ri(e) {
                e.display.input.showSelection(e.display.input.prepareSelection())
            }

            function oi(e, t) {
                for (var n = e.doc, i = {}, r = i.cursors = document.createDocumentFragment(), o = i.selection = document.createDocumentFragment(), a = 0; a < n.sel.ranges.length; a++) if (!1 !== t || a != n.sel.primIndex) {
                    var s = n.sel.ranges[a];
                    if (!(s.from().line >= e.display.viewTo || s.to().line < e.display.viewFrom)) {
                        var l = s.empty();
                        (l || e.options.showCursorWhenSelecting) && ai(e, s.head, r), l || si(e, s, o)
                    }
                }
                return i
            }

            function ai(e, t, n) {
                var i = Wn(e, t, "div", null, null, !e.options.singleCursorHeightPerLine),
                    r = n.appendChild(T("div", " ", "CodeMirror-cursor"));
                if (r.style.left = i.left + "px", r.style.top = i.top + "px", r.style.height = Math.max(0, i.bottom - i.top) * e.options.cursorHeight + "px", i.other) {
                    var o = n.appendChild(T("div", " ", "CodeMirror-cursor CodeMirror-secondarycursor"));
                    o.style.display = "", o.style.left = i.other.left + "px", o.style.top = i.other.top + "px", o.style.height = .85 * (i.other.bottom - i.other.top) + "px"
                }
            }

            function si(e, t, n) {
                var i = e.display, r = e.doc, o = document.createDocumentFragment(), a = kn(e.display), s = a.left,
                    l = Math.max(i.sizerWidth, En(e) - i.sizer.offsetLeft) - a.right;

                function c(e, t, n, i) {
                    t < 0 && (t = 0), t = Math.round(t), i = Math.round(i), o.appendChild(T("div", null, "CodeMirror-selected", "position: absolute; left: " + e + "px;\n                             top: " + t + "px; width: " + (null == n ? l - e : n) + "px;\n                             height: " + (i - t) + "px"))
                }

                function d(t, n, i) {
                    var o, a, d = se(r, t), u = d.text.length;

                    function h(n, i) {
                        return jn(e, me(t, n), "div", d, i)
                    }

                    return function (e, t, n, i) {
                        if (!e) return i(t, n, "ltr");
                        for (var r = !1, o = 0; o < e.length; ++o) {
                            var a = e[o];
                            (a.from < n && a.to > t || t == n && a.to == t) && (i(Math.max(a.from, t), Math.min(a.to, n), 1 == a.level ? "rtl" : "ltr"), r = !0)
                        }
                        r || i(t, n, "ltr")
                    }(Je(d, r.direction), n || 0, null == i ? u : i, function (e, t, r) {
                        var d, f, p, m = h(e, "left");
                        if (e == t) d = m, f = p = m.left; else {
                            if (d = h(t - 1, "right"), "rtl" == r) {
                                var g = m;
                                m = d, d = g
                            }
                            f = m.left, p = d.right
                        }
                        null == n && 0 == e && (f = s), d.top - m.top > 3 && (c(f, m.top, null, m.bottom), f = s, m.bottom < d.top && c(f, m.bottom, null, d.top)), null == i && t == u && (p = l), (!o || m.top < o.top || m.top == o.top && m.left < o.left) && (o = m), (!a || d.bottom > a.bottom || d.bottom == a.bottom && d.right > a.right) && (a = d), f < s + 1 && (f = s), c(f, d.top, p - f, d.bottom)
                    }), {start: o, end: a}
                }

                var u = t.from(), h = t.to();
                if (u.line == h.line) d(u.line, u.ch, h.ch); else {
                    var f = se(r, u.line), p = se(r, h.line), m = He(f) == He(p),
                        g = d(u.line, u.ch, m ? f.text.length + 1 : null).end, v = d(h.line, m ? 0 : null, h.ch).start;
                    m && (g.top < v.top - 2 ? (c(g.right, g.top, null, g.bottom), c(s, v.top, v.left, v.bottom)) : c(g.right, g.top, v.left - g.right, g.bottom)), g.bottom < v.top && c(s, g.bottom, null, v.top)
                }
                n.appendChild(o)
            }

            function li(e) {
                if (e.state.focused) {
                    var t = e.display;
                    clearInterval(t.blinker);
                    var n = !0;
                    t.cursorDiv.style.visibility = "", e.options.cursorBlinkRate > 0 ? t.blinker = setInterval(function () {
                        return t.cursorDiv.style.visibility = (n = !n) ? "" : "hidden"
                    }, e.options.cursorBlinkRate) : e.options.cursorBlinkRate < 0 && (t.cursorDiv.style.visibility = "hidden")
                }
            }

            function ci(e) {
                e.state.focused || (e.display.input.focus(), ui(e))
            }

            function di(e) {
                e.state.delayingBlurEvent = !0, setTimeout(function () {
                    e.state.delayingBlurEvent && (e.state.delayingBlurEvent = !1, hi(e))
                }, 100)
            }

            function ui(e, t) {
                e.state.delayingBlurEvent && (e.state.delayingBlurEvent = !1), "nocursor" != e.options.readOnly && (e.state.focused || (at(e, "focus", e, t), e.state.focused = !0, R(e.display.wrapper, "CodeMirror-focused"), e.curOp || e.display.selForContextMenu == e.doc.sel || (e.display.input.reset(), l && setTimeout(function () {
                    return e.display.input.reset(!0)
                }, 20)), e.display.input.receivedFocus()), li(e))
            }

            function hi(e, t) {
                e.state.delayingBlurEvent || (e.state.focused && (at(e, "blur", e, t), e.state.focused = !1, E(e.display.wrapper, "CodeMirror-focused")), clearInterval(e.display.blinker), setTimeout(function () {
                    e.state.focused || (e.display.shift = !1)
                }, 150))
            }

            function fi(e) {
                for (var t = e.display, n = t.lineDiv.offsetTop, i = 0; i < t.view.length; i++) {
                    var r = t.view[i], o = void 0;
                    if (!r.hidden) {
                        if (a && s < 8) {
                            var l = r.node.offsetTop + r.node.offsetHeight;
                            o = l - n, n = l
                        } else {
                            var c = r.node.getBoundingClientRect();
                            o = c.bottom - c.top
                        }
                        var d = r.line.height - o;
                        if (o < 2 && (o = Gn(t)), (d > .001 || d < -.001) && (de(r.line, o), pi(r.line), r.rest)) for (var u = 0; u < r.rest.length; u++) pi(r.rest[u])
                    }
                }
            }

            function pi(e) {
                if (e.widgets) for (var t = 0; t < e.widgets.length; ++t) e.widgets[t].height = e.widgets[t].node.parentNode.offsetHeight
            }

            function mi(e, t, n) {
                var i = n && null != n.top ? Math.max(0, n.top) : e.scroller.scrollTop;
                i = Math.floor(i - Cn(e));
                var r = n && null != n.bottom ? n.bottom : i + e.wrapper.clientHeight, o = he(t, i), a = he(t, r);
                if (n && n.ensure) {
                    var s = n.ensure.from.line, l = n.ensure.to.line;
                    s < o ? (o = s, a = he(t, ze(se(t, s)) + e.wrapper.clientHeight)) : Math.min(l, t.lastLine()) >= a && (o = he(t, ze(se(t, l)) - e.wrapper.clientHeight), a = l)
                }
                return {from: o, to: Math.max(a, o + 1)}
            }

            function gi(e) {
                var t = e.display, n = t.view;
                if (t.alignWidgets || t.gutters.firstChild && e.options.fixedGutter) {
                    for (var i = Zn(t) - t.scroller.scrollLeft + e.doc.scrollLeft, r = t.gutters.offsetWidth, o = i + "px", a = 0; a < n.length; a++) if (!n[a].hidden) {
                        e.options.fixedGutter && (n[a].gutter && (n[a].gutter.style.left = o), n[a].gutterBackground && (n[a].gutterBackground.style.left = o));
                        var s = n[a].alignable;
                        if (s) for (var l = 0; l < s.length; l++) s[l].style.left = o
                    }
                    e.options.fixedGutter && (t.gutters.style.left = i + r + "px")
                }
            }

            function vi(e) {
                if (!e.options.lineNumbers) return !1;
                var t = e.doc, n = pe(e.options, t.first + t.size - 1), i = e.display;
                if (n.length != i.lineNumChars) {
                    var r = i.measure.appendChild(T("div", [T("div", n)], "CodeMirror-linenumber CodeMirror-gutter-elt")),
                        o = r.firstChild.offsetWidth, a = r.offsetWidth - o;
                    return i.lineGutter.style.width = "", i.lineNumInnerWidth = Math.max(o, i.lineGutter.offsetWidth - a) + a + 2, i.lineNumWidth = i.lineNumInnerWidth + a, i.lineNumChars = i.lineNumInnerWidth ? n.length : -1, i.lineGutter.style.width = i.lineNumWidth + "px", nr(e), !0
                }
                return !1
            }

            function yi(e, t) {
                var n = e.display, i = Gn(e.display);
                t.top < 0 && (t.top = 0);
                var r = e.curOp && null != e.curOp.scrollTop ? e.curOp.scrollTop : n.scroller.scrollTop, o = Fn(e),
                    a = {};
                t.bottom - t.top > o && (t.bottom = t.top + o);
                var s = e.doc.height + xn(n), l = t.top < i, c = t.bottom > s - i;
                if (t.top < r) a.scrollTop = l ? 0 : t.top; else if (t.bottom > r + o) {
                    var d = Math.min(t.top, (c ? s : t.bottom) - o);
                    d != r && (a.scrollTop = d)
                }
                var u = e.curOp && null != e.curOp.scrollLeft ? e.curOp.scrollLeft : n.scroller.scrollLeft,
                    h = En(e) - (e.options.fixedGutter ? n.gutters.offsetWidth : 0), f = t.right - t.left > h;
                return f && (t.right = t.left + h), t.left < 10 ? a.scrollLeft = 0 : t.left < u ? a.scrollLeft = Math.max(0, t.left - (f ? 0 : 10)) : t.right > h + u - 3 && (a.scrollLeft = t.right + (f ? 0 : 10) - h), a
            }

            function bi(e, t) {
                null != t && (xi(e), e.curOp.scrollTop = (null == e.curOp.scrollTop ? e.doc.scrollTop : e.curOp.scrollTop) + t)
            }

            function wi(e) {
                xi(e);
                var t = e.getCursor(), n = t, i = t;
                e.options.lineWrapping || (n = t.ch ? me(t.line, t.ch - 1) : t, i = me(t.line, t.ch + 1)), e.curOp.scrollToPos = {
                    from: n,
                    to: i,
                    margin: e.options.cursorScrollMargin
                }
            }

            function Ci(e, t, n) {
                null == t && null == n || xi(e), null != t && (e.curOp.scrollLeft = t), null != n && (e.curOp.scrollTop = n)
            }

            function xi(e) {
                var t = e.curOp.scrollToPos;
                if (t) {
                    e.curOp.scrollToPos = null;
                    ki(e, qn(e, t.from), qn(e, t.to), t.margin)
                }
            }

            function ki(e, t, n, i) {
                var r = yi(e, {
                    left: Math.min(t.left, n.left),
                    top: Math.min(t.top, n.top) - i,
                    right: Math.max(t.right, n.right),
                    bottom: Math.max(t.bottom, n.bottom) + i
                });
                Ci(e, r.scrollLeft, r.scrollTop)
            }

            function Si(e, t) {
                Math.abs(e.doc.scrollTop - t) < 2 || (n || tr(e, {top: t}), Ei(e, t, !0), n && tr(e), Gi(e, 100))
            }

            function Ei(e, t, n) {
                t = Math.min(e.display.scroller.scrollHeight - e.display.scroller.clientHeight, t), (e.display.scroller.scrollTop != t || n) && (e.doc.scrollTop = t, e.display.scrollbars.setScrollTop(t), e.display.scroller.scrollTop != t && (e.display.scroller.scrollTop = t))
            }

            function Fi(e, t, n, i) {
                t = Math.min(t, e.display.scroller.scrollWidth - e.display.scroller.clientWidth), (n ? t == e.doc.scrollLeft : Math.abs(e.doc.scrollLeft - t) < 2) && !i || (e.doc.scrollLeft = t, gi(e), e.display.scroller.scrollLeft != t && (e.display.scroller.scrollLeft = t), e.display.scrollbars.setScrollLeft(t))
            }

            function _i(e) {
                var t = e.display, n = t.gutters.offsetWidth, i = Math.round(e.doc.height + xn(e.display));
                return {
                    clientHeight: t.scroller.clientHeight,
                    viewHeight: t.wrapper.clientHeight,
                    scrollWidth: t.scroller.scrollWidth,
                    clientWidth: t.scroller.clientWidth,
                    viewWidth: t.wrapper.clientWidth,
                    barLeft: e.options.fixedGutter ? n : 0,
                    docHeight: i,
                    scrollHeight: i + Sn(e) + t.barHeight,
                    nativeBarWidth: t.nativeBarWidth,
                    gutterWidth: n
                }
            }

            var Ti = function (e, t, n) {
                this.cm = n;
                var i = this.vert = T("div", [T("div", null, null, "min-width: 1px")], "CodeMirror-vscrollbar"),
                    r = this.horiz = T("div", [T("div", null, null, "height: 100%; min-height: 1px")], "CodeMirror-hscrollbar");
                e(i), e(r), it(i, "scroll", function () {
                    i.clientHeight && t(i.scrollTop, "vertical")
                }), it(r, "scroll", function () {
                    r.clientWidth && t(r.scrollLeft, "horizontal")
                }), this.checkedZeroWidth = !1, a && s < 8 && (this.horiz.style.minHeight = this.vert.style.minWidth = "18px")
            };
            Ti.prototype.update = function (e) {
                var t = e.scrollWidth > e.clientWidth + 1, n = e.scrollHeight > e.clientHeight + 1,
                    i = e.nativeBarWidth;
                if (n) {
                    this.vert.style.display = "block", this.vert.style.bottom = t ? i + "px" : "0";
                    var r = e.viewHeight - (t ? i : 0);
                    this.vert.firstChild.style.height = Math.max(0, e.scrollHeight - e.clientHeight + r) + "px"
                } else this.vert.style.display = "", this.vert.firstChild.style.height = "0";
                if (t) {
                    this.horiz.style.display = "block", this.horiz.style.right = n ? i + "px" : "0", this.horiz.style.left = e.barLeft + "px";
                    var o = e.viewWidth - e.barLeft - (n ? i : 0);
                    this.horiz.firstChild.style.width = Math.max(0, e.scrollWidth - e.clientWidth + o) + "px"
                } else this.horiz.style.display = "", this.horiz.firstChild.style.width = "0";
                return !this.checkedZeroWidth && e.clientHeight > 0 && (0 == i && this.zeroWidthHack(), this.checkedZeroWidth = !0), {
                    right: n ? i : 0,
                    bottom: t ? i : 0
                }
            }, Ti.prototype.setScrollLeft = function (e) {
                this.horiz.scrollLeft != e && (this.horiz.scrollLeft = e), this.disableHoriz && this.enableZeroWidthBar(this.horiz, this.disableHoriz, "horiz")
            }, Ti.prototype.setScrollTop = function (e) {
                this.vert.scrollTop != e && (this.vert.scrollTop = e), this.disableVert && this.enableZeroWidthBar(this.vert, this.disableVert, "vert")
            }, Ti.prototype.zeroWidthHack = function () {
                var e = y && !f ? "12px" : "18px";
                this.horiz.style.height = this.vert.style.width = e, this.horiz.style.pointerEvents = this.vert.style.pointerEvents = "none", this.disableHoriz = new $, this.disableVert = new $
            }, Ti.prototype.enableZeroWidthBar = function (e, t, n) {
                e.style.pointerEvents = "auto";
                t.set(1e3, function i() {
                    var r = e.getBoundingClientRect();
                    ("vert" == n ? document.elementFromPoint(r.right - 1, (r.top + r.bottom) / 2) : document.elementFromPoint((r.right + r.left) / 2, r.bottom - 1)) != e ? e.style.pointerEvents = "none" : t.set(1e3, i)
                })
            }, Ti.prototype.clear = function () {
                var e = this.horiz.parentNode;
                e.removeChild(this.horiz), e.removeChild(this.vert)
            };
            var Mi = function () {
            };
            Mi.prototype.update = function () {
                return {bottom: 0, right: 0}
            }, Mi.prototype.setScrollLeft = function () {
            }, Mi.prototype.setScrollTop = function () {
            }, Mi.prototype.clear = function () {
            };

            function Ai(e, t) {
                t || (t = _i(e));
                var n = e.display.barWidth, i = e.display.barHeight;
                Ni(e, t);
                for (var r = 0; r < 4 && n != e.display.barWidth || i != e.display.barHeight; r++) n != e.display.barWidth && e.options.lineWrapping && fi(e), Ni(e, _i(e)), n = e.display.barWidth, i = e.display.barHeight
            }

            function Ni(e, t) {
                var n = e.display, i = n.scrollbars.update(t);
                n.sizer.style.paddingRight = (n.barWidth = i.right) + "px", n.sizer.style.paddingBottom = (n.barHeight = i.bottom) + "px", n.heightForcer.style.borderBottom = i.bottom + "px solid transparent", i.right && i.bottom ? (n.scrollbarFiller.style.display = "block", n.scrollbarFiller.style.height = i.bottom + "px", n.scrollbarFiller.style.width = i.right + "px") : n.scrollbarFiller.style.display = "", i.bottom && e.options.coverGutterNextToScrollbar && e.options.fixedGutter ? (n.gutterFiller.style.display = "block", n.gutterFiller.style.height = i.bottom + "px", n.gutterFiller.style.width = t.gutterWidth + "px") : n.gutterFiller.style.display = ""
            }

            var Li = {native: Ti, null: Mi};

            function Ri(e) {
                e.display.scrollbars && (e.display.scrollbars.clear(), e.display.scrollbars.addClass && E(e.display.wrapper, e.display.scrollbars.addClass)), e.display.scrollbars = new Li[e.options.scrollbarStyle](function (t) {
                    e.display.wrapper.insertBefore(t, e.display.scrollbarFiller), it(t, "mousedown", function () {
                        e.state.focused && setTimeout(function () {
                            return e.display.input.focus()
                        }, 0)
                    }), t.setAttribute("cm-not-content", "true")
                }, function (t, n) {
                    "horizontal" == n ? Fi(e, t) : Si(e, t)
                }, e), e.display.scrollbars.addClass && R(e.display.wrapper, e.display.scrollbars.addClass)
            }

            var Di = 0;

            function Oi(e) {
                e.curOp = {
                    cm: e,
                    viewChanged: !1,
                    startHeight: e.doc.height,
                    forceUpdate: !1,
                    updateInput: null,
                    typing: !1,
                    changeObjs: null,
                    cursorActivityHandlers: null,
                    cursorActivityCalled: 0,
                    selectionChanged: !1,
                    updateMaxLine: !1,
                    scrollLeft: null,
                    scrollTop: null,
                    scrollToPos: null,
                    focus: !1,
                    id: ++Di
                }, t = e.curOp, rn ? rn.ops.push(t) : t.ownsGroup = rn = {ops: [t], delayedCallbacks: []};
                var t
            }

            function Ii(e) {
                !function (e, t) {
                    var n = e.ownsGroup;
                    if (n) try {
                        !function (e) {
                            var t = e.delayedCallbacks, n = 0;
                            do {
                                for (; n < t.length; n++) t[n].call(null);
                                for (var i = 0; i < e.ops.length; i++) {
                                    var r = e.ops[i];
                                    if (r.cursorActivityHandlers) for (; r.cursorActivityCalled < r.cursorActivityHandlers.length;) r.cursorActivityHandlers[r.cursorActivityCalled++].call(null, r.cm)
                                }
                            } while (n < t.length)
                        }(n)
                    } finally {
                        rn = null, t(n)
                    }
                }(e.curOp, function (e) {
                    for (var t = 0; t < e.ops.length; t++) e.ops[t].cm.curOp = null;
                    !function (e) {
                        for (var t = e.ops, n = 0; n < t.length; n++) Pi(t[n]);
                        for (var i = 0; i < t.length; i++) (r = t[i]).updatedDisplay = r.mustUpdate && Zi(r.cm, r.update);
                        var r;
                        for (var o = 0; o < t.length; o++) Bi(t[o]);
                        for (var a = 0; a < t.length; a++) $i(t[a]);
                        for (var s = 0; s < t.length; s++) Hi(t[s])
                    }(e)
                })
            }

            function Pi(e) {
                var t = e.cm, n = t.display;
                !function (e) {
                    var t = e.display;
                    !t.scrollbarsClipped && t.scroller.offsetWidth && (t.nativeBarWidth = t.scroller.offsetWidth - t.scroller.clientWidth, t.heightForcer.style.height = Sn(e) + "px", t.sizer.style.marginBottom = -t.nativeBarWidth + "px", t.sizer.style.borderRightWidth = Sn(e) + "px", t.scrollbarsClipped = !0)
                }(t), e.updateMaxLine && Ke(t), e.mustUpdate = e.viewChanged || e.forceUpdate || null != e.scrollTop || e.scrollToPos && (e.scrollToPos.from.line < n.viewFrom || e.scrollToPos.to.line >= n.viewTo) || n.maxLineChanged && t.options.lineWrapping, e.update = e.mustUpdate && new Xi(t, e.mustUpdate && {
                    top: e.scrollTop,
                    ensure: e.scrollToPos
                }, e.forceUpdate)
            }

            function Bi(e) {
                var t = e.cm, n = t.display;
                e.updatedDisplay && fi(t), e.barMeasure = _i(t), n.maxLineChanged && !t.options.lineWrapping && (e.adjustWidthTo = Tn(t, n.maxLine, n.maxLine.text.length).left + 3, t.display.sizerWidth = e.adjustWidthTo, e.barMeasure.scrollWidth = Math.max(n.scroller.clientWidth, n.sizer.offsetLeft + e.adjustWidthTo + Sn(t) + t.display.barWidth), e.maxScrollLeft = Math.max(0, n.sizer.offsetLeft + e.adjustWidthTo - En(t))), (e.updatedDisplay || e.selectionChanged) && (e.preparedSelection = n.input.prepareSelection(e.focus))
            }

            function $i(e) {
                var t = e.cm;
                null != e.adjustWidthTo && (t.display.sizer.style.minWidth = e.adjustWidthTo + "px", e.maxScrollLeft < t.doc.scrollLeft && Fi(t, Math.min(t.display.scroller.scrollLeft, e.maxScrollLeft), !0), t.display.maxLineChanged = !1);
                var n = e.focus && e.focus == L() && (!document.hasFocus || document.hasFocus());
                e.preparedSelection && t.display.input.showSelection(e.preparedSelection, n), (e.updatedDisplay || e.startHeight != t.doc.height) && Ai(t, e.barMeasure), e.updatedDisplay && ir(t, e.barMeasure), e.selectionChanged && li(t), t.state.focused && e.updateInput && t.display.input.reset(e.typing), n && ci(e.cm)
            }

            function Hi(e) {
                var t = e.cm, n = t.display, i = t.doc;
                if (e.updatedDisplay && er(t, e.update), null == n.wheelStartX || null == e.scrollTop && null == e.scrollLeft && !e.scrollToPos || (n.wheelStartX = n.wheelStartY = null), null != e.scrollTop && Ei(t, e.scrollTop, e.forceScroll), null != e.scrollLeft && Fi(t, e.scrollLeft, !0, !0), e.scrollToPos) {
                    !function (e, t) {
                        if (!st(e, "scrollCursorIntoView")) {
                            var n = e.display, i = n.sizer.getBoundingClientRect(), r = null;
                            if (t.top + i.top < 0 ? r = !0 : t.bottom + i.top > (window.innerHeight || document.documentElement.clientHeight) && (r = !1), null != r && !p) {
                                var o = T("div", "​", null, "position: absolute;\n                         top: " + (t.top - n.viewOffset - Cn(e.display)) + "px;\n                         height: " + (t.bottom - t.top + Sn(e) + n.barHeight) + "px;\n                         left: " + t.left + "px; width: " + Math.max(2, t.right - t.left) + "px;");
                                e.display.lineSpace.appendChild(o), o.scrollIntoView(r), e.display.lineSpace.removeChild(o)
                            }
                        }
                    }(t, function (e, t, n, i) {
                        null == i && (i = 0);
                        for (var r, o = 0; o < 5; o++) {
                            var a = !1, s = Wn(e, t), l = n && n != t ? Wn(e, n) : s, c = yi(e, r = {
                                left: Math.min(s.left, l.left),
                                top: Math.min(s.top, l.top) - i,
                                right: Math.max(s.left, l.left),
                                bottom: Math.max(s.bottom, l.bottom) + i
                            }), d = e.doc.scrollTop, u = e.doc.scrollLeft;
                            if (null != c.scrollTop && (Si(e, c.scrollTop), Math.abs(e.doc.scrollTop - d) > 1 && (a = !0)), null != c.scrollLeft && (Fi(e, c.scrollLeft), Math.abs(e.doc.scrollLeft - u) > 1 && (a = !0)), !a) break
                        }
                        return r
                    }(t, xe(i, e.scrollToPos.from), xe(i, e.scrollToPos.to), e.scrollToPos.margin))
                }
                var r = e.maybeHiddenMarkers, o = e.maybeUnhiddenMarkers;
                if (r) for (var a = 0; a < r.length; ++a) r[a].lines.length || at(r[a], "hide");
                if (o) for (var s = 0; s < o.length; ++s) o[s].lines.length && at(o[s], "unhide");
                n.wrapper.offsetHeight && (i.scrollTop = t.display.scroller.scrollTop), e.changeObjs && at(t, "changes", t, e.changeObjs), e.update && e.update.finish()
            }

            function Ui(e, t) {
                if (e.curOp) return t();
                Oi(e);
                try {
                    return t()
                } finally {
                    Ii(e)
                }
            }

            function ji(e, t) {
                return function () {
                    if (e.curOp) return t.apply(e, arguments);
                    Oi(e);
                    try {
                        return t.apply(e, arguments)
                    } finally {
                        Ii(e)
                    }
                }
            }

            function Wi(e) {
                return function () {
                    if (this.curOp) return e.apply(this, arguments);
                    Oi(this);
                    try {
                        return e.apply(this, arguments)
                    } finally {
                        Ii(this)
                    }
                }
            }

            function qi(e) {
                return function () {
                    var t = this.cm;
                    if (!t || t.curOp) return e.apply(this, arguments);
                    Oi(t);
                    try {
                        return e.apply(this, arguments)
                    } finally {
                        Ii(t)
                    }
                }
            }

            function zi(e, t, n, i) {
                null == t && (t = e.doc.first), null == n && (n = e.doc.first + e.doc.size), i || (i = 0);
                var r = e.display;
                if (i && n < r.viewTo && (null == r.updateLineNumbers || r.updateLineNumbers > t) && (r.updateLineNumbers = t), e.curOp.viewChanged = !0, t >= r.viewTo) Ee && Ue(e.doc, t) < r.viewTo && Ki(e); else if (n <= r.viewFrom) Ee && je(e.doc, n + i) > r.viewFrom ? Ki(e) : (r.viewFrom += i, r.viewTo += i); else if (t <= r.viewFrom && n >= r.viewTo) Ki(e); else if (t <= r.viewFrom) {
                    var o = Yi(e, n, n + i, 1);
                    o ? (r.view = r.view.slice(o.index), r.viewFrom = o.lineN, r.viewTo += i) : Ki(e)
                } else if (n >= r.viewTo) {
                    var a = Yi(e, t, t, -1);
                    a ? (r.view = r.view.slice(0, a.index), r.viewTo = a.lineN) : Ki(e)
                } else {
                    var s = Yi(e, t, t, -1), l = Yi(e, n, n + i, 1);
                    s && l ? (r.view = r.view.slice(0, s.index).concat(nn(e, s.lineN, l.lineN)).concat(r.view.slice(l.index)), r.viewTo += i) : Ki(e)
                }
                var c = r.externalMeasured;
                c && (n < c.lineN ? c.lineN += i : t < c.lineN + c.size && (r.externalMeasured = null))
            }

            function Vi(e, t, n) {
                e.curOp.viewChanged = !0;
                var i = e.display, r = e.display.externalMeasured;
                if (r && t >= r.lineN && t < r.lineN + r.size && (i.externalMeasured = null), !(t < i.viewFrom || t >= i.viewTo)) {
                    var o = i.view[ii(e, t)];
                    if (null != o.node) {
                        var a = o.changes || (o.changes = []);
                        -1 == H(a, n) && a.push(n)
                    }
                }
            }

            function Ki(e) {
                e.display.viewFrom = e.display.viewTo = e.doc.first, e.display.view = [], e.display.viewOffset = 0
            }

            function Yi(e, t, n, i) {
                var r, o = ii(e, t), a = e.display.view;
                if (!Ee || n == e.doc.first + e.doc.size) return {index: o, lineN: n};
                for (var s = e.display.viewFrom, l = 0; l < o; l++) s += a[l].size;
                if (s != t) {
                    if (i > 0) {
                        if (o == a.length - 1) return null;
                        r = s + a[o].size - t, o++
                    } else r = s - t;
                    t += r, n += r
                }
                for (; Ue(e.doc, n) != n;) {
                    if (o == (i < 0 ? 0 : a.length - 1)) return null;
                    n += i * a[o - (i < 0 ? 1 : 0)].size, o += i
                }
                return {index: o, lineN: n}
            }

            function Qi(e) {
                for (var t = e.display.view, n = 0, i = 0; i < t.length; i++) {
                    var r = t[i];
                    r.hidden || r.node && !r.changes || ++n
                }
                return n
            }

            function Gi(e, t) {
                e.doc.mode.startState && e.doc.frontier < e.display.viewTo && e.state.highlight.set(t, I(Ji, e))
            }

            function Ji(e) {
                var t = e.doc;
                if (t.frontier < t.first && (t.frontier = t.first), !(t.frontier >= e.display.viewTo)) {
                    var n = +new Date + e.options.workTime, i = Lt(t.mode, Bt(e, t.frontier)), r = [];
                    t.iter(t.frontier, Math.min(t.first + t.size, e.display.viewTo + 500), function (o) {
                        if (t.frontier >= e.display.viewFrom) {
                            var a = o.styles, s = o.text.length > e.options.maxHighlightLength,
                                l = It(e, o, s ? Lt(t.mode, i) : i, !0);
                            o.styles = l.styles;
                            var c = o.styleClasses, d = l.classes;
                            d ? o.styleClasses = d : c && (o.styleClasses = null);
                            for (var u = !a || a.length != o.styles.length || c != d && (!c || !d || c.bgClass != d.bgClass || c.textClass != d.textClass), h = 0; !u && h < a.length; ++h) u = a[h] != o.styles[h];
                            u && r.push(t.frontier), o.stateAfter = s ? i : Lt(t.mode, i)
                        } else o.text.length <= e.options.maxHighlightLength && $t(e, o.text, i), o.stateAfter = t.frontier % 5 == 0 ? Lt(t.mode, i) : null;
                        if (++t.frontier, +new Date > n) return Gi(e, e.options.workDelay), !0
                    }), r.length && Ui(e, function () {
                        for (var t = 0; t < r.length; t++) Vi(e, r[t], "text")
                    })
                }
            }

            var Xi = function (e, t, n) {
                var i = e.display;
                this.viewport = t, this.visible = mi(i, e.doc, t), this.editorIsHidden = !i.wrapper.offsetWidth, this.wrapperHeight = i.wrapper.clientHeight, this.wrapperWidth = i.wrapper.clientWidth, this.oldDisplayWidth = En(e), this.force = n, this.dims = Xn(e), this.events = []
            };
            Xi.prototype.signal = function (e, t) {
                ct(e, t) && this.events.push(arguments)
            }, Xi.prototype.finish = function () {
                for (var e = 0; e < this.events.length; e++) at.apply(null, this.events[e])
            };

            function Zi(e, t) {
                var n = e.display, i = e.doc;
                if (t.editorIsHidden) return Ki(e), !1;
                if (!t.force && t.visible.from >= n.viewFrom && t.visible.to <= n.viewTo && (null == n.updateLineNumbers || n.updateLineNumbers >= n.viewTo) && n.renderedView == n.view && 0 == Qi(e)) return !1;
                vi(e) && (Ki(e), t.dims = Xn(e));
                var r = i.first + i.size, o = Math.max(t.visible.from - e.options.viewportMargin, i.first),
                    a = Math.min(r, t.visible.to + e.options.viewportMargin);
                n.viewFrom < o && o - n.viewFrom < 20 && (o = Math.max(i.first, n.viewFrom)), n.viewTo > a && n.viewTo - a < 20 && (a = Math.min(r, n.viewTo)), Ee && (o = Ue(e.doc, o), a = je(e.doc, a));
                var s = o != n.viewFrom || a != n.viewTo || n.lastWrapHeight != t.wrapperHeight || n.lastWrapWidth != t.wrapperWidth;
                !function (e, t, n) {
                    var i = e.display;
                    0 == i.view.length || t >= i.viewTo || n <= i.viewFrom ? (i.view = nn(e, t, n), i.viewFrom = t) : (i.viewFrom > t ? i.view = nn(e, t, i.viewFrom).concat(i.view) : i.viewFrom < t && (i.view = i.view.slice(ii(e, t))), i.viewFrom = t, i.viewTo < n ? i.view = i.view.concat(nn(e, i.viewTo, n)) : i.viewTo > n && (i.view = i.view.slice(0, ii(e, n)))), i.viewTo = n
                }(e, o, a), n.viewOffset = ze(se(e.doc, n.viewFrom)), e.display.mover.style.top = n.viewOffset + "px";
                var c = Qi(e);
                if (!s && 0 == c && !t.force && n.renderedView == n.view && (null == n.updateLineNumbers || n.updateLineNumbers >= n.viewTo)) return !1;
                var d = function (e) {
                    if (e.hasFocus()) return null;
                    var t = L();
                    if (!t || !N(e.display.lineDiv, t)) return null;
                    var n = {activeElt: t};
                    if (window.getSelection) {
                        var i = window.getSelection();
                        i.anchorNode && i.extend && N(e.display.lineDiv, i.anchorNode) && (n.anchorNode = i.anchorNode, n.anchorOffset = i.anchorOffset, n.focusNode = i.focusNode, n.focusOffset = i.focusOffset)
                    }
                    return n
                }(e);
                return c > 4 && (n.lineDiv.style.display = "none"), function (e, t, n) {
                    var i = e.display, r = e.options.lineNumbers, o = i.lineDiv, a = o.firstChild;

                    function s(t) {
                        var n = t.nextSibling;
                        return l && y && e.display.currentWheelTarget == t ? t.style.display = "none" : t.parentNode.removeChild(t), n
                    }

                    for (var c = i.view, d = i.viewFrom, u = 0; u < c.length; u++) {
                        var h = c[u];
                        if (h.hidden) ; else if (h.node && h.node.parentNode == o) {
                            for (; a != h.node;) a = s(a);
                            var f = r && null != t && t <= d && h.lineNumber;
                            h.changes && (H(h.changes, "gutter") > -1 && (f = !1), ln(e, h, d, n)), f && (F(h.lineNumber), h.lineNumber.appendChild(document.createTextNode(pe(e.options, d)))), a = h.node.nextSibling
                        } else {
                            var p = mn(e, h, d, n);
                            o.insertBefore(p, a)
                        }
                        d += h.size
                    }
                    for (; a;) a = s(a)
                }(e, n.updateLineNumbers, t.dims), c > 4 && (n.lineDiv.style.display = ""), n.renderedView = n.view, function (e) {
                    if (e && e.activeElt && e.activeElt != L() && (e.activeElt.focus(), e.anchorNode && N(document.body, e.anchorNode) && N(document.body, e.focusNode))) {
                        var t = window.getSelection(), n = document.createRange();
                        n.setEnd(e.anchorNode, e.anchorOffset), n.collapse(!1), t.removeAllRanges(), t.addRange(n), t.extend(e.focusNode, e.focusOffset)
                    }
                }(d), F(n.cursorDiv), F(n.selectionDiv), n.gutters.style.height = n.sizer.style.minHeight = 0, s && (n.lastWrapHeight = t.wrapperHeight, n.lastWrapWidth = t.wrapperWidth, Gi(e, 400)), n.updateLineNumbers = null, !0
            }

            function er(e, t) {
                for (var n = t.viewport, i = !0; (i && e.options.lineWrapping && t.oldDisplayWidth != En(e) || (n && null != n.top && (n = {top: Math.min(e.doc.height + xn(e.display) - Fn(e), n.top)}), t.visible = mi(e.display, e.doc, n), !(t.visible.from >= e.display.viewFrom && t.visible.to <= e.display.viewTo))) && Zi(e, t); i = !1) {
                    fi(e);
                    var r = _i(e);
                    ri(e), Ai(e, r), ir(e, r)
                }
                t.signal(e, "update", e), e.display.viewFrom == e.display.reportedViewFrom && e.display.viewTo == e.display.reportedViewTo || (t.signal(e, "viewportChange", e, e.display.viewFrom, e.display.viewTo), e.display.reportedViewFrom = e.display.viewFrom, e.display.reportedViewTo = e.display.viewTo)
            }

            function tr(e, t) {
                var n = new Xi(e, t);
                if (Zi(e, n)) {
                    fi(e), er(e, n);
                    var i = _i(e);
                    ri(e), Ai(e, i), ir(e, i), n.finish()
                }
            }

            function nr(e) {
                var t = e.display.gutters.offsetWidth;
                e.display.sizer.style.marginLeft = t + "px"
            }

            function ir(e, t) {
                e.display.sizer.style.minHeight = t.docHeight + "px", e.display.heightForcer.style.top = t.docHeight + "px", e.display.gutters.style.height = t.docHeight + e.display.barHeight + Sn(e) + "px"
            }

            function rr(e) {
                var t = e.display.gutters, n = e.options.gutters;
                F(t);
                for (var i = 0; i < n.length; ++i) {
                    var r = n[i], o = t.appendChild(T("div", null, "CodeMirror-gutter " + r));
                    "CodeMirror-linenumbers" == r && (e.display.lineGutter = o, o.style.width = (e.display.lineNumWidth || 1) + "px")
                }
                t.style.display = i ? "" : "none", nr(e)
            }

            function or(e) {
                var t = H(e.gutters, "CodeMirror-linenumbers");
                -1 == t && e.lineNumbers ? e.gutters = e.gutters.concat(["CodeMirror-linenumbers"]) : t > -1 && !e.lineNumbers && (e.gutters = e.gutters.slice(0), e.gutters.splice(t, 1))
            }

            var ar = 0, sr = null;
            a ? sr = -.53 : n ? sr = 15 : d ? sr = -.7 : h && (sr = -1 / 3);

            function lr(e) {
                var t = e.wheelDeltaX, n = e.wheelDeltaY;
                return null == t && e.detail && e.axis == e.HORIZONTAL_AXIS && (t = e.detail), null == n && e.detail && e.axis == e.VERTICAL_AXIS ? n = e.detail : null == n && (n = e.wheelDelta), {
                    x: t,
                    y: n
                }
            }

            function cr(e) {
                var t = lr(e);
                return t.x *= sr, t.y *= sr, t
            }

            function dr(e, t) {
                var i = lr(t), r = i.x, o = i.y, a = e.display, s = a.scroller, c = s.scrollWidth > s.clientWidth;
                if (r && c) {
                    if (o && y && l) e:for (var d = t.target, h = a.view; d != s; d = d.parentNode) for (var f = 0; f < h.length; f++) if (h[f].node == d) {
                        e.display.currentWheelTarget = d;
                        break e
                    }
                    if (r && !n && !u && null != sr) return Fi(e, Math.max(0, s.scrollLeft + r * sr)), o || ut(t), void(a.wheelStartX = null);
                    if (o && null != sr) {
                        var p = o * sr, m = e.doc.scrollTop, g = m + a.wrapper.clientHeight;
                        p < 0 ? m = Math.max(0, m + p - 50) : g = Math.min(e.doc.height, g + p + 50), tr(e, {
                            top: m,
                            bottom: g
                        })
                    }
                    ar < 20 && (null == a.wheelStartX ? (a.wheelStartX = s.scrollLeft, a.wheelStartY = s.scrollTop, a.wheelDX = r, a.wheelDY = o, setTimeout(function () {
                        if (null != a.wheelStartX) {
                            var e = s.scrollLeft - a.wheelStartX, t = s.scrollTop - a.wheelStartY,
                                n = t && a.wheelDY && t / a.wheelDY || e && a.wheelDX && e / a.wheelDX;
                            a.wheelStartX = a.wheelStartY = null, n && (sr = (sr * ar + n) / (ar + 1), ++ar)
                        }
                    }, 200)) : (a.wheelDX += r, a.wheelDY += o))
                }
            }

            var ur = function (e, t) {
                this.ranges = e, this.primIndex = t
            };
            ur.prototype.primary = function () {
                return this.ranges[this.primIndex]
            }, ur.prototype.equals = function (e) {
                if (e == this) return !0;
                if (e.primIndex != this.primIndex || e.ranges.length != this.ranges.length) return !1;
                for (var t = 0; t < this.ranges.length; t++) {
                    var n = this.ranges[t], i = e.ranges[t];
                    if (!ve(n.anchor, i.anchor) || !ve(n.head, i.head)) return !1
                }
                return !0
            }, ur.prototype.deepCopy = function () {
                for (var e = [], t = 0; t < this.ranges.length; t++) e[t] = new hr(ye(this.ranges[t].anchor), ye(this.ranges[t].head));
                return new ur(e, this.primIndex)
            }, ur.prototype.somethingSelected = function () {
                for (var e = 0; e < this.ranges.length; e++) if (!this.ranges[e].empty()) return !0;
                return !1
            }, ur.prototype.contains = function (e, t) {
                t || (t = e);
                for (var n = 0; n < this.ranges.length; n++) {
                    var i = this.ranges[n];
                    if (ge(t, i.from()) >= 0 && ge(e, i.to()) <= 0) return n
                }
                return -1
            };
            var hr = function (e, t) {
                this.anchor = e, this.head = t
            };
            hr.prototype.from = function () {
                return we(this.anchor, this.head)
            }, hr.prototype.to = function () {
                return be(this.anchor, this.head)
            }, hr.prototype.empty = function () {
                return this.head.line == this.anchor.line && this.head.ch == this.anchor.ch
            };

            function fr(e, t) {
                var n = e[t];
                e.sort(function (e, t) {
                    return ge(e.from(), t.from())
                }), t = H(e, n);
                for (var i = 1; i < e.length; i++) {
                    var r = e[i], o = e[i - 1];
                    if (ge(o.to(), r.from()) >= 0) {
                        var a = we(o.from(), r.from()), s = be(o.to(), r.to()),
                            l = o.empty() ? r.from() == r.head : o.from() == o.head;
                        i <= t && --t, e.splice(--i, 2, new hr(l ? s : a, l ? a : s))
                    }
                }
                return new ur(e, t)
            }

            function pr(e, t) {
                return new ur([new hr(e, t || e)], 0)
            }

            function mr(e) {
                return e.text ? me(e.from.line + e.text.length - 1, Q(e.text).length + (1 == e.text.length ? e.from.ch : 0)) : e.to
            }

            function gr(e, t) {
                if (ge(e, t.from) < 0) return e;
                if (ge(e, t.to) <= 0) return mr(t);
                var n = e.line + t.text.length - (t.to.line - t.from.line) - 1, i = e.ch;
                return e.line == t.to.line && (i += mr(t).ch - t.to.ch), me(n, i)
            }

            function vr(e, t) {
                for (var n = [], i = 0; i < e.sel.ranges.length; i++) {
                    var r = e.sel.ranges[i];
                    n.push(new hr(gr(r.anchor, t), gr(r.head, t)))
                }
                return fr(n, e.sel.primIndex)
            }

            function yr(e, t, n) {
                return e.line == t.line ? me(n.line, e.ch - t.ch + n.ch) : me(n.line + (e.line - t.line), e.ch)
            }

            function br(e) {
                e.doc.mode = Mt(e.options, e.doc.modeOption), wr(e)
            }

            function wr(e) {
                e.doc.iter(function (e) {
                    e.stateAfter && (e.stateAfter = null), e.styles && (e.styles = null)
                }), e.doc.frontier = e.doc.first, Gi(e, 100), e.state.modeGen++, e.curOp && zi(e)
            }

            function Cr(e, t) {
                return 0 == t.from.ch && 0 == t.to.ch && "" == Q(t.text) && (!e.cm || e.cm.options.wholeLineUpdateBefore)
            }

            function xr(e, t, n, i) {
                function r(e) {
                    return n ? n[e] : null
                }

                function o(e, n, r) {
                    !function (e, t, n, i) {
                        e.text = t, e.stateAfter && (e.stateAfter = null), e.styles && (e.styles = null), null != e.order && (e.order = null), Ne(e), Le(e, n);
                        var r = i ? i(e) : 1;
                        r != e.height && de(e, r)
                    }(e, n, r, i), an(e, "change", e, t)
                }

                function a(e, t) {
                    for (var n = [], o = e; o < t; ++o) n.push(new zt(c[o], r(o), i));
                    return n
                }

                var s = t.from, l = t.to, c = t.text, d = se(e, s.line), u = se(e, l.line), h = Q(c),
                    f = r(c.length - 1), p = l.line - s.line;
                if (t.full) e.insert(0, a(0, c.length)), e.remove(c.length, e.size - c.length); else if (Cr(e, t)) {
                    var m = a(0, c.length - 1);
                    o(u, u.text, f), p && e.remove(s.line, p), m.length && e.insert(s.line, m)
                } else if (d == u) if (1 == c.length) o(d, d.text.slice(0, s.ch) + h + d.text.slice(l.ch), f); else {
                    var g = a(1, c.length - 1);
                    g.push(new zt(h + d.text.slice(l.ch), f, i)), o(d, d.text.slice(0, s.ch) + c[0], r(0)), e.insert(s.line + 1, g)
                } else if (1 == c.length) o(d, d.text.slice(0, s.ch) + c[0] + u.text.slice(l.ch), r(0)), e.remove(s.line + 1, p); else {
                    o(d, d.text.slice(0, s.ch) + c[0], r(0)), o(u, h + u.text.slice(l.ch), f);
                    var v = a(1, c.length - 1);
                    p > 1 && e.remove(s.line + 1, p - 1), e.insert(s.line + 1, v)
                }
                an(e, "change", e, t)
            }

            function kr(e, t, n) {
                !function e(i, r, o) {
                    if (i.linked) for (var a = 0; a < i.linked.length; ++a) {
                        var s = i.linked[a];
                        if (s.doc != r) {
                            var l = o && s.sharedHist;
                            n && !l || (t(s.doc, l), e(s.doc, i, l))
                        }
                    }
                }(e, null, !0)
            }

            function Sr(e, t) {
                if (t.cm) throw new Error("This document is already in use.");
                e.doc = t, t.cm = e, ti(e), br(e), Er(e), e.options.lineWrapping || Ke(e), e.options.mode = t.modeOption, zi(e)
            }

            function Er(e) {
                ("rtl" == e.doc.direction ? R : E)(e.display.lineDiv, "CodeMirror-rtl")
            }

            function Fr(e) {
                this.done = [], this.undone = [], this.undoDepth = 1 / 0, this.lastModTime = this.lastSelTime = 0, this.lastOp = this.lastSelOp = null, this.lastOrigin = this.lastSelOrigin = null, this.generation = this.maxGeneration = e || 1
            }

            function _r(e, t) {
                var n = {from: ye(t.from), to: mr(t), text: le(e, t.from, t.to)};
                return Lr(e, n, t.from.line, t.to.line + 1), kr(e, function (e) {
                    return Lr(e, n, t.from.line, t.to.line + 1)
                }, !0), n
            }

            function Tr(e) {
                for (; e.length;) {
                    if (!Q(e).ranges) break;
                    e.pop()
                }
            }

            function Mr(e, t, n, i) {
                var r = e.history;
                r.undone.length = 0;
                var o, a, s = +new Date;
                if (!((t.text || []).length > 1) && (r.lastOp == i || r.lastOrigin == t.origin && t.origin && ("+" == t.origin.charAt(0) && e.cm && r.lastModTime > s - e.cm.options.historyEventDelay || "*" == t.origin.charAt(0))) && (c = r, d = r.lastOp == i, o = d ? (Tr(c.done), Q(c.done)) : c.done.length && !Q(c.done).ranges ? Q(c.done) : c.done.length > 1 && !c.done[c.done.length - 2].ranges ? (c.done.pop(), Q(c.done)) : void 0)) a = Q(o.changes), 0 == ge(t.from, t.to) && 0 == ge(t.from, a.to) ? a.to = mr(t) : o.changes.push(_r(e, t)); else {
                    "setValue" != t.origin && e.cm.cid && e.cm.editor.fences.addToUndoManager(e.cm, !1, "undo");
                    var l = Q(r.done);
                    for (l && l.ranges || Nr(e.sel, r.done), o = {
                        changes: [_r(e, t)],
                        generation: r.generation
                    }, r.done.push(o); r.done.length > r.undoDepth;) r.done.shift(), r.done[0].ranges || r.done.shift()
                }
                var c, d;
                r.done.push(n), r.generation = ++r.maxGeneration, r.lastModTime = r.lastSelTime = s, r.lastOp = r.lastSelOp = i, r.lastOrigin = r.lastSelOrigin = t.origin, a || at(e, "historyAdded")
            }

            function Ar(e, t, n, i) {
                var r = e.history, o = i && i.origin;
                n == r.lastSelOp || o && r.lastSelOrigin == o && (r.lastModTime == r.lastSelTime && r.lastOrigin == o || function (e, t, n, i) {
                    var r = t.charAt(0);
                    return "*" == r || "+" == r && n.ranges.length == i.ranges.length && n.somethingSelected() == i.somethingSelected() && new Date - e.history.lastSelTime <= (e.cm ? e.cm.options.historyEventDelay : 500)
                }(e, o, Q(r.done), t)) ? r.done[r.done.length - 1] = t : Nr(t, r.done), r.lastSelTime = +new Date, r.lastSelOrigin = o, r.lastSelOp = n, i && !1 !== i.clearRedo && Tr(r.undone)
            }

            function Nr(e, t) {
                var n = Q(t);
                n && n.ranges && n.equals(e) || t.push(e)
            }

            function Lr(e, t, n, i) {
                var r = t["spans_" + e.id], o = 0;
                e.iter(Math.max(e.first, n), Math.min(e.first + e.size, i), function (n) {
                    n.markedSpans && ((r || (r = t["spans_" + e.id] = {}))[o] = n.markedSpans), ++o
                })
            }

            function Rr(e) {
                if (!e) return null;
                for (var t, n = 0; n < e.length; ++n) e[n].marker.explicitlyCleared ? t || (t = e.slice(0, n)) : t && t.push(e[n]);
                return t ? t.length ? t : null : e
            }

            function Dr(e, t) {
                var n = function (e, t) {
                    var n = t["spans_" + e.id];
                    if (!n) return null;
                    for (var i = [], r = 0; r < t.text.length; ++r) i.push(Rr(n[r]));
                    return i
                }(e, t), i = Me(e, t);
                if (!n) return i;
                if (!i) return n;
                for (var r = 0; r < n.length; ++r) {
                    var o = n[r], a = i[r];
                    if (o && a) e:for (var s = 0; s < a.length; ++s) {
                        for (var l = a[s], c = 0; c < o.length; ++c) if (o[c].marker == l.marker) continue e;
                        o.push(l)
                    } else a && (n[r] = a)
                }
                return n
            }

            function Or(e, t, n) {
                for (var i = [], r = 0; r < e.length; ++r) {
                    var o = e[r];
                    if (o.ranges) i.push(n ? ur.prototype.deepCopy.call(o) : o); else {
                        var a = o.changes, s = [];
                        i.push({changes: s});
                        for (var l = 0; l < a.length; ++l) {
                            var c = a[l], d = void 0;
                            if (s.push({
                                from: c.from,
                                to: c.to,
                                text: c.text
                            }), t) for (var u in c) (d = u.match(/^spans_(\d+)$/)) && H(t, Number(d[1])) > -1 && (Q(s)[u] = c[u], delete c[u])
                        }
                    }
                }
                return i
            }

            function Ir(e, t, n, i) {
                if (e.cm && e.cm.display.shift || e.extend) {
                    var r = t.anchor;
                    if (i) {
                        var o = ge(n, r) < 0;
                        o != ge(i, r) < 0 ? (r = n, n = i) : o != ge(n, i) < 0 && (n = i)
                    }
                    return new hr(r, n)
                }
                return new hr(i || n, n)
            }

            function Pr(e, t, n, i) {
                jr(e, new ur([Ir(e, e.sel.primary(), t, n)], 0), i)
            }

            function Br(e, t, n) {
                for (var i = [], r = 0; r < e.sel.ranges.length; r++) i[r] = Ir(e, e.sel.ranges[r], t[r], null);
                jr(e, fr(i, e.sel.primIndex), n)
            }

            function $r(e, t, n, i) {
                var r = e.sel.ranges.slice(0);
                r[t] = n, jr(e, fr(r, e.sel.primIndex), i)
            }

            function Hr(e, t, n, i) {
                jr(e, pr(t, n), i)
            }

            function Ur(e, t, n) {
                var i = e.history.done, r = Q(i);
                r && r.ranges ? (i[i.length - 1] = t, Wr(e, t, n)) : jr(e, t, n)
            }

            function jr(e, t, n) {
                Wr(e, t, n), Ar(e, e.sel, e.cm ? e.cm.curOp.id : NaN, n)
            }

            function Wr(e, t, n) {
                (ct(e, "beforeSelectionChange") || e.cm && ct(e.cm, "beforeSelectionChange")) && (t = function (e, t, n) {
                    var i = {
                        ranges: t.ranges, update: function (t) {
                            this.ranges = [];
                            for (var n = 0; n < t.length; n++) this.ranges[n] = new hr(xe(e, t[n].anchor), xe(e, t[n].head))
                        }, origin: n && n.origin
                    };
                    return at(e, "beforeSelectionChange", e, i), e.cm && at(e.cm, "beforeSelectionChange", e.cm, i), i.ranges != t.ranges ? fr(i.ranges, i.ranges.length - 1) : t
                }(e, t, n));
                qr(e, Vr(e, t, n && n.bias || (ge(t.primary().head, e.sel.primary().head) < 0 ? -1 : 1), !0)), n && !1 === n.scroll || !e.cm || wi(e.cm)
            }

            function qr(e, t) {
                t.equals(e.sel) || (e.sel = t, e.cm && (e.cm.curOp.updateInput = e.cm.curOp.selectionChanged = !0, lt(e.cm)), an(e, "cursorActivity", e))
            }

            function zr(e) {
                qr(e, Vr(e, e.sel, null, !1))
            }

            function Vr(e, t, n, i) {
                for (var r, o = 0; o < t.ranges.length; o++) {
                    var a = t.ranges[o], s = t.ranges.length == e.sel.ranges.length && e.sel.ranges[o],
                        l = Yr(e, a.anchor, s && s.anchor, n, i), c = Yr(e, a.head, s && s.head, n, i);
                    (r || l != a.anchor || c != a.head) && (r || (r = t.ranges.slice(0, o)), r[o] = new hr(l, c))
                }
                return r ? fr(r, t.primIndex) : t
            }

            function Kr(e, t, n, i, r) {
                var o = se(e, t.line);
                if (o.markedSpans) for (var a = 0; a < o.markedSpans.length; ++a) {
                    var s = o.markedSpans[a], l = s.marker;
                    if ((null == s.from || (l.inclusiveLeft ? s.from <= t.ch : s.from < t.ch)) && (null == s.to || (l.inclusiveRight ? s.to >= t.ch : s.to > t.ch))) {
                        if (r && (at(l, "beforeCursorEnter"), l.explicitlyCleared)) {
                            if (o.markedSpans) {
                                --a;
                                continue
                            }
                            break
                        }
                        if (!l.atomic) continue;
                        if (n) {
                            var c = l.find(i < 0 ? 1 : -1), d = void 0;
                            if ((i < 0 ? l.inclusiveRight : l.inclusiveLeft) && (c = Qr(e, c, -i, c && c.line == t.line ? o : null)), c && c.line == t.line && (d = ge(c, n)) && (i < 0 ? d < 0 : d > 0)) return Kr(e, c, t, i, r)
                        }
                        var u = l.find(i < 0 ? -1 : 1);
                        return (i < 0 ? l.inclusiveLeft : l.inclusiveRight) && (u = Qr(e, u, i, u.line == t.line ? o : null)), u ? Kr(e, u, t, i, r) : null
                    }
                }
                return t
            }

            function Yr(e, t, n, i, r) {
                var o = i || 1,
                    a = Kr(e, t, n, o, r) || !r && Kr(e, t, n, o, !0) || Kr(e, t, n, -o, r) || !r && Kr(e, t, n, -o, !0);
                return a || (e.cantEdit = !0, me(e.first, 0))
            }

            function Qr(e, t, n, i) {
                return n < 0 && 0 == t.ch ? t.line > e.first ? xe(e, me(t.line - 1)) : null : n > 0 && t.ch == (i || se(e, t.line)).text.length ? t.line < e.first + e.size - 1 ? me(t.line + 1, 0) : null : new me(t.line, t.ch + n)
            }

            function Gr(e) {
                e.setSelection(me(e.firstLine(), 0), me(e.lastLine()), W)
            }

            function Jr(e, t, n) {
                var i = {
                    canceled: !1, from: t.from, to: t.to, text: t.text, origin: t.origin, cancel: function () {
                        return i.canceled = !0
                    }
                };
                return n && (i.update = function (t, n, r, o) {
                    t && (i.from = xe(e, t)), n && (i.to = xe(e, n)), r && (i.text = r), void 0 !== o && (i.origin = o)
                }), at(e, "beforeChange", e, i), e.cm && at(e.cm, "beforeChange", e.cm, i), i.canceled ? null : {
                    from: i.from,
                    to: i.to,
                    text: i.text,
                    origin: i.origin
                }
            }

            function Xr(e, t, n) {
                if (e.cm) {
                    if (!e.cm.curOp) return ji(e.cm, Xr)(e, t, n);
                    if (e.cm.state.suppressEdits) return
                }
                if (!(ct(e, "beforeChange") || e.cm && ct(e.cm, "beforeChange")) || (t = Jr(e, t, !0))) {
                    var i = Se && !n && function (e, t, n) {
                        var i = null;
                        if (e.iter(t.line, n.line + 1, function (e) {
                            if (e.markedSpans) for (var t = 0; t < e.markedSpans.length; ++t) {
                                var n = e.markedSpans[t].marker;
                                !n.readOnly || i && -1 != H(i, n) || (i || (i = [])).push(n)
                            }
                        }), !i) return null;
                        for (var r = [{
                            from: t,
                            to: n
                        }], o = 0; o < i.length; ++o) for (var a = i[o], s = a.find(0), l = 0; l < r.length; ++l) {
                            var c = r[l];
                            if (!(ge(c.to, s.from) < 0 || ge(c.from, s.to) > 0)) {
                                var d = [l, 1], u = ge(c.from, s.from), h = ge(c.to, s.to);
                                (u < 0 || !a.inclusiveLeft && !u) && d.push({
                                    from: c.from,
                                    to: s.from
                                }), (h > 0 || !a.inclusiveRight && !h) && d.push({
                                    from: s.to,
                                    to: c.to
                                }), r.splice.apply(r, d), l += d.length - 3
                            }
                        }
                        return r
                    }(e, t.from, t.to);
                    if (i) for (var r = i.length - 1; r >= 0; --r) Zr(e, {
                        from: i[r].from,
                        to: i[r].to,
                        text: r ? [""] : t.text
                    }); else Zr(e, t)
                }
            }

            function Zr(e, t) {
                if (1 != t.text.length || "" != t.text[0] || 0 != ge(t.from, t.to)) {
                    var n = vr(e, t);
                    Mr(e, t, n, e.cm ? e.cm.curOp.id : NaN), no(e, t, n, Me(e, t));
                    var i = [];
                    kr(e, function (e, n) {
                        n || -1 != H(i, e.history) || (ao(e.history, t), i.push(e.history)), no(e, t, null, Me(e, t))
                    })
                }
            }

            function eo(e, t, n) {
                if (!e.cm || !e.cm.state.suppressEdits || n) {
                    for (var i, r = e.history, o = e.sel, a = "undo" == t ? r.done : r.undone, s = "undo" == t ? r.undone : r.done, l = 0; l < a.length && (i = a[l], n ? !i.ranges || i.equals(e.sel) : i.ranges); l++) ;
                    if (l != a.length) {
                        for (r.lastOrigin = r.lastSelOrigin = null; (i = a.pop()).ranges;) {
                            if (Nr(i, s), n && !i.equals(e.sel)) return void jr(e, i, {clearRedo: !1});
                            o = i
                        }
                        var c = [];
                        Nr(o, s), s.push({
                            changes: c,
                            generation: r.generation
                        }), r.generation = i.generation || ++r.maxGeneration;
                        for (var d = ct(e, "beforeChange") || e.cm && ct(e.cm, "beforeChange"), u = function (n) {
                            var r = i.changes[n];
                            if (r.origin = t, d && !Jr(e, r, !1)) return a.length = 0, {};
                            c.push(_r(e, r));
                            var o = n ? vr(e, r) : Q(a);
                            no(e, r, o, Dr(e, r)), !n && e.cm && e.cm.scrollIntoView({from: r.from, to: mr(r)});
                            var s = [];
                            kr(e, function (e, t) {
                                t || -1 != H(s, e.history) || (ao(e.history, r), s.push(e.history)), no(e, r, null, Dr(e, r))
                            })
                        }, h = i.changes.length - 1; h >= 0; --h) {
                            var f = u(h);
                            if (f) return f.v
                        }
                    }
                }
            }

            function to(e, t) {
                if (0 != t && (e.first += t, e.sel = new ur(G(e.sel.ranges, function (e) {
                    return new hr(me(e.anchor.line + t, e.anchor.ch), me(e.head.line + t, e.head.ch))
                }), e.sel.primIndex), e.cm)) {
                    zi(e.cm, e.first, e.first - t, t);
                    for (var n = e.cm.display, i = n.viewFrom; i < n.viewTo; i++) Vi(e.cm, i, "gutter")
                }
            }

            function no(e, t, n, i) {
                if (e.cm && !e.cm.curOp) return ji(e.cm, no)(e, t, n, i);
                if (t.to.line < e.first) to(e, t.text.length - 1 - (t.to.line - t.from.line)); else if (!(t.from.line > e.lastLine())) {
                    if (t.from.line < e.first) {
                        var r = t.text.length - 1 - (e.first - t.from.line);
                        to(e, r), t = {
                            from: me(e.first, 0),
                            to: me(t.to.line + r, t.to.ch),
                            text: [Q(t.text)],
                            origin: t.origin
                        }
                    }
                    var o = e.lastLine();
                    t.to.line > o && (t = {
                        from: t.from,
                        to: me(o, se(e, o).text.length),
                        text: [t.text[0]],
                        origin: t.origin
                    }), t.removed = le(e, t.from, t.to), n || (n = vr(e, t)), e.cm ? function (e, t, n) {
                        var i = e.doc, r = e.display, o = t.from, a = t.to, s = !1, l = o.line;
                        e.options.lineWrapping || (l = ue(He(se(i, o.line))), i.iter(l, a.line + 1, function (e) {
                            if (e == r.maxLine) return s = !0, !0
                        }));
                        i.sel.contains(t.from, t.to) > -1 && lt(e);
                        xr(i, t, n, ei(e)), e.options.lineWrapping || (i.iter(l, o.line + t.text.length, function (e) {
                            var t = Ve(e);
                            t > r.maxLineLength && (r.maxLine = e, r.maxLineLength = t, r.maxLineChanged = !0, s = !1)
                        }), s && (e.curOp.updateMaxLine = !0));
                        i.frontier = Math.min(i.frontier, o.line - 1), Gi(e, 400);
                        var c = t.text.length - (a.line - o.line) - 1;
                        t.full ? zi(e) : o.line != a.line || 1 != t.text.length || Cr(e.doc, t) ? zi(e, o.line, a.line + 1, c) : Vi(e, o.line, "text");
                        var d = ct(e, "changes"), u = ct(e, "change");
                        if (u || d) {
                            var h = {from: o, to: a, text: t.text, removed: t.removed, origin: t.origin};
                            u && an(e, "change", e, h), d && (e.curOp.changeObjs || (e.curOp.changeObjs = [])).push(h)
                        }
                        e.display.selForContextMenu = null
                    }(e.cm, t, i) : xr(e, t, i), Wr(e, n, W)
                }
            }

            function io(e, t, n, i, r) {
                if (i || (i = n), ge(i, n) < 0) {
                    var o = i;
                    i = n, n = o
                }
                "string" == typeof t && (t = e.splitLines(t)), Xr(e, {from: n, to: i, text: t, origin: r})
            }

            function ro(e, t, n, i) {
                n < e.line ? e.line += i : t < e.line && (e.line = t, e.ch = 0)
            }

            function oo(e, t, n, i) {
                for (var r = 0; r < e.length; ++r) {
                    var o = e[r], a = !0;
                    if (o.ranges) {
                        o.copied || ((o = e[r] = o.deepCopy()).copied = !0);
                        for (var s = 0; s < o.ranges.length; s++) ro(o.ranges[s].anchor, t, n, i), ro(o.ranges[s].head, t, n, i)
                    } else {
                        for (var l = 0; l < o.changes.length; ++l) {
                            var c = o.changes[l];
                            if (n < c.from.line) c.from = me(c.from.line + i, c.from.ch), c.to = me(c.to.line + i, c.to.ch); else if (t <= c.to.line) {
                                a = !1;
                                break
                            }
                        }
                        a || (e.splice(0, r + 1), r = 0)
                    }
                }
            }

            function ao(e, t) {
                var n = t.from.line, i = t.to.line, r = t.text.length - (i - n) - 1;
                oo(e.done, n, i, r), oo(e.undone, n, i, r)
            }

            function so(e, t, n, i) {
                var r = t, o = t;
                return "number" == typeof t ? o = se(e, Ce(e, t)) : r = ue(t), null == r ? null : (i(o, r) && e.cm && Vi(e.cm, r, n), o)
            }

            var lo = function (e) {
                this.lines = e, this.parent = null;
                for (var t = 0, n = 0; n < e.length; ++n) e[n].parent = this, t += e[n].height;
                this.height = t
            };
            lo.prototype.chunkSize = function () {
                return this.lines.length
            }, lo.prototype.removeInner = function (e, t) {
                for (var n = e, i = e + t; n < i; ++n) {
                    var r = this.lines[n];
                    this.height -= r.height, (o = r).parent = null, Ne(o), an(r, "delete")
                }
                var o;
                this.lines.splice(e, t)
            }, lo.prototype.collapse = function (e) {
                e.push.apply(e, this.lines)
            }, lo.prototype.insertInner = function (e, t, n) {
                this.height += n, this.lines = this.lines.slice(0, e).concat(t).concat(this.lines.slice(e));
                for (var i = 0; i < t.length; ++i) t[i].parent = this
            }, lo.prototype.iterN = function (e, t, n) {
                for (var i = e + t; e < i; ++e) if (n(this.lines[e])) return !0
            };
            var co = function (e) {
                this.children = e;
                for (var t = 0, n = 0, i = 0; i < e.length; ++i) {
                    var r = e[i];
                    t += r.chunkSize(), n += r.height, r.parent = this
                }
                this.size = t, this.height = n, this.parent = null
            };
            co.prototype.chunkSize = function () {
                return this.size
            }, co.prototype.removeInner = function (e, t) {
                this.size -= t;
                for (var n = 0; n < this.children.length; ++n) {
                    var i = this.children[n], r = i.chunkSize();
                    if (e < r) {
                        var o = Math.min(t, r - e), a = i.height;
                        if (i.removeInner(e, o), this.height -= a - i.height, r == o && (this.children.splice(n--, 1), i.parent = null), 0 == (t -= o)) break;
                        e = 0
                    } else e -= r
                }
                if (this.size - t < 25 && (this.children.length > 1 || !(this.children[0] instanceof lo))) {
                    var s = [];
                    this.collapse(s), this.children = [new lo(s)], this.children[0].parent = this
                }
            }, co.prototype.collapse = function (e) {
                for (var t = 0; t < this.children.length; ++t) this.children[t].collapse(e)
            }, co.prototype.insertInner = function (e, t, n) {
                this.size += t.length, this.height += n;
                for (var i = 0; i < this.children.length; ++i) {
                    var r = this.children[i], o = r.chunkSize();
                    if (e <= o) {
                        if (r.insertInner(e, t, n), r.lines && r.lines.length > 50) {
                            for (var a = r.lines.length % 25 + 25, s = a; s < r.lines.length;) {
                                var l = new lo(r.lines.slice(s, s += 25));
                                r.height -= l.height, this.children.splice(++i, 0, l), l.parent = this
                            }
                            r.lines = r.lines.slice(0, a), this.maybeSpill()
                        }
                        break
                    }
                    e -= o
                }
            }, co.prototype.maybeSpill = function () {
                if (!(this.children.length <= 10)) {
                    var e = this;
                    do {
                        var t = e.children.splice(e.children.length - 5, 5), n = new co(t);
                        if (e.parent) {
                            e.size -= n.size, e.height -= n.height;
                            var i = H(e.parent.children, e);
                            e.parent.children.splice(i + 1, 0, n)
                        } else {
                            var r = new co(e.children);
                            r.parent = e, e.children = [r, n], e = r
                        }
                        n.parent = e.parent
                    } while (e.children.length > 10);
                    e.parent.maybeSpill()
                }
            }, co.prototype.iterN = function (e, t, n) {
                for (var i = 0; i < this.children.length; ++i) {
                    var r = this.children[i], o = r.chunkSize();
                    if (e < o) {
                        var a = Math.min(t, o - e);
                        if (r.iterN(e, a, n)) return !0;
                        if (0 == (t -= a)) break;
                        e = 0
                    } else e -= o
                }
            };
            var uo = function (e, t, n) {
                if (n) for (var i in n) n.hasOwnProperty(i) && (this[i] = n[i]);
                this.doc = e, this.node = t
            };
            uo.prototype.clear = function () {
                var e = this.doc.cm, t = this.line.widgets, n = this.line, i = ue(n);
                if (null != i && t) {
                    for (var r = 0; r < t.length; ++r) t[r] == this && t.splice(r--, 1);
                    t.length || (n.widgets = null);
                    var o = bn(this);
                    de(n, Math.max(0, n.height - o)), e && (Ui(e, function () {
                        ho(e, n, -o), Vi(e, i, "widget")
                    }), an(e, "lineWidgetCleared", e, this, i))
                }
            }, uo.prototype.changed = function () {
                var e = this, t = this.height, n = this.doc.cm, i = this.line;
                this.height = null;
                var r = bn(this) - t;
                r && (de(i, i.height + r), n && Ui(n, function () {
                    n.curOp.forceUpdate = !0, ho(n, i, r), an(n, "lineWidgetChanged", n, e, ue(i))
                }))
            }, dt(uo);

            function ho(e, t, n) {
                ze(t) < (e.curOp && e.curOp.scrollTop || e.doc.scrollTop) && bi(e, n)
            }

            var fo = 0, po = function (e, t) {
                this.lines = [], this.type = t, this.doc = e, this.id = ++fo
            };
            po.prototype.clear = function () {
                if (!this.explicitlyCleared) {
                    var e = this.doc.cm, t = e && !e.curOp;
                    if (t && Oi(e), ct(this, "clear")) {
                        var n = this.find();
                        n && an(this, "clear", n.from, n.to)
                    }
                    for (var i = null, r = null, o = 0; o < this.lines.length; ++o) {
                        var a = this.lines[o], s = _e(a.markedSpans, this);
                        e && !this.collapsed ? Vi(e, ue(a), "text") : e && (null != s.to && (r = ue(a)), null != s.from && (i = ue(a))), a.markedSpans = Te(a.markedSpans, s), null == s.from && this.collapsed && !We(this.doc, a) && e && de(a, Gn(e.display))
                    }
                    if (e && this.collapsed && !e.options.lineWrapping) for (var l = 0; l < this.lines.length; ++l) {
                        var c = He(this.lines[l]), d = Ve(c);
                        d > e.display.maxLineLength && (e.display.maxLine = c, e.display.maxLineLength = d, e.display.maxLineChanged = !0)
                    }
                    null != i && e && this.collapsed && zi(e, i, r + 1), this.lines.length = 0, this.explicitlyCleared = !0, this.atomic && this.doc.cantEdit && (this.doc.cantEdit = !1, e && zr(e.doc)), e && an(e, "markerCleared", e, this, i, r), t && Ii(e), this.parent && this.parent.clear()
                }
            }, po.prototype.find = function (e, t) {
                null == e && "bookmark" == this.type && (e = 1);
                for (var n, i, r = 0; r < this.lines.length; ++r) {
                    var o = this.lines[r], a = _e(o.markedSpans, this);
                    if (null != a.from && (n = me(t ? o : ue(o), a.from), -1 == e)) return n;
                    if (null != a.to && (i = me(t ? o : ue(o), a.to), 1 == e)) return i
                }
                return n && {from: n, to: i}
            }, po.prototype.changed = function () {
                var e = this, t = this.find(-1, !0), n = this, i = this.doc.cm;
                t && i && Ui(i, function () {
                    var r = t.line, o = ue(t.line), a = Mn(i, o);
                    if (a && (On(a), i.curOp.selectionChanged = i.curOp.forceUpdate = !0), i.curOp.updateMaxLine = !0, !We(n.doc, r) && null != n.height) {
                        var s = n.height;
                        n.height = null;
                        var l = bn(n) - s;
                        l && de(r, r.height + l)
                    }
                    an(i, "markerChanged", i, e)
                })
            }, po.prototype.attachLine = function (e) {
                if (!this.lines.length && this.doc.cm) {
                    var t = this.doc.cm.curOp;
                    t.maybeHiddenMarkers && -1 != H(t.maybeHiddenMarkers, this) || (t.maybeUnhiddenMarkers || (t.maybeUnhiddenMarkers = [])).push(this)
                }
                this.lines.push(e)
            }, po.prototype.detachLine = function (e) {
                if (this.lines.splice(H(this.lines, e), 1), !this.lines.length && this.doc.cm) {
                    var t = this.doc.cm.curOp;
                    (t.maybeHiddenMarkers || (t.maybeHiddenMarkers = [])).push(this)
                }
            }, dt(po);

            function mo(e, t, n, i, r) {
                if (i && i.shared) return function (e, t, n, i, r) {
                    (i = P(i)).shared = !1;
                    var o = [mo(e, t, n, i, r)], a = o[0], s = i.widgetNode;
                    return kr(e, function (e) {
                        s && (i.widgetNode = s.cloneNode(!0)), o.push(mo(e, xe(e, t), xe(e, n), i, r));
                        for (var l = 0; l < e.linked.length; ++l) if (e.linked[l].isParent) return;
                        a = Q(o)
                    }), new go(o, a)
                }(e, t, n, i, r);
                if (e.cm && !e.cm.curOp) return ji(e.cm, mo)(e, t, n, i, r);
                var o = new po(e, r), a = ge(t, n);
                if (i && P(i, o, !1), a > 0 || 0 == a && !1 !== o.clearWhenEmpty) return o;
                if (o.replacedWith && (o.collapsed = !0, o.widgetNode = M("span", [o.replacedWith], "CodeMirror-widget"), i.handleMouseEvents || o.widgetNode.setAttribute("cm-ignore-events", "true"), i.insertLeft && (o.widgetNode.insertLeft = !0)), o.collapsed) {
                    if ($e(e, t.line, t, n, o) || t.line != n.line && $e(e, n.line, t, n, o)) throw new Error("Inserting collapsed marker partially overlapping an existing one");
                    Ee = !0
                }
                o.addToHistory && Mr(e, {from: t, to: n, origin: "markText"}, e.sel, NaN);
                var s, l = t.line, c = e.cm;
                if (e.iter(l, n.line + 1, function (e) {
                    c && o.collapsed && !c.options.lineWrapping && He(e) == c.display.maxLine && (s = !0), o.collapsed && l != t.line && de(e, 0), i = e, r = new Fe(o, l == t.line ? t.ch : null, l == n.line ? n.ch : null), i.markedSpans = i.markedSpans ? i.markedSpans.concat([r]) : [r], r.marker.attachLine(i);
                    var i, r;
                    ++l
                }), o.collapsed && e.iter(t.line, n.line + 1, function (t) {
                    We(e, t) && de(t, 0)
                }), o.clearOnEnter && it(o, "beforeCursorEnter", function () {
                    return o.clear()
                }), o.readOnly && (Se = !0, (e.history.done.length || e.history.undone.length) && e.clearHistory()), o.collapsed && (o.id = ++fo, o.atomic = !0), c) {
                    if (s && (c.curOp.updateMaxLine = !0), o.collapsed) zi(c, t.line, n.line + 1); else if (o.className || o.title || o.startStyle || o.endStyle || o.css) for (var d = t.line; d <= n.line; d++) Vi(c, d, "text");
                    o.atomic && zr(c.doc), an(c, "markerAdded", c, o)
                }
                return o
            }

            var go = function (e, t) {
                this.markers = e, this.primary = t;
                for (var n = 0; n < e.length; ++n) e[n].parent = this
            };
            go.prototype.clear = function () {
                if (!this.explicitlyCleared) {
                    this.explicitlyCleared = !0;
                    for (var e = 0; e < this.markers.length; ++e) this.markers[e].clear();
                    an(this, "clear")
                }
            }, go.prototype.find = function (e, t) {
                return this.primary.find(e, t)
            }, dt(go);

            function vo(e) {
                return e.findMarks(me(e.first, 0), e.clipPos(me(e.lastLine())), function (e) {
                    return e.parent
                })
            }

            function yo(e) {
                for (var t = function (t) {
                    var n = e[t], i = [n.primary.doc];
                    kr(n.primary.doc, function (e) {
                        return i.push(e)
                    });
                    for (var r = 0; r < n.markers.length; r++) {
                        var o = n.markers[r];
                        -1 == H(i, o.doc) && (o.parent = null, n.markers.splice(r--, 1))
                    }
                }, n = 0; n < e.length; n++) t(n)
            }

            var bo = 0, wo = function (e, t, n, i, r) {
                if (!(this instanceof wo)) return new wo(e, t, n, i, r);
                null == n && (n = 0), co.call(this, [new lo([new zt("", null)])]), this.first = n, this.scrollTop = this.scrollLeft = 0, this.cantEdit = !1, this.cleanGeneration = 1, this.frontier = n;
                var o = me(n, 0);
                this.sel = pr(o), this.history = new Fr(null), this.id = ++bo, this.modeOption = t, this.lineSep = i, this.direction = "rtl" == r ? "rtl" : "ltr", this.extend = !1, "string" == typeof e && (e = this.splitLines(e)), xr(this, {
                    from: o,
                    to: o,
                    text: e
                }), jr(this, pr(o), W)
            };
            wo.prototype = X(co.prototype, {
                constructor: wo, iter: function (e, t, n) {
                    n ? this.iterN(e - this.first, t - e, n) : this.iterN(this.first, this.first + this.size, e)
                }, insert: function (e, t) {
                    for (var n = 0, i = 0; i < t.length; ++i) n += t[i].height;
                    this.insertInner(e - this.first, t, n)
                }, remove: function (e, t) {
                    this.removeInner(e - this.first, t)
                }, getValue: function (e) {
                    var t = ce(this, this.first, this.first + this.size);
                    return !1 === e ? t : t.join(e || this.lineSeparator())
                }, setValue: qi(function (e, t) {
                    var n = me(this.first, 0), i = this.first + this.size - 1;
                    Xr(this, {
                        from: n,
                        to: me(i, se(this, i).text.length),
                        text: this.splitLines(e),
                        origin: t || "setValue",
                        full: !0
                    }, !0), this.cm && Ci(this.cm, 0, 0), jr(this, pr(n), W)
                }), replaceRange: function (e, t, n, i) {
                    io(this, e, t = xe(this, t), n = n ? xe(this, n) : t, i)
                }, getRange: function (e, t, n) {
                    var i = le(this, xe(this, e), xe(this, t));
                    return !1 === n ? i : i.join(n || this.lineSeparator())
                }, getLine: function (e) {
                    var t = this.getLineHandle(e);
                    return t && t.text
                }, getLineHandle: function (e) {
                    if (fe(this, e)) return se(this, e)
                }, getLineNumber: function (e) {
                    return ue(e)
                }, getLineHandleVisualStart: function (e) {
                    return "number" == typeof e && (e = se(this, e)), He(e)
                }, lineCount: function () {
                    return this.size
                }, firstLine: function () {
                    return this.first
                }, lastLine: function () {
                    return this.first + this.size - 1
                }, clipPos: function (e) {
                    return xe(this, e)
                }, getCursor: function (e) {
                    var t = this.sel.primary();
                    return null == e || "head" == e ? t.head : "anchor" == e ? t.anchor : "end" == e || "to" == e || !1 === e ? t.to() : t.from()
                }, listSelections: function () {
                    return this.sel.ranges
                }, somethingSelected: function () {
                    return this.sel.somethingSelected()
                }, setCursor: qi(function (e, t, n) {
                    Hr(this, xe(this, "number" == typeof e ? me(e, t || 0) : e), null, n)
                }), setSelection: qi(function (e, t, n) {
                    Hr(this, xe(this, e), xe(this, t || e), n)
                }), extendSelection: qi(function (e, t, n) {
                    Pr(this, xe(this, e), t && xe(this, t), n)
                }), extendSelections: qi(function (e, t) {
                    Br(this, ke(this, e), t)
                }), extendSelectionsBy: qi(function (e, t) {
                    Br(this, ke(this, G(this.sel.ranges, e)), t)
                }), setSelections: qi(function (e, t, n) {
                    if (e.length) {
                        for (var i = [], r = 0; r < e.length; r++) i[r] = new hr(xe(this, e[r].anchor), xe(this, e[r].head));
                        null == t && (t = Math.min(e.length - 1, this.sel.primIndex)), jr(this, fr(i, t), n)
                    }
                }), addSelection: qi(function (e, t, n) {
                    var i = this.sel.ranges.slice(0);
                    i.push(new hr(xe(this, e), xe(this, t || e))), jr(this, fr(i, i.length - 1), n)
                }), getSelection: function (e) {
                    for (var t, n = this.sel.ranges, i = 0; i < n.length; i++) {
                        var r = le(this, n[i].from(), n[i].to());
                        t = t ? t.concat(r) : r
                    }
                    return !1 === e ? t : t.join(e || this.lineSeparator())
                }, getSelections: function (e) {
                    for (var t = [], n = this.sel.ranges, i = 0; i < n.length; i++) {
                        var r = le(this, n[i].from(), n[i].to());
                        !1 !== e && (r = r.join(e || this.lineSeparator())), t[i] = r
                    }
                    return t
                }, replaceSelection: function (e, t, n) {
                    for (var i = [], r = 0; r < this.sel.ranges.length; r++) i[r] = e;
                    this.replaceSelections(i, t, n || "+input")
                }, replaceSelections: qi(function (e, t, n) {
                    for (var i = [], r = this.sel, o = 0; o < r.ranges.length; o++) {
                        var a = r.ranges[o];
                        i[o] = {from: a.from(), to: a.to(), text: this.splitLines(e[o]), origin: n}
                    }
                    for (var s = t && "end" != t && function (e, t, n) {
                        for (var i = [], r = me(e.first, 0), o = r, a = 0; a < t.length; a++) {
                            var s = t[a], l = yr(s.from, r, o), c = yr(mr(s), r, o);
                            if (r = s.to, o = c, "around" == n) {
                                var d = e.sel.ranges[a], u = ge(d.head, d.anchor) < 0;
                                i[a] = new hr(u ? c : l, u ? l : c)
                            } else i[a] = new hr(l, l)
                        }
                        return new ur(i, e.sel.primIndex)
                    }(this, i, t), l = i.length - 1; l >= 0; l--) Xr(this, i[l]);
                    s ? Ur(this, s) : this.cm && wi(this.cm)
                }), undo: qi(function () {
                    eo(this, "undo")
                }), redo: qi(function () {
                    eo(this, "redo")
                }), undoSelection: qi(function () {
                    eo(this, "undo", !0)
                }), redoSelection: qi(function () {
                    eo(this, "redo", !0)
                }), setExtending: function (e) {
                    this.extend = e
                }, getExtending: function () {
                    return this.extend
                }, historySize: function () {
                    for (var e = this.history, t = 0, n = 0, i = 0; i < e.done.length; i++) e.done[i].ranges || ++t;
                    for (var r = 0; r < e.undone.length; r++) e.undone[r].ranges || ++n;
                    return {undo: t, redo: n}
                }, clearHistory: function () {
                    this.history = new Fr(this.history.maxGeneration)
                }, markClean: function () {
                    this.cleanGeneration = this.changeGeneration(!0)
                }, changeGeneration: function (e) {
                    return e && (this.history.lastOp = this.history.lastSelOp = this.history.lastOrigin = null), this.history.generation
                }, isClean: function (e) {
                    return this.history.generation == (e || this.cleanGeneration)
                }, getHistory: function () {
                    return {done: Or(this.history.done), undone: Or(this.history.undone)}
                }, setHistory: function (e) {
                    var t = this.history = new Fr(this.history.maxGeneration);
                    t.done = Or(e.done.slice(0), null, !0), t.undone = Or(e.undone.slice(0), null, !0)
                }, setGutterMarker: qi(function (e, t, n) {
                    return so(this, e, "gutter", function (e) {
                        var i = e.gutterMarkers || (e.gutterMarkers = {});
                        return i[t] = n, !n && ne(i) && (e.gutterMarkers = null), !0
                    })
                }), clearGutter: qi(function (e) {
                    var t = this;
                    this.iter(function (n) {
                        n.gutterMarkers && n.gutterMarkers[e] && so(t, n, "gutter", function () {
                            return n.gutterMarkers[e] = null, ne(n.gutterMarkers) && (n.gutterMarkers = null), !0
                        })
                    })
                }), lineInfo: function (e) {
                    var t;
                    if ("number" == typeof e) {
                        if (!fe(this, e)) return null;
                        if (t = e, !(e = se(this, e))) return null
                    } else if (null == (t = ue(e))) return null;
                    return {
                        line: t,
                        handle: e,
                        text: e.text,
                        gutterMarkers: e.gutterMarkers,
                        textClass: e.textClass,
                        bgClass: e.bgClass,
                        wrapClass: e.wrapClass,
                        widgets: e.widgets
                    }
                }, addLineClass: qi(function (e, t, n) {
                    return so(this, e, "gutter" == t ? "gutter" : "class", function (e) {
                        var i = "text" == t ? "textClass" : "background" == t ? "bgClass" : "gutter" == t ? "gutterClass" : "wrapClass";
                        if (e[i]) {
                            if (S(n).test(e[i])) return !1;
                            e[i] += " " + n
                        } else e[i] = n;
                        return !0
                    })
                }), removeLineClass: qi(function (e, t, n) {
                    return so(this, e, "gutter" == t ? "gutter" : "class", function (e) {
                        var i = "text" == t ? "textClass" : "background" == t ? "bgClass" : "gutter" == t ? "gutterClass" : "wrapClass",
                            r = e[i];
                        if (!r) return !1;
                        if (null == n) e[i] = null; else {
                            var o = r.match(S(n));
                            if (!o) return !1;
                            var a = o.index + o[0].length;
                            e[i] = r.slice(0, o.index) + (o.index && a != r.length ? " " : "") + r.slice(a) || null
                        }
                        return !0
                    })
                }), addLineWidget: qi(function (e, t, n) {
                    return function (e, t, n, i) {
                        var r = new uo(e, n, i), o = e.cm;
                        return o && r.noHScroll && (o.display.alignWidgets = !0), so(e, t, "widget", function (t) {
                            var n = t.widgets || (t.widgets = []);
                            if (null == r.insertAt ? n.push(r) : n.splice(Math.min(n.length - 1, Math.max(0, r.insertAt)), 0, r), r.line = t, o && !We(e, t)) {
                                var i = ze(t) < e.scrollTop;
                                de(t, t.height + bn(r)), i && bi(o, r.height), o.curOp.forceUpdate = !0
                            }
                            return !0
                        }), an(o, "lineWidgetAdded", o, r, "number" == typeof t ? t : ue(t)), r
                    }(this, e, t, n)
                }), removeLineWidget: function (e) {
                    e.clear()
                }, markText: function (e, t, n) {
                    return mo(this, xe(this, e), xe(this, t), n, n && n.type || "range")
                }, setBookmark: function (e, t) {
                    var n = {
                        replacedWith: t && (null == t.nodeType ? t.widget : t),
                        insertLeft: t && t.insertLeft,
                        clearWhenEmpty: !1,
                        shared: t && t.shared,
                        handleMouseEvents: t && t.handleMouseEvents
                    };
                    return mo(this, e = xe(this, e), e, n, "bookmark")
                }, findMarksAt: function (e) {
                    var t = [], n = se(this, (e = xe(this, e)).line).markedSpans;
                    if (n) for (var i = 0; i < n.length; ++i) {
                        var r = n[i];
                        (null == r.from || r.from <= e.ch) && (null == r.to || r.to >= e.ch) && t.push(r.marker.parent || r.marker)
                    }
                    return t
                }, findMarks: function (e, t, n) {
                    e = xe(this, e), t = xe(this, t);
                    var i = [], r = e.line;
                    return this.iter(e.line, t.line + 1, function (o) {
                        var a = o.markedSpans;
                        if (a) for (var s = 0; s < a.length; s++) {
                            var l = a[s];
                            null != l.to && r == e.line && e.ch >= l.to || null == l.from && r != e.line || null != l.from && r == t.line && l.from >= t.ch || n && !n(l.marker) || i.push(l.marker.parent || l.marker)
                        }
                        ++r
                    }), i
                }, getAllMarks: function () {
                    var e = [];
                    return this.iter(function (t) {
                        var n = t.markedSpans;
                        if (n) for (var i = 0; i < n.length; ++i) null != n[i].from && e.push(n[i].marker)
                    }), e
                }, posFromIndex: function (e) {
                    var t, n = this.first, i = this.lineSeparator().length;
                    return this.iter(function (r) {
                        var o = r.text.length + i;
                        if (o > e) return t = e, !0;
                        e -= o, ++n
                    }), xe(this, me(n, t))
                }, indexFromPos: function (e) {
                    var t = (e = xe(this, e)).ch;
                    if (e.line < this.first || e.ch < 0) return 0;
                    var n = this.lineSeparator().length;
                    return this.iter(this.first, e.line, function (e) {
                        t += e.text.length + n
                    }), t
                }, copy: function (e) {
                    var t = new wo(ce(this, this.first, this.first + this.size), this.modeOption, this.first, this.lineSep, this.direction);
                    return t.scrollTop = this.scrollTop, t.scrollLeft = this.scrollLeft, t.sel = this.sel, t.extend = !1, e && (t.history.undoDepth = this.history.undoDepth, t.setHistory(this.getHistory())), t
                }, linkedDoc: function (e) {
                    e || (e = {});
                    var t = this.first, n = this.first + this.size;
                    null != e.from && e.from > t && (t = e.from), null != e.to && e.to < n && (n = e.to);
                    var i = new wo(ce(this, t, n), e.mode || this.modeOption, t, this.lineSep, this.direction);
                    return e.sharedHist && (i.history = this.history), (this.linked || (this.linked = [])).push({
                        doc: i,
                        sharedHist: e.sharedHist
                    }), i.linked = [{doc: this, isParent: !0, sharedHist: e.sharedHist}], function (e, t) {
                        for (var n = 0; n < t.length; n++) {
                            var i = t[n], r = i.find(), o = e.clipPos(r.from), a = e.clipPos(r.to);
                            if (ge(o, a)) {
                                var s = mo(e, o, a, i.primary, i.primary.type);
                                i.markers.push(s), s.parent = i
                            }
                        }
                    }(i, vo(this)), i
                }, unlinkDoc: function (e) {
                    if (e instanceof da && (e = e.doc), this.linked) for (var t = 0; t < this.linked.length; ++t) {
                        if (this.linked[t].doc == e) {
                            this.linked.splice(t, 1), e.unlinkDoc(this), yo(vo(this));
                            break
                        }
                    }
                    if (e.history == this.history) {
                        var n = [e.id];
                        kr(e, function (e) {
                            return n.push(e.id)
                        }, !0), e.history = new Fr(null), e.history.done = Or(this.history.done, n), e.history.undone = Or(this.history.undone, n)
                    }
                }, iterLinkedDocs: function (e) {
                    kr(this, e)
                }, getMode: function () {
                    return this.mode
                }, getEditor: function () {
                    return this.cm
                }, splitLines: function (e) {
                    return this.lineSep ? e.split(this.lineSep) : xt(e)
                }, lineSeparator: function () {
                    return File.useCRLF ? "\r\n" : "\n"
                }, setDirection: qi(function (e) {
                    if ("rtl" != e && (e = "ltr"), e != this.direction) {
                        this.direction = e, this.iter(function (e) {
                            return e.order = null
                        }), this.cm && Ui(t = this.cm, function () {
                            Er(t), zi(t)
                        });
                        var t
                    }
                })
            }), wo.prototype.eachLine = wo.prototype.iter;
            var Co = 0;

            function xo(e) {
                var t = this;
                if (ko(t), !st(t, e) && !wn(t.display, e)) {
                    ut(e), a && (Co = +new Date);
                    var n = ni(t, e, !0), i = e.dataTransfer.files;
                    if (n && !t.isReadOnly()) if (i && i.length && window.FileReader && window.File) for (var r = i.length, o = Array(r), s = 0, l = function (e, i) {
                        if (!t.options.allowDropFileTypes || -1 != H(t.options.allowDropFileTypes, e.type)) {
                            var a = new FileReader;
                            a.onload = ji(t, function () {
                                var e = a.result;
                                if (/[\x00-\x08\x0e-\x1f]{2}/.test(e) && (e = ""), o[i] = e, ++s == r) {
                                    var l = {
                                        from: n = xe(t.doc, n),
                                        to: n,
                                        text: t.doc.splitLines(o.join(t.doc.lineSeparator())),
                                        origin: "paste"
                                    };
                                    Xr(t.doc, l), Ur(t.doc, pr(n, mr(l)))
                                }
                            }), a.readAsText(e)
                        }
                    }, c = 0; c < r; ++c) l(i[c], c); else {
                        if (t.state.draggingText && t.doc.sel.contains(n) > -1) return t.state.draggingText(e), void setTimeout(function () {
                            return t.display.input.focus()
                        }, 20);
                        try {
                            var d = e.dataTransfer.getData("Text");
                            if (d) {
                                var u;
                                if (t.state.draggingText && !t.state.draggingText.copy && (u = t.listSelections()), Wr(t.doc, pr(n, n)), u) for (var h = 0; h < u.length; ++h) io(t.doc, "", u[h].anchor, u[h].head, "drag");
                                t.replaceSelection(d, "around", "paste"), t.display.input.focus()
                            }
                        } catch (e) {
                        }
                    }
                }
            }

            function ko(e) {
                e.display.dragCursor && (e.display.lineSpace.removeChild(e.display.dragCursor), e.display.dragCursor = null)
            }

            function So(e) {
                if (document.body.getElementsByClassName) for (var t = document.body.getElementsByClassName("CodeMirror"), n = 0; n < t.length; n++) {
                    var i = t[n].CodeMirror;
                    i && e(i)
                }
            }

            var Eo = !1;

            function Fo() {
                Eo || (!function () {
                    var e;
                    it(window, "resize", function () {
                        null == e && (e = setTimeout(function () {
                            e = null, So(_o)
                        }, 500))
                    }), it(window, "blur", function () {
                        return So(hi)
                    })
                }(), Eo = !0)
            }

            function _o(e) {
                var t = e.display;
                t.lastWrapHeight == t.wrapper.clientHeight && t.lastWrapWidth == t.wrapper.clientWidth || (t.cachedCharWidth = t.cachedTextHeight = t.cachedPaddingH = null, t.scrollbarsClipped = !1, e.setSize())
            }

            for (var To = {
                3: "Enter",
                8: "Backspace",
                9: "Tab",
                13: "Enter",
                16: "Shift",
                17: "Ctrl",
                18: "Alt",
                19: "Pause",
                20: "CapsLock",
                27: "Esc",
                32: "Space",
                33: "PageUp",
                34: "PageDown",
                35: "End",
                36: "Home",
                37: "Left",
                38: "Up",
                39: "Right",
                40: "Down",
                44: "PrintScrn",
                45: "Insert",
                46: "Delete",
                59: ";",
                61: "=",
                91: "Mod",
                92: "Mod",
                93: "Mod",
                106: "*",
                107: "=",
                109: "-",
                110: ".",
                111: "/",
                127: "Delete",
                173: "-",
                186: ";",
                187: "=",
                188: ",",
                189: "-",
                190: ".",
                191: "/",
                192: "`",
                219: "[",
                220: "\\",
                221: "]",
                222: "'",
                63232: "Up",
                63233: "Down",
                63234: "Left",
                63235: "Right",
                63272: "Delete",
                63273: "Home",
                63275: "End",
                63276: "PageUp",
                63277: "PageDown",
                63302: "Insert"
            }, Mo = 0; Mo < 10; Mo++) To[Mo + 48] = To[Mo + 96] = String(Mo);
            for (var Ao = 65; Ao <= 90; Ao++) To[Ao] = String.fromCharCode(Ao);
            for (var No = 1; No <= 12; No++) To[No + 111] = To[No + 63235] = "F" + No;
            var Lo = {};
            Lo.basic = {
                Left: "goCharLeft",
                Right: "goCharRight",
                Up: "goLineUp",
                Down: "goLineDown",
                End: "goLineEnd",
                Home: "goLineStartSmart",
                PageUp: "goPageUp",
                PageDown: "goPageDown",
                Delete: "delCharAfter",
                Backspace: "delCharBefore",
                "Shift-Backspace": "delCharBefore",
                Tab: "defaultTab",
                "Shift-Tab": "indentAuto",
                Enter: "newlineAndIndent",
                Insert: "toggleOverwrite",
                Esc: "singleSelection"
            }, Lo.pcDefault = {
                "Ctrl-A": "selectAll",
                "Ctrl-Up": "goDocStart",
                "Ctrl-Down": "goDocEnd",
                "Ctrl-Left": "goGroupLeft",
                "Ctrl-Right": "goGroupRight",
                "Alt-Left": "goLineStart",
                "Alt-Right": "goLineEnd",
                "Ctrl-Backspace": "delGroupBefore",
                "Ctrl-Delete": "delGroupAfter",
                "Ctrl-[": "indentLess",
                "Ctrl-]": "indentMore",
                "Ctrl-U": "undoSelection",
                "Shift-Ctrl-U": "redoSelection",
                "Alt-U": "redoSelection",
                fallthrough: "basic"
            }, Lo.emacsy = {
                "Ctrl-F": "goCharRight",
                "Ctrl-B": "goCharLeft",
                "Ctrl-P": "goLineUp",
                "Ctrl-N": "goLineDown",
                "Alt-F": "goWordRight",
                "Alt-B": "goWordLeft",
                "Ctrl-A": "goLineStart",
                "Ctrl-E": "goLineEnd",
                "Ctrl-V": "goPageDown",
                "Shift-Ctrl-V": "goPageUp",
                "Ctrl-D": "delCharAfter",
                "Ctrl-H": "delCharBefore",
                "Alt-D": "delWordAfter",
                "Alt-Backspace": "delWordBefore",
                "Ctrl-K": "killLine",
                "Ctrl-T": "transposeChars",
                "Ctrl-O": "openLine"
            }, Lo.macDefault = {
                "Cmd-A": "selectAll",
                "Cmd-Up": "goDocStart",
                "Cmd-Down": "goDocEnd",
                "Alt-Left": "goGroupLeft",
                "Alt-Right": "goGroupRight",
                "Cmd-Left": "goLineLeft",
                "Cmd-Right": "goLineRight",
                "Alt-Backspace": "delGroupBefore",
                "Ctrl-Alt-Backspace": "delGroupAfter",
                "Alt-Delete": "delGroupAfter",
                "Cmd-[": "indentLess",
                "Cmd-]": "indentMore",
                "Cmd-Backspace": "delWrappedLineLeft",
                "Cmd-Delete": "delWrappedLineRight",
                "Cmd-U": "undoSelection",
                "Shift-Cmd-U": "redoSelection",
                "Ctrl-Up": "goDocStart",
                "Ctrl-Down": "goDocEnd",
                fallthrough: ["basic", "emacsy"]
            }, Lo.default = y ? Lo.macDefault : Lo.pcDefault;

            function Ro(e) {
                var t = e.split(/-(?!$)/);
                e = t[t.length - 1];
                for (var n, i, r, o, a = 0; a < t.length - 1; a++) {
                    var s = t[a];
                    if (/^(cmd|meta|m)$/i.test(s)) o = !0; else if (/^a(lt)?$/i.test(s)) n = !0; else if (/^(c|ctrl|control)$/i.test(s)) i = !0; else {
                        if (!/^s(hift)?$/i.test(s)) throw new Error("Unrecognized modifier name: " + s);
                        r = !0
                    }
                }
                return n && (e = "Alt-" + e), i && (e = "Ctrl-" + e), o && (e = "Cmd-" + e), r && (e = "Shift-" + e), e
            }

            function Do(e) {
                var t = {};
                for (var n in e) if (e.hasOwnProperty(n)) {
                    var i = e[n];
                    if (/^(name|fallthrough|(de|at)tach)$/.test(n)) continue;
                    if ("..." == i) {
                        delete e[n];
                        continue
                    }
                    for (var r = G(n.split(" "), Ro), o = 0; o < r.length; o++) {
                        var a = void 0, s = void 0;
                        o == r.length - 1 ? (s = r.join(" "), a = i) : (s = r.slice(0, o + 1).join(" "), a = "...");
                        var l = t[s];
                        if (l) {
                            if (l != a) throw new Error("Inconsistent bindings for " + s)
                        } else t[s] = a
                    }
                    delete e[n]
                }
                for (var c in t) e[c] = t[c];
                return e
            }

            function Oo(e, t, n, i) {
                var r = (t = Bo(t)).call ? t.call(e, i) : t[e];
                if (!1 === r) return "nothing";
                if ("..." === r) return "multi";
                if (null != r && n(r)) return "handled";
                if (t.fallthrough) {
                    if ("[object Array]" != Object.prototype.toString.call(t.fallthrough)) return Oo(e, t.fallthrough, n, i);
                    for (var o = 0; o < t.fallthrough.length; o++) {
                        var a = Oo(e, t.fallthrough[o], n, i);
                        if (a) return a
                    }
                }
            }

            function Io(e) {
                var t = "string" == typeof e ? e : To[e.keyCode];
                return "Ctrl" == t || "Alt" == t || "Shift" == t || "Mod" == t
            }

            function Po(e, t) {
                if (u && 34 == e.keyCode && e.char) return !1;
                var n = To[e.keyCode], i = n;
                return null != i && !e.altGraphKey && (e.altKey && "Alt" != n && (i = "Alt-" + i), (x ? e.metaKey : e.ctrlKey) && "Ctrl" != n && (i = "Ctrl-" + i), (x ? e.ctrlKey : e.metaKey) && "Cmd" != n && (i = "Cmd-" + i), !t && e.shiftKey && "Shift" != n && (i = "Shift-" + i), i)
            }

            function Bo(e) {
                return "string" == typeof e ? Lo[e] : e
            }

            function $o(e, t) {
                for (var n = e.doc.sel.ranges, i = [], r = 0; r < n.length; r++) {
                    for (var o = t(n[r]); i.length && ge(o.from, Q(i).to) <= 0;) {
                        var a = i.pop();
                        if (ge(a.from, o.from) < 0) {
                            o.from = a.from;
                            break
                        }
                    }
                    i.push(o)
                }
                Ui(e, function () {
                    for (var t = i.length - 1; t >= 0; t--) io(e.doc, "", i[t].from, i[t].to, "+delete");
                    wi(e)
                })
            }

            var Ho = {
                selectAll: Gr, singleSelection: function (e) {
                    return e.setSelection(e.getCursor("anchor"), e.getCursor("head"), W)
                }, killLine: function (e) {
                    return $o(e, function (t) {
                        if (t.empty()) {
                            var n = se(e.doc, t.head.line).text.length;
                            return t.head.ch == n && t.head.line < e.lastLine() ? {
                                from: t.head,
                                to: me(t.head.line + 1, 0)
                            } : {from: t.head, to: me(t.head.line, n)}
                        }
                        return {from: t.from(), to: t.to()}
                    })
                }, deleteLine: function (e) {
                    return $o(e, function (t) {
                        return {from: me(t.from().line, 0), to: xe(e.doc, me(t.to().line + 1, 0))}
                    })
                }, delLineLeft: function (e) {
                    return $o(e, function (e) {
                        return {from: me(e.from().line, 0), to: e.from()}
                    })
                }, delWrappedLineLeft: function (e) {
                    return $o(e, function (t) {
                        var n = e.charCoords(t.head, "div").top + 5;
                        return {from: e.coordsChar({left: 0, top: n}, "div"), to: t.from()}
                    })
                }, delWrappedLineRight: function (e) {
                    return $o(e, function (t) {
                        var n = e.charCoords(t.head, "div").top + 5,
                            i = e.coordsChar({left: e.display.lineDiv.offsetWidth + 100, top: n}, "div");
                        return {from: t.from(), to: i}
                    })
                }, undo: function (e) {
                    return e.undo()
                }, redo: function (e) {
                    return e.redo()
                }, undoSelection: function (e) {
                    return e.undoSelection()
                }, redoSelection: function (e) {
                    return e.redoSelection()
                }, goDocStart: function (e) {
                    return e.extendSelection(me(e.firstLine(), 0))
                }, goDocEnd: function (e) {
                    return e.extendSelection(me(e.lastLine()))
                }, goLineStart: function (e) {
                    return e.extendSelectionsBy(function (t) {
                        return Uo(e, t.head.line)
                    }, {origin: "+move", bias: 1})
                }, goLineStartSmart: function (e) {
                    return e.extendSelectionsBy(function (t) {
                        return jo(e, t.head)
                    }, {origin: "+move", bias: 1})
                }, goLineEnd: function (e) {
                    return e.extendSelectionsBy(function (t) {
                        return function (e, t) {
                            var n = se(e.doc, t), i = function (e) {
                                for (var t; t = Be(e);) e = t.find(1, !0).line;
                                return e
                            }(n);
                            i != n && (t = ue(i));
                            return et(!0, e, n, t, -1)
                        }(e, t.head.line)
                    }, {origin: "+move", bias: -1})
                }, goLineRight: function (e) {
                    return e.extendSelectionsBy(function (t) {
                        var n = e.charCoords(t.head, "div").top + 5;
                        return e.coordsChar({left: e.display.lineDiv.offsetWidth + 100, top: n}, "div")
                    }, z)
                }, goLineLeft: function (e) {
                    return e.extendSelectionsBy(function (t) {
                        var n = e.charCoords(t.head, "div").top + 5;
                        return e.coordsChar({left: 0, top: n}, "div")
                    }, z)
                }, goLineLeftSmart: function (e) {
                    return e.extendSelectionsBy(function (t) {
                        var n = e.charCoords(t.head, "div").top + 5, i = e.coordsChar({left: 0, top: n}, "div");
                        return i.ch < e.getLine(i.line).search(/\S/) ? jo(e, t.head) : i
                    }, z)
                }, goLineUp: function (e) {
                    return e.moveV(-1, "line")
                }, goLineDown: function (e) {
                    return e.moveV(1, "line")
                }, goPageUp: function (e) {
                    return e.moveV(-1, "page")
                }, goPageDown: function (e) {
                    return e.moveV(1, "page")
                }, goCharLeft: function (e) {
                    return e.moveH(-1, "char")
                }, goCharRight: function (e) {
                    return e.moveH(1, "char")
                }, goColumnLeft: function (e) {
                    return e.moveH(-1, "column")
                }, goColumnRight: function (e) {
                    return e.moveH(1, "column")
                }, goWordLeft: function (e) {
                    return e.moveH(-1, "word")
                }, goGroupRight: function (e) {
                    return e.moveH(1, "group")
                }, goGroupLeft: function (e) {
                    return e.moveH(-1, "group")
                }, goWordRight: function (e) {
                    return e.moveH(1, "word")
                }, delCharBefore: function (e) {
                    return e.deleteH(-1, "char")
                }, delCharAfter: function (e) {
                    return e.deleteH(1, "char")
                }, delWordBefore: function (e) {
                    return e.deleteH(-1, "word")
                }, delWordAfter: function (e) {
                    return e.deleteH(1, "word")
                }, delGroupBefore: function (e) {
                    return e.deleteH(-1, "group")
                }, delGroupAfter: function (e) {
                    return e.deleteH(1, "group")
                }, indentAuto: function (e) {
                    return e.indentSelection("smart")
                }, indentMore: function (e) {
                    return e.indentSelection("add")
                }, indentLess: function (e) {
                    return e.indentSelection("subtract")
                }, insertTab: function (e) {
                    return e.replaceSelection("\t")
                }, insertSoftTab: function (e) {
                    for (var t = [], n = e.listSelections(), i = e.options.tabSize, r = 0; r < n.length; r++) {
                        var o = n[r].from(), a = B(e.getLine(o.line), o.ch, i);
                        t.push(Y(i - a % i))
                    }
                    e.replaceSelections(t)
                }, defaultTab: function (e) {
                    e.somethingSelected() ? e.indentSelection("add") : e.execCommand("insertTab")
                }, transposeChars: function (e) {
                    return Ui(e, function () {
                        for (var t = e.listSelections(), n = [], i = 0; i < t.length; i++) if (t[i].empty()) {
                            var r = t[i].head, o = se(e.doc, r.line).text;
                            if (o) if (r.ch == o.length && (r = new me(r.line, r.ch - 1)), r.ch > 0) r = new me(r.line, r.ch + 1), e.replaceRange(o.charAt(r.ch - 1) + o.charAt(r.ch - 2), me(r.line, r.ch - 2), r, "+transpose"); else if (r.line > e.doc.first) {
                                var a = se(e.doc, r.line - 1).text;
                                a && (r = new me(r.line, 1), e.replaceRange(o.charAt(0) + e.doc.lineSeparator() + a.charAt(a.length - 1), me(r.line - 1, a.length - 1), r, "+transpose"))
                            }
                            n.push(new hr(r, r))
                        }
                        e.setSelections(n)
                    })
                }, newlineAndIndent: function (e) {
                    return Ui(e, function () {
                        for (var t = e.listSelections(), n = t.length - 1; n >= 0; n--) e.replaceRange(e.doc.lineSeparator(), t[n].anchor, t[n].head, "+input");
                        t = e.listSelections();
                        for (var i = 0; i < t.length; i++) e.indentLine(t[i].from().line, null, !0);
                        wi(e)
                    })
                }, openLine: function (e) {
                    return e.replaceSelection("\n", "start")
                }, toggleOverwrite: function (e) {
                    return e.toggleOverwrite()
                }
            };

            function Uo(e, t) {
                var n = se(e.doc, t), i = He(n);
                return i != n && (t = ue(i)), et(!0, e, i, t, 1)
            }

            function jo(e, t) {
                var n = Uo(e, t.line), i = se(e.doc, n.line), r = Je(i, e.doc.direction);
                if (!r || 0 == r[0].level) {
                    var o = Math.max(0, i.text.search(/\S/)), a = t.line == n.line && t.ch <= o && t.ch;
                    return me(n.line, a ? 0 : o, n.sticky)
                }
                return n
            }

            function Wo(e, t, n) {
                if ("string" == typeof t && !(t = Ho[t])) return !1;
                e.display.input.ensurePolled();
                var i = e.display.shift, r = !1;
                try {
                    e.isReadOnly() && (e.state.suppressEdits = !0), n && (e.display.shift = !1), r = t(e) != j
                } finally {
                    e.display.shift = i, e.state.suppressEdits = !1
                }
                return r
            }

            var qo = new $;

            function zo(e, t, n, i) {
                var r = e.state.keySeq;
                if (r) {
                    if (Io(t)) return "handled";
                    qo.set(50, function () {
                        e.state.keySeq == r && (e.state.keySeq = null, e.display.input.reset())
                    }), t = r + " " + t
                }
                var o = function (e, t, n) {
                    for (var i = 0; i < e.state.keyMaps.length; i++) {
                        var r = Oo(t, e.state.keyMaps[i], n, e);
                        if (r) return r
                    }
                    return e.options.extraKeys && Oo(t, e.options.extraKeys, n, e) || Oo(t, e.options.keyMap, n, e)
                }(e, t, i);
                return "multi" == o && (e.state.keySeq = t), "handled" == o && an(e, "keyHandled", e, t, n), "handled" != o && "multi" != o || (ut(n), li(e)), r && !o && /\'$/.test(t) ? (ut(n), !0) : !!o
            }

            function Vo(e, t) {
                var n = Po(t, !0);
                return !!n && (t.shiftKey && !e.state.keySeq ? zo(e, "Shift-" + n, t, function (t) {
                    return Wo(e, t, !0)
                }) || zo(e, n, t, function (t) {
                    if ("string" == typeof t ? /^go[A-Z]/.test(t) : t.motion) return Wo(e, t)
                }) : zo(e, n, t, function (t) {
                    return Wo(e, t)
                }))
            }

            var Ko = null;

            function Yo(e) {
                if (this.curOp.focus = L(), 37 == e.keyCode && e.shiftKey, !st(this, e)) {
                    a && s < 11 && 27 == e.keyCode && (e.returnValue = !1);
                    var t = e.keyCode;
                    this.display.shift = 16 == t || e.shiftKey;
                    var n = Vo(this, e);
                    u && (Ko = n ? t : null, !n && 88 == t && !St && (y ? e.metaKey : e.ctrlKey) && this.replaceSelection("", null, "cut")), 18 != t || /\bCodeMirror-crosshair\b/.test(this.display.lineDiv.className) || function (e) {
                        var t = e.display.lineDiv;
                        R(t, "CodeMirror-crosshair");

                        function n(e) {
                            18 != e.keyCode && e.altKey || (E(t, "CodeMirror-crosshair"), ot(document, "keyup", n), ot(document, "mouseover", n))
                        }

                        it(document, "keyup", n), it(document, "mouseover", n)
                    }(this)
                }
            }

            function Qo(e) {
                16 == e.keyCode && (this.doc.sel.shift = !1), st(this, e)
            }

            function Go(e) {
                if (!(wn(this.display, e) || st(this, e) || e.ctrlKey && !e.altKey || y && e.metaKey)) {
                    var t = e.keyCode, n = e.charCode;
                    if (u && t == Ko) return Ko = null, void ut(e);
                    if (!u || e.which && !(e.which < 10) || !Vo(this, e)) {
                        var i = String.fromCharCode(null == n ? t : n);
                        if ("\b" != i && !zo(r = this, "'" + i + "'", e, function (e) {
                            return Wo(r, e, !0)
                        })) {
                            var r;
                            this.display.input.onKeyPress(e)
                        }
                    }
                }
            }

            function Jo(e) {
                var t = this.display;
                if (!(st(this, e) || t.activeTouch && t.input.supportsTouch())) if (t.input.ensurePolled(), t.shift = e.shiftKey, wn(t, e)) l || (t.scroller.draggable = !1, setTimeout(function () {
                    return t.scroller.draggable = !0
                }, 100)); else if (!ta(this, e)) {
                    var n = ni(this, e);
                    switch (window.focus(), gt(e)) {
                        case 1:
                            this.state.selectingText ? this.state.selectingText(e) : n ? function (e, t, n) {
                                a ? setTimeout(I(ci, e), 0) : e.curOp.focus = L();
                                var i, r = +new Date;
                                Zo && Zo.time > r - 400 && 0 == ge(Zo.pos, n) ? i = "triple" : Xo && Xo.time > r - 400 && 0 == ge(Xo.pos, n) ? (i = "double", Zo = {
                                    time: r,
                                    pos: n
                                }) : (i = "single", Xo = {time: r, pos: n});
                                var o, c = e.doc.sel, d = y ? t.metaKey : t.ctrlKey;
                                e.options.dragDrop && yt && !e.isReadOnly() && "single" == i && (o = c.contains(n)) > -1 && (ge((o = c.ranges[o]).from(), n) < 0 || n.xRel > 0) && (ge(o.to(), n) > 0 || n.xRel < 0) ? function (e, t, n, i) {
                                    var r = e.display, o = !1, c = ji(e, function (t) {
                                        l && (r.scroller.draggable = !1), e.state.draggingText = !1, ot(document, "mouseup", c), ot(document, "mousemove", d), ot(r.scroller, "dragstart", u), ot(r.scroller, "drop", c), o || (ut(t), i || Pr(e.doc, n), l || a && 9 == s ? setTimeout(function () {
                                            document.body.focus(), r.input.focus()
                                        }, 20) : r.input.focus())
                                    }), d = function (e) {
                                        o = o || Math.abs(t.clientX - e.clientX) + Math.abs(t.clientY - e.clientY) >= 10
                                    }, u = function () {
                                        return o = !0
                                    };
                                    l && (r.scroller.draggable = !0);
                                    e.state.draggingText = c, c.copy = y ? t.altKey : t.ctrlKey, r.scroller.dragDrop && r.scroller.dragDrop();
                                    it(document, "mouseup", c), it(document, "mousemove", d), it(r.scroller, "dragstart", u), it(r.scroller, "drop", c), di(e), setTimeout(function () {
                                        return r.input.focus()
                                    }, 20)
                                }(e, t, n, d) : function (e, t, n, i, r) {
                                    var o = e.display, a = e.doc;
                                    ut(t);
                                    var s, l, c = a.sel, d = c.ranges;
                                    r && !t.shiftKey ? (l = a.sel.contains(n), s = l > -1 ? d[l] : new hr(n, n)) : (s = a.sel.primary(), l = a.sel.primIndex);
                                    if (b ? t.shiftKey && t.metaKey : t.altKey) i = "rect", r || (s = new hr(n, n)), n = ni(e, t, !0, !0), l = -1; else if ("double" == i) {
                                        var u = e.findWordAt(n);
                                        s = e.display.shift || a.extend ? Ir(a, s, u.anchor, u.head) : u
                                    } else if ("triple" == i) {
                                        var h = new hr(me(n.line, 0), xe(a, me(n.line + 1, 0)));
                                        s = e.display.shift || a.extend ? Ir(a, s, h.anchor, h.head) : h
                                    } else s = Ir(a, s, n);
                                    r ? -1 == l ? (l = d.length, jr(a, fr(d.concat([s]), l), {
                                        scroll: !1,
                                        origin: "*mouse"
                                    })) : d.length > 1 && d[l].empty() && "single" == i && !t.shiftKey ? (jr(a, fr(d.slice(0, l).concat(d.slice(l + 1)), 0), {
                                        scroll: !1,
                                        origin: "*mouse"
                                    }), c = a.sel) : $r(a, l, s, q) : (l = 0, jr(a, new ur([s], 0), q), c = a.sel);
                                    var f = n;
                                    var p = o.wrapper.getBoundingClientRect(), m = 0;

                                    function g(t) {
                                        var r = ++m, d = ni(e, t, !0, "rect" == i);
                                        if (d) if (0 != ge(d, f)) {
                                            e.curOp.focus = L(), function (t) {
                                                if (0 == ge(f, t)) return;
                                                if (f = t, "rect" == i) {
                                                    for (var r = [], o = e.options.tabSize, d = B(se(a, n.line).text, n.ch, o), u = B(se(a, t.line).text, t.ch, o), h = Math.min(d, u), p = Math.max(d, u), m = Math.min(n.line, t.line), g = Math.min(e.lastLine(), Math.max(n.line, t.line)); m <= g; m++) {
                                                        var v = se(a, m).text, y = V(v, h, o);
                                                        h == p ? r.push(new hr(me(m, y), me(m, y))) : v.length > y && r.push(new hr(me(m, y), me(m, V(v, p, o))))
                                                    }
                                                    r.length || r.push(new hr(n, n)), jr(a, fr(c.ranges.slice(0, l).concat(r), l), {
                                                        origin: "*mouse",
                                                        scroll: !1
                                                    }), e.scrollIntoView(t)
                                                } else {
                                                    var b = s, w = b.anchor, C = t;
                                                    if ("single" != i) {
                                                        var x;
                                                        ge((x = "double" == i ? e.findWordAt(t) : new hr(me(t.line, 0), xe(a, me(t.line + 1, 0)))).anchor, w) > 0 ? (C = x.head, w = we(b.from(), x.anchor)) : (C = x.anchor, w = be(b.to(), x.head))
                                                    }
                                                    var k = c.ranges.slice(0);
                                                    k[l] = new hr(xe(a, w), C), jr(a, fr(k, l), q)
                                                }
                                            }(d);
                                            var u = mi(o, a);
                                            (d.line >= u.to || d.line < u.from) && setTimeout(ji(e, function () {
                                                m == r && g(t)
                                            }), 150)
                                        } else {
                                            var h = t.clientY < p.top ? -20 : t.clientY > p.bottom ? 20 : 0;
                                            h && setTimeout(ji(e, function () {
                                                m == r && (o.scroller.scrollTop += h, g(t))
                                            }), 50)
                                        }
                                    }

                                    function v(t) {
                                        e.state.selectingText = !1, m = 1 / 0, ut(t), o.input.focus(), ot(document, "mousemove", y), ot(document, "mouseup", w), a.history.lastSelOrigin = null
                                    }

                                    var y = ji(e, function (e) {
                                        gt(e) ? g(e) : v(e)
                                    }), w = ji(e, v);
                                    e.state.selectingText = w, it(document, "mousemove", y), it(document, "mouseup", w)
                                }(e, t, n, i, d)
                            }(this, e, n) : mt(e) == t.scroller && ut(e);
                            break;
                        case 2:
                            l && (this.state.lastMiddleDown = +new Date), n && Pr(this.doc, n), setTimeout(function () {
                                return t.input.focus()
                            }, 20), ut(e);
                            break;
                        case 3:
                            k ? na(this, e) : di(this)
                    }
                }
            }

            var Xo, Zo;

            function ea(e, t, n, i) {
                var r, o;
                try {
                    r = t.clientX, o = t.clientY
                } catch (t) {
                    return !1
                }
                if (r >= Math.floor(e.display.gutters.getBoundingClientRect().right)) return !1;
                i && ut(t);
                var a = e.display, s = a.lineDiv.getBoundingClientRect();
                if (o > s.bottom || !ct(e, n)) return ft(t);
                o -= s.top - a.viewOffset;
                for (var l = 0; l < e.options.gutters.length; ++l) {
                    var c = a.gutters.childNodes[l];
                    if (c && c.getBoundingClientRect().right >= r) {
                        return at(e, n, e, he(e.doc, o), e.options.gutters[l], t), ft(t)
                    }
                }
            }

            function ta(e, t) {
                return ea(e, t, "gutterClick", !0)
            }

            function na(e, t) {
                wn(e.display, t) || function (e, t) {
                    if (!ct(e, "gutterContextMenu")) return !1;
                    return ea(e, t, "gutterContextMenu", !1)
                }(e, t) || st(e, t, "contextmenu") || e.display.input.onContextMenu(t)
            }

            function ia(e) {
                e.display.wrapper.className = e.display.wrapper.className.replace(/\s*cm-s-\S+/g, "") + e.options.theme.replace(/(^|\s)\s*/g, " cm-s-"), Pn(e)
            }

            var ra = {
                toString: function () {
                    return "CodeMirror.Init"
                }
            }, oa = {}, aa = {};

            function sa(e) {
                rr(e), zi(e), gi(e)
            }

            function la(e, t, n) {
                if (!t != !(n && n != ra)) {
                    var i = e.display.dragFunctions, r = t ? it : ot;
                    r(e.display.scroller, "dragstart", i.start), r(e.display.scroller, "dragenter", i.enter), r(e.display.scroller, "dragover", i.over), r(e.display.scroller, "dragleave", i.leave), r(e.display.scroller, "drop", i.drop)
                }
            }

            function ca(e) {
                e.options.lineWrapping ? (R(e.display.wrapper, "CodeMirror-wrap"), e.display.sizer.style.minWidth = "", e.display.sizerWidth = null) : (E(e.display.wrapper, "CodeMirror-wrap"), Ke(e)), ti(e), zi(e), Pn(e), setTimeout(function () {
                    return Ai(e)
                }, 100)
            }

            function da(e, t, i, r) {
                var o = this;
                if (!(this instanceof da)) return new da(e, t, i, r);
                this.options = t = t ? P(t) : {}, P(oa, t, !1), or(t);
                var c = t.value;
                "string" == typeof c && (c = new wo(c, t.mode, null, t.lineSeparator, t.direction)), this.doc = c;
                var d = new da.inputStyles[t.inputStyle](this), f = this.display = new function (e, t, i) {
                    this.input = i, this.scrollbarFiller = T("div", null, "CodeMirror-scrollbar-filler"), this.scrollbarFiller.setAttribute("cm-not-content", "true"), this.gutterFiller = T("div", null, "CodeMirror-gutter-filler"), this.gutterFiller.setAttribute("cm-not-content", "true"), this.lineDiv = M("div", null, "CodeMirror-code"), this.selectionDiv = T("div", null, null, "position: relative; z-index: 1"), this.cursorDiv = T("div", null, "CodeMirror-cursors"), this.measure = T("div", null, "CodeMirror-measure"), this.lineMeasure = T("div", null, "CodeMirror-measure"), this.lineSpace = M("div", [this.measure, this.lineMeasure, this.selectionDiv, this.cursorDiv, this.lineDiv], null, "position: relative; outline: none");
                    var r = M("div", [this.lineSpace], "CodeMirror-lines");
                    this.mover = T("div", [r], null, "position: relative"), this.sizer = T("div", [this.mover], "CodeMirror-sizer"), this.sizerWidth = null, this.heightForcer = T("div", null, null, "position: absolute; height: " + U + "px; width: 1px;"), this.gutters = T("div", null, "CodeMirror-gutters"), this.lineGutter = null, this.scroller = T("div", [this.sizer, this.heightForcer, this.gutters], "CodeMirror-scroll"), this.scroller.setAttribute("tabIndex", "-1"), this.wrapper = T("div", [this.scrollbarFiller, this.gutterFiller, this.scroller], "CodeMirror"), a && s < 8 && (this.gutters.style.zIndex = -1, this.scroller.style.paddingRight = 0), l || n && v || (this.scroller.draggable = !0), e && (e.appendChild ? e.appendChild(this.wrapper) : e(this.wrapper)), this.viewFrom = this.viewTo = t.first, this.reportedViewFrom = this.reportedViewTo = t.first, this.view = [], this.renderedView = null, this.externalMeasured = null, this.viewOffset = 0, this.lastWrapHeight = this.lastWrapWidth = 0, this.updateLineNumbers = null, this.nativeBarWidth = this.barHeight = this.barWidth = 0, this.scrollbarsClipped = !1, this.lineNumWidth = this.lineNumInnerWidth = this.lineNumChars = null, this.alignWidgets = !1, this.cachedCharWidth = this.cachedTextHeight = this.cachedPaddingH = null, this.maxLine = null, this.maxLineLength = 0, this.maxLineChanged = !1, this.wheelDX = this.wheelDY = this.wheelStartX = this.wheelStartY = null, this.shift = !1, this.selForContextMenu = null, this.activeTouch = null, i.init(this)
                }(e, c, d);
                f.wrapper.CodeMirror = this, rr(this), ia(this), t.lineWrapping && (this.display.wrapper.className += " CodeMirror-wrap"), Ri(this), this.state = {
                    keyMaps: [],
                    overlays: [],
                    modeGen: 0,
                    overwrite: !1,
                    delayingBlurEvent: !1,
                    focused: !1,
                    suppressEdits: !1,
                    pasteIncoming: !1,
                    cutIncoming: !1,
                    selectingText: !1,
                    draggingText: !1,
                    highlight: new $,
                    keySeq: null,
                    specialChars: null
                }, t.autofocus && !v && f.input.focus(), a && s < 11 && setTimeout(function () {
                    return o.display.input.reset(!0)
                }, 20), function (e) {
                    var t = e.display;
                    it(t.scroller, "mousedown", ji(e, Jo)), it(t.scroller, "dblclick", a && s < 11 ? ji(e, function (t) {
                        if (!st(e, t)) {
                            var n = ni(e, t);
                            if (n && !ta(e, t) && !wn(e.display, t)) {
                                ut(t);
                                var i = e.findWordAt(n);
                                Pr(e.doc, i.anchor, i.head)
                            }
                        }
                    }) : function (t) {
                        return st(e, t) || ut(t)
                    });
                    k || it(t.scroller, "contextmenu", function (t) {
                        return na(e, t)
                    });
                    var n, i = {end: 0};

                    function r() {
                        t.activeTouch && (n = setTimeout(function () {
                            return t.activeTouch = null
                        }, 1e3), (i = t.activeTouch).end = +new Date)
                    }

                    function o(e, t) {
                        if (null == t.left) return !0;
                        var n = t.left - e.left, i = t.top - e.top;
                        return n * n + i * i > 400
                    }

                    it(t.scroller, "touchstart", function (r) {
                        if (!st(e, r) && !function (e) {
                            if (1 != e.touches.length) return !1;
                            var t = e.touches[0];
                            return t.radiusX <= 1 && t.radiusY <= 1
                        }(r)) {
                            t.input.ensurePolled(), clearTimeout(n);
                            var o = +new Date;
                            t.activeTouch = {
                                start: o,
                                moved: !1,
                                prev: o - i.end <= 300 ? i : null
                            }, 1 == r.touches.length && (t.activeTouch.left = r.touches[0].pageX, t.activeTouch.top = r.touches[0].pageY)
                        }
                    }), it(t.scroller, "touchmove", function () {
                        t.activeTouch && (t.activeTouch.moved = !0)
                    }), it(t.scroller, "touchend", function (n) {
                        var i = t.activeTouch;
                        if (i && !wn(t, n) && null != i.left && !i.moved && new Date - i.start < 300) {
                            var a, s = e.coordsChar(t.activeTouch, "page");
                            a = !i.prev || o(i, i.prev) ? new hr(s, s) : !i.prev.prev || o(i, i.prev.prev) ? e.findWordAt(s) : new hr(me(s.line, 0), xe(e.doc, me(s.line + 1, 0))), e.setSelection(a.anchor, a.head), e.focus(), ut(n)
                        }
                        r()
                    }), it(t.scroller, "touchcancel", r), it(t.scroller, "scroll", function () {
                        t.scroller.clientHeight && (Si(e, t.scroller.scrollTop), Fi(e, t.scroller.scrollLeft, !0), at(e, "scroll", e))
                    }), it(t.scroller, "mousewheel", function (t) {
                        return dr(e, t)
                    }), it(t.scroller, "DOMMouseScroll", function (t) {
                        return dr(e, t)
                    }), it(t.wrapper, "scroll", function () {
                        return t.wrapper.scrollTop = t.wrapper.scrollLeft = 0
                    }), t.dragFunctions = {
                        enter: function (t) {
                            st(e, t) || pt(t)
                        }, over: function (t) {
                            st(e, t) || (!function (e, t) {
                                var n = ni(e, t);
                                if (n) {
                                    var i = document.createDocumentFragment();
                                    ai(e, n, i), e.display.dragCursor || (e.display.dragCursor = T("div", null, "CodeMirror-cursors CodeMirror-dragcursors"), e.display.lineSpace.insertBefore(e.display.dragCursor, e.display.cursorDiv)), _(e.display.dragCursor, i)
                                }
                            }(e, t), pt(t))
                        }, start: function (t) {
                            return function (e, t) {
                                if (a && (!e.state.draggingText || +new Date - Co < 100)) pt(t); else if (!st(e, t) && !wn(e.display, t) && (t.dataTransfer.setData("Text", e.getSelection()), t.dataTransfer.effectAllowed = "copyMove", t.dataTransfer.setDragImage && !h)) {
                                    var n = T("img", null, null, "position: fixed; left: 0; top: 0;");
                                    n.src = "data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==", u && (n.width = n.height = 1, e.display.wrapper.appendChild(n), n._top = n.offsetTop), t.dataTransfer.setDragImage(n, 0, 0), u && n.parentNode.removeChild(n)
                                }
                            }(e, t)
                        }, drop: ji(e, xo), leave: function (t) {
                            st(e, t) || ko(e)
                        }
                    };
                    var l = t.input.getField();
                    it(l, "keyup", function (t) {
                        return Qo.call(e, t)
                    }), it(l, "keydown", ji(e, Yo)), it(l, "keypress", ji(e, Go)), it(l, "focus", function (t) {
                        return ui(e, t)
                    }), it(l, "blur", function (t) {
                        return hi(e, t)
                    })
                }(this), Fo(), Oi(this), this.curOp.forceUpdate = !0, Sr(this, c), t.autofocus && !v || this.hasFocus() ? setTimeout(I(ui, this), 20) : hi(this);
                for (var p in aa) aa.hasOwnProperty(p) && aa[p](o, t[p], ra);
                vi(this), t.finishInit && t.finishInit(this);
                for (var m = 0; m < ua.length; ++m) ua[m](o);
                Ii(this), l && t.lineWrapping && "optimizelegibility" == getComputedStyle(f.lineDiv).textRendering && (f.lineDiv.style.textRendering = "auto"), this.editor = i, this.cid = r
            }

            da.defaults = oa, da.optionHandlers = aa;
            var ua = [];
            da.defineInitHook = function (e) {
                return ua.push(e)
            };

            function ha(e, t, n, i) {
                var r, o = e.doc;
                null == n && (n = "add"), "smart" == n && (o.mode.indent ? r = Bt(e, t) : n = "prev");
                var a = e.options.tabSize, s = se(o, t), l = B(s.text, null, a);
                s.stateAfter && (s.stateAfter = null);
                var c, d = s.text.match(/^\s*/)[0];
                if (i || /\S/.test(s.text)) {
                    if ("smart" == n && ((c = o.mode.indent(r, s.text.slice(d.length), s.text)) == j || c > 150)) {
                        if (!i) return;
                        n = "prev"
                    }
                } else c = 0, n = "not";
                var u = "", h = 0;
                if ("prev" == n ? t > o.first ? (c = B(u = se(o, t - 1).text, null, a), u = d ? "" : u.match(/^\s*/)[0]) : c = 0 : "add" == n ? c = l + e.options.indentUnit : "subtract" == n ? c = l - e.options.indentUnit : "number" == typeof n && (c = l + n), c = Math.max(0, c), u && !d) ; else {
                    if (u = "", e.options.indentWithTabs) for (var f = Math.floor(c / a); f; --f) h += a, u += "\t";
                    h < c && (u += Y(c - h))
                }
                if (u != d) return io(o, u, me(t, 0), me(t, d.length), "+input"), s.stateAfter = null, !0;
                for (var p = 0; p < o.sel.ranges.length; p++) {
                    var m = o.sel.ranges[p];
                    if (m.head.line == t && m.head.ch < d.length) {
                        var g = me(t, d.length);
                        $r(o, p, new hr(g, g));
                        break
                    }
                }
            }

            var fa = null;

            function pa(e) {
                fa = e
            }

            function ma(e, t, n, i, r) {
                var o = e.doc;
                e.display.shift = !1, i || (i = o.sel);
                var a = e.state.pasteIncoming || "paste" == r, s = xt(t), l = null;
                if (a && i.ranges.length > 1) if (fa && fa.text.join("\n") == t) {
                    if (i.ranges.length % fa.text.length == 0) {
                        l = [];
                        for (var c = 0; c < fa.text.length; c++) l.push(o.splitLines(fa.text[c]))
                    }
                } else s.length == i.ranges.length && (l = G(s, function (e) {
                    return [e]
                }));
                for (var d, u = i.ranges.length - 1; u >= 0; u--) {
                    var h = i.ranges[u], f = h.from(), p = h.to();
                    h.empty() && (n && n > 0 ? f = me(f.line, f.ch - n) : e.state.overwrite && !a ? p = me(p.line, Math.min(se(o, p.line).text.length, p.ch + Q(s).length)) : fa && fa.lineWise && fa.text.join("\n") == t && (f = p = me(f.line, 0))), d = e.curOp.updateInput;
                    var m = {
                        from: f,
                        to: p,
                        text: l ? l[u % l.length] : s,
                        origin: r || (a ? "paste" : e.state.cutIncoming ? "cut" : "+input")
                    };
                    Xr(e.doc, m), an(e, "inputRead", e, m)
                }
                t && !a && va(e, t), wi(e), e.curOp.updateInput = d, e.curOp.typing = !0, e.state.pasteIncoming = e.state.cutIncoming = !1
            }

            function ga(e, t) {
                var n = e.clipboardData && e.clipboardData.getData("Text");
                if (n) return e.preventDefault(), t.isReadOnly() || t.options.disableInput || Ui(t, function () {
                    return ma(t, n, 0, null, "paste")
                }), !0
            }

            function va(e, t) {
                if (e.options.electricChars && e.options.smartIndent) for (var n = e.doc.sel, i = n.ranges.length - 1; i >= 0; i--) {
                    var r = n.ranges[i];
                    if (!(r.head.ch > 100 || i && n.ranges[i - 1].head.line == r.head.line)) {
                        var o = e.getModeAt(r.head), a = !1;
                        if (o.electricChars) {
                            for (var s = 0; s < o.electricChars.length; s++) if (t.indexOf(o.electricChars.charAt(s)) > -1) {
                                a = ha(e, r.head.line, "smart");
                                break
                            }
                        } else o.electricInput && o.electricInput.test(se(e.doc, r.head.line).text.slice(0, r.head.ch)) && (a = ha(e, r.head.line, "smart"));
                        a && an(e, "electricInput", e, r.head.line)
                    }
                }
            }

            function ya(e) {
                for (var t = [], n = [], i = 0; i < e.doc.sel.ranges.length; i++) {
                    var r = e.doc.sel.ranges[i].head.line, o = {anchor: me(r, 0), head: me(r + 1, 0)};
                    n.push(o), t.push(e.getRange(o.anchor, o.head))
                }
                return {text: t, ranges: n}
            }

            function ba(e, t) {
                e.setAttribute("autocorrect", "off"), e.setAttribute("autocapitalize", "off"), e.setAttribute("spellcheck", !!t)
            }

            function wa() {
                var e = T("textarea", null, null, "position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none"),
                    t = T("div", [e], null, "overflow: hidden; position: relative; width: 3px; height: 0px;");
                return l ? e.style.width = "1000px" : e.setAttribute("wrap", "off"), m && (e.style.border = "1px solid black"), ba(e), t
            }

            function Ca(e, t, n, i, r) {
                var o = t, a = n, s = se(e, t.line);

                function l(i) {
                    var o;
                    if (null == (o = r ? tt(e.cm, s, t, n) : Ze(s, t, n))) {
                        if (i || !function () {
                            var i = t.line + n;
                            return !(i < e.first || i >= e.first + e.size) && (t = new me(i, t.ch, t.sticky), s = se(e, i))
                        }()) return !1;
                        t = et(r, e.cm, s, t.line, n)
                    } else t = o;
                    return !0
                }

                if ("char" == i) l(); else if ("column" == i) l(!0); else if ("word" == i || "group" == i) for (var c = null, d = "group" == i, u = e.cm && e.cm.getHelper(t, "wordChars"), h = !0; !(n < 0) || l(!h); h = !1) {
                    var f = s.text.charAt(t.ch) || "\n",
                        p = te(f, u) ? "w" : d && "\n" == f ? "n" : !d || /\s/.test(f) ? null : "p";
                    if (!d || h || p || (p = "s"), c && c != p) {
                        n < 0 && (n = 1, l(), t.sticky = "after");
                        break
                    }
                    if (p && (c = p), n > 0 && !l(!h)) break
                }
                var m = Yr(e, t, o, a, !0);
                return ve(o, m) && (m.hitSide = !0), m
            }

            function xa(e, t, n, i) {
                var r, o = e.doc, a = t.left;
                if ("page" == i) {
                    var s = Math.min(e.display.wrapper.clientHeight, window.innerHeight || document.documentElement.clientHeight),
                        l = Math.max(s - .5 * Gn(e.display), 3);
                    r = (n > 0 ? t.bottom : t.top) + n * l
                } else "line" == i && (r = n > 0 ? t.bottom + 3 : t.top - 3);
                for (var c; (c = Vn(e, a, r)).outside;) {
                    if (n < 0 ? r <= 0 : r >= o.height) {
                        c.hitSide = !0;
                        break
                    }
                    r += 5 * n
                }
                return c
            }

            var ka = function (e) {
                this.cm = e, this.lastAnchorNode = this.lastAnchorOffset = this.lastFocusNode = this.lastFocusOffset = null, this.polling = new $, this.composing = null, this.gracePeriod = !1, this.readDOMTimeout = null
            };
            ka.prototype.init = function (e) {
                var t = this, n = this, i = n.cm, r = n.div = e.lineDiv;
                ba(r, i.options.spellcheck), it(r, "paste", function (e) {
                    st(i, e) || ga(e, i) || s <= 11 && setTimeout(ji(i, function () {
                        return t.updateFromDOM()
                    }), 20)
                }), it(r, "compositionstart", function (e) {
                    t.composing = {data: e.data, done: !1}
                }), it(r, "compositionupdate", function (e) {
                    t.composing || (t.composing = {data: e.data, done: !1})
                }), it(r, "compositionend", function (e) {
                    t.composing && (e.data != t.composing.data && t.readFromDOMSoon(), t.composing.done = !0)
                }), it(r, "touchstart", function () {
                    return n.forceCompositionEnd()
                }), it(r, "input", function () {
                    t.composing || t.readFromDOMSoon()
                });

                function o(e) {
                    if (!st(i, e)) {
                        if (i.somethingSelected()) pa({
                            lineWise: !1,
                            text: i.getSelections()
                        }), "cut" == e.type && i.replaceSelection("", null, "cut"); else {
                            if (!i.options.lineWiseCopyCut) return;
                            var t = ya(i);
                            pa({lineWise: !0, text: t.text}), "cut" == e.type && i.operation(function () {
                                i.setSelections(t.ranges, 0, W), i.replaceSelection("", null, "cut")
                            })
                        }
                        if (e.clipboardData) {
                            e.clipboardData.clearData();
                            var o = fa.text.join("\n");
                            if (e.clipboardData.setData("Text", o), e.clipboardData.getData("Text") == o) return void e.preventDefault()
                        }
                        var a = wa(), s = a.firstChild;
                        i.display.lineSpace.insertBefore(a, i.display.lineSpace.firstChild), s.value = fa.text.join("\n");
                        var l = document.activeElement;
                        O(s), setTimeout(function () {
                            i.display.lineSpace.removeChild(a), l.focus(), l == r && n.showPrimarySelection()
                        }, 50)
                    }
                }

                it(r, "copy", o), it(r, "cut", o)
            }, ka.prototype.prepareSelection = function () {
                var e = oi(this.cm, !1);
                return e.focus = this.cm.state.focused, e
            }, ka.prototype.showSelection = function (e, t) {
                e && this.cm.display.view.length && ((e.focus || t) && this.showPrimarySelection(), this.showMultipleSelections(e))
            }, ka.prototype.showPrimarySelection = function () {
                var e = window.getSelection(), t = this.cm, i = t.doc.sel.primary(), r = i.from(), o = i.to();
                if (t.display.viewTo == t.display.viewFrom || r.line >= t.display.viewTo || o.line < t.display.viewFrom) e.removeAllRanges(); else {
                    var a = Fa(t, e.anchorNode, e.anchorOffset), s = Fa(t, e.focusNode, e.focusOffset);
                    if (!a || a.bad || !s || s.bad || 0 != ge(we(a, s), r) || 0 != ge(be(a, s), o)) {
                        var l = t.display.view,
                            c = r.line >= t.display.viewFrom && Sa(t, r) || {node: l[0].measure.map[2], offset: 0},
                            d = o.line < t.display.viewTo && Sa(t, o);
                        if (!d) {
                            var u = l[l.length - 1].measure, h = u.maps ? u.maps[u.maps.length - 1] : u.map;
                            d = {node: h[h.length - 1], offset: h[h.length - 2] - h[h.length - 3]}
                        }
                        if (c && d) {
                            var f, p = e.rangeCount && e.getRangeAt(0);
                            try {
                                f = A(c.node, c.offset, d.offset, d.node)
                            } catch (e) {
                            }
                            f && (!n && t.state.focused ? (e.collapse(c.node, c.offset), f.collapsed || (e.removeAllRanges(), e.addRange(f))) : (e.removeAllRanges(), e.addRange(f)), p && null == e.anchorNode ? e.addRange(p) : n && this.startGracePeriod()), this.rememberSelection()
                        } else e.removeAllRanges()
                    }
                }
            }, ka.prototype.startGracePeriod = function () {
                var e = this;
                clearTimeout(this.gracePeriod), this.gracePeriod = setTimeout(function () {
                    e.gracePeriod = !1, e.selectionChanged() && e.cm.operation(function () {
                        return e.cm.curOp.selectionChanged = !0
                    })
                }, 20)
            }, ka.prototype.showMultipleSelections = function (e) {
                _(this.cm.display.cursorDiv, e.cursors), _(this.cm.display.selectionDiv, e.selection)
            }, ka.prototype.rememberSelection = function () {
                var e = window.getSelection();
                this.lastAnchorNode = e.anchorNode, this.lastAnchorOffset = e.anchorOffset, this.lastFocusNode = e.focusNode, this.lastFocusOffset = e.focusOffset
            }, ka.prototype.selectionInEditor = function () {
                var e = window.getSelection();
                if (!e.rangeCount) return !1;
                var t = e.getRangeAt(0).commonAncestorContainer;
                return N(this.div, t)
            }, ka.prototype.focus = function () {
                "nocursor" != this.cm.options.readOnly && (this.selectionInEditor() || this.showSelection(this.prepareSelection(), !0), this.div.focus())
            }, ka.prototype.blur = function () {
                this.div.blur()
            }, ka.prototype.getField = function () {
                return this.div
            }, ka.prototype.supportsTouch = function () {
                return !0
            }, ka.prototype.receivedFocus = function () {
                var e = this;
                this.selectionInEditor() ? this.pollSelection() : Ui(this.cm, function () {
                    return e.cm.curOp.selectionChanged = !0
                });
                this.polling.set(this.cm.options.pollInterval, function t() {
                    e.cm.state.focused && (e.pollSelection(), e.polling.set(e.cm.options.pollInterval, t))
                })
            }, ka.prototype.selectionChanged = function () {
                var e = window.getSelection();
                return e.anchorNode != this.lastAnchorNode || e.anchorOffset != this.lastAnchorOffset || e.focusNode != this.lastFocusNode || e.focusOffset != this.lastFocusOffset
            }, ka.prototype.pollSelection = function () {
                if (null == this.readDOMTimeout && !this.gracePeriod && this.selectionChanged()) {
                    var e = window.getSelection(), t = this.cm;
                    if (g && d && this.cm.options.gutters.length && function (e) {
                        for (var t = e; t; t = t.parentNode) if (/CodeMirror-gutter-wrapper/.test(t.className)) return !0;
                        return !1
                    }(e.anchorNode)) return this.cm.triggerOnKeyDown({
                        type: "keydown",
                        keyCode: 8,
                        preventDefault: Math.abs
                    }), this.blur(), void this.focus();
                    if (!this.composing) {
                        this.rememberSelection();
                        var n = Fa(t, e.anchorNode, e.anchorOffset), i = Fa(t, e.focusNode, e.focusOffset);
                        n && i && Ui(t, function () {
                            jr(t.doc, pr(n, i), W), (n.bad || i.bad) && (t.curOp.selectionChanged = !0)
                        })
                    }
                }
            }, ka.prototype.pollContent = function () {
                null != this.readDOMTimeout && (clearTimeout(this.readDOMTimeout), this.readDOMTimeout = null);
                var e = this.cm, t = e.display, n = e.doc.sel.primary(), i = n.from(), r = n.to();
                if (0 == i.ch && i.line > e.firstLine() && (i = me(i.line - 1, se(e.doc, i.line - 1).length)), r.ch == se(e.doc, r.line).text.length && r.line < e.lastLine() && (r = me(r.line + 1, 0)), i.line < t.viewFrom || r.line > t.viewTo - 1) return !1;
                var o, a, s;
                i.line == t.viewFrom || 0 == (o = ii(e, i.line)) ? (a = ue(t.view[0].line), s = t.view[0].node) : (a = ue(t.view[o].line), s = t.view[o - 1].node.nextSibling);
                var l, c, d = ii(e, r.line);
                if (d == t.view.length - 1 ? (l = t.viewTo - 1, c = t.lineDiv.lastChild) : (l = ue(t.view[d + 1].line) - 1, c = t.view[d + 1].node.previousSibling), !s) return !1;
                for (var u = e.doc.splitLines(function (e, t, n, i, r) {
                    var o = "", a = !1, s = e.doc.lineSeparator();

                    function l() {
                        a && (o += s, a = !1)
                    }

                    function c(e) {
                        e && (l(), o += e)
                    }

                    function d(t) {
                        if (1 == t.nodeType) {
                            var n = t.getAttribute("cm-text");
                            if (null != n) return void c(n || t.textContent.replace(/\u200b/g, ""));
                            var o, u = t.getAttribute("cm-marker");
                            if (u) {
                                var h = e.findMarks(me(i, 0), me(r + 1, 0), (m = +u, function (e) {
                                    return e.id == m
                                }));
                                return void(h.length && (o = h[0].find()) && c(le(e.doc, o.from, o.to).join(s)))
                            }
                            if ("false" == t.getAttribute("contenteditable")) return;
                            var f = /^(pre|div|p)$/i.test(t.nodeName);
                            f && l();
                            for (var p = 0; p < t.childNodes.length; p++) d(t.childNodes[p]);
                            f && (a = !0)
                        } else 3 == t.nodeType && c(t.nodeValue);
                        var m
                    }

                    for (; d(t), t != n;) t = t.nextSibling;
                    return o
                }(e, s, c, a, l)), h = le(e.doc, me(a, 0), me(l, se(e.doc, l).text.length)); u.length > 1 && h.length > 1;) if (Q(u) == Q(h)) u.pop(), h.pop(), l--; else {
                    if (u[0] != h[0]) break;
                    u.shift(), h.shift(), a++
                }
                for (var f = 0, p = 0, m = u[0], g = h[0], v = Math.min(m.length, g.length); f < v && m.charCodeAt(f) == g.charCodeAt(f);) ++f;
                for (var y = Q(u), b = Q(h), w = Math.min(y.length - (1 == u.length ? f : 0), b.length - (1 == h.length ? f : 0)); p < w && y.charCodeAt(y.length - p - 1) == b.charCodeAt(b.length - p - 1);) ++p;
                if (1 == u.length && 1 == h.length && a == i.line) for (; f && f > i.ch && y.charCodeAt(y.length - p - 1) == b.charCodeAt(b.length - p - 1);) f--, p++;
                u[u.length - 1] = y.slice(0, y.length - p).replace(/^\u200b+/, ""), u[0] = u[0].slice(f).replace(/\u200b+$/, "");
                var C = me(a, f), x = me(l, h.length ? Q(h).length - p : 0);
                return u.length > 1 || u[0] || ge(C, x) ? (io(e.doc, u, C, x, "+input"), !0) : void 0
            }, ka.prototype.ensurePolled = function () {
                this.forceCompositionEnd()
            }, ka.prototype.reset = function () {
                this.forceCompositionEnd()
            }, ka.prototype.forceCompositionEnd = function () {
                this.composing && (clearTimeout(this.readDOMTimeout), this.composing = null, this.updateFromDOM(), this.div.blur(), this.div.focus())
            }, ka.prototype.readFromDOMSoon = function () {
                var e = this;
                null == this.readDOMTimeout && (this.readDOMTimeout = setTimeout(function () {
                    if (e.readDOMTimeout = null, e.composing) {
                        if (!e.composing.done) return;
                        e.composing = null
                    }
                    e.updateFromDOM()
                }, 80))
            }, ka.prototype.updateFromDOM = function () {
                var e = this;
                !this.cm.isReadOnly() && this.pollContent() || Ui(this.cm, function () {
                    return zi(e.cm)
                })
            }, ka.prototype.setUneditable = function (e) {
                e.contentEditable = "false"
            }, ka.prototype.onKeyPress = function (e) {
                0 != e.charCode && (e.preventDefault(), this.cm.isReadOnly() || ji(this.cm, ma)(this.cm, String.fromCharCode(null == e.charCode ? e.keyCode : e.charCode), 0))
            }, ka.prototype.readOnlyChanged = function (e) {
                this.div.contentEditable = String("nocursor" != e)
            }, ka.prototype.onContextMenu = function () {
            }, ka.prototype.resetPosition = function () {
            }, ka.prototype.needsContentAttribute = !0;

            function Sa(e, t) {
                var n = Mn(e, t.line);
                if (!n || n.hidden) return null;
                var i = se(e.doc, t.line), r = _n(n, i, t.line), o = Je(i, e.doc.direction), a = "left";
                if (o) {
                    a = Qe(o, t.ch) % 2 ? "right" : "left"
                }
                var s = Rn(r.map, t.ch, a);
                return s.offset = "right" == s.collapse ? s.end : s.start, s
            }

            function Ea(e, t) {
                return t && (e.bad = !0), e
            }

            function Fa(e, t, n) {
                var i;
                if (t == e.display.lineDiv) {
                    if (!(i = e.display.lineDiv.childNodes[n])) return Ea(e.clipPos(me(e.display.viewTo - 1)), !0);
                    t = null, n = 0
                } else for (i = t; ; i = i.parentNode) {
                    if (!i || i == e.display.lineDiv) return null;
                    if (i.parentNode && i.parentNode == e.display.lineDiv) break
                }
                for (var r = 0; r < e.display.view.length; r++) {
                    var o = e.display.view[r];
                    if (o.node == i) return _a(o, t, n)
                }
            }

            function _a(e, t, n) {
                var i = e.text.firstChild, r = !1;
                if (!t || !N(i, t)) return Ea(me(ue(e.line), 0), !0);
                if (t == i && (r = !0, t = i.childNodes[n], n = 0, !t)) {
                    var o = e.rest ? Q(e.rest) : e.line;
                    return Ea(me(ue(o), o.text.length), r)
                }
                var a = 3 == t.nodeType ? t : null, s = t;
                for (a || 1 != t.childNodes.length || 3 != t.firstChild.nodeType || (a = t.firstChild, n && (n = a.nodeValue.length)); s.parentNode != i;) s = s.parentNode;
                var l = e.measure, c = l.maps;

                function d(t, n, i) {
                    for (var r = -1; r < (c ? c.length : 0); r++) for (var o = r < 0 ? l.map : c[r], a = 0; a < o.length; a += 3) {
                        var s = o[a + 2];
                        if (s == t || s == n) {
                            var d = ue(r < 0 ? e.line : e.rest[r]), u = o[a] + i;
                            return (i < 0 || s != t) && (u = o[a + (i ? 1 : 0)]), me(d, u)
                        }
                    }
                }

                var u = d(a, s, n);
                if (u) return Ea(u, r);
                for (var h = s.nextSibling, f = a ? a.nodeValue.length - n : 0; h; h = h.nextSibling) {
                    if (u = d(h, h.firstChild, 0)) return Ea(me(u.line, u.ch - f), r);
                    f += h.textContent.length
                }
                for (var p = s.previousSibling, m = n; p; p = p.previousSibling) {
                    if (u = d(p, p.firstChild, -1)) return Ea(me(u.line, u.ch + m), r);
                    m += p.textContent.length
                }
            }

            var Ta = function (e) {
                this.cm = e, this.prevInput = "", this.pollingFast = !1, this.polling = new $, this.inaccurateSelection = !1, this.hasSelection = !1, this.composing = null
            };
            Ta.prototype.init = function (e) {
                var t = this, n = this, i = this.cm, r = this.wrapper = wa(), o = this.textarea = r.firstChild;
                e.wrapper.insertBefore(r, e.wrapper.firstChild), m && (o.style.width = "0px"), it(o, "input", function () {
                    a && s >= 9 && t.hasSelection && (t.hasSelection = null), n.poll()
                }), it(o, "paste", function (e) {
                    st(i, e) || ga(e, i) || (i.state.pasteIncoming = !0, n.fastPoll())
                });

                function l(e) {
                    if (!st(i, e)) {
                        if (i.somethingSelected()) pa({
                            lineWise: !1,
                            text: i.getSelections()
                        }), n.inaccurateSelection && (n.prevInput = "", n.inaccurateSelection = !1, o.value = fa.text.join("\n"), O(o)); else {
                            if (!i.options.lineWiseCopyCut) return;
                            var t = ya(i);
                            pa({
                                lineWise: !0,
                                text: t.text
                            }), "cut" == e.type ? i.setSelections(t.ranges, null, W) : (n.prevInput = "", o.value = t.text.join("\n"), O(o))
                        }
                        "cut" == e.type && (i.state.cutIncoming = !0)
                    }
                }

                it(o, "cut", l), it(o, "copy", l), it(e.scroller, "paste", function (t) {
                    wn(e, t) || st(i, t) || (i.state.pasteIncoming = !0, n.focus())
                }), it(e.lineSpace, "selectstart", function (t) {
                    wn(e, t) || ut(t)
                }), it(o, "compositionstart", function () {
                    var e = i.getCursor("from");
                    n.composing && n.composing.range.clear(), n.composing = {
                        start: e,
                        range: i.markText(e, i.getCursor("to"), {className: "CodeMirror-composing"})
                    }
                }), it(o, "compositionend", function () {
                    n.composing && (n.poll(), n.composing.range.clear(), n.composing = null)
                })
            }, Ta.prototype.prepareSelection = function () {
                var e = this.cm, t = e.display, n = e.doc, i = oi(e);
                if (e.options.moveInputWithCursor) {
                    var r = Wn(e, n.sel.primary().head, "div"), o = t.wrapper.getBoundingClientRect(),
                        a = t.lineDiv.getBoundingClientRect();
                    i.teTop = Math.max(0, Math.min(t.wrapper.clientHeight - 10, r.top + a.top - o.top)), i.teLeft = Math.max(0, Math.min(t.wrapper.clientWidth - 10, r.left + a.left - o.left))
                }
                return i
            }, Ta.prototype.showSelection = function (e) {
                var t = this.cm.display;
                _(t.cursorDiv, e.cursors), _(t.selectionDiv, e.selection), null != e.teTop && (this.wrapper.style.top = e.teTop + "px", this.wrapper.style.left = e.teLeft + "px")
            }, Ta.prototype.reset = function (e) {
                if (!this.contextMenuPending && !this.composing) {
                    var t, n, i = this.cm, r = i.doc;
                    if (i.somethingSelected()) {
                        this.prevInput = "";
                        var o = r.sel.primary(),
                            l = (t = St && (o.to().line - o.from().line > 100 || (n = i.getSelection()).length > 1e3)) ? "-" : n || i.getSelection();
                        this.textarea.value = l, i.state.focused && O(this.textarea), a && s >= 9 && (this.hasSelection = l)
                    } else e || (this.prevInput = this.textarea.value = "", a && s >= 9 && (this.hasSelection = null));
                    this.inaccurateSelection = t
                }
            }, Ta.prototype.getField = function () {
                return this.textarea
            }, Ta.prototype.supportsTouch = function () {
                return !1
            }, Ta.prototype.focus = function () {
                if ("nocursor" != this.cm.options.readOnly && (!v || L() != this.textarea)) try {
                    this.textarea.focus()
                } catch (e) {
                }
            }, Ta.prototype.blur = function () {
                this.textarea.blur()
            }, Ta.prototype.resetPosition = function () {
                this.wrapper.style.top = this.wrapper.style.left = 0
            }, Ta.prototype.receivedFocus = function () {
                this.slowPoll()
            }, Ta.prototype.slowPoll = function () {
                var e = this;
                this.pollingFast || this.polling.set(this.cm.options.pollInterval, function () {
                    e.poll(), e.cm.state.focused && e.slowPoll()
                })
            }, Ta.prototype.fastPoll = function () {
                var e = !1, t = this;
                t.pollingFast = !0;
                t.polling.set(20, function n() {
                    t.poll() || e ? (t.pollingFast = !1, t.slowPoll()) : (e = !0, t.polling.set(60, n))
                })
            }, Ta.prototype.poll = function () {
                var e = this, t = this.cm, n = this.textarea, i = this.prevInput;
                if (this.contextMenuPending || !t.state.focused || kt(n) && !i && !this.composing || t.isReadOnly() || t.options.disableInput || t.state.keySeq) return !1;
                var r = n.value;
                if (r == i && !t.somethingSelected()) return !1;
                if (a && s >= 9 && this.hasSelection === r || y && /[\uf700-\uf7ff]/.test(r)) return t.display.input.reset(), !1;
                if (t.doc.sel == t.display.selForContextMenu) {
                    var o = r.charCodeAt(0);
                    if (8203 != o || i || (i = "​"), 8666 == o) return this.reset(), this.cm.execCommand("undo")
                }
                for (var l = 0, c = Math.min(i.length, r.length); l < c && i.charCodeAt(l) == r.charCodeAt(l);) ++l;
                return Ui(t, function () {
                    ma(t, r.slice(l), i.length - l, null, e.composing ? "*compose" : null), r.length > 1e3 || r.indexOf("\n") > -1 ? n.value = e.prevInput = "" : e.prevInput = r, e.composing && (e.composing.range.clear(), e.composing.range = t.markText(e.composing.start, t.getCursor("to"), {className: "CodeMirror-composing"}))
                }), !0
            }, Ta.prototype.ensurePolled = function () {
                this.pollingFast && this.poll() && (this.pollingFast = !1)
            }, Ta.prototype.onKeyPress = function () {
                a && s >= 9 && (this.hasSelection = null), this.fastPoll()
            }, Ta.prototype.onContextMenu = function (e) {
                var t = this, n = t.cm, i = n.display, r = t.textarea, o = ni(n, e), c = i.scroller.scrollTop;
                if (o && !u) {
                    n.options.resetSelectionOnContextMenu && -1 == n.doc.sel.contains(o) && ji(n, jr)(n.doc, pr(o), W);
                    var d = r.style.cssText, h = t.wrapper.style.cssText;
                    t.wrapper.style.cssText = "position: absolute";
                    var f = t.wrapper.getBoundingClientRect();
                    r.style.cssText = "position: absolute; width: 30px; height: 30px;\n      top: " + (e.clientY - f.top - 5) + "px; left: " + (e.clientX - f.left - 5) + "px;\n      z-index: 1000; background: " + (a ? "rgba(255, 255, 255, .05)" : "transparent") + ";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";
                    var p;
                    if (l && (p = window.scrollY), i.input.focus(), l && window.scrollTo(null, p), i.input.reset(), n.somethingSelected() || (r.value = t.prevInput = " "), t.contextMenuPending = !0, i.selForContextMenu = n.doc.sel, clearTimeout(i.detectingSelectAll), a && s >= 9 && g(), k) {
                        pt(e);
                        var m = function () {
                            ot(window, "mouseup", m), setTimeout(v, 20)
                        };
                        it(window, "mouseup", m)
                    } else setTimeout(v, 50)
                }

                function g() {
                    if (null != r.selectionStart) {
                        var e = n.somethingSelected(), o = "​" + (e ? r.value : "");
                        r.value = "⇚", r.value = o, t.prevInput = e ? "" : "​", r.selectionStart = 1, r.selectionEnd = o.length, i.selForContextMenu = n.doc.sel
                    }
                }

                function v() {
                    if (t.contextMenuPending = !1, t.wrapper.style.cssText = h, r.style.cssText = d, a && s < 9 && i.scrollbars.setScrollTop(i.scroller.scrollTop = c), null != r.selectionStart) {
                        (!a || a && s < 9) && g();
                        var e = 0, o = function () {
                            i.selForContextMenu == n.doc.sel && 0 == r.selectionStart && r.selectionEnd > 0 && "​" == t.prevInput ? ji(n, Gr)(n) : e++ < 10 ? i.detectingSelectAll = setTimeout(o, 500) : (i.selForContextMenu = null, i.input.reset())
                        };
                        i.detectingSelectAll = setTimeout(o, 200)
                    }
                }
            }, Ta.prototype.readOnlyChanged = function (e) {
                e || this.reset()
            }, Ta.prototype.setUneditable = function () {
            }, Ta.prototype.needsContentAttribute = !1;
            !function (e) {
                var t = e.optionHandlers;

                function n(n, i, r, o) {
                    e.defaults[n] = i, r && (t[n] = o ? function (e, t, n) {
                        n != ra && r(e, t, n)
                    } : r)
                }

                e.defineOption = n, e.Init = ra, n("value", "", function (e, t) {
                    return e.setValue(t)
                }, !0), n("mode", null, function (e, t) {
                    e.doc.modeOption = t, br(e)
                }, !0), n("indentUnit", 2, br, !0), n("indentWithTabs", !1), n("smartIndent", !0), n("tabSize", 4, function (e) {
                    wr(e), Pn(e), zi(e)
                }, !0), n("lineSeparator", null, function (e, t) {
                    if (e.doc.lineSep = t, t) {
                        var n = [], i = e.doc.first;
                        e.doc.iter(function (e) {
                            for (var r = 0; ;) {
                                var o = e.text.indexOf(t, r);
                                if (-1 == o) break;
                                r = o + t.length, n.push(me(i, o))
                            }
                            i++
                        });
                        for (var r = n.length - 1; r >= 0; r--) io(e.doc, t, n[r], me(n[r].line, n[r].ch + t.length))
                    }
                }), n("specialChars", /[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff]/g, function (e, t, n) {
                    e.state.specialChars = new RegExp(t.source + (t.test("\t") ? "" : "|\t"), "g"), n != ra && e.refresh()
                }), n("specialCharPlaceholder", Gt, function (e) {
                    return e.refresh()
                }, !0), n("electricChars", !0), n("inputStyle", v ? "contenteditable" : "textarea", function () {
                    throw new Error("inputStyle can not (yet) be changed in a running editor")
                }, !0), n("spellcheck", !1, function (e, t) {
                    return e.getInputField().spellcheck = t
                }, !0), n("rtlMoveVisually", !w), n("wholeLineUpdateBefore", !0), n("theme", "default", function (e) {
                    ia(e), sa(e)
                }, !0), n("keyMap", "default", function (e, t, n) {
                    var i = Bo(t), r = n != ra && Bo(n);
                    r && r.detach && r.detach(e, i), i.attach && i.attach(e, r || null)
                }), n("extraKeys", null), n("lineWrapping", !1, ca, !0), n("gutters", [], function (e) {
                    or(e.options), sa(e)
                }, !0), n("fixedGutter", !0, function (e, t) {
                    e.display.gutters.style.left = t ? Zn(e.display) + "px" : "0", e.refresh()
                }, !0), n("coverGutterNextToScrollbar", !1, function (e) {
                    return Ai(e)
                }, !0), n("scrollbarStyle", "native", function (e) {
                    Ri(e), Ai(e), e.display.scrollbars.setScrollTop(e.doc.scrollTop), e.display.scrollbars.setScrollLeft(e.doc.scrollLeft)
                }, !0), n("lineNumbers", !1, function (e) {
                    or(e.options), sa(e)
                }, !0), n("firstLineNumber", 1, sa, !0), n("lineNumberFormatter", function (e) {
                    return e
                }, sa, !0), n("showCursorWhenSelecting", !1, ri, !0), n("resetSelectionOnContextMenu", !0), n("lineWiseCopyCut", !0), n("readOnly", !1, function (e, t) {
                    "nocursor" == t ? (hi(e), e.display.input.blur(), e.display.disabled = !0) : e.display.disabled = !1, e.display.input.readOnlyChanged(t)
                }), n("disableInput", !1, function (e, t) {
                    t || e.display.input.reset()
                }, !0), n("dragDrop", !0, la), n("allowDropFileTypes", null), n("cursorBlinkRate", 530), n("cursorScrollMargin", 0), n("cursorHeight", 1, ri, !0), n("singleCursorHeightPerLine", !0, ri, !0), n("workTime", 100), n("workDelay", 100), n("flattenSpans", !0, wr, !0), n("addModeClass", !1, wr, !0), n("pollInterval", 100), n("undoDepth", 200, function (e, t) {
                    return e.doc.history.undoDepth = t
                }), n("historyEventDelay", 1250), n("viewportMargin", 10, function (e) {
                    return e.refresh()
                }, !0), n("maxHighlightLength", 1e4, wr, !0), n("moveInputWithCursor", !0, function (e, t) {
                    t || e.display.input.resetPosition()
                }), n("tabindex", null, function (e, t) {
                    return e.display.input.getField().tabIndex = t || ""
                }), n("autofocus", null), n("direction", "ltr", function (e, t) {
                    return e.doc.setDirection(t)
                }, !0)
            }(da), function (e) {
                var t = e.optionHandlers, n = e.helpers = {};
                e.prototype = {
                    constructor: e,
                    focus: function () {
                        window.focus(), this.display.input.focus()
                    },
                    setOption: function (e, n) {
                        var i = this.options, r = i[e];
                        i[e] == n && "mode" != e || (i[e] = n, t.hasOwnProperty(e) && ji(this, t[e])(this, n, r), at(this, "optionChange", this, e))
                    },
                    getOption: function (e) {
                        return this.options[e]
                    },
                    getDoc: function () {
                        return this.doc
                    },
                    addKeyMap: function (e, t) {
                        this.state.keyMaps[t ? "push" : "unshift"](Bo(e))
                    },
                    removeKeyMap: function (e) {
                        for (var t = this.state.keyMaps, n = 0; n < t.length; ++n) if (t[n] == e || t[n].name == e) return t.splice(n, 1), !0
                    },
                    addOverlay: Wi(function (t, n) {
                        var i = t.token ? t : e.getMode(this.options, t);
                        if (i.startState) throw new Error("Overlays may not be stateful.");
                        !function (e, t, n) {
                            for (var i = 0, r = n(t); i < e.length && n(e[i]) <= r;) i++;
                            e.splice(i, 0, t)
                        }(this.state.overlays, {
                            mode: i,
                            modeSpec: t,
                            opaque: n && n.opaque,
                            priority: n && n.priority || 0
                        }, function (e) {
                            return e.priority
                        }), this.state.modeGen++, zi(this)
                    }),
                    removeOverlay: Wi(function (e) {
                        for (var t = this.state.overlays, n = 0; n < t.length; ++n) {
                            var i = t[n].modeSpec;
                            if (i == e || "string" == typeof e && i.name == e) return t.splice(n, 1), this.state.modeGen++, void zi(this)
                        }
                    }),
                    indentLine: Wi(function (e, t, n) {
                        "string" != typeof t && "number" != typeof t && (t = null == t ? this.options.smartIndent ? "smart" : "prev" : t ? "add" : "subtract"), fe(this.doc, e) && ha(this, e, t, n)
                    }),
                    indentSelection: Wi(function (e) {
                        for (var t = this.doc.sel.ranges, n = -1, i = 0; i < t.length; i++) {
                            var r = t[i];
                            if (r.empty()) r.head.line > n && (ha(this, r.head.line, e, !0), n = r.head.line, i == this.doc.sel.primIndex && wi(this)); else {
                                var o = r.from(), a = r.to(), s = Math.max(n, o.line);
                                n = Math.min(this.lastLine(), a.line - (a.ch ? 0 : 1)) + 1;
                                for (var l = s; l < n; ++l) ha(this, l, e);
                                var c = this.doc.sel.ranges;
                                0 == o.ch && t.length == c.length && c[i].from().ch > 0 && $r(this.doc, i, new hr(o, c[i].to()), W)
                            }
                        }
                    }),
                    getTokenAt: function (e, t) {
                        return jt(this, e, t)
                    },
                    getLineTokens: function (e, t) {
                        return jt(this, me(e), t, !0)
                    },
                    getTokenTypeAt: function (e) {
                        e = xe(this.doc, e);
                        var t, n = Pt(this, se(this.doc, e.line)), i = 0, r = (n.length - 1) / 2, o = e.ch;
                        if (0 == o) t = n[2]; else for (; ;) {
                            var a = i + r >> 1;
                            if ((a ? n[2 * a - 1] : 0) >= o) r = a; else {
                                if (!(n[2 * a + 1] < o)) {
                                    t = n[2 * a + 2];
                                    break
                                }
                                i = a + 1
                            }
                        }
                        var s = t ? t.indexOf("overlay ") : -1;
                        return s < 0 ? t : 0 == s ? null : t.slice(0, s - 1)
                    },
                    getModeAt: function (t) {
                        var n = this.doc.mode;
                        return n.innerMode ? e.innerMode(n, this.getTokenAt(t).state).mode : n
                    },
                    getHelper: function (e, t) {
                        return this.getHelpers(e, t)[0]
                    },
                    getHelpers: function (e, t) {
                        var i = [];
                        if (!n.hasOwnProperty(t)) return i;
                        var r = n[t], o = this.getModeAt(e);
                        if ("string" == typeof o[t]) r[o[t]] && i.push(r[o[t]]); else if (o[t]) for (var a = 0; a < o[t].length; a++) {
                            var s = r[o[t][a]];
                            s && i.push(s)
                        } else o.helperType && r[o.helperType] ? i.push(r[o.helperType]) : r[o.name] && i.push(r[o.name]);
                        for (var l = 0; l < r._global.length; l++) {
                            var c = r._global[l];
                            c.pred(o, this) && -1 == H(i, c.val) && i.push(c.val)
                        }
                        return i
                    },
                    getStateAfter: function (e, t) {
                        var n = this.doc;
                        return Bt(this, (e = Ce(n, null == e ? n.first + n.size - 1 : e)) + 1, t)
                    },
                    cursorCoords: function (e, t) {
                        var n = this.doc.sel.primary();
                        return Wn(this, null == e ? n.head : "object" == typeof e ? xe(this.doc, e) : e ? n.from() : n.to(), t || "page")
                    },
                    charCoords: function (e, t) {
                        return jn(this, xe(this.doc, e), t || "page")
                    },
                    coordsChar: function (e, t) {
                        return Vn(this, (e = Un(this, e, t || "page")).left, e.top)
                    },
                    lineAtHeight: function (e, t) {
                        return e = Un(this, {
                            top: e,
                            left: 0
                        }, t || "page").top, he(this.doc, e + this.display.viewOffset)
                    },
                    heightAtLine: function (e, t, n) {
                        var i, r = !1;
                        if ("number" == typeof e) {
                            var o = this.doc.first + this.doc.size - 1;
                            e < this.doc.first ? e = this.doc.first : e > o && (e = o, r = !0), i = se(this.doc, e)
                        } else i = e;
                        return Hn(this, i, {
                            top: 0,
                            left: 0
                        }, t || "page", n || r).top + (r ? this.doc.height - ze(i) : 0)
                    },
                    defaultTextHeight: function () {
                        return Gn(this.display)
                    },
                    defaultCharWidth: function () {
                        return Jn(this.display)
                    },
                    getViewport: function () {
                        return {from: this.display.viewFrom, to: this.display.viewTo}
                    },
                    addWidget: function (e, t, n, i, r) {
                        var o = this.display, a = (e = Wn(this, xe(this.doc, e))).bottom, s = e.left;
                        if (t.style.position = "absolute", t.setAttribute("cm-ignore-events", "true"), this.display.input.setUneditable(t), o.sizer.appendChild(t), "over" == i) a = e.top; else if ("above" == i || "near" == i) {
                            var l = Math.max(o.wrapper.clientHeight, this.doc.height),
                                c = Math.max(o.sizer.clientWidth, o.lineSpace.clientWidth);
                            ("above" == i || e.bottom + t.offsetHeight > l) && e.top > t.offsetHeight ? a = e.top - t.offsetHeight : e.bottom + t.offsetHeight <= l && (a = e.bottom), s + t.offsetWidth > c && (s = c - t.offsetWidth)
                        }
                        t.style.top = a + "px", t.style.left = t.style.right = "", "right" == r ? (s = o.sizer.clientWidth - t.offsetWidth, t.style.right = "0px") : ("left" == r ? s = 0 : "middle" == r && (s = (o.sizer.clientWidth - t.offsetWidth) / 2), t.style.left = s + "px"), n && function (e, t) {
                            var n = yi(e, t);
                            null != n.scrollTop && Si(e, n.scrollTop), null != n.scrollLeft && Fi(e, n.scrollLeft)
                        }(this, {left: s, top: a, right: s + t.offsetWidth, bottom: a + t.offsetHeight})
                    },
                    triggerOnKeyDown: Wi(Yo),
                    triggerOnKeyPress: Wi(Go),
                    triggerOnKeyUp: Qo,
                    execCommand: function (e) {
                        if (Ho.hasOwnProperty(e)) return Ho[e].call(null, this)
                    },
                    triggerElectric: Wi(function (e) {
                        va(this, e)
                    }),
                    findPosH: function (e, t, n, i) {
                        var r = 1;
                        t < 0 && (r = -1, t = -t);
                        for (var o = xe(this.doc, e), a = 0; a < t && !(o = Ca(this.doc, o, r, n, i)).hitSide; ++a) ;
                        return o
                    },
                    moveH: Wi(function (e, t) {
                        var n = this;
                        this.extendSelectionsBy(function (i) {
                            return n.display.shift || n.doc.extend || i.empty() ? Ca(n.doc, i.head, e, t, n.options.rtlMoveVisually) : e < 0 ? i.from() : i.to()
                        }, z)
                    }),
                    deleteH: Wi(function (e, t) {
                        var n = this.doc.sel, i = this.doc;
                        n.somethingSelected() ? i.replaceSelection("", null, "+delete") : $o(this, function (n) {
                            var r = Ca(i, n.head, e, t, !1);
                            return e < 0 ? {from: r, to: n.head} : {from: n.head, to: r}
                        })
                    }),
                    findPosV: function (e, t, n, i) {
                        var r = 1, o = i;
                        t < 0 && (r = -1, t = -t);
                        for (var a = xe(this.doc, e), s = 0; s < t; ++s) {
                            var l = Wn(this, a, "div");
                            if (null == o ? o = l.left : l.left = o, (a = xa(this, l, r, n)).hitSide) break
                        }
                        return a
                    },
                    moveV: Wi(function (e, t) {
                        var n = this, i = this.doc, r = [],
                            o = !this.display.shift && !i.extend && i.sel.somethingSelected();
                        if (i.extendSelectionsBy(function (a) {
                            if (o) return e < 0 ? a.from() : a.to();
                            var s = Wn(n, a.head, "div");
                            null != a.goalColumn && (s.left = a.goalColumn), r.push(s.left);
                            var l = xa(n, s, e, t);
                            return "page" == t && a == i.sel.primary() && bi(n, jn(n, l, "div").top - s.top), l
                        }, z), r.length) for (var a = 0; a < i.sel.ranges.length; a++) i.sel.ranges[a].goalColumn = r[a]
                    }),
                    findWordAt: function (e) {
                        var t = se(this.doc, e.line).text, n = e.ch, i = e.ch;
                        if (t) {
                            var r = this.getHelper(e, "wordChars");
                            "before" != e.sticky && i != t.length || !n ? ++i : --n;
                            for (var o = t.charAt(n), a = te(o, r) ? function (e) {
                                return te(e, r)
                            } : /\s/.test(o) ? function (e) {
                                return /\s/.test(e)
                            } : function (e) {
                                return !/\s/.test(e) && !te(e)
                            }; n > 0 && a(t.charAt(n - 1));) --n;
                            for (; i < t.length && a(t.charAt(i));) ++i
                        }
                        return new hr(me(e.line, n), me(e.line, i))
                    },
                    toggleOverwrite: function (e) {
                        null != e && e == this.state.overwrite || ((this.state.overwrite = !this.state.overwrite) ? R(this.display.cursorDiv, "CodeMirror-overwrite") : E(this.display.cursorDiv, "CodeMirror-overwrite"), at(this, "overwriteToggle", this, this.state.overwrite))
                    },
                    hasFocus: function () {
                        return this.display.input.getField() == L()
                    },
                    isReadOnly: function () {
                        return !(!this.options.readOnly && !this.doc.cantEdit)
                    },
                    scrollTo: Wi(function (e, t) {
                        Ci(this, e, t)
                    }),
                    getScrollInfo: function () {
                        var e = this.display.scroller;
                        return {
                            left: e.scrollLeft,
                            top: e.scrollTop,
                            height: e.scrollHeight - Sn(this) - this.display.barHeight,
                            width: e.scrollWidth - Sn(this) - this.display.barWidth,
                            clientHeight: Fn(this),
                            clientWidth: En(this)
                        }
                    },
                    scrollIntoView: Wi(function (e, t) {
                        null == e ? (e = {
                            from: this.doc.sel.primary().head,
                            to: null
                        }, null == t && (t = this.options.cursorScrollMargin)) : "number" == typeof e ? e = {
                            from: me(e, 0),
                            to: null
                        } : null == e.from && (e = {
                            from: e,
                            to: null
                        }), e.to || (e.to = e.from), e.margin = t || 0, null != e.from.line ? (i = e, xi(n = this), n.curOp.scrollToPos = i) : ki(this, e.from, e.to, e.margin);
                        var n, i
                    }),
                    setSize: Wi(function (e, t) {
                        var n = this, i = function (e) {
                            return "number" == typeof e || /^\d+$/.test(String(e)) ? e + "px" : e
                        };
                        null != e && (this.display.wrapper.style.width = i(e)), null != t && (this.display.wrapper.style.height = i(t)), this.options.lineWrapping && In(this);
                        var r = this.display.viewFrom;
                        this.doc.iter(r, this.display.viewTo, function (e) {
                            if (e.widgets) for (var t = 0; t < e.widgets.length; t++) if (e.widgets[t].noHScroll) {
                                Vi(n, r, "widget");
                                break
                            }
                            ++r
                        }), this.curOp.forceUpdate = !0, at(this, "refresh", this)
                    }),
                    operation: function (e) {
                        return Ui(this, e)
                    },
                    refresh: Wi(function () {
                        var e = this.display.cachedTextHeight;
                        zi(this), this.curOp.forceUpdate = !0, Pn(this), Ci(this, this.doc.scrollLeft, this.doc.scrollTop), nr(this), (null == e || Math.abs(e - Gn(this.display)) > .5) && ti(this), at(this, "refresh", this)
                    }),
                    swapDoc: Wi(function (e) {
                        var t = this.doc;
                        return t.cm = null, Sr(this, e), Pn(this), this.display.input.reset(), Ci(this, e.scrollLeft, e.scrollTop), this.curOp.forceScroll = !0, an(this, "swapDoc", this, t), t
                    }),
                    getInputField: function () {
                        return this.display.input.getField()
                    },
                    getWrapperElement: function () {
                        return this.display.wrapper
                    },
                    getScrollerElement: function () {
                        return this.display.scroller
                    },
                    getGutterElement: function () {
                        return this.display.gutters
                    }
                }, dt(e), e.registerHelper = function (t, i, r) {
                    n.hasOwnProperty(t) || (n[t] = e[t] = {_global: []}), n[t][i] = r
                }, e.registerGlobalHelper = function (t, i, r, o) {
                    e.registerHelper(t, i, o), n[t]._global.push({pred: r, val: o})
                }
            }(da);
            var Ma = "iter insert remove copy getEditor constructor".split(" ");
            for (var Aa in wo.prototype) wo.prototype.hasOwnProperty(Aa) && H(Ma, Aa) < 0 && (da.prototype[Aa] = function (e) {
                return function () {
                    return e.apply(this.doc, arguments)
                }
            }(wo.prototype[Aa]));
            dt(wo), da.inputStyles = {textarea: Ta, contenteditable: ka}, da.defineMode = function (e) {
                da.defaults.mode || "null" == e || (da.defaults.mode = e), function (e, t) {
                    arguments.length > 2 && (t.dependencies = Array.prototype.slice.call(arguments, 2)), Ft[e] = t
                }.apply(this, arguments)
            }, da.defineMIME = function (e, t) {
                _t[e] = t
            }, da.defineMode("null", function () {
                return {
                    token: function (e) {
                        return e.skipToEnd()
                    }
                }
            }), da.defineMIME("text/plain", "null"), da.defineExtension = function (e, t) {
                da.prototype[e] = t
            }, da.defineDocExtension = function (e, t) {
                wo.prototype[e] = t
            }, da.fromTextArea = function (e, t, n, i) {
                if ((t = t ? P(t) : {}).value = e.value, !t.tabindex && e.tabIndex && (t.tabindex = e.tabIndex), !t.placeholder && e.placeholder && (t.placeholder = e.placeholder), null == t.autofocus) {
                    var r = L();
                    t.autofocus = r == e || null != e.getAttribute("autofocus") && r == document.body
                }

                function o() {
                    e.value = c.getValue()
                }

                var a;
                if (e.form && (it(e.form, "submit", o), !t.leaveSubmitMethodAlone)) {
                    var s = e.form;
                    a = s.submit;
                    try {
                        var l = s.submit = function () {
                            o(), s.submit = a, s.submit(), s.submit = l
                        }
                    } catch (e) {
                    }
                }
                t.finishInit = function (t) {
                    t.save = o, t.getTextArea = function () {
                        return e
                    }, t.toTextArea = function () {
                        t.toTextArea = isNaN, o(), e.parentNode.removeChild(t.getWrapperElement()), e.style.display = "", e.form && (ot(e.form, "submit", o), "function" == typeof e.form.submit && (e.form.submit = a))
                    }
                }, e.style.display = "none";
                var c = da(function (t) {
                    return e.parentNode.insertBefore(t, e.nextSibling)
                }, t, n, i);
                return c
            }, (Na = da).off = ot, Na.on = it, Na.wheelEventPixels = cr, Na.Doc = wo, Na.splitLines = xt, Na.countColumn = B, Na.findColumn = V, Na.isWordChar = ee, Na.Pass = j, Na.signal = at, Na.Line = zt, Na.changeEnd = mr, Na.scrollbarModel = Li, Na.Pos = me, Na.cmpPos = ge, Na.modes = Ft, Na.mimeModes = _t, Na.resolveMode = Tt, Na.getMode = Mt, Na.modeExtensions = At, Na.extendMode = Nt, Na.copyState = Lt, Na.startState = Dt, Na.innerMode = Rt, Na.commands = Ho, Na.keyMap = Lo, Na.keyName = Po, Na.isModifierKey = Io, Na.lookupKey = Oo, Na.normalizeKeyMap = Do, Na.StringStream = Ot, Na.SharedTextMarker = go, Na.TextMarker = po, Na.LineWidget = uo, Na.e_preventDefault = ut, Na.e_stopPropagation = ht, Na.e_stop = pt, Na.addClass = R, Na.contains = N, Na.rmClass = E, Na.keyNames = To;
            var Na;
            return da.version = "5.26.0", da
        }()
    }), $__System.registerDynamic("15", ["1e", "13", "e", "11", "12", "25"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i, r = e("1e"), o = (e("13"), e("e")), a = e("11"), s = e("12"), l = (e("25").map, s.TYPE, s.Node), c = {},
            d = {}, u = 0, h = a.Model.extend({
                initialize: function (e) {
                    this.editor = e
                }, cancelDiagram: function (e) {
                    var t = this.editor.fences.getCm(e);
                    this.editor.findElemById(e).find(".md-diagram-panel").remove().end()[0].style.marginBottom = "", c[e] && clearTimeout(c[e]), c[e] = void 0, d[e] = void 0, t.state.lint && r.clearMarks(t), t.getWrapperElement().offsetHeight || t.refresh()
                }, refreshDiagram: function (e, t) {
                    var n = this;
                    t || (t = document.querySelector("#write")), t.querySelectorAll(".md-fences").forEach(function (t) {
                        (e || h.isDiagramType(t.getAttribute("lang")) && !t.querySelector("svg")) && (n.editor.fences.getCm(t.getAttribute("cid")), n.updateDiagram(t.getAttribute("cid"), !0))
                    })
                }, lazyload: function () {
                    if (File.option.enableDiagram) {
                        var e = this, t = this.editor;
                        window.debugMode ? Promise.all([System.import("diagram/mermaidAPI.js"), System.import("diagram/raphael.js")]).then(function () {
                            Promise.all([System.import("diagram/sequence-diagram.js"), System.import("diagram/flowchart.js")]).then(function () {
                                n()
                            })
                        }) : o.getScript((File.isNode && !window.debugMode ? "./lib.asar" : "./lib") + "/diagram/diagram.min.js", n)
                    }

                    function n() {
                        e.modeLoaded = !0, mermaidAPI.initialize({
                            theme: "none",
                            startOnLoad: !1,
                            flowchart: {useMaxWidth: !1},
                            sequence: {useMaxWidth: !1, diagramMarginX: 8, diagramMarginY: 8, boxMargin: 8},
                            gantt: {leftPadding: 0, rightPadding: 0}
                        }), mermaidAPI.parseError = function (e, t) {
                            throw t.message = e, i = t, new Error(t.message)
                        }, o(t.sessionStr).on("click", ".md-diagram-panel", function (e) {
                            var n = o(e.target).closest("a");
                            if (n.length) return t.tryOpenLink(n), !1;
                            this.previousSibling.classList.contains("CodeMirror-focused") || (this.previousSibling.CodeMirror.refresh(), this.previousSibling.CodeMirror.focus())
                        }).addClass("enable-diagrams"), e.refreshDiagram()
                    }
                }, startPreview: function (e) {
                    var t = this.editor.getNode(e).get("lang"), n = this.editor.fences.getCm(e);
                    if (h.isDiagramType(t)) {
                        var i = this.editor.findElemById(e), r = i.find(".md-diagram-panel");
                        r.length || (r = o("#componenet .md-diagram-panel").clone(), i.append(r), this.updateDiagram(e), n.setOption("lint", {
                            getAnnotations: function () {
                                return []
                            }, lintOnChange: !1
                        })), i[0].style.marginBottom = i[0].classList.contains("md-focus") ? r.height() + 50 + "px" : ""
                    }
                }, updateDiagram: function (e, t, n) {
                    var a, s = this.editor, h = this.editor.findElemById(e), f = this.editor.fences.getCm(e),
                        p = h.find(".md-diagram-panel");
                    if (h[0].removeAttribute("mermaid-type"), !p.length) return s.diagrams.startPreview(e);

                    function m(e) {
                        p.find(".md-diagram-panel-error")[0].innerHTML = "", f.state.lint && r.clearMarks(f), e && (d[f.cid] = null)
                    }

                    function g(n, i) {
                        n.loc && (d[e] = n, n.message = "[" + i + "]" + n.message, t ? document.querySelector("[cid='" + e + "'] .md-diagram-panel-error").textContent = n.message : n.loc.first_line - 1 == (f.getCursor() || {}).line && f.doc.lineCount() > 1 ? m() : s.diagrams.attachError(f, n))
                    }

                    var v = "#fff";
                    window.CSS && window.CSS.supports && window.CSS.supports("(--foo: red)") && (v = "var(--bg-color)");

                    function y() {
                        if (l.isType(f.options.mode, "sequence")) !function () {
                            try {
                                a = Diagram.parse(f.getValue() || "title: Empty Diagram"), d[e] = null
                            } catch (e) {
                                return void g(e, "Sequence")
                            }
                            m(!0), p.find(".md-diagram-panel-preview")[0].innerHTML = "", a.drawSVG(p.find(".md-diagram-panel-preview")[0], {theme: "simple"});
                            var t = p.find("svg")[0], n = p.width() / (t.getAttribute("width").replace("px", "") - 0);
                            n < 1 && (t.style.zoom = n)
                        }(); else if (l.isType(f.options.mode, "flow")) !function () {
                            try {
                                m(!0), a = flowchart.parse(f.getValue().replace(/\r/g, "") || "st=>start: Empty Diagram\ne=>end\nst->e"), p.find(".md-diagram-panel-preview")[0].innerHTML = "", a.drawSVG(p.find(".md-diagram-panel-preview")[0], {
                                    y: 0,
                                    "font-color": "currentColor",
                                    "line-color": "currentColor",
                                    "element-color": "currentColor",
                                    fill: v
                                })
                            } catch (e) {

                            }
                        }(); else {
                            if (!l.isType(f.options.mode, "mermaid")) return;
                            !function () {
                                m(!0);
                                var e = 0, t = p.find(".md-diagram-panel-preview")[0],
                                    n = f.getValue().replace(/^(\s*(%%.*)*\n)+/, function (t) {
                                        return e += t.match(/\n/g).length, ""
                                    }).replace(/\t/g, "    "), r = (n.match(/\s*([^\s]+)/) || ["", ""])[1];
                                h[0].setAttribute("mermaid-type", r);
                                var a = function (e) {
                                    if (t.innerHTML = e, e) {
                                        var n = t.children[0];
                                        n.getAttribute("height") && "100%" != n.getAttribute("height") && (n.style.height = n.getAttribute("viewBox").split(/\s/)[3] - 0 + 40 + "px")
                                    }
                                };
                                try {
                                    if (i = null, a(""), 0 == n.trim().length ? a("<text>" + o.localize.getString("Empty Diagram") + "</text>") : mermaidAPI.render("mermaidChart" + u++, n.replace(/\r/g, ""), a, t), i) throw i
                                } catch (t) {
                                    return t.loc ? (t.loc.first_line += e, t.loc.last_line += e, t.message = t.message.replace(/^[^\n]*(\d)/, function (t, n) {
                                        return "Parse error on line " + (n - 0 + e)
                                    })) : t.loc = {first_line: t.line + 1, last_line: t.line + 1}, void g(t, "Mermaid")
                                }
                                m(!0)
                            }()
                        }
                        var t = p.closest("[cid]")[0];
                        t.style.marginBottom = t.classList.contains("md-focus") ? p.height() + 40 + "px" : "", c[e] = null
                    }

                    c[e] && clearTimeout(c[e]), n ? y() : c[e] = setTimeout(y, 200)
                }, attachError: function (e, t) {
                    try {
                        if (t = t || d[e.cid], e.state.lint && r.clearMarks(e), !t || !t.loc) return;
                        var n = {
                            from: r.Pos(t.loc.first_line - 1, t.loc.first_column),
                            to: r.Pos(t.loc.last_line - 1, t.loc.last_column || e.doc.getLine(t.loc.last_line - 1).length),
                            message: t.message
                        };
                        document.querySelector("[cid='" + e.cid + "'] .md-diagram-panel-error").textContent = t.message, r.updateLinting(e, [n])
                    } catch (t) {
                    }
                }
            });
        h.isDiagramType = function (e) {
            return File.option.enableDiagram && "string" == typeof e && l.isType((e || "").toLowerCase(), "sequence", "flow", "mermaid")
        }, h.MODES = ["sequence", "flow", "mermaid"], n.exports = h
    }), $__System.registerDynamic("17", ["1e", "13", "e", "16", "11", "24", "12", "25", "15", "1a"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i, r, o = e("1e"), a = (e("13"), e("e")), s = e("16"), l = e("11"), c = (e("24"), e("12")), d = e("25"),
            u = (e("15"), e("1a")), h = u.SnapFlag, f = (d.map, c.Node),
            p = (c.TYPE, ["em", "strong", "small", "big", "s", "strike", "cite", "q", "dfn", "abbr", "data", "time", "code", "var", "smap", "kbd", "sub", "sup", "i", "b", "mark", "ruby", "span", "ins", "del", "button", "font", "acronym", "tt", "progress", "meter", "svg", "a"]),
            m = ["script", "style", "meta", "noscript", "input", "template", "head", "canvas", "link"],
            g = p.concat(["img", "a", "br", "wbr"]),
            v = ["div", "p", "h1", "h2", "h3", "h4", "h5", "h6", "table", "figure", "details", "left", "right", "center", "footer", "header", "nav", "ol", "ul", "article", "address", "dl", "applet", "map", "aside", "audio", "bdo", "blockquote", "form", "select", "dialog", "picture", "embed", "object", "iframe", "main", "pre", "section", "svg", "textarea", "video", "template", "head", "canvas", "hr"],
            y = g.concat(v).concat(m),
            b = /^\s*<(\!DOCTYPE|div|p|h[1-6]|table|figure|details|left|right|center|footer|header|nav|ol|ul|article|address|dl|applet|map|aside|audio|bdo|blockquote|form|select|dialog|picture|embed|object|iframe|main|pre|section|svg|textarea|video|template|head|canvas|base|datalist|meta|script|style|noscript|title|menu|hr)(?:(\/)|>|\s|$)/i,
            w = ["br", "hr", "embed"], C = {}, x = function (e) {
                return C[e] || (C[e] = new RegExp("(?:<" + e + "(?:\\s+[a-zA-Z_:][a-zA-Z0-9:._-]*(?:\\s*=\\s*(?:[^\"'=<>`\\\0-\\ ]+|'[^']*'|\"[^\"]*\"))?)*\\s*(\\/?)>?|<(\\/)" + e + "\\s*[>])", "i")), C[e]
            }, k = !1, S = function (e) {
                for (var t, n, i = 0; e;) {
                    if (!t) {
                        if (!(t = ((n = b.exec(e)) || [])[1]) || w.indexOf(t.toLowerCase()) > -1) break;
                        i = 0
                    }
                    if (!(n = x(t).exec(e))) break;
                    e = e.substring(n[0].length), n[2] ? i-- : n[1] || i++
                }
                return i <= 0
            }, E = function (e) {
                var t = e.doc.getCursor();
                return !t || e.doc.indexFromPos(t) >= e.doc.getValue().length
            }, F = l.Model.extend({
                initialize: function (e) {
                    this.editor = e, this.bindEvent_(), this.listenMessage(), this.currentCm = null
                }, bindEvent_: function (e) {
                    var t, n = this, i = this.editor;
                    a("#write").on("mousedown", ".md-htmlblock-container", function (e) {
                        var n = i.selection.getRangy();
                        i.undo.snap(i.focusCid, h.CURSOR_CHANGE), t = n && n.collapsed ? [e.offsetX, e.offsetY] : null
                    }).on("click", ".md-htmlblock-container", function (e) {
                        var i = (e.originalEvent.path || [])[0] || e.target;
                        if (a(i).closest("a[href]").length || !e.ctrlKey && !e.metaKey) {
                            if (a(i).closest("a, summary, audio, video[controls]:not(.md-video-load-failed), area[href]").length) ; else if (t) {
                                Math.pow(t[0] - e.offsetX, 2) + Math.pow(t[1] - e.offsetY, 2) < 16 && n.startEditing(a(this).parent(), "auto")
                            }
                        } else n.startEditing(a(this).parent(), "auto")
                    }).on("startedit", ".md-htmlblock-container", function (e) {
                        n.startEditing(a(this).parent(), "auto")
                    }).on("losefocus", ".md-htmlblock", function (e) {
                        n.stopEditing(this.getAttribute("cid")), i.selection.scrollAdjust()
                    }).on("mouseenter", "video", function (e) {
                        this.error && this.error.message && this.error.message.indexOf("ERR_CACHE_OPERATION_NOT_SUPPORTED") > -1 && (this.previousElementSibling && this.parentElement.removeChild(this.previousElementSibling), this.classList.remove("md-video-load-failed"), this.load()), this.error || this.setAttribute("controls", "controls")
                    }).on("mouseenter", ".md-video-mask", function (e) {
                        if (File.isMac) {
                            var t = window.getSelection();
                            t && !t.containsNode(this) && this.remove()
                        }
                    }).on("mouseenter", ".md-video-screenshot", function (e) {
                        if (File.isMac) {
                            this.parentElement.append(this.videoMeta), this.remove()
                        }
                    }).on("mouseleave", "video", function (e) {
                        this.error || this.removeAttribute("controls"), U(this), File.isMac && W(this)
                    }).on("click", ".md-rawblock-tooltip-edit-btn", function (e) {
                        a(e.target).closest(".md-rawblock").find(".md-rawblock-container").trigger("startedit"), a(".ty-tooltip").removeClass("shown")
                    }).on("click", ".md-rawblock-tooltip-ok-btn", i.finishRawBlockEdit.bind(i)), File.isMac && a("#write").on("mouseenter", ".md-rawblock-tooltip", function () {
                        a(this).closest(".md-rawblock").addClass("ty-hover")
                    }).on("mouseleave", ".md-rawblock-tooltip", function () {
                        var e = a(this).closest(".md-rawblock");
                        setTimeout(function () {
                            e.removeClass("ty-hover")
                        }, 100)
                    })
                }, resetVideoDom: function (e) {
                    e.classList.remove("md-video-load-failed"), a(e).prev(".md-htmlblock-panel-placeholder").remove()
                }, getCidAndElem: function (e) {
                    var t = e, n = e;
                    return "string" == typeof e ? n = this.editor.findElemById(t) : t = n.attr("cid"), [t, n]
                }, beforeDeleteFences: function (e, t) {
                    var n = this.syncToNode(e);
                    this.currentCm = void 0, t && t.map(function (e) {
                        e && (e.id == n.id && e.json && e.json.content && e.json.content.type == n.TYPE.html_block ? (e.json.content.text = n.get("text"), e.json.content.history = n.get("history")) : Array.isArray(e.json) && e.json.map(function (e) {
                            e.id == n.id && e.content.type == n.TYPE.html_block && (e.content.text = n.get("text"), e.content.history = n.get("history"))
                        }))
                    })
                }, syncToNode: function (e) {
                    var t = "string" == typeof e ? this.editor.getNode(e) : e;
                    return (this.currentCm || {}).cid === t.cid && (t.set("history", this.currentCm.doc.getHistory()), t.set("text", this.currentCm.getValue())), t
                }, stopEditing: function (e, t) {
                    if (this.currentCm && (e = e || this.currentCm.cid, this.currentCm.cid === e)) {
                        var n = this.editor.getNode(this.currentCm.cid);
                        if (n) {
                            var i = this.editor.findElemById(n.cid), r = this.editor, o = this.currentCm;
                            if (i.removeClass("md-rawblock-on-edit"), !k) return this.currentCm = null, this.syncToNode(n), i.find(".md-htmlblock-panel").hide().html(""), i.find(".md-rawblock-container").show(), void this.refreshUnder(i[0]);
                            var a = u.makeEmptyCommand();
                            a.undo.push({
                                type: "fences-pos",
                                pos: o.getCursor(),
                                id: o.cid
                            }), this.editor.undo.snapFlag == h.CURSOR_CHANGE && this.editor.undo.clearSnap(), a.undo.push(u.buildReplaceUndo(n)), this.syncToNode(n);
                            var s = n.parseFrom({noTop: !n.get("attachTo"), skips: {old_code: !1, pass_format: !0}}),
                                l = s[1];
                            a.redo.push(u.buildReplaceUndo(n)), l.length > 1 && (l = l.slice(1), u.addUndoForInsertArray(a, l, n)), this.currentCm = null, i.replaceWith(s[0]), this.refreshUnder(n.cid), t && r.selection.jumpToNextBlock(n, a), r.undo.register(a), setTimeout(function () {
                                a.redo.push(r.selection.buildUndo())
                            }, 100)
                        }
                    }
                }, refreshUnder: function (e) {
                    var t;
                    if (e) {
                        t = ("string" == typeof e ? this.editor.findElemById(e)[0] : e).querySelectorAll("iframe.md-html-iframe")
                    } else t = document.querySelectorAll("iframe.md-html-iframe");
                    t.length && t.forEach(function (e) {
                        e.contentWindow.postMessage("syncHeight", "*")
                    })
                }, startEditing: function (e, t) {
                    var n = this.getCidAndElem(e), r = n[0], s = n[1], l = this.editor, c = this.editor.getNode(r);
                    if (r) {
                        if (this.currentCm && this.currentCm.cid === r) {
                            if (l.writingArea.contains(this.currentCm.getWrapperElement())) return this.currentCm.focus(), this.currentCm;
                            this.currentCm = null
                        }
                        return this.currentCm && (this.stopEditing(this.currentCm.cid), window.getSelection().removeAllRanges()), s.find(".md-htmlblock-panel").show().html('<div class="md-rawblock-input md-rawblock-control" contenteditable="false"></div>'), s.find(".md-rawblock-container").hide(), s.addClass("md-rawblock-on-edit"), this.currentCm = function (e) {
                            k = !1, i = c.get("text");
                            var t = o(s.find(".md-rawblock-input")[0], {
                                styleSelectedText: !0,
                                styleActiveLine: !0,
                                lineWrapping: !0,
                                maxHighlightLength: 1 / 0,
                                viewportMargin: 1 / 0,
                                mode: "htmlmixed",
                                placeholder: a.localize.getString("Input HTML here"),
                                theme: " inner",
                                autoCloseBrackets: !0,
                                autoCloseTags: !0,
                                value: i,
                                lineNumbers: !1,
                                resetSelectionOnContextMenu: !0,
                                dragDrop: !1,
                                indentUnit: File.option.codeIndentSize,
                                tabSize: File.option.codeIndentSize
                            }, e, r);
                            return c.get("history") && t.setHistory(c.get("history")), t.on("blur", function (e) {
                                try {
                                    c.set("history", e.doc.getHistory()), c.set("text", e.doc.getValue())
                                } catch (e) {
                                    console.warn(e.stack)
                                }
                            }), t.on("focus", function (n) {
                                e.refocus(t.cid)
                            }), t.on("change", function () {
                                e.brush.updateWordCount(), e.selection.clearGlobalColumn(), k = !0, File.isTypeWriterMode && !File.option.scrollWithCursor && e.selection.typeWriterScroll(t.cursorCoords(t.getCursor()))
                            }), t.on("cursorActivity", function () {
                                File.isTypeWriterMode && File.option.scrollWithCursor && e.selection.typeWriterScroll(t.cursorCoords(t.getCursor()))
                            }), t.on("keydown", function (t, n) {
                                var i, r = n.which || n.keyCode, a = o.keyName(n);
                                if (!n.metaKey && !n.shiftKey && n.ctrlKey, "Up" == o.keyNames[r]) return e.selection.moveUpOrDown(!0, n), n.codemirrorIgnore;
                                if ("Down" == o.keyNames[r]) return e.selection.moveUpOrDown(!1, n), n.codemirrorIgnore;
                                if (e.selection.clearGlobalColumn(), "Backspace" == o.keyNames[r]) {
                                    if (!t.getValue().length) return _(e, t), n.preventDefault(), n.codemirrorIgnore
                                } else if ("Enter" == o.keyNames[r] && E(t)) {
                                    if (n.ctrlKey || n.metaKey || !n.shiftKey && S(t.getValue())) return setTimeout(function () {
                                        e.UserOp.insertParagraph()
                                    }, 20), n.preventDefault(), n.stopPropagation(), n.codemirrorIgnore
                                } else if ("PageDown" == o.keyNames[r]) {
                                    if (E(t)) return t.execCommand("goDocEnd"), e.selection.moveUpOrDown(!1), void(n.codemirrorIgnore = !0)
                                } else if ("PageUp" == o.keyNames[r] && (!(i = t.doc.getCursor()) || 0 == i.line && 0 == i.ch)) return t.execCommand("goDocStart"), e.selection.moveUpOrDown(!0), void(n.codemirrorIgnore = !0);
                                (o.keyMap.macDefault[a] || o.keyMap.pcDefault[a]) && n.stopPropagation()
                            }), t
                        }(this.editor), (d = this.currentCm).focus(), d.execCommand("goDocEnd"), l.selection.scrollAdjust(), t && ("start" == t ? this.currentCm.execCommand("goDocStart") : "end" == t ? this.currentCm.execCommand("goDocEnd") : "auto" == t && this.findPos(this.currentCm), this.editor.refocus(r), this.editor.undo.snap(r, h.CURSOR_CHANGE)), this.currentCm
                    }
                    var d
                }, findPos: function (e) {
                    var t = e.lineCount();
                    t >= 3 ? e.setCursor(t - 2, e.getLine(t - 2).length) : 2 == t ? e.setCursor(t - 1, 0) : e.setCursor(t - 1, e.getLine(t - 1).length)
                }, listenMessage: function () {
                    var e = this.editor;
                    window.addEventListener("message", function (t) {
                        var n = t.data, i = e.findElemById(n.cid).find("iframe")[0];
                        "changeHeight" == n.msg && (i.height = n.height), "startEditing" == n.msg && a(i).closest(".md-rawblock-container").trigger("startedit"), "contextmenu" == n.msg && File.isNode && T(i, n.event), "mousedown" == n.msg && File.isNode && File.editor.contextMenu.hide()
                    }, !1)
                }
            });
        F.allowWhiteList = function () {
            if (void 0 === r) {
                var e = document.createElement("iframe");
                r = void 0 !== e.srcdoc, e.remove()
            }
            return r
        };
        var _ = function (e, t) {
            var n = e.getNode(t.cid), i = e.undo.UndoManager, r = i.makeEmptyCommand();
            e.htmlBlock.beforeDeleteFences(t.cid), r.undo.push({
                type: "fences-pos",
                pos: t.getCursor(),
                id: t.cid
            }), i.append(r, e.UserOp.backToParagraph(e, n, !1)), e.undo.register(r)
        };
        F.getDomPurifyConfig = function (e) {
            return Object.assign({
                FORBID_ATTR: ["class", "contenteditable", "cid", "id", "loop", "autoplay", "preload"],
                ADD_ATTR: ["allowfullscreen", "async", "charset", "srcdoc", "controls"],
                ADD_TAGS: ["iframe", "dialog", "embed", "footer"],
                FORBID_TAGS: ["head"],
                ALLOW_DATA_ATTR: !1,
                RETURN_DOM: !0,
                ALLOW_UNKNOWN_PROTOCOLS: !0,
                USE_PROFILES: {html: !0, svg: !0, svgFilters: !0, mathMl: !0}
            }, e)
        };
        var T = function (e, t) {
            var n = a(e), i = n.offset(), r = new a.Event("contextmenu", {
                target: e,
                currentTarget: e,
                clientY: i.top + t.clientY,
                clientX: i.left + t.clientX
            });
            n.trigger(r)
        }, M = function (e) {
            return e.src && /\.pdf/i.exec(new URL(e.src).pathname)
        };
        window.remoteOnLoad = function (e) {
            e.classList.contains("md-html-iframe") || e.previousElementSibling && (e.previousElementSibling.classList.contains("md-htmlblock-panel-placeholder") && e.parentElement.removeChild(e.previousElementSibling), File.isNode ? e.contentDocument.body ? t(e) : e.contentDocument.addEventListener("DOMContentLoaded", function (n) {
                t(e)
            }) : e.removeAttribute("guest-id"), H(e));

            function t(e) {
                var t = M(e);
                if (e.contentDocument.documentElement.oncontextmenu = function (t) {
                    T(e, t)
                }, e.contentDocument.documentElement.addEventListener("mousedown", function (e) {
                    File.editor.contextMenu.hide()
                }), "" == e.height && e.contentDocument && e.contentDocument.body) {
                    var n = e.contentWindow.innerHeight, i = e.contentDocument.body.scrollHeight;
                    i != n || t && e.contentDocument.body.childElementCount > 4 ? e.height = Math.min(i, 600) : (e.height = 24, e.height = e.contentDocument.body.scrollHeight), e.dataset.userHeight = e.height
                }
            }
        };
        var A = document.querySelector("#md-htmlblock-panel-novideo-templ").text,
            N = document.querySelector("#md-htmlblock-panel-nohtml-templ").text;
        window.videoOnError = function (e) {
            var t = document.createElement("div");
            t.setAttribute("class", "md-htmlblock-panel-placeholder"), t.innerHTML = A, t.querySelector(".md-resouce-error-message").textContent = e.src.replace("http://typora-app", "Typora.app"), e.parentElement.insertBefore(t, e), e.classList.add("md-video-load-failed")
        };

        function L(e, t, n) {
            var i = e.previousElementSibling;
            t = t.replace("http://typora-app", "Typora.app"), i || ((i = document.createElement("div")).classList.add("md-htmlblock-panel-placeholder"), e.parentElement.insertBefore(i, e)), i.innerHTML = N, i.querySelector(".md-resouce-error-message").textContent = t, e.height = Math.max((e.height || 0) - 0, 48)
        }

        var R = function (e) {
            if (!F.allowWhiteList()) return !1;
            var t = e.querySelectorAll("script");
            if (1 == t.length && t[0].parentElement == e) {
                return I(t[0].getAttribute("src"))
            }
            return !1
        };
        F.checkIsWhiteList = function (e) {
            if (!F.allowWhiteList()) return !1;
            if ("script" == e.get("style")) {
                var t = a.parseHTML(e.get("text"), document, !0);
                if (!t) return;
                if (1 == t.length) {
                    return I(t[0].getAttribute("src"))
                }
                t.remove()
            }
        };
        var D = {
                gist: /^https:\/\/gist\.github\.com\/.*\.js/,
                jsfiddle: /^https:\/\/jsfiddle\.net\/[^\/]+\/embed(\?|\/|$)/
            },
            O = ["https://platform.twitter.com/widgets.js", "https://static.codepen.io/assets/embed/ei.js", "https://cssdeck.com/assets/js/embed.js", "https://www.instagram.com/embed.js", "https://s.imgur.com/min/embed.js", "https://speakerdeck.com/assets/embed.js"];

        function I(e) {
            return e = /^\/\//.exec(e = e || "") ? "https:" + e : e.replace(/^http:/, "https:"), O.indexOf(e) > -1 || (!!D.gist.exec(e) || !!D.jsfiddle.exec(e))
        }

        var P = new DOMParser;

        function B(e, t, n) {
            var i = (P.parseFromString("<body>" + e + "</body>", "text/html") || {}).body;
            return i || ((i = document.createElement("body")).innerHTML = e), n ? i : R(i) ? (t.whitelistMode = !0, t.ADD_TAGS ? t.ADD_TAGS.push("script") : t.ADD_TAGS = ["script"], t.FORBID_ATTR = ["contenteditable"], t.ALLOW_DATA_ATTR = !0, i.classList.add("md-preview-body"), i) : (i.querySelectorAll("webview").forEach(function (e) {
                e.remove()
            }), i.querySelectorAll("[role='wrapper']").forEach(function (e) {
                e.removeAttribute("role")
            }), i.querySelectorAll("iframe, video").forEach(function (e) {
                var t = document.createElement("div");
                t.setAttribute("role", "wrapper"), e.parentElement.replaceChild(t, e), t.appendChild(e)
            }), i)
        }

        var $ = 2;
        s.addHook("afterSanitizeAttributes", function (e, t, n) {
            var i = e && e.nodeType == e.ELEMENT_NODE;

            function r(e) {
                var t = e.getAttribute("src");
                e.dataset.src = t, File.editor.imgEdit && (e.src = File.editor.imgEdit.getAbsolutePath(t, !0))
            }

            if (i) {
                var o = e.getAttribute("src");
                /^\/\//.exec(o || "") && e.setAttribute("src", "https:" + o);
                var a = e.getAttribute("href");
                /^\/\//.exec(a || "") && e.setAttribute("href", "https:" + a)
            }
            if (!n.whitelistMode && (i && (n.forHTMLBlock ? e.parentElement && "BODY" == e.parentElement.tagName && "none" == e.style.display && (e.style.display = "") : f.isType(e.style.display, "inline", "inline-block") || (e.style.display = ""), n.forHTMLBlock && !f.isType(e.style.position, "fixed", "sticky") || (e.style.position = "")), n.forHTMLBlock)) {
                if (i) {
                    if (f.isType(e.tagName, "IFRAME", "WEBVIEW")) {
                        if ((o = e.getAttribute("src")) && e.setAttribute("src", o.replace(/^\/\//, "https://")), e.setAttribute("guest-id", ++$), "IFRAME" == e.tagName) {
                            if (e.setAttribute("allow-top-navigation", "false"), e.setAttribute("allow-forms", "false"), e.setAttribute("allowfullscreen", "true"), e.setAttribute("allow-popups", "false"), e.srcdoc) return void e.setAttribute("sandbox", "");
                            /^(https?)?:[\\\/]/.exec(o) ? e.setAttribute("sandbox", "allow-same-origin allow-scripts") : e.setAttribute("sandbox", "allow-scripts"), e.setAttribute("onLoad", "window.remoteOnLoad(this)"), File.editor.imgEdit && (e.src = File.editor.imgEdit.getAbsolutePath(e.getAttribute("src"), !0))
                        } else e.setAttribute("preload", "./app/load-webview.js"), e.setAttribute("webpreferences", "webViewGuestId=" + $ + ", webviewTag=no"), e.setAttribute("autosize", "autosize"), e.setAttribute("nodeintegration", !1);
                        if ("wrapper" == e.parentElement.getAttribute("role")) {
                            var s = document.createElement("div");
                            s.setAttribute("class", "md-htmlblock-panel-placeholder"), s.innerHTML = '<div class="ty-lds-spinner"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>', e.parentElement.insertBefore(s, e)
                        }
                    }
                    if (f.isType(e.tagName, "VIDEO", "AUDIO", "IMG")) {
                        (o = e.getAttribute("src")) && r(e), (e.querySelectorAll("source") || []).forEach(r)
                    }
                    f.isType(e.tagName, "VIDEO") && (e.setAttribute("controlsList", "nodownload"), e.setAttribute("onError", "window.videoOnError(this)"), File.isMac && (e.setAttribute("oncanplaythrough", "replaceVideoByImage(this)"), e.setAttribute("onpause", "replaceVideoByImage(this)"), e.setAttribute("onplay", "this.imgMeta = undefined;"))), f.isType(e.tagName, "AUDIO") && e.setAttribute("controlsList", "nodownload")
                }
                return e
            }
        });
        document.querySelector("#ty-resize-temp");

        function H(e, t) {
            e && !e.srcdoc && e && e.contentDocument && e.contentDocument.body && (0 !== e.src.indexOf(e.contentWindow.location.protocol) && ("about:blank" == e.contentWindow.location.href && L(e, e.src), e.contentDocument.body.childNodes.length + e.contentDocument.head.childNodes.length == 0 && L(e, e.src)), e.removeAttribute("guest-id"))
        }

        window.turnOnIframeRefreshTimer = function (e, t) {
            setTimeout(function () {
                H(document.querySelector("iframe[guest-id='" + e + "']"))
            }, 2e3)
        };

        function U(e) {
            if (e.parentElement && "wrapper" == e.parentElement.getAttribute("role") && !e.previousElementSibling) {
                var t;
                window.isOnWindowHtml ? (t = document.createElement("img")).src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=" : (t = document.createElement("div")).innerHTML = "<span>&nbsp;</span>", t.classList.add("md-video-mask"), e.parentElement.insertBefore(t, e)
            }
        }

        function j(e) {
            return !e.error && 4 == e.readyState && e.videoHeight > 0 && !e.controls && !(e.currentTime > 0 && !e.ended && !e.paused)
        }

        function W(e) {
            if (e.imgMeta && j(e)) return e.parentElement.appendChild(e.imgMeta), void e.parentElement.removeChild(e);
            var t = j(e) && function (e) {
                var t = document.querySelector("#video-canvas"), n = t.getContext("2d");
                t.width = e.videoWidth, t.height = e.videoHeight;
                try {
                    return n.drawImage(e, 0, 0, e.videoWidth, e.videoHeight), t.toDataURL()
                } catch (e) {
                    console.warn(e)
                }
                return ""
            }(e);
            if (t) {
                var n = document.createElement("img"), i = e.getAttribute("style");
                n.onload = function () {
                    n.setAttribute("style", i), j(e) ? (e.imgMeta = n, e.parentElement.appendChild(n), e.parentElement.removeChild(e)) : (e.imgMeta = void 0, n.videoMeta = void 0, n.remove())
                }, n.src = t, n.setAttribute("class", "md-video-screenshot"), n.setAttribute("style", i), n.videoMeta = e
            }
        }

        window.replaceVideoByImage = W, F.buildHTMLForExport = function (e, t, n) {
            var i = B(e.get("text"), null, !0);
            return i.querySelectorAll("iframe, video, audio, img").forEach(function (e) {
                var i = e.getAttribute("src");
                /^\/\//.exec(i) ? e.src = "https:" + i : n && (e.src = t.imgEdit.getAbsolutePath(i, !0)), e.setAttribute("onError", "this.style.display = 'none';")
            }), i.innerHTML
        }, F.buildHTML = function (e) {
            var t = F.getDomPurifyConfig({forHTMLBlock: !0}), n = B(e.get("text"), t);
            if ((n = s.sanitize(n, t)).classList.contains("md-preview-body")) {
                return function (e, t, n) {
                    e.classList.add("md-html-iframe"), e.sandbox = "allow-same-origin allow-scripts allow-popups", e.setAttribute("seamless", "seamless"), e.setAttribute("allow-top-navigation", "false"), e.setAttribute("allow-forms", "false"), e.setAttribute("allowfullscreen", "true"), e.height = 20, e.srcdoc = "<html><head><script>window.reqnode = undefined;window.require = undefined;<\/script><style type='text/css'>iframe {margin: auto;}</style></head><body>" + t + "<script>" + q.replace(/\s*\n\s*/g, "") + "\niframePreloadScript('" + n + "');<\/script></body></html>";
                    var i = e.outerHTML;
                    return e.remove(), i
                }(document.createElement("iframe"), n.innerHTML, e.cid)
            }
            return n.querySelectorAll("iframe").forEach(function (t) {
                var n = t.getAttribute("guest-id") - 0;
                if (n && !isNaN(n)) {
                    var i = document.createElement("SCRIPT");
                    i.setAttribute("data-run", "true"), i.type = "text/javascript", i.text = "turnOnIframeRefreshTimer(" + n + ", '" + e.cid + "')", t.parentElement.appendChild(i)
                }
            }), n.querySelectorAll("video").forEach(function (e) {
                U(e)
            }), n.innerHTML
        };
        var q = document.querySelector("#md-html-iframe-preload-temp").innerHTML;
        F.autoCloseTagWhenInput = function (e, t, n, i, r, o) {
            if (0 != ("/" === t && o.startContainer.nodeType === document.TEXT_NODE && "<" === o.startContainer.nodeValue.substring(o.startOffset - 1, o.startOffset) && void 0)) {
                var s = function () {
                    var e = a(o.startContainer.parentElement).prev("[md-inline='tag']").text();
                    if (e && !/\/>/.exec(e)) {
                        var t = (/<([A-Za-z1-9]+)/.exec(e) || [])[1];
                        return y.indexOf(t) > -1 ? t : void 0
                    }
                }();
                return s ? function (t) {
                    e.undo.completeSnap(!0), e.undo.snap(n.cid, h.REPLACE);
                    var a = document.createTextNode("/" + t + ">");
                    return o.insertNode(a), a.parentElement.normalize(), function (t) {
                        var n = e.selection.rangy.createRange();
                        i.end += t, i.start += t, n.moveToBookmark(i), n.select(n.isBackward), r && r.redo.push(e.selection.buildUndo())
                    }(t.length + 2), r && e.undo.register(r), !0
                }(s) : void 0
            }
        }, F.prototype.autoCloseTagWhenInput = F.autoCloseTagWhenInput, F.BLOCK_OPEN_REG = b, F.INLINE_TYPE = p, F.ALL_INLINE_TYPE = g, F.HIDDEN_TYPE = m, F.NO_TEXT_BLOCK_TYPE = ["html", "body", "script", "style", "meta", "noscript", "template", "head", "canvas", "link"], F.BLOCK_TYPE = v, F.autoCloseTag = function (e) {
            var t = e.get("text"), n = (/^[ \t]+/.exec(t) || [""])[0], i = e.get("style"), r = e.get("depth");
            if (!(w.indexOf(i) > -1)) {
                for (r && (t += "\n" + n + " ".repeat(File.option.codeIndentSize)); r;) r--, t += "\n" + n + "</" + i + ">";
                e.set("text", t), e.set("depth", 0)
            }
        }, F.getHTMLTagReg = x, n.exports = F
    }), $__System.registerDynamic("18", ["13", "12", "2f", "1a", "45", "17", "1c"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i = e("13"), r = e("12"), o = r.Node, a = r.TYPE, s = e("2f"), l = e("1a"), c = e("45"), d = e("17"),
            u = e("1c"),
            h = {ul: /^(\s*)(([-+*])\s+)/, ol: /^(\s*)\d+\.\s+/, tasklist: /^(\s*)(([-+*])\s*)\[((x|X)| )\]\s+/},
            f = /^(\s*)([-+*>\[]|\d+\.)\s+/, p = /^(\s*)[^\s]/, m = null,
            g = {ul: /^(\s*)([-+*])\s+/, ol: /^(\s*)(\d+\.)\s+/, tasklist: /^(\s*)([-+*]\s*\[((x|X)| )\])\s+/}, v = {
                ul: /^(\s{0,3})([-+*])\s+/,
                ol: /^(\s{0,3})(\d+\.)\s+/,
                tasklist: /^(\s{0,3})([-+*]\s*\[((x|X)| )\])\s+/
            }, y = /\r\n|\r|\n|\u2424/, b = /^[ \u00A0]{0,3}$/, w = /^[\s\u00A0]*$/, C = /(^\s{0,3}>[ \t]*)(.*)$/,
            x = /(^\s*(#{1,6})\s*)([^\n]+?)(\s+#+\s*)*$/, k = /(^\s*(#{1,6})\s+)([^\n]+?)(\s+#+\s*)*$/,
            S = /^ *(=|-){2,}[\s\u00A0]*$/, E = /^\s*[-+*_<\[\{|#0-9`~=>$]/,
            F = /^( *(`{3,}|~{3,}|·{3,})[ \t\u00A0]*)([^\n`]+)? *$/, _ = /^\s*(`{3,}|~{3,})\s*$/,
            T = /^\s*\${2}\s*(?:\{(.+)\})?$/, M = /^( {4}|\t)(\s*\S.*)$/, A = /^( {4}|\t)/,
            N = /^\s*([-+_*])\s*\1\s*\1(\s|\1)*$/, L = /^\s*\[toc\]\s*$/i, R = /^\s*\{:toc\}\s*$/i,
            D = /^\s?\{:\s*toc(\s*|(\s+.*))\}/,
            O = /^\s*\[([^\]]+)\]:(\s*<?)([^\s>]+)(>?)((\s+)["'(]([^\n]*)["')])?\s*$/,
            I = /^\s*\[\^([^\]\n]+)\]:\s*([^\n]*)$/, P = /^-{3}$/, B = /^ *\|([^\|]+\|.+)\|\s*$/,
            $ = /^\s*\|(.+)\|\s*$/, H = /^ *\|(\s*[-:]+\s*\|[-| :]*)$/, U = /^ *([-:]+\s*\|[-| :]*)$/, j = /\|/,
            W = d.BLOCK_OPEN_REG, q = /^\s*[-\u2013\u2014+*_<\u3010\[\{|#0-9`~=>$]/, z = /^\s*([-\u2013\u2014])/,
            V = /^\s*[\[\u3010]toc[\]\u3011]\s*$/i, K = /^(-{3}|\u2013[-\u2013\u2014]+|\u2014[-\u2013\u2014]*)$/,
            Y = {}, Q = {}, G = {}, J = "  ", X = function (e) {
                if (e.get("style") == o.ListType.ol) {
                    for (var t = function (e) {
                        if (e.get("style") == o.ListType.ol) {
                            for (var t = e.getFirstChild(), n = !1, i = t.get("after"); i && i._numText;) {
                                if (t._numText.trim() != i._numText.trim()) return !1;
                                n = !0, i = (t = i).get("after")
                            }
                            return n
                        }
                    }(e), n = e.getFirstChild(), i = n._numText; n;) n._numText = void 0, n = n.get("after");
                    t && e.set("pattern", i), e.set("isFixed", t)
                }
            }, Z = function (e) {
                return (e || "").replace(/\t/g, J).length
            }, ee = {NOT_CLOSE: 0, CLOSE_EXCLUDE: 1, CLOSE_INCLUDE: 2, UNKNOWN: -1}, te = d.getHTMLTagReg, ne = {
                paragraph: {
                    shouldClose: function (e) {
                        return e.match(b) ? (this.cur.set("tail", 1), ee.CLOSE_INCLUDE) : ee.UNKNOWN
                    }, onClose: function (e) {
                        this.cur._lines.length > 1 && this.cur._lines[0].match(w) && (this.cur.set("ahead", 1), this.cur._lines.shift()), !this.cur._lines.length && this.cur._lines.push(""), this.cur.set("text", this.cur._lines.join("\n")), this.cur._lines = void 0
                    }, onContinue: function (e) {
                        this.cur._lines.push(e)
                    }
                }, html_block: {
                    shouldClose: function (e) {
                        var t, n = this.cur.get("depth") || 0, i = te(this.cur.get("style")), r = e;
                        if (!e.trim()) return ee.CLOSE_EXCLUDE;
                        for (; t = i.exec(r);) r = r.substring(t.index + t[0].length), t[2] ? n-- : t[1] || n++;
                        return n <= 0 ? (this.cur.set("depth", 0), this.cur._lines.push(e), ee.CLOSE_INCLUDE) : (this.cur.set("depth", n), ee.NOT_CLOSE)
                    }, onClose: function (e) {
                        var t = this.cur.get("depth");
                        this.cur.set("text", this.cur._lines.join("\n")), t && this.skips.enableStartMatch && (1 != this.cur._lines.length || />/.exec(this.cur._lines[0]) ? d.autoCloseTag(this.cur) : (this.cur.set("type", a.paragraph), this.cur.unset("style"))), this.cur._lines = void 0
                    }, onContinue: function (e) {
                        this.cur._lines.push(e)
                    }
                }, blockquote: {
                    shouldClose: function (e) {
                        return e.trim().length ? e.match(C) ? ee.NOT_CLOSE : e.match(/\t|( {2,})/) ? ee.NOT_CLOSE : ee.UNKNOWN : (this.cur.set("tail", 1), ee.CLOSE_INCLUDE)
                    }, onClose: function (e) {
                        new re(this.cur._lines, this.cur, null, null, this.skips), this.cur._lines = void 0, this.cur.unset("text"), (this.skips || {}).pass_format || this.cur.set("userIndent", this.cur._lineIndents), this.cur._lineIndents = void 0
                    }, onContinue: function (e) {
                        var t = this.cur._indent;
                        Y[t] || (Y[t] = new RegExp("^(\\t|[> ](\\t| {0," + (t || 0) + "}))"));
                        var n = (Y[t].exec(e) || [""])[0];
                        this.cur._lineIndents.push(n), this.cur._lines.push(e.substring(n.length))
                    }
                }, list: {
                    shouldClose: function (e) {
                        var t, n = this.cur.getLastChild();
                        if (Q[n._indent] || (Q[n._indent] = new RegExp("^( {" + n._indent + ",}|\\t)")), e.match(Q[n._indent])) return this.cur.unset("tail"), ee.NOT_CLOSE;
                        if (e.match(w)) return this.cur.set("tail", (this.cur.get("tail") || 0) + 1), this.cur.get("tail") > 1 ? (this.cur.set("tail", 1), ee.CLOSE_EXCLUDE) : ee.NOT_CLOSE;
                        if (t = h[this.cur.get("style")].exec(e)) return this.cur.get("style") != o.ListType.ol ? t[3] == this.cur._mark ? 0 : 1 : ee.NOT_CLOSE;
                        return this.lines[this.ln - 1].match(w) ? ee.CLOSE_EXCLUDE : ee.UNKNOWN
                    }, onClose: function () {
                        for (var e = this.cur.getLastChild(), t = this.cur.get("tail") || 0; t > 0 && !e._lines.last().trim().length;) e._lines.pop(), e._lineIndents.pop(), t--;
                        new re(e._lines, e, null, null, this.skips), e.unset("text"), (this.skips || {}).pass_format || e.set("userIndent", e._lineIndents), e._lines = void 0, e._indent = void 0, e._indentDecided = void 0, e._lineIndents = void 0, this.cur._mark = void 0, this.cur.unset("text"), (this.skips || {}).pass_format || (X(this.cur), !this.cur.get("tail") && this.lines[this.ln] && this.cur.set("tail", 0))
                    }, onContinue: function (e, t, n) {
                        var i, r = this.cur.getLastChild(), s = Z(t), l = File.option.strictMarkdown ? s - n : 2,
                            c = this.cur.get("style"), d = 0;
                        n = n || (r ? r.get("prespace") : 0) || 0;

                        function u(e, t, n) {
                            n && (e._lines = []), e._lines.push(t)
                        }

                        e.match(w) || this.cur.unset("tail");
                        var g, v;
                        if (!r) return c == o.ListType.ol && (d = /^\s*(\d+)\.\s+/.exec(e)[1].length - 1), r = new o({
                            type: a.list_item,
                            prespace: n,
                            markindent: s - d - n
                        }), this.cur.append(r), r._indent = l + n, c == o.ListType.ol && (r._numText = (/^\s*(\d+\.\s+)/.exec(e) || [])[1], r._numLength = d), (v = h[o.ListType.task].exec(e)) ? (r.set("checked", !!v[5]), r.set("style", o.ListType.task), g = v[0]) : g = h[c].exec(e)[0], r._lineIndents = [g], void u(r, e.substring(g.length), !0);
                        r._numLength = r._numLength || 0, Q[r._indent] || (Q[r._indent] = new RegExp("^( {" + r._indent + ",}|\\t)"));
                        var y = e.match(Q[r._indent]), b = 0;
                        if (G[r._indent] || (G[r._indent] = new RegExp("^ {2," + r._indent + "}|\\t")), b = (e.match(G[r._indent]) || [""])[0].length, g = (G[r._indent].exec(e) || [""])[0], e = y ? e.substring(g.length) : e, r.get("style") == o.ListType.task && !File.option.strictMarkdown && y && (g += (e.match(/^ {4}/) || [""])[0], e = e.replace(/^ {4}/, "")), !y && (i = m[c].exec(e))) return n = (i[1] || "").length, t = i[0], s = Z(t), l = File.option.strictMarkdown ? s - n : 2, r._lines.length > 1 && r._lines.last().match(w) ? (r._lines.pop(), r.set("tail", 1)) : r.set("tail", 0), this.cur.unset("tail"), new re(r._lines, r, null, null, this.skips), (this.skips || {}).pass_format || r.set("userIndent", r._lineIndents), r.unset("text"), r._lines = void 0, r._lineIndents = void 0, r._indent = void 0, c == o.ListType.ol && (d = /^\s*(\d+)\.\s+/.exec(e)[1].length - 1), (r = new o({
                            type: a.list_item,
                            prespace: n,
                            markindent: s - d - n
                        }))._numLength = d, r._numText = (/^\s*(\d+\.\s+)/.exec(e) || [])[1], g = i[0], (v = h[o.ListType.task].exec(e)) && (r.set("checked", !!v[5]), r.set("style", o.ListType.task), g = v[0]), this.cur.append(r), r._indent = l + n, r._lineIndents = [g], void u(r, e.substring(g.length), !0);
                        if (!r._indentDecided) {
                            if ((i = p.exec(e)) && r._indent && r._indent - n < 4) if (i[1].length) {
                                var C = i[1].length, x = C + r._indent;
                                x > n + r.get("markindent") && (k = r._lines, f.exec(function (e) {
                                    if (!e || 0 == e.length) return "";
                                    for (var t = e.length - 1; t >= 0; t--) if (e[t].trim().length > 0) return e[t];
                                    return ""
                                }(k))) ? C = r.get("markindent") - r._indent : x >= n + r.get("markindent") + 4 && (C = C + r._indent - 4 - r.get("markindent")), r._indent += C, this.cur.set("subindent", r._indent - r._numLength), r.set("subindent", r._indent - r._numLength), g += e.substring(0, C), e = e.substring(C)
                            } else r.set("subindent", Math.max(2, b - r._numLength));
                            r._indentDecided = !!i
                        }
                        return r._lineIndents.push(g), void u(r, e, !1);
                        var k
                    }
                }, fences: {
                    shouldClose: function (e) {
                        var t;
                        return (t = _.exec(e)) && this.cur._mark == t[1] ? ee.CLOSE_INCLUDE : ee.NOT_CLOSE
                    }, onContinue: function (e) {
                        this.cur._lines.push(e)
                    }, onClose: function () {
                        this.cur.set("text", this.cur._lines.join("\n")), this.cur._mark = void 0, this.cur._lines = void 0;
                        var e = this.lines[this.ln + 1];
                        void 0 !== e && e.match(w) && (this.cur.set("tail", 1), this.ln++)
                    }
                }, code: {
                    shouldClose: function (e) {
                        return e.match(M) ? ee.NOT_CLOSE : e.trim().length ? ee.CLOSE_EXCLUDE : this.cur._lines.length > 1 && !this.cur._lines.last().trim().length ? ee.CLOSE_EXCLUDE : ee.NOT_CLOSE
                    }, onClose: function () {
                        var e = this.lines[this.ln];
                        e && !e.trim().length && this.cur._lines.push(e.replace(A, "")), this.cur._lines.length > 1 && (this.cur._lines.last().match(w) ? (this.cur.set("tail", 1), this.cur._lines.pop(), this.cur._lines.length > 1 && this.cur._lines.last().match(w) && (this.cur._lines.pop(), this.ln--)) : this.cur.set("tail", 0)), this.cur.set("text", this.cur._lines.join("\n")), this.cur.attributes.type = a.fences, this.cur._lines = void 0
                    }, onContinue: function (e) {
                        this.cur._lines.push(e.replace(A, ""))
                    }
                }
            };

        function ie(e, t, n) {
            var i, r, o = "", a = "", s = [], l = 0;
            if (!t) {
                if (!(r = $.exec(e))) return null;
                e = r[1]
            }
            if (e = e.replace(/(^|[^\\])((`+)([\s\S]*?[^`])\3(?!`))/g, function (e, t, n) {
                return s.push(n), [t, o, ++l - 1, a].join("")
            }), File.option.enableInlineMath && (e = e.replace(/\\\$/g, "").replace(/(^|[^\\])((\$+)([\s\S]*?[^$])\3(?!\$))/g, function (e, t, n) {
                return s.push(n.replace(/\uE07D/g, "\\$")), l++, [t.replace(/\uE07D/g, "\\$"), o, l - 1, a].join("")
            })), i = (e = e.replace(/\\\\/g, ce.ESCAPE_ESCAPE).replace(/\\\|/g, ce.ESCAPE_VLINE).replace(/\\\ /g, ce.ESCAPE_SPACE)).split(j), t && i.length <= 1) return null;
            if (i.length < n && File.option.enableInlineMath) {
                var c = (e = e.replace(/\uE07A(\d+)\uE07B/g, function (e, t) {
                    return s[t - 0]
                })).split(j);
                c.length == n && (i = c)
            }
            return i.map(function (e) {
                return (t = e.replace(/\uE022/g, "\\ ").replace(/\uE07A(\d+)\uE07B/g, function (e, t) {
                    return s[t - 0]
                })) ? t.replace(new RegExp(ce.ESCAPE_ESCAPE, "g"), "\\\\").replace(new RegExp(ce.ESCAPE_VLINE, "g"), "\\|") : t;
                var t
            })
        }

        var re = function (e, t, n, i, r) {
            m = File.option.strictMarkdown ? v : g;
            var o = e;
            this.remap = File.shouldRemapPunctuation() && (r.enableRemap || i && i.cid == File.editor.focusCid), "string" == typeof e && (o = e.split(y), "\n" === e.charCodeAt(e.length - 1) && (a -= 1));
            var a = o.length;
            this.lines = o, l = t, c = n, d = i, u = r, (s = this).parent = l, s.cur = null, s.skips = u, s.ln = 0, s.blocks = [], s.oldNode = d, s.nodeMap = l || d, s.nodeMap = s.nodeMap ? s.nodeMap.get("in") : c, J = " ".repeat(File.option.indentSize);
            var s, l, c, d, u;
            for (this.skips.enableMetaBlock = this.skips.enableMetaBlock && !t; this.ln <= a; this.ln++) oe.call(this, o[this.ln], a);
            return this
        };

        function oe(e, t) {
            var n = this.ln >= t;

            function r(e) {
                if (o.isType(this.cur, a.paragraph) && this.cur._lines && 1 == this.cur._lines.length && this.cur._lines[0].match(w)) return function (e) {
                    this.blocks.remove(e), e.remove()
                }.call(this, this.cur), this.cur = null, e.set("ahead", 1), !0
            }

            function s(e) {
                var t = this.lines[this.ln + 1];
                if (void 0 !== t && t.match(w)) return this.ln++, e.set("tail", 1), !0;
                void 0 !== t && e.set("tail", 0)
            }

            function l(e, t) {
                var n, i = e = e || this.cur;
                this.oldNode && !this.blocks.length ? (this.oldNode !== e && (n = e.get("userIndent"), e.giveChildrenTo(this.oldNode), this.oldNode.copyContentFrom(e), this.oldNode.set("userIndent", n), e._lines && (this.oldNode._lines = e._lines), e.remove()), this.blocks.push(this.oldNode), i = this.oldNode) : (this.parent ? this.parent.append(e) : this.blocks.length ? this.blocks.last().insert(e) : (console.sendError("parse error: " + e.getText()), e.set("parent", this.parent), e.set("in", this.nodeMap), e.set("attachTo", this.nodeMap)), this.blocks.push(e)), this.cur = t ? i : null
            }

            var c, u, f;

            function p(e, n) {
                this.cur && (!o.isType(this.cur, a.paragraph) || (this.cur._lines || []).length ? (f.onClose && f.onClose.call(this, n), this.ln < t - 1 && void 0 == this.cur.get("tail") && this.cur.set("tail", 0), l.call(this, this.cur, e)) : this.cur = null)
            }

            function m(e, t, n) {
                var i = new o({type: a.list, style: e, in: this.nodeMap, pattern: t});
                e == o.ListType.ol ? i.set("start", n) : i._mark = n, r.call(this, i), p.call(this), this.cur = i
            }

            function g(t) {
                var n = t ? U : H;
                if (i = ie(e, t)) {
                    var i, r, o = this.ln + 1, a = this.lines.length, s = this.lines[o], l = [];
                    if (o < a && this.lines[o].match(n)) for (o++; o < a && (r = null, r = ie(this.lines[o], t, i.length)); o++) l.push(r);
                    if (l.length) return s = t ? s.split(j) : s.replace(/^ *\||\| *$/g, "").split(j), y.call(this, i, s, l, o - 1, t), !0
                }
                return !1
            }

            function v(e) {
                u = new o({
                    type: a.toc,
                    in: this.nodeMap,
                    pattern: e
                }), r.call(this, u), s.call(this, u), p.call(this, !0), l.call(this, u)
            }

            function y(e, t, n, c, d) {
                var u, h = (this.skips || {}).pass_format,
                    f = new o({type: a.table, in: this.nodeMap, style: !h && t && d ? "npTable" : void 0}),
                    m = e.length, g = h || function (e, t, n) {
                        if (!t || !n) return !0;
                        for (var r = 0; r < e.length; r++) {
                            var o = (e[r] || "").length;
                            if (!(o > 40)) {
                                var a = i.wcswidth(e[r]);
                                if (o != (t[r] || "").length && a != i.wcswidth(t[r])) return !1;
                                for (var s = 0; s < n.length; s++) {
                                    var l = (n[s] || [])[r] || "";
                                    if (!(l.length > 40) && o !== l.length && a != i.wcswidth(l)) return !1
                                }
                            }
                        }
                        return !0
                    }(e, t, n);

                function v(e, t) {
                    var n, i = new o({type: a.table_row, parent: e, in: e.get("in"), header: !u, before: u});
                    for (b = 0; b < m; b++) {
                        var r = (t[b] || "").match(/^\s*/)[0];
                        t[b] = (t[b] || "").substring(r.length);
                        var s = (t[b] || "").match(/\s*$/)[0];
                        n = new o({
                            type: a.table_cell,
                            parent: i,
                            in: i.get("in"),
                            before: n,
                            text: (t[b] || "").trim(),
                            marginLeft: g ? void 0 : r,
                            marginRight: g ? void 0 : s
                        })
                    }
                    return i
                }

                if (f.set("alignText", g ? void 0 : t.slice(0)), !h && t && n) {
                    var y = [e.join("|"), t.join("|")].concat(n.map(function (e) {
                        return e.join("|")
                    }));
                    d || (y = y.map(function (e) {
                        return "|" + e + "|"
                    })), f.set("userText", y)
                }
                t = t || new Array(e.length), n = n || [[]];
                for (var b = 0; b < m; b++) t[b] = t[b] || "", t[b].match(/^ *-+: *$/) ? t[b] = "right" : t[b].match(/^ *:-+: *$/) ? t[b] = "center" : t[b].match(/^ *:-+ *$/) ? t[b] = "left" : t[b] = null;
                f.set("align", t), u = v.call(this, f, e), n.forEach(function (e) {
                    u = v.call(this, f, e)
                }, this), r.call(this, f), p.call(this), c && (this.ln = c), s.call(this, f), l.call(this, f), this.cur = null
            }

            if (this.cur) {
                f = ne[this.cur.get("type")];
                var b = !n && f.shouldClose.call(this, e);
                if (b > 0 || n) {
                    if (p.call(this, !1, n), 2 == b) return
                } else if (!b) return void(f.onContinue && f.onContinue.call(this, e))
            }
            if (!n) if (this.skips.old_code || this.skips.fromP || !(c = M.exec(e))) {
                if ((c = S.exec(e)) && o.isType(this.cur, a.paragraph) && !i.isNullOrBlank(this.cur._lines.last())) return u = new o({
                    type: a.heading,
                    depth: "=" == c[1] ? 1 : 2,
                    text: this.cur._lines.pop(),
                    pattern: "{0}\n" + e,
                    in: this.nodeMap
                }), r.call(this, u), p.call(this), s.call(this, u), void l.call(this, u);
                if (e.match(this.remap ? q : E)) {
                    if (c = (File.option.strictMarkdown ? k : x).exec(e)) return u = new o({
                        type: a.heading,
                        depth: c[2].length,
                        text: c[3],
                        pattern: (this.skips.enableStartMatch ? c[1].replace(/#$/, "# ") : c[1]) + "{0}" + (c[4] || ""),
                        in: this.nodeMap
                    }), r.call(this, u), s.call(this, u), p.call(this), void l.call(this, u);
                    if (c = I.exec(e)) return u = new o({
                        type: a.def_footnote,
                        ref: c[1],
                        text: c[2],
                        in: this.nodeMap
                    }), r.call(this, u), s.call(this, u), p.call(this, !0), void l.call(this, u);
                    if (c = O.exec(e)) return u = new o({
                        type: a.def_link,
                        ref: c[1],
                        href: c[3],
                        title: c[7],
                        in: this.nodeMap,
                        pattern: "[;]:" + c[2] + ";" + c[4] + (c[5] ? ";" + c[6] : "")
                    }), r.call(this, u), s.call(this, u), p.call(this, !0), void l.call(this, u);
                    if (this.skips.fromP) return this.cur || (this.cur = new o({
                        type: a.paragraph,
                        in: this.nodeMap
                    }), this.cur._lines = []), void this.cur._lines.push(e);
                    if (this.skips.enableStartMatch && (c = B.exec(e))) {
                        var _ = ie(e, !1);
                        if (_ && _.length > 1) return void y.call(this, _)
                    }
                    if (c = C.exec(e)) return u = new o({
                        type: a.blockquote,
                        in: this.nodeMap,
                        pattern: c[1]
                    }), r.call(this, u), u._lines = [c[2]], u._indent = c[1].replace(/[ \u00A0]*>/, "").length, u._lineIndents = [c[1]], p.call(this), void(this.cur = u);
                    var A = this.remap ? K : P;
                    if (this.skips.enableMetaBlock && 0 == this.ln && e.match(A)) {
                        var $ = this.ln + 1, Y = this.lines.length;
                        if (!(X = this.skips.enableStartMatch || !1)) for (; $ < Y; $++) if (this.lines[$].match(A)) {
                            X = $ > this.ln + 1;
                            break
                        }
                        if (X) return u = new o({
                            type: a.meta_block,
                            in: this.nodeMap,
                            text: this.lines.slice(this.ln + 1, $).join("\n")
                        }), r.call(this, u), this.ln = $, s.call(this, u), p.call(this, !0), void l.call(this, u)
                    }
                    if (this.remap) {
                        if (e.match(z)) {
                            var Q = e.replace(/\u2013/g, "--").replace(/\u2014/g, "---");
                            if (c = N.exec(Q)) return u = new o({
                                type: a.hr,
                                pattern: Q.trim(),
                                in: this.nodeMap
                            }), r.call(this, u), s.call(this, u), p.call(this, !0), void l.call(this, u)
                        }
                    } else if (c = N.exec(e)) return u = new o({
                        type: a.hr,
                        pattern: e.trim(),
                        in: this.nodeMap
                    }), r.call(this, u), s.call(this, u), p.call(this, !0), void l.call(this, u);
                    if (c = h.ul.exec(e)) return D.exec(this.lines[this.ln + 1] || "") ? (v.call(this, e + "\n" + this.lines[this.ln + 1]), void this.ln++) : (m.call(this, o.ListType.ul, c[2], c[3]), void(f = ne[a.list]).onContinue.call(this, e, c[0], c[1].length));
                    if (c = h.ol.exec(e)) return m.call(this, o.ListType.ol, c[0].replace(/\d+/, "{0}"), c[0].match(/\d+/)[0].replace(/^1$/, "")), void(f = ne[a.list]).onContinue.call(this, e, c[0], c[1].length);
                    if ((c = e.match(T)) && !this.skips.math_block) {
                        $ = this.ln + 1, Y = this.lines.length;
                        var G, J, X = this.skips.enableStartMatch || !1;
                        if (G = c[1], !X) for (; $ < Y; $++) if (c = this.lines[$].match(T)) {
                            J = c[1], X = !0;
                            break
                        }
                        if (X) return u = new o({
                            type: a.math_block,
                            in: this.nodeMap,
                            tagBefore: G,
                            tagAfter: J,
                            text: this.lines.slice(this.ln + 1, $).join("\n")
                        }), r.call(this, u), this.ln = $, s.call(this, u), p.call(this, !0), void l.call(this, u)
                    }
                    if (c = F.exec(e)) return (u = new o({
                        type: a.fences,
                        lang: c[3],
                        pattern: c[1] + "{0}",
                        in: this.nodeMap
                    }))._mark = c[2], u._lines = [], r.call(this, u), p.call(this), void(this.cur = u);
                    var Z = this.remap ? V : L;
                    if (e.match(Z)) return void v.call(this);
                    if (e.match(R)) return void v.call(this, e);
                    if (g.call(this, !1)) return;
                    if (File.option.blockHTML && (c = W.exec(e))) {
                        u = new o({
                            type: a.html_block,
                            in: this.nodeMap,
                            style: (c[1] || "").toLowerCase(),
                            depth: 0
                        }), r.call(this, u), p.call(this, !0);
                        var te = this.cur || (this.blocks || []).last();
                        if (te && o.isType(te, a.html_block) && 0 === te.get("tail") && !u.get("ahead")) {
                            te !== this.oldNode && te.detach(), this.blocks.pop(), this.cur = te, te._lines = te.get("text").split(/\n/);
                            var re = te.get("displayStyle") || te.get("style");
                            d.HIDDEN_TYPE.indexOf(re) > -1 && (re = c[1]), te.set("displayStyle", re), te.unset("tail"), te.set("style", c[1]), te.set("depth", 0), u.remove(), u = te
                        } else r.call(this, u), this.cur = u, this.cur._lines = [];
                        return f = ne[a.html_block], void(ne.html_block.shouldClose.call(this, e) == ee.CLOSE_INCLUDE ? (p.call(this, !0), s.call(this, this.cur), this.cur = null) : (this.cur._lines = this.cur._lines || [], this.cur._lines.push(e)))
                    }
                } else if (!this.skips.fromP && g.call(this, !0)) return;
                this.cur || (this.cur = new o({
                    type: a.paragraph,
                    in: this.nodeMap
                }), this.cur._lines = []), o.isType(this.cur, a.paragraph) ? this.cur._lines.push(e) : f && f.onContinue && f.onContinue.call(this, e)
            } else o.isType(this.cur, a.code) && f ? f.onContinue && f.onContinue.call(this, e) : o.isType(this.cur, a.paragraph) && (this.cur._lines.last() || "").trim().length ? this.cur._lines.push(e) : (u = new o({
                type: a.code,
                pattern: c[1],
                in: this.nodeMap
            }), r.call(this, u), u._lines = [c[2]], p.call(this), this.cur = u)
        }

        o.parseFrom = function (e, t, n, i) {
            n = n || {};
            return new o({type: a.raw_edit, in: t, attachTo: n.noTop ? null : t, text: e}).parseFrom(n, void 0, i)
        }, o.prototype.parseFrom = function (e, t, n) {
            if (e = e || {}, o.isType(this.get("parent"), a.table_row)) return this.set("type", a.table_cell), this.set("text", this.safeGetStrAttr("text").replace(/\n|\r/gi, "").replace(/([^\\])\|/gi, "$1|")), [!n && this.toHTML(), [this]];
            if (!o.isType(this, a.paragraph, a.raw_edit, a.html_block, a.list_item)) return [!n && this.toHTML(), [this]];
            var i = function (e) {
                if (o.isType(e, a.list_item) && !e.get("children").length) {
                    var t = new o({type: a.paragraph, text: e.get("text"), parent: e, in: e.get("in")});
                    return e.set("text", ""), t
                }
                return null
            }(this) || this, s = e.skips || {};
            if (t = t || i.get("text"), File.option.ignoreLineBreak && (t = t.replace(/\u00a0/g, " ")), s.enableMetaBlock = this.get("attachTo") && !this.get("before"), s.old_code = !1 !== s.old_code, this.isBlock(!0)) {
                var l = this.get("before"), c = this.get("after"), d = new re(t, null, i.get("in"), i, s).blocks;
                return d.length <= 1 ? [!n && this.toHTML(), [this]] : (d[0].set("before", l), d.last().set("after", c), [!n && r.NodeCollectionUtils.toHTML(d), d])
            }
        };
        var ae = function (e) {
            var t = e.last();
            if (t) return t.text || ""
        }, se = {
            escape: /^\\([\\`*{}\[\]()#+\-.!_>$|<~"'])/,
            escape2: /^[\uE013\uE014\uE018\uE020]/,
            autolink: /^<\uE016?((([^ >]+(@|:)[^ >]+))|(\s*www\.[^ >]+))\uE017?>/,
            url: /^\uE016([^\uE017]+)\uE017/i,
            comment: /^<!--[\s\S]*?-->/,
            br: /^<w?br[\s/]*>(\s*<\/w?br>)*/i,
            tag: /^(?:<([A-Za-z][A-Za-z0-9-]*)(?:\s+[a-zA-Z_:][a-zA-Z0-9:._-]*(?:\s*=\s*(?:[^"'=<>`\x00-\x20]+|'[^']*'|"[^"]*"))?)*\s*(\/?)>|<(\/)([A-Za-z][A-Za-z0-9-]*)\s*[>]|[<][?].*?[?][>]|<![A-Z]+\s+[^>]*>|<!\[CDATA\[[\s\S]*?\]\]>)/,
            underline: /^<u>([^\r]*?\S)<\/u>/i,
            atag: /^(<a\s.+?>)(.*?)(<\/\s*a>)/i,
            imgtag: /^<img(\s+[^<]+)(\/?\s*>([^<]*(<\/img>))?)/i,
            link: /^\[((?:\[[^\]]*\]|[^\[\]])*)\]\(<?((?:\([^)]*\)|[^()])*?)>?[ \t]*((['"])(.*?)\4[ \t]*)?\)/,
            image: /(^\!\[((?:\[[^\]]*\]|[^\[\]])*)\]\()(<?((?:\([^)]*\)|[^()])*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?)(\)(?:\s*{([^{}\(\)]*)})?)/,
            reflink: /^(!?)\[(inside)\]\s*\[([^\]]*)\]/,
            strong: /^(\*\*|__)(?=\S)([^\r]*?\S?[*_]?)\1/,
            strong_esp: /^\uE031([^\uE031]+)\uE031/,
            em1: /^(\_)(?=\S)([^\r]*?[^\s_])\1(?!\1)/,
            em2: /^(\*)(?=\S)([^\r]*?[^\s*])(\1{1}|\1{3})(?!\1)/,
            highlight: /^(\=\=)(?=\S)([^\r]*?\S)\1/,
            code: /^(`+)([\s\S]*?[^`])\1(?!`)/,
            del: /^~~(?=\S)([\s\S]*?\S)~~/,
            tab: /^[\t]+/,
            text: /^(\s|\S)+?[^\n\t\u200B\uE010-\uE020\uE006\\<!\[._*`&{\$\:~\^\="'\-]*/,
            footnote: /^\[\^([^\]\n]+)\]/,
            attr: /^{( *([#.][-\w_\uE006]+ *|[-\w_\uE006]+=[-\w_"'\uE006]+ *)+)}/,
            entity: /^&#?[a-z0-9]+;/i,
            emoji: /^(\u200B*):([+\-\w\uE006]+):(\u200B*)/,
            inline_math: /^\$(.|\n)*(?:[^\\])\$/,
            subscript: /^~(([^\s\n]|(\\\s))+?)~/,
            superscript: /^\^(([^\s\n]|(\\\s))+?)\^/,
            linebreak: /[ \u00A0]{2}$/,
            emptyline: /^(\n)(?:\n|$)/
        };
        se.comment_ext = /^<!(--|\u2013|\u2014)[\s\S]*?(--|\u2013|\u2014)>/, se.link_ext = /^[\[\u3010]((?:[\[\u3010][^\]\u3011]*[\u3011\]]|[^\[\]\u3010\u3011])*)[\]\u3011]\(<?((?:\([^)]*\)|[^()])*?)>?[ \t]*((["'«»‘’‚‛„‟‹›])(.*?)["'«»‘’‚‛„‟‹›][ \t]*)?\)/, se.image_ext = /(^\![\[\u3010]((?:[\[\u3010][^\]\u3011]*[\]\u3011]|[^\[\]\u3010\u3011])*)[\]\u3011][\(\uff08])(<?((?:[\(\uff08][^)\uff09]*[\)\uff09]|[^()\uff08\uff09])*?)>?)([\)\uff09](?:\s*{([^{}\(\)\uff08\uff09]*)})?)/, se.attr_ext = /^{( *([#.][-\w_\uE006]+ *|[-\w_\uE006]+=[-\w_"'«»‘’‚‛„‟‹›\uE006]+ *)+)}/, se._inside = /(?:\[[^\]]*\]|[^\[\]]|\](?=[^\[]*\]))*/, se._inside_ext = /(?:[\[\u3010][^\]\u3011]*[\]\u3011]|[^\[\]\u3010\u3011]|[\]\u3011](?=[^\[\u3010]*[\]\u3011]))*/, se.tag_ext = /^(?:<([A-Za-z][A-Za-z0-9-]*)(?:\s+[a-zA-Z_:][a-zA-Z0-9:._-]*(?:\s*=\s*(?:[^"'=<>`\x00-\x20]+|[’‚‛'‹›][^'’‚‛]*['’‚‛‹›]|["“«»„‟][^"“«»„‟]*["“«»„‟]))?)*\s*(\/?)>|<(\/)([A-Za-z][A-Za-z0-9-]*)\s*[>]|[<][?].*?[?][>]|<![A-Z]+\s+[^>]*>|<!\[CDATA\[[\s\S]*?\]\]>)/, se.reflink = me(se.reflink)("inside", se._inside)(), se.normal = ve({}, se), se.pedantic = ve({}, se.normal, {
            strong: /^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,
            em: /^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/
        }), se.gfm = se.normal, se.breaks = ve({}, se.gfm, {text: me(se.gfm.text)("{2,}", "*")()});

        function le(e, t, n) {
            this.options = e || ve({}, Fe.defaults), this.options.decorate = t || s.decorate, this.options.context = n || this, this.rules = se.normal, this.options.gfm ? this.options.breaks ? this.rules = se.breaks : this.rules = se.gfm : this.options.pedantic && (this.rules = se.pedantic), File.option.enableHighlight && (this.rules.escape2 = /^[\uE013\uE014\uE015\uE018\uE020]/), File.option.enableSuperscript ? File.option.enableHighlight ? this.rules.escape = /^\\([\\`*{}\[\]()#+\-.!_>$|<~^=])/ : this.rules.escape = /^\\([\\`*{}\[\]()#+\-.!_>$|<~^])/ : File.option.enableHighlight && (this.rules.escape = /^\\([\\`*{}\[\]()#+\-.!_>$|<~=])/)
        }

        le.rules = se;
        var ce = {
                UNDER_CHAR: "",
                MATH_CHAR: "",
                DEF_FOOT_PERFIX_CHAR: "",
                ESCAPE_SATR: "",
                ESCAPE_UNDERLINE: "",
                ESCAPE_EQUAL: "",
                URL_START: "",
                URL_END: "",
                ESCAPE_END_SQUARE_BRACKET: "",
                NOT_USED: "",
                ESCAPE_ESCAPE: "",
                ESCAPE_VLINE: "",
                ESCAPE_SPACE: ""
            }, de = {"": "[^", "": "*", "": "_", "": "=", "": "]", "": "\\"}, ue = {"": "_", "": "", "": ""},
            he = {
                "\\\\": ce.ESCAPE_ESCAPE,
                "\\*": ce.ESCAPE_SATR,
                "\\=": ce.ESCAPE_EQUAL,
                "\\_": ce.ESCAPE_UNDERLINE,
                "\\]": ce.ESCAPE_END_SQUARE_BRACKET
            };

        function fe(e) {
            return e.replace(/[\uE006-\uE020]/g, function (e) {
                return de[e] ? "\\" + de[e] : ue[e] || ""
            })
        }

        le.skipLink = {autolink: 1, url: 1, link: 1, reflink: 1};
        var pe = function (e) {
            for (var t = e.length - 1; t >= 0; t--) if (e[t].type == a.pants) {
                if ("open_double_quote" == e[t].desc) return !0;
                if ("close_double_quote" == e[t].desc) return !1
            }
            return !1
        };
        le.prototype.output = function (e, t, n, r, o) {
            t = t || this.options.decorate, (r = ve(r || {}, this.options.skipOp)).attr = !1 !== r.attr, r.markLinebreak = !0, File.option.enableInlineMath || (r.inline_math = !0), File.option.enableSubscript || (r.subscript = !0), File.option.enableSuperscript || (r.superscript = !0), File.option.enableHighlight || (r.highlight = !0);
            var l, h, f, p, m,
                g = (o = o || {cursorDiff: [], openQuote: null, hasContent: !1}).isCur || File.shouldRemapPunctuation(),
                v = o.cursorDiff || [], y = 0, b = [], w = this.options, C = t == s.decorate;

            function x(e, t) {
                var n = e.last();
                n && n.type === a.plain ? n.text += t : e.push({type: a.plain, text: t})
            }

            function k(e, t, n) {
                for (var i = t; i < e.length; i++) if (e[i].name == n && e[i].pos < 0) return i;
                return 0
            }

            function S(e) {
                for (var n = "", i = 0; i < e.length; i++) {
                    var r = e[i], o = d.INLINE_TYPE.indexOf(r.name) > -1, s = d.HIDDEN_TYPE.indexOf(r.name) > -1;
                    if (C && r.type == a.tag && r.pos > 0 && r.name && (o || s)) {
                        var l = r.name || "", c = k(e, i + 1, l);
                        if (c > 0) {
                            n += t({
                                type: a.html_inline,
                                inner: S(e.subarray(i + 1, c)),
                                name: l.toLowerCase(),
                                before: r.text,
                                after: e[c].text,
                                isMeta: !o
                            }, w), i = c;
                            continue
                        }
                    }
                    n += t(r, w)
                }
                return n
            }

            for (e.length > 3e4 && (n = !0, x(b, e), e = ""), n || (e = function (e, t) {
                for (var n, i = /([a-z0-9])_([a-z0-9])/gi; n = i.exec(e);) e = e.substring(0, n.index + 1) + ce.UNDER_CHAR + e.substring(n.index + 2), i.lastIndex && i.lastIndex--;
                return e = e.replace(/\\[\*_=\]\\]/gi, function (e) {
                    return he[e] || e
                }), t && e.length < 2e4 && (e = e.replace(/((?:(https?:\/\/([a-z0-9]|\/|\.\.\/|([-+.,!\/~?%&=:#\uE006_](?![\s.~*-,_]|$)))+)|((mailto:\/{0,2})?[a-z0-9][a-z0-9\-_+\.\uE006]*(@)[a-z0-9](?:[a-z0-9\-_\uE006]{0,15}\.?){0,2}\.(com|co|net|org|edu|io|tv|fm|me|info|cc|ca|de|cn|ru))|(www\.[a-z0-9][a-z0-9\-_\uE006]*(\.[a-z0-9\-_\uE006]+)+\/?(\/|\.\.\/|[a-z0-9]|([-@+.,!\/~?%&=:#\uE006_](?![\s.~*-,_]|$)))*)))/gi, ce.URL_START + "$1" + ce.URL_END)), e
            }(e, !r.url)); e;) if (r.markLinebreak && (f = /^\r?\n/.exec(e))) y += f[0].length, e = e.substring(f[0].length), b.push({
                type: e || r.emptyline ? a.softbreak : a.emptyline,
                text: "\n",
                inner: "\n"
            }); else if (f = this.rules.escape2.exec(e)) y += f[0].length, e = e.substring(f[0].length), b.push({
                type: a.escape,
                text: de[f[0]]
            }), o.hasContent = !0; else if (f = this.rules.escape.exec(e)) y += f[0].length, e = e.substring(f[0].length), b.push({
                type: a.escape,
                text: f[1]
            }), o.hasContent = !0; else if (r.autolink || !(f = this.rules.autolink.exec(e))) if (r.url || !(f = this.rules.url.exec(e))) if (f = (g ? this.rules.comment_ext : this.rules.comment).exec(e)) y += f[0].length, e = e.substring(f[0].length), l = f[0], g && (l = l.replace(/[\u2013\u2014]/g, "--"), v[y] = l.length - f[0].length), b.push({
                type: r.comment ? a.tag : a.comment,
                text: l
            }); else if (f = this.rules.br.exec(e)) y += f[0].length, e = e.substring(f[0].length), b.push({
                type: "br",
                text: f[0]
            }); else if (f = (File.shouldRemapPunctuation() ? this.rules.tag_ext : this.rules.tag).exec(e)) {
                var E;
                if (!r.underline && (E = this.rules.underline.exec(e))) {
                    y += E[0].length, e = e.substring(E[0].length), b.push({
                        type: a.underline,
                        inner: this.output(fe(E[1]), t, !0, r),
                        text: E[0]
                    }), o.hasContent = !0;
                    continue
                }
                if (!r.imgtag && (E = this.rules.imgtag.exec(e))) {
                    var F = E[0];
                    g && (F = F.replace(/(\w=)[«»“”„‟〝〟]/g, '$1"').replace(/(\w=)[‚‘’‛‹›]/g, "$1'").replace(/[»«”“〞]([\s\/>]|$)/g, '"$1').replace(/[’‛‘›‹＇]([\s\/>]|$)/g, "'$1"));
                    var _ = (/src\s*=\s*(['"])((.|\n)*?)\1/.exec(F) || [])[2];
                    if (_ || (_ = (/src\s*=\s*([^\s'"]+)(\s|$)/.exec(F) || [])[1]), _) {
                        y += E[0].length, e = e.substring(E[0].length);
                        var T = (/\sstyle=(['"])(.+?)\1/.exec(F) || [])[2] || "",
                            M = (/(^|[^\w-])width\s*:\s*(.+?)(\s*;|$)/.exec(T) || [])[2],
                            A = (/(^|[^\w-])height*:\s*(.+?)(\s*;|$)/.exec(T) || [])[2],
                            N = (/(^|[^\w-])zoom*:\s*(.+?)(\s*;|$)/.exec(T) || [])[2];
                        M || (M = (/\swidth=(['"])(.+?)\1/.exec(F) || /\swidth=((.+?))[\s/>]/.exec(F) || [])[2], /\d\s*$/.exec(M || "") && (M += "px;")), A || (A = (/\sheight=(['"])(.+?)\1/.exec(F) || /\sheight=((.+?))[\s/>]/.exec(F) || [])[2], /\d\s*$/.exec(A || "") && (M += "px;")), b.push({
                            type: a.imgtag,
                            text: F,
                            href: fe(_),
                            width: M,
                            height: A,
                            zoom: N
                        })
                    } else y += f[0].length, e = e.substring(f[0].length), l = f[0].replace(/(\w=)[«»“”„‟〝〟]/g, '$1"').replace(/(\w=)[‚‘’‛‹›]/g, "$1'").replace(/[»«”“〞]([\s\/>]|$)/g, '"$1').replace(/[’‛‘›‹＇]([\s\/>]|$)/g, "'$1"), b.push({
                        type: a.tag,
                        text: fe(l)
                    });
                    o.hasContent = !0;
                    continue
                }
                if (y += f[0].length, e = e.substring(f[0].length), l = f[0].replace(/(\w=)[«»“”„‟〝〟]/g, '$1"').replace(/(\w=)[‚‘’‛‹›]/g, "$1'").replace(/[»«”“〞]([\s\/>]|$)/g, '"$1').replace(/[’‛‘›‹＇]([\s\/>]|$)/g, "'$1"), "ruby" == (m = {
                    type: a.tag,
                    pos: f[3] ? -1 : "/" == f[2] ? 0 : 1,
                    name: (f[1] || f[4] || "").toLowerCase()
                }).name && m.pos > 0 && C && (f = /<\/ruby>/.exec(e))) {
                    var L = f.index + f[0].length;
                    y += L, l += e.substring(0, L), e = e.substring(L), m = {type: a.ruby, text: fe(l)}
                } else m.text = fe(l);
                b.push(m), o.hasContent = o.hasContent || -1 == d.NO_TEXT_BLOCK_TYPE.indexOf(m.name)
            } else {
                if (o.hasContent = !0, !r.link && (f = (g ? this.rules.link_ext : this.rules.link).exec(e))) {
                    var R = f[0];
                    if (p = f[0].length, g && (R = R.replace(/[‘’‚‛‹›]/g, "'").replace(/[«»“”„‟]/g, '"').replace(/\u3010/g, "[").replace(/\u3011/g, "]"), R = "[" + f[1] + "]" + R.substring(f[1].length + 2), f = this.rules.link.exec(R)), f) {
                        y += p, e = e.substring(p), b.push({
                            type: "link",
                            href: fe(f[2]),
                            title: f[5],
                            markdown: R,
                            text: f[1] || "",
                            inner: f[1] ? this.output(f[1], t, !0, le.skipLink, o) : "",
                            meta: fe(R.substring(f[1].length + 2))
                        });
                        continue
                    }
                }
                if (!r.image) {
                    if (!g && (f = this.rules.image.exec(e))) {
                        y += f[0].length, e = e.substring(f[0].length), b.push({
                            type: "image",
                            href: fe(f[4]),
                            title: f[5],
                            markdown: f[0],
                            components: [f[1], f[3], f[8]],
                            alt: f[2],
                            onlychild: !e && !b.length
                        });
                        continue
                    }
                    if (g && (f = this.rules.image_ext.exec(e))) {
                        p = f[0].length;
                        var D = f[0].replace(/\u3010/g, "[").replace(/\u3011/g, "]").replace(/\uff08/g, "(").replace(/\uff09/g, ")").replace(/[«»“”„‟]/g, '"').replace(/[‘’‚‛‹›]/g, "'");
                        if (f = this.rules.image.exec(D)) {
                            y += p, e = e.substring(p), b.push({
                                type: "image",
                                href: fe(f[4]),
                                title: f[5],
                                markdown: f[0],
                                components: [f[1], f[3], f[8]],
                                alt: f[2],
                                onlychild: !e && !b.length
                            });
                            continue
                        }
                    }
                }
                if (!r.footnote && y && (f = this.rules.footnote.exec(e))) {
                    y += f[0].length, e = e.substring(f[0].length);
                    var O = (f[2] || f[1]).replace(/\s+/g, " ");
                    b.push({type: a.footnote, inner: this.output(f[1], t, !0, le.skipLink), text: fe(f[1])})
                } else if (!(f = this.rules.reflink.exec(e)) || r.reflink && !f[1]) if (r.attr || !(f = (g ? this.rules.attr_ext : this.rules.attr).exec(e))) if (f = this.rules.strong.exec(e)) y += f[0].length, e = e.substring(f[0].length), b.push({
                    type: a.strong,
                    pattern: f[1],
                    inner: this.output(f[2], t, !0, r, o),
                    text: f[2]
                }); else if (f = this.rules.em1.exec(e)) y += f[0].length, e = e.substring(f[0].length), b.push({
                    type: a.em,
                    pattern: f[1],
                    inner: this.output(f[2], t, !0),
                    text: f[2]
                }); else if (f = this.rules.em2.exec(e)) {
                    var I = (f[2] + f[3].substring(1, 3)).match(/\s\*(?!\*)/);
                    if (I) {
                        y += I.index + 1, e = e.substring(I.index + 1), x(b, f[0].substr(0, I.index + 1));
                        continue
                    }
                    if ("***" === f[3] && !f[2].match(/\*\*/)) {
                        y += f[0].length - 2, e = e.substring(f[0].length - 2), b.push({
                            type: a.em,
                            pattern: f[1],
                            inner: this.output(f[2], t, !0),
                            text: f[2]
                        });
                        continue
                    }
                    y += f[0].length, e = e.substring(f[0].length), b.push({
                        type: a.em,
                        pattern: f[1],
                        inner: this.output(f[2] + f[3].substring(1, 3), t, !0),
                        text: f[2] + f[3].substring(1, 3)
                    })
                } else if (f = this.rules.code.exec(e)) y += f[0].length, e = e.substring(f[0].length), b.push({
                    type: a.code,
                    pattern: f[1],
                    text: f[2]
                }); else if (f = this.rules.del.exec(e)) y += f[0].length, e = e.substring(f[0].length), b.push({
                    type: a.del,
                    pattern: "~~",
                    inner: this.output(f[1], t, !0),
                    text: f[1]
                }); else if ((f = this.rules.emoji.exec(e)) && c.data[f[2] = f[2].replace(/\uE006/g, "_")]) e = e.substring(f[0].length), b.push({
                    type: a.emoji,
                    text: f[2],
                    inner: c.data[f[2]]
                }), !f[1].length && (v[y] = 1), y += f[0].length, !f[3].length && (v[y] = 1); else {
                    if (!r.subscript && (f = this.rules.subscript.exec(e))) {
                        y += f[0].length, e = e.substring(f[0].length);
                        var P = [];
                        (f = f[1].split(/\\\s/g))[0] && P.push({type: a.plain, text: f[0]});
                        for (var B = 1; B < f.length; B++) P.push({
                            type: a.escape,
                            text: " "
                        }), f[B] && P.push({type: a.plain, text: f[B]});
                        b.push({type: a.subscript, inner: S(P), text: f[0]})
                    }
                    if (!r.superscript && (f = this.rules.superscript.exec(e))) {
                        y += f[0].length, e = e.substring(f[0].length);
                        P = [];
                        (f = f[1].split(/\\\s/g))[0] && P.push({type: a.plain, text: f[0]});
                        for (B = 1; B < f.length; B++) P.push({
                            type: a.escape,
                            text: " "
                        }), f[B] && P.push({type: a.plain, text: f[B]});
                        b.push({type: a.superscript, inner: S(P), text: f[0]})
                    }
                    if (r.inline_math || !(f = this.rules.inline_math.exec(e))) if (r.highlight || !(f = this.rules.highlight.exec(e))) if (f = this.rules.entity.exec(e)) y += f[0].length, e = e.substring(f[0].length), i.decodeHtmlEntity(f[0]) ? b.push({
                        type: a.html_entity,
                        inner: f[0],
                        text: f[0]
                    }) : x(b, f[0] || ""); else {
                        if (File.option.convertSmartOnRender && File.option.smartDash) {
                            if (f = /^(---)($|[^-])/.exec(e)) {
                                y += f[1].length, e = e.substring(f[1].length), b.push({
                                    type: a.pants,
                                    inner: "—",
                                    desc: "em_dash",
                                    meta: "--",
                                    text: "---"
                                });
                                continue
                            }
                            if (f = /^--/.exec(e)) {
                                e = e.substring(f[0].length), y += f[0].length, b.push({
                                    type: a.pants,
                                    inner: "–",
                                    desc: "en_dash",
                                    meta: "-",
                                    text: "--"
                                });
                                continue
                            }
                            if (f = /^\.{3}/.exec(e)) {
                                y += f[0].length, "." !== (e = e.substring(f[0].length))[4] ? b.push({
                                    type: a.pants,
                                    inner: "…",
                                    desc: "ellipsis",
                                    meta: "..",
                                    text: "..."
                                }) : x(b, f[0]);
                                continue
                            }
                        }
                        if (File.option.convertSmartOnRender && File.option.smartQuote) {
                            var $, H;
                            if ('"' == e[0]) {
                                if (H = ($ = ae(b) || "")[$.length - 1] || "", /(^|[\(\{\[\s\-/\u2018])$/.exec($) || H == u.userQuote(2)) {
                                    y++, e = e.substring(1), b.push({
                                        type: a.pants,
                                        inner: u.userQuote(0),
                                        desc: "open_double_quote",
                                        text: '"'
                                    });
                                    continue
                                }
                                if (f = /^"($|[\)\s/.,;:?!\u2019])/.exec(e)) {
                                    y++, e = e.substring(1), b.push({
                                        type: a.pants,
                                        inner: u.userQuote(1),
                                        desc: "close_double_quote",
                                        text: '"'
                                    });
                                    continue
                                }
                                if (pe(b)) {
                                    y++, e = e.substring(1), b.push({
                                        type: a.pants,
                                        inner: u.userQuote(1),
                                        desc: "close_double_quote",
                                        text: '"'
                                    });
                                    continue
                                }
                                y++, e = e.substring(1), b.push({
                                    type: a.pants,
                                    inner: u.userQuote(0),
                                    desc: "open_double_quote",
                                    text: '"'
                                });
                                continue
                            }
                            if ("'" == e[0]) {
                                if (o.openQuote && (f = /^'($|[\)\s".,;:?!-])/.exec(e))) {
                                    y++, e = e.substring(1), b.push({
                                        type: a.pants,
                                        inner: u.userQuote(3),
                                        desc: "close_single",
                                        text: "'"
                                    }), o.openQuote.inner = u.userQuote(2), o.openQuote.desc = "open_single", o.openQuote = null;
                                    continue
                                }
                                if ($ = ae(b) || "", e.length <= 1 && /((^|[\s])$)/.exec($)) {
                                    y += e.length, x(b, e), e = "";
                                    continue
                                }
                                y++, e = e.substring(1), b.push({
                                    type: a.pants,
                                    inner: "’" == u.userQuote(3) ? "’" : "'",
                                    desc: "close_single",
                                    text: "'"
                                }), /(^|[\(\s"-])$/.exec($) && (o.openQuote = b.last());
                                continue
                            }
                        }
                        if (f = this.rules.tab.exec(e)) y += f[0].length, e = e.substring(f[0].length), b.push({
                            type: a.tab,
                            inner: f[0],
                            text: f[0]
                        }); else if (f = this.rules.text.exec(e)) y += f[0].length, "\n" == (e = e.substring(f[0].length))[0] && this.rules.linebreak.exec(f[0] || "") ? (y++, e = e.substring(1), x(b, f[0].replace(this.rules.linebreak, "")), b.push({
                            type: a.linebreak,
                            text: "  \n",
                            isLast: !e
                        })) : x(b, f[0] || ""); else if (e) throw new Error("Infinite loop on byte: " + e.charCodeAt(0))
                    } else y += f[0].length, e = e.substring(f[0].length), b.push({
                        type: a.highlight,
                        inner: this.output(f[2], t, !0),
                        text: f[2]
                    }); else {
                        var U = null, j = 0, W = "", q = null, z = /\$/, V = "$";
                        for (/^\$\$/.exec(f[0]) ? (U = /{|}|\$\$/g, V = "$$") : (U = /{|}|\$/g, V = "$"), U.exec(f[0]); q = U.exec(f[0]);) {
                            if (z.exec(q[0]) && j <= 0 && "\\" != f[0].substring(q.index - 1, q.index)) {
                                W = f[0].substring(0, q.index + q[0].length);
                                break
                            }
                            "{" === q[0] ? "\\" === q.input[q.index - 1] && "\\" !== !q.input[q.index - 2] || j++ : "}" === q[0] && ("\\" === q.input[q.index - 1] && "\\" !== !q.input[q.index - 2] || j--)
                        }
                        if (W.length - 2 * V.length > 0 && /[^\s$]/.exec(W)) {
                            var K = W.indexOf("​");
                            K > -1 && (v[y + K] = -1), y += W.length, e = e.substring(W.length), b.push({
                                type: "inline_math",
                                text: fe(W),
                                pattern: V
                            });
                            continue
                        }
                        y += f[0].length, e = e.substring(f[0].length), x(b, f[0] || "")
                    }
                } else {
                    y += f[0].length, e = e.substring(f[0].length);
                    var Y = f[0];
                    g && (Y = Y.replace(/[‘’‚‛‹›]/g, "'").replace(/[«»“”„‟]/g, '"')), b.push({type: a.attr, text: f[0]})
                } else {
                    y += f[0].length, e = e.substring(f[0].length);
                    O = (f[3] || "").replace(/\s+/g, " ");
                    b.push({
                        type: f[1] ? "refimg" : "reflink",
                        ref: fe(O),
                        inner: this.output(f[2], t, !0, le.skipLink),
                        text: fe(f[2]),
                        markdown: f[0],
                        onlychild: !e && !b.length
                    })
                }
            } else e = e.substring(f[0].length), y += f[1].length, h = l = f[1], null === /^\w+:\/\//.exec(l) && /@/.exec(l) && (h = "mailto:" + h), b.push({
                type: a.url,
                href: fe(h),
                text: l
            }), o.hasContent = !0; else y += f[0].length, e = e.substring(f[0].length), "", l = f[1], h = "@" === f[4] ? ":" === f[1].charAt(6) ? l : "mailto:" + f[1] : l, b.push({
                type: a.autolink,
                href: fe(h),
                text: l
            }), o.hasContent = !0;
            var Q = S(b);
            return n || (Q = fe(Q)), Q
        }, le.prototype.mangle = function (e) {
            for (var t, n = "", i = e.length, r = 0; r < i; r++) t = e.charCodeAt(r), Math.random() > .5 && (t = "x" + t.toString(16)), n += "&#" + t + ";";
            return n
        };

        function me(e, t) {
            return e = e.source, t = t || "", function n(i, r) {
                return i ? (r = (r = r.source || r).replace(/(^|[^\[])\^/g, "$1"), e = e.replace(i, r), n) : new RegExp(e, t)
            }
        }

        function ge() {
        }

        ge.exec = ge;

        function ve(e) {
            for (var t, n, i = 1; i < arguments.length; i++) {
                t = arguments[i];
                for (n in t) Object.prototype.hasOwnProperty.call(t, n) && (e[n] = t[n])
            }
            return e
        }

        var ye = /^( *)[*+-][ \t\u00A0]+(\[(x|X)\]|\[ \]) +/, be = /^( *)[*+-][ \t\u00A0]+/,
            we = /^( *)\d+\.[ \t\u00A0]+/, Ce = function () {
                return File.shouldRemapPunctuation() ? /^ *[>〉》][^\n]+/ : /^ *>[^\n]+/
            };
        var xe = /^( *#{1,6}\s*)([^\n]+?)(\s+#+ *)*$/m, ke = /^( *#{1,6}\s+)([^\n]+?)(\s+#+ *)*$/m;

        function Se(e, t, n, i, r, s) {
            var l = [], c = "", d = d || {cursorDiff: r};
            i && i.cid == File.editor.focusCid && (d.isCur = !0);

            function u(e, n, r) {
                var s = [];
                return s[0] = e.substr(0, n.index), s[1] = e.substr(n.index, n[0].length), s[2] = e.substr(n.index + n[0].length), s.map(function (e, n) {
                    return 1 == n ? t.options.decorate(r) : e ? t.options.decorate({
                        type: a.paragraph,
                        inner: t.output(e, null, null, {attr: !o.isType(i, a.heading), emptyline: 2 != n}, d)
                    }) : ""
                }).join("")
            }

            for (; e;) {
                if (!n && /^\s*[-+*_<\[\{|#0-9`~=>$]/m.exec(e)) {
                    if (l = /^ *>[^\n]+/m.exec(e)) {
                        c = u(e, l, {
                            type: a.blockquote,
                            pattern: l[0].match(/^( *> ?)+/gm)[0],
                            inner: Se(l[0].replace(/^( *> ?)+/gm, ""), t, !0, i, r)
                        });
                        break
                    }
                    if (l = (File.option.strictMarkdown ? ke : xe).exec(e)) {
                        var h = "h" + l[0].match(/#/g).length;
                        s.push(h), c = u(e, l, {
                            type: a.heading,
                            meta_before: l[0].substring(0, l[1].length),
                            meta_after: l[3] || "",
                            mdlike: h,
                            inner: t.output(l[2], null, null, {attr: !1}, d)
                        });
                        break
                    }
                    if (l = /^( *(`{3,}|~{3,}|·{3,})[ \t\u00A0]*)([^\n`]+)? *$/m.exec(e)) {
                        c = u(e, l, {type: a.fences, lang: l[3], pattern: l[1]});
                        break
                    }
                    if (l = /^\s*\[\^([^\]\n]+)\]:\s*([^\n]*)$/m.exec(e)) {
                        c = u(e, l, {
                            type: a.def_footnote,
                            ref: l[1],
                            inner: t.output(l[2] || "", null, null, null, d)
                        });
                        break
                    }
                    if (l = /^\s*\[([^\]\n]+)\]:\s+([^\n]*)/m.exec(e)) {
                        c = u(e, l, {type: a.def_link, ref: l[1], inner: t.output(l[2] || "", null, null, null, d)});
                        break
                    }
                    if (l = /^(\s*)(([-+*]|\d+\.)\s+)/m.exec(e)) {
                        c = u(e, l, {type: "block", inner: t.output(l[0] || "", null, null, null, d)});
                        break
                    }
                    if (l = /^\s*(\$\$|\[toc\])\s*$/im.exec(e)) {
                        c = u(e, l, {type: "block", inner: t.output(l[0] || "", null, null, null, d)});
                        break
                    }
                    if (l = /^\s*([-+_*])\s*\1\s*\1(\s|\1)*$/m.exec(e)) {
                        c = u(e, l, {type: "block", inner: t.output(l[0] || "", null, null, null, d)});
                        break
                    }
                    if (l = /^ *\|([^\|]+\|.+)\|\s*$/m.exec(e)) {
                        c = u(e, l, {type: "block", inner: t.output(l[0] || "", null, null, null, d)});
                        break
                    }
                }
                c = t.options.decorate({
                    type: a.paragraph,
                    inner: t.output(e, null, null, {attr: !o.isType(i, a.heading)}, d)
                });
                break
            }
            return c
        }

        var Ee, Fe = {};
        Fe.options = Fe.setOptions = function (e) {
            return ve(Fe.defaults, e), Fe
        }, Fe.defaults = {
            gfm: !0,
            tables: !0,
            breaks: !1,
            pedantic: !1,
            sanitize: !1,
            smartLists: !1,
            silent: !1,
            highlight: null,
            langPrefix: "lang-",
            smartypants: !1,
            headerPrefix: ""
        }, Fe.parseInline = function (e, t, n) {
            return Ee || (Ee = new le), Ee.output(e, null, null, t, {cursorDiff: n})
        }, Fe.parsePandocAttr = function (e) {
            var t = {};
            return e && "{" == e[0] && "}" == e[e.length - 1] ? (((e = e.replace(/(^{)|(}$)/g, "")).split(/\s+/) || [e]).forEach(function (e) {
                var n;
                (n = /^#(.+)/.exec(e)) ? t.id = i.escapeInQuote(n[1]) : (n = /^\.(.+)/.exec(e)) ? t.class = (t.class || "") + " " + i.escapeInQuote(n[1]) : (n = /^(.+)=(['"])([^'"]+)\2/.exec(e)) && (t.attr = (t.attr || "") + " " + e, t.nativeAttr = t.nativeAttr || {}, t.nativeAttr[n[1]] = n[3])
            }), t) : t
        }, Fe.attrToString = function (e) {
            var t = "";
            return e.id && (t += " id='" + e.id + "'"), e.class && (t += " class='" + e.class.trim() + "'"), e.attr && (t += e.attr), t
        }, Fe.InlineLexer = le, Fe.quickParse = function e(t, n, r, s, c, d) {
            var u, h = 0, f = r, p = [];
            c = c || !s && l.makeEmptyCommand();

            function m(e, t, n) {
                return new o({type: n || a.paragraph, text: e, parent: t, in: t.get("in")})
            }

            function g(e, i, r, s) {
                r.cid == n.editor.focusCid && n.editor.store(), n.editor.undo.completeSnap(!0), i.undo.push(l.buildReplaceUndo(r));
                var c = null;
                return s && s.start ? (h = h - s.start + e.length, c = r.insert(new o({
                    type: a.paragraph,
                    text: t.substring(0, s.start - 1)
                }), !0), l.addUndoForInsert(i, c)) : h += e.length, t = t.substring((s ? s.start : 0) + e.length), c
            }

            function v(i, r, o, a, s) {
                return a = a || e(t, n, i, !1, r, d), r.redo.push(l.buildReplaceUndo(o)), {
                    html: (s ? s.toHTML() : "") + o.toHTML(a.html),
                    offset: h + a.offset,
                    focus: a.focus,
                    blockChanged: !0,
                    command: r,
                    splits: void 0
                }
            }

            function y(i, s, c, d) {
                var u, h, p, y = File.option.indentSize, b = g(i = i.replace("【", "[").replace("】", "]"), s, r, d);
                if (r.set("type", a.list), r.set("text", ""), r.set("style", c), (h = m("", r, a.list_item)).set("checked", null != /x|X/g.exec(d.line)), i.indexOf("[") > -1 && h.set("style", o.ListType.task), c == o.ListType.ul && (File.option.prettyIndent ? r.set("pattern", i.replace(/\[[xX\s]\]\s+/, "").trim() + " ".repeat(y - 1)) : r.set("pattern", i.replace(/\[[xX\s]\]\s+/, "").trim() + " ")), c == o.ListType.ol) {
                    var w = i.match(/\d+/)[0].replace(/^1$/, "");
                    "" != w ? r.set("start", w) : r.unset("start")
                }
                if (i && File.option.autoPairExtendSymbol && /\*\s$/.exec(i) && (t = t.replace(/^\*/, "")), f = m(t, h, a.paragraph), (p = e(t, n, f, !1)).html = h.toHTML(p.html), u = v(null, s, r, p, b), !b) return u;
                var C = (r = u.splits && u.splits[1] || r).get("before"), x = r.get("after");
                return u.splits && !u.splits[0] && o.isType(C, a.list) && C.get("style") == r.get("style") && (u.replaceCid = C.cid, u.toRemove = [r.cid], s.undo.push(l.buildReplaceUndo(C)), l.addUndoForRemove(s, r), C.appendTillEnd(r.getFirstChild()), C.getFirstChild().unset("tail"), C.getFirstChild().getLastChild().unset("tail"), r.remove(), o.isType(x, a.list) && x.get("style") == x.get("style") && (u.toRemove.push(x.cid), l.addUndoForRemove(s, x), C.appendTillEnd(x.getFirstChild()), C.getFirstChild().unset("tail"), C.getFirstChild().getLastChild().unset("tail"), x.remove()), s.redo.push(l.buildReplaceUndo(C)), u.html = C.toHTML(), u.splits[2] && (u.html += u.splits[2].toHTML())), u
            }

            if (File.option.strictMarkdown && (ye = File.shouldRemapPunctuation() ? /^( {0,3})[*+-][ \t\u00A0]+([\[【](x|X)[\]】]|[\[【] [\]】]) +/ : /^( {0,3})[*+-][ \t\u00A0]+(\[(x|X)\]|\[ \]) +/, be = /^( {0,3})[*+-][ \t\u00A0]+/, we = /^( {0,3})\d+\.[ \t\u00A0]+/), !(s = s || !d || d.endId != r.cid)) {
                var b = i.findLine(t, d.end);
                if (Ce().exec(b.line)) return function (e, n) {
                    var i = g(n.line.match(/^ *[>〉》][ \u00A0]?/)[0], e, r, n);
                    return r.set("type", a.blockquote), r.set("text", ""), f = m(t, r), e.redo.push(l.buildReplaceUndo(r)), v(f, e, r, void 0, i)
                }(c, b);
                if (u = ye.exec(b.line)) return y(u[0], c, o.ListType.ul, b);
                if (u = be.exec(b.line)) return y(u[0], c, o.ListType.ul, b);
                if (u = we.exec(b.line)) return y(u[0], c, o.ListType.ol, b);
                if (u = function (e, t) {
                    var n = e.get("parent");
                    return o.isType(e, a.paragraph) && !e.get("before") && o.isType(n, a.list_item) && n.get("style") !== o.ListType.task && n.get("parent").get("style") == o.ListType.ul && (File.shouldRemapPunctuation() ? /(^ *[\[【](x|X)[\]】]( |\t)+)|((^ *[\[【] [\]】]) +)/g : /(^ *\[(x|X)\]( |\t)+)|((^ *\[ \]) +)/g).exec(t)
                }(r, t)) return function (i, a) {
                    var s, l, c = r.get("parent");
                    return g(i, a, c), c.set("style", o.ListType.task), c.set("checked", null != /x|X/g.exec(i)), r.set("text", t), (l = e(t, n, f = r, !0, a)).html = void 0, (s = v(null, a, c, l)).replaceCid = c.cid, s
                }(u[0], c)
            }
            var w = [], C = {
                innerHtml: Se(t, n.inline, o.isType(r, a.heading), r, p, w),
                offset: 0,
                focus: r.cid,
                blockChanged: !1,
                command: c,
                cursorDiff: p,
                mdlike: w[0]
            };
            return C.html = r && r.toHTML(C.innerHtml, w[0]), C
        }, Fe.reDefLink = O, Fe.reDefFootnote = I, Fe.renderHtmlWithBlockMeta = function e(t, n) {
            if (o.isType(t, a.paragraph)) {
                var i = [], r = Se(t.safeGetStrAttr("text"), n.inline, !1, t, [], i);
                return t.toHTML(r, i[0])
            }
            if (t.get("children").length) {
                for (var s = t.getFirstChild(), l = []; s;) l.push(e(s, n)), s = s.get("after");
                return t.toHTML(l.join(""))
            }
            return t.toHTML()
        }, Fe.splitTableCell = ie, Fe.recoverEscape = fe, n.exports = Fe
    }), $__System.registerDynamic("2b", ["11", "13", "12", "1a", "1b", "18", "41"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i = e("11"), r = e("13"), o = e("12"), a = e("1a"), s = (a.SnapFlag, o.Node), l = o.TYPE,
            c = (o.NodeCollectionUtils, e("1b")), d = e("18"), u = e("41"), h = function () {
                return File.isMac ? app.clipboard.paste() : File.isNode ? reqnode("electron").remote.clipboard.readText() : ""
            };

        function f(e) {
            if (e.get("style") == s.ListType.ol) return s.ListType.ol;
            var t = !1;
            return e.get("children").map(function (e) {
                t = t || e.get("style") !== s.ListType.task
            }), t ? s.ListType.ul : s.ListType.task
        }

        var p = function (e, t, n, i, r) {
            var o = c.createRange();

            function a(e) {
                var i;
                i = e.attr("md-inline") == t ? e.children(".md-meta:not(.md-content)") : e.find('[md-inline="' + t + '"]').children(".md-meta:not(.md-content)"), n && (n.end -= i.text().length), i.remove(), e.attr("md-inline") == t && n && (n.end = n.start + e.text().length)
            }

            if (e[0].hasAttribute("mdtype") && (e.wrapInner("<span></span>"), e = $(e[0].firstChild)), n ? (n.containerNode = e[0], o.moveToBookmark(n)) : o.selectNode(e[0]), o.commonAncestorContainer.nodeType == document.ELEMENT_NODE && o.commonAncestorContainer.getAttribute("md-inline") == t) a($(o.commonAncestorContainer)); else {
                for (var s = document.createElement("SPAN"), l = o.extractContents(), d = 0; d < l.childNodes.length; d++) s.appendChild(l.childNodes[d].cloneNode(!0));
                a($(s)), s.childNodes.length != s.childElementCount || 1 != s.childNodes.length || s.childNodes[0].getAttribute("md-inline") || (s = s.childNodes[0]), o.insertNode(s), o.setStart(s, 0), o.setEnd(s, s.childNodes.length)
            }
            return r || m.call(this, o, t, e[0], i ? n : null), this.editor.brush.addToQueue(e.attr("cid")), o
        }, m = function (e, t, n, i) {
            if (s.isType(t, l.link, l.image)) g.call(this, e, t, n, i); else if (e.commonAncestorContainer == e.startContainer && e.startContainer == e.endContainer) {
                var r = function (e) {
                    var t, n = [], i = 0, r = e.commonAncestorContainer;
                    if (!r.childElementCount) return [e];

                    function o() {
                        if (t != i && 0 != t) {
                            var e = c.createRange();
                            e.setStart(r.children[i], 0), e.setEndAfter(r.children[t - 1]), n.push(e)
                        }
                    }

                    for (t = 0; t < r.childElementCount; t++) r.children[t].classList.contains("md-softbreak") && (o(), i = t + 1);
                    return i < t && o(), n
                }(e), o = r.length > 1, a = this;
                r.forEach(function (e, s) {
                    var l = g.call(a, e, t, n, s == r.length - 1 ? i : void 0, o);
                    i && l && (i instanceof Object ? i.end += l : i += l)
                })
            } else g.call(this, e, t, n, i)
        }, g = function (e, t, n, i, o) {
            var a, c, d, u, f, p, m = b.SyntaxMap[t];
            if (i) {
                var g, v = this.editor.getJQueryElem(e.startContainer), y = this.editor.getJQueryElem(e.endContainer);
                if (v.closest("md-before").length || v.closest("md-content").length ? (e.setStartBefore(v.closest("[md-inline]")[0]), g = !0) : v.closest("md-meta").length && (e.setStartAfter(v.closest("[md-inline]")[0]), g = !0), y.closest("md-after").length || v.closest("md-content").length ? (e.setEndAfter(v.closest("[md-inline]")[0]), g = !0) : y.closest("md-meta").length && (e.setEndBefore(v.closest("[md-inline]")[0]), g = !0), a = e.toString(), e.collapsed || 0 === a.trim()) return;
                c = g ? c || e.getBookmark(n || e.commonAncestorContainer) : i instanceof Object ? i : {
                    start: i,
                    end: i
                }
            } else a = e.toString();
            return d = /^\s+/g.exec(a), u = /\s+$/g.exec(a), d = d ? d[0].length : 0, u = u ? u[0].length : 0, (d || u) && ((c = c || e.getBookmark(n || e.commonAncestorContainer)).start += d, c.end -= u, e.moveToBookmark(c)), f = m[1], (p = h()) && p.length > 5e3 && (p = ""), s.isType(t, l.link) ? r.isURL(a) ? f = "](" + a + ")" : r.isURL(p) && (f = "](" + p + ")") : s.isType(t, l.image) && (r.isImg(a) ? f = "](" + a + ")" : r.isImg(p) && (f = "](" + p + ")")), e.insertNodeAtEnd(document.createTextNode(f)), e.insertNode(document.createTextNode(m[0])), i && (s.isType(t, l.link) ? e.moveToBookmark({
                containerNode: n,
                start: c.start + 1,
                end: 1 + c.end
            }) : e.moveToBookmark({
                containerNode: n,
                start: c.start + (o ? 0 : m[0].length),
                end: c.end + m[0].length + (o ? m[1].length : 0)
            }), editor.selection.setRange(e, !0)), (m[0] || "").length + (m[1] || "").length
        };

        function v(e, t, n, i) {
            var r, o = t.closest('[md-inline="' + i + '"]');
            o.length || "link" != i || (o = t.closest('[md-inline="reflink"], [md-inline="autolink"]')), "image" == i && (o.length ? r = /!\[([^\]]*)\]/.exec(o.text())[1] : r || ((o = t.closest('[md-inline="refimg"]')).length ? r = /!\[((?:\[[^\]]*\]|[^\[\]]|\](?=[^\[]*\]))*)\]/.exec(o.text())[1] : (o = t.closest(".md-url").closest("[md-inline]")).length && (r = "!" + o.text()))), i == l.comment && (r = o.text().replace(/(^<\!--)|(-->)$/g, ""));
            var s = e.findNodeByElem(n);
            e.undo.snap(s.id, a.SnapFlag.REPLACE), r ? (o.text(r), e.selection.selectAllElem(o)) : (o.children(".md-meta, .md-content").remove(), e.brush.addToQueue(o.closest("[cid]").attr("cid"), !0))
        }

        var y = i.Model.extend({
            initialize: function (e) {
                this.editor = e, this.CONST = b, this.putBookmark(null, {block: []})
            }, removeStyle: function (e, t, n) {
                e.children(".md-meta").remove()
            }, canContainInline: function (e) {
                return e.jquery && (e = e.attr("mdtype")), s.isType(e, l.paragraph, l.def_footnote, l.heading, l.table_cell)
            }, putStyle: function (e, t, n) {
                this.editor.selection.deRange(e);
                var i, r = this.editor.getMarkElem(e.commonAncestorContainer), o = b.InsertInline.indexOf(t) > -1;
                if (o && (r = this.editor.getMarkElem(e.startContainer)), r.length && 0 === r.find("[mdtype]").length && this.canContainInline(r)) {
                    var l = a.makeEmptyCommand(this.editor.selection.buildUndo()), c = this.editor.store(r.attr("cid"));
                    l.undo.push(a.buildReplaceUndo(c)), i = n && this.hasStyleInRange(t, e, !0), (e = this.putStyleForRange(r, t, e, !0, i)).select(), this.editor.store(r.attr("cid")), l.redo.push(a.buildReplaceUndo(c)), l.redo.push(this.editor.selection.buildUndo()), this.editor.undo.register(l), this.editor.brush.addToQueue(c.id, !0)
                } else if (!o) return i = n && this.hasStyleInRange(t, e, !1), function (e, t, n) {
                    var i = this.editor;

                    function r(e) {
                        var o = e.get("children");
                        return o.length ? o.toArray().map(r) : i.stylize.canContainInline(e.get("type")) && i.findElemById(e.id).text().length && (i.stylize.putStyleInBlock(i.findElemById(e.id), t, void 0, void 0, !0, n), i.store(e), i.brush.addToQueue(e.id)), e
                    }

                    var o = i.selection.getDetailPos(e.startContainer, e.startOffset),
                        l = i.selection.getDetailPos(e.endContainer, e.endOffset), c = i.getMarkElem(o[0]),
                        d = i.getMarkElem(l[0]), u = i.findNodeByElem(c), h = i.findNodeByElem(d),
                        f = s.getTreePosition(u, h), p = f[1], m = f[2],
                        g = a.makeEmptyCommand(i.selection.buildUndo()), v = e.cloneRange(), y = e.cloneRange(), b = p;
                    for (g.undo.push(a.buildReplaceUndo(p)), y.setEndAfter(c[0]), this.canContainInline(u) && y.toString().length && (this.putStyleInBlock(c, t, y.getBookmark(c[0]), void 0, !0, n), i.store(u, !0)), i.UserOp.decorateOneSide(u, p, "after", r), g.redo.push(a.buildReplaceUndo(p)), i.brush.addToQueue(c.attr("cid")), b = p.get("after"); b && b !== m;) g.undo.push(a.buildReplaceUndo(b)), r(b), g.redo.push(a.buildReplaceUndo(b)), b = b.get("after");
                    h && h != p && (v.setStartBefore(d[0]), v.toString().length && (g.undo.push(a.buildReplaceUndo(m)), this.canContainInline(h) && (this.putStyleInBlock(d, t, v.getBookmark(d[0]), void 0, !0, n), i.store(h, !0)), i.UserOp.decorateOneSide(h, m, "before", r), g.redo.push(a.buildReplaceUndo(m)), i.brush.addToQueue(d.attr("cid")))), g.redo.push(i.selection.buildUndo()), i.undo.register(g), $(".md-expand").removeClass("md-expand")
                }.call(this, e, t, i)
            }, putStyleInBlock: function (e, t, n, i, r, o) {
                if (!r || 0 != e.text().length) {
                    e[0].hasAttribute("mdtype") && e.addClass("md-expand");
                    try {
                        return p.call(this, e, t, n, i, o)
                    } catch (e) {
                        console.error(e)
                    }
                }
            }, putStyleForRange: function (e, t, n, i, r) {
                var o = n.getBookmark(e[0]);
                return e[0].hasAttribute("mdtype") && n.commonAncestorContainer.nodeType != document.TEXT_NODE && e.addClass("md-expand"), p.call(this, e, t, o, i, r)
            }, addStyle: function (e, t) {
                var n, i = b.SyntaxMap[t], o = document.createElement("SPAN");
                o.className = "md-meta md-expand", o.setAttribute("md-inline", t), "link" == t && (n = h(), r.isURL(n) && (i[1] = "](" + n + ")")), o.appendChild(document.createTextNode(i[0] + i[1])), e.insertNode(o), e.moveToBookmark({
                    containerNode: o,
                    start: i[0].length,
                    end: i[0].length
                }), this.editor.selection.rangy.getSelection().setSingleRange(e)
            }, detach: function (e, t) {
                return !(!e.collapsed || !$.parseHTML("<div>" + e.toHtml() + "</div>")[0].querySelector('[md-inline="' + t + '"]')) || $(e.commonAncestorContainer).closest('[md-inline="' + t + '"]').length
            }, canToggleStyle: function (e, t, n) {
                var i = function (e) {
                    for (var t = 0; t < e.CONST.NoInline.length; t++) if (e.hasStyle(e.CONST.NoInline[t])) return !0
                }(this);
                return !!this.hasStyle(e) || !(i || /(md-meta|md-content)(\s+|$)/g.exec(t[0].className) && !n || /md-blockmeta/g.exec(t[0].className)) && !i
            }, clearStyle: function () {
                if (window.getSelection().rangeCount && !isInputComponent(document.activeElement) && !File.isLocked) {
                    this.editor.brush.clearAndPause(), this.editor.undo.completeSnap(!0);
                    var e = this.editor.selection.getRangy();
                    if (e) {
                        for (var t, n = a.makeEmptyCommand(editor.selection.buildUndo()), i = editor.selection.getDetailPos(e.startContainer, e.startOffset), r = editor.selection.getDetailPos(e.endContainer, e.endOffset), o = editor.getMarkElem(i[0]), l = editor.getMarkElem(r[0]), c = editor.findNodeByElem(o), d = editor.findNodeByElem(l), u = s.getTreePosition(c, d), h = u[1], f = u[2], p = h; p && p != f.get("after");) t = p, p = p.get("after"), n.undo.push(a.buildReplaceUndo(t)), this.editor.findElemById(t.id).find(".md-meta, .md-content").remove(), this.editor.store(t.id), this.editor.brush.addToQueue(t.id), n.redo.push(a.buildReplaceUndo(t));
                        this.editor.undo.register(n)
                    }
                    this.editor.brush.resume(), this.editor.brush.expand()
                }
            }, toggleStyle: function (e) {
                if (!File.isLocked && window.getSelection().rangeCount && "INPUT" != document.activeElement.tagName && "TEXTAREA" != document.activeElement.tagName && !File.isLocked) {
                    var t, n, i = this.editor.selection.getRangy(), r = this.hasStyle(e),
                        o = this.editor.getJQueryElem(i.commonAncestorContainer),
                        s = this.editor.getMarkElem(i.commonAncestorContainer);
                    if (this.editor.undo.completeSnap(!0), !r) {
                        var c = this.editor.getJQueryElem(i.startContainer);
                        "link" == e && (r = c.closest('[md-inline="reflink"], [md-inline="autolink"]').length), "image" == e && (r = c.closest('[md-inline="refimg"], .md-url').length)
                    }
                    this.editor.brush.pause();
                    do {
                        if (!this.canToggleStyle(e, o, i.collapsed)) break;
                        if (r) v(this.editor, o, s, e); else {
                            if (!i.collapsed) {
                                this.putStyle(i, e, !0);
                                break
                            }
                            if (!(n = this.editor.findNodeByElem(s))) return;
                            this.editor.undo.snap(n.id, a.SnapFlag.REPLACE), t = i.getBookmark(s[0]).start;
                            var d = s.text().substring(t - 1, t + 1),
                                u = "**" == d && $(i.startContainer).closest("[md-inline='plain']").length;
                            e == l.em && u ? (i.moveToBookmark({
                                containerNode: s[0],
                                start: t - 1,
                                end: t + 1
                            }), i.extractContents()) : !(f = d) || i.collapsed && /^[\(\)\[\]\^&_\-+*#@!~`\\\/\{\}'":;<>,.?%\s]+$/.exec(f) ? this.addStyle(i, e) : (s.addClass("md-expand"), u || e == l.image || this.editor.selection.selectWord(!0, !1, i), (i = this.editor.selection.getRangy()).collapsed ? this.addStyle(i, e) : m.call(this, i, e, s[0], t))
                        }
                        if (this.editor.brush.addToQueue(s.attr("cid")), e == l.inline_math && !r) {
                            var h = this.editor;
                            setTimeout(function () {
                                h.brush.triggerAutoComplete(!0)
                            }, 100)
                        }
                    } while (0);
                    var f;
                    this.editor.brush.resume(!0)
                }
            }, putBookmark: function (e, t) {
                return this.editor.styleBookmark = {cursor: e, style: t}
            }, isAtFootnoteDefSpan: function () {
                var e = this.editor.selection.getRangy();
                return e && this.editor.getJQueryElem(e.startContainer).closest(".md-def-name").length
            }, buildBookmark: function (e) {
                if (File.ignoreStyleChange) return File.editor.styleBookmark.style;
                var t, n = {inline: [], block: [], state: ""}, i = this.editor.selection.getRangy(),
                    r = (e = e || this.editor.getJQueryElem(i && i.commonAncestorContainer || document.activeElement) || $()).closest("[md-inline]"),
                    o = e;
                if (0 == e.length) {
                    if (!(e = this.editor.getMarkElem()).length || !s.isType(e.attr("mdtype"), s.TYPE.hr, s.TYPE.toc)) return n;
                    o = e
                }
                for (; r.length;) t = r.attr("md-inline"), this.CONST.LinkList.indexOf(t) > -1 && (t = "link"), n.inline.push(t), o = r, r = r.parent().closest("[md-inline]");
                for (r = o.closest("[mdtype], [mdlike]"); r.length;) (t = r.attr("mdlike") || r.attr("mdtype")) === l.heading ? n.block.push("header" + r[0].tagName.substring(1)) : t === l.list ? n.block.push(f(this.editor.findNodeByElem(r))) : t === l.list_item ? r.hasClass("md-task-list-item") && !n.state && (n.state = r.hasClass("task-list-done") ? "checked" : "unchecked") : (t = t.replace(/^h([1-6])$/, "header$1"), n.block.push(t)), r = r.parent().closest("[mdtype]");
                return n
            }, hasStyleInRange: function (e, t, n) {
                var i = t.toHtml();
                return n && (i = "<div>" + i + "</div>"), 0 == $(i).find("[md-inline='" + e + "']").remove().end().text().trim().length
            }, hasStyle: function (e) {
                var t = this.editor.styleBookmark.style;
                if (t) return (t.inline || []).indexOf(e) > -1 || (t.block || []).indexOf(e) > -1
            }, changeStyleFromMenu: function (e) {
                if (!File.isLocked && !document.body.classList.contains("modal-open")) {
                    var t = b.NameMapToStyle[e.toLowerCase()];
                    s.isType(t, "header1", "header2", "header3", "header4", "header5", "header6", l.paragraph) ? this.changeBlock(t) : s.isType(t, l.def_footnote, l.def_link, l.hr, l.fences, l.math_block, l.toc) ? this.insertBlock(t) : s.isType(t, l.table) ? File.editor.tableEdit.insertTable() : s.isType(t, l.meta_block) ? this.insertMetaBlock() : s.isType(t, l.blockquote) && this.toggleIndent(l.blockquote)
                }
            }, changeBetweenCodeMirror: function (e, t) {
                if (s.isType(t, l.math_block, l.fences)) {
                    var n = this.editor, i = a.makeEmptyCommand(n.selection.buildUndo());
                    n.undo.completeSnap(!0), s.isType(t, l.fences) ? (n.fences.syncToNode(t.cid), n.fences.beforeDeleteFences(t)) : (n.mathBlock.syncToNode(t.cid), n.mathBlock.beforeDeleteFences(t)), i.undo.push(a.buildReplaceUndo(t)), t.set("type", e), i.redo.push(a.buildReplaceUndo(t)), n.findElemById(t.id).replaceWith(t.toHTML()), e == l.fences ? n.fences.getCm(t.id) : e == l.math_block && n.mathBlock.startEditing(t.id), n.selection.jumpIntoElemBegin(n.findElemById(t.id)), i.redo.push(n.selection.buildUndo()), n.undo.register(i), n.refocus(), u.refreshBlockMenu()
                }
            }, toggleFences: function () {
                if (!File.isLocked && !document.body.classList.contains("modal-open")) {
                    var e = this.editor.getNode(null, !0);
                    s.isType(e, l.fences) ? this.changeBlock(l.paragraph, e) : s.isType(e, l.math_block) ? this.changeBetweenCodeMirror(l.fences, e) : this.insertBlock(l.fences)
                }
            }, toggleMathBlock: function () {
                if (!File.isLocked && !document.body.classList.contains("modal-open")) {
                    var e = this.editor.getNode(null, !0);
                    s.isType(e, l.math_block) ? this.changeBlock(l.paragraph, e) : s.isType(e, l.fences) ? this.changeBetweenCodeMirror(l.math_block, e) : this.insertBlock(l.math_block)
                }
            }, changeBlock: function (e, t, n) {
                if (!File.isLocked && !document.body.classList.contains("modal-open") && (t = t || this.editor.getNode(null, !0))) {
                    var o, u, h, f, p = b.getMenuBlockType(t), m = this.editor, g = t.cid;
                    if (s.isType(p, l.math_block, l.html_block, l.table)) m.UserOp.insertParagraph(); else if (!s.isType(t, l.table_row, l.table_cell, l.blockquote, l.list) && (File.option.expandSimpleBlock && s.isType(p, l.paragraph) && t.get("depth") > 0 && (p = "header" + t.get("depth")), m.lastCursor = m.selection.buildUndo(), p == e && n && s.isType(t, l.heading) && (m.undo.completeSnap(!0), e = l.paragraph), p != e && p)) {
                        if (m.undo.completeSnap(!0), s.isType(p, l.fences) && (m.fences.syncToNode(t.cid), m.fences.beforeDeleteFences(t)), (o = a.makeEmptyCommand(m.lastCursor)).undo.push(a.buildReplaceUndo(t)), s.isType(p, l.def_link) && t.set("text", (t.get("href") || "") + (t.get("tittle") ? ' "' + t.get("tittle") + '"' : "")), 0 == e.indexOf("header")) h = e.substr(6) - 0, (u = t.get("pattern")) && /-|=/.exec(u) ? u = h <= 2 ? u.replace(/-|=/g, 1 == h ? "=" : "-") : void 0 : u && (u = u.replace(/#+/g, "#".repeat(h))), t = s.isType(t, l.paragraph) ? File.option.expandSimpleBlock && t.get("depth") && /^#/.exec(t.get("text")) ? function (e, n, r) {
                            (f = i.utils.clone(o.undo[0])).start += e - t.get("depth"), f.end += e - t.get("depth"), t.set("depth", e);
                            var s = t.get("text");
                            if (s = s.replace(/^#+/, "#".repeat(e)).replace(/#+$/, "#".repeat(e)), t.set("text", s), !r) {
                                var l = d.renderHtmlWithBlockMeta(t, File.editor.brush);
                                m.findElemById(t.id).replaceWith(l)
                            }
                            return o.redo.push(a.buildReplaceUndo(t)), t
                        }(h) : function (e, n) {
                            var c = function () {
                                var e, n, c = t.get("text") || "", d = c.split(/\n/) || [];
                                if (t.set("text", c), !d.length) return [e, t, n];
                                var u = r.findLine(c, m.lastCursor.start);
                                return t.set("text", u.line), u.start > 0 && (e = t.insert(new s({
                                    type: l.paragraph,
                                    text: c.substring(0, u.start - 1)
                                }), !0), a.addUndoForInsert(o, e)), u.start + u.line.length < c.length && (n = t.insert(new s({
                                    type: l.paragraph,
                                    text: c.substring(u.start + u.line.length + 1)
                                }), !1), a.addUndoForInsert(o, n)), (f = i.utils.clone(o.undo[0])).start -= u.start, f.end -= u.start, [e, t, n]
                            }();
                            k(e, n, !0);
                            var d = (c[0] ? c[0].toHTML() : "") + c[1].toHTML() + (c[2] ? c[2].toHTML() : "");
                            return m.findElemById(t.id).replaceWith(d), c[1]
                        }(h, u) : k(h, u); else {
                            s.isType(t, l.paragraph) && p !== l.paragraph && t.set("text", t.get("text").replace(/^#+\s*/, "")), t.set("type", e), t.set("pattern", void 0);
                            var v;
                            if (s.isType(t, l.paragraph) || p != l.paragraph || t.set("text", t.get("text").replace(/\r?\n/g, " ")), s.isType(p, l.meta_block, l.fences) && s.isType(t, l.paragraph) && (t.set("type", l.raw_edit), (v = m.simpleParse(t)) || t.set("type", l.paragraph)), v) {
                                var y = $(v[1]), w = y[0].getAttribute("cid"), C = y.last()[0].getAttribute("cid"),
                                    x = c.createRange();
                                m.findElemById(v[2]).replaceWith(v[1]), v && a.append(o, v[0]), x.setStartBefore(m.findElemById(w)[0]), x.setEndAfter(m.findElemById(C)[0]), x = m.selection.deRange(x, !0), f = m.selection.buildUndo(x)
                            } else s.normalizeNode(t), o.redo.push(a.buildReplaceUndo(t)), m.findElemById(t.id).replaceWith(t.toHTML())
                        }
                        f || ((f = i.utils.clone(o.undo[0])).startId === g && (f.startId = t.cid), f.endId === g && (f.endId = t.cid), f.id === g && (f.id = t.cid)), m.undo.exeCommand(f), o.redo.push(f), m.undo.register(o), m.refocus()
                    }
                }

                function k(e, n, i) {
                    return t.set("type", l.heading), t.set("depth", e), t.set("pattern", n), i || m.findElemById(t.id).replaceWith(t.toHTML()), o.redo.push(a.buildReplaceUndo(t)), t
                }
            }, increaseHeaderLevel: function () {
                if (!File.isLocked && !document.body.classList.contains("modal-open")) {
                    var e = this.editor.getMarkElem(), t = e.attr("mdtype");
                    t != l.heading && t != l.paragraph || this.editor.stylize.changeHeadingLevel(this.editor.findNodeByElem(e), !0, e.attr("mdlike"))
                }
            }, decreaseHeaderLevel: function () {
                if (!File.isLocked && !document.body.classList.contains("modal-open")) {
                    var e = this.editor.getMarkElem(), t = e.attr("mdtype");
                    t != l.heading && t != l.paragraph || this.editor.stylize.changeHeadingLevel(this.editor.findNodeByElem(e), !1, e.attr("mdlike"))
                }
            }, insertMetaBlock: function (e, t) {
                if (!File.isLocked && !document.body.classList.contains("modal-open")) {
                    t = t || "";
                    var n = this.editor.nodeMap.getFirst();
                    if (!s.isType(n, l.meta_block)) {
                        this.editor.undo.completeSnap(!0), this.editor.lastCursor = this.editor.selection.buildUndo();
                        var i = a.makeEmptyCommand(this.editor.lastCursor || this.editor.selection.buildUndo()),
                            r = new s({
                                type: l.meta_block,
                                in: this.editor.nodeMap,
                                attachTo: this.editor.nodeMap,
                                after: n,
                                text: t
                            });
                        return a.addUndoForInsert(i, r), e ? {
                            command: i,
                            node: r
                        } : (this.editor.findElemById(n.cid).before(r.toHTML()), this.editor.selection.restoreSelection(this.editor.findElemById(r.cid), 0), i.redo.push(this.editor.selection.buildUndo()), this.editor.undo.register(i), $(this.editor.sessionStr).trigger("cursorChange"), this.editor.selection.scrollAdjust(), this.editor.refocus(r.cid), r)
                    }
                }
            }, insertBlock: function (e, t) {
                if (!(File.isLocked || "table" != e && document.body.classList.contains("modal-open"))) {
                    var n = this.editor, i = n.selection.getRangy(), r = "", o = null, c = "";
                    this.editor.undo.completeSnap(!0), !i || i.collapsed || t ? o = a.makeEmptyCommand() : (r = n.UserOp.prepMarkHtml(i.toHtml(), n).html(), c = i.toString(), o = n.UserOp.backspaceHandler(n, null, "delSelection", !0), i = n.selection.getRangy(), n.selection.deRange(i, !0), n.refocus(null, !1, !0));
                    var d = this.editor.getNode(null, !0);
                    if (d) {
                        var u = b.getMenuBlockType(d), h = this.editor.findElemById(d.id);
                        if (this.editor.lastCursor = this.editor.selection.buildUndo(i), u != e && u && s.isType(d, l.paragraph, l.heading)) {
                            o.undo.push(this.editor.lastCursor), o.undo.push(a.buildReplaceUndo(d));
                            var f, p = s.splitAt(d, this.editor.lastCursor.start, n, !0), m = p.prev,
                                g = t || new s({type: e, text: ""}), v = p.next, y = "", w = e == l.hr ? v.id : g.id;
                            s.isType(e, l.math_block, l.fences) ? g.set("text", r ? n.UserOp.getMarkdownSourceFrom(r) : "") : e == l.def_link && (c = (c.trim().split(/\n/) || [])[0] || "", /[\/\\]/.exec(c) ? g.set("href", c.substr(0, 160)) : g.set("ref", (c.split(/\s/)[0] || c).substr(0, 20))), o.redo.push(n.undo.buildReplaceUndo(d)), a.addUndoForInsertArray(o, p.insertArray), m.insert(g, !1), a.addUndoForInsert(o, g), p.insertArray.indexOf(v) > -1 && p.insertArray.splice(p.insertArray.indexOf(v), 0, g), t && C(t, d.get("in")), v && s.isEmptyBlock(v) && s.isType(v.get("after"), l.paragraph) && (a.addUndoForRemove(o, v), v.remove(), v = null), s.isEmptyBlock(m) && (a.addUndoForRemove(o, m), m.remove(), m = null), y = (d.isDeleted() ? "" : d.toHTML()) + p.insertArray.map(function (e) {
                                return e.isDeleted() ? "" : e.toHTML()
                            }).join(""), h.replaceWith(y), f = this.editor.findElemById(w), this.editor.selection.jumpIntoElemBegin(f)
                        } else {
                            d = d.getClosetBlock(!1);
                            g = t || new s({type: e, text: ""});
                            d.insert(g), t && C(t, d.get("in")), a.addUndoForInsert(o, g), this.editor.findElemById(d.cid).after(g.toHTML()), this.editor.selection.jumpIntoElemBegin(this.editor.findElemById(g.cid))
                        }
                        this.editor.lastCursor = this.editor.selection.buildUndo(), o.redo.push(this.editor.lastCursor), this.editor.undo.register(o), this.editor.refocus(), $(this.editor.sessionStr).trigger("cursorChange"), this.editor.selection.scrollAdjust()
                    }
                }

                function C(e, t) {
                    e.set("in", t), e.get("children").toArray().map(function (e) {
                        C(e, t)
                    })
                }
            }, toggleTaskStatus: function (e) {
                if (!File.isLocked && !document.body.classList.contains("modal-open")) {
                    var t = this.editor.selection.getRangy(),
                        n = this.editor.getMarkElem(t && t.startContainer).closest(".md-task-list-item"),
                        i = n.hasClass("task-list-done");
                    if (void 0 === e && (e = !i), n.length && e !== i) {
                        var r = this.editor;
                        if (t.collapsed) r.getNode(n.attr("cid")).attr("checked", e, r, !1); else {
                            r.undo.completeSnap(!0);
                            var o = a.makeEmptyCommand(), s = $.parseHTML(t.toHtml());
                            $(s).find(e ? ".task-list-not-done" : ".task-list-done").addBack(e ? ".task-list-not-done" : ".task-list-done").each(function () {
                                var t = r.getNode(this.getAttribute("cid")).attr("checked", e, r, !0);
                                a.append(o, t)
                            }), o.undo.length ? r.undo.register(o) : r.getNode(n.attr("cid")).attr("checked", e, r, !1)
                        }
                        var l = (File.isMac ? app.menu.getItem("Paragraph").submenu() : reqnode("electron").remote.Menu.getApplicationMenu().getItem("Paragraph").submenu).getItem("Task Status"),
                            c = File.isNode ? l.submenu : l.submenu();
                        e ? (c.getItem("Mark as Complete").setState(!0), c.getItem("Mark as Incomplete").setState(!1)) : (c.getItem("Mark as Complete").setState(!1), c.getItem("Mark as Incomplete").setState(!0))
                    }
                }
            }, toggleIndent: function (e, t) {
                if (!File.isLocked && !document.body.classList.contains("modal-open")) {
                    var n, i, r = this.editor, o = a.makeEmptyCommand(r.selection.buildUndo()),
                        c = this.editor.selection.getRangy();
                    if (!(isInputComponent(document.activeElement) && !this.editor.fences.getFocused() || File.isLocked)) {
                        this.editor.undo.completeSnap(!0), this.editor.store();
                        var d = this.editor.selection.buildUndo();
                        if (this.editor.lastCursor = d, function (e) {
                            if (e && !e.collapsed) {
                                var t = !1;
                                !function e(i) {
                                    var r, o = n(i.endContainer);
                                    o.text().length || o.parent()[0] != i.commonAncestorContainer || (r = o.prev()[0]) && (t = !0, i.setEndAfter(r), e(i))
                                }(e), function e(i) {
                                    var r, o = n(i.startContainer);
                                    o.text().length || o.parent()[0] != i.commonAncestorContainer || (r = o.after()[0]) && (t = !0, i.setStartBefore(r), e(i))
                                }(e), t && r.selection.deRange(e)
                            }

                            function n(e) {
                                return $(e).closest("p")
                            }
                        }(c), c) {
                            var u = r.selection.getDetailPos(c.startContainer, c.startOffset),
                                h = r.selection.getDetailPos(c.endContainer, c.endOffset), p = r.getMarkElem(u[0]),
                                m = r.getMarkElem(h[0]), g = r.findNodeByElem(p), v = r.findNodeByElem(m),
                                y = s.getTreePosition(g, v),
                                b = (w = y, C = c, C.collapsed && w[2] === w[1] && s.isType(w[1], l.line) ? [w[0], w[1].getLastBrother(!0), w[1].getLastBrother(!1)] : w);
                            n = b[1], i = b[1] === b[2] ? null : b[2]
                        } else n = this.editor.findNodeByElem(this.editor.getMarkElem());
                        var w, C;
                        n && (this.editor.brush.pause(!0), e == l.blockquote ? function (t, n, i) {
                            t = t.getClosetBlock(), n = n && n.getClosetBlock();
                            var o = t.get("parent");
                            if (u = t, f = o, h = (h = n) || u, f && f.get("type") == l.blockquote && (c.collapsed || !u.get("before") && !h.get("after"))) a.addUndoForUnwrap(i, o), o.unwrap(r); else {
                                var d = new s({type: e, in: t.get("in")});
                                d.wrap(t, n, r), a.addUndoForWrap(i, d)
                            }
                            var u, h, f
                        }(n, i, o) : function (n, i, o, d, u) {
                            var h = function (e, t) {
                                t = t || e;
                                var n = e.get("parent");
                                if (c.collapsed) {
                                    if (!e.get("before") && !t.get("after") && n && s.isType(n.get("parent"), l.list)) return n.get("parent")
                                } else if (n && s.isType(n.getClosetBlock(), l.list)) return n.getClosetBlock()
                            }(n, i), p = h ? f(h) : void 0;
                            if (t) if ("none" == d) {
                                if (!h) return;
                                d = p
                            } else if (h && d == p) return;
                            if (h) p == d ? (h.get("children").map(function (e) {
                                a.addUndoForUnwrap(o, e), e.unwrap()
                            }), a.addUndoForUnwrap(o, h), h.unwrap(r)) : (o.undo.push(a.buildReplaceUndo(h)), h.set("pattern", void 0), x(h, d), r.findElemById(h.id).replaceWith(h.toHTML()), o.redo.push(a.buildReplaceUndo(h))); else {
                                for (var m, g = n, v = [], y = (i = i || n).get("after"); g && g != y;) {
                                    var b;
                                    m = g, File.option.ignoreLineBreak || ((b = k(g, o, u)) && b[0] && (m = g = n = b[0]), b && b[1] && (y = b[1]));
                                    var w = new s({type: l.list_item, in: n.get("in")});
                                    g = g.get("after"), w.wrap(m, m, r, !0), v.push(w), a.addUndoForWrap(o, w)
                                }
                                x(h = new s({type: l.list, in: n.get("in")}), d);
                                var C = v[0], S = v.last();
                                if (e == s.ListType.task) for (var E = C; E != S.get("after");) E.set("style", s.ListType.task), E = E.get("after");
                                h.wrap(C, S, r), a.addUndoForWrap(o, h), r.refresh()
                            }
                        }(n, i, o, e, d), o.redo.push(d), this.editor.undo.exeCommand(d), this.editor.undo.register(o), this.editor.brush.resume(), this.editor.refocus(), this.editor.selection.scrollAdjust())
                    }
                }

                function x(e, t) {
                    t != s.ListType.ol && t != s.ListType.ul || (e.set("style", t), e.get("children").map(function (e) {
                        e.unset("style"), e.unset("checked")
                    })), t == s.ListType.task && (e.set("style", s.ListType.ul), e.get("children").map(function (e) {
                        e.set("style", s.ListType.task)
                    }))
                }

                function k(e, t, n) {
                    if (!s.isType(e, l.paragraph)) return e;
                    var i = e.get("text").split(/\n/g) || [];
                    if (i.length < 2) return e;
                    var o = n.startId == e.cid, c = n.endId == e.cid, d = n.start == n.end;
                    if (o && c) {
                        t.undo.push(a.buildReplaceUndo(e));
                        var u, h = [], f = e;
                        e.set("text", i[0]);
                        for (var p, m = e, g = 1; g < i.length; g++) {
                            var v = i[g];
                            if (n.start > i[g - 1].length + i[g].length && !d) i[g] = e.get("text") + "\n" + v, e.set("text", i[g]); else if (u = new s({
                                type: l.paragraph,
                                text: v
                            }), f.insert(u), f = u, h.push(u), o && n.start > i[g - 1].length ? (n.startId = u.cid, n.start -= i[g - 1].length + 1, m = u) : o = !1, c && n.end > i[g - 1].length) {
                                if (n.endId = u.cid, n.end -= i[g - 1].length + 1, !d && g < i.length - 1 && n.end <= i[g].length) {
                                    p = new s({
                                        type: l.paragraph,
                                        text: i.slice(g + 1).join("\n")
                                    }), f.insert(p), h.push(p);
                                    break
                                }
                            } else c = !1
                        }
                        return (e.get("text").indexOf("\n") > -1 || m != e) && (r.findElemById(e.cid).replaceWith(e.toHTML()), t.redo.push(a.buildReplaceUndo(e))), p && r.findElemById(e.cid).after(p.toHTML()), a.addUndoForInsertArray(t, h), [m, p]
                    }
                }
            }, changeHeadingLevel: function (e, t, n) {
                var i, r, o = null;
                e.get("type") == l.paragraph ? n && (i = /h(\d)/.exec(n)) ? r = i[1] - 0 : t && (o = "header6") : e.get("type") == l.heading && (r = e.get("depth") - 0), void 0 !== r && (7 == (r -= t ? 1 : -1) ? o = "paragraph" : r > 0 && (o = "header" + r)), o && this.changeBlock(o)
            }
        }), b = {
            SyntaxMap: {
                strong: ["**", "**"],
                em: ["*", "*"],
                code: ["`", "`"],
                del: ["~~", "~~"],
                underline: ["<u>", "</u>"],
                footnote: ["[^", " ]"],
                link: ["[", "]()"],
                image: ["![", "]()"],
                highlight: ["==", "=="],
                superscript: ["^", "^"],
                subscript: ["~", "~"],
                inline_math: ["$", "$"],
                comment: ["\x3c!--", "--\x3e"]
            },
            NormalBlockMap: {
                line: "Paragraph",
                paragraph: "Paragraph",
                header1: "Header 1",
                header2: "Header 2",
                header3: "Header 3",
                header4: "Header 4",
                header5: "Header 5",
                header6: "Header 6",
                def_link: "Link Reference",
                def_footnote: "Footnotes"
            },
            InsertInline: ["link", "image", "footnote", "inline_math"],
            LinkList: ["autolink", "reflink", "link"],
            NoInline: ["hr", "fences", "def_link", "code", "meta_block", "raw_edit", "math_block", "toc", "comment", "tag", "atag", "imgtag", "html_block"],
            Selectable: ["hr", "math_block", "toc", "html_block", "fences"],
            InsertBlock: ["table", "fences", "hr"],
            StyleToNameMap: {
                paragraph: "Paragraph",
                header1: "Heading 1",
                header2: "Heading 2",
                header3: "Heading 3",
                header4: "Heading 4",
                header5: "Heading 5",
                header6: "Heading 6",
                def_link: "Link Reference",
                def_footnote: "Footnotes",
                table: "Table",
                fences: "Code Fences",
                blockquote: "Quote",
                toc: "Table of Contents",
                hr: "Horizontal Line",
                meta_block: "YAML Front Matter",
                ol: "Ordered List",
                ul: "Unordered List",
                tasklist: "Task List",
                html_block: "HTML Block",
                strong: "Strong",
                em: "Emphasis",
                code: "Code",
                del: "Strike",
                highlight: "Highlight",
                inline_math: "Inline Math",
                math_block: "Math Block",
                superscript: "Superscript",
                subscript: "subscript",
                image: "Image",
                footnote: "Superscript",
                autolink: "Hyperlink",
                reflink: "Hyperlink",
                link: "Hyperlink",
                url: "Hyperlink",
                underline: "Underline",
                comment: "Comment"
            }
        };
        b.NameMapToStyle = {};
        for (var w in b.StyleToNameMap) b.NameMapToStyle[b.StyleToNameMap[w].toLowerCase()] = w;
        b.InsertQuery = '[md-inline="' + b.InsertInline.join('"],[md-inline="') + '"]', b.getMenuBlockType = function (e) {
            var t = e.get("type");
            switch (t) {
                case l.heading:
                    return "header" + e.get("depth");
                case l.list:
                    return e.get("style")
            }
            return t
        }, y.CONST = b, n.exports = y
    }), $__System.registerDynamic("45", ["e", "11"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i = e("e"), r = e("11").Model.extend({
            initialize: function (e) {
                this.editor = e, this.$container = i("#emoji-auto-suggest"), setTimeout(function () {
                    i.getScript("./app/editor/EmojiSearchMap.js", function () {
                        var e = window.EmojiSearchMap;
                        for (var t in r.data) e[t] || (e[t] = [t])
                    })
                }, 1e3)
            }, search: function (e, t) {
                if (!e) return [];
                var n, i = new RegExp("(^" + e + ")|(_" + e + ")|(-" + e + ")", "i"),
                    o = Object.keys(r.data).filter(function (t) {
                        return i.exec(t) && t !== e
                    });
                if (o.sort(), r.data[e] && o.unshift(e), n = (window.EmojiSearchMap || {})[e]) for (var a = 0; a < n.length; a++) -1 == o.indexOf(n[a]) && o.push(n[a]);
                return t.type = "emoji", t.token = e, t.match = o, t.found = o.length, t.pageNo = 0, t.pageCnt = Math.floor((o.length - 1) / 5 + 1), o
            }, showAutoSuggest: function (e, t) {
                if (t.token === e) return !1;
                var n = this.search(e, t), i = "";
                if (!t.found) return this.$container.hide(), !1;
                for (var o = 0; o < n.length && o < 40; o++) o % 5 == 0 && (i += (o > 0 ? "</ul>" : "") + "<ul data-page='" + o / 5 + "' style='display:none'>"), i += "<li data-content=':" + n[o] + ":' ><span>" + r.data[n[o]] + "</span> <span class='emoji-meta'>:" + n[o] + ":</span></li>";
                return i += "</ul>", this.$container.html(i), this.$container
            }
        });
        r.data = {
            100: "💯",
            1234: "🔢",
            grinning: "😀",
            smiley: "😃",
            smile: "😄",
            grin: "😁",
            laughing: "😆",
            satisfied: "😆",
            sweat_smile: "😅",
            joy: "😂",
            rofl: "🤣",
            relaxed: "☺️",
            blush: "😊",
            innocent: "😇",
            slightly_smiling_face: "🙂",
            upside_down_face: "🙃",
            wink: "😉",
            relieved: "😌",
            heart_eyes: "😍",
            kissing_heart: "😘",
            kissing: "😗",
            kissing_smiling_eyes: "😙",
            kissing_closed_eyes: "😚",
            yum: "😋",
            stuck_out_tongue_winking_eye: "😜",
            stuck_out_tongue_closed_eyes: "😝",
            stuck_out_tongue: "😛",
            money_mouth_face: "🤑",
            hugs: "🤗",
            nerd_face: "🤓",
            sunglasses: "😎",
            clown_face: "🤡",
            cowboy_hat_face: "🤠",
            smirk: "😏",
            unamused: "😒",
            disappointed: "😞",
            pensive: "😔",
            worried: "😟",
            confused: "😕",
            slightly_frowning_face: "🙁",
            frowning_face: "☹️",
            persevere: "😣",
            confounded: "😖",
            tired_face: "😫",
            weary: "😩",
            triumph: "😤",
            angry: "😠",
            rage: "😡",
            pout: "😡",
            no_mouth: "😶",
            neutral_face: "😐",
            expressionless: "😑",
            hushed: "😯",
            frowning: "😦",
            anguished: "😧",
            open_mouth: "😮",
            astonished: "😲",
            dizzy_face: "😵",
            flushed: "😳",
            scream: "😱",
            fearful: "😨",
            cold_sweat: "😰",
            cry: "😢",
            disappointed_relieved: "😥",
            drooling_face: "🤤",
            sob: "😭",
            sweat: "😓",
            sleepy: "😪",
            sleeping: "😴",
            roll_eyes: "🙄",
            thinking: "🤔",
            lying_face: "🤥",
            grimacing: "😬",
            zipper_mouth_face: "🤐",
            nauseated_face: "🤢",
            sneezing_face: "🤧",
            mask: "😷",
            face_with_thermometer: "🤒",
            face_with_head_bandage: "🤕",
            smiling_imp: "😈",
            imp: "👿",
            japanese_ogre: "👹",
            japanese_goblin: "👺",
            hankey: "💩",
            poop: "💩",
            shit: "💩",
            ghost: "👻",
            skull: "💀",
            skull_and_crossbones: "☠️",
            alien: "👽",
            space_invader: "👾",
            robot: "🤖",
            jack_o_lantern: "🎃",
            smiley_cat: "😺",
            smile_cat: "😸",
            joy_cat: "😹",
            heart_eyes_cat: "😻",
            smirk_cat: "😼",
            kissing_cat: "😽",
            scream_cat: "🙀",
            crying_cat_face: "😿",
            pouting_cat: "😾",
            open_hands: "👐",
            raised_hands: "🙌",
            clap: "👏",
            pray: "🙏",
            handshake: "🤝",
            "+1": "👍",
            thumbsup: "👍",
            "-1": "👎",
            thumbsdown: "👎",
            fist_oncoming: "👊",
            facepunch: "👊",
            punch: "👊",
            fist_raised: "✊",
            fist: "✊",
            fist_left: "🤛",
            fist_right: "🤜",
            crossed_fingers: "🤞",
            v: "✌️",
            metal: "🤘",
            ok_hand: "👌",
            point_left: "👈",
            point_right: "👉",
            point_up_2: "👆",
            point_down: "👇",
            point_up: "☝️",
            hand: "✋",
            raised_hand: "✋",
            raised_back_of_hand: "🤚",
            raised_hand_with_fingers_splayed: "🖐",
            vulcan_salute: "🖖",
            wave: "👋",
            call_me_hand: "🤙",
            muscle: "💪",
            middle_finger: "🖕",
            fu: "🖕",
            writing_hand: "✍️",
            selfie: "🤳",
            nail_care: "💅",
            ring: "💍",
            lipstick: "💄",
            kiss: "💋",
            lips: "👄",
            tongue: "👅",
            ear: "👂",
            nose: "👃",
            footprints: "👣",
            eye: "👁",
            eyes: "👀",
            speaking_head: "🗣",
            bust_in_silhouette: "👤",
            busts_in_silhouette: "👥",
            baby: "👶",
            boy: "👦",
            girl: "👧",
            man: "👨",
            woman: "👩",
            blonde_woman: "👱‍♀",
            blonde_man: "👱",
            person_with_blond_hair: "👱",
            older_man: "👴",
            older_woman: "👵",
            man_with_gua_pi_mao: "👲",
            woman_with_turban: "👳‍♀",
            man_with_turban: "👳",
            policewoman: "👮‍♀",
            policeman: "👮",
            cop: "👮",
            construction_worker_woman: "👷‍♀",
            construction_worker_man: "👷",
            construction_worker: "👷",
            guardswoman: "💂‍♀",
            guardsman: "💂",
            female_detective: "🕵️‍♀️",
            male_detective: "🕵",
            detective: "🕵",
            woman_health_worker: "👩‍⚕",
            man_health_worker: "👨‍⚕",
            woman_farmer: "👩‍🌾",
            man_farmer: "👨‍🌾",
            woman_cook: "👩‍🍳",
            man_cook: "👨‍🍳",
            woman_student: "👩‍🎓",
            man_student: "👨‍🎓",
            woman_singer: "👩‍🎤",
            man_singer: "👨‍🎤",
            woman_teacher: "👩‍🏫",
            man_teacher: "👨‍🏫",
            woman_factory_worker: "👩‍🏭",
            man_factory_worker: "👨‍🏭",
            woman_technologist: "👩‍💻",
            man_technologist: "👨‍💻",
            woman_office_worker: "👩‍💼",
            man_office_worker: "👨‍💼",
            woman_mechanic: "👩‍🔧",
            man_mechanic: "👨‍🔧",
            woman_scientist: "👩‍🔬",
            man_scientist: "👨‍🔬",
            woman_artist: "👩‍🎨",
            man_artist: "👨‍🎨",
            woman_firefighter: "👩‍🚒",
            man_firefighter: "👨‍🚒",
            woman_pilot: "👩‍✈",
            man_pilot: "👨‍✈",
            woman_astronaut: "👩‍🚀",
            man_astronaut: "👨‍🚀",
            woman_judge: "👩‍⚖",
            man_judge: "👨‍⚖",
            mrs_claus: "🤶",
            santa: "🎅",
            princess: "👸",
            prince: "🤴",
            bride_with_veil: "👰",
            man_in_tuxedo: "🤵",
            angel: "👼",
            pregnant_woman: "🤰",
            bowing_woman: "🙇‍♀",
            bowing_man: "🙇",
            bow: "🙇",
            tipping_hand_woman: "💁",
            information_desk_person: "💁",
            sassy_woman: "💁",
            tipping_hand_man: "💁‍♂",
            sassy_man: "💁‍♂",
            no_good_woman: "🙅",
            no_good: "🙅",
            ng_woman: "🙅",
            no_good_man: "🙅‍♂",
            ng_man: "🙅‍♂",
            ok_woman: "🙆",
            ok_man: "🙆‍♂",
            raising_hand_woman: "🙋",
            raising_hand: "🙋",
            raising_hand_man: "🙋‍♂",
            woman_facepalming: "🤦‍♀",
            man_facepalming: "🤦‍♂",
            woman_shrugging: "🤷‍♀",
            man_shrugging: "🤷‍♂",
            pouting_woman: "🙎",
            person_with_pouting_face: "🙎",
            pouting_man: "🙎‍♂",
            frowning_woman: "🙍",
            person_frowning: "🙍",
            frowning_man: "🙍‍♂",
            haircut_woman: "💇",
            haircut: "💇",
            haircut_man: "💇‍♂",
            massage_woman: "💆",
            massage: "💆",
            massage_man: "💆‍♂",
            business_suit_levitating: "🕴",
            dancer: "💃",
            man_dancing: "🕺",
            dancing_women: "👯",
            dancers: "👯",
            dancing_men: "👯‍♂",
            walking_woman: "🚶‍♀",
            walking_man: "🚶",
            walking: "🚶",
            running_woman: "🏃‍♀",
            running_man: "🏃",
            runner: "🏃",
            running: "🏃",
            couple: "👫",
            two_women_holding_hands: "👭",
            two_men_holding_hands: "👬",
            couple_with_heart_woman_man: "💑",
            couple_with_heart: "💑",
            couple_with_heart_woman_woman: "👩‍❤️‍👩",
            couple_with_heart_man_man: "👨‍❤️‍👨",
            couplekiss_man_woman: "💏",
            couplekiss_woman_woman: "👩‍❤️‍💋‍👩",
            couplekiss_man_man: "👨‍❤️‍💋‍👨",
            family_man_woman_boy: "👪",
            family: "👪",
            family_man_woman_girl: "👨‍👩‍👧",
            family_man_woman_girl_boy: "👨‍👩‍👧‍👦",
            family_man_woman_boy_boy: "👨‍👩‍👦‍👦",
            family_man_woman_girl_girl: "👨‍👩‍👧‍👧",
            family_woman_woman_boy: "👩‍👩‍👦",
            family_woman_woman_girl: "👩‍👩‍👧",
            family_woman_woman_girl_boy: "👩‍👩‍👧‍👦",
            family_woman_woman_boy_boy: "👩‍👩‍👦‍👦",
            family_woman_woman_girl_girl: "👩‍👩‍👧‍👧",
            family_man_man_boy: "👨‍👨‍👦",
            family_man_man_girl: "👨‍👨‍👧",
            family_man_man_girl_boy: "👨‍👨‍👧‍👦",
            family_man_man_boy_boy: "👨‍👨‍👦‍👦",
            family_man_man_girl_girl: "👨‍👨‍👧‍👧",
            family_woman_boy: "👩‍👦",
            family_woman_girl: "👩‍👧",
            family_woman_girl_boy: "👩‍👧‍👦",
            family_woman_boy_boy: "👩‍👦‍👦",
            family_woman_girl_girl: "👩‍👧‍👧",
            family_man_boy: "👨‍👦",
            family_man_girl: "👨‍👧",
            family_man_girl_boy: "👨‍👧‍👦",
            family_man_boy_boy: "👨‍👦‍👦",
            family_man_girl_girl: "👨‍👧‍👧",
            womans_clothes: "👚",
            shirt: "👕",
            tshirt: "👕",
            jeans: "👖",
            necktie: "👔",
            dress: "👗",
            bikini: "👙",
            kimono: "👘",
            high_heel: "👠",
            sandal: "👡",
            boot: "👢",
            mans_shoe: "👞",
            shoe: "👞",
            athletic_shoe: "👟",
            womans_hat: "👒",
            tophat: "🎩",
            mortar_board: "🎓",
            crown: "👑",
            rescue_worker_helmet: "⛑",
            school_satchel: "🎒",
            pouch: "👝",
            purse: "👛",
            handbag: "👜",
            briefcase: "💼",
            eyeglasses: "👓",
            dark_sunglasses: "🕶",
            closed_umbrella: "🌂",
            open_umbrella: "☂️",
            dog: "🐶",
            cat: "🐱",
            mouse: "🐭",
            hamster: "🐹",
            rabbit: "🐰",
            fox_face: "🦊",
            bear: "🐻",
            panda_face: "🐼",
            koala: "🐨",
            tiger: "🐯",
            lion: "🦁",
            cow: "🐮",
            pig: "🐷",
            pig_nose: "🐽",
            frog: "🐸",
            monkey_face: "🐵",
            see_no_evil: "🙈",
            hear_no_evil: "🙉",
            speak_no_evil: "🙊",
            monkey: "🐒",
            chicken: "🐔",
            penguin: "🐧",
            bird: "🐦",
            baby_chick: "🐤",
            hatching_chick: "🐣",
            hatched_chick: "🐥",
            duck: "🦆",
            eagle: "🦅",
            owl: "🦉",
            bat: "🦇",
            wolf: "🐺",
            boar: "🐗",
            horse: "🐴",
            unicorn: "🦄",
            bee: "🐝",
            honeybee: "🐝",
            bug: "🐛",
            butterfly: "🦋",
            snail: "🐌",
            shell: "🐚",
            beetle: "🐞",
            ant: "🐜",
            spider: "🕷",
            spider_web: "🕸",
            turtle: "🐢",
            snake: "🐍",
            lizard: "🦎",
            scorpion: "🦂",
            crab: "🦀",
            squid: "🦑",
            octopus: "🐙",
            shrimp: "🦐",
            tropical_fish: "🐠",
            fish: "🐟",
            blowfish: "🐡",
            dolphin: "🐬",
            flipper: "🐬",
            shark: "🦈",
            whale: "🐳",
            whale2: "🐋",
            crocodile: "🐊",
            leopard: "🐆",
            tiger2: "🐅",
            water_buffalo: "🐃",
            ox: "🐂",
            cow2: "🐄",
            deer: "🦌",
            dromedary_camel: "🐪",
            camel: "🐫",
            elephant: "🐘",
            rhinoceros: "🦏",
            gorilla: "🦍",
            racehorse: "🐎",
            pig2: "🐖",
            goat: "🐐",
            ram: "🐏",
            sheep: "🐑",
            dog2: "🐕",
            poodle: "🐩",
            cat2: "🐈",
            rooster: "🐓",
            turkey: "🦃",
            dove: "🕊",
            rabbit2: "🐇",
            mouse2: "🐁",
            rat: "🐀",
            chipmunk: "🐿",
            feet: "🐾",
            paw_prints: "🐾",
            dragon: "🐉",
            dragon_face: "🐲",
            cactus: "🌵",
            christmas_tree: "🎄",
            evergreen_tree: "🌲",
            deciduous_tree: "🌳",
            palm_tree: "🌴",
            seedling: "🌱",
            herb: "🌿",
            shamrock: "☘️",
            four_leaf_clover: "🍀",
            bamboo: "🎍",
            tanabata_tree: "🎋",
            leaves: "🍃",
            fallen_leaf: "🍂",
            maple_leaf: "🍁",
            mushroom: "🍄",
            ear_of_rice: "🌾",
            bouquet: "💐",
            tulip: "🌷",
            rose: "🌹",
            wilted_flower: "🥀",
            sunflower: "🌻",
            blossom: "🌼",
            cherry_blossom: "🌸",
            hibiscus: "🌺",
            earth_americas: "🌎",
            earth_africa: "🌍",
            earth_asia: "🌏",
            full_moon: "🌕",
            waning_gibbous_moon: "🌖",
            last_quarter_moon: "🌗",
            waning_crescent_moon: "🌘",
            new_moon: "🌑",
            waxing_crescent_moon: "🌒",
            first_quarter_moon: "🌓",
            moon: "🌔",
            waxing_gibbous_moon: "🌔",
            new_moon_with_face: "🌚",
            full_moon_with_face: "🌝",
            sun_with_face: "🌞",
            first_quarter_moon_with_face: "🌛",
            last_quarter_moon_with_face: "🌜",
            crescent_moon: "🌙",
            dizzy: "💫",
            star: "⭐️",
            star2: "🌟",
            sparkles: "✨",
            zap: "⚡️",
            fire: "🔥",
            boom: "💥",
            collision: "💥",
            comet: "☄",
            sunny: "☀️",
            sun_behind_small_cloud: "🌤",
            partly_sunny: "⛅️",
            sun_behind_large_cloud: "🌥",
            sun_behind_rain_cloud: "🌦",
            rainbow: "🌈",
            cloud: "☁️",
            cloud_with_rain: "🌧",
            cloud_with_lightning_and_rain: "⛈",
            cloud_with_lightning: "🌩",
            cloud_with_snow: "🌨",
            snowman_with_snow: "☃️",
            snowman: "⛄️",
            snowflake: "❄️",
            wind_face: "🌬",
            dash: "💨",
            tornado: "🌪",
            fog: "🌫",
            ocean: "🌊",
            droplet: "💧",
            sweat_drops: "💦",
            umbrella: "☔️",
            green_apple: "🍏",
            apple: "🍎",
            pear: "🍐",
            tangerine: "🍊",
            orange: "🍊",
            mandarin: "🍊",
            lemon: "🍋",
            banana: "🍌",
            watermelon: "🍉",
            grapes: "🍇",
            strawberry: "🍓",
            melon: "🍈",
            cherries: "🍒",
            peach: "🍑",
            pineapple: "🍍",
            kiwi_fruit: "🥝",
            avocado: "🥑",
            tomato: "🍅",
            eggplant: "🍆",
            cucumber: "🥒",
            carrot: "🥕",
            corn: "🌽",
            hot_pepper: "🌶",
            potato: "🥔",
            sweet_potato: "🍠",
            chestnut: "🌰",
            peanuts: "🥜",
            honey_pot: "🍯",
            croissant: "🥐",
            bread: "🍞",
            baguette_bread: "🥖",
            cheese: "🧀",
            egg: "🥚",
            fried_egg: "🍳",
            bacon: "🥓",
            pancakes: "🥞",
            fried_shrimp: "🍤",
            poultry_leg: "🍗",
            meat_on_bone: "🍖",
            pizza: "🍕",
            hotdog: "🌭",
            hamburger: "🍔",
            fries: "🍟",
            stuffed_flatbread: "🥙",
            taco: "🌮",
            burrito: "🌯",
            green_salad: "🥗",
            shallow_pan_of_food: "🥘",
            spaghetti: "🍝",
            ramen: "🍜",
            stew: "🍲",
            fish_cake: "🍥",
            sushi: "🍣",
            bento: "🍱",
            curry: "🍛",
            rice: "🍚",
            rice_ball: "🍙",
            rice_cracker: "🍘",
            oden: "🍢",
            dango: "🍡",
            shaved_ice: "🍧",
            ice_cream: "🍨",
            icecream: "🍦",
            cake: "🍰",
            birthday: "🎂",
            custard: "🍮",
            lollipop: "🍭",
            candy: "🍬",
            chocolate_bar: "🍫",
            popcorn: "🍿",
            doughnut: "🍩",
            cookie: "🍪",
            milk_glass: "🥛",
            baby_bottle: "🍼",
            coffee: "☕️",
            tea: "🍵",
            sake: "🍶",
            beer: "🍺",
            beers: "🍻",
            clinking_glasses: "🥂",
            wine_glass: "🍷",
            tumbler_glass: "🥃",
            cocktail: "🍸",
            tropical_drink: "🍹",
            champagne: "🍾",
            spoon: "🥄",
            fork_and_knife: "🍴",
            plate_with_cutlery: "🍽",
            soccer: "⚽️",
            basketball: "🏀",
            football: "🏈",
            baseball: "⚾️",
            tennis: "🎾",
            volleyball: "🏐",
            rugby_football: "🏉",
            "8ball": "🎱",
            ping_pong: "🏓",
            badminton: "🏸",
            goal_net: "🥅",
            ice_hockey: "🏒",
            field_hockey: "🏑",
            cricket: "🏏",
            golf: "⛳️",
            bow_and_arrow: "🏹",
            fishing_pole_and_fish: "🎣",
            boxing_glove: "🥊",
            martial_arts_uniform: "🥋",
            ice_skate: "⛸",
            ski: "🎿",
            skier: "⛷",
            snowboarder: "🏂",
            weight_lifting_woman: "🏋️‍♀️",
            weight_lifting_man: "🏋",
            person_fencing: "🤺",
            women_wrestling: "🤼‍♀",
            men_wrestling: "🤼‍♂",
            woman_cartwheeling: "🤸‍♀",
            man_cartwheeling: "🤸‍♂",
            basketball_woman: "⛹️‍♀️",
            basketball_man: "⛹",
            woman_playing_handball: "🤾‍♀",
            man_playing_handball: "🤾‍♂",
            golfing_woman: "🏌️‍♀️",
            golfing_man: "🏌",
            surfing_woman: "🏄‍♀",
            surfing_man: "🏄",
            surfer: "🏄",
            swimming_woman: "🏊‍♀",
            swimming_man: "🏊",
            swimmer: "🏊",
            woman_playing_water_polo: "🤽‍♀",
            man_playing_water_polo: "🤽‍♂",
            rowing_woman: "🚣‍♀",
            rowing_man: "🚣",
            rowboat: "🚣",
            horse_racing: "🏇",
            biking_woman: "🚴‍♀",
            biking_man: "🚴",
            bicyclist: "🚴",
            mountain_biking_woman: "🚵‍♀",
            mountain_biking_man: "🚵",
            mountain_bicyclist: "🚵",
            running_shirt_with_sash: "🎽",
            medal_sports: "🏅",
            medal_military: "🎖",
            "1st_place_medal": "🥇",
            "2nd_place_medal": "🥈",
            "3rd_place_medal": "🥉",
            trophy: "🏆",
            rosette: "🏵",
            reminder_ribbon: "🎗",
            ticket: "🎫",
            tickets: "🎟",
            circus_tent: "🎪",
            woman_juggling: "🤹‍♀",
            man_juggling: "🤹‍♂",
            performing_arts: "🎭",
            art: "🎨",
            clapper: "🎬",
            microphone: "🎤",
            headphones: "🎧",
            musical_score: "🎼",
            musical_keyboard: "🎹",
            drum: "🥁",
            saxophone: "🎷",
            trumpet: "🎺",
            guitar: "🎸",
            violin: "🎻",
            game_die: "🎲",
            dart: "🎯",
            bowling: "🎳",
            video_game: "🎮",
            slot_machine: "🎰",
            car: "🚗",
            red_car: "🚗",
            taxi: "🚕",
            blue_car: "🚙",
            bus: "🚌",
            trolleybus: "🚎",
            racing_car: "🏎",
            police_car: "🚓",
            ambulance: "🚑",
            fire_engine: "🚒",
            minibus: "🚐",
            truck: "🚚",
            articulated_lorry: "🚛",
            tractor: "🚜",
            kick_scooter: "🛴",
            bike: "🚲",
            motor_scooter: "🛵",
            motorcycle: "🏍",
            rotating_light: "🚨",
            oncoming_police_car: "🚔",
            oncoming_bus: "🚍",
            oncoming_automobile: "🚘",
            oncoming_taxi: "🚖",
            aerial_tramway: "🚡",
            mountain_cableway: "🚠",
            suspension_railway: "🚟",
            railway_car: "🚃",
            train: "🚋",
            mountain_railway: "🚞",
            monorail: "🚝",
            bullettrain_side: "🚄",
            bullettrain_front: "🚅",
            light_rail: "🚈",
            steam_locomotive: "🚂",
            train2: "🚆",
            metro: "🚇",
            tram: "🚊",
            station: "🚉",
            helicopter: "🚁",
            small_airplane: "🛩",
            airplane: "✈️",
            flight_departure: "🛫",
            flight_arrival: "🛬",
            rocket: "🚀",
            artificial_satellite: "🛰",
            seat: "💺",
            canoe: "🛶",
            boat: "⛵️",
            sailboat: "⛵️",
            motor_boat: "🛥",
            speedboat: "🚤",
            passenger_ship: "🛳",
            ferry: "⛴",
            ship: "🚢",
            anchor: "⚓️",
            construction: "🚧",
            fuelpump: "⛽️",
            busstop: "🚏",
            vertical_traffic_light: "🚦",
            traffic_light: "🚥",
            world_map: "🗺",
            moyai: "🗿",
            statue_of_liberty: "🗽",
            fountain: "⛲️",
            tokyo_tower: "🗼",
            european_castle: "🏰",
            japanese_castle: "🏯",
            stadium: "🏟",
            ferris_wheel: "🎡",
            roller_coaster: "🎢",
            carousel_horse: "🎠",
            parasol_on_ground: "⛱",
            beach_umbrella: "🏖",
            desert_island: "🏝",
            mountain: "⛰",
            mountain_snow: "🏔",
            mount_fuji: "🗻",
            volcano: "🌋",
            desert: "🏜",
            camping: "🏕",
            tent: "⛺️",
            railway_track: "🛤",
            motorway: "🛣",
            building_construction: "🏗",
            factory: "🏭",
            house: "🏠",
            house_with_garden: "🏡",
            houses: "🏘",
            derelict_house: "🏚",
            office: "🏢",
            department_store: "🏬",
            post_office: "🏣",
            european_post_office: "🏤",
            hospital: "🏥",
            bank: "🏦",
            hotel: "🏨",
            convenience_store: "🏪",
            school: "🏫",
            love_hotel: "🏩",
            wedding: "💒",
            classical_building: "🏛",
            church: "⛪️",
            mosque: "🕌",
            synagogue: "🕍",
            kaaba: "🕋",
            shinto_shrine: "⛩",
            japan: "🗾",
            rice_scene: "🎑",
            national_park: "🏞",
            sunrise: "🌅",
            sunrise_over_mountains: "🌄",
            stars: "🌠",
            sparkler: "🎇",
            fireworks: "🎆",
            city_sunrise: "🌇",
            city_sunset: "🌆",
            cityscape: "🏙",
            night_with_stars: "🌃",
            milky_way: "🌌",
            bridge_at_night: "🌉",
            foggy: "🌁",
            watch: "⌚️",
            iphone: "📱",
            calling: "📲",
            computer: "💻",
            keyboard: "⌨️",
            desktop_computer: "🖥",
            printer: "🖨",
            computer_mouse: "🖱",
            trackball: "🖲",
            joystick: "🕹",
            clamp: "🗜",
            minidisc: "💽",
            floppy_disk: "💾",
            cd: "💿",
            dvd: "📀",
            vhs: "📼",
            camera: "📷",
            camera_flash: "📸",
            video_camera: "📹",
            movie_camera: "🎥",
            film_projector: "📽",
            film_strip: "🎞",
            telephone_receiver: "📞",
            phone: "☎️",
            telephone: "☎️",
            pager: "📟",
            fax: "📠",
            tv: "📺",
            radio: "📻",
            studio_microphone: "🎙",
            level_slider: "🎚",
            control_knobs: "🎛",
            stopwatch: "⏱",
            timer_clock: "⏲",
            alarm_clock: "⏰",
            mantelpiece_clock: "🕰",
            hourglass: "⌛️",
            hourglass_flowing_sand: "⏳",
            satellite: "📡",
            battery: "🔋",
            electric_plug: "🔌",
            bulb: "💡",
            flashlight: "🔦",
            candle: "🕯",
            wastebasket: "🗑",
            oil_drum: "🛢",
            money_with_wings: "💸",
            dollar: "💵",
            yen: "💴",
            euro: "💶",
            pound: "💷",
            moneybag: "💰",
            credit_card: "💳",
            gem: "💎",
            balance_scale: "⚖️",
            wrench: "🔧",
            hammer: "🔨",
            hammer_and_pick: "⚒",
            hammer_and_wrench: "🛠",
            pick: "⛏",
            nut_and_bolt: "🔩",
            gear: "⚙️",
            chains: "⛓",
            gun: "🔫",
            bomb: "💣",
            hocho: "🔪",
            knife: "🔪",
            dagger: "🗡",
            crossed_swords: "⚔️",
            shield: "🛡",
            smoking: "🚬",
            coffin: "⚰️",
            funeral_urn: "⚱️",
            amphora: "🏺",
            crystal_ball: "🔮",
            prayer_beads: "📿",
            barber: "💈",
            alembic: "⚗️",
            telescope: "🔭",
            microscope: "🔬",
            hole: "🕳",
            pill: "💊",
            syringe: "💉",
            thermometer: "🌡",
            toilet: "🚽",
            potable_water: "🚰",
            shower: "🚿",
            bathtub: "🛁",
            bath: "🛀",
            bellhop_bell: "🛎",
            key: "🔑",
            old_key: "🗝",
            door: "🚪",
            couch_and_lamp: "🛋",
            bed: "🛏",
            sleeping_bed: "🛌",
            framed_picture: "🖼",
            shopping: "🛍",
            shopping_cart: "🛒",
            gift: "🎁",
            balloon: "🎈",
            flags: "🎏",
            ribbon: "🎀",
            confetti_ball: "🎊",
            tada: "🎉",
            dolls: "🎎",
            izakaya_lantern: "🏮",
            lantern: "🏮",
            wind_chime: "🎐",
            email: "✉️",
            envelope: "✉️",
            envelope_with_arrow: "📩",
            incoming_envelope: "📨",
            "e-mail": "📧",
            love_letter: "💌",
            inbox_tray: "📥",
            outbox_tray: "📤",
            package: "📦",
            label: "🏷",
            mailbox_closed: "📪",
            mailbox: "📫",
            mailbox_with_mail: "📬",
            mailbox_with_no_mail: "📭",
            postbox: "📮",
            postal_horn: "📯",
            scroll: "📜",
            page_with_curl: "📃",
            page_facing_up: "📄",
            bookmark_tabs: "📑",
            bar_chart: "📊",
            chart_with_upwards_trend: "📈",
            chart_with_downwards_trend: "📉",
            spiral_notepad: "🗒",
            spiral_calendar: "🗓",
            calendar: "📆",
            date: "📅",
            card_index: "📇",
            card_file_box: "🗃",
            ballot_box: "🗳",
            file_cabinet: "🗄",
            clipboard: "📋",
            file_folder: "📁",
            open_file_folder: "📂",
            card_index_dividers: "🗂",
            newspaper_roll: "🗞",
            newspaper: "📰",
            notebook: "📓",
            notebook_with_decorative_cover: "📔",
            ledger: "📒",
            closed_book: "📕",
            green_book: "📗",
            blue_book: "📘",
            orange_book: "📙",
            books: "📚",
            book: "📖",
            open_book: "📖",
            bookmark: "🔖",
            link: "🔗",
            paperclip: "📎",
            paperclips: "🖇",
            triangular_ruler: "📐",
            straight_ruler: "📏",
            pushpin: "📌",
            round_pushpin: "📍",
            scissors: "✂️",
            pen: "🖊",
            fountain_pen: "🖋",
            black_nib: "✒️",
            paintbrush: "🖌",
            crayon: "🖍",
            memo: "📝",
            pencil: "📝",
            pencil2: "✏️",
            mag: "🔍",
            mag_right: "🔎",
            lock_with_ink_pen: "🔏",
            closed_lock_with_key: "🔐",
            lock: "🔒",
            unlock: "🔓",
            heart: "❤️",
            yellow_heart: "💛",
            green_heart: "💚",
            blue_heart: "💙",
            purple_heart: "💜",
            black_heart: "🖤",
            broken_heart: "💔",
            heavy_heart_exclamation: "❣️",
            two_hearts: "💕",
            revolving_hearts: "💞",
            heartbeat: "💓",
            heartpulse: "💗",
            sparkling_heart: "💖",
            cupid: "💘",
            gift_heart: "💝",
            heart_decoration: "💟",
            peace_symbol: "☮️",
            latin_cross: "✝️",
            star_and_crescent: "☪️",
            om: "🕉",
            wheel_of_dharma: "☸️",
            star_of_david: "✡️",
            six_pointed_star: "🔯",
            menorah: "🕎",
            yin_yang: "☯️",
            orthodox_cross: "☦️",
            place_of_worship: "🛐",
            ophiuchus: "⛎",
            aries: "♈️",
            taurus: "♉️",
            gemini: "♊️",
            cancer: "♋️",
            leo: "♌️",
            virgo: "♍️",
            libra: "♎️",
            scorpius: "♏️",
            sagittarius: "♐️",
            capricorn: "♑️",
            aquarius: "♒️",
            pisces: "♓️",
            id: "🆔",
            atom_symbol: "⚛️",
            accept: "🉑",
            radioactive: "☢️",
            biohazard: "☣️",
            mobile_phone_off: "📴",
            vibration_mode: "📳",
            eight_pointed_black_star: "✴️",
            vs: "🆚",
            white_flower: "💮",
            ideograph_advantage: "🉐",
            secret: "㊙️",
            congratulations: "㊗️",
            u6e80: "🈵",
            a: "🅰️",
            b: "🅱️",
            ab: "🆎",
            cl: "🆑",
            o2: "🅾️",
            sos: "🆘",
            x: "❌",
            o: "⭕️",
            stop_sign: "🛑",
            no_entry: "⛔️",
            name_badge: "📛",
            no_entry_sign: "🚫",
            anger: "💢",
            hotsprings: "♨️",
            no_pedestrians: "🚷",
            do_not_litter: "🚯",
            no_bicycles: "🚳",
            "non-potable_water": "🚱",
            underage: "🔞",
            no_mobile_phones: "📵",
            no_smoking: "🚭",
            exclamation: "❗️",
            heavy_exclamation_mark: "❗️",
            grey_exclamation: "❕",
            question: "❓",
            grey_question: "❔",
            bangbang: "‼️",
            interrobang: "⁉️",
            low_brightness: "🔅",
            high_brightness: "🔆",
            part_alternation_mark: "〽️",
            warning: "⚠️",
            children_crossing: "🚸",
            trident: "🔱",
            fleur_de_lis: "⚜️",
            beginner: "🔰",
            recycle: "♻️",
            white_check_mark: "✅",
            chart: "💹",
            sparkle: "❇️",
            eight_spoked_asterisk: "✳️",
            negative_squared_cross_mark: "❎",
            globe_with_meridians: "🌐",
            diamond_shape_with_a_dot_inside: "💠",
            m: "Ⓜ️",
            cyclone: "🌀",
            zzz: "💤",
            atm: "🏧",
            wc: "🚾",
            wheelchair: "♿️",
            parking: "🅿️",
            sa: "🈂️",
            passport_control: "🛂",
            customs: "🛃",
            baggage_claim: "🛄",
            left_luggage: "🛅",
            mens: "🚹",
            womens: "🚺",
            baby_symbol: "🚼",
            restroom: "🚻",
            put_litter_in_its_place: "🚮",
            cinema: "🎦",
            signal_strength: "📶",
            koko: "🈁",
            symbols: "🔣",
            information_source: "ℹ️",
            abc: "🔤",
            abcd: "🔡",
            capital_abcd: "🔠",
            ng: "🆖",
            ok: "🆗",
            up: "🆙",
            cool: "🆒",
            new: "🆕",
            free: "🆓",
            zero: "0️⃣",
            one: "1️⃣",
            two: "2️⃣",
            three: "3️⃣",
            four: "4️⃣",
            five: "5️⃣",
            six: "6️⃣",
            seven: "7️⃣",
            eight: "8️⃣",
            nine: "9️⃣",
            keycap_ten: "🔟",
            hash: "#️⃣",
            asterisk: "*️⃣",
            arrow_forward: "▶️",
            pause_button: "⏸",
            play_or_pause_button: "⏯",
            stop_button: "⏹",
            record_button: "⏺",
            next_track_button: "⏭",
            previous_track_button: "⏮",
            fast_forward: "⏩",
            rewind: "⏪",
            arrow_double_up: "⏫",
            arrow_double_down: "⏬",
            arrow_backward: "◀️",
            arrow_up_small: "🔼",
            arrow_down_small: "🔽",
            arrow_right: "➡️",
            arrow_left: "⬅️",
            arrow_up: "⬆️",
            arrow_down: "⬇️",
            arrow_upper_right: "↗️",
            arrow_lower_right: "↘️",
            arrow_lower_left: "↙️",
            arrow_upper_left: "↖️",
            arrow_up_down: "↕️",
            left_right_arrow: "↔️",
            arrow_right_hook: "↪️",
            leftwards_arrow_with_hook: "↩️",
            arrow_heading_up: "⤴️",
            arrow_heading_down: "⤵️",
            twisted_rightwards_arrows: "🔀",
            repeat: "🔁",
            repeat_one: "🔂",
            arrows_counterclockwise: "🔄",
            arrows_clockwise: "🔃",
            musical_note: "🎵",
            notes: "🎶",
            heavy_plus_sign: "➕",
            heavy_minus_sign: "➖",
            heavy_division_sign: "➗",
            heavy_multiplication_x: "✖️",
            heavy_dollar_sign: "💲",
            currency_exchange: "💱",
            tm: "™️",
            copyright: "©️",
            registered: "®️",
            wavy_dash: "〰️",
            curly_loop: "➰",
            loop: "➿",
            end: "🔚",
            back: "🔙",
            on: "🔛",
            top: "🔝",
            soon: "🔜",
            heavy_check_mark: "✔️",
            ballot_box_with_check: "☑️",
            radio_button: "🔘",
            white_circle: "⚪️",
            black_circle: "⚫️",
            red_circle: "🔴",
            large_blue_circle: "🔵",
            small_red_triangle: "🔺",
            small_red_triangle_down: "🔻",
            small_orange_diamond: "🔸",
            small_blue_diamond: "🔹",
            large_orange_diamond: "🔶",
            large_blue_diamond: "🔷",
            white_square_button: "🔳",
            black_square_button: "🔲",
            black_small_square: "▪️",
            white_small_square: "▫️",
            black_medium_small_square: "◾️",
            white_medium_small_square: "◽️",
            black_medium_square: "◼️",
            white_medium_square: "◻️",
            black_large_square: "⬛️",
            white_large_square: "⬜️",
            speaker: "🔈",
            mute: "🔇",
            sound: "🔉",
            loud_sound: "🔊",
            bell: "🔔",
            no_bell: "🔕",
            mega: "📣",
            loudspeaker: "📢",
            eye_speech_bubble: "👁‍🗨",
            speech_balloon: "💬",
            thought_balloon: "💭",
            right_anger_bubble: "🗯",
            spades: "♠️",
            clubs: "♣️",
            hearts: "♥️",
            diamonds: "♦️",
            black_joker: "🃏",
            flower_playing_cards: "🎴",
            mahjong: "🀄️",
            clock1: "🕐",
            clock2: "🕑",
            clock3: "🕒",
            clock4: "🕓",
            clock5: "🕔",
            clock6: "🕕",
            clock7: "🕖",
            clock8: "🕗",
            clock9: "🕘",
            clock10: "🕙",
            clock11: "🕚",
            clock12: "🕛",
            clock130: "🕜",
            clock230: "🕝",
            clock330: "🕞",
            clock430: "🕟",
            clock530: "🕠",
            clock630: "🕡",
            clock730: "🕢",
            clock830: "🕣",
            clock930: "🕤",
            clock1030: "🕥",
            clock1130: "🕦",
            clock1230: "🕧",
            white_flag: "🏳️",
            black_flag: "🏴",
            checkered_flag: "🏁",
            triangular_flag_on_post: "🚩",
            rainbow_flag: "🏳️‍🌈",
            afghanistan: "🇦🇫",
            aland_islands: "🇦🇽",
            albania: "🇦🇱",
            algeria: "🇩🇿",
            american_samoa: "🇦🇸",
            andorra: "🇦🇩",
            angola: "🇦🇴",
            anguilla: "🇦🇮",
            antarctica: "🇦🇶",
            antigua_barbuda: "🇦🇬",
            argentina: "🇦🇷",
            armenia: "🇦🇲",
            aruba: "🇦🇼",
            australia: "🇦🇺",
            austria: "🇦🇹",
            azerbaijan: "🇦🇿",
            bahamas: "🇧🇸",
            bahrain: "🇧🇭",
            bangladesh: "🇧🇩",
            barbados: "🇧🇧",
            belarus: "🇧🇾",
            belgium: "🇧🇪",
            belize: "🇧🇿",
            benin: "🇧🇯",
            bermuda: "🇧🇲",
            bhutan: "🇧🇹",
            bolivia: "🇧🇴",
            caribbean_netherlands: "🇧🇶",
            bosnia_herzegovina: "🇧🇦",
            botswana: "🇧🇼",
            brazil: "🇧🇷",
            british_indian_ocean_territory: "🇮🇴",
            british_virgin_islands: "🇻🇬",
            brunei: "🇧🇳",
            bulgaria: "🇧🇬",
            burkina_faso: "🇧🇫",
            burundi: "🇧🇮",
            cape_verde: "🇨🇻",
            cambodia: "🇰🇭",
            cameroon: "🇨🇲",
            canada: "🇨🇦",
            canary_islands: "🇮🇨",
            cayman_islands: "🇰🇾",
            central_african_republic: "🇨🇫",
            chad: "🇹🇩",
            chile: "🇨🇱",
            cn: "🇨🇳",
            christmas_island: "🇨🇽",
            cocos_islands: "🇨🇨",
            colombia: "🇨🇴",
            comoros: "🇰🇲",
            congo_brazzaville: "🇨🇬",
            congo_kinshasa: "🇨🇩",
            cook_islands: "🇨🇰",
            costa_rica: "🇨🇷",
            cote_divoire: "🇨🇮",
            croatia: "🇭🇷",
            cuba: "🇨🇺",
            curacao: "🇨🇼",
            cyprus: "🇨🇾",
            czech_republic: "🇨🇿",
            denmark: "🇩🇰",
            djibouti: "🇩🇯",
            dominica: "🇩🇲",
            dominican_republic: "🇩🇴",
            ecuador: "🇪🇨",
            egypt: "🇪🇬",
            el_salvador: "🇸🇻",
            equatorial_guinea: "🇬🇶",
            eritrea: "🇪🇷",
            estonia: "🇪🇪",
            ethiopia: "🇪🇹",
            eu: "🇪🇺",
            european_union: "🇪🇺",
            falkland_islands: "🇫🇰",
            faroe_islands: "🇫🇴",
            fiji: "🇫🇯",
            finland: "🇫🇮",
            fr: "🇫🇷",
            french_guiana: "🇬🇫",
            french_polynesia: "🇵🇫",
            french_southern_territories: "🇹🇫",
            gabon: "🇬🇦",
            gambia: "🇬🇲",
            georgia: "🇬🇪",
            de: "🇩🇪",
            ghana: "🇬🇭",
            gibraltar: "🇬🇮",
            greece: "🇬🇷",
            greenland: "🇬🇱",
            grenada: "🇬🇩",
            guadeloupe: "🇬🇵",
            guam: "🇬🇺",
            guatemala: "🇬🇹",
            guernsey: "🇬🇬",
            guinea: "🇬🇳",
            guinea_bissau: "🇬🇼",
            guyana: "🇬🇾",
            haiti: "🇭🇹",
            honduras: "🇭🇳",
            hong_kong: "🇭🇰",
            hungary: "🇭🇺",
            iceland: "🇮🇸",
            india: "🇮🇳",
            indonesia: "🇮🇩",
            iran: "🇮🇷",
            iraq: "🇮🇶",
            ireland: "🇮🇪",
            isle_of_man: "🇮🇲",
            israel: "🇮🇱",
            it: "🇮🇹",
            jamaica: "🇯🇲",
            jp: "🇯🇵",
            crossed_flags: "🎌",
            jersey: "🇯🇪",
            jordan: "🇯🇴",
            kazakhstan: "🇰🇿",
            kenya: "🇰🇪",
            kiribati: "🇰🇮",
            kosovo: "🇽🇰",
            kuwait: "🇰🇼",
            kyrgyzstan: "🇰🇬",
            laos: "🇱🇦",
            latvia: "🇱🇻",
            lebanon: "🇱🇧",
            lesotho: "🇱🇸",
            liberia: "🇱🇷",
            libya: "🇱🇾",
            liechtenstein: "🇱🇮",
            lithuania: "🇱🇹",
            luxembourg: "🇱🇺",
            macau: "🇲🇴",
            macedonia: "🇲🇰",
            madagascar: "🇲🇬",
            malawi: "🇲🇼",
            malaysia: "🇲🇾",
            maldives: "🇲🇻",
            mali: "🇲🇱",
            malta: "🇲🇹",
            marshall_islands: "🇲🇭",
            martinique: "🇲🇶",
            mauritania: "🇲🇷",
            mauritius: "🇲🇺",
            mayotte: "🇾🇹",
            mexico: "🇲🇽",
            micronesia: "🇫🇲",
            moldova: "🇲🇩",
            monaco: "🇲🇨",
            mongolia: "🇲🇳",
            montenegro: "🇲🇪",
            montserrat: "🇲🇸",
            morocco: "🇲🇦",
            mozambique: "🇲🇿",
            myanmar: "🇲🇲",
            namibia: "🇳🇦",
            nauru: "🇳🇷",
            nepal: "🇳🇵",
            netherlands: "🇳🇱",
            new_caledonia: "🇳🇨",
            new_zealand: "🇳🇿",
            nicaragua: "🇳🇮",
            niger: "🇳🇪",
            nigeria: "🇳🇬",
            niue: "🇳🇺",
            norfolk_island: "🇳🇫",
            northern_mariana_islands: "🇲🇵",
            north_korea: "🇰🇵",
            norway: "🇳🇴",
            oman: "🇴🇲",
            pakistan: "🇵🇰",
            palau: "🇵🇼",
            palestinian_territories: "🇵🇸",
            panama: "🇵🇦",
            papua_new_guinea: "🇵🇬",
            paraguay: "🇵🇾",
            peru: "🇵🇪",
            philippines: "🇵🇭",
            pitcairn_islands: "🇵🇳",
            poland: "🇵🇱",
            portugal: "🇵🇹",
            puerto_rico: "🇵🇷",
            qatar: "🇶🇦",
            reunion: "🇷🇪",
            romania: "🇷🇴",
            ru: "🇷🇺",
            rwanda: "🇷🇼",
            st_barthelemy: "🇧🇱",
            st_helena: "🇸🇭",
            st_kitts_nevis: "🇰🇳",
            st_lucia: "🇱🇨",
            st_pierre_miquelon: "🇵🇲",
            st_vincent_grenadines: "🇻🇨",
            samoa: "🇼🇸",
            san_marino: "🇸🇲",
            sao_tome_principe: "🇸🇹",
            saudi_arabia: "🇸🇦",
            senegal: "🇸🇳",
            serbia: "🇷🇸",
            seychelles: "🇸🇨",
            sierra_leone: "🇸🇱",
            singapore: "🇸🇬",
            sint_maarten: "🇸🇽",
            slovakia: "🇸🇰",
            slovenia: "🇸🇮",
            solomon_islands: "🇸🇧",
            somalia: "🇸🇴",
            south_africa: "🇿🇦",
            south_georgia_south_sandwich_islands: "🇬🇸",
            kr: "🇰🇷",
            south_sudan: "🇸🇸",
            es: "🇪🇸",
            sri_lanka: "🇱🇰",
            sudan: "🇸🇩",
            suriname: "🇸🇷",
            swaziland: "🇸🇿",
            sweden: "🇸🇪",
            switzerland: "🇨🇭",
            syria: "🇸🇾",
            taiwan: "🇹🇼",
            tajikistan: "🇹🇯",
            tanzania: "🇹🇿",
            thailand: "🇹🇭",
            timor_leste: "🇹🇱",
            togo: "🇹🇬",
            tokelau: "🇹🇰",
            tonga: "🇹🇴",
            trinidad_tobago: "🇹🇹",
            tunisia: "🇹🇳",
            tr: "🇹🇷",
            turkmenistan: "🇹🇲",
            turks_caicos_islands: "🇹🇨",
            tuvalu: "🇹🇻",
            uganda: "🇺🇬",
            ukraine: "🇺🇦",
            united_arab_emirates: "🇦🇪",
            gb: "🇬🇧",
            uk: "🇬🇧",
            us: "🇺🇸",
            us_virgin_islands: "🇻🇮",
            uruguay: "🇺🇾",
            uzbekistan: "🇺🇿",
            vanuatu: "🇻🇺",
            vatican_city: "🇻🇦",
            venezuela: "🇻🇪",
            vietnam: "🇻🇳",
            wallis_futuna: "🇼🇫",
            western_sahara: "🇪🇭",
            yemen: "🇾🇪",
            zambia: "🇿🇲",
            zimbabwe: "🇿🇼"
        }, r.data.happy = r.data.smile, n.exports = r
    }), $__System.registerDynamic("4a", ["11", "13", "12", "1a", "1b", "1c"], !0, function (e, t, n) {
        "use strict";
        this || self, e("11"), e("13");
        var i = e("12"), r = e("1a").SnapFlag, o = (i.Node, i.TYPE, e("1b"), e("1c")), a = {
            "(": ")",
            "[": "]",
            "{": "}",
            '"': '"',
            "'": "'",
            "~": "~",
            "^": "^",
            "=": "=",
            "*": "*",
            "`": "`",
            $: "$",
            _: "_"
        }, s = null;
        var l = null;
        var c = null;
        t.hanldePair = function (e, t, n, i, s, l) {
            if (!File.option.noPairingMatch) {
                var d, u, h, f;
                if (/^[\]\)\}'"]$/.exec(t)) {
                    if (d = e.findElemById(n.cid).rawText(), t === d.substring(i.start, i.start + 1)) return w(), s || !0;
                    if ("'" == t || '"' == t) {
                        if ("" == d) return C();
                        u = (f = d.substring(0, i.start)).slice(-1);
                        var p = "'" == t;
                        if (o.shouldTriggerReplaceQuote(!0) && -1 == "\"'".indexOf(o.userQuote(p ? 2 : 0)) && o.shouldTriggerReplace(e, l)) {
                            if (h = d.substring(i.start, i.start + 1), o.userQuote(p ? 3 : 1) == h) return w(), s || !0;
                            if (o.userQuote(p ? 2 : 0) == u) return function (t) {
                                var i = e.selection.getRangy(), o = document.createTextNode(t);
                                return e.undo.completeSnap(!0), e.undo.snap(n.cid, r.ADD), i.insertNode(o), o.parentElement.normalize(), w(), s && e.undo.register(s), !0
                            }(o.userQuote(p ? 3 : 1))
                        }
                        if (t != u && "\\" != u && !/\w/.exec(d.substring(Math.max(0, i.start - 1), i.start + 1)) && !function (e, t) {
                            for (var n, i, r = e.length, o = 0; o < r; o++) {
                                var a = e[o];
                                "'" != a && '"' != a || (n ? n == a ? (n = null, i = null) : i = i ? null : a : n = a)
                            }
                            return t == n || t == i
                        }(f, t)) return C()
                    }
                } else if (/^[\[\(\{]$/.exec(t)) {
                    if (h = (d = e.findElemById(n.cid).rawText()).substring(i.start, i.start + 1), !/[^\[\]{}()"'\s`>$]/.exec(h)) return C()
                } else if (File.option.autoPairExtendSymbol && function () {
                    if (!c) {
                        var e = "*`_";
                        File.option.enableInlineMath && (e += "$"), c = new RegExp("^[" + e + "]$")
                    }
                    return c
                }().exec(t)) {
                    if (l && l.commonAncestorContainer && l.commonAncestorContainer.parentElement && ("CODE" == l.commonAncestorContainer.parentElement.tagName && "`" != t || "SCRIPT" == l.commonAncestorContainer.parentElement.tagName && "$" != t)) return;
                    if (d = e.findElemById(n.cid).rawText(), File.option.enableInlineMath && "$" == d.substring(i.start - 1, i.start) && /[*`^_~=]/.exec(t)) return;
                    var m = (f = f || d.substring(0, i.start))[f.length - 1] || "";
                    if ("\\" == m) return !1;
                    h = d.substring(i.start, i.start + 1);
                    var g = d.substring(i.start + 1, i.start + 2), v = /[*_]/.exec(t);
                    if (h == t) {
                        if (v) {
                            if (v && g) return w() || !0;
                            var y = $(e.selection.getRangy().commonAncestorContainer);
                            return y.closest(".md-after").length && y.parent().parent("[md-inline='strong'], [md-inline='em']").length ? w() || !0 : (f = d.substring(0, i.start), /[*_]$/.exec(f) ? C() : w() || !0)
                        }
                        return w() || !0
                    }
                    var b = 0 == m.trim().length;
                    if (b || !function (e, t) {
                        if ("`" == t && /``$/.exec(e)) return !0;
                        e.replace(/\\[*`_$]/g, ""), "_" == t && (e = e.replace(/([a-z])_([a-z])/gi, ""));
                        for (var n = e.length, i = !1, r = 0; r < n; r++) e[r] == t && (i = !i);
                        return i
                    }(f, t)) {
                        if (b && !/^[^\s\>\)\]}'";:.,?!~*\/&#=_+-]/.exec(h)) return C();
                        if ((m + "a").trim().split(/\b/).length > 1) return C()
                    }
                }
                return !1
            }

            function w() {
                var t = e.selection.rangy.createRange();
                i.end++, i.start++, t.moveToBookmark(i), t.select(t.isBackward), s && s.redo.push(e.selection.buildUndo())
            }

            function C() {
                var i = e.selection.getRangy(), c = document.createTextNode(t + a[t]);
                e.undo.completeSnap(!0), e.undo.snap(n.cid, r.ADD), i.insertNode(c), o.shouldTriggerReplaceQuote(!0) && /['"]/.exec(t) && o.shouldTriggerReplace(e, l) && (e.undo.snap(n.cid, r.REPLACE), o.replaceQuote(c));
                var d = c.textContent.toString().length > 2;
                return c.parentElement.normalize(), w(), d && w(), s && e.undo.register(s), !0
            }
        }, t.surroundPair = function (e, t, n) {
            if (!File.option.noPairingMatch) {
                var i, l, c, d = $(n.commonAncestorContainer).closest("[cid]"),
                    u = $(n.commonAncestorContainer).closest(".md-def-content:not(.md-def-url)");
                if ((d.length && !d.find("[cid], .md-def-name").length || u.length) && function () {
                    if (!s) {
                        var e = "\\{\\(\\[\"'";
                        File.option.autoPairExtendSymbol && (e += "*`~_", File.option.enableInlineMath && (e += "$"), File.option.enableSuperscript && (e += "^"), File.option.enableHighlight && (e += "=")), s = new RegExp("^[" + e + "]$")
                    }
                    return s
                }().exec(t)) {
                    l = e.findNodeByElem(d), e.undo.snap(l.cid, r.REPLACE, void 0, !0), d = u.length ? u : d, i = n.getBookmark(d[0]), c = l.get("text"), l.set("text", c.substring(0, i.start) + t + c.substring(i.start, i.end) + a[t] + c.substring(i.end)), (n = e.selection.rangy.createRange()).moveToBookmark(i), e.selection.deRange(n);
                    var h = document.createTextNode(t), f = document.createTextNode(a[t]);
                    return n.insertNodeAtEnd(f), n.insertNode(h), i.start++, i.end++, n.moveToBookmark(i), n.select(n.isBackward), o.shouldTriggerReplaceQuote(!0) && /['"]/.exec(t) && !/['"]/.exec(o.userQuote('"' == t ? 0 : 2)) && o.shouldTriggerReplace(e, n) && (e.undo.snap(l.cid, r.REPLACE, void 0, !0), o.replaceQuote(h, f), n.moveToBookmark(i), n.select(n.isBackward)), !0
                }
            }
        }, t.tryRemovePairStart = function (e, t) {
            var n = t.toString();
            if (!File.option.noPairingMatch && (1 != t.endOffset || !$(t.endContainer).closest(".md-after, .md-before").length) && (function () {
                if (!l) {
                    var e = "\\{\\(\\[\"'";
                    File.option.autoPairExtendSymbol && (e += "*`~_", File.option.enableInlineMath && (e += "$"), File.option.enableSuperscript && (e += "^")), l = new RegExp("[" + e + "]")
                }
                return l
            }().exec(n) || o.userQuote(0, !0) == n || o.userQuote(2, !0) == n)) {
                var i = $(t.commonAncestorContainer).closest("[cid]"), r = i.text(), s = t.getBookmark(i[0]),
                    c = r.substring(s.end, s.end + 1);
                if (a[n] == c || o.userQuote(0, !0) == n && o.userQuote(1, !0) == c || o.userQuote(2, !0) == n && o.userQuote(3, !0) == c) return s.end++, t.moveToBookmark(s), t
            }
        }
    }), $__System.registerDynamic("4b", ["11", "13", "12", "1a", "1b", "18", "43", "49", "2b", "45", "28", "31", "4a"], !0, function (e, t, n) {
        this || self, e("11"), e("13");
        var i = e("12"), r = e("1a"), o = r.SnapFlag, a = i.Node, s = i.TYPE,
            l = (i.NodeCollectionUtils, e("1b"), e("18"), e("43")), c = (e("49"), e("2b")),
            d = (e("45"), e("28"), e("31"), e("4a")), u = (window.reqnode && reqnode("electron").remote, "skipCommand"),
            h = $("content"), f = function (e, t) {
                var n = t.get("parent"), i = n && n.get("parent");
                if (i && i.get("style") == a.ListType.task && !n.get("before") && a.isType(n, s.paragraph)) {
                    var o = r.makeEmptyCommand(e.selection.buildUndo());
                    return o.undo.push(r.buildReplaceUndo(i)), i.unset("style"), i.unset("checked"), e.findElemById(i.cid).replaceWith(i.toHTML()), o.redo.push(r.buildReplaceUndo(i)), e.undo.exeCommand(o.undo[0]), o.redo.push(e.selection.buildUndo()), o
                }
            }, p = function (e, t, n) {
                if (a.isType(t.get("parent"), s.blockquote) && (n || !t.get("before"))) {
                    var o = r.makeEmptyCommand(e.selection.buildUndo()), l = t.upStream();
                    return r.append(o, l.command), e.findElemById(l.oldCid).replaceWith(l.newHtml), e.undo.exeCommand(o.undo[0]), o.redo.push(e.selection.buildUndo()), o
                }
                if (a.isType(t.get("parent"), s.list_item) && (n || !t.get("parent").get("before") && !t.get("before"))) {
                    o = r.makeEmptyCommand(e.selection.buildUndo());
                    var c = t.get("parent"), d = c.get("parent");
                    o.undo.push(r.buildReplaceUndo(d)), d.unset("start"), c.set("parent", null), c.set("after", null), d.insert(c, !0);
                    var u = c.unwrap();
                    return r.addUndoForInsertArray(o, u), e.findElemById(d.id).before(i.NodeCollectionUtils.toHTML(u)), d.get("children").length ? (e.findElemById(d.id).replaceWith(d.toHTML()), o.redo.push(r.buildReplaceUndo(d))) : (r.addUndoForRemove(o, d), d.remove(), e.findElemById(d.id).remove()), e.selection.jumpIntoElemBegin(e.findElemById(u[0].id)), o.redo.push(e.selection.buildUndo()), o
                }
            }, m = function (e, t, n, i) {
                var o = r.makeEmptyCommand(e.selection.buildUndo());
                return o.undo.push(r.buildReplaceUndo(t)), t.set("type", s.paragraph), t.clearChildren(), n ? t.set("text", "") : t.set("text", t.get("text").replace(/\u200B|(\r?\n)/g, "")), a.normalizeNode(t), o.redo.push(r.buildReplaceUndo(t)), e.findElemById(t.id).replaceWith(t.toHTML()), e.selection.jumpIntoElemBegin(e.findElemById(t.id)), o.redo.push(e.selection.buildUndo()), !i && $(e.sessionStr).trigger("cursorChange"), o
            }, g = function (e, t, n, i) {
                if (t && t.length) {
                    n && n.preventDefault(), !i && e.undo.completeSnap(!0);
                    var o = e.findNodeByElem(t), a = r.makeEmptyCommand(e.selection.buildUndo());
                    return o ? (o.set("text", ""), a = r.append(a, m(e, o))) : (o = e.findNodeByElem(t.closest("[mdtype]")), a.undo.push(r.buildReplaceUndo(o)), e.selection.moveLeftOrRight(!0, n), t.remove(), e.store(o.id), a.redo.push(r.buildReplaceUndo(o)), a.redo.push(e.selection.buildUndo())), !i && e.undo.register(a), a
                }
            }, v = function (e, t, n, v, y) {
                var b, w, C, x, k = e.selection.includeTrailMeta(e.selection.getRangy()),
                    S = k && e.selection.deRange(k.cloneRange()), E = S && !S.collapsed, F = document.activeElement, _ = !1,
                    T = k;

                function M(e, t, n) {
                    var i, r = e;
                    if (e == t) return null;
                    for (i = e.get(n); i;) $("[cid='" + i.id + "']").remove(), i.remove(), i = e.get(n);
                    return M(e.get("parent"), t, n), r
                }

                function A(e, t, n, i, o) {
                    var s, l, d, u = t.cloneRange(), h = e.findElemById(n.id);
                    return u.setEndAfter(h[0]), e.selection.deRange(u), l = e.findNodeByElem(e.getMarkElem(u.startContainer)), !o && $(u.startContainer).closest("table").length ? (r.append(i, B(e, u, !0)), l = e.findNodeByElem($(u.startContainer).closest("[mdtype='table']")), n.contains(l) && (M(l, n, "after"), 0 === l.getText().length) ? (r.append(i, m(e, l)), "abortAndSkipCursor") : "abort") : (i.undo.push(r.buildReplaceUndo(n)), s = $(u.extractContents()), a.isType.apply(null, [n].concat(c.CONST.Selectable)) && r.append(i, m(e, n, !0, !0)), e.store(l, !0), e.findElemById(l.cid).replaceWith(l.toHTML()), d = M(l, n, "after"), !!(s.text().length || s.find("img").length || d) && (i.redo.push(r.buildReplaceUndo(n)), l))
                }

                function N(e, t, n, i, o) {
                    var a, s, l, c = t.cloneRange(), d = e.findElemById(n.id);
                    if (c.setStartBefore(d[0]), e.selection.deRange(c), !o && $(c.endContainer).closest("table").length) return r.append(i, B(e, c, !0)), s = e.findNodeByElem($(c.endContainer).closest("[mdtype='table']")), "abort";
                    i.undo.push(r.buildReplaceUndo(n)), s = e.findNodeByElem(e.getMarkElem(e.selection.getEndNode(c))), a = $(c.extractContents()), e.store(s, !0);
                    var u = e.findElemById(s.cid);
                    if (l = M(s, n, "before"), a.text().length || a.find("img").length || l) {
                        for (i.redo.push(r.buildReplaceUndo(n)); u.parent().closest(".md-task-list-item").length;) u = u.parent().closest(".md-task-list-item");
                        return u.hasClass("md-task-list-item") ? u.replaceWith(e.findNodeByElem(u).toHTML()) : u.replaceWith(s.toHTML()), s
                    }
                    return u.replaceWith(s.toHTML()), !1
                }

                function L(e, t, n, i, o, l, c) {
                    var d, u, h, f;

                    function p(e, t) {
                        return e == t || e.get("before") || e.get("after") ? e : p(e.get("parent"), t)
                    }

                    var m = a.isEmptyBlock(i);
                    if (!m || i == o || a.isEmptyBlock(o) && !c) if (m && i == o && o.isBlock()) o.set("type", s.paragraph), o.set("text", ""), o.clearChildren(), e.findElemById(o.id).replaceWith(o.toHTML()), e.selection.jumpIntoElemBegin(e.findElemById(o.id)), l.redo.push(e.selection.buildUndo()); else {
                        if (console.assert(t != n, "Error on spliceStartAndEnd"), t != n) {
                            if (d = n.safeGetStrAttr("text"), f = p(n, o), r.addUndoForRemove(l, f), e.findElemById(f.id).remove(), f.remove(), u = $(t.toHTML()).rawText().length, l.undo.push(r.buildReplaceUndo(i)), a.isType(t, s.def_link)) if (t.safeGetStrAttr("title").length) t.set("title", t.get("title") + d); else {
                                var g = /["']([^"]*)["']\s*$/g.exec(d);
                                d = d.replace(/"([^"])*"\s*$/, ""), g && t.set("title", g[1]), t.set("href", t.get("href") + d)
                            } else t.set("text", t.safeGetStrAttr("text") + d);
                            if (f != o && o !== n && o.get("before") == i && a.isType(i, s.list_item)) {
                                var v = o.getFirstChild();
                                v.set("before", i.getLastChild()), o.giveChildrenTo(i, v), r.addUndoForRemove(l, o), e.findElemById(o.id).remove(), o.remove()
                            }
                            l.redo.push(r.buildReplaceUndo(i)), e.findElemById(i.id).replaceWith(i.toHTML()), h = e.findElemById(t.id)
                        }
                        h = e.findElemById(t.id), e.selection.restoreSelection(h, u), l.redo.push(e.selection.buildUndo())
                    } else e.findElemById(i.id).remove(), r.addUndoForRemove(l, i), i.remove(), f = p(n, o), e.findElemById(f.id).replaceWith(f.toHTML()), e.selection.jumpIntoElemBegin(e.findElemById(f.id))
                }

                function R(e, t) {
                    var n = t.get("before");

                    function i(t) {
                        var n = r.makeEmptyCommand(e.selection.buildUndo());
                        return r.addUndoForRemove(n, t), e.findElemById(t.id).remove(), t.remove(), n.redo.push(e.selection.buildUndo()), n
                    }

                    return a.isType(n, s.hr) ? i(n) : n && !a.isEmptyBlock(t) && a.isEmptyBlock(n) ? i(n) : !n && a.isType(t.get("parent"), s.list_item) && (n = t.get("parent").get("before")) && 1 == n.get("children").length && a.isEmptyBlock(n.get("children").at(0)) ? i(n) : void 0
                }

                function D(e, i) {
                    if (a.isType(i, s.table_cell)) {
                        var o = i.get("parent").get("parent");
                        if (t && !n && !i.get("before") && !i.get("parent").get("before") && e.tableEdit.isTableEmpty(o)) return e.tableEdit.deleteTable(e.findElemById(o.cid), !0);
                        var c = l.getSibling(i, "before");
                        return c && (C = r.makeEmptyCommand(e.selection.buildUndo()), e.selection.jumpIntoElemEnd(e.findElemById(c.id)), C.redo.push(e.selection.buildUndo())), C
                    }
                }

                function O(e, t) {
                    if (a.isType(t.get("parent"), s.list_item) && t.get("parent").get("before") && !t.get("before")) return function (e, t) {
                        var n, o = r.makeEmptyCommand(e.selection.buildUndo()), a = t.get("before"),
                            s = a.get("children").at(a.get("children").length - 1).getLastBrother();
                        return o.undo.push(r.buildReplaceUndo(a.get("parent"))), e.findElemById(t.id).remove(), s.insert(t), n = t.unwrap(), o.redo.push(r.buildReplaceUndo(a.get("parent"))), e.findElemById(s.id).after(i.NodeCollectionUtils.toHTML(n)), e.selection.jumpIntoElemBegin(e.findElemById(n[0].id)), o.redo.push(e.selection.buildUndo()), o
                    }(e, t.get("parent"))
                }

                function I(e, t) {
                    if (a.isType(t, a.backToParagraphBeforeDelete)) return e.stylize.changeBlock(s.paragraph, t), u
                }

                function P(e, t, n, i, o) {
                    for (var l = [D, R, f, p, O, I], c = null, d = 0; d < l.length; d++) if (c = l[d](e, t)) return c;
                    if (n = n || t, o = o || n.get("before"), i = i || o && o.getVeryFirst(!0), !c && i && L(e, i, t, o, n, c = r.makeEmptyCommand(e.selection.buildUndo())), !c && !i && a.isType(t, s.paragraph) && a.isEmptyBlock(t) && t.get("after")) {
                        c = r.makeEmptyCommand(e.selection.buildUndo());
                        var u = t.get("after").cid;
                        r.addUndoForRemove(c, t), t.remove(), e.findElemById(t.cid).remove(), e.selection.jumpIntoElemBegin(e.findElemById(u)), c.redo.push(e.selection.buildUndo())
                    }
                    return c
                }

                function B(e, t, n) {
                    var i, o = e.selection.getDetailPos(t.startContainer, t.startOffset),
                        l = e.selection.getDetailPos(t.endContainer, t.endOffset), c = r.makeEmptyCommand(),
                        d = e.getMarkElem(o[0]), u = e.getMarkElem(l[0]), h = d.closest('[mdtype="table"]'),
                        f = e.findNodeByElem(h), p = e.findNodeByElem(d), m = e.findNodeByElem(u);
                    if (n || ((i = t.cloneRange()).collapse(!0), i = e.selection.buildUndo(i)), t.setStart(o[0], o[1]), t.setEnd(l[0], l[1]), p == m) return t.collapsed || !a.isType(p, s.table_cell) || d[0] != t.commonAncestorContainer && !d[0].contains(t.commonAncestorContainer) || (c.undo.push(r.buildReplaceUndo(p)), t.extractContents(), e.store(p, !0), c.redo.push(r.buildReplaceUndo(p)), c.redo.push(e.selection.buildUndo(t))), c;
                    c.undo.push(r.buildReplaceUndo(f));
                    var g, v, y = A(e, t, p, c, !0), b = N(e, t, m, c, !0);
                    for (y && (y.unset("marginLeft"), y.unset("marginRight")), b && (b.unset("marginLeft"), b.unset("marginRight")), g = e.tableEdit.getSibling(p, "after"); g && g != m;) g.set("text", ""), g.unset("marginLeft"), g.unset("marginRight"), v = !0, g = e.tableEdit.getSibling(g, "after");
                    return y || b || v ? (e.findElemById(f.id).replaceWith(f.toHTML()), c.redo.push(r.buildReplaceUndo(f))) : c.undo.pop(), n || (c.redo.push(i), e.undo.exeCommand(i)), c
                }

                function H(t) {
                    return e.selection.deRange(t), b = e.getMarkElem(t.commonAncestorContainer), w = e.nodeMap.allNodes.get(b.attr("cid")), x = t.getBookmark(b[0]), b.length && !w.get("children").length && 0 == x.start && !n
                }

                function U() {
                    var n = null;
                    if (a.isType(w.get("before"), a.TYPE.hr, a.TYPE.toc) && (n = w.get("before")), e.undo.completeSnap(!0), t && t.preventDefault(), $(".md-tooltip-remove").remove(), b.prev("[cid]").addClass("md-expand"), (C = P(e, w)) === u) ; else if (!v) return n && (e.selection.selectNode(n), C.redo.push(e.selection.buildUndo())), e.undo.register(C), e.refresh(), n || e.findElemById(w.cid).trigger("refocus"), e.refocus(), e.selection.scrollAdjust(), C
                }

                var j = $(document.activeElement).closest(".CodeMirror");
                if (j.length) {
                    j[0].CodeMirror.execCommand("delCharBefore")
                } else {
                    if (a.isType(F.getAttribute("mdtype"), a.TYPE.hr, a.TYPE.toc)) {
                        var W = $(F).closest("[mdtype]");
                        return g(e, W, t, v)
                    }
                    if (F.getAttribute("mdtype") == s.math_block) return t && t.preventDefault(), e.mathBlock.remove(F.getAttribute("cid")), C;
                    if (n && "Backspace" != n ? !0 === n && (n = "Delete") : n = !1, S) {
                        if ($(S.commonAncestorContainer).closest("[mdtype='table_row']").length && t && t.shiftKey && (File.isMac ? t.metaKey : t.ctrlKey)) return t.preventDefault(), e.tableEdit.deleteRow(), u;
                        if (S.collapsed) {
                            if (n) {
                                if ("Delete" == n && (q = S, e.selection.deRange(q), b = e.getMarkElem(q.commonAncestorContainer), w = e.nodeMap.allNodes.get(b.attr("cid")), x = q.getBookmark(b[0]), "Delete" == n && a.isType(b.attr("mdtype"), s.paragraph, s.heading) && !w.get("children").length && 0 == x.start && 0 == b.text().length && (e.undo.completeSnap(!0), C = w.get("after") ? function (t, n) {
                                    var i = r.makeEmptyCommand(e.selection.buildUndo());
                                    return e.findElemById(t.cid).remove(), r.addUndoForRemove(i, t), t.remove(), e.selection.jumpIntoElemBegin(e.findElemById(n)), i.redo.push(e.selection.buildUndo()), i
                                }(w, w.get("after").getVeryFirst().cid) : null))) return v || (e.undo.register(C), e.refocus()), t && t.preventDefault(), C
                            } else if (H(S)) return U();
                            if (!0 === (S = function () {
                                var i = t && (File.isNodeHtml ? t.ctrlKey : t.altKey), r = !1;
                                return "delSelection" == n ? e.selection.getRangy() : (i || (r = e.selection.extendCharFromCollapse(S, !n)), r || (_ = !0, n ? (window.getSelection().modify("extend", "forward", i ? "word" : "character"), S = e.selection.getRangy()) : (window.getSelection().modify("extend", "backward", i ? "word" : "character"), S = i ? (/\n/.exec(window.getSelection().toString()) ? (S.setStart(S.startContainer, 0), S.select(S.isBackward)) : S = e.selection.getRangy(), S) : e.selection.getRangy())), !n && /^\u200b|\007F$/g.exec(S.toString()) ? (e.selection.extendCharFromCollapse(S, !0), H(S) || S) : S)
                            }())) return U();
                            if (!n && d.tryRemovePairStart(e, S) && (y = !1), "delSelection" == n && S && S.collapsed) return t && t.preventDefault(), r.makeEmptyCommand()
                        } else !function (t) {
                            if (e.selection.selectWordTime && File.isMac) if (n) "Delete" == n && t.endContainer.nodeType === document.TEXT_NODE && (i = t.endContainer.textContent.charAt(t.endOffset), /\s/.exec(i) && (t.endOffset++, T = t.cloneRange())); else if (t.startOffset > 0 && t.startContainer.nodeType === document.TEXT_NODE) {
                                var i = t.startContainer.textContent.charAt(t.startOffset - 1);
                                /\s/.exec(i) && (t.startOffset--, T = t.cloneRange())
                            }
                        }(S);
                        var q;
                        (z = S).startContainer.parentElement && z.startContainer.parentElement.classList.contains("md-pants") && 0 == z.startOffset && z.setStart(z.startContainer.parentElement, 0);
                        var z;
                        if (y && !(S.commonAncestorContainer.nodeType != document.TEXT_NODE || 0 == n && S.startOffset <= 1 || "Delete" == n && S.endOffset >= S.commonAncestorContainer.textContent.length - 1)) return null;
                        if (e.selection.selectWordTime = null, e.selection.deRange(S), b = e.getMarkElem(S.commonAncestorContainer), w = e.nodeMap.allNodes.get(b.attr("cid")), _ && (window.getSelection().removeAllRanges(), window.getSelection().addRange(k.nativeRange)), b.length && !w.get("children").length) {
                            if (b.get("type") !== s.fences) return function (e, t, n, i, l) {
                                var c, d = 3 !== n.commonAncestorContainer.nodeType, u = e.getNode(i.attr("cid"));
                                l || (e.undo.snap(u.cid, E ? o.DELETE_ACCROSS_BLOCK : o.DELETE), e.brush.clearAndPause());
                                var f = e.selection.buildUndo(T);
                                if ((C = r.makeEmptyCommand(f)).undo.push(r.buildReplaceUndo(u)), !d && f && f.startId == f.endId && a.isType(u, s.line)) {
                                    var p = (i.text().substring(0, f.start).match(/\u200b/g) || []).length,
                                        m = (i.text().substring(0, f.end).match(/\u200b/g) || []).length;
                                    e.undo.snapSelection && e.undo.snapSelection.end == f.end && e.undo.snapSelection.start == f.start ? (e.undo.snapSelection.start -= p, e.undo.snapSelection.end -= m) : (f.start -= p, f.end -= m)
                                }
                                var g = h.scrollTop();
                                if (!n.commonAncestorContainer.contains(document.querySelector("#write"))) {
                                    if (c = n.extractContents(), g != h.scrollTop() && e.undo.clearEventTimer(), e.store(u.cid), C.redo.push(r.buildReplaceUndo(u)), a.isType(u, s.def_link, s.def_footnote) || u.getText().length || (e.findElemById(u.cid).html($(u.toHTML()).html()), n = e.selection.getRangy(), e.selection.deRange(n, !0)), C.redo.push(e.selection.buildUndo()), c.querySelector("img"), n.collapse(!1), d) {
                                        var v = i.attr("cid");
                                        d = e.selection.saveSelection(i, n), n.setStart(i[0], 0);
                                        var y = (n.toString().match(/(:\u200b)|(\u200b:)/g) || []).length;
                                        e.store(v, !0), i.replaceWith(e.nodeMap.allNodes.get(v).toHTML()), i = e.findElemById(v), d.start -= y, d.end -= y, e.selection.restoreSelection(i, d), e.focusCid = null, e.refocus()
                                    }
                                    return e.brush.addToQueue(i.attr("cid")), !l && e.brush.resume(!0), t && (t.preventDefault(), $("#write").trigger("input")), C
                                }
                            }(e, t, S, b, v);
                            !v && e.undo.completeSnap(!0), C = g(e, b, t, v)
                        } else !v && e.undo.completeSnap(!0), t && t.preventDefault(), $(".md-tooltip-remove").remove(), C = function (e, t, n) {
                            if (!document.contains(t.startContainer) && !(t = e.selection.getRangy())) return r.makeEmptyCommand();
                            var i = e.selection.getDetailPos(t.startContainer, t.startOffset),
                                o = e.selection.getDetailPos(t.endContainer, t.endOffset), s = e.getMarkElem(i[0]),
                                l = e.getMarkElem(o[0]), c = e.findNodeByElem(s), d = e.findNodeByElem(l);
                            if (!c || !d) return r.makeEmptyCommand();
                            var u = a.getTreePosition(c, d), h = u[1], f = u[2],
                                p = r.makeEmptyCommand(e.selection.buildUndo()), m = t.cloneRange();
                            if (s[0] == l[0]) return p;
                            if (m.collapse(!0), m = e.selection.buildUndo(m), t.setStart(i[0], i[1]), t.setEnd(o[0], o[1]), $(t.commonAncestorContainer).closest('[mdtype="table"]').length) return r.append(p, B(e, t));
                            var g = A(e, t, h, p), v = N(e, t, f, p), y = h.get("after"), b = [];
                            for (t = e.selection.getRangy(), e.selection.deRange(t, !0); y && y != f;) b.push(y), y = y.get("after");
                            return r.addUndoForRemoveArray(p, b, h, f), b.map(function (t) {
                                e.findElemById(t.id).remove(), t.remove()
                            }), "abort" == g || "abort" == v || "abortAndSkipCursor" == g ? ("abortAndSkipCursor" != g && (t.collapse(!0), p.redo.push(m), e.undo.exeCommand(m)), !1 === v && 0 == d.getText().length && (r.addUndoForRemove(p, d), e.findElemById(d.id).remove(), d.remove())) : g || v || b.length || n ? L(e, g || c, v || d, h, f, p, g) : p = P(e, d, f, c, h), e.refresh(), p
                        }(e, S, n), v || (e.undo.register(C), e.refocus()), e.selection.scrollAdjust();
                        return C
                    }
                }
            }, y = {"[mdtype='hr']": v, "tr[mdtype='table_row']": l.deleteRow, ".md-toc": g};
        t.backspaceHandler = v, t.deleteSelectable = g, t.deleteLineProcessor = y, t.deleteLine = function (e) {
            var t = $(document.activeElement).closest(".CodeMirror");
            if (t.length) t[0].CodeMirror.execCommand("deleteLine"); else {
                var n, i = e.getMarkElem();
                if (i && i.length) {
                    for (n in y) if (i.closest(n).length) return void y[n](e, i.closest(n));
                    !function (t) {
                        var n = t.hasClass("md-expand");
                        t.addClass("md-expand"), window.getSelection().modify("move", "backward", "sentence"), window.getSelection().modify("extend", "forward", "sentence"), n && t.removeClass("md-expand"), v(e, null, "delSelection")
                    }(i)
                }
            }
        }, t.deleteBlock = function (e) {
            e || File.editor;
            var t = e.getNode(e.focusCid);
            if (t) {
                e.undo.completeSnap(!0);
                var n = r.makeEmptyCommand(e.selection.buildUndo());
                t = t.getClosetBlock(!1), !a.isType(t, s.paragraph) || t.get("before") || t.get("after") || !t.get("parent") || a.isVirtualBlock(t.get("parent")) || (t = t.get("parent"));
                var i = t.getClosetBlock(!0).getVeryFirstBrotherIncludeTopBlock(!1, !0);
                i ? (e.findElemById(t.cid).remove(), r.addUndoForRemove(n, t), t.remove()) : (t.set("type", s.paragraph), t.set("text", ""), t.clearChildren(), n.redo.push(e.undo.buildReplaceUndo(t)), e.findElemById(t.cid).replaceWith(t.toHTML())), e.selection.jumpIntoElemBegin(e.findElemById(i.cid)), n.redo.push(e.selection.buildUndo()), e.refocus(i.cid), e.undo.register(n)
            }
        }, t.backToParagraph = m
    }), $__System.registerDynamic("4c", ["11", "13", "12", "1a", "1b", "18", "43", "49", "2b", "45", "17", "31", "4b"], !0, function (e, t, n) {
        "use strict";
        this || self, e("11");
        var i = e("13"), r = e("12"), o = e("1a"), a = (o.SnapFlag, r.Node), s = r.TYPE, l = r.NodeCollectionUtils,
            c = (e("1b"), e("18")), d = e("43"), u = e("49"), h = e("2b"), f = e("45"), p = e("17"), m = e("31"),
            g = e("4b"), v = window.reqnode ? reqnode("electron").remote : null, y = "", b = g.backspaceHandler,
            w = function (e) {
                return a.isEmptyBlock(e) || a.isType(e, s.list_item) && 1 == e.get("children").length && a.isEmptyBlock(e.getFirstChild())
            }, C = function (e, t, n, r, l, d) {
                if (t = t || (h = e.getMarkElem(), e.getNode(h.attr("cid")))) {
                    var u = e.getJQueryElem(window.getSelection().anchorNode), h = e.findElemById(t.id);
                    a.noChangeLine(t) && (n = n.trim().split(/[\n\r]+/gi)[0]), "\n" == n && h.text().length <= r && (n = "\n​"), l && l.undo.push(o.buildReplaceUndo(t, void 0));
                    var f = u.closest(".md-def-link, .md-def-footnote").length;
                    if (f && u.hasClass("md-def-name")) h = u.closest("[cid]"), e.docMenu.getAttrByElem(u), e.selection.getRangy().insertNode(document.createTextNode(i.escape(n))), t.set("ref", u.text()); else if (f && u.hasClass("md-def-url")) h = u.closest("[cid]"), e.docMenu.getAttrByElem(u), n = n.replace(/\s/gi, ""), e.selection.getRangy().insertNode(document.createTextNode(i.escape(n))), t.set("href", u.text()); else if (f && u.hasClass("md-def-title")) h = u.closest("[cid]"), e.docMenu.getAttrByElem(u), e.selection.getRangy().insertNode(document.createTextNode(i.escape(n))), t.set("title", u.text()); else {
                        var p, m = "", g = r;
                        u.hasClass("md-meta-block") && 0 == u.text().length && "\n​" == n ? p = "\n\n" : (u.hasClass("md-meta-block") && m.length == r && "\n" == m[r - 1] ? r-- : f && u.closest(".md-def-content").length ? (g -= t.get("ref").length + 1, m = u.closest(".md-def-content").rawText()) : (m = h.rawText(), a.isType(t, s.meta_block) && (m = m.replace(/\n$/, ""))), p = void 0 !== g ? m.substring(0, g) + n + m.substring(g) : m.text() + n), t.set("text", p.replace("​", "")), h.html($(c.renderHtmlWithBlockMeta(t, e.brush)).html())
                    }
                    l && (e.store(t, !0), l.redo.push(o.buildReplaceUndo(t, void 0)));
                    var v = {id: t.id, type: "cursor", start: r + n.length};
                    d && (e.undo.exeCommand(v), e.brush.addToQueue(t.id)), l && l.redo.push(v), e.brush.addToQueue(t.id), h = e.findElemById(t.id), d && h.addClass("md-focus")
                }
            }, x = function (e, t, n, i, r) {
                if (File.isMac) setTimeout(function () {
                    i && app.clipboard.clearContents(), e && app.clipboard.copyForType(_(e)[0], "text/html"), app.clipboard.copyForType(t, "text/markhtml"), n && app.clipboard.copyForType(n, "text/plain")
                }, 20); else if (File.isNode) if (r) {
                    if ("cut_before" === File._CopyContentFlag || "cut" == r.type && e) {
                        if (!e) return setTimeout(v.getCurrentWindow().webContents.copy, 30), void(File._CopyContentFlag = "cut_after");
                        b(File.editor, null, "delSelection"), File._CopyContentFlag = !1
                    } else if ("cut_after" === File._CopyContentFlag) File._CopyContentFlag = !1, e = (_(v.clipboard.readHTML()) || [])[0], b(File.editor, null, "delSelection"); else if (e && !File._CopyContentFlag) ; else {
                        if (!File._CopyContentFlag) return File._CopyContentFlag = !0, void(!e && setTimeout(v.getCurrentWindow().webContents.copy, 30));
                        !0 === File._CopyContentFlag && (e = (_(v.clipboard.readHTML() || e) || [])[0] || ""), File._CopyContentFlag = !1
                    }
                    n && r.clipboardData.setData("text/plain", n), e && r.clipboardData.setData("text/html", e), t && r.clipboardData.setData("text/markhtml", t), r.preventDefault()
                } else v.clipboard.write({
                    html: _(e)[0] || n,
                    text: n
                }), t && (File._CopyContentFlag = "mock_copy", setTimeout(v.getCurrentWindow().webContents.copy, 30))
            }, k = function (e, t, n) {
                t = t || File.editor;
                var i, r, o, a;
                return e.find(".md-fences").toArray().map(function (e) {
                    i = e.getAttribute("cid"), (r = $(e)).attr("lang", r.attr("lang")), r.text(t.fences.getValue(i))
                }), n && n.skipEmoji || e.find(".md-emoji").toArray().map(function (e) {
                    (r = $(e)).text(":" + r.attr("data-content") + ":")
                }), e.find("[mdtype='math_block']").toArray().map(function (e) {
                    i = e.getAttribute("cid"), (r = $(e)).text(t.mathBlock.getTex(i))
                }), e.find("[mdtype='html_block']").toArray().map(function (e) {
                    i = e.getAttribute("cid");
                    var n = t.getNode(i);
                    (r = $(e)).text(n.get("text"))
                }), e.find(".md-math-after-sym").remove(), (o = e.children("li[cid]")).length && ((a = $(document.querySelector("[cid='" + o[0].getAttribute("cid") + "']").parentElement).clone()).empty().append(o).wrap("div"), e = a.parent()), e
            }, S = function (e, t) {
                /^\<(tbody|thead)/.exec(e) && (e = "<table mdtype='table'>" + e + "</table>");
                var n = $($.parseHTML("<div>" + e + "</div>"));
                return k(n, t)
            }, E = function (e, t) {
                e = e || File.editor;
                var n = document.activeElement, i = e.selection.getRangy();
                if (e.sourceView.inSourceMode) x(null, null, File.editor.sourceView.cm.getSelection(), !0, t); else if ("HR" == n.getAttribute("mdtype")) x(null, null, "---", !0, t); else if (n.getAttribute("mdtype") !== s.math_block || i && !i.collapsed) {
                    if (isInputComponent(n) || void 0 !== n.tabindex) x(null, null, n.value || n.textContent, !0, t); else if (window.getSelection().rangeCount) {
                        var r, o = "";
                        i.collapsed && (r = (r = $(i.startContainer).closest(".md-table-fig")).length ? S(r[0].outerHTML, e) : null), r || (r = S(i.toHtml(), e)), o = r.html(), x(null, o, N(o), !0, t)
                    }
                } else x(null, null, "$$\n" + e.mathBlock.getTex(n.getAttribute("cid")) + "\n$$", !0, t);
                File._CopyContentFlag = !1
            }, F = function (e, t) {
                e = e || File.editor;
                var n = document.activeElement, r = e.selection.getRangy();

                function o(n) {
                    var r = M(S(n, e).html()), o = e.export.exportCollection(r, null, !0, !0, !0);
                    x(null, "<pre mdtype='fences' lang='HTML'>" + i.escape(o) + "</pre>", o, !0, t)
                }

                if (e.sourceView.inSourceMode) x(null, null, File.editor.sourceView.cm.getSelection(), !0, t); else if ("HR" == n.getAttribute("mdtype")) x(null, null, "<hr/>", !0, t); else if (n.getAttribute("mdtype") !== s.math_block || r && !r.collapsed) if (isInputComponent(n) || 0 == n.childElementCount) {
                    if (n.classList.contains("md-content") && r.toString() == n.textContent) {
                        var a = $(n).closest(".md-image");
                        if (a.length) return void o(a[0].outerHTML)
                    }
                    x(null, null, n.value || n.textContent, !0, t)
                } else window.getSelection().rangeCount && o(r.toHtml()); else x(null, null, "$$\n" + e.mathBlock.getTex(n.getAttribute("cid")) + "\n$$", !0, t)
            }, _ = function (e) {
                if (!e) return "";
                var t = $.parseHTML(e || ""), n = "<!DOCTYPE html>", i = "<!DOCTYPE html>",
                    r = File.option.showLineNumbersForFence ? "  " : "";
                return t ? (t.map(function (e) {
                    var t = $(e), o = t.find(".md-emoji").addBack(".md-emoji");
                    if (t.hasClass("md-br")) return n += "<br/>", void(i += "<br/>");
                    o.text(function (e) {
                        return $(o[e]).children("[data-emoji]").attr("data-emoji")
                    }), t.find(".ty-table-edit, .md-meta, .md-content, .md-rawblock-tooltip").remove(), t.find("[cid].md-fences").addBack("[cid].md-fences").html(function () {
                        var e = this.querySelectorAll("pre.CodeMirror-line");
                        if (e.length) {
                            for (var t = [], n = 0; n < e.length; n++) e[n].innerHTML && t.push(r + e[n].innerHTML);
                            return t.join("<br/>")
                        }
                        return this.innerHTML
                    }), t.find("p, h1, h2, h3, h4, h5, h6, .md-def-link, .md-def-footnoote").css("width", ""), t.find(".md-br").text("\n"), t.find(".md-def-name").before("[").after("]   "), n += e.outerHTML || e.textContent, e.getAttribute && e.getAttribute("mdtype") == s.toc || (t.find(".md-toc").remove(), t.find(".mathjax-block").addBack(".mathjax-block").html(function () {
                        try {
                            return File.editor.findElemById(this.getAttribute("cid")).find("script").text()
                        } catch (e) {
                            return ""
                        }
                    }).css("font-size", "1rem"), t.find("li p").oldReplaceWith(function () {
                        return this.innerHTML + (this.nextSibling ? "\n" : "")
                    }), t.find("ul, ol, .md-def-link, .md-def-footnoote, blockquote, .md-fences, .mathjax-block").after("<br/>"), t.find(".md-def-name").before("[").after("]   "), t.find(".md-entity").text(function () {
                        return this.dataset.content
                    }), t.find("[contenteditable]").removeAttr("contenteditable"), i += e.outerHTML || e.textContent, a.isType(e.tagName, "UL", "OL") && (i += "<br/>"))
                }), [n, i]) : ["", ""]
            };

        function T(e, t, n, i) {
            t || (A.reset(!0), t = A);
            var r, o, s = $($.parseHTML("<div>" + e + "</div>")[0]), l = [], c = s.children("[mdtype]");
            return c.length ? (c.each(function () {
                (o = a.reverse($(this), t, n, i)).set("before", r), r = o, l.push(o)
            }), l) : n ? (s.find("[data-emoji]").text(function () {
                return this.getAttribute("data-emoji")
            }), s.find(".md-meta, .md-content").remove(), s.text()) : s.rawText()
        }

        function M(e, t, n, i, r) {
            return T(e, t, !1, r)
        }

        var A = new r.NodeMap;

        function N(e) {
            var t = M(e, void 0, 0, 0, !0);
            return "string" == typeof t ? t : a.markFromArr(t)
        }

        var L = function (e, t, n, i, r) {
            if (y = "", File._PasteContentFlag = !1, e = e || File.editor) {
                var c = "string" != typeof t || n ? null : t, f = "string" == typeof t && n ? t : null,
                    m = "object" == typeof t ? t : null;
                if ("INPUT" == document.activeElement.tagName || document.activeElement.classList && document.activeElement.classList.contains("ty-input")) return !0;
                if ("TEXTAREA" == document.activeElement.tagName) {
                    if (!m && f) {
                        var g = $(document.activeElement).closest(".CodeMirror");
                        g && (g = g[0].CodeMirror).replaceSelection(f)
                    }
                    return !0
                }
                if (a.isType(F, s.hr)) return !1;
                if ("BODY" == document.activeElement.tagName) return !1;
                e.undo.completeSnap(!0);
                var v, x, k, S = e.UserOp.backspaceHandler(e, null, "delSelection", !0, !1) || o.makeEmptyCommand(),
                    E = e.getMarkElem(), F = e.findNodeByElem(E),
                    _ = File.isNode ? reqnode("electron").remote.app : window.app;
                if (m) {
                    if (m.preventDefault(), (f = m.clipboardData.getData("text/plain")) && (f = f.replace(/(\r?\n)$/, "")), c = m.clipboardData.getData("text/html"), k = m.clipboardData.getData("text/markhtml"), File.isMac && !c && !k) {
                        var T = _.clipboard.getHTML() || ["", ""];
                        c = T[0], y = T[1]
                    }
                } else f || c || File.isMac && (f = _.clipboard.paste());
                if (File.isMac && !c && !k && !n) {
                    var A = _.clipboard.getImage();
                    if (A && A.length) return D(e, A), e.selection.scrollAdjust(), !1
                }
                if (File.isNode && !c && !k && !n) {
                    var N = reqnode("electron").clipboard.readImage();
                    if (!N.isEmpty()) {
                        var L = e.imgEdit.getTagetImageStorageFolder() || _.getPath("userData") + "/typora-user-images";
                        return e.imgEdit.prepImageMove(L).then(function () {
                            var t = reqnode("path").join(L, Number(new Date) + ".png");
                            reqnode("fs").writeFileSync(t, N.toPNG()), D(e, [t]), e.selection.scrollAdjust()
                        }), !1
                    }
                }
                if (S.undo.push(e.selection.buildUndo()), S = o.append(S, b(e, m, "delSelection", !0)), F = e.findNodeByElem(e.getMarkElem()), v = e.selection.getRangy(), r || F && v) {
                    x = v.getBookmark(e.findElemById(F.id)[0]).start;
                    var R = e.getJQueryElem(v.startContainer);
                    n = n || v.startContainer && R.closest(".md-def-url, .md-def-name, .md-def-title, pre, code").length, k && !n ? (i = !0, B(F, x, S, k, M)) : c && !n ? R.closest(".md-def-content").length ? U(F, x, f = u.parseInlineHTML(c, e, y), S) : B(F, x, S, c, u.parseHTML) : U(F, x, f, S), e.selection.scrollAdjust()
                }
            }

            function O(e, t) {
                return e.get("attr") && e.get("attr").trim().length ? e.get("attr") : void 0
            }

            function I(t, n, i, r) {
                var l = e.tableEdit.TableEdit;

                function c(e, t, n, i) {
                    var r = e.safeGetStrAttr("text"), o = function e(t) {
                        return a.isType(t, a.TYPE.paragraph, a.TYPE.heading, a.TYPE.raw_edit, a.TYPE.fences, a.TYPE.table_cell) ? t.get("text") : (!a.isType(t, s.def_footnote) || O(t) && O(t)) && (!a.isType(t, s.def_link) || O(t) && O(t)) ? t.get("children").toArray().reduce(function (t, n) {
                            return t + e(n)
                        }, " ") : O(blocks[0]) || O(blocks[0]) || O(blocks[0]) || O(blocks[0]) || ""
                    }(n).replace(/\r?\n/g, " ");
                    return e.set("text", r.substr(0, t) + o + r.substr(t)), t + o.length
                }

                var d, u = t.get("parent").get("parent"), h = t, f = h;
                r.undo.push(o.buildReplaceUndo(u));
                var p = [];
                i.forEach(function (e, t) {
                    e.get("type") == s.table ? p = p.concat(function (e) {
                        for (var t, n = e.getFirstChild().getFirstChild(), i = []; n;) t = n, i.push(n), n = l.getSibling(n), t.detach();
                        return e.remove(), i
                    }(e)) : p.push(e)
                });
                for (var m = 0; m < p.length && h; m++) d = c(h, 0 === m ? n : 0, p[m]), f = h, h = a.isType(p[m], s.table_cell) ? l.getSibling(h, !1, !0) : l.getNextCellInColumn(h);
                e.findElemById(u.id).replaceWith(u.toHTML()), r.redo.push(o.buildReplaceUndo(u)), void 0 !== d ? e.selection.jumpInto(e.findElemById(f.id), d) : e.selection.jumpIntoElemEnd(e.findElemById(f.id)), r.redo.push(e.selection.buildUndo())
            }

            function P(t, n, r, o, a) {
                if (!i) try {
                    var s = e.selection.restoreEdge(e.findElemById(t), n);
                    void 0 !== o ? s = e.selection.restoreEdge(e.findElemById(r), o, !0, s) : s.setEndAfter(e.findElemById(r)[0] || e.findElemById(t)[0]), e.imgEdit.tryMoveImageInRange(s)
                } catch (e) {
                    console.error(e)
                }
            }

            function B(t, n, i, r, o, l) {
                i.undo.push(e.selection.buildUndo());
                var c = o(r, e.nodeMap, e, y);
                if ("string" == typeof c) return U(t, n, c, i);
                if (1 == c.length && n && -1 == c[0].get("text").indexOf("\n")) return U(t, n, c[0].get("text"), i);
                if (0 != c.length) {
                    if (a.isType(t, s.table_cell)) I(t, n, c, i); else if (a.isType(t, s.table_row, s.table)) ; else {
                        a.isType(t.get("parent"), s.list_item) ? i.undo.push(e.undo.buildReplaceUndo(t.get("parent"))) : i.undo.push(e.undo.buildReplaceUndo(t));
                        var d = t === e.nodeMap.getFirst() && 0 === n, u = [];
                        c.map(function (e, t) {
                            a.isType(e, s.meta_block) && (0 != t || !d) && u.push(e)
                        }), u.map(function (e) {
                            c.remove(e)
                        });
                        var h = a.splitAt(t, n, e, !1, !0, !0);
                        if (j(h.prev, h.next, c, i, h.insertArray, t), h.prev && c.last()) try {
                            var f = h.prev.isDeleted() ? c[0] : h.prev, p = c.last();
                            !h.prev.isDeleted() && a.isType(h.prev, s.list_item) && (p.isDeleted() || h.prev.contains(c.last())) && (f = h.prev.getVeryFirst()), P(f.getVeryFirst(!0, !1).cid, n, c.last().cid, void 0)
                        } catch (e) {
                            console.stackError(e)
                        }
                    }
                    e.undo.register(i)
                }
            }

            function H(t, n, i, r) {
                if (!t.isDeleted() && !n.isDeleted()) {
                    var l = t.canContainBlock() ? t.getLastChild() : t, c = n.canContainBlock() ? n.getFirstChild() : n,
                        d = -1;
                    if (e.stylize.canContainInline(l) && e.stylize.canContainInline(c) && !a.isType(l, s.table_cell) && !a.isType(c, s.table_cell)) {
                        d = l.get("text").length, l.set("text", l.get("text") + c.get("text"));
                        var u = function e(t) {
                            if (t && !t.isDeleted()) {
                                var n = t.get("parent");
                                return n ? t.get("before") || t.get("after") ? t : e(n) : t
                            }
                        }(c);
                        return o.addUndoForRemove(i, u), u.remove(), r.remove(u), n.isDeleted() || a.isType(n, s.list_item) && a.isType(t, s.list_item) && (i.undo.push(o.buildReplaceUndo(t)), t.getLastChild().insertTillEnd(n.getFirstChild()), o.addUndoForRemove(i, n), n.remove(), r.remove(n)), i.redo.push(o.buildReplaceUndo(t)), d
                    }
                }
            }

            function U(t, n, i, r) {
                var l = (i = i.replace(/\u00a0/g, " ").replace(/\u200b/g, "").replace(/^[\r\n]+/g, "").replace(/[\r\n]+$/g, "")).split(/\r?\n/g);
                if (l.length > 1 && !l[0].trim().length && l[1].trim().length && (l = l.slice(1)), a.isType(t, s.table_cell)) return function (t, n, i, r) {
                    r.undo.push(e.selection.buildUndo()), i = i.trim();
                    var a = null;
                    /\|/.exec(i) && (a = /\s*\|\s*/);
                    var s, l = t;
                    if (a) {
                        var c = i.split(/\n/).filter(function (e) {
                            return e.length
                        }), u = t.get("parent"), h = d.getColumnIndex(t);
                        c.map(function (i, c) {
                            if (u && !/^[-\s:|]+$/.exec(i)) {
                                var d = i.split(a);
                                "" == d[0] && (d = d.subarray(1)), "" == d.last() && (d = d.subarray(0, d.length - 1));
                                var f = u.getNthChild(h);
                                d.map(function (e, i) {
                                    f && (r.undo.push(o.buildReplaceUndo(f)), 0 == c && 0 == i ? (t.set("text", t.get("text").substring(0, n) + e + t.get("text").substring(n)), s = n + e.length) : (i == d.length - 1 ? f.set("text", e + f.get("text")) : f.set("text", e), l = f, s = e.length), r.redo.push(o.buildReplaceUndo(f)), f = f.get("after"))
                                }), e.findElemById(u.id).replaceWith(u.toHTML()), u = u.get("after")
                            }
                        })
                    } else r.undo.push(o.buildReplaceUndo(t)), i = i.replace(/<br\/?>/g, "\n").replace(/\n/, "<br/>"), t.set("text", t.get("text").substring(0, n) + i + t.get("text").substring(n)), r.redo.push(o.buildReplaceUndo(t)), e.findElemById(t.id).replaceWith(t.toHTML()), s = n + i.length;
                    e.selection.jumpInto(e.findElemById(l.cid), s), r.redo.push(e.selection.buildUndo()), e.undo.register(r), P(t.cid, 0, l.cid, l.get("text").length)
                }(t, n, i, r);
                if (a.noChangeLine(t) && (l = [l[0]]), l.length <= 1 || h.CONST.NoInline.indexOf(t.get("type")) > -1) i = l.join("\n"), C(e, t, i, n, r, !0), function (e, t, n, i, r) {
                    if (a.isType(t, s.paragraph) && p.BLOCK_OPEN_REG.exec(n) && p.BLOCK_OPEN_REG.exec(t.get("text"))) {
                        var l = r.redo.last(), c = t.parseFrom({skips: {old_code: !1, pass_format: !0}});
                        r.redo.push(o.buildReplaceUndo(t)), o.addUndoForInsertArray(r, c[1].subarray(1));
                        var d = c[1].last().getVeryFirst(!0), u = l.end || n.length + i;
                        e.findElemById(t.id).replaceWith(c[0]), e.selection.jumpInto(e.findElemById(d.cid), u), r.redo.push(e.selection.buildUndo())
                    }
                }(e, t, i, n, r); else {
                    if (r.undo.push(e.selection.buildUndo()), a.isType(t, s.paragraph) && a.isType(t.get("parent"), s.list_item) ? r.undo.push(o.buildReplaceUndo(t.get("parent"))) : r.undo.push(o.buildReplaceUndo(t)), a.isType(t, s.paragraph) && !a.isType(t.get("parent"), s.list_item)) return function (t, n, i, r) {
                        var a = t.get("text");
                        t.set("text", a.substring(0, n) + i + a.substring(n));
                        var s = t.parseFrom({skips: {old_code: !1, pass_format: !0}});
                        r.redo.push(o.buildReplaceUndo(t)), o.addUndoForInsertArray(r, s[1].subarray(1)), e.findElemById(t.id).replaceWith(s[0]);
                        var l = s[1].last().getVeryFirst(!0), c = Math.max(l.get("text").length - (a.length - n), 0);
                        e.selection.jumpInto(e.findElemById(l.cid), c), r.redo.push(e.selection.buildUndo()), e.undo.register(r), e.focusCid = l.cid, e.refresh(), P(t.cid, 0, l.cid, l.get("text").length)
                    }(t, n, i, r);
                    var c = a.splitAt(t, n, e), u = a.parseFrom(l.join("\n"), t.get("in"), {
                        noTop: !c.prev.get("attachTo"),
                        skips: {old_code: !1, pass_format: !0}
                    }, !0);
                    a.isType(c.prev, s.list_item) && r.undo.push(o.buildReplaceUndo(c.prev)), j(c.prev, c.next, u[1], r, c.insertArray, t)
                }
                e.undo.register(r), P(t.cid, n, t.cid, n + i.length)
            }

            function j(t, n, i, r, c, d) {
                var u, f = d.id, p = -1;
                i = function (e) {
                    for (var t = [], n = -2, i = 0; i < e.length; i++) {
                        var r = e[i];
                        a.isType(r, s.table_cell) ? (n !== i - 1 ? (r.set("type", s.paragraph), t.push(r)) : (t.last().set("text", t.last().get("text") + "  " + r.get("text")), r.remove()), n = i) : t.push(r)
                    }
                    return t
                }(i = function (e) {
                    var t, n, i = [], r = e[0].get("before"), o = e.last().get("after"), l = e[0].get("parent");
                    return e.map(function (e) {
                        a.isType(e, s.list_item) ? (n = !0, t || (t = new a({
                            type: t,
                            in: e.get("in")
                        }), i.push(t)), t.append(e)) : (t = null, i.push(e))
                    }), n && (console.log("group list items"), i.map(function (t, n) {
                        0 == n ? t.set("before", r) : t.set("before", e[n - 1]), n == i.length - 1 ? t.set("after", o) : t.set("after", e[n + 1]), t.set("parent", l)
                    })), i
                }(i)), u = i.last().getVeryFirst(!0), c = c || [n], d = d || t;
                var m = c.indexOf(n), g = !1;
                if (w(n) ? (c.remove(n), n.remove(), g = !0) : a.isType(u, h.CONST.Selectable) && (u = n), !a.isType(t, s.blockquote, s.list)) {
                    if (a.isType(t, s.list_item) && a.isType(i[0], s.list, s.list_item)) !function (t, d) {
                        r.redo.push(o.buildReplaceUndo(t));
                        var h, m = n, g = t.get("parent");
                        if (f = t.id, a.isType(i[0], s.list)) {
                            t.insert(i[0]);
                            var v = i.shift().unwrap();
                            if (h = v.concat(c), o.addUndoForInsertArray(r, h), !d || w(t)) {
                                var y = h.shift();
                                void 0 == H(t, y, r, h) && (y.isDeleted() || h.unshift(y))
                            }
                            h.unshift(t), n.isDeleted() || i.length || (p = H(v.last(), n, r, h))
                        }
                        if (i.length) {
                            var b;
                            f = g.cid, g.insertArray(i, !1, !0);
                            var C = i.clone();
                            h = (h = [g]).concat(i), m && !m.isDeleted() ? (f = g.cid, r.undo.push(o.buildReplaceUndo(g)), g.unset("ahead"), g.unset("tail"), (b = g.clone()).unset("start"), g.giveChildrenTo(b, m, null, !0), r.redo.push(o.buildReplaceUndo(g)), i.last().insert(b), h.push(b), C.push(b), o.addUndoForInsertArray(r, C)) : o.addUndoForInsertArray(r, C)
                        } else u = h.last();
                        e.findElemById(f).replaceWith(l.toHTML(h))
                    }(t, g); else {
                        var v = t.getVeryFirst(!0);
                        v.insertArray(i, !1, !0), m > -1 && c.splice.apply(c, [m, 0].concat(i)), o.addUndoForInsertArray(r, c), a.isEmptyBlock(v) ? (o.addUndoForRemove(r, v), v.remove()) : H(v, i.shift(), r, c), n.isDeleted() || (a.isEmptyBlock(n) ? (o.addUndoForRemove(r, n), n.remove()) : p = i.length ? H(i.last(), n, r, c) : H(t, n, r, c)), (u = i.last() || t) && !u.isDeleted() && (u = u.getVeryFirst(!0)), d.isDeleted() || r.redo.push(o.buildReplaceUndo(d));
                        var y = (d.isDeleted() ? "" : d.toHTML()) + c.map(function (e) {
                            return e.isDeleted() ? "" : e.toHTML()
                        }).join("");
                        e.findElemById(f).replaceWith(y)
                    }
                    a.isType(u, h.CONST.Selectable) && (n && !n.isDeleted() && (u = n), p = -1);
                    try {
                        p >= 0 ? e.selection.jumpInto(e.findElemById(u.cid), p) : u == n ? e.selection.jumpIntoElemBegin(e.findElemById(n.cid)) : e.selection.jumpIntoElemEnd(e.findElemById(u.getVeryFirst(!0).cid)), r.redo.push(e.selection.buildUndo())
                    } catch (e) {
                        console.warn(e)
                    }
                    e.tryEnterBusyMode(), e.refresh(), setTimeout(function () {
                        e.refocus(), e.selection.scrollAdjust()
                    }, 100)
                }
            }
        }, R = function (e, t, n) {
            if (!File.isNode || !File.isLocked) {
                t = t || File.editor, n = n || t.getMarkElem(), t.undo.completeSnap(!0);
                var i = t.findNodeByElem(n), r = new a({type: s.paragraph, text: ""}),
                    l = o.makeEmptyCommand(t.selection.buildUndo(void 0, n));
                i && ((i = i.getClosetBlock()).insert(r, e), o.addUndoForInsert(l, r), e ? t.findElemById(i.cid).before(r.toHTML()) : t.findElemById(i.cid).after(r.toHTML()), t.selection.jumpIntoElemBegin(t.findElemById(r.cid)), l.redo.push(t.selection.buildUndo()), t.undo.register(l), t.refocus())
            }
        }, D = function (e, t) {
            if (window.app) {
                if (app.document.isLocked()) return
            } else if (File.isLocked) return !1;
            if (!e.sourceView.inSourceMode) {
                t.length;
                t.forEach(function (t, n) {
                    n && R(!1, e), O(e, t)
                })
            }
        }, O = function (e, t) {
            if (!t) return !0;
            if (/\.(png|jpe?g|svg|gif|bmp|webp|tiff)$/gi.exec(t)) return e.imgEdit.doInsertFromURL(t), !0;
            var n = m.getFileNameFromPath(t),
                r = (t = i.getRelativePath(m.getCurrentFileFolderPath(), t), "[" + n.replace(/(^|[^\\])]/, "$1\\]") + "](" + t.replace(/(^|[^\\])\)/, "$1\\)") + ")");
            return L(e, r, !0), !1
        };
        t.getMarkdownSourceFrom = N, t.nativeCopyText = function (e) {
            var t = document.createElement("textarea");
            document.body.appendChild(t), t.value = e, t.focus(), t.select(), document.execCommand("Copy"), t.remove()
        }, t.copyAsMarkdown = E, t.copyAsHTMLSource = F, t.copyHandler = function (e, t) {
            if ("copyAsMarkdown" === File._CopyContentFlag) return E(e, t);
            if ("copyAsHTMLSource" === File._CopyContentFlag) return F(e, t);
            var n = document.activeElement, r = e.selection.getRangy(), o = $(n).closest("[cid]");
            if (e.sourceView.inSourceMode) x(null, null, File.editor.sourceView.cm.getSelection(), !0, t); else {
                if (isInputComponent(n)) return t || console.sendError("in copyHandler : shouldn't be here"), !0;
                if ("hr" == n.getAttribute("mdtype")) x(n.outerHTML, null, "---", !0, t); else if ("toc" == n.getAttribute("mdtype")) x(n.outerHTML, "<div mdtype='toc'><div>", "[toc]", !0, t); else if ("IMG" == n.tagName) x(n.outerHTML, null, n.getAttribute("src") || "", !0, t); else if (o.attr("mdtype") !== s.math_block || r && !r.collapsed) if (o.attr("mdtype") !== s.html_block || r && !r.collapsed) {
                    if (window.getSelection().rangeCount) {
                        if (!File._CopyContentFlag && File.isNode) return File._CopyContentFlag = !0, v.clipboard.writeHTML(""), void setTimeout(v.getCurrentWindow().webContents.copy, 0);
                        e.selection.includeTrailMeta(r);
                        var a = r.toHtml(), l = $($.parseHTML("<div>" + a + "</div>"));
                        l.find(".md-emoji").text(function () {
                            return f.data[this.getAttribute("data-content")]
                        }), l.find(".math-jax-postprocess").text(function () {
                            var e = this.querySelector("script");
                            return e ? e.textContent.replace(/\u200B*/g, "") : ""
                        }).parent().addClass("md-expand");
                        var c = (l = k(l, e, {skipEmoji: !File.option.copyMarkdownByDefault})).html(),
                            d = File.option.copyMarkdownByDefault ? N(c) : function (e) {
                                var t = T(e, null, !0);
                                return "string" == typeof t ? t : u.convertToPlain(t)
                            }(c).replace(/\u200B/gi, "");
                        x(null, c, d, !1, t)
                    }
                } else {
                    var h = e.getNode(o.attr("cid")), p = h.get("text");
                    x(p, "<div mdtype='" + s.html_block + "' data-tag='" + i.escape(h.get("style")) + "'>" + i.escape(p) + "</div>", p, !0, t)
                } else {
                    var m = e.mathBlock.getTex(o.attr("cid"));
                    x(n.querySelector(".MathJax_Display").outerHTML, "<div mdtype='" + s.math_block + "'>" + m + "</div>", m, !0, t)
                }
            }
        }, t.insertInlineText = C, t.pasteHandler = L, t.setClipboard = x, t.insertURLs = D, t.prepMarkHtml = S, t.insertParagraph = R, t.insertDom = function (e) {
            File.editor.focusAndRestorePos(), L(File.editor, $("<div>").append(e).html(), !1)
        }, t.processClipboardHTML = _
    }), $__System.registerDynamic("2e", ["11", "13", "12", "1a", "1b", "18", "43", "49", "4b", "48", "4a", "1c", "4c"], !0, function (e, t, n) {
        "use strict";
        this || self, e("11"), e("13");
        var i = e("12"), r = e("1a"), o = (r.SnapFlag, i.Node), a = i.TYPE,
            s = (i.NodeCollectionUtils, e("1b"), e("18")), l = (e("43"), e("49"), e("4b")), c = e("48"), d = e("4a"),
            u = e("1c"), h = e("4c"), f = function (e, t, n, i) {
                var r, o = e;
                if (e == t) return null;
                for (r = e.get(n); r;) i(r, o), r = (o = r).get(n);
                return f(e.get("parent"), t, n, i), o
            };
        t.getDisplayText = function (e) {
            var t = e.clone();
            return t.find(".md-meta, .md-content").remove(), t.text().replace(/\u00A0/g, " ")
        }, t.decorateOneSide = f, t.simpleExpand = function (e, t) {
            if (File.isLocked) return !1;
            var n, i, l, c = e.getNode(t), d = e.selection.buildUndo();
            if (!o.isType(c, a.heading, a.def_footnote, a.def_link) || d.startId && d.startId != d.endId) return !1;
            if ((n = c.toMark().trim()).match(/\n/)) return !1;
            var u = r.makeEmptyCommand(e.lastCursor);
            if (!u.undo.length || !u.undo[0].id && u.undo[0].startId != u.undo[0].endId) return !1;
            if (u.undo.push(r.buildReplaceUndo(c)), o.isType(c, a.heading) && (i = c.get("pattern") && c.get("pattern").replace("{0}", "").length || c.get("depth") + 1), o.isType(c, a.def_link, a.def_footnote)) {
                var h, f = e.selection.getRangy(), p = e.getJQueryElem(f.startContainer);
                h = p.closest(".md-def-content"), i = o.isType(c, a.def_link) ? 1 : 2, h.length && (i += 3), (h = p.closest(".md-def-title")).length && p.text().length && (i += 5)
            }
            return c.set("text", n), c.set("type", a.paragraph), u.redo.push(r.buildReplaceUndo(c)), (d = e.selection.buildUndo()).start += i, d.end += i, d.id = c.cid, d.startId = d.endId = void 0, u.redo.push(d), l = s.renderHtmlWithBlockMeta(c, e.brush), e.findElemById(c.cid).replaceWith(l), e.undo.exeCommand(d, []), e.undo.stashUndo(u), c.cid
        }, t.backspaceHandler = l.backspaceHandler, t.deleteSelectable = l.deleteSelectable, t.deleteLineProcessor = l.deleteLineProcessor, t.deleteLine = l.deleteLine, t.deleteBlock = l.deleteBlock, t.backToParagraph = l.backToParagraph, t.getMarkdownSourceFrom = h.getMarkdownSourceFrom, t.nativeCopyText = h.nativeCopyText, t.copyAsMarkdown = h.copyAsMarkdown, t.copyAsHTMLSource = h.copyAsHTMLSource, t.copyHandler = h.copyHandler, t.insertInlineText = h.insertInlineText, t.pasteHandler = h.pasteHandler, t.setClipboard = h.setClipboard, t.insertURLs = h.insertURLs, t.insertDom = h.insertDom, t.prepMarkHtml = h.prepMarkHtml, t.insertParagraph = h.insertParagraph, t.processClipboardHTML = h.processClipboardHTML, t.moreIndent = c.moreIndent, t.lessIndent = c.lessIndent, t.hanldePair = d.hanldePair, t.surroundPair = d.surroundPair, t.PunctuationOp = u
    }), $__System.registerDynamic("46", ["25", "12", "2b", "2e", "13", "1a"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i = "", r = e("25"), o = e("12"), a = o.Node, s = o.TYPE, l = e("2b"), c = e("2e"), d = e("13"),
            u = (r = e("25"), e("1a").SnapFlag), h = r.map, f = window.reqnode ? reqnode("electron").remote : null;

        function p(e) {
            e = e || ".context-menu", $(e).removeClass("show").find(".active").removeClass("active")
        }

        function m(e) {
            var t = f.getCurrentWindow();
            p(), t.inspectElement(e.clientX, e.clientY)
        }

        var g = !1;

        function v() {
            g = !0;
            var e = (f.app.setting.config || {}).searchService || [["Search with Google", "https://google.com/search?q=%s"]];
            e.forEach(function (t, n) {
                var r = $($.parseHTML('<li data-group="search" data-key>\n<a role="menuitem">' + d.escape($.localize.getString(t[0], "Menu")) + "</a></li>")[0]);
                0 === n ? ($("#search-service-placeholder").after('<li class="divider" data-group="search"></li>').replaceWith(r), r.attr("data-key", "search-default"), e.length > 2 && r.after('<li data-key="search-with" data-group="search" class="has-extra-menu">\n<a role="menuitem"><span>' + $.localize.getString("Search With…") + '</span><i class="fa fa-caret-right"></i></a></li>')) : 1 === n && 2 == e.length ? $("[data-key='search-default']").after(r) : $("#search-menu").append(r), r.click(function () {
                    e = t[1], p(), f.shell.openExternal(e.replace(/%s/, encodeURIComponent(i)));
                    var e
                })
            })
        }

        function y(e, t) {
            var n = $("[data-group='" + e + "']");
            t ? n.show() : n.hide()
        }

        function b() {
            return File.editor && File.editor.spellChecker && File.editor.spellChecker.curSpellchecker
        }

        function w() {
            File.editor.lastCursor && File.editor.undo.exeCommand(File.editor.lastCursor)
        }

        var C = function (e) {
            this.sessionStr = e, $(document).ready(k.bind(this))
        }, x = function () {
            !!document.querySelector("#user-context-menu.show") ? this.showCustom(B, P) : p()
        }, k = function () {
            $("content").on("post-scroll", x.bind(this)), $(window).on("resize", x.bind(this)), N.call(this), File.isMac || (T.call(this), R.call(this), S.call(this), M.call(this), A.call(this), window.reqnode && setTimeout(L.bind(this), 1e3))
        }, S = function () {
            document.querySelector("#context-menu");
            $("[data-style]").click(function () {
                p(), w(), File.editor.refocus(), File.editor.stylize.toggleStyle(this.getAttribute("data-style"))
            })
        }, E = function () {
            var e = File.editor.getMarkElem(), t = !1;
            e.closest("thead").length ? $("[data-key='insert_row_before'], [data-key='delete_table_row']").hide() : ($("[data-key='insert_row_before']").show(), e.closest("tbody").children().length >= 2 ? ($("[data-key='delete_table_row']").show(), t = !0) : $("[data-key='delete_table_row']").hide()), e.closest("tr").children().length >= 2 ? ($("[data-key='delete_table_col']").show(), t = !0) : $("[data-key='delete_table_col']").hide(), t ? $("[data-key='delete_table_col']").next(".divider").show() : $("[data-key='delete_table_col']").next(".divider").hide()
        };
        C.prototype.updateTableVisiblity = E;
        var F, _, T = function () {
            $("body").on("mouseenter", ".context-menu [data-key]", function () {
                var e = $(this);
                e.closest(".context-menu").find(".active").removeClass("active"), e.addClass("active")
            }).on("mouseleave", ".context-menu", function (e) {
                $(this).find(".active:not(.has-extra-menu)").removeClass("active")
            }), $("#context-menu").on("mouseenter", "[data-key]", function () {
                var e = $(this);
                "block-style" == e.attr("data-key") ? (D("#block-style-menu", e), e.addClass("active")) : (document.querySelector("#block-style-menu").classList.remove("show"), document.querySelector("[data-key='block-style']").classList.remove("active")), "insert" == e.attr("data-key") ? (D("#insert-menu", e), e.addClass("active")) : (document.querySelector("#insert-menu").classList.remove("show"), document.querySelector("[data-key='insert']").classList.remove("active")), "copy-as" == e.attr("data-key") ? (D("#edit-menu", e), e.addClass("active")) : (document.querySelector("[data-key='copy-as']").classList.remove("active"), document.querySelector("#edit-menu").classList.remove("show")), "search-with" == e.attr("data-key") ? (D("#search-menu", e), e.addClass("active")) : (document.querySelector("#search-menu").classList.remove("show"), $("[data-key='search-with']").removeClass("active")), "table" == e.attr("data-key") ? (E(), D("#table-menu", e), e.addClass("active")) : (document.querySelector("#table-menu").classList.remove("show"), document.querySelector("[data-key='table']").classList.remove("active")), "math" == e.attr("data-key") ? (D("#math-menu", e), e.addClass("active")) : (document.querySelector("#math-menu").classList.remove("show"), document.querySelector("[data-key='math']").classList.remove("active"))
            })
        }, M = function () {
            $("#context-menu").on("click", "[data-indent]", function () {
                var e = this.getAttribute("data-indent");
                p(), w(), File.editor.refocus(), File.editor.stylize.toggleIndent(e)
            }).on("click", "[data-tab]", function () {
                p(), w(), File.editor.refocus();
                "left" == this.getAttribute("data-tab") ? c.lessIndent(File.editor) : c.moreIndent(File.editor)
            }), $("#block-style-menu").on("click", "[data-block]", function () {
                var e = this.getAttribute("data-block");
                p(), w(), File.editor.refocus(), File.editor.stylize.changeBlock(e)
            }), $("#insert-menu").on("click", "[data-insert]", function () {
                var e = this.getAttribute("data-insert");
                p(), w(), File.editor.refocus(), e === s.table ? File.editor.tableEdit.insertTable() : e === s.meta_block ? File.editor.stylize.insertMetaBlock() : File.editor.stylize.insertBlock(e)
            }).on("click", "[data-insert-p]", function () {
                var e = "before" == this.getAttribute("data-insert-p");
                p(), File.editor.refocus(F.attr("cid")), File.editor.UserOp.insertParagraph(e, File.editor, F)
            })
        }, A = function () {
            $("#math-menu").on("click", '[data-key="copy_as_mathml"]', function () {
                p(), w(), File.editor.styleBookmark.style.block.indexOf(s.math_block) > -1 ? File.editor.mathBlock.copyAsMathML(F[0]) : File.editor.mathInline.copyAsMathML()
            }).on("click", '[data-key="copy_as_word"]', function () {
                p(), w(), File.editor.styleBookmark.style.block.indexOf(s.math_block) > -1 ? File.editor.mathBlock.copyAsMathML(F[0], !0) : File.editor.mathInline.copyAsMathML(!0)
            }).on("click", '[data-key="copy_as_math_tex"]', function () {
                p(), w(), File.editor.styleBookmark.style.block.indexOf(s.math_block) > -1 ? File.editor.mathBlock.copyAsTex(F[0]) : File.editor.mathInline.copyAsTex()
            }).on("click", '[data-key="copy_as_math_image"]', function () {
                p(), w(), File.editor.styleBookmark.style.block.indexOf(s.math_block) > -1 ? File.editor.mathBlock.copyAsImage(F[0]) : File.editor.mathInline.copyAsImage()
            }), File.isWin || $("#math-menu [menu-for-win]").hide()
        }, N = function () {
            $("#table-menu").on("click", '[data-key="insert_row_before"]', function () {
                p(), w(), File.editor.tableEdit.addRow(!0)
            }).on("click", '[data-key="insert_row_after"]', function () {
                p(), w(), File.editor.tableEdit.addRow(!1)
            }).on("click", '[data-key="delete_table_row"]', function () {
                p(), w(), File.editor.tableEdit.deleteRow(!1)
            }).on("click", '[data-key="insert_col_before"]', function () {
                p(), w(), File.editor.tableEdit.addCol(!0)
            }).on("click", '[data-key="insert_col_after"]', function () {
                p(), w(), File.editor.tableEdit.addCol(!1)
            }).on("click", '[data-key="delete_table_col"]', function () {
                p(), w(), File.editor.tableEdit.deleteCol()
            }).on("click", '[data-key="delete_table"]', function () {
                p(), w(), File.editor.tableEdit.deleteTable()
            }).on("click", '[data-key="copy_table"]', function () {
                p(), w(), File.editor.tableEdit.copyTable()
            }).on("click", '[data-key="reformat_table"]', function () {
                p(), w(), File.editor.tableEdit.reformatTable()
            })
        }, L = function () {
            $("#context-menu").on("click", "[data-key='learn']", function () {
                p(), w(), b().add(i)
            }).on("click", "[data-key='unlearn']", function () {
                p(), w(), b().remove(i)
            }).on("click", "[data-key='correct']", function (e) {
                p(), w(), c.pasteHandler(File.editor, $(e.target).text(), !0)
            })
        }, R = function () {
            if ($("[data-key='jumpto']").click(function () {
                p(), w(), File.editor.tryOpenLink(File.editor.getJQueryElem(window.getSelection().anchorNode).closest("a"))
            }), $(".context-menu").mousedown(function (e) {
                if (!$(e.target).closest("a").length) return !1
            }), $("[data-key='dev-tool']").click(m), File.isNode) {
                f.app.setting.get("debug", !1) ? $("[data-group='dev-tool']").show() : $("[data-group='dev-tool']").hide()
            }
            $("[data-key='edit']").click(function (e) {
                return p(), w(), File.editor.undo.snap(File.editor.focusCid, u.CURSOR_CHANGE), $(_).closest(".md-rawblock-container").trigger("startedit"), !1
            }), $("[data-key='cut']").click(function (e) {
                p(), w(), ClientCommand.cut();
                var t;
                (t = $(document.activeElement.tagName).closest(".CodeMirror")[0]) && setTimeout(function () {
                    t.CodeMirror.replaceSelection("", "start")
                }, 30)
            }), $("[data-key='copy']").click(function (e) {
                p(), F.find(".md-rawblock-container").focus().length || w(), ClientCommand.copy()
            }), $("[data-key='delete-block']").click(function (e) {
                p(), w(), F.length && (File.editor.refocus(F.attr("cid")), File.editor.UserOp.deleteBlock(File.editor))
            }), $("[data-key='copy_as_markdown']").click(function (e) {
                p(), w(), ClientCommand.copyAsMarkdown()
            }), $("[data-key='paste_as_plain']").click(function (e) {
                p(), w(), ClientCommand.pasteAsPlain()
            }), $("[data-key='paste']").click(function () {
                p(), w(), ClientCommand.paste()
            }), $("[data-key='copy-emoji']").click(function () {
                p(), w();
                var e = $(".md-emoji.md-expand [data-emoji]").attr("data-emoji");
                File.editor.UserOp.setClipboard("", "", e, !0)
            }), $("[data-key='play']").click(function (e) {
                p();
                try {
                    $(_).closest("video")[0].play()
                } catch (e) {
                }
            }), $("[data-key='pause']").click(function (e) {
                p();
                try {
                    $(_).closest("video")[0].pause()
                } catch (e) {
                }
            })
        };
        C.prototype.show = function (e, t) {
            !g && window.reqnode && v.call(this), _ = t || e.target, (F = $(_).closest("[cid]")).hasClass("md-rawblock") ? File.editor.stylize.putBookmark(null, File.editor.stylize.buildBookmark(F)) : ($(File.editor.sessionStr).trigger("cursorChange"), File.editor.lastCursor = File.editor.selection.buildUndo(), File.editor.stylize.putBookmark(null, File.editor.stylize.buildBookmark(F))), $(".context-menu").removeClass("show").find(".active").removeClass("active"), function () {
                try {
                    var e = File.editor.getJQueryElem(window.getSelection().anchorNode).closest("a");
                    y("hyperlink", e.attr("href") || e.attr("data-ref"))
                } catch (e) {
                    y("hyperlink", !1)
                }
            }(), function () {
                i = "";
                try {
                    y("search", (i = window.getSelection().toString()).trim().length > 0 && -1 == i.indexOf("\n"))
                } catch (e) {
                    y("search")
                }
            }(), function () {
                var e = File.editor, t = e.styleBookmark.style, n = t.block[0],
                    i = document.querySelector("#context-menu"), r = e.stylize.CONST.NoInline.indexOf(t.block[0]) > -1,
                    c = !1, u = !1, h = !1, f = !1, p = !1;
                !function () {
                    try {
                        e.getMarkElem(window.getSelection().getRangeAt(0).startContainer).attr("mdtype"), o.TYPE.meta_block
                    } catch (e) {
                    }
                }(), y("inline-style", !r), $("[data-style]").removeClass("active"), t.inline.map(function (e) {
                    var t = document.querySelector("[data-style='" + e + "']");
                    t && t.classList.add("active"), a.isType(e, s.inline_math) && (h = !0), (a.isType(e, s.image) || a.isType(e, s.imgtag)) && (f = !0), a.isType(e, s.emoji) && (p = !0)
                }), t.block.map(function (e) {
                    a.isType(e, s.blockquote, s.list_item) && (c = !0), a.isType(e, s.table) && (u = !0), a.isType(e, s.math_block) && (h = !0)
                });
                var m = $.localize.getString(l.CONST.StyleToNameMap[n], "Menu");
                if (a.isType(n, s.html_block, s.math_block) ? $("[data-key='block-style']").hide() : ($("[data-key='block-style']").show(), $("[data-key='block-style'] span").text(m)), n == s.paragraph) {
                    var g = e.getNode(F.attr("cid"));
                    !g || g.get("before") || g.get("after") || g.get("parent") && (g = g.get("parent")), g && (m = $.localize.getString(l.CONST.StyleToNameMap[g.get("type")], "Menu"))
                }
                if (!m || a.isType(n, s.paragraph, s.heading) || /header/.exec(n) ? $("[data-group='delete-block']").hide() : $("[data-key='delete-block']").children("a").text($.localize.getString("Delete %@", "Menu").replace("%@", m || "")), $("#block-style-menu [data-block]").removeClass("state-on").filter("[data-block='" + n + "']").addClass("state-on"), t.block.length > 0 && File.editor.stylize.CONST.NormalBlockMap[n] ? ($("[data-block-auto-disable]").removeClass("disabled"), $("[data-block-auto-hide]").removeClass("hide")) : ($("[data-block-auto-disable]").addClass("disabled"), $("[data-block-auto-hide]").addClass("hide")), n != s.def_footnote && n != s.def_link || ($("#insert-menu [data-block-auto-disable]").addClass("disabled"), $("#insert-menu [data-block-auto-hide]").addClass("hide")), n == s.meta_block ? $('[data-insert-p="before"]').parent().addClass("disabled") : $('[data-insert="meta_block"]').removeClass("hide"), a.isType(n, s.html_block, s.math_block, s.meta_block) ? $("[data-group='block-wrap']").hide() : $("[data-group='block-wrap']").show(), c ? i.querySelector('[data-group="block-tab"]').classList.remove("hide") : i.querySelector('[data-group="block-tab"]').classList.add("hide"), u ? ($('[data-group="table"]').show(), i.querySelector('[data-key="block-style"]').classList.add("hide")) : ($('[data-group="table"]').hide(), i.querySelector('[data-key="block-style"]').classList.remove("hide")), h ? i.querySelector('[data-key="math"]').classList.remove("hide") : i.querySelector('[data-key="math"]').classList.add("hide"), p) {
                    var v = $(".md-emoji.md-expand [data-emoji]").attr("data-emoji");
                    v && (i.querySelector('[data-key="copy-emoji"] a').textContent = $.localize.getString("Copy '%@'", "Menu").replace("%@", v)), $("#context-menu [data-group='emoji']").addClass(v ? "show" : "hide")
                } else $("#context-menu [data-group='emoji']").addClass("hide");
                if ($("#context-menu [data-group='image']").addClass("hide"), f) {
                    var b = $(".md-image.md-expand").find("img").attr("src") || "";
                    if (!b) return;
                    /^file:\/\//.exec(b) && i.querySelector('[data-key="reveal-img-in-finder"]').classList.remove("hide");
                    var w = File.editor.imgEdit.getTagetImageStorageFolder();
                    if (w) {
                        var C = d.escapeURL(w);
                        if (-1 == b.replace(/^file:\/\//, "").indexOf(C)) {
                            var x = d.getFolder(w);
                            x && ($(i).find('[data-key="move-img-to-target"] a').text($.localize.getString("Copy to %@", "Menu").replace("%@", x)), i.querySelector('[data-key="move-img-to-target"]').classList.remove("hide"))
                        }
                    }
                    i.querySelector('[data-key="select-img-target"]').classList.remove("hide"), $('.divider[data-group="image"]').removeClass("hide")
                }
                var k = $(_).closest(".md-rawblock-container");
                k.length ? ($("[data-group='copy-paste']").hide(), $("[data-key='copy'], [data-group='edit-block']").show(), k.hasClass("md-htmlblock-container") && $("[data-key='copy']").hide()) : ($("[data-group='copy-paste']").show(), $("[data-group='edit-block']").hide()), $(_).closest("video").length ? $("[data-group='video']").show() : $(_).closest("video").length && $("[data-group='video']").hide()
            }(), window.reqnode && function () {
                var e = b(), t = $("#context-menu");
                if (i = ";" == i.trim() ? "" : i.trim(), e && i.length) if (e.isMisspelled(i)) {
                    y("spell-check", !0), t.find("[data-key='correct']").remove(), t.find("[data-key='unlearn']").hide();
                    var n = e.getCorrectionsForMisspelling(i.trim());
                    0 == n.length ? t.find("#divider-before-learn").hide() : (n = n.slice(0, 6), t.find("#divider-before-learn").show().before(n.reduce(function (e, t) {
                        return e += '<li data-group="spell-check" data-key="correct"><a role="menuitem">' + t + "</a></li>"
                    }, "")))
                } else e.isLearned(i) ? (t.find("[data-key='correct']").remove(), y("spell-check", !0), t.find("[data-key='learn'], #divider-before-learn").hide(), t.find("[data-key='unlearn']").show()) : y("spell-check", !1); else y("spell-check", !1)
            }();
            var n = $("#context-menu").addClass("show"), r = n.height() + 48,
                c = e.clientX > window.innerWidth - 220 ? window.innerWidth - 220 : e.clientX,
                u = e.clientY > window.innerHeight - r ? window.innerHeight - r : e.clientY - $("#top-titlebar").height() + 8;
            n.css({top: u + "px", left: c + "px"}), e.preventDefault(), e.stopPropagation()
        }, C.prototype.hide = p;
        var D = function (e, t) {
            var n = $(e).addClass("show"), i = n.height() + 48, r = t.offset(), o = r.left, a = o + 200, s = r.top - 30,
                l = a + 160 > window.innerWidth ? o - 184 : a,
                c = s + i > window.innerHeight ? window.innerHeight - i : s;
            return n.css({top: c + "px", left: l + "px"}), !1
        };
        C.prototype.showExtMenu = D;
        var O = function (e, t) {
            var n, i, r = $(e);
            if ("Enter" == t) {
                if (!r.hasClass("has-extra-menu")) {
                    var o = r.find("a");
                    return o.length ? o.trigger("click") : r.trigger("click"), !0
                }
                t = "OpenSubmenu"
            }
            if ("Up" == t || "Down" == t) return r = r.closest("li"), 0 == (n = "Up" == t ? r.prev() : r.next()).length ? (r.closest("#user-context-menu").length && p(), !0) : !n.height() || n.hasClass("divider") ? O(n[0], t) : (r = r.closest(".context-menu").find(".active"), n.hasClass("has-btn-submenu") ? (i = r.prevAll("a").length / (r.closest(".has-btn-submenu").find("a").length || 1) * n.find("a").length, (n = $(n.find("[data-key]")[Math.floor(i)])).trigger("mouseenter"), !0) : (r.removeClass("active"), n.addClass("active"), !0));
            if (("Left" == t || "Right" == t) && "A" == r[0].tagName) return n = "Left" == t ? r.prev() : r.next(), r.removeClass("active"), n.addClass("active"), !0;
            if ("Left" == t || "Esc" == t) {
                if ((r = r.closest(".context-menu")).hasClass("ext-context-menu")) return r.find(".active").removeClass("active"), r.removeClass("show"), !0;
                if ("Left" == t) return !0
            }
            return "Right" == t || "OpenSubmenu" == t ? (r.hasClass("has-extra-menu") && (r.trigger("mouseenter"), $(".ext-context-menu:visible [data-key]:visible").first().trigger("mouseenter")), !0) : void 0
        };
        C.prototype.handleKeyEvent = function (e) {
            var t = h[e.keyCode || e.which];
            if (a.isType(t, "Esc", "Right", "Left", "Up", "Down", "Return", "Enter")) {
                var n, i = $(".context-menu:visible");
                return !!i.length && ("Esc" == t ? ($(".context-menu").removeClass("show").find(".active").removeClass("active"), !0) : i.find(".active").length ? (n = $(".ext-context-menu .active")[0]) ? O(n, t) : O($(".context-menu .active")[0], t) : "Up" == t ? (i.find("li[data-key]:visible").last().addClass("active"), !0) : "Down" == t ? (i.find("li[data-key]:visible").first().addClass("active"), !0) : void 0)
            }
        };
        var I, P, B;
        C.prototype.getCustomFocuedElem = function () {
            return I.length ? I : null
        }, C.prototype.hideCustomMenu = function (e) {
            e == P && $("#user-context-menu.show").length && this.hide()
        }, C.prototype.showCustom = function (e, t) {
            if (I = null, window.getSelection().rangeCount) {
                P = t, B = e;
                var n = $("#user-context-menu").html(e.map(function (e) {
                    return e.key == C.SPLITER ? '<li for-file class="divider"></li>' : '<li data-key="' + e.key + '"><a role="menuitem">' + $.localize.getString(e.label, "Menu").replace("%@", e.variable || "") + "</a></li>"
                }).join(""));
                setTimeout(function () {
                    var e = window.getSelection().getRangeAt(0), t = e.getClientRects(),
                        i = t.length && t[t.length - 1];
                    if ((!i || 0 == i.left && 0 == i.height) && (e.selectNodeContents(e.commonAncestorContainer), i = (t = e.getClientRects()).length && t[t.length - 1]), i && (0 != i.left || 0 != i.height)) {
                        var r = $(e.commonAncestorContainer).closest("[cid]")[0].getBoundingClientRect().left || 0;
                        n.addClass("show").css({
                            top: i.bottom + "px",
                            left: Math.max(r, i.right - n.width() + 20) + "px"
                        }), I = $(e.commonAncestorContainer).closest("[md-inline]")
                    }
                }, 100)
            }
        }, C.SPLITER = "divider", n.exports = C
    }), function () {
        function e(t, n, i) {
            var r = e.resolve(t);
            if (null == r) {
                i = i || t, n = n || "root";
                var o = new Error('Failed to require "' + i + '" from "' + n + '"');
                throw o.path = i, o.parent = n, o.require = !0, o
            }
            var a = e.modules[r];
            if (!a._resolving && !a.exports) {
                var s = {};
                s.exports = {}, s.client = s.component = !0, a._resolving = !0, a.call(this, s.exports, e.relative(r), s), delete a._resolving, a.exports = s.exports
            }
            return a.exports
        }

        e.modules = {}, e.aliases = {}, e.resolve = function (t) {
            "/" === t.charAt(0) && (t = t.slice(1));
            for (var n = [t, t + ".js", t + ".json", t + "/index.js", t + "/index.json"], i = 0; i < n.length; i++) {
                t = n[i];
                if (e.modules.hasOwnProperty(t)) return t;
                if (e.aliases.hasOwnProperty(t)) return e.aliases[t]
            }
        }, e.normalize = function (e, t) {
            var n = [];
            if ("." != t.charAt(0)) return t;
            e = e.split("/"), t = t.split("/");
            for (var i = 0; i < t.length; ++i) ".." == t[i] ? e.pop() : "." != t[i] && "" != t[i] && n.push(t[i]);
            return e.concat(n).join("/")
        }, e.register = function (t, n) {
            e.modules[t] = n
        }, e.alias = function (t, n) {
            if (!e.modules.hasOwnProperty(t)) throw new Error('Failed to alias "' + t + '", it does not exist');
            e.aliases[n] = t
        }, e.relative = function (t) {
            var n = e.normalize(t, "..");

            function i(n) {
                return e(i.resolve(n), t, n)
            }

            return i.resolve = function (i) {
                var r = i.charAt(0);
                if ("/" == r) return i.slice(1);
                if ("." == r) return e.normalize(n, i);
                var o = t.split("/"), a = function (e, t) {
                    for (var n = e.length; n--;) if (e[n] === t) return n;
                    return -1
                }(o, "deps") + 1;
                return a || (a = 0), i = o.slice(0, a + 1).join("/") + "/deps/" + i
            }, i.exists = function (t) {
                return e.modules.hasOwnProperty(i.resolve(t))
            }, i
        }, e.register("component-classes/index.js", function (e, t, n) {
            var i = t("indexof"), r = /\s+/, o = Object.prototype.toString;
            n.exports = function (e) {
                return new a(e)
            };

            function a(e) {
                if (!e) throw new Error("A DOM element reference is required");
                this.el = e, this.list = e.classList
            }

            a.prototype.add = function (e) {
                if (this.list) return this.list.add(e), this;
                var t = this.array();
                return ~i(t, e) || t.push(e), this.el.className = t.join(" "), this
            }, a.prototype.remove = function (e) {
                if ("[object RegExp]" == o.call(e)) return this.removeMatching(e);
                if (this.list) return this.list.remove(e), this;
                var t = this.array(), n = i(t, e);
                return ~n && t.splice(n, 1), this.el.className = t.join(" "), this
            }, a.prototype.removeMatching = function (e) {
                for (var t = this.array(), n = 0; n < t.length; n++) e.test(t[n]) && this.remove(t[n]);
                return this
            }, a.prototype.toggle = function (e, t) {
                return this.list ? (void 0 !== t ? t !== this.list.toggle(e, t) && this.list.toggle(e) : this.list.toggle(e), this) : (void 0 !== t ? t ? this.add(e) : this.remove(e) : this.has(e) ? this.remove(e) : this.add(e), this)
            }, a.prototype.array = function () {
                var e = this.el.className.replace(/^\s+|\s+$/g, "").split(r);
                return "" === e[0] && e.shift(), e
            }, a.prototype.has = a.prototype.contains = function (e) {
                return this.list ? this.list.contains(e) : !!~i(this.array(), e)
            }
        }), e.register("segmentio-extend/index.js", function (e, t, n) {
            n.exports = function (e) {
                for (var t, n = Array.prototype.slice.call(arguments, 1), i = 0; t = n[i]; i++) if (t) for (var r in t) e[r] = t[r];
                return e
            }
        }), e.register("component-indexof/index.js", function (e, t, n) {
            n.exports = function (e, t) {
                if (e.indexOf) return e.indexOf(t);
                for (var n = 0; n < e.length; ++n) if (e[n] === t) return n;
                return -1
            }
        }), e.register("component-event/index.js", function (e, t, n) {
            var i = window.addEventListener ? "addEventListener" : "attachEvent",
                r = window.removeEventListener ? "removeEventListener" : "detachEvent",
                o = "addEventListener" !== i ? "on" : "";
            e.bind = function (e, t, n, r) {
                return e[i](o + t, n, r || !1), n
            }, e.unbind = function (e, t, n, i) {
                return e[r](o + t, n, i || !1), n
            }
        }), e.register("timoxley-to-array/index.js", function (e, t, n) {
            n.exports = function (e) {
                if (void 0 === e) return [];
                if (null === e) return [null];
                if (e === window) return [window];
                if ("string" == typeof e) return [e];
                if (t = e, "[object Array]" === Object.prototype.toString.call(t)) return e;
                var t;
                if ("number" != typeof e.length) return [e];
                if ("function" == typeof e && e instanceof Function) return [e];
                for (var n = [], i = 0; i < e.length; i++) (Object.prototype.hasOwnProperty.call(e, i) || i in e) && n.push(e[i]);
                return n.length ? n : []
            }
        }), e.register("javve-events/index.js", function (e, t, n) {
            var i = t("event"), r = t("to-array");
            e.bind = function (e, t, n, o) {
                e = r(e);
                for (var a = 0; a < e.length; a++) i.bind(e[a], t, n, o)
            }, e.unbind = function (e, t, n, o) {
                e = r(e);
                for (var a = 0; a < e.length; a++) i.unbind(e[a], t, n, o)
            }
        }), e.register("javve-get-by-class/index.js", function (e, t, n) {
            n.exports = document.getElementsByClassName ? function (e, t, n) {
                return n ? e.getElementsByClassName(t)[0] : e.getElementsByClassName(t)
            } : document.querySelector ? function (e, t, n) {
                return t = "." + t, n ? e.querySelector(t) : e.querySelectorAll(t)
            } : function (e, t, n) {
                var i = [];
                null == e && (e = document);
                for (var r = e.getElementsByTagName("*"), o = r.length, a = new RegExp("(^|\\s)" + t + "(\\s|$)"), s = 0, l = 0; s < o; s++) if (a.test(r[s].className)) {
                    if (n) return r[s];
                    i[l] = r[s], l++
                }
                return i
            }
        }), e.register("javve-get-attribute/index.js", function (e, t, n) {
            n.exports = function (e, t) {
                var n = e.getAttribute && e.getAttribute(t) || null;
                if (!n) for (var i = e.attributes.length, r = 0; r < i; r++) void 0 !== t[r] && t[r].nodeName === t && (n = t[r].nodeValue);
                return n
            }
        }), e.register("javve-natural-sort/index.js", function (e, t, n) {
            n.exports = function (e, t, n) {
                var i, r, o = /(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi, a = /(^[ ]*|[ ]*$)/g,
                    s = /(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,
                    l = /^0x[0-9a-f]+$/i, c = /^0/, d = (n = n || {}, function (e) {
                        return n.insensitive && ("" + e).toLowerCase() || "" + e
                    }), u = d(e).replace(a, "") || "", h = d(t).replace(a, "") || "",
                    f = u.replace(o, "\0$1\0").replace(/\0$/, "").replace(/^\0/, "").split("\0"),
                    p = h.replace(o, "\0$1\0").replace(/\0$/, "").replace(/^\0/, "").split("\0"),
                    m = parseInt(u.match(l)) || 1 != f.length && u.match(s) && Date.parse(u),
                    g = parseInt(h.match(l)) || m && h.match(s) && Date.parse(h) || null, v = n.desc ? -1 : 1;
                if (g) {
                    if (m < g) return -1 * v;
                    if (m > g) return 1 * v
                }
                for (var y = 0, b = Math.max(f.length, p.length); y < b; y++) {
                    if (i = !(f[y] || "").match(c) && parseFloat(f[y]) || f[y] || 0, r = !(p[y] || "").match(c) && parseFloat(p[y]) || p[y] || 0, isNaN(i) !== isNaN(r)) return isNaN(i) ? 1 : -1;
                    if (typeof i != typeof r && (i += "", r += ""), i < r) return -1 * v;
                    if (i > r) return 1 * v
                }
                return 0
            }
        }), e.register("javve-to-string/index.js", function (e, t, n) {
            n.exports = function (e) {
                return e = (e = null === (e = void 0 === e ? "" : e) ? "" : e).toString()
            }
        }), e.register("component-type/index.js", function (e, t, n) {
            var i = Object.prototype.toString;
            n.exports = function (e) {
                switch (i.call(e)) {
                    case"[object Date]":
                        return "date";
                    case"[object RegExp]":
                        return "regexp";
                    case"[object Arguments]":
                        return "arguments";
                    case"[object Array]":
                        return "array";
                    case"[object Error]":
                        return "error"
                }
                return null === e ? "null" : void 0 === e ? "undefined" : e != e ? "nan" : e && 1 === e.nodeType ? "element" : typeof e.valueOf()
            }
        }), e.register("list.js/index.js", function (e, t, n) {
            !function (e, i) {
                "use strict";
                var r = e.document, o = t("get-by-class"), a = t("extend"), s = t("indexof"), l = function (e, n, i) {
                    var c, d = this, u = t("./src/item")(d), h = t("./src/add-async")(d), f = t("./src/parse")(d);
                    c = {
                        start: function () {
                            d.listClass = "list", d.searchClass = "search", d.sortClass = "sort", d.page = 200, d.i = 1, d.items = [], d.visibleItems = [], d.matchingItems = [], d.searched = !1, d.filtered = !1, d.handlers = {updated: []}, d.plugins = {}, d.helpers = {
                                getByClass: o,
                                extend: a,
                                indexOf: s
                            }, a(d, n), d.listContainer = "string" == typeof e ? r.getElementById(e) : e, d.listContainer && (d.list = o(d.listContainer, d.listClass, !0), d.templater = t("./src/templater")(d), d.search = t("./src/search")(d), d.filter = t("./src/filter")(d), d.sort = t("./src/sort")(d), this.items(), d.update(), this.plugins())
                        }, items: function () {
                            f(d.list), void 0 !== i && d.add(i)
                        }, plugins: function () {
                            for (var e = 0; e < d.plugins.length; e++) {
                                var t = d.plugins[e];
                                d[t.name] = t, t.init(d, l)
                            }
                        }
                    }, this.add = function (e, t) {
                        if (!t) {
                            var n = [], i = !1;
                            void 0 === e[0] && (e = [e]);
                            for (var r = 0, o = e.length; r < o; r++) {
                                var a = null;
                                e[r] instanceof u ? (a = e[r]).reload() : (i = d.items.length > d.page, a = new u(e[r], void 0, i)), d.items.push(a), n.push(a)
                            }
                            return d.update(), n
                        }
                        h(e, t)
                    }, this.show = function (e, t) {
                        return this.i = e, this.page = t, d.update(), d
                    }, this.remove = function (e, t, n) {
                        for (var i = 0, r = 0, o = d.items.length; r < o; r++) d.items[r].values()[e] == t && (d.templater.remove(d.items[r], n), d.items.splice(r, 1), o--, r--, i++);
                        return d.update(), i
                    }, this.get = function (e, t) {
                        for (var n = [], i = 0, r = d.items.length; i < r; i++) {
                            var o = d.items[i];
                            o.values()[e] == t && n.push(o)
                        }
                        return n
                    }, this.size = function () {
                        return d.items.length
                    }, this.clear = function () {
                        return d.templater.clear(), d.items = [], d
                    }, this.on = function (e, t) {
                        return d.handlers[e].push(t), d
                    }, this.off = function (e, t) {
                        var n = d.handlers[e], i = s(n, t);
                        return i > -1 && n.splice(i, 1), d
                    }, this.trigger = function (e) {
                        for (var t = d.handlers[e].length; t--;) d.handlers[e][t](d);
                        return d
                    }, this.reset = {
                        filter: function () {
                            for (var e = d.items, t = e.length; t--;) e[t].filtered = !1;
                            return d
                        }, search: function () {
                            for (var e = d.items, t = e.length; t--;) e[t].found = !1;
                            return d
                        }
                    }, this.update = function () {
                        var e = d.items, t = e.length;
                        d.visibleItems = [], d.matchingItems = [], d.templater.clear();
                        for (var n = 0; n < t; n++) e[n].matching() && d.matchingItems.length + 1 >= d.i && d.visibleItems.length < d.page ? (e[n].show(), d.visibleItems.push(e[n]), d.matchingItems.push(e[n])) : e[n].matching() ? (d.matchingItems.push(e[n]), e[n].hide()) : e[n].hide();
                        return d.trigger("updated"), d
                    }, c.start()
                };
                n.exports = l
            }(window)
        }), e.register("list.js/src/search.js", function (e, t, n) {
            var i = t("events"), r = t("get-by-class"), o = t("to-string");
            n.exports = function (e) {
                var t, n, a, s, l = {
                    resetList: function () {
                        e.i = 1, e.templater.clear(), s = void 0
                    }, setOptions: function (e) {
                        2 == e.length && e[1] instanceof Array ? n = e[1] : 2 == e.length && "function" == typeof e[1] ? s = e[1] : 3 == e.length && (n = e[1], s = e[2])
                    }, setColumns: function () {
                        n = void 0 === n ? l.toArray(e.items[0].values()) : n
                    }, setSearchString: function (e) {
                        e = (e = o(e).toLowerCase()).replace(/[-[\]{}()*+?.,\\^$|#]/g, "\\$&"), a = e
                    }, toArray: function (e) {
                        var t = [];
                        for (var n in e) t.push(n);
                        return t
                    }
                }, c = {
                    list: function () {
                        for (var t = 0, n = e.items.length; t < n; t++) c.item(e.items[t])
                    }, item: function (e) {
                        e.found = !1;
                        for (var t = 0, i = n.length; t < i; t++) if (c.values(e.values(), n[t])) return void(e.found = !0)
                    }, values: function (e, n) {
                        return !!(e.hasOwnProperty(n) && (t = o(e[n]).toLowerCase(), "" !== a && t.search(a) > -1))
                    }, reset: function () {
                        e.reset.search(), e.searched = !1
                    }
                }, d = function (t) {
                    return e.trigger("searchStart"), l.resetList(), l.setSearchString(t), l.setOptions(arguments), l.setColumns(), "" === a ? c.reset() : (e.searched = !0, s ? s(a, n) : c.list()), e.update(), e.trigger("searchComplete"), e.visibleItems
                };
                return e.handlers.searchStart = e.handlers.searchStart || [], e.handlers.searchComplete = e.handlers.searchComplete || [], i.bind(r(e.listContainer, e.searchClass), "keyup", function (t) {
                    var n = t.target || t.srcElement;
                    "" === n.value && !e.searched || d(n.value)
                }), i.bind(r(e.listContainer, e.searchClass), "input", function (e) {
                    "" === (e.target || e.srcElement).value && d("")
                }), e.helpers.toString = o, d
            }
        }), e.register("list.js/src/sort.js", function (e, t, n) {
            var i = t("natural-sort"), r = t("classes"), o = t("events"), a = t("get-by-class"), s = t("get-attribute");
            n.exports = function (e) {
                e.sortFunction = e.sortFunction || function (e, t, n) {
                    return n.desc = "desc" == n.order, i(e.values()[n.valueName], t.values()[n.valueName], n)
                };
                var t = {
                    els: void 0, clear: function () {
                        for (var e = 0, n = t.els.length; e < n; e++) r(t.els[e]).remove("asc"), r(t.els[e]).remove("desc")
                    }, getOrder: function (e) {
                        var t = s(e, "data-order");
                        return "asc" == t || "desc" == t ? t : r(e).has("desc") ? "asc" : r(e).has("asc") ? "desc" : "asc"
                    }, getInSensitive: function (e, t) {
                        var n = s(e, "data-insensitive");
                        t.insensitive = "true" === n
                    }, setOrder: function (e) {
                        for (var n = 0, i = t.els.length; n < i; n++) {
                            var o = t.els[n];
                            if (s(o, "data-sort") === e.valueName) {
                                var a = s(o, "data-order");
                                "asc" == a || "desc" == a ? a == e.order && r(o).add(e.order) : r(o).add(e.order)
                            }
                        }
                    }
                }, n = function () {
                    e.trigger("sortStart"), options = {};
                    var n = arguments[0].currentTarget || arguments[0].srcElement || void 0;
                    n ? (options.valueName = s(n, "data-sort"), t.getInSensitive(n, options), options.order = t.getOrder(n)) : (options = arguments[1] || options, options.valueName = arguments[0], options.order = options.order || "asc", options.insensitive = void 0 === options.insensitive || options.insensitive), t.clear(), t.setOrder(options), options.sortFunction = options.sortFunction || e.sortFunction, e.items.sort(function (e, t) {
                        return options.sortFunction(e, t, options)
                    }), e.update(), e.trigger("sortComplete")
                };
                return e.handlers.sortStart = e.handlers.sortStart || [], e.handlers.sortComplete = e.handlers.sortComplete || [], t.els = a(e.listContainer, e.sortClass), o.bind(t.els, "click", n), e.on("searchStart", t.clear), e.on("filterStart", t.clear), e.helpers.classes = r, e.helpers.naturalSort = i, e.helpers.events = o, e.helpers.getAttribute = s, n
            }
        }), e.register("list.js/src/item.js", function (e, t, n) {
            n.exports = function (e) {
                return function (t, n, i) {
                    var r = this;
                    this._values = {}, this.found = !1, this.filtered = !1;
                    this.values = function (t, n) {
                        if (void 0 === t) return r._values;
                        for (var i in t) r._values[i] = t[i];
                        !0 !== n && e.templater.set(r, r.values())
                    }, this.show = function () {
                        e.templater.show(r)
                    }, this.hide = function () {
                        e.templater.hide(r)
                    }, this.matching = function () {
                        return e.filtered && e.searched && r.found && r.filtered || e.filtered && !e.searched && r.filtered || !e.filtered && e.searched && r.found || !e.filtered && !e.searched
                    }, this.visible = function () {
                        return r.elm.parentNode == e.list
                    }, function (t, n, i) {
                        if (void 0 === n) i ? r.values(t, i) : r.values(t); else {
                            r.elm = n;
                            var o = e.templater.get(r, t);
                            r.values(o)
                        }
                    }(t, n, i)
                }
            }
        }), e.register("list.js/src/templater.js", function (e, t, n) {
            var i = t("get-by-class");
            n.exports = function (e) {
                return new function (e) {
                    var t = function (t) {
                        if (void 0 === t) {
                            for (var n = e.list.childNodes, i = 0, r = n.length; i < r; i++) if (void 0 === n[i].data) return n[i];
                            return null
                        }
                        if (-1 !== t.indexOf("<")) {
                            var o = document.createElement("div");
                            return o.innerHTML = t, o.firstChild
                        }
                        return document.getElementById(e.item)
                    }(e.item), n = this;
                    this.get = function (e, t) {
                        n.create(e);
                        for (var r = {}, o = 0, a = t.length; o < a; o++) {
                            var s = i(e.elm, t[o], !0);
                            r[t[o]] = s ? s.innerHTML : ""
                        }
                        return r
                    }, this.set = function (e, t) {
                        if (!n.create(e)) for (var r in t) if (t.hasOwnProperty(r)) {
                            var o = i(e.elm, r, !0);
                            o && ("IMG" === o.tagName && "" !== t[r] ? o.src = t[r] : o.innerHTML = t[r])
                        }
                    }, this.create = function (e) {
                        if (void 0 !== e.elm) return !1;
                        var i = t.cloneNode(!0);
                        return i.removeAttribute("id"), e.elm = i, n.set(e, e.values()), !0
                    }, this.remove = function (t) {
                        e.list.removeChild(t.elm)
                    }, this.show = function (t) {
                        n.create(t), e.list.appendChild(t.elm)
                    }, this.hide = function (t) {
                        void 0 !== t.elm && t.elm.parentNode === e.list && e.list.removeChild(t.elm)
                    }, this.clear = function () {
                        if (e.list.hasChildNodes()) for (; e.list.childNodes.length >= 1;) e.list.removeChild(e.list.firstChild)
                    }
                }(e)
            }
        }), e.register("list.js/src/filter.js", function (e, t, n) {
            n.exports = function (e) {
                return e.handlers.filterStart = e.handlers.filterStart || [], e.handlers.filterComplete = e.handlers.filterComplete || [], function (t) {
                    if (e.trigger("filterStart"), e.i = 1, e.reset.filter(), void 0 === t) e.filtered = !1; else {
                        e.filtered = !0;
                        for (var n = e.items, i = 0, r = n.length; i < r; i++) {
                            var o = n[i];
                            t(o) ? o.filtered = !0 : o.filtered = !1
                        }
                    }
                    return e.update(), e.trigger("filterComplete"), e.visibleItems
                }
            }
        }), e.register("list.js/src/add-async.js", function (e, t, n) {
            n.exports = function (e) {
                return function (t, n, i) {
                    var r = t.splice(0, 100);
                    i = (i = i || []).concat(e.add(r)), t.length > 0 ? setTimeout(function () {
                        addAsync(t, n, i)
                    }, 10) : (e.update(), n(i))
                }
            }
        }), e.register("list.js/src/parse.js", function (e, t, n) {
            n.exports = function (e) {
                var n = t("./item")(e), i = function (t, i) {
                    for (var r = 0, o = t.length; r < o; r++) e.items.push(new n(i, t[r]))
                };
                return function () {
                    var t = function (e) {
                        for (var t = e.childNodes, n = [], i = 0, r = t.length; i < r; i++) void 0 === t[i].data && n.push(t[i]);
                        return n
                    }(e.list), n = e.valueNames;
                    e.indexAsync ? function (t, n) {
                        var r = t.splice(0, 100);
                        i(r, n), t.length > 0 ? setTimeout(function () {
                            init.items.indexAsync(t, n)
                        }, 10) : e.update()
                    }(t, n) : i(t, n)
                }
            }
        }), e.alias("component-classes/index.js", "list.js/deps/classes/index.js"), e.alias("component-classes/index.js", "classes/index.js"), e.alias("component-indexof/index.js", "component-classes/deps/indexof/index.js"), e.alias("segmentio-extend/index.js", "list.js/deps/extend/index.js"), e.alias("segmentio-extend/index.js", "extend/index.js"), e.alias("component-indexof/index.js", "list.js/deps/indexof/index.js"), e.alias("component-indexof/index.js", "indexof/index.js"), e.alias("javve-events/index.js", "list.js/deps/events/index.js"), e.alias("javve-events/index.js", "events/index.js"), e.alias("component-event/index.js", "javve-events/deps/event/index.js"), e.alias("timoxley-to-array/index.js", "javve-events/deps/to-array/index.js"), e.alias("javve-get-by-class/index.js", "list.js/deps/get-by-class/index.js"), e.alias("javve-get-by-class/index.js", "get-by-class/index.js"), e.alias("javve-get-attribute/index.js", "list.js/deps/get-attribute/index.js"), e.alias("javve-get-attribute/index.js", "get-attribute/index.js"), e.alias("javve-natural-sort/index.js", "list.js/deps/natural-sort/index.js"), e.alias("javve-natural-sort/index.js", "natural-sort/index.js"), e.alias("javve-to-string/index.js", "list.js/deps/to-string/index.js"), e.alias("javve-to-string/index.js", "list.js/deps/to-string/index.js"), e.alias("javve-to-string/index.js", "to-string/index.js"), e.alias("javve-to-string/index.js", "javve-to-string/index.js"), e.alias("component-type/index.js", "list.js/deps/type/index.js"), e.alias("component-type/index.js", "type/index.js"), "object" == typeof exports ? module.exports = e("list.js") : $__System.registerDynamic("4d", [], !1, function (t, n, i) {
            return function () {
                return e("list.js")
            }.call(this)
        })
    }(), function () {
        function e(t, n, i) {
            var r = e.resolve(t);
            if (null == r) {
                i = i || t, n = n || "root";
                var o = new Error('Failed to require "' + i + '" from "' + n + '"');
                throw o.path = i, o.parent = n, o.require = !0, o
            }
            var a = e.modules[r];
            if (!a._resolving && !a.exports) {
                var s = {};
                s.exports = {}, s.client = s.component = !0, a._resolving = !0, a.call(this, s.exports, e.relative(r), s), delete a._resolving, a.exports = s.exports
            }
            return a.exports
        }

        e.modules = {}, e.aliases = {}, e.resolve = function (t) {
            "/" === t.charAt(0) && (t = t.slice(1));
            for (var n = [t, t + ".js", t + ".json", t + "/index.js", t + "/index.json"], i = 0; i < n.length; i++) {
                t = n[i];
                if (e.modules.hasOwnProperty(t)) return t;
                if (e.aliases.hasOwnProperty(t)) return e.aliases[t]
            }
        }, e.normalize = function (e, t) {
            var n = [];
            if ("." != t.charAt(0)) return t;
            e = e.split("/"), t = t.split("/");
            for (var i = 0; i < t.length; ++i) ".." == t[i] ? e.pop() : "." != t[i] && "" != t[i] && n.push(t[i]);
            return e.concat(n).join("/")
        }, e.register = function (t, n) {
            e.modules[t] = n
        }, e.alias = function (t, n) {
            if (!e.modules.hasOwnProperty(t)) throw new Error('Failed to alias "' + t + '", it does not exist');
            e.aliases[n] = t
        }, e.relative = function (t) {
            function n(i) {
                return e(n.resolve(i), t, i)
            }

            var i = e.normalize(t, "..");
            return n.resolve = function (n) {
                var r = n.charAt(0);
                if ("/" == r) return n.slice(1);
                if ("." == r) return e.normalize(i, n);
                var o = t.split("/"), a = function (e, t) {
                    for (var n = e.length; n--;) if (e[n] === t) return n;
                    return -1
                }(o, "deps") + 1;
                return a || (a = 0), o.slice(0, a + 1).join("/") + "/deps/" + n
            }, n.exists = function (t) {
                return e.modules.hasOwnProperty(n.resolve(t))
            }, n
        }, e.register("component-indexof/index.js", function (e, t, n) {
            n.exports = function (e, t) {
                if (e.indexOf) return e.indexOf(t);
                for (var n = 0; n < e.length; ++n) if (e[n] === t) return n;
                return -1
            }
        }), e.register("component-classes/index.js", function (e, t, n) {
            function i(e) {
                if (!e) throw new Error("A DOM element reference is required");
                this.el = e, this.list = e.classList
            }

            var r = t("indexof"), o = /\s+/, a = Object.prototype.toString;
            n.exports = function (e) {
                return new i(e)
            }, i.prototype.add = function (e) {
                if (this.list) return this.list.add(e), this;
                var t = this.array();
                return ~r(t, e) || t.push(e), this.el.className = t.join(" "), this
            }, i.prototype.remove = function (e) {
                if ("[object RegExp]" == a.call(e)) return this.removeMatching(e);
                if (this.list) return this.list.remove(e), this;
                var t = this.array(), n = r(t, e);
                return ~n && t.splice(n, 1), this.el.className = t.join(" "), this
            }, i.prototype.removeMatching = function (e) {
                for (var t = this.array(), n = 0; n < t.length; n++) e.test(t[n]) && this.remove(t[n]);
                return this
            }, i.prototype.toggle = function (e) {
                return this.list ? (this.list.toggle(e), this) : (this.has(e) ? this.remove(e) : this.add(e), this)
            }, i.prototype.array = function () {
                var e = this.el.className.replace(/^\s+|\s+$/g, "").split(o);
                return "" === e[0] && e.shift(), e
            }, i.prototype.has = i.prototype.contains = function (e) {
                return this.list ? this.list.contains(e) : !!~r(this.array(), e)
            }
        }), e.register("segmentio-extend/index.js", function (e, t, n) {
            n.exports = function (e) {
                for (var t, n = Array.prototype.slice.call(arguments, 1), i = 0; t = n[i]; i++) if (t) for (var r in t) e[r] = t[r];
                return e
            }
        }), e.register("component-event/index.js", function (e) {
            var t = void 0 !== window.addEventListener ? "addEventListener" : "attachEvent",
                n = void 0 !== window.removeEventListener ? "removeEventListener" : "detachEvent",
                i = "addEventListener" !== t ? "on" : "";
            e.bind = function (e, n, r, o) {
                return e[t](i + n, r, o || !1), r
            }, e.unbind = function (e, t, r, o) {
                return e[n](i + t, r, o || !1), r
            }
        }), e.register("component-type/index.js", function (e, t, n) {
            var i = Object.prototype.toString;
            n.exports = function (e) {
                switch (i.call(e)) {
                    case"[object Function]":
                        return "function";
                    case"[object Date]":
                        return "date";
                    case"[object RegExp]":
                        return "regexp";
                    case"[object Arguments]":
                        return "arguments";
                    case"[object Array]":
                        return "array";
                    case"[object String]":
                        return "string"
                }
                return null === e ? "null" : void 0 === e ? "undefined" : e && 1 === e.nodeType ? "element" : e === Object(e) ? "object" : typeof e
            }
        }), e.register("timoxley-is-collection/index.js", function (e, t, n) {
            var i = t("type");
            n.exports = function (e) {
                var t = i(e);
                if ("array" === t) return 1;
                switch (t) {
                    case"arguments":
                        return 2;
                    case"object":
                        if ("object" == typeof(n = e) && /^\[object (NodeList)\]$/.test(Object.prototype.toString.call(n)) && n.hasOwnProperty("length") && (0 == n.length || "object" == typeof n[0] && n[0].nodeType > 0)) return 2;
                        try {
                            if ("length" in e && !e.tagName && (!e.scrollTo || !e.document) && !e.apply) return 2
                        } catch (e) {
                        }
                    default:
                        return 0
                }
                var n
            }
        }), e.register("javve-events/index.js", function (e, t) {
            var n = t("event"), i = t("is-collection");
            e.bind = function (e, t, r, o) {
                if (i(e)) {
                    if (e && void 0 !== e[0]) for (var a = 0; a < e.length; a++) n.bind(e[a], t, r, o)
                } else n.bind(e, t, r, o)
            }, e.unbind = function (e, t, r, o) {
                if (i(e)) {
                    if (e && void 0 !== e[0]) for (var a = 0; a < e.length; a++) n.unbind(e[a], t, r, o)
                } else n.unbind(e, t, r, o)
            }
        }), e.register("javve-get-by-class/index.js", function (e, t, n) {
            n.exports = document.getElementsByClassName ? function (e, t, n) {
                return n ? e.getElementsByClassName(t)[0] : e.getElementsByClassName(t)
            } : document.querySelector ? function (e, t, n) {
                return n ? e.querySelector(t) : e.querySelectorAll(t)
            } : function (e, t, n) {
                var i = [];
                null == e && (e = document);
                for (var r = e.getElementsByTagName("*"), o = r.length, a = new RegExp("(^|\\s)" + t + "(\\s|$)"), s = 0, l = 0; o > s; s++) if (a.test(r[s].className)) {
                    if (n) return r[s];
                    i[l] = r[s], l++
                }
                return i
            }
        }), e.register("javve-to-string/index.js", function (e, t, n) {
            n.exports = function (e) {
                return (e = null === (e = void 0 === e ? "" : e) ? "" : e).toString()
            }
        }), e.register("list.fuzzysearch.js/index.js", function (e, t, n) {
            var i = (t("classes"), t("events")), r = t("extend"), o = t("to-string"), a = t("get-by-class");
            n.exports = function (e) {
                r(e = e || {}, {
                    location: 0,
                    distance: 100,
                    threshold: .4,
                    multiSearch: !0,
                    searchClass: "fuzzy-search"
                });
                var n, s = t("./src/fuzzy"), l = {
                    search: function (t, i) {
                        for (var r = e.multiSearch ? t.replace(/ +$/, "").split(/ +/) : [t], o = 0, a = n.items.length; a > o; o++) l.item(n.items[o], i, r)
                    }, item: function (e, t, n) {
                        for (var i = !0, r = 0; r < n.length; r++) {
                            for (var o = !1, a = 0, s = t.length; s > a; a++) l.values(e.values(), t[a], n[r]) && (o = !0);
                            o || (i = !1)
                        }
                        e.found = i
                    }, values: function (t, n, i) {
                        if (t.hasOwnProperty(n)) {
                            var r = o(t[n]).toLowerCase();
                            if (s(r, i, e)) return !0
                        }
                        return !1
                    }
                };
                return {
                    init: function (t) {
                        n = t, i.bind(a(n.listContainer, e.searchClass), "keyup", function (e) {
                            var t = e.target || e.srcElement;
                            n.search(t.value, l.search)
                        })
                    }, search: function (e, t) {
                        n.search(e, t, l.search)
                    }, name: e.name || "fuzzySearch"
                }
            }
        }), e.register("list.fuzzysearch.js/src/fuzzy.js", function (e, t, n) {
            n.exports = function (e, t, n) {
                function i(e, n) {
                    var i = e / t.length, r = Math.abs(s - n);
                    return o ? i + r / o : r ? 1 : i
                }

                var r = n.location || 0, o = n.distance || 100, a = n.threshold || .4;
                if (t === e) return !0;
                if (t.length > 32) return !1;
                var s = r, l = function () {
                    var e, n = {};
                    for (e = 0; e < t.length; e++) n[t.charAt(e)] = 0;
                    for (e = 0; e < t.length; e++) n[t.charAt(e)] |= 1 << t.length - e - 1;
                    return n
                }(), c = a, d = e.indexOf(t, s);
                -1 != d && (c = Math.min(i(0, d), c), d = e.lastIndexOf(t, s + t.length), -1 != d && (c = Math.min(i(0, d), c)));
                var u = 1 << t.length - 1;
                d = -1;
                for (var h, f, p, m = t.length + e.length, g = 0; g < t.length; g++) {
                    for (h = 0, f = m; f > h;) i(g, s + f) <= c ? h = f : m = f, f = Math.floor((m - h) / 2 + h);
                    m = f;
                    var v = Math.max(1, s - f + 1), y = Math.min(s + f, e.length) + t.length, b = Array(y + 2);
                    b[y + 1] = (1 << g) - 1;
                    for (var w = y; w >= v; w--) {
                        var C = l[e.charAt(w - 1)];
                        if (b[w] = 0 === g ? (b[w + 1] << 1 | 1) & C : (b[w + 1] << 1 | 1) & C | (p[w + 1] | p[w]) << 1 | 1 | p[w + 1], b[w] & u) {
                            var x = i(g, w - 1);
                            if (c >= x) {
                                if (c = x, !((d = w - 1) > s)) break;
                                v = Math.max(1, 2 * s - d)
                            }
                        }
                    }
                    if (i(g + 1, s) > c) break;
                    p = b
                }
                return !(0 > d)
            }
        }), e.alias("component-classes/index.js", "list.fuzzysearch.js/deps/classes/index.js"), e.alias("component-classes/index.js", "classes/index.js"), e.alias("component-indexof/index.js", "component-classes/deps/indexof/index.js"), e.alias("segmentio-extend/index.js", "list.fuzzysearch.js/deps/extend/index.js"), e.alias("segmentio-extend/index.js", "extend/index.js"), e.alias("javve-events/index.js", "list.fuzzysearch.js/deps/events/index.js"), e.alias("javve-events/index.js", "events/index.js"), e.alias("component-event/index.js", "javve-events/deps/event/index.js"), e.alias("timoxley-is-collection/index.js", "javve-events/deps/is-collection/index.js"), e.alias("component-type/index.js", "timoxley-is-collection/deps/type/index.js"), e.alias("javve-get-by-class/index.js", "list.fuzzysearch.js/deps/get-by-class/index.js"), e.alias("javve-get-by-class/index.js", "get-by-class/index.js"), e.alias("javve-to-string/index.js", "list.fuzzysearch.js/deps/to-string/index.js"), e.alias("javve-to-string/index.js", "list.fuzzysearch.js/deps/to-string/index.js"), e.alias("javve-to-string/index.js", "to-string/index.js"), e.alias("javve-to-string/index.js", "javve-to-string/index.js"), e.alias("list.fuzzysearch.js/index.js", "list.fuzzysearch.js/index.js"), "object" == typeof exports ? module.exports = e("list.fuzzysearch.js") : $__System.registerDynamic("4e", [], !1, function (t, n, i) {
            return function () {
                return e("list.fuzzysearch.js")
            }.call(this)
        })
    }(), $__System.registerDynamic("4f", [], !0, function (e, t, n) {
        "use strict";
        this || self;
        if (window.reqnode) {
            var i = reqnode("fs"), r = reqnode("path"), o = {}, a = function (e) {
                return r.join(r.dirname(e), ".~" + r.basename(e))
            }, s = function (e) {
                this.file = e, this.callbacks = [], this.nextData = null, this.nextCallbacks = []
            };
            s.prototype.write = function (e, t) {
                var n = this;

                function r(e) {
                    for (; this.callbacks.length;) this.callbacks.shift()(e);
                    t(e), o()
                }

                function o() {
                    if (n.lock = !1, n.nextData) {
                        var e = n.nextData;
                        n.callbacks = n.nextCallbacks, n.nextData = null, n.nextCallbacks = [], n.write(e, n.callbacks.pop())
                    }
                }

                function s(e, n) {
                    for (; this.callbacks.length;) this.callbacks.shift()(e);
                    t(null, n), o()
                }

                this.lock ? (t && this.nextCallbacks.push(t), this.nextData = e) : (this.lock = !0, i.stat(this.file, function (t, n) {
                    if (!t && n) {
                        var o = a(this.file);
                        i.writeFile(o, e, function (t) {
                            i.writeFile(this.file, e, function (e) {
                                e ? r.call(this, e) : i.unlink(o, s.bind(this))
                            }.bind(this))
                        }.bind(this))
                    } else (function () {
                        i.writeFile(this.file, e, function (e) {
                            e ? r.call(this, e) : s.call(this, null, !0)
                        }.bind(this))
                    }).call(this)
                }.bind(this)))
            }, t.writeFile = function (e, t, n) {
                e = r.resolve(e), o[e] = o[e] || new s(e), o[e].write(t, n)
            }, t.writeFileSync = function (e, t) {
                i.writeFileSync(a(e), t), i.renameSync(a(e), e)
            }
        }
    }), $__System.registerDynamic("44", ["50", "11", "e", "13", "1a", "12", "37", "31", "41", "3e", "4f"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i = e("50"), r = (e("11"), e("e")), o = e("13"), a = e("1a"), s = a.SnapFlag, l = e("12"), c = l.Node,
            d = l.TYPE, u = (e("37"), e("31")), h = e("41"), f = e("3e"), p = u.ChangeCounter,
            m = (u.ChangeType, e("4f")), g = window.reqnode ? reqnode("electron").remote : null,
            v = g ? g.app : window.app;

        function y(e, t) {
            return void 0 === e ? t : e
        }

        function b() {
            return w.isMac ? v.menu.getItem("Edit").submenu().getItem("Whitespace and Line Breaks").submenu() : w.isNode ? g.Menu.getApplicationMenu().getItem("Edit").submenu.getItem("Whitespace and Line Breaks").submenu : void 0
        }

        var w = {
            MAX_FILE_SIZE: 1e6,
            option: {
                indentByTab: !1,
                indentSize: 2,
                codeIndentSize: 4,
                autoToggleEmojiAutoComplete: !0,
                enableInlineMath: !0,
                autoNumberingForMath: !1,
                enableHighlight: !1,
                enableSubscript: !1,
                enableSuperscript: !1,
                enableDiagram: !1,
                copyMarkdownByDefault: !1,
                showLineNumbersForFence: !1,
                useRelativePathForImg: !1,
                autoCorrectMisspell: !1,
                noPairingMatch: !1,
                autoPairExtendSymbol: !1,
                enableAutoSave: !1,
                scrollWithCursor: !1,
                expandSimpleBlock: !1,
                allowImageMove: !0,
                allowImageUpload: !0,
                headingStyle: 0,
                ulStyle: 0,
                olStyle: 0,
                strictMarkdown: !1,
                preferCRLF: !1,
                sortType: 0,
                sidebarTab: "",
                useTreeStyle: !1,
                noLineWrapping: !1,
                prettyIndent: !1,
                defaultImageStorage: null,
                applyImageMoveForWeb: !1,
                applyImageMoveForLocal: !0,
                ignoreLineBreak: !1,
                preLinebreakOnExport: !1,
                hideBrAndLineBreak: !1,
                indentFirstLine: !1,
                monocolorEmoji: !1,
                useFsQueue: !0,
                isLocked: !1,
                notGroupByFolder: !1,
                convertSmartOnRender: !1,
                remapUnicodePunctuation: !1,
                smartDash: !1,
                smartQuote: !1,
                userQuotesArray: null,
                autoResizeIframe: !0,
                blockHTML: !0,
                imageExportFontSize: "24px",
                imageExportWidth: 640,
                sendAnonymousUsage: !0,
                presetSpellCheck: "auto",
                sidebarWidth: null
            },
            needSaveState: !1,
            fileHasModified: !1,
            readOption: function () {
                function e(e) {
                    return w.isMac ? v.setting.get(e) : w.isNode ? v.setting.get(e) : void 0
                }

                function t(e) {
                    return w.isMac ? v.setting.getInteger(e) : w.isNode ? v.setting.get(e) : void 0
                }

                w.isMac ? (w.option.instance = v.setting.getInstanceKey(), w.option.uuid = v.setting.getUserId(), w.option.appVersion = v.setting.getAppVersion(), w.option.autoToggleEmojiAutoComplete = y(e("trigger_emoji_autocomplete"), !0), w.option.enableInlineMath = e("enable_inline_math"), w.option.enableHighlight = e("enable_highlight") || !1, w.option.enableSubscript = e("enable_subscript") || !1, w.option.enableSuperscript = e("enable_superscript") || !1, w.option.enableDiagram = y(e("enable_diagram"), !0), w.option.copyMarkdownByDefault = e("copy_markdown_by_default") || !1, w.option.showLineNumbersForFence = e("show_line_numbers_for_fence") || !1, w.option.noPairingMatch = e("no_pairing_match") || !1, w.option.autoPairExtendSymbol = e("match_pari_markdown") || !1, w.option.expandSimpleBlock = e("auto_expand_block") || !1, w.option.headingStyle = t("heading_style") || 0, w.option.ulStyle = t("ul_style") || 0, w.option.olStyle = t("ol_style") || 0, w.option.scrollWithCursor = !e("no_mid_caret"), w.option.autoNumberingForMath = e("auto_numbering_for_math"), w.option.useRelativePathForImg = e("use_relative_path_for_img") || !1, w.option.allowImageUpload = e("allow_image_upload") || !1, w.option.defaultImageStorage = v.setting.get("image_save_location") || null, "custom" == w.option.defaultImageStorage && (w.option.defaultImageStorage = v.setting.get("custom_image_save_location")), w.option.applyImageMoveForWeb = v.setting.get("apply_image_move_for_web") || !1, w.option.applyImageMoveForLocal = !v.setting.get("no_image_move_for_local"), w.option.preferCRLF = e("line_ending_crlf") || !1, w.option.sidebarTab = v.setting.get("sidebar_tab") || "", w.option.useTreeStyle = e("useTreeStyle") || !1, w.option.sortType = t("file_sort_type") || 0, w.option.strictMarkdown = e("strict_mode") || !1, w.option.noLineWrapping = e("no_line_wrapping") || !1, w.option.prettyIndent = e("prettyIndent") || !1, w.option.convertSmartOnRender = e("SmartyPantsOnRendering"), w.option.smartDash = e("smartDash"), w.option.smartQuote = e("smartQuote"), w.option.remapUnicodePunctuation = e("remapPunctuation"), w.option.indentSize = v.setting.getInteger("indentSize") || 2, w.option.codeIndentSize = v.setting.getInteger("codeIndentSize") || 4, w.option.userQuotesArray = v.setting.getUserQuotesArray() || null, w.option.useCustomFontSize = v.setting.get("useCustomFontSize"), w.option.customFontSize = v.setting.get("customFontSize"), w.option.canCollapseOutlinePanel = v.setting.get("can_collapse_outline_panel"), w.option.preLinebreakOnExport = v.setting.get("preLinebreakOnExport"), w.option.preLinebreakOnExport = 1 == w.option.preLinebreakOnExport || "true" == w.option.preLinebreakOnExport, w.option.indentFirstLine = v.setting.get("indentFirstLine"), w.option.hideBrAndLineBreak = v.setting.get("hideBrAndLineBreak"), w.option.isFocusMode = v.setting.get("isFocusMode"), w.option.isTypeWriterMode = v.setting.get("isTypeWriterMode"), w.option.ignoreLineBreak = v.setting.get("ignoreLineBreak") || !1, w.option.sendAnonymousUsage = v.setting.get("send_usage_info"), w.option.sidebarWidth = v.setting.get("sidebar-width"), w.setupSafari()) : window._options && (w.option = r.extend(w.option, window._options)), w.setIndentSize(w.option.indentSize), window.innerWidth < 540 && (w.option.sidebarTab = null), w.option.useCustomFontSize && (document.body.parentElement.style.fontSize = w.option.customFontSize + "px"), w.setCanCollapsePinnedOutline(w.option.canCollapseOutlinePanel), 3 == w.option.headingStyle && document.body.classList.add("use-varible-width-setex"), w.option.noLineWrapping && r("#write").addClass("fences-no-line-wrapping"), w.setIndentFirstLine(w.option.indentFirstLine, !0), w.setHideBrAndLineBreak(w.option.hideBrAndLineBreak || !1, !0), w.isFocusMode = w.option.isFocusMode, w.isTypeWriterMode = w.option.isTypeWriterMode, w.setIgnoreLineBreak(w.option.ignoreLineBreak || !1), w.option.monocolorEmoji && document.body.classList.add("monocolor-emoji"), i.setTagsContext({
                    appVersion: w.option.appVersion,
                    instance: w.option.instance,
                    arch: window.process ? process.arch : "x64",
                    lang: w.option.userLocale
                }), i.setExtraContext({setting: w.option}), i.setUserContext({id: w.option.uuid})
            },
            setupSafari: function () {
                try {
                    var e = Object.defineProperty({}, "passive", {
                        get: function () {
                            w.option.passiveEvents = !0
                        }
                    });
                    window.addEventListener("test", null, e)
                } catch (e) {
                }
            },
            shouldRemapPunctuation: function () {
                return w.option.remapUnicodePunctuation || !w.option.convertSmartOnRender && (w.option.smartQuote || w.option.smartDash)
            },
            setIndentFirstLine: function (e, t, n) {
                w.option.indentFirstLine = e, w.option.indentFirstLine ? w.editor.writingArea.classList.add("first-line-indent") : w.editor.writingArea.classList.remove("first-line-indent"), t && (w.isNode || w.isMac) && (b().getItem("Indent first line of paragraphs").setState(w.option.indentFirstLine), h.forceRefreshMenu()), n && v.setting.put("indentFirstLine", e)
            },
            setHideBrAndLineBreak: function (e, t, n) {
                w.option.hideBrAndLineBreak = e, w.option.hideBrAndLineBreak ? document.body.classList.add("hide-br-and-line-break") : document.body.classList.remove("hide-br-and-line-break"), t && (w.isNode || w.isMac) && (b().getItem("Visible <br/>").setState(!w.option.hideBrAndLineBreak), h.forceRefreshMenu()), n && v.setting.put("hideBrAndLineBreak", e)
            },
            setIgnoreLineBreak: function (e, t, n) {
                (e = 1 == e || "true" == e) ? document.body.classList.add("ignore-line-break") : document.body.classList.remove("ignore-line-break"), w.option.ignoreLineBreak != e && (e ? r(".md-softbreak").html("<span contenteditable='false'></span>\n") : (r(".md-softbreak-emptyline").replaceWith("&#10;<span md-inline='emptyline' class='md-emptyline'>&#10;</span>"), r(".md-softbreak [contenteditable]").remove())), w.option.ignoreLineBreak = e, n && v.setting.put("ignoreLineBreak", e), t && (b().getItem("Preserve single line break").setState(!e), h.forceRefreshMenu())
            },
            setIndentSize: function (e) {
                w.option.indentSize = (e || 2) - 0, w.option.indentSize < 0 ? (w.option.indentSize = 2, w.option.indentByTab = !0) : w.option.indentByTab = !1
            },
            setEditor: function (e) {
                w.isLocked = w.isMac && v.document.isLocked(), w.editor = e, w.isMac || (w.changeCounter = new p)
            },
            onFileOpened: function () {
                if (w.isNode) {
                    reqnode("electron").ipcRenderer.send("addBackup", {
                        path: w.filePath,
                        mountFolder: w.mountFolder_,
                        encode: w.encode,
                        useCRLF: w.useCRLF
                    }), w.needSaveState = !1
                }
            },
            getFilePathUseNode: function () {
                if (w.isNode) {
                    var e = g.getCurrentWindow(), t = g.app.getDocumentController().getDocumentFromWindowId(e.id).path;
                    w.mountFolder_ || (w.mountFolder_ = e.initMountFolder, e.initMountFolder = void 0)
                }
                return t
            },
            setLineEnding: function (e, t, n) {
                if (e != w.useCRLF || n) {
                    w.useCRLF = e;
                    var i = {
                        "Edit→Line Endings→Windows Line Endings (CRLF)": {state: w.useCRLF, enabled: !w.isLocked},
                        "Edit→Line Endings→Unix Line Endings (LF)": {state: !w.useCRLF, enabled: !w.isLocked}
                    };
                    if (w.updateMenuToUI(i), t) {
                        w.sync();
                        var r = w.editor.getMarkdown();
                        r = (r.split(/\r?\n/g) || [r]).join(w.useCRLF ? "\r\n" : "\n"), w.reloadContent(r), w.backupWindow()
                    }
                }
            },
            loadInitData: function () {
                function e(e) {
                    var t = w.editor;
                    t.reset(e), t.writingArea.focus(), void 0 != e && e.trim().length ? (t.selection.lockScroll(), t.selection.jumpIntoElemEnd(r("[cid]").last())) : (r(t.sessionStr + ">*:first-child").addClass("md-focus"), t.selection.jumpTop())
                }

                if (w.isMacWK) bridge.callHandler("document.loadInitData", function (t) {
                    var n = t[0], i = t[1];
                    i && i.nodeMap ? w.restoreEditStateFromData(i, !1, !0) : e(n)
                }); else {
                    var t = w.getDocumentSnap();
                    (t || {}).nodeMap ? (f.setFileTitle(w.getFilePathUseNode(), t.fileEncode), w.restoreEditStateFromData(t, !1, !0)) : w.recoverFromBackup() || w.getContent().then(e), onFileOpened()
                }
            },
            recoverFromBackup: function () {
                if (!w.isNode) return !1;
                var e = w.getCurrentDocByNode(), t = e && e.popBackupState();
                if (!t || !t.content) return !1;
                if (w.setLineEnding(t.useCRLF), f.setFileTitle(t.path || "", t.encode), w.mountFolder_ = t.mountFolder, w.editor.reset(t.content), w.updateChangeCount(u.ChangeType.NSChangeDone), t.path) {
                    var n = a.makeEmptyCommand();
                    n.redo.push(a.buildAllDoc(w.editor.nodeMap)), w.fs.readFile(t.path, t.encode || "utf8", function (e, t) {
                        e || (n.undo.push({
                            type: "initSrc",
                            src: t
                        }), w.changeCounter.doneStack.unshift(u.ChangeType.NSChangeCleared), w.editor.undo.register(n, !0, void 0, !0))
                    })
                }
                return !0
            },
            getContent: function (e, t) {
                w.setLineEnding(w.option.preferCRLF);
                var n;
                if (w.isMac) return n = v.document.content || "", n = w.tryEnterOversize(n), w.setLineEnding(n.indexOf("\r\n") > -1 && !/[^\r]\n/.exec("a" + n)), n;
                if (w.isNode) {
                    var i = e;
                    try {
                        if (i = e || w.getFilePathUseNode()) {
                            var o = w.fs.readFileSync(i), a = t;
                            return o.length > w.MAX_FILE_SIZE ? (w.unsupported = !0, n = "", w.tryEnterOversize(null, !0)) : (a = a || u.detectEncodeByNode(o), n = u.getContentFromBuffer(o, a), w.setLineEnding(n.indexOf("\r\n") > -1 || !(n.indexOf("\n") > -1) && w.option.preferCRLF)), f.setFileTitle(i, a), n
                        }
                        f.setFileTitle()
                    } catch (e) {
                        if (w.option.slientOpenFailure = w.option.slientOpenFailure || g.getCurrentWindow().slientOpenFailure, !w.option.slientOpenFailure) {
                            var s = e.message || "";
                            debugMode || (s = s.splits && s.splits(/\n/)[0] || s), g.dialog.showErrorBox(r.localize.getString("Failed to load file"), s)
                        }
                        if (w.option.slientOpenFailure = !1, f.setFileTitle(""), f.watchFileChange(null), i) {
                            var l = v.getDocumentController().getDocument(i);
                            l && l.switchToUntitled()
                        }
                        return ""
                    }
                }
                return ""
            },
            setContent: function (e, t) {
                w.unsupported || (w.isMac ? v.document.content = e : t && w.isNode && v.documentController.setContentForWindow(e, g.getCurrentWindow().id), w.editor.tryEnterBusyMode(e))
            },
            getMountFolder: function () {
                return w.isMac ? v.controller.cachedMountFolder() : w.mountFolder_
            },
            setMountFolder: function (e) {
                w.mountFolder_ = e
            },
            sync: function (e, t, n) {
                if (!w.unsupported) {
                    var i;
                    if (w.editor.sourceView.inSourceMode) i = w.editor.sourceView.cm.getValue(w.useCRLF ? "\r\n" : "\n"), !n && w.setContent(i, t), (w.isMacLegacy || w.isMacWK) && e && w.isDocumentEdited() && w.editor.sourceView.onSave(); else {
                        w.editor.undo.completeSnap(!0), w.editor.store(null, !0), isInputComponent(document.activeElement) && r(document.activeElement).trigger("change").trigger("inline-change");
                        try {
                            r(".md-focus").closest(".unholdable").length || w.editor.autoRemoveUnholdable()
                        } catch (e) {
                            Reporter.error(e, {level: "warning"}), console.sendError(e.stack)
                        }
                        w.setContent(w.editor.getMarkdown(), t)
                    }
                }
            },
            isActiveWindow: function () {
                if (w.isMac) return v.controller.isActiveWindow();
                if (!w.isNode) return !0;
                var e = g.getCurrentWindow();
                if (e.id === (w.getCurrentDocByNode().activeWindow || {}).id) return !0;
                e.isFocused() && (console.warn("error found on windows focus management"), window.onWindowFocus())
            },
            shouldTriggerSyncChange: function () {
                if (w.isMac) return v.controller.shouldTriggerSyncChange();
                if (w.isNode) {
                    var e = w.getCurrentDocByNode();
                    return w.isActiveWindow() && e.windows.size > 1
                }
            },
            getCurrentDocByNode: function () {
                return w.isNode ? v.documentController.getDocumentFromWindowId(g.getCurrentWindow().id) : null
            },
            saveUseNode: function (e, t, n) {
                if (w.isActiveWindow() && !w.unsupported) {
                    w.sync();
                    var i, o = w.getFilePathUseNode(), a = w.fileEncode || "utf8", s = w.editor.getMarkdown(), l = !1;
                    if (!o && w.filePath && !n) {
                        o = w.filePath;
                        var c = reqnode("path").dirname(o);
                        reqnode("fs").existsSync(c) || (o = void 0), l = !0
                    }
                    if ((o || !n) && w.isNode) {
                        var d = reqnode("iconv-lite"), h = reqnode("electron").ipcRenderer;
                        try {
                            i = d.encode(s, a)
                        } catch (e) {
                            p()
                        }
                        0 == i.length && "" != s && p(), o && !t ? (w.inSavingProcess = w.inSavingProcess || !t, !l && v.sendEvent("willSave", o), m.writeFile(o, i, function (t, n) {
                            if (t) return Reporter.error(t, {fingerprint: ["steno2", "writeFile"]}), void g(t.stack);
                            n && f.watchFileChange(o);
                            try {
                                if (i.length && 0 == w.fs.statSync(o).size) return g("Failed to write file"), void Reporter.error("Failed to write file: File size is 0 but data is not", {fingerprint: ["steno2", "afterWriteFile"]});
                                var r = w.fs.statSync(o);
                                w.lastModifiedDate = r.mtimeMs
                            } catch (e) {
                                return g(e.stack), void Reporter.error(e)
                            }
                            w.lastSaved = new Date;
                            var a = w.getCurrentDocByNode();
                            l && a.rename(o), a.setLastSync(w.lastSaved - 0), w.changeCounter.isDocumentEdited() && w.updateChangeCount(w.ChangeType.NSChangeAutosaved), e && e(t), l || v.sendEvent("didSave", {
                                path: o,
                                summary: s.substr(0, 200),
                                lastModifiedDate: w.lastModifiedDate
                            }), w.inSavingProcess = !1, w.needSaveState = !0, w.backupWindow()
                        }), w.updateChangeCount(w.ChangeType.NSChangeAutosaved)) : n || (u.showSaveDialog(e || void 0), h.send("countly_add_event", {key: "saveFile"}))
                    }
                }

                function p(e) {
                    console.log("swith to utf8 encode"), i = Buffer.from(s), w.fileEncode = "utf8"
                }

                function g(e) {
                    n || alert(r.localize.getString("Save File Failed") + "\n" + e), console.sendError("fs write failed -- \n" + e), w.updateChangeCount(w.ChangeType.NodeSaveFailed), w.inSavingProcess = !1, w.backupWindow()
                }
            },
            recordEvent: function (e, t) {
                w.isNode && ipc.send("countly_add_event", {
                    key: e,
                    segment: t
                }), w.isMac && v.app.recordEvent(e, JSON.stringify(t || {}))
            },
            updateChangeCount: function (e) {
                if (!w.unsupported) if (w.editor.sourceView && w.editor.sourceView.inSourceMode) w.isMac ? e == w.ChangeType.NSChangeAutosaved ? (w.editor.sourceView.cm.save(), v.document.updateChangeCount(e)) : e == w.ChangeType.NSChangeCleared ? v.document.updateChangeCount(e) : v.document.isDocumentEdited() || v.document.updateChangeCount(w.ChangeType.NSChangeDone) : w.changeCounter.updateChangeCount(e); else if (w.needsUpdateSnap(), w.isMac) {
                    v.document.updateChangeCount(e);
                    var t = v.menu.getItem("Edit");
                    t && (t.submenu().getItem("Undo").setEnabled(w.editor.undo.hasUndo()), t.submenu().getItem("Redo").setEnabled(w.editor.undo.hasRedo()))
                } else if (w.changeCounter.updateChangeCount(e), e === w.ChangeType.NSChangeAutosaved ? x = !1 : (x = !0, w.needSaveState = !0), w.isNode) {
                    var n = g.Menu.getApplicationMenu().getItem("Edit").submenu;
                    n.getItem("Undo").setEnabled(w.editor.undo.hasUndo()), n.getItem("Redo").setEnabled(w.editor.undo.hasRedo()), releasePrintWin_(), releaseCaptureWin_()
                }
            },
            setDefaultImageStorage: function (e) {
                w.option.defaultImageStorage = e, w.editor.imgEdit && (w.editor.imgEdit.cachedFileImageStorage = null)
            },
            exitOversize: function () {
                var e = document.querySelector("#ty-oversize-body");
                e.style.display || (e.style.display = "none"), w.unsupported = !1
            },
            tryEnterOversize: function (e, t, n) {
                if (w.isMac && !v.document.currentFilePath()) return e;
                if (u.bindOversizePlaceholder(), t || e.length > w.MAX_FILE_SIZE) {
                    if (document.querySelector("#ty-oversize-body").style.display = "", w.unsupported = !0, w.isNode) {
                        var i = w.getCurrentDocByNode();
                        i && !n && i.addSnap(null)
                    }
                    return ""
                }
                return e
            },
            onSwitchDocumentTarget: function (e, t) {
                w.editor.brush.clearAndPause(), w.fileHasModified = !1, w.editor.focusCid = null, w.exitOversize(), w.isMac && w.editor.library.markCurrentFile();
                var n = w.tryEnterOversize(w.getContent(t)), i = w.editor.sourceView.inSourceMode;
                w.setDefaultImageStorage(w.option.defaultImageStorage), w._onInitParse = !0, e && e.nodeMap && e.undoRedo ? w.restoreEditStateFromData(e, void 0, !0) : (w.changeCounter && w.changeCounter.reset(), w.editor.undo.reset(), w.editor.nodeMap.reset(!1, !0), w.editor.reset(i ? "" : n)), i && w.editor.sourceView.setValue(n, !0);
                var o = null, a = 0;
                if ((!e || !e.nodeMap) && w.editor.undo.reset(), w.isMac) {
                    var s = v.window.getLastCursor() || [];
                    o = JSON.parse(s[1] || "null"), a = s[2] || 0
                }
                w.freshMenu(), w.editor.refresh(!1), w.editor.imgEdit.preFileImageStorage = void 0, w._onInitParse = !1, w.getMountFolder() || w.editor.library.onRootChanged(), o ? w.editor.undo.exeCommand(o) : (window.getSelection().removeAllRanges(), r("content").scrollTop(a)), w.backupWindow(), w.editor.brush.restart()
            },
            getDocumentSnap: function () {
                if (w.isMac) return v.document.snap;
                if (w.isNode) {
                    var e = w.getCurrentDocByNode();
                    if (e) return e.getSnap()
                }
            },
            restoreEditStateFromData: function (e, t, n) {
                if (!e || !e.undoRedo || !e.nodeMap) return !0;
                if (e.timeStamp == (w.isMac ? v.controller.contentSnapRestoredTime : w.contentSnapRestoredTime)) return !0;
                w.fileHasModified = !0;
                var i = null, o = w.editor, a = o.sourceView && o.sourceView.inSourceMode, s = !1;
                if (w._onInitParse = !0, w.editor.focusCid = null, w.editor.lastCursor = null, o.nodeMap.restoreFromJson(JSON.parse(e.nodeMap)), o.undo.restoreFromJson(JSON.parse(e.undoRedo)), w.setLineEnding(e.useCRLF), w._onInitParse = !1, w.isNode && (s = !w.getCurrentDocByNode().isSnapValid(), e.content = e.srcContent = w.getCurrentDocByNode().getContent(), o.tryEnterBusyMode(e.content)), a) t && (i = o.sourceView.cm.getScrollInfo().top), w.reloadContent(e.srcContent, !0, !1, !1, !0), e.srcHist && (o.sourceView.cm.doc.clearHistory(), o.sourceView.cm.doc.setHistory(JSON.parse(e.srcHist))), e.fromSourceMode || w.reloadContent(e.content, !1, !1, !1, n || w.isMac && !v.document.isDocumentEdited()), t && o.sourceView.cm.scrollTo(0, i); else if (t && (i = r("content").scrollTop()), e.fromSourceMode ? w.reloadContent(e.srcContent, !1, !1, !1, !0, n) : s || (r(o.sessionStr).html(l.NodeCollectionUtils.toHTML(o.nodeMap.blocks)), n || (o.focusCid = void 0, o.refresh())), t) {
                    if ("object" == typeof t) try {
                        o.undo.exeCommand(t)
                    } catch (e) {
                    }
                    r("content").scrollTop(i)
                }
                if (w.isMac && (v.controller.contentSnapRestoredTime = e.timeStamp), w.isNode) {
                    if (w._needsUpdateSnap = !1, w.contentSnapRestoredTime = e.timeStamp, w.changeCounter.reset(e.changeCounter), s) return w.reloadContent(w.getContent(), !1, !1, !0, !1, n), w.updateChangeCount(w.ChangeType.NSChangeAutosaved), void(w.fileHasModified = !1);
                    f.setFileTitle(w.filePath, e.fileEncode), w.editor.spellChecker && w.editor.spellChecker.reset(!0)
                }
                n || (w.freshMenu(), w.editor.refresh(!1, !0))
            },
            needsUpdateSnap: function () {
                w.isMac ? v.document.needsUpdateSnap() : w._needsUpdateSnap = !0
            },
            backupDocumentSnap: function () {
                w.isMac && v.document.backupDocumentSnap(), w.isNode && !w._onInitParse && w.buildDocumentSnap()
            },
            backupLastCursor: function () {
                if (w.isMac) {
                    var e = w.editor.sourceView.inSourceMode;
                    v.window.setLastCursor(JSON.stringify(w.editor.selection.buildUndo() || null), e ? 0 : r("content").scrollTop())
                }
            },
            buildDocumentSnap: function () {
                if (!w.unsupported && (w.sync(!1, !0), w.isMac && v.document.buildDocumentSnap(t()), w.isNode)) {
                    var e;
                    if (!w._needsUpdateSnap) return;
                    w._needsUpdateSnap = !1, (e = w.getCurrentDocByNode()) && e.shouldSaveSnap() && e.addSnap(t())
                }

                function t() {
                    var e = w.editor.sourceView.inSourceMode, t = {
                        nodeMap: JSON.stringify(w.editor.nodeMap.storeToJson()),
                        undoRedo: JSON.stringify(w.editor.undo.storeToJson()),
                        timeStamp: new Date - 0,
                        cursorPos: JSON.stringify(w.editor.selection.buildUndo()),
                        useCRLF: w.useCRLF
                    };
                    return t.scrollOffset = e ? 0 : r("content").scrollTop(), e && (t.fromSourceMode = !0, t.srcHist = JSON.stringify(w.editor.sourceView.cm.doc.getHistory())), w.isNode && (t.fileEncode = w.fileEncode, t.changeCounter = w.changeCounter.clone(), w.contentSnapRestoredTime = t.timeStamp), w.isMac && (v.controller.contentSnapRestoredTime = t.timeStamp), t
                }
            },
            presentedItemChanged: function (e) {
                if (w.isActiveWindow() && !w.unsupported) if (console.log("presentedItemChanged"), e && clientHanlderOnPresentationMoved(), w.isNode) {
                    if (w.filePath) {
                        if (w.inSavingProcess) return
                    } else w.filePath = w.getFilePathUseNode(), w.fileName = u.getFileNameFromPath(w.filePath);
                    w.filePath && w.fs.stat(w.filePath, function (e, t) {
                        if (t && !(w.lastModifiedDate >= t.mtimeMs)) {
                            w.lastModifiedDate = t.mtimeMs, console.log("presentedItemChanged did happen");
                            var n = w.changeCounter.isDocumentEdited();
                            if (function (e) {
                                var t, n = r("content").scrollTop();
                                if (e) {
                                    if (w.isMac ? t = v.document.getDataFromFile(!0) : w.isNode && (t = w.getContent(w.filePath, w.fileEncode)), w.unsupported) {
                                        if (w.isNode) {
                                            var i = w.getCurrentDocByNode();
                                            i && i.enterOversize()
                                        }
                                        return
                                    }
                                    w.reloadContent(t, !1, !1, !0), w.updateChangeCount(w.ChangeType.NSChangeAutosaved);
                                    var o = w.editor.sourceView;
                                    if (o.inSourceMode) {
                                        var a = o.cm.getScrollInfo().top, s = o.cm.listSelections();
                                        o.setValue(t), o.cm.setSelections(s), o.cm.scrollTo(0, a)
                                    }
                                    setTimeout(function () {
                                        w.setContent(t), r("content").scrollTop(n)
                                    }, 0)
                                } else w.updateChangeCount(w.ChangeType.NSChangeReadOtherContents)
                            }(!n || confirm(r.localize.getString("File content is changed by external applications. Reload content from disk ?"))), n) {
                                g.getCurrentWindow().focus()
                            }
                        }
                    })
                } else w.isMac && (v.document.isDocumentEdited() && !confirm(r.localize.getString("File content is changed by external applications. Reload content from disk ?")) || v.document.refreshContentFromDisk())
            },
            reloadWithEncoding: function (e) {
                if (w.isNode && w.filePath) {
                    var t = w.getContent(w.filePath, e);
                    w.reloadContent(t), w.updateChangeCount(w.ChangeType.NSChangeCleared), w.backupWindow()
                }
            },
            reloadContent: function (e, t, n, i, r, o) {
                if (!w.unsupported && w.isMac && i && (e = w.tryEnterOversize(e), w.unsupported && v.document.enterOversize()), !w.unsupported) {
                    var s, c, d = a.makeEmptyCommand(), u = w.editor.sourceView && w.editor.sourceView.inSourceMode;
                    w.isMac && w.setLineEnding(w.useCRLF), u || o || (w.editor.store(), w.editor.undo.completeSnap(!0), d.undo.push(w.editor.selection.buildUndo())), w.editor.focusCid = null, w.editor.lastCursor = null, d.undo.push(a.buildAllDoc(w.editor.nodeMap, i));
                    var h;
                    if (u && (h = w.editor.sourceView.cm.getScrollInfo().top, c = w.editor.sourceView.cm.getCursor(), w.editor.sourceView.setValue(e, !0, i || r ? "fromDisk" : "begin")), u && i || (w.editor.nodeMap.reset(), (s = l.Node.parseFrom(e, w.editor.nodeMap, {skips: {old_code: !1}}))[1].map(function (e) {
                        e.set("attachTo", w.editor.nodeMap)
                    }), d.redo.push(a.buildAllDoc(w.editor.nodeMap, i)), w.editor.tryEnterBusyMode(e), u ? (w.editor.sourceView.renderedHTML = s[0], w.editor.undo.register(d, r)) : (w.editor.writingArea.innerHTML = s[0], w.editor.runAllScript())), u) {
                        var f = w.editor.sourceView.cm.getInputField();
                        return f.setSelectionRange && f.setSelectionRange(0, 0), w.editor.sourceView.cm.setCursor(c), void(i && void 0 !== h && w.editor.sourceView.cm.scrollTo(0, h))
                    }
                    if (i) {
                        var p = w.editor.undo.lastRegisteredOperationCommand(), m = p && p.undo.last();
                        m && "reload" == m.type && m.reloadFromDisk && (d.undo = [m], w.editor.undo.removeLastRegisteredOperationCommand())
                    }
                    t || w.editor.undo.register(d, r), o || (t ? (w.editor.undo.reset(), w.updateChangeCount(w.ChangeType.NSChangeAutosaved)) : window.getSelection().removeAllRanges(), setTimeout(function () {
                        w.editor.refresh(), w.editor.selection.scrollAdjust()
                    }, n ? 500 : 0))
                }
            },
            copy: function () {
                w.editor.UserOp.copyHandler(w.editor)
            },
            delete: function () {
                isInputComponent(document.activeElement) || w.editor.UserOp.backspaceHandler(w.editor, null, "Backspace")
            },
            editActive: function () {
                w.editor.undo.completeSnap(!0);
                var e = w.editor.findElemById(w.editor.focusCid);
                c.isType(e.attr("mdtype"), d.html_block, d.math_block) && (w.editor.undo.snap(w.editor.focusCid, s.CURSOR_CHANGE), e.find(".md-rawblock-container").trigger("startedit"))
            },
            deleteActive: function () {
                w.editor.undo.completeSnap(!0);
                var e = w.editor.getMarkElem(), t = w.editor.findNodeByElem(e),
                    n = w.editor.UserOp.backToParagraph(editor, t, !0);
                w.editor.undo.register(n)
            },
            cut: function () {
                if (w.isLocked) return !1;
                w.editor.refocus(void 0, !0), w.editor.snapSelection = editor.selection.buildUndo(), w.editor.UserOp.copyHandler(editor, null), w.editor.UserOp.backspaceHandler(editor, null, "delSelection")
            },
            pasteAsPlainText: function () {
                r(w.editor.sessionStr).trigger("pasteAsPlainText")
            },
            lock: function () {
                w.isLocked = !0, w.freshLock()
            },
            unlock: function () {
                w.isLocked = !1, w.freshLock()
            },
            toggleSourceMode: function () {
                w.editor.sourceView.inSourceMode ? (w.editor.sourceView.hide(), w.editor.library.recoverSidebar()) : (w.editor.library.tmpHideSidebar(), w.editor.sourceView.show()), w.freshMenuWithDeplay()
            },
            isFocusedOnWriteDiv: function () {
                return r(document.activeElement).closest("#write").length > 0
            },
            getExtraContext: function (e) {
                if (!e) return "default";
                if (void(e.ownerDocument.defaultView != window && (e = function e(t) {
                    return t.parent == window ? t.frameElement : t && t.parent ? e(t.parent) : null
                }(e.ownerDocument.defaultView))) || w.editor.writingArea.contains(e)) return function () {
                    try {
                        var t = editor.getMarkElem(e);
                        if (c.isType(document.activeElement.tagName, "INPUT", "TEXTAREA") && !t.length) return "";
                        t.length && w.editor.refocus(t.attr("cid"));
                        var n = editor.selection.getRangy(), i = r(e).closest(".md-expand"), o = t.attr("mdtype");
                        if (/^table/g.exec(o) && !w.isLocked) return "table|seperator|insertParagraphBefore|insertParagraphAfter";
                        if (c.isType(o, d.html_block)) return "edit|seperator|insertParagraphBefore|insertParagraphAfter|delete";
                        if (c.isType(o, d.math_block)) return "edit|copyMathBlock|seperator|insertParagraphBefore|insertParagraphAfter|delete";
                        if (c.isType(o, d.fences)) return "insertParagraphBefore|insertParagraphAfter|delete-fences";
                        if (t.attr("tabindex")) return "copy|seperator|insertParagraphBefore|insertParagraphAfter|delete";
                        var a;
                        if (t.hasClass("md-def-link")) return (a = r(n.commonAncestorContainer).closest(".md-def-url")).length ? (w.editor.setCurLinkElem(a), "openLink") : "";
                        if (r(e).closest(".md-emoji").length) return "copyEmoji-" + r(e).closest(".md-emoji").find("[data-emoji]").attr("data-emoji") + "|seperator";
                        if ((a = r(e).closest(".md-link")).length) return w.editor.setCurLinkElem(a.find("a")), "openLink";
                        if (n && r(n.commonAncestorContainer).closest(".md-inline-math").length) return "copyMathInline";
                        if (c.isType(i.hasClass("md-img-loaded") && i.attr("md-inline"), d.image, d.imgtag)) return w.editor.imgEdit.contextMenuItems(i.find("img")[0]).join("|");
                        if (c.isType(i.hasClass("md-img-loaded") && i.attr("md-inline"), d.refimg) && /^file:\/\//.exec(i.find("img").attr("src") || "")) return "revealInFinder|seperator"
                    } catch (e) {
                    }
                    return ""
                }();
                if (w.editor.sourceView.inSourceMode && document.querySelector("#typora-source").contains(e)) return "sourceMode";
                if (w.getMountFolder()) {
                    var t = w.editor.getJQueryElem(e).closest(".file-library-node");
                    return w.editor.library.useTreeStyle ? t.attr("data-path") == w.getMountFolder() ? "folder-root" : t.length ? "true" == t.attr("data-is-directory") ? "folder" : "file" : "default" : t.length ? "file-list" : "default"
                }
                return ""
            },
            getCurBlockType: function () {
                try {
                    if (document.activeElement.hasAttribute && document.activeElement.hasAttribute("tabindex")) return r(document.activeElement).closest("[mdtype]").attr("mdtype") || "";
                    if (rangy.getSelection().rangeCount) {
                        var e = w.editor.selection.getRangy();
                        return r(e.commonAncestorContainer).closest("[mdtype]").attr("mdtype") || ""
                    }
                } catch (e) {
                }
                return ""
            },
            freshLock: function (e) {
                w.editor && (void 0 !== e && (w.isLocked = e), r("content input, selector").prop("readOnly", w.isLocked || !1), r(".CodeMirror").each(function () {
                    this.CodeMirror && (this.CodeMirror.options.readOnly = w.isLocked || !1)
                }), w.isLocked ? (w.editor.tableEdit.unfocusAll(), r("[contenteditable=true]").attr("locked", "true").attr("contenteditable", "false"), r(w.editor.sessionStr).blur(), r(".md-expand").removeClass("md-expand")) : r("[locked='true']").attr("locked", "false").attr("contenteditable", "true"), r("#md-searchpanel input").prop("readOnly", !1), w.freshMenu(), w.editor && w.editor.sourceView && w.editor.sourceView.inSourceMode && w.editor.sourceView.cm.focus(), setTimeout(function () {
                    w.isMac && v.touchBar && v.touchBar.freshLock()
                }, 100))
            },
            setTheme: function (e) {
                w.colorBrightness = 1;

                function t() {
                    var e = (window.getComputedStyle(document.body).backgroundColor.match(/[\d.]+/gi) || []).map(function (e) {
                        return e - 0
                    });
                    void 0 !== e[3] && null !== e[3] || (e[3] = 256);

                    function t(e) {
                        var t = Number(e).toString(16).toUpperCase();
                        return 1 == t.length ? "0" + t : t
                    }

                    e.length && (w.isMac ? (e[0] + e[1] + e[2] + e[3] == 0 && (e = [255, 255, 255, 0]), v.window.setBackgroundColor(e[0], e[1], e[2], e[3])) : v.setting.put("backgroundColor", (n = e[0], i = e[1], r = e[2], "#" + t(n) + t(i) + t(r))), w.colorBrightness = (299 * e[0] + 587 * e[1] + 114 * e[2]) / 256e3);
                    var n, i, r;
                    if (w.isMac) {
                        "true" != (window.getComputedStyle(document.body).getPropertyValue("--typora-center-window-title") || "").trim() && document.body.classList.contains("pin-outline") ? v.window.setTitlebarTextMarginLeft(document.querySelector("#typora-sidebar").getBoundingClientRect().width) : v.window.setTitlebarTextMarginLeft(void 0)
                    }
                }

                var n = function () {
                    setTimeout(t, 100), w.editor.refresh(!0), w.isFocusMode && w.editor.updateFocusMode(!1), w.isTypeWriterMode && w.editor.setTypeWriterMode(!0, !0)
                };
                if (w.isMac) {
                    var i = document.getElementById("theme_css"), o = i.getAttribute("href"), a = "http://typora-theme";
                    if (e = (e = e || v.setting.get("theme") || "github").replace(/\s*([A-Z])/g, "-$1").replace(/^-/, "").toLowerCase(), v.setting.getBool("useCustomFontSize")) {
                        var s = (v.setting.getDouble("customFontSize") || 16) + "";
                        document.body.parentElement.style.fontSize = s + "px"
                    }
                    o != e && r.get(a + "/" + e + ".css", function () {
                        i.setAttribute("href", a + "/" + e + ".css")
                    }).then(function () {
                        setTimeout(n, 20)
                    }), document.querySelector("#base_user_css").setAttribute("href", a + "/base.user.css"), document.querySelector("#theme_user_css").setAttribute("href", a + "/" + e + ".user.css")
                } else if (w.isNode) {
                    var l = v.setting.getCurrentTheme(), c = v.getPath("userData"), d = w.isWin ? "\\" : "/";
                    r("#theme_css").attr("href", [c, "themes", l].join(d)), setTimeout(n, 20), document.querySelector("#base_user_css").setAttribute("href", [c, "themes", "base.user.css"].join(d)), document.querySelector("#theme_user_css").setAttribute("href", [c, "themes", l.replace(/\.css$/, ".user.css")].join(d)), w.isMacNode && v.setting.refreshThemeMenu()
                }
            },
            getFileName: function (e) {
                if (w.isMac) {
                    var t = v.document.currentFilePath(), n = v.document.currentFolderPath(), i = void 0;
                    return t && n && (i = t.replace(n, "").replace(/^\//g, "")), i || (e ? w.getSuggestedFileName() : void 0)
                }
                return w.fileName || (e ? w.getSuggestedFileName() : void 0)
            },
            getSuggestedFileName: function (e) {
                if (w.fileName) return w.fileName.replace(/\.[^.]+$/, "");
                if (e) {
                    var t = w.getFileName();
                    if (t) return t.replace(/\.[^.]+$/, "")
                }
                var n, i, a = "", s = "";
                try {
                    (i = w.editor.docMenu.getMetaNode()) && (s = w.editor.docMenu.getValueInMeta("date", i) || "", s = (/\d+-\d+-\d+/g.exec(s) || /\d+\/\d+\/\d+/g.exec(s) || [""])[0], a = (a = w.editor.docMenu.getValueInMeta("title", i) || "").replace(/(^\s*("|'))|(("|')\s*)/gi, "").replace(/\s+(.)/gi, "-$1").toLocaleString(), a = s && a ? [s, a].join("-") : a), 0 != a.trim().length && "-" != a || (n = r(r("#write h1, #write h2, #write h3")[0]), w.editor.sourceView.inSourceMode ? (a = (a = w.editor.getMarkdown()).substr(0, a.indexOf("\n")) || a).length > 60 && (a = a.substr(0, a.indexOf(".")) || a) : n.length ? a = w.editor.UserOp.getDisplayText(n).replace(/\r?\n/gi, "") : (a = (a = (n = r(r("[cid]:not(.md-meta-block)")[0])).length ? w.editor.UserOp.getDisplayText(n) : "").substr(0, a.indexOf("\n")) || a).length > 60 && (a = a.substr(0, a.indexOf(".")) || a)), a.length > 120 && (a = a.substr(0, 120))
                } catch (e) {
                }
                return 0 == a.trim().length && (a = r.localize.getString("Untitled", "Front")), o.removeInvalidPathCh(a.trim()) || "Untitled"
            },
            setCanCollapsePinnedOutline: function (e) {
                e ? document.body.classList.remove("no-collapse-outline") : document.body.classList.add("no-collapse-outline")
            },
            refreshImageCopyStatus: function (e, t) {
                e ? (C && clearTimeout(C), C = setTimeout(function () {
                    h.doRefreshImageCopyStatus(t)
                }, 500)) : h.doRefreshImageCopyStatus(t)
            },
            isDocumentEdited: function () {
                return w.isNode ? w.changeCounter.isDocumentEdited() : w.isMacWK ? bridge.callSync("document.isDocumentEdited") : w.isMac ? v.document.isDocumentEdited() : void 0
            },
            backupWindow: function () {
                if (w.isNode) if (w._onInitParse) w.needSaveState = !1; else try {
                    if (!w.needSaveState || !w.editor.brush.timerID || !w.isActiveWindow()) return;
                    var e = w.fileHasModified && w.changeCounter.isDocumentEdited();
                    if (!e && w.changeCounter.isDiscardableUntitled() && !w.mountFolder_) return;
                    e && w.option.enableAutoSave && (w.saveUseNode(null, null, !0), e = w.changeCounter.isDocumentEdited());
                    var t = {
                        path: w.filePath,
                        encode: w.encode,
                        hasUnsaved: e,
                        scrollPos: r("content").scrollTop(),
                        useCRLF: w.useCRLF,
                        syncDate: new Date - 0,
                        mountFolder: w.mountFolder_,
                        content: null
                    };
                    e && (w.editor.undo.completeSnap(!0), w.editor.store(null, !0), t.content = w.editor.getMarkdown());
                    return reqnode("electron").ipcRenderer.send("addBackup", t), w.needSaveState = !1, t
                } catch (e) {
                    console.sendError(e.stack)
                }
            }
        }, C = null, x = !1, k = function () {
            w.editor.brush.timerID && w.isActiveWindow() && x && (x = !1, f.saveToRecover(w.editor.getMarkdown()))
        };
        w.ChangeType = u.ChangeType, w.isMacLegacy = w.isMac = void 0 !== window.app, w.isNode = void 0 !== window.reqnode, w.isMacNode = w.isNode && "darwin" == process.platform, w.isMacOrMacNode = w.isMac || w.isMacNode, w.isNodeHtml = window.isOnWindowHtml, w.isWin = w.isNode && "win32" == process.platform, w.isLinux = w.isNode && "linux" == process.platform, w.isUnixNode = w.isLinux || w.isMacNode, w.FileInfoPanel = f, w.backupVersionWorker = k, w.freshMenu = h.freshMenu, w.freshMenuWithDeplay = h.freshMenuWithDeplay, w.bindMenu = h.bindMenu, w.MenuHelper = h;
        var S = navigator.userAgent.toLowerCase();
        w.isSafari = w.isMac || S.indexOf("safari/") > -1 && -1 == S.indexOf("chrome"), w.startAutoSaveAndBackupService = function () {
            if (w.isNode) {
                g.getCurrentWindow().on("blur", w.backupWindow);
                var e = v.setting.config || {}, t = Number.parseFloat(e.autoSaveTimer || 3);
                t && !Number.isNaN(t) || (t = 3), setInterval(w.backupWindow, 60 * t * 1e3), setInterval(k, 6e5)
            }
        }, w.isNode && (w.fs = reqnode("fs"), w.startAutoSaveAndBackupService()), w.updateMenuToUI = function (e) {
            w.isNode ? reqnode("electron").ipcRenderer.send("menu.updateMenu", e) : w.isMacWK ? bridge.callHandler("menu.updateMenu", e) : w.isMac && v.mainMenu.updateMenu(JSON.stringify(e))
        }, n.exports = w
    }), $__System.registerDynamic("37", ["e"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i = e("e");
        if (window.app && (window.open = function (e, t) {
            app.window.openLink(e)
        }), "performance" in window == 0 && (window.performance = window.performance || {
            offset: Date.now(),
            now: function () {
                return Date.now() - this.offset
            }
        }), Element.prototype.insertChildAtIndex = function (e, t) {
            t || (t = 0), t >= this.children.length ? this.appendChild(e) : this.insertBefore(e, this.children[t])
        }, DocumentFragment.prototype.insertChildAtIndex = function (e, t) {
            t || (t = 0), t >= this.children.length ? this.appendChild(e) : this.insertBefore(e, this.children[t])
        }, Number.isNaN || (Number.isNaN = window.isNaN), Number.parseInt || (Number.parseInt = window.parseInt), !window.Set) {
            var r = function () {
                this.set = []
            };
            r.prototype.add = function (e) {
                -1 == !this.has(e) && this.set.push(e)
            }, r.prototype.delete = function (e) {
                this.has(e) && this.set.splice(this.set.indexOf(e))
            }, r.prototype.has = function (e) {
                return this.set.indexOf(e) > -1
            }, window.Set = r
        }
        if (!window.Map) {
            var o = function () {
                this.map = {}
            };
            o.prototype.get = function (e) {
                return this.map[e]
            }, o.prototype.delete = function (e) {
                delete this.map[e]
            }, o.prototype.set = function (e, t) {
                this.map[e] = t
            }, window.Map = o
        }
        [].fill || Object.defineProperty(Array.prototype, "fill", {
            value: function (e) {
                for (var t = Object(this), n = parseInt(t.length), i = arguments[1], r = parseInt(i) || 0, o = r < 0 ? Math.max(n + r, 0) : Math.min(r, n), a = arguments[2], s = void 0 === a ? n : parseInt(a) || 0, l = s < 0 ? Math.max(n + s, 0) : Math.min(s, n); o < l; o++) t[o] = e;
                return t
            }
        }), [].find || Object.defineProperty(Array.prototype, "find", {
            value: function (e) {
                if (null == this) throw new TypeError('"this" is null or not defined');
                var t = Object(this), n = t.length >>> 0;
                if ("function" != typeof e) throw new TypeError("predicate must be a function");
                for (var i = arguments[1], r = 0; r < n;) {
                    var o = t[r];
                    if (e.call(i, o, r, t)) return o;
                    r++
                }
            }
        }), Object.defineProperty(Array.prototype, "remove", {
            value: function (e) {
                var t = this.indexOf(e);
                if (~t) return this.splice(t, 1)
            }
        }), Object.defineProperty(Array.prototype, "removeFirstIf", {
            value: function (e) {
                for (var t = this.length; t--;) if (e(this[t], t)) return void this.splice(t, 1)
            }
        }), Object.defineProperty(Array.prototype, "removeIf", {
            value: function (e) {
                for (var t = this.length; t--;) e(this[t], t) && this.splice(t, 1)
            }
        }), Object.defineProperty(Array.prototype, "repeat", {
            value: function (e, t) {
                for (; t;) this[--t] = e;
                return this
            }
        }), Object.defineProperty(Array.prototype, "last", {
            value: function () {
                return this.length ? this[this.length - 1] : void 0
            }
        }), Object.defineProperty(Array.prototype, "lastDef", {
            value: function () {
                for (var e = this.length - 1; e >= 0; e--) if (void 0 != this[e]) return this[e]
            }
        }), Object.defineProperty(Array.prototype, "clone", {
            value: function () {
                return this.slice(0)
            }
        }), Object.defineProperty(Array.prototype, "subarray", {
            value: function (e, t) {
                return this.slice(e, t)
            }
        }), Object.clone = function (e) {
            return e ? Object.assign({}, e) : null
        }, "function" != typeof Object.assign && Object.defineProperty(Object, "assign", {
            value: function (e, t) {
                if (null == e) throw new TypeError("Cannot convert undefined or null to object");
                for (var n = Object(e), i = 1; i < arguments.length; i++) {
                    var r = arguments[i];
                    if (null != r) for (var o in r) Object.prototype.hasOwnProperty.call(r, o) && (n[o] = r[o])
                }
                return n
            }, writable: !0, configurable: !0
        }), window.NodeList && !NodeList.prototype.forEach && (NodeList.prototype.forEach = function (e, t) {
            t = t || window;
            for (var n = 0; n < this.length; n++) e.call(t, this[n], n, this)
        }), NodeList.prototype.remove = function () {
            Array.prototype.slice.call(this).forEach(function (e) {
                e.remove()
            })
        }, Node.prototype.rawText = function (e) {
            if (window.File) {
                var t = File.option.convertSmartOnRender && (File.option.smartDash || File.option.smartQuote),
                    n = this.cloneNode(!0);
                n.querySelectorAll(".md-emptyline").forEach(function (e) {
                    e.textContent = e.textContent.replace(/\n/, "")
                }), File.option.ignoreLineBreak && n.querySelectorAll(".md-softbreak").forEach(function (e) {
                    e.textContent = e.textContent.replace(/^\u00a0/, "\n")
                }), n.querySelectorAll(".md-linebreak").forEach(function (e) {
                    e.textContent = e.textContent.replace(/\n\n/, "\n")
                }), n.querySelectorAll(".md-ruby ruby").forEach(function (e) {
                    e.textContent = ""
                }), File.option.enableInlineMath && n.querySelectorAll("svg, .MathJax_Preview").forEach(function (e) {
                    e.textContent = ""
                }), t && n.querySelectorAll(".md-pants").forEach(function (e) {
                    e.textContent.indexOf(e.dataset.content) > -1 && e.firstElementChild && e.firstElementChild.remove(), e.textContent = e.textContent.replace(e.dataset.content || e.dataset.text, e.dataset.text)
                }), e && (n.querySelectorAll(".md-inline-math script").forEach(function (e) {
                    e.textContent = e.innerHTML.replace(/\u200b/g, "")
                }), n.querySelectorAll(".md-emoji").forEach(function (e) {
                    e.textContent = (e.querySelector(".md-meta") || {}).textContent || ""
                }));
                return void 0 === n.textContent ? n.innerText : n.textContent
            }
        }, i.fn.visibleText = function () {
            if (0 === this.length) return "";
            if (1 === this.length && (3 === this[0].nodeType || 0 === this[0].childElementCount)) return this.text();
            var e = "";
            return i.each(this.contents(), function (t, n) {
                3 === n.nodeType ? e += n.textContent : 1 === n.nodeType && (n.offsetHeight || n.offsetWidth) && (e += i(n).visibleText())
            }), e
        };
        window.console && function () {
            console.stack = function (e) {
                (new Error).stack
            }, console.stackError = function (e) {
                console.sendError(e);
                var t = (new Error).stack;
                console.sendError(t)
            }, console.warn || (console.warn = function (e) {
                console.log(e)
            });
            var e;
            File.isNode && (e = reqnode("electron").ipcRenderer);
            var t = console.error;
            console.sendError = function (n) {
                var i = n;
                n.stack ? i = n.stack : n.message && (i = n.message), t(i), File.isMac ? app.window.log("[Error] " + i) : File.isNode && (e || (e = reqnode("electron").ipcRenderer), e && e.send("sendError", i))
            };
            var n = console.log;
            if (console.sendLog = function (t) {
                n(t), File.isMac ? app.window.log("[Log] " + t) : File.isNode && (e || (e = reqnode("electron").ipcRenderer), e && e.send("sendLog", t))
            }, window.debugMode && File.isMac) {
                var i = console.debug;
                console.debug = function (e) {
                    i(e), File.isMac && app.window.log("[Debug] " + e)
                }
            }
        }(), void 0 === NodeList.prototype.forEach && (NodeList.prototype.forEach = Array.prototype.forEach), void 0 === HTMLCollection.prototype.forEach && (HTMLCollection.prototype.forEach = Array.prototype.forEach);
        window.Promise || function (e) {
            var t = setTimeout;

            function n() {
            }

            function i(e) {
                if ("object" != typeof this) throw new TypeError("Promises must be constructed via new");
                if ("function" != typeof e) throw new TypeError("not a function");
                this._state = 0, this._handled = !1, this._value = void 0, this._deferreds = [], l(e, this)
            }

            function r(e, t) {
                for (; 3 === e._state;) e = e._value;
                0 !== e._state ? (e._handled = !0, i._immediateFn(function () {
                    var n = 1 === e._state ? t.onFulfilled : t.onRejected;
                    if (null !== n) {
                        var i;
                        try {
                            i = n(e._value)
                        } catch (e) {
                            return void a(t.promise, e)
                        }
                        o(t.promise, i)
                    } else (1 === e._state ? o : a)(t.promise, e._value)
                })) : e._deferreds.push(t)
            }

            function o(e, t) {
                try {
                    if (t === e) throw new TypeError("A promise cannot be resolved with itself.");
                    if (t && ("object" == typeof t || "function" == typeof t)) {
                        var n = t.then;
                        if (t instanceof i) return e._state = 3, e._value = t, void s(e);
                        if ("function" == typeof n) return void l((r = n, o = t, function () {
                            r.apply(o, arguments)
                        }), e)
                    }
                    e._state = 1, e._value = t, s(e)
                } catch (t) {
                    a(e, t)
                }
                var r, o
            }

            function a(e, t) {
                e._state = 2, e._value = t, s(e)
            }

            function s(e) {
                2 === e._state && 0 === e._deferreds.length && i._immediateFn(function () {
                    e._handled || i._unhandledRejectionFn(e._value)
                });
                for (var t = 0, n = e._deferreds.length; t < n; t++) r(e, e._deferreds[t]);
                e._deferreds = null
            }

            function l(e, t) {
                var n = !1;
                try {
                    e(function (e) {
                        n || (n = !0, o(t, e))
                    }, function (e) {
                        n || (n = !0, a(t, e))
                    })
                } catch (e) {
                    if (n) return;
                    n = !0, a(t, e)
                }
            }

            i.prototype.catch = function (e) {
                return this.then(null, e)
            }, i.prototype.then = function (e, t) {
                var i = new this.constructor(n);
                return r(this, new function (e, t, n) {
                    this.onFulfilled = "function" == typeof e ? e : null, this.onRejected = "function" == typeof t ? t : null, this.promise = n
                }(e, t, i)), i
            }, i.all = function (e) {
                var t = Array.prototype.slice.call(e);
                return new i(function (e, n) {
                    if (0 === t.length) return e([]);
                    var i = t.length;

                    function r(o, a) {
                        try {
                            if (a && ("object" == typeof a || "function" == typeof a)) {
                                var s = a.then;
                                if ("function" == typeof s) return void s.call(a, function (e) {
                                    r(o, e)
                                }, n)
                            }
                            t[o] = a, 0 == --i && e(t)
                        } catch (e) {
                            n(e)
                        }
                    }

                    for (var o = 0; o < t.length; o++) r(o, t[o])
                })
            }, i.resolve = function (e) {
                return e && "object" == typeof e && e.constructor === i ? e : new i(function (t) {
                    t(e)
                })
            }, i.reject = function (e) {
                return new i(function (t, n) {
                    n(e)
                })
            }, i.race = function (e) {
                return new i(function (t, n) {
                    for (var i = 0, r = e.length; i < r; i++) e[i].then(t, n)
                })
            }, i._immediateFn = "function" == typeof setImmediate && function (e) {
                setImmediate(e)
            } || function (e) {
                t(e, 0)
            }, i._unhandledRejectionFn = function (e) {
                "undefined" != typeof console && console && console.warn("Possible Unhandled Promise Rejection:", e)
            }, i._setImmediateFn = function (e) {
                i._immediateFn = e
            }, i._setUnhandledRejectionFn = function (e) {
                i._unhandledRejectionFn = e
            }, window.Promise = i
        }(window)
    }), $__System.registerDynamic("41", ["11", "1a", "12", "37"], !0, function (e, t, n) {
        "use strict";
        this || self, e("11"), e("1a");
        var i, r = e("12"), o = r.Node, a = r.TYPE, s = (e("37"), window.reqnode && reqnode("electron")),
            l = window.reqnode ? s.remote : null, c = l ? l.app : window.app, d = null;

        function u(e, t, n) {
            e && (e[t] = $.extend(e[t], n))
        }

        function h(e, t) {
            i = File.editor.styleBookmark.style;
            e || (e = {}), e["Format→Inline Math"] = {hidden: !File.option.enableInlineMath}, e["Format→Highlight"] = {hidden: !File.option.enableHighlight}, e["Format→Subscript"] = {hidden: !File.option.enableSubscript}, e["Format→Superscript"] = {hidden: !File.option.enableSubscript}, !t && File.editor.stylize.putBookmark(null, File.editor.stylize.buildBookmark());
            var n = File.editor.styleBookmark.style,
                r = (File.editor.stylize.CONST.NormalBlockMap[n.block[0]], File.editor.stylize.CONST.NoInline.indexOf(n.block[0]) > -1);
            n.block[0] == a.def_footnote && (r = r || File.editor.stylize.isAtFootnoteDefSpan()), r = r || n.inline.indexOf(a.inline_math) > -1, ["Strong", "Emphasis", "Underline", "Code", "Strike", "Hyperlink", "Image", "Clear Format", "Inline Math", "Highlight", "Subscript", "Superscript", "Comment"].map(function (t) {
                e["Format→" + t] = Object.assign({enabled: !File.isLocked && !r, state: !1}, e["Format→" + t])
            });
            var o = ["image", "strong", "em", "link"];
            (File.editor.styleBookmark.style.inline || []).map(function (t) {
                e["Format→" + File.editor.stylize.CONST.StyleToNameMap[t]] = {state: !0}, File.isMac && c.touchBar && (o.remove(t), c.touchBar.setStateForInline(!0, File.editor.stylize.CONST.StyleToNameMap[t]))
            }), File.isMac && c.touchBar && (c.touchBar.setInlineEnabled(!r), r || o.map(function (e) {
                c.touchBar.setStateForInline(!1, File.editor.stylize.CONST.StyleToNameMap[e])
            }))
        }

        function f(e, t, n) {
            if (!e) return !1;
            if (n && (e.length || (e = n), t.length || (t = n)), e.length == t.length) {
                for (var i = 0; i < e.length; i++) if (e[i] != t[i]) return !1;
                return !0
            }
            return !1
        }

        function p(e, t) {
            function n(e) {
                return e[0] == a.table_cell ? a.table : e[0]
            }

            e || (e = {}), !t && File.editor.stylize.putBookmark(null, File.editor.stylize.buildBookmark());
            var i = File.editor.styleBookmark.style, s = File.editor.stylize.CONST.NormalBlockMap[i.block[0]];
            ["Heading 1", "Heading 2", "Heading 3", "Heading 4", "Heading 5", "Heading 6", "Paragraph", "Decrease Heading Level", "Increase Heading Level", "Link Reference", "Footnotes", "YAML Front Matter", "Table", "Horizontal Line", "Code Fences", "Math Block", "Quote", "Ordered List", "Unordered List", "Task List", "Table of Contents"].map(function (t) {
                u(e, "Paragraph→" + t, {enabled: !File.isLocked && i.block.length > 0 && void 0 != s, state: !1})
            }), !function () {
                try {
                    return File.editor.getMarkElem(window.getSelection().getRangeAt(0).startContainer).attr("mdtype") == r.TYPE.meta_block
                } catch (e) {
                }
                return !1
            }() ? ["Paragraph", "Quote", "Ordered List", "Unordered List", "Task List", "Code Fences", "Math Block"].map(function (t) {
                u(e, "Paragraph→" + t, {enabled: !0})
            }) : u(e, "Paragraph→Paragraph", {enabled: !0});
            var l = null, d = !1;
            (File.editor.styleBookmark.style.block || []).map(function (t) {
                if (!l && o.isType(t, "ol", "ul", "tasklist") && (l = t), t == a.blockquote && (d = !0), u(e, "Paragraph→" + File.editor.stylize.CONST.StyleToNameMap[t], {state: !0}), "tasklist" == t) {
                    u(e, "Paragraph→Task Status", {enabled: !0});
                    var n = "checked" == File.editor.styleBookmark.style.state;
                    u(e, "Paragraph→Task Status→Mark as Complete", {state: n}), u(e, "Paragraph→Task Status→Mark as Incomplete", {state: !n})
                } else u(e, "Paragraph→Task Status", {enabled: !1})
            }), File.isMac && c.touchBar ? $("#md-searchpanel").is(":visible") ? c.touchBar.showFindReplaceTouchBar() : document.body.classList.contains("modal-open") ? $("#table-insert-dialog:visible").length ? c.touchBar.showInsertTableTouchBar() : c.touchBar.showDialogTouchBar() : c.touchBar.setBlockStyle({
                blockStyle: File.editor.stylize.CONST.StyleToNameMap[n(i.block)] || "",
                listType: l,
                underQuote: d,
                fallbackOnly: !s
            }) : File.isMacWK && bridge.callHandler("touchbar.setBlockStyle", {
                blockStyle: File.editor.stylize.CONST.StyleToNameMap[n(i.block)] || "",
                listType: l,
                underQuote: d,
                fallbackOnly: !s
            })
        }

        function m(e) {
            var t = !1;
            e || (e = {}, t = !0);
            var n = File.editor && File.editor.sourceView && File.editor.sourceView.inSourceMode;
            if (e["View→Source Code Mode"] = {
                state: n,
                enabled: !File.isLocked
            }, (File.isMac || File.isNode) && (e["View→Always on Top"] = {state: File.isMac ? c.window.isAlwaysOnTop() : l.getCurrentWindow().isAlwaysOnTop()}), e["View→Focus Mode"] = {
                state: File.isFocusMode,
                enabled: !0
            }, e["View→Typewriter Mode"] = {
                state: File.isTypeWriterMode,
                enabled: !0
            }, File.editor && File.editor.library) {
                var i = File.editor.library.isSidebarShown(), r = File.editor.library.getActiveTab();
                e["View→Outline"] = {
                    state: i && "outline" == r,
                    enabled: !n
                }, e["View→Articles"] = {
                    state: i && "file-list" == r,
                    enabled: !n
                }, e["View→File Tree"] = {
                    state: i && "file-tree" == r,
                    enabled: !n
                }, e["View→Toggle Sidebar"] = {enabled: !n}
            }
            t && File.updateMenuToUI(e)
        }

        var g = {
            doRefreshImageCopyStatus: function (e, t) {
                if (File.editor && File.editor.imgEdit) {
                    var n = File.editor.imgEdit.getTagetImageStorageFolder(), i = !1;
                    t || (t = {}, i = !0), u(t, "Edit→Image Tools→Use Image Root Path", {state: !!File.editor.docMenu.getLocalRootUrl()}), u(t, "Edit→Image Tools→When Insert Local Image→Copy Image File to Folder…", {state: !!n && (File.isNode || "ipic" !== n.toLowerCase())}), (File.isMacLegacy || File.isMacWK) && u(t, "Edit→Image Tools→When Insert Local Image→Upload Image via iPic", {state: n && "ipic" == n.toLowerCase()}), void 0 !== e && (u(t, "Edit→Image Tools→Use Image Root Path", {enabled: !e}), u(t, "Edit→Image Tools→When Insert Local Image→Copy Image File to Folder…", {enabled: !e}), (File.isMacLegacy || File.isMacWK) && u(t, "Edit→Image Tools→When Insert Local Image→Upload Image via iPic", {enabled: !e})), i && File.updateMenuToUI(t)
                }
            }, refreshViewMenu: m, refreshBlockMenu: p, bindMenu: function () {
                File.isMacWK, g.freshMenu(!0), $(File.editor.sessionStr).on("cursorChange", function (e, t) {
                    !function (e) {
                        d && clearTimeout(d);
                        var t = 60;
                        i && i.inline.indexOf(a.inline_math) > -1 && (t = 50), File.isMacWK && (t = 30), d = setTimeout(function () {
                            var t = (e || File.editor.stylize.putBookmark(null, File.editor.stylize.buildBookmark())).style,
                                n = {};
                            i && f(t.block, i.block) ? f(t.inline, i.inline, [a.plain]) || h(n, !0) : (p(n, !0), h(n, !0)), Object.keys(n).length > 0 && File.updateMenuToUI(n)
                        }, t)
                    }(t)
                })
            }, freshMenu: function (e) {
                var t = File.editor && File.editor.sourceView && File.editor.sourceView.inSourceMode;

                function n() {
                    var n = {};
                    if (!File.isNode && m(n), n["Edit→Copy as HTML Code"] = {enabled: !t}, (File.isMacWK || File.isMacLegacy) && (n["Edit→Image Tools→Upload Local Images via iPic"] = {enabled: !File.isLocked && !t}), n["Edit→Image Tools→Insert Local Images…"] = {enabled: !File.isLocked}, n["Edit→Delete"] = {enabled: !File.isLocked}, n["Edit→Delete Range"] = {enabled: !File.isLocked}, n["Edit→Cut"] = {enabled: !File.isLocked}, n["Edit→Line Endings"] = {enabled: !File.isLocked}, n["Edit→Whitespace and Line Breaks"] = {enabled: !t}, n.Paragraph = {enabled: !File.isLocked && !t}, n.Format = {enabled: !File.isLocked && !t}, File.setLineEnding(File.useCRLF, !1, !0), g.doRefreshImageCopyStatus(File.isLocked || t, n), t) {
                        var i = File.editor.sourceView.cm.doc.historySize();
                        n["Edit→Undo"] = {enabled: !File.isLocked && i.undo > 0}, n["Edit→Redo"] = {enabled: !File.isLocked && i.redo > 0}, File.isNode && window.ClientCommand.refreshViewMenu()
                    } else n["Edit→Undo"] = {enabled: !File.isLocked && File.editor && File.editor.undo.hasUndo()}, n["Edit→Redo"] = {enabled: !File.isLocked && File.editor && File.editor.undo.hasRedo()}, File.isNode ? window.ClientCommand.refreshViewMenu() : n["View→Always on Top"] = {enabled: !0}, !File.isLocked && $(File.editor.sessionStr).trigger("cursorChange");
                    e && File.isNode && (n["File→Open File Location"] = {enabled: !!File.filePath}, n["File→Reveal in Sidebar"] = {enabled: !!File.filePath}, File.isWin && (n["File→Properties"] = {enabled: !!File.filePath}), n["File→Reopen with Encoding"] = {hidden: !File.filePath}), e && (n["Edit→Whitespace and Line Breaks→Indent first line of paragraphs"] = {
                        state: File.option.indentFirstLine,
                        enabled: !t
                    }, n["Edit→Whitespace and Line Breaks→Visible <br/>"] = {
                        state: File.option.hideBrAndLineBreak,
                        enabled: !t
                    }, n["Edit→Preserve single line break"] = {
                        state: File.option.ignoreLineBreak,
                        enabled: !t
                    }), File.updateMenuToUI(n)
                }

                if (File.isNode) {
                    try {
                        n()
                    } catch (e) {
                        reqnode("electron").ipcRenderer.send("errorInWindow", " (caught) " + (e ? e.stack : e.message))
                    }
                    if (e) {
                        l.getCurrentWindow().isFocused() && reqnode("electron").ipcRenderer.send("setFocusWindow")
                    }
                } else (File.isMac || File.isMacWK) && n()
            }
        }, v = null;
        g.freshMenuWithDeplay = function () {
            v && (clearTimeout(v), v = null), v = setTimeout(File.freshMenu, 500)
        }, g.forceRefreshMenu = function () {
            File.isLinux && s.ipcRenderer.send("forceRefreshMenu")
        }, n.exports = g
    }), $__System.registerDynamic("51", ["13", "28", "31"], !0, function (e, t, n) {
        "use strict";
        var i;
        this || self;
        if (window.reqnode) {
            var r = reqnode("electron").remote,
                o = (r.app, r.getCurrentWindow(), r.BrowserWindow, r.dialog, e("13"), e("28"), e("31"), function (e) {
                    return new Promise(function (t, n) {
                        var i = e.numPages, r = {}, o = 0, a = 0;

                        function s(e) {
                            n(e)
                        }

                        0 == i && n("Genrated PDF only have 0 page");
                        for (var l = 0; l < i; l++) e.getPage(l + 1).then(function (e) {
                            e.getAnnotations().then(function (n) {
                                a || (a = e.getViewport(1).height), o++, n.forEach(function (t) {
                                    if (t.subtype = "Link") {
                                        var n;
                                        (n = /^af:\/\/(.+)$/.exec(t.url || "")) && (r[n[1]] = [e.pageIndex + 1, a - t.rect[3]])
                                    }
                                }), o >= i && t(r)
                            }, s)
                        }, s)
                    })
                }), a = function (e, t, n, i) {
                    var r = Buffer.from(t);
                    e ? i(e) : e ? i(e) : (PDFJS.disableWorker = !0, PDFJS.getDocument(t).then(o, function (e) {
                        i(e)
                    }).then(function (e) {
                        try {
                            var i = new FileReader;
                            i.onloadend = function () {
                                n(new Buffer(new Uint8Array(i.result)))
                            }, i.onerror = i.onabort = a, i.readAsArrayBuffer(function (e, t) {
                                var n = new TPDFAnalyst, i = new TPDFOutLineMaker,
                                    r = File.editor.docMenu.getHeaderMatrix(!0);
                                n.LoadFromStream(t), i.Info.Title = File.editor.docMenu.getValueInMeta("title") || "", i.Info.Subject = File.editor.docMenu.getValueInMeta("subject") || "", i.Info.Author = File.editor.docMenu.getValueInMeta("author") || "", i.Info.Keywords = File.editor.docMenu.getValueInMeta("keywords") || "", i.Info.Creator = File.editor.docMenu.getValueInMeta("creator") || "Typora", i.Info.Producer = File.editor.docMenu.getValueInMeta("producer") || "Typora";
                                var o = (new Date).toISOString().replace(/\.\d+Z$/, "").replace(/[-T:]/g, "");
                                return i.Info.CreationDate = o, i.Info.ModDate = o, i.View.PageMode = TPDFPageMode.pmUseOutlines, function t(n, o, a, s) {
                                    for (var l = 7, c = null, d = a; d < s; d++) {
                                        var u, h = r[d], f = h[0];
                                        if (7 == l && (l = f), f <= o) return d;
                                        if (f > l) d = t(c, l, d, s) - 1; else {
                                            if (!(u = e[h[2]])) continue;
                                            c = n ? n.AddChild(h[1], u[0], u[1], "", !1, !1, null) : i.OutLine.AddRoot(h[1], u[0], u[1], "", !1, !1, null)
                                        }
                                    }
                                    return s
                                }(null, 0, 0, r.length), i.Save(n)
                            }(e, t))
                        } catch (e) {
                            a(e)
                        }
                    }, a));

                    function a(e) {
                        console.sendError("failed to add book to exported PDF\n" + e.stack || e.details), $("#md-notification").html("<p class='typora-pdf-warning'>" + $.localize.getString("[Warning] Failed to attach bookmark for PDF file.", "Panel") + "<span class='btn close-btn btn-xs'><span class='ion-close-round'></span></span></p>").show(), n(r)
                    }
                };
            i = function (e) {
                return new Promise(function (t, n) {
                    new Promise(function (t, n) {
                        e.webContents.once("did-finish-load", function () {
                            t()
                        }), setTimeout(function () {
                            try {
                                e.webContents.stop()
                            } catch (e) {
                                n(e)
                            }
                            t()
                        }, 1e4)
                    }).then(function () {
                        setTimeout(function () {
                            e.webContents.printToPDF({printBackground: !1, marginsType: 0}, function (e, i) {
                                a(e, i, t, n)
                            })
                        }, 200)
                    }, n)
                })
            }
        }
        t.startPDFJob = i
    }), $__System.registerDynamic("52", ["44", "e", "41", "31", "51", "28", "53"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i = e("44"), r = e("e"), o = e("41");
        if (i.isNode) var a = reqnode("electron").remote, s = a.app, l = a.getCurrentWindow(), c = a.BrowserWindow,
            d = reqnode("electron").ipcRenderer;
        var u = function () {
            return h().webContents
        }, h = function () {
            return reqnode("electron").remote.getCurrentWindow()
        }, f = {}, p = e("31"), m = e("51"), g = e("28"), v = e("53");
        f.newFile = function () {
            i.megaMenu.hide(), s.openFile(null, {mountFolder: i.mountFolder_})
        }, f.newWindow = function () {
            i.megaMenu.hide(), 3 == s.setting.get("restoreWhenLaunch") ? s.openFile(null, {
                mountFolder: s.setting.get("pinFolder"),
                slient: "pinFolder"
            }) : s.openFile()
        }, f.close = function () {
            i.megaMenu.hide(), h().close()
        }, f.quit = function () {
            s.getAllWindows().map(function (e) {
                h().close()
            })
        }, f.openWithPath = function (e) {
            var t = s.getDocumentController().getDocument(e);
            t ? (t.activeWindow || t.windows.keys().next().value).focus() : i.fileHasModified || i.filePath ? s.openFileOrFolder(e, {curWindow: l}) : reqnode("fs-plus").isDirectorySync(e) ? s.switchFolder(e, l) : y(e)
        };
        var y = function (e) {
            s.getDocumentController().getDocument(e) || (s.getDocumentController().getDocumentFromWindowId(h().id).rename(e), i.reloadContent(i.getContent(), !0), i.updateChangeCount(i.ChangeType.NSChangeCleared))
        };
        f.open = function (e) {
            var t = a.dialog, n = e ? ["openFile", "openDirectory"] : ["openFile"];
            t.showOpenDialog(l, {
                properties: n,
                filters: [{
                    name: r.localize.getString("Markdown File"),
                    extensions: ["md", "markdown", "text", "txt", "mmd", "mdown", ""]
                }, {name: r.localize.getString("All Files"), extensions: ["*"]}]
            }, function (e) {
                e && e.length && (f.openWithPath(e[0]), i.megaMenu.hide())
            })
        }, f.openFolder = function () {
            a.dialog.showOpenDialog(l, {properties: ["openDirectory"]}, function (e) {
                e && e.length && (f.openWithPath(e[0]), i.megaMenu.hide())
            })
        }, f.quickOpen = function () {
            i.editor.quickOpenPanel.show()
        }, f.import = function () {
            i.megaMenu.hide(), v.prepImport()
        }, f.validatePandocInstall = function () {
            return v.validatePandocInstall()
        }, f.doImport = function (e) {
            v.import(e)
        }, f.openFileLocation = function () {
            i.filePath && a.shell.showItemInFolder(i.filePath)
        }, f.showPreferencePanel = function () {
            document.body.classList.contains("native-window") ? r("#preference-dialog:visible").length || (i.megaMenu.prepPreferencePanel(), r(".modal").modal("hide"), r("#preference-dialog").modal("show"), r("*:focus").blur(), i.editor && i.editor.cleanTooltip(), r("#md-notification").hide()) : r(".megamenu-opened #megamenu-section-preference:not(.hide)").length ? i.megaMenu.hide() : (i.megaMenu.show(), r("#m-preference").trigger("click"))
        }, f.save = function () {
            i.saveUseNode(!1)
        }, f.saveAs = function () {
            i.saveUseNode(!1, !0)
        }, f.saveAll = function () {
            f.execForAll("function() {\t\tClientCommand.save();\t}")
        };
        var b = function () {
            w.webContents.print()
        };
        window.releasePrintWin_ = function () {
            w && (w.destroy(), w = null)
        }, f.print = function () {
            C(!0).webContents.on("did-finish-load", function () {
                setTimeout(b, 300), d.send("countly_add_event", {key: "print"})
            }), document.body.classList.contains("megamenu-opened") && i.megaMenu.hide()
        }, f.exportHTML = function () {
            i.editor.store(!0), p.showExportDialog("html", i.editor.export.exportToHTML(), null, null, !0), i.megaMenu.hide()
        }, f.exportHTMLPlain = function () {
            i.editor.store(!0), p.showExportDialog("html", i.editor.export.exportToHTML(!1, !0), null, null, !0), i.megaMenu.hide()
        }, f.exportImage = function () {
            i.editor.export.exportToImage(), i.megaMenu.hide()
        }, f.exportDocx = function () {
            v.export("docx")
        }, f.exportOdt = function () {
            v.export("odt")
        }, f.exportRTF = function () {
            v.export("rtf")
        }, f.exportEpub = function () {
            v.export("epub")
        }, f.exportLaTeX = function () {
            v.export("latex")
        }, f.exportWiki = function () {
            v.export("wiki")
        }, f.exportRST = function () {
            v.export("rst")
        }, f.exportOPML = function () {
            v.export("opml")
        }, f.exportTextile = function () {
            v.export("textile")
        };
        var w, C = function (e) {
            var t = i.editor.export.exportToHTML(!0, !1, !1, !1, e ? "body {font-variant-ligatures: no-common-ligatures;}" : ""),
                n = a.app.setting.config;
            if (w && (w.destroy(), w = null), w = new c({
                skipTaskbar: !0,
                title: "Print PDF Preview",
                show: !1,
                webPreferences: {
                    webSecurity: !1,
                    allowDisplayingInsecureContent: !0,
                    allowRunningInsecureContent: !0,
                    nodeIntegration: !1,
                    directWrite: n.directWrite,
                    defaultFontFamily: n.defaultFontFamily,
                    zoomFactor: s.setting.get("zoomFactor")
                }
            }), i.megaMenu.hide(), t.length < 1e5) w.loadURL("data:text/html;charset=UTF-8,  " + encodeURIComponent(t)); else {
                var r = reqnode("path").join(s.getPath("temp"), new Date - 0 + "tmp.html");
                reqnode("fs-extra").outputFileSync(r, t), w.loadURL("file:///" + r)
            }
            return w
        }, x = null;
        f.exportPDF = function () {
            if (i.colorBrightness < .5) {
                if (1 !== a.dialog.showMessageBox(l, {
                    type: "warning",
                    title: r.localize.getString("Dark Theme not support", "Panel"),
                    message: r.localize.getString('Sorry, current version of Typora won\'t print background color on exported PDF, So dark theme is not yet supported for PDF exporting. \nPlease choose a light theme or click "Print with default theme"', "Panel"),
                    buttons: [r.localize.getString("Cancel"), r.localize.getString("Print with default theme", "Panel")],
                    cancelId: 0
                })) return
            }
            i.sync(), x = m.startPDFJob(C()), setTimeout(function () {
                x && r("#md-notification").html(["<p>" + r.localize.getString("Exporting in progress...", "Panel"), '\n<div class="typora-search-spinner" style="margin-right:16px;top:8px">', '<div class="rect1"></div>', '<div class="rect2"></div>', '<div class="rect3"></div>', '<div class="rect4"></div>', '<div class="rect5"></div>', "</div></p>"].join("")).show()
            }, 2e3);

            function e(e) {
                e && alert(r.localize.getString("Export Failed", "Panel") + "\n" + e, r.localize.getString("Export Failed", "Panel")), w && w.destroy(), w = null, x = null, r("#md-notification").hide()
            }

            p.showExportDialog("pdf", function (t) {
                t ? x.then(function (n) {
                    i.fs.writeFile(t, n, function (n) {
                        n ? e(n) : (r("#md-notification .typora-pdf-warning").length || g.showNotification(r.localize.getString("Export to PDF successfully.", "Panel")), a.shell.showItemInFolder(t))
                    })
                }, e) : e()
            }, void 0, void 0, !0)
        }, f.selectAll = function () {
            if (isInputComponent(document.activeElement)) i.isNode && u().selectAll(); else {
                if (i.editor.sourceView.inSourceMode) return i.editor.sourceView.cm.focus(), void i.editor.sourceView.cm.execCommand("selectAll");
                i.editor.focusAndRestorePos(), i.editor.selection.selectAll(), i.editor.brush.expand()
            }
        }, f.deleteWord = function () {
            i.isLocked || (i.editor.selection.selectWord(!1, !0), i.editor.UserOp.backspaceHandler(i.editor, null, "delSelection"))
        }, f.deleteScope = function () {
            i.isLocked || (i.editor.selection.selectPhrase(), i.editor.UserOp.backspaceHandler(i.editor, null, "delSelection"))
        }, f.deleteLine = function () {
            i.isLocked || i.editor.UserOp.deleteLine(i.editor)
        }, f.deleteBlock = function () {
            i.isLocked || i.editor.UserOp.deleteBlock(i.editor)
        }, f.undo = function (e) {
            i.isLocked || (i.editor.undo.undo(e), i.freshMenuWithDeplay())
        }, f.redo = function (e) {
            i.isLocked || (i.editor.undo.redo(e), i.freshMenuWithDeplay())
        }, f.toggleOutline = function () {
            i.editor.library.togglePanel("outline")
        }, f.toggleFileList = function () {
            i.editor.library.togglePanel("file-list")
        }, f.toggleFileTree = function () {
            i.editor.library.togglePanel("file-tree")
        }, f.pinWindow = function () {
            h().setAlwaysOnTop(!0), document.body.classList.add("always-on-top"), f.refreshViewMenu()
        }, f.execForAll = function (e) {
            var t = e.toString(), n = arguments;
            t = t.replace(/\$(\d+)/gi, function (e, t) {
                return t - 0 < n.length ? n[t] : e
            }), reqnode("electron").ipcRenderer.send("execForAll", t)
        }, f.unpinWindow = function () {
            h().setAlwaysOnTop(!1), document.body.classList.remove("always-on-top"), f.refreshViewMenu()
        }, f.refreshViewMenu = function () {
            if (i.isNode) {
                var e = a.Menu.getApplicationMenu().items[4].submenu;
                o.refreshViewMenu();
                var t = e.getItem("Show Status Bar"), n = e.getItem("Actual Size");
                t.checked = !1, document.body.classList.contains("show-footer") && (t.checked = !0), n.checked = !s.setting.get("customZoom"), o.forceRefreshMenu()
            }
        };
        var k = function (e) {
            "string" == typeof e && (i._CopyContentFlag = e), u().copy()
        }, S = function (e) {
            "string" == typeof e && (i._PasteContentFlag = e), u().paste()
        };
        f.cut = function () {
            u().cut()
        }, f.copy = function () {
            k()
        }, f.copyAsMarkdown = function () {
            k("copyAsMarkdown")
        }, f.copyAsHTMLSource = function () {
            k("copyAsHTMLSource")
        }, f.paste = function () {
            S(!1)
        }, f.pasteAsPlain = function () {
            S("pasteAsPlain")
        }, f.setTheme = function (e, t) {
            console.log("set theme: " + e);
            a.Menu.getApplicationMenu().getItem("Themes").submenu.items.map(function (e) {
                e.checked = e.label == t
            }), s.setting.put("theme", e), f.execForAll("function(){\t\tFile.setTheme();\t}")
        }, f.resetZoom = function () {
            s.setting.put("customZoom", !1), i.resetZoom()
        }, f.zoomIn = function () {
            s.setting.put("customZoom", !0);
            var e = reqnode("electron").webFrame, t = e.getZoomLevel() + 1;
            e.setZoomLevel(t), s.setting.put("zoomLevel", t), s.setting.put("zoomFactor", e.getZoomFactor())
        }, f.zoomOut = function () {
            s.setting.put("customZoom", !0);
            var e = reqnode("electron").webFrame, t = e.getZoomLevel() - 1;
            e.setZoomLevel(t), s.setting.put("zoomLevel", t), s.setting.put("zoomFactor", e.getZoomFactor())
        }, n.exports = f, window.ClientCommand = f
    }), function (e) {
        if ("object" == typeof exports && void 0 !== module) module.exports = e(); else {
            $__System.registerDynamic("50", [], !1, function (t, n, i) {
                return e.call(this)
            })
        }
    }(function () {
        return function e(t, n, i) {
            function r(a, s) {
                if (!n[a]) {
                    if (!t[a]) {
                        var l = "function" == typeof require && require;
                        if (!s && l) return l(a, !0);
                        if (o) return o(a, !0);
                        var c = new Error("Cannot find module '" + a + "'");
                        throw c.code = "MODULE_NOT_FOUND", c
                    }
                    var d = n[a] = {exports: {}};
                    t[a][0].call(d.exports, function (e) {
                        var n = t[a][1][e];
                        return r(n || e)
                    }, d, d.exports, e, t, n, i)
                }
                return n[a].exports
            }

            for (var o = "function" == typeof require && require, a = 0; a < i.length; a++) r(i[a]);
            return r
        }({
            1: [function (e, t, n) {
                function i(e) {
                    this.name = "RavenConfigError", this.message = e
                }

                i.prototype = new Error, i.prototype.constructor = i, t.exports = i
            }, {}], 2: [function (e, t, n) {
                var i = e(5);
                t.exports = {
                    wrapMethod: function (e, t, n) {
                        var r = e[t], o = e;
                        if (t in e) {
                            var a = "warn" === t ? "warning" : t;
                            e[t] = function () {
                                var e = [].slice.call(arguments), s = i.safeJoin(e, " "),
                                    l = {level: a, logger: "console", extra: {arguments: e}};
                                "assert" === t ? !1 === e[0] && (s = "Assertion failed: " + (i.safeJoin(e.slice(1), " ") || "console.assert"), l.extra.arguments = e.slice(1), n && n(s, l)) : n && n(s, l), r && Function.prototype.apply.call(r, o, e)
                            }
                        }
                    }
                }
            }, {5: 5}], 3: [function (e, t, n) {
                (function (n) {
                    var i = e(6), r = e(7), o = e(8), a = e(1), s = e(5), l = s.isErrorEvent, c = s.isDOMError,
                        d = s.isDOMException, u = s.isError, h = s.isObject, f = s.isPlainObject, p = s.isUndefined,
                        m = s.isFunction, g = s.isString, v = s.isArray, y = s.isEmptyObject, b = s.each,
                        w = s.objectMerge, C = s.truncate, x = s.objectFrozen, k = s.hasKey, S = s.joinRegExp,
                        E = s.urlencode, F = s.uuid4, _ = s.htmlTreeAsString, T = s.isSameException,
                        M = s.isSameStacktrace, A = s.parseUrl, N = s.fill, L = s.supportsFetch,
                        R = s.supportsReferrerPolicy, D = s.serializeKeysForMessage, O = s.serializeException,
                        I = s.sanitize, P = e(2).wrapMethod, B = "source protocol user pass host port path".split(" "),
                        $ = /^(?:(\w+):)?\/\/(?:(\w+)(:\w+)?@)?([\w\.-]+)(?::(\d+))?(\/.*)/;

                    function H() {
                        return +new Date
                    }

                    var U = "undefined" != typeof window ? window : void 0 !== n ? n : "undefined" != typeof self ? self : {},
                        j = U.document, W = U.navigator;

                    function q(e, t) {
                        return m(t) ? function (n) {
                            return t(n, e)
                        } : t
                    }

                    function z() {
                        this._hasJSON = !("object" != typeof JSON || !JSON.stringify), this._hasDocument = !p(j), this._hasNavigator = !p(W), this._lastCapturedException = null, this._lastData = null, this._lastEventId = null, this._globalServer = null, this._globalKey = null, this._globalProject = null, this._globalContext = {}, this._globalOptions = {
                            release: U.SENTRY_RELEASE && U.SENTRY_RELEASE.id,
                            logger: "javascript",
                            ignoreErrors: [],
                            ignoreUrls: [],
                            whitelistUrls: [],
                            includePaths: [],
                            headers: null,
                            collectWindowErrors: !0,
                            captureUnhandledRejections: !0,
                            maxMessageLength: 0,
                            maxUrlLength: 250,
                            stackTraceLimit: 50,
                            autoBreadcrumbs: !0,
                            instrument: !0,
                            sampleRate: 1,
                            sanitizeKeys: []
                        }, this._fetchDefaults = {
                            method: "POST",
                            keepalive: !0,
                            referrerPolicy: R() ? "origin" : ""
                        }, this._ignoreOnError = 0, this._isRavenInstalled = !1, this._originalErrorStackTraceLimit = Error.stackTraceLimit, this._originalConsole = U.console || {}, this._originalConsoleMethods = {}, this._plugins = [], this._startTime = H(), this._wrappedBuiltIns = [], this._breadcrumbs = [], this._lastCapturedEvent = null, this._keypressTimeout, this._location = U.location, this._lastHref = this._location && this._location.href, this._resetBackoff();
                        for (var e in this._originalConsole) this._originalConsoleMethods[e] = this._originalConsole[e]
                    }

                    z.prototype = {
                        VERSION: "3.26.4", debug: !1, TraceKit: i, config: function (e, t) {
                            var n = this;
                            if (n._globalServer) return this._logDebug("error", "Error: Raven has already been configured"), n;
                            if (!e) return n;
                            var r = n._globalOptions;
                            t && b(t, function (e, t) {
                                "tags" === e || "extra" === e || "user" === e ? n._globalContext[e] = t : r[e] = t
                            }), n.setDSN(e), r.ignoreErrors.push(/^Script error\.?$/), r.ignoreErrors.push(/^Javascript error: Script error\.? on line 0$/), r.ignoreErrors = S(r.ignoreErrors), r.ignoreUrls = !!r.ignoreUrls.length && S(r.ignoreUrls), r.whitelistUrls = !!r.whitelistUrls.length && S(r.whitelistUrls), r.includePaths = S(r.includePaths), r.maxBreadcrumbs = Math.max(0, Math.min(r.maxBreadcrumbs || 100, 100));
                            var o = {xhr: !0, console: !0, dom: !0, location: !0, sentry: !0}, a = r.autoBreadcrumbs;
                            "[object Object]" === {}.toString.call(a) ? a = w(o, a) : !1 !== a && (a = o), r.autoBreadcrumbs = a;
                            var s = {tryCatch: !0}, l = r.instrument;
                            return "[object Object]" === {}.toString.call(l) ? l = w(s, l) : !1 !== l && (l = s), r.instrument = l, i.collectWindowErrors = !!r.collectWindowErrors, n
                        }, install: function () {
                            var e = this;
                            return e.isSetup() && !e._isRavenInstalled && (i.report.subscribe(function () {
                                e._handleOnErrorStackInfo.apply(e, arguments)
                            }), e._globalOptions.captureUnhandledRejections && e._attachPromiseRejectionHandler(), e._patchFunctionToString(), e._globalOptions.instrument && e._globalOptions.instrument.tryCatch && e._instrumentTryCatch(), e._globalOptions.autoBreadcrumbs && e._instrumentBreadcrumbs(), e._drainPlugins(), e._isRavenInstalled = !0), Error.stackTraceLimit = e._globalOptions.stackTraceLimit, this
                        }, setDSN: function (e) {
                            var t = this._parseDSN(e), n = t.path.lastIndexOf("/"), i = t.path.substr(1, n);
                            this._dsn = e, this._globalKey = t.user, this._globalSecret = t.pass && t.pass.substr(1), this._globalProject = t.path.substr(n + 1), this._globalServer = this._getGlobalServer(t), this._globalEndpoint = this._globalServer + "/" + i + "api/" + this._globalProject + "/store/", this._resetBackoff()
                        }, context: function (e, t, n) {
                            return m(e) && (n = t || [], t = e, e = {}), this.wrap(e, t).apply(this, n)
                        }, wrap: function (e, t, n) {
                            var i = this;
                            if (p(t) && !m(e)) return e;
                            if (m(e) && (t = e, e = void 0), !m(t)) return t;
                            try {
                                if (t.__raven__) return t;
                                if (t.__raven_wrapper__) return t.__raven_wrapper__
                            } catch (e) {
                                return t
                            }

                            function r() {
                                var r = [], o = arguments.length, a = !e || e && !1 !== e.deep;
                                for (n && m(n) && n.apply(this, arguments); o--;) r[o] = a ? i.wrap(e, arguments[o]) : arguments[o];
                                try {
                                    return t.apply(this, r)
                                } catch (t) {
                                    throw i._ignoreNextOnError(), i.captureException(t, e), t
                                }
                            }

                            for (var o in t) k(t, o) && (r[o] = t[o]);
                            return r.prototype = t.prototype, t.__raven_wrapper__ = r, r.__raven__ = !0, r.__orig__ = t, r
                        }, uninstall: function () {
                            return i.report.uninstall(), this._detachPromiseRejectionHandler(), this._unpatchFunctionToString(), this._restoreBuiltIns(), this._restoreConsole(), Error.stackTraceLimit = this._originalErrorStackTraceLimit, this._isRavenInstalled = !1, this
                        }, _promiseRejectionHandler: function (e) {
                            this._logDebug("debug", "Raven caught unhandled promise rejection:", e), this.captureException(e.reason, {
                                mechanism: {
                                    type: "onunhandledrejection",
                                    handled: !1
                                }
                            })
                        }, _attachPromiseRejectionHandler: function () {
                            return this._promiseRejectionHandler = this._promiseRejectionHandler.bind(this), U.addEventListener && U.addEventListener("unhandledrejection", this._promiseRejectionHandler), this
                        }, _detachPromiseRejectionHandler: function () {
                            return U.removeEventListener && U.removeEventListener("unhandledrejection", this._promiseRejectionHandler), this
                        }, captureException: function (e, t) {
                            if (t = w({trimHeadFrames: 0}, t || {}), l(e) && e.error) e = e.error; else {
                                if (c(e) || d(e)) {
                                    var n = e.name || (c(e) ? "DOMError" : "DOMException"),
                                        r = e.message ? n + ": " + e.message : n;
                                    return this.captureMessage(r, w(t, {
                                        stacktrace: !0,
                                        trimHeadFrames: t.trimHeadFrames + 1
                                    }))
                                }
                                if (u(e)) e = e; else {
                                    if (!f(e)) return this.captureMessage(e, w(t, {
                                        stacktrace: !0,
                                        trimHeadFrames: t.trimHeadFrames + 1
                                    }));
                                    t = this._getCaptureExceptionOptionsFromPlainObject(t, e), e = new Error(t.message)
                                }
                            }
                            this._lastCapturedException = e;
                            try {
                                var o = i.computeStackTrace(e);
                                this._handleStackInfo(o, t)
                            } catch (t) {
                                if (e !== t) throw t
                            }
                            return this
                        }, _getCaptureExceptionOptionsFromPlainObject: function (e, t) {
                            var n = Object.keys(t).sort(), i = w(e, {
                                message: "Non-Error exception captured with keys: " + D(n),
                                fingerprint: [o(n)],
                                extra: e.extra || {}
                            });
                            return i.extra.__serialized__ = O(t), i
                        }, captureMessage: function (e, t) {
                            if (!this._globalOptions.ignoreErrors.test || !this._globalOptions.ignoreErrors.test(e)) {
                                var n, r = w({message: e += ""}, t = t || {});
                                try {
                                    throw new Error(e)
                                } catch (e) {
                                    n = e
                                }
                                n.name = null;
                                var o = i.computeStackTrace(n), a = v(o.stack) && o.stack[1];
                                a && "Raven.captureException" === a.func && (a = o.stack[2]);
                                var s = a && a.url || "";
                                if ((!this._globalOptions.ignoreUrls.test || !this._globalOptions.ignoreUrls.test(s)) && (!this._globalOptions.whitelistUrls.test || this._globalOptions.whitelistUrls.test(s))) {
                                    if (this._globalOptions.stacktrace || t.stacktrace || "" === r.message) {
                                        r.fingerprint = null == r.fingerprint ? e : r.fingerprint, (t = w({trimHeadFrames: 0}, t)).trimHeadFrames += 1;
                                        var l = this._prepareFrames(o, t);
                                        r.stacktrace = {frames: l.reverse()}
                                    }
                                    return r.fingerprint && (r.fingerprint = v(r.fingerprint) ? r.fingerprint : [r.fingerprint]), this._send(r), this
                                }
                            }
                        }, captureBreadcrumb: function (e) {
                            var t = w({timestamp: H() / 1e3}, e);
                            if (m(this._globalOptions.breadcrumbCallback)) {
                                var n = this._globalOptions.breadcrumbCallback(t);
                                if (h(n) && !y(n)) t = n; else if (!1 === n) return this
                            }
                            return this._breadcrumbs.push(t), this._breadcrumbs.length > this._globalOptions.maxBreadcrumbs && this._breadcrumbs.shift(), this
                        }, addPlugin: function (e) {
                            var t = [].slice.call(arguments, 1);
                            return this._plugins.push([e, t]), this._isRavenInstalled && this._drainPlugins(), this
                        }, setUserContext: function (e) {
                            return this._globalContext.user = e, this
                        }, setExtraContext: function (e) {
                            return this._mergeContext("extra", e), this
                        }, setTagsContext: function (e) {
                            return this._mergeContext("tags", e), this
                        }, clearContext: function () {
                            return this._globalContext = {}, this
                        }, getContext: function () {
                            return JSON.parse(r(this._globalContext))
                        }, setEnvironment: function (e) {
                            return this._globalOptions.environment = e, this
                        }, setRelease: function (e) {
                            return this._globalOptions.release = e, this
                        }, setDataCallback: function (e) {
                            var t = this._globalOptions.dataCallback;
                            return this._globalOptions.dataCallback = q(t, e), this
                        }, setBreadcrumbCallback: function (e) {
                            var t = this._globalOptions.breadcrumbCallback;
                            return this._globalOptions.breadcrumbCallback = q(t, e), this
                        }, setShouldSendCallback: function (e) {
                            var t = this._globalOptions.shouldSendCallback;
                            return this._globalOptions.shouldSendCallback = q(t, e), this
                        }, setTransport: function (e) {
                            return this._globalOptions.transport = e, this
                        }, lastException: function () {
                            return this._lastCapturedException
                        }, lastEventId: function () {
                            return this._lastEventId
                        }, isSetup: function () {
                            return !!this._hasJSON && (!!this._globalServer || (this.ravenNotConfiguredError || (this.ravenNotConfiguredError = !0, this._logDebug("error", "Error: Raven has not been configured.")), !1))
                        }, afterLoad: function () {
                            var e = U.RavenConfig;
                            e && this.config(e.dsn, e.config).install()
                        }, showReportDialog: function (e) {
                            if (j) {
                                if (!(e = Object.assign({
                                    eventId: this.lastEventId(),
                                    dsn: this._dsn,
                                    user: this._globalContext.user || {}
                                }, e)).eventId) throw new a("Missing eventId");
                                if (!e.dsn) throw new a("Missing DSN");
                                var t = encodeURIComponent, n = [];
                                for (var i in e) if ("user" === i) {
                                    var r = e.user;
                                    r.name && n.push("name=" + t(r.name)), r.email && n.push("email=" + t(r.email))
                                } else n.push(t(i) + "=" + t(e[i]));
                                var o = this._getGlobalServer(this._parseDSN(e.dsn)), s = j.createElement("script");
                                s.async = !0, s.src = o + "/api/embed/error-page/?" + n.join("&"), (j.head || j.body).appendChild(s)
                            }
                        }, _ignoreNextOnError: function () {
                            var e = this;
                            this._ignoreOnError += 1, setTimeout(function () {
                                e._ignoreOnError -= 1
                            })
                        }, _triggerEvent: function (e, t) {
                            var n, i;
                            if (this._hasDocument) {
                                t = t || {}, e = "raven" + e.substr(0, 1).toUpperCase() + e.substr(1), j.createEvent ? (n = j.createEvent("HTMLEvents")).initEvent(e, !0, !0) : (n = j.createEventObject()).eventType = e;
                                for (i in t) k(t, i) && (n[i] = t[i]);
                                if (j.createEvent) j.dispatchEvent(n); else try {
                                    j.fireEvent("on" + n.eventType.toLowerCase(), n)
                                } catch (e) {
                                }
                            }
                        }, _breadcrumbEventHandler: function (e) {
                            var t = this;
                            return function (n) {
                                if (t._keypressTimeout = null, t._lastCapturedEvent !== n) {
                                    t._lastCapturedEvent = n;
                                    var i;
                                    try {
                                        i = _(n.target)
                                    } catch (e) {
                                        i = "<unknown>"
                                    }
                                    t.captureBreadcrumb({category: "ui." + e, message: i})
                                }
                            }
                        }, _keypressEventHandler: function () {
                            var e = this;
                            return function (t) {
                                var n;
                                try {
                                    n = t.target
                                } catch (e) {
                                    return
                                }
                                var i = n && n.tagName;
                                if (i && ("INPUT" === i || "TEXTAREA" === i || n.isContentEditable)) {
                                    var r = e._keypressTimeout;
                                    r || e._breadcrumbEventHandler("input")(t), clearTimeout(r), e._keypressTimeout = setTimeout(function () {
                                        e._keypressTimeout = null
                                    }, 1e3)
                                }
                            }
                        }, _captureUrlChange: function (e, t) {
                            var n = A(this._location.href), i = A(t), r = A(e);
                            this._lastHref = t, n.protocol === i.protocol && n.host === i.host && (t = i.relative), n.protocol === r.protocol && n.host === r.host && (e = r.relative), this.captureBreadcrumb({
                                category: "navigation",
                                data: {to: t, from: e}
                            })
                        }, _patchFunctionToString: function () {
                            var e = this;
                            e._originalFunctionToString = Function.prototype.toString, Function.prototype.toString = function () {
                                return "function" == typeof this && this.__raven__ ? e._originalFunctionToString.apply(this.__orig__, arguments) : e._originalFunctionToString.apply(this, arguments)
                            }
                        }, _unpatchFunctionToString: function () {
                            this._originalFunctionToString && (Function.prototype.toString = this._originalFunctionToString)
                        }, _instrumentTryCatch: function () {
                            var e = this, t = e._wrappedBuiltIns;

                            function n(t) {
                                return function (n, i) {
                                    for (var r = new Array(arguments.length), o = 0; o < r.length; ++o) r[o] = arguments[o];
                                    var a = r[0];
                                    return m(a) && (r[0] = e.wrap({
                                        mechanism: {
                                            type: "instrument",
                                            data: {function: t.name || "<anonymous>"}
                                        }
                                    }, a)), t.apply ? t.apply(this, r) : t(r[0], r[1])
                                }
                            }

                            var i = this._globalOptions.autoBreadcrumbs;

                            function r(n) {
                                var r = U[n] && U[n].prototype;
                                r && r.hasOwnProperty && r.hasOwnProperty("addEventListener") && (N(r, "addEventListener", function (t) {
                                    return function (r, o, a, s) {
                                        try {
                                            o && o.handleEvent && (o.handleEvent = e.wrap({
                                                mechanism: {
                                                    type: "instrument",
                                                    data: {
                                                        target: n,
                                                        function: "handleEvent",
                                                        handler: o && o.name || "<anonymous>"
                                                    }
                                                }
                                            }, o.handleEvent))
                                        } catch (e) {
                                        }
                                        var l, c, d;
                                        return i && i.dom && ("EventTarget" === n || "Node" === n) && (c = e._breadcrumbEventHandler("click"), d = e._keypressEventHandler(), l = function (e) {
                                            if (e) {
                                                var t;
                                                try {
                                                    t = e.type
                                                } catch (e) {
                                                    return
                                                }
                                                return "click" === t ? c(e) : "keypress" === t ? d(e) : void 0
                                            }
                                        }), t.call(this, r, e.wrap({
                                            mechanism: {
                                                type: "instrument",
                                                data: {
                                                    target: n,
                                                    function: "addEventListener",
                                                    handler: o && o.name || "<anonymous>"
                                                }
                                            }
                                        }, o, l), a, s)
                                    }
                                }, t), N(r, "removeEventListener", function (e) {
                                    return function (t, n, i, r) {
                                        try {
                                            n = n && (n.__raven_wrapper__ ? n.__raven_wrapper__ : n)
                                        } catch (e) {
                                        }
                                        return e.call(this, t, n, i, r)
                                    }
                                }, t))
                            }

                            N(U, "setTimeout", n, t), N(U, "setInterval", n, t), U.requestAnimationFrame && N(U, "requestAnimationFrame", function (t) {
                                return function (n) {
                                    return t(e.wrap({
                                        mechanism: {
                                            type: "instrument",
                                            data: {
                                                function: "requestAnimationFrame",
                                                handler: t && t.name || "<anonymous>"
                                            }
                                        }
                                    }, n))
                                }
                            }, t);
                            for (var o = ["EventTarget", "Window", "Node", "ApplicationCache", "AudioTrackList", "ChannelMergerNode", "CryptoOperation", "EventSource", "FileReader", "HTMLUnknownElement", "IDBDatabase", "IDBRequest", "IDBTransaction", "KeyOperation", "MediaController", "MessagePort", "ModalWindow", "Notification", "SVGElementInstance", "Screen", "TextTrack", "TextTrackCue", "TextTrackList", "WebSocket", "WebSocketWorker", "Worker", "XMLHttpRequest", "XMLHttpRequestEventTarget", "XMLHttpRequestUpload"], a = 0; a < o.length; a++) r(o[a])
                        }, _instrumentBreadcrumbs: function () {
                            var e = this, t = this._globalOptions.autoBreadcrumbs, n = e._wrappedBuiltIns;

                            function i(t, n) {
                                t in n && m(n[t]) && N(n, t, function (n) {
                                    return e.wrap({
                                        mechanism: {
                                            type: "instrument",
                                            data: {function: t, handler: n && n.name || "<anonymous>"}
                                        }
                                    }, n)
                                })
                            }

                            if (t.xhr && "XMLHttpRequest" in U) {
                                var r = U.XMLHttpRequest && U.XMLHttpRequest.prototype;
                                N(r, "open", function (t) {
                                    return function (n, i) {
                                        return g(i) && -1 === i.indexOf(e._globalKey) && (this.__raven_xhr = {
                                            method: n,
                                            url: i,
                                            status_code: null
                                        }), t.apply(this, arguments)
                                    }
                                }, n), N(r, "send", function (t) {
                                    return function () {
                                        var n = this;

                                        function r() {
                                            if (n.__raven_xhr && 4 === n.readyState) {
                                                try {
                                                    n.__raven_xhr.status_code = n.status
                                                } catch (e) {
                                                }
                                                e.captureBreadcrumb({
                                                    type: "http",
                                                    category: "xhr",
                                                    data: n.__raven_xhr
                                                })
                                            }
                                        }

                                        for (var o = ["onload", "onerror", "onprogress"], a = 0; a < o.length; a++) i(o[a], n);
                                        return "onreadystatechange" in n && m(n.onreadystatechange) ? N(n, "onreadystatechange", function (t) {
                                            return e.wrap({
                                                mechanism: {
                                                    type: "instrument",
                                                    data: {
                                                        function: "onreadystatechange",
                                                        handler: t && t.name || "<anonymous>"
                                                    }
                                                }
                                            }, t, r)
                                        }) : n.onreadystatechange = r, t.apply(this, arguments)
                                    }
                                }, n)
                            }
                            t.xhr && L() && N(U, "fetch", function (t) {
                                return function () {
                                    for (var n = new Array(arguments.length), i = 0; i < n.length; ++i) n[i] = arguments[i];
                                    var r, o = n[0], a = "GET";
                                    if ("string" == typeof o ? r = o : "Request" in U && o instanceof U.Request ? (r = o.url, o.method && (a = o.method)) : r = "" + o, -1 !== r.indexOf(e._globalKey)) return t.apply(this, n);
                                    n[1] && n[1].method && (a = n[1].method);
                                    var s = {method: a, url: r, status_code: null};
                                    return t.apply(this, n).then(function (t) {
                                        return s.status_code = t.status, e.captureBreadcrumb({
                                            type: "http",
                                            category: "fetch",
                                            data: s
                                        }), t
                                    }).catch(function (t) {
                                        throw e.captureBreadcrumb({
                                            type: "http",
                                            category: "fetch",
                                            data: s,
                                            level: "error"
                                        }), t
                                    })
                                }
                            }, n), t.dom && this._hasDocument && (j.addEventListener ? (j.addEventListener("click", e._breadcrumbEventHandler("click"), !1), j.addEventListener("keypress", e._keypressEventHandler(), !1)) : j.attachEvent && (j.attachEvent("onclick", e._breadcrumbEventHandler("click")), j.attachEvent("onkeypress", e._keypressEventHandler())));
                            var o = U.chrome,
                                a = !(o && o.app && o.app.runtime) && U.history && U.history.pushState && U.history.replaceState;
                            if (t.location && a) {
                                var s = U.onpopstate;
                                U.onpopstate = function () {
                                    var t = e._location.href;
                                    if (e._captureUrlChange(e._lastHref, t), s) return s.apply(this, arguments)
                                };
                                var l = function (t) {
                                    return function () {
                                        var n = arguments.length > 2 ? arguments[2] : void 0;
                                        return n && e._captureUrlChange(e._lastHref, n + ""), t.apply(this, arguments)
                                    }
                                };
                                N(U.history, "pushState", l, n), N(U.history, "replaceState", l, n)
                            }
                            if (t.console && "console" in U && console.log) {
                                var c = function (t, n) {
                                    e.captureBreadcrumb({message: t, level: n.level, category: "console"})
                                };
                                b(["debug", "info", "warn", "error", "log"], function (e, t) {
                                    P(console, t, c)
                                })
                            }
                        }, _restoreBuiltIns: function () {
                            for (var e; this._wrappedBuiltIns.length;) {
                                var t = (e = this._wrappedBuiltIns.shift())[0], n = e[1], i = e[2];
                                t[n] = i
                            }
                        }, _restoreConsole: function () {
                            for (var e in this._originalConsoleMethods) this._originalConsole[e] = this._originalConsoleMethods[e]
                        }, _drainPlugins: function () {
                            var e = this;
                            b(this._plugins, function (t, n) {
                                var i = n[0], r = n[1];
                                i.apply(e, [e].concat(r))
                            })
                        }, _parseDSN: function (e) {
                            var t = $.exec(e), n = {}, i = 7;
                            try {
                                for (; i--;) n[B[i]] = t[i] || ""
                            } catch (t) {
                                throw new a("Invalid DSN: " + e)
                            }
                            if (n.pass && !this._globalOptions.allowSecretKey) throw new a("Do not specify your secret key in the DSN. See: http://bit.ly/raven-secret-key");
                            return n
                        }, _getGlobalServer: function (e) {
                            var t = "//" + e.host + (e.port ? ":" + e.port : "");
                            return e.protocol && (t = e.protocol + ":" + t), t
                        }, _handleOnErrorStackInfo: function (e, t) {
                            (t = t || {}).mechanism = t.mechanism || {
                                type: "onerror",
                                handled: !1
                            }, this._ignoreOnError || this._handleStackInfo(e, t)
                        }, _handleStackInfo: function (e, t) {
                            var n = this._prepareFrames(e, t);
                            this._triggerEvent("handle", {
                                stackInfo: e,
                                options: t
                            }), this._processException(e.name, e.message, e.url, e.lineno, n, t)
                        }, _prepareFrames: function (e, t) {
                            var n = this, i = [];
                            if (e.stack && e.stack.length && (b(e.stack, function (t, r) {
                                var o = n._normalizeFrame(r, e.url);
                                o && i.push(o)
                            }), t && t.trimHeadFrames)) for (var r = 0; r < t.trimHeadFrames && r < i.length; r++) i[r].in_app = !1;
                            return i = i.slice(0, this._globalOptions.stackTraceLimit)
                        }, _normalizeFrame: function (e, t) {
                            var n = {filename: e.url, lineno: e.line, colno: e.column, function: e.func || "?"};
                            return e.url || (n.filename = t), n.in_app = !(this._globalOptions.includePaths.test && !this._globalOptions.includePaths.test(n.filename) || /(Raven|TraceKit)\./.test(n.function) || /raven\.(min\.)?js$/.test(n.filename)), n
                        }, _processException: function (e, t, n, i, r, o) {
                            var a = (e ? e + ": " : "") + (t || "");
                            if (!this._globalOptions.ignoreErrors.test || !this._globalOptions.ignoreErrors.test(t) && !this._globalOptions.ignoreErrors.test(a)) {
                                var s;
                                if (r && r.length ? (n = r[0].filename || n, r.reverse(), s = {frames: r}) : n && (s = {
                                    frames: [{
                                        filename: n,
                                        lineno: i,
                                        in_app: !0
                                    }]
                                }), (!this._globalOptions.ignoreUrls.test || !this._globalOptions.ignoreUrls.test(n)) && (!this._globalOptions.whitelistUrls.test || this._globalOptions.whitelistUrls.test(n))) {
                                    var l = w({
                                        exception: {values: [{type: e, value: t, stacktrace: s}]},
                                        transaction: n
                                    }, o), c = l.exception.values[0];
                                    null == c.type && "" === c.value && (c.value = "Unrecoverable error caught"), !l.exception.mechanism && l.mechanism && (l.exception.mechanism = l.mechanism, delete l.mechanism), l.exception.mechanism = w({
                                        type: "generic",
                                        handled: !0
                                    }, l.exception.mechanism || {}), this._send(l)
                                }
                            }
                        }, _trimPacket: function (e) {
                            var t = this._globalOptions.maxMessageLength;
                            if (e.message && (e.message = C(e.message, t)), e.exception) {
                                var n = e.exception.values[0];
                                n.value = C(n.value, t)
                            }
                            var i = e.request;
                            return i && (i.url && (i.url = C(i.url, this._globalOptions.maxUrlLength)), i.Referer && (i.Referer = C(i.Referer, this._globalOptions.maxUrlLength))), e.breadcrumbs && e.breadcrumbs.values && this._trimBreadcrumbs(e.breadcrumbs), e
                        }, _trimBreadcrumbs: function (e) {
                            for (var t, n, i, r = ["to", "from", "url"], o = 0; o < e.values.length; ++o) if ((n = e.values[o]).hasOwnProperty("data") && h(n.data) && !x(n.data)) {
                                i = w({}, n.data);
                                for (var a = 0; a < r.length; ++a) t = r[a], i.hasOwnProperty(t) && i[t] && (i[t] = C(i[t], this._globalOptions.maxUrlLength));
                                e.values[o].data = i
                            }
                        }, _getHttpData: function () {
                            if (this._hasNavigator || this._hasDocument) {
                                var e = {};
                                return this._hasNavigator && W.userAgent && (e.headers = {"User-Agent": W.userAgent}), U.location && U.location.href && (e.url = U.location.href), this._hasDocument && j.referrer && (e.headers || (e.headers = {}), e.headers.Referer = j.referrer), e
                            }
                        }, _resetBackoff: function () {
                            this._backoffDuration = 0, this._backoffStart = null
                        }, _shouldBackoff: function () {
                            return this._backoffDuration && H() - this._backoffStart < this._backoffDuration
                        }, _isRepeatData: function (e) {
                            var t = this._lastData;
                            return !(!t || e.message !== t.message || e.transaction !== t.transaction) && (e.stacktrace || t.stacktrace ? M(e.stacktrace, t.stacktrace) : !e.exception && !t.exception || T(e.exception, t.exception))
                        }, _setBackoffState: function (e) {
                            if (!this._shouldBackoff()) {
                                var t = e.status;
                                if (400 === t || 401 === t || 429 === t) {
                                    var n;
                                    try {
                                        n = L() ? e.headers.get("Retry-After") : e.getResponseHeader("Retry-After"), n = 1e3 * parseInt(n, 10)
                                    } catch (e) {
                                    }
                                    this._backoffDuration = n || (2 * this._backoffDuration || 1e3), this._backoffStart = H()
                                }
                            }
                        }, _send: function (e) {
                            var t = this._globalOptions,
                                n = {project: this._globalProject, logger: t.logger, platform: "javascript"},
                                i = this._getHttpData();
                            i && (n.request = i), e.trimHeadFrames && delete e.trimHeadFrames, (e = w(n, e)).tags = w(w({}, this._globalContext.tags), e.tags), e.extra = w(w({}, this._globalContext.extra), e.extra), e.extra["session:duration"] = H() - this._startTime, this._breadcrumbs && this._breadcrumbs.length > 0 && (e.breadcrumbs = {values: [].slice.call(this._breadcrumbs, 0)}), this._globalContext.user && (e.user = this._globalContext.user), t.environment && (e.environment = t.environment), t.release && (e.release = t.release), t.serverName && (e.server_name = t.serverName), e = this._sanitizeData(e), Object.keys(e).forEach(function (t) {
                                (null == e[t] || "" === e[t] || y(e[t])) && delete e[t]
                            }), m(t.dataCallback) && (e = t.dataCallback(e) || e), e && !y(e) && (m(t.shouldSendCallback) && !t.shouldSendCallback(e) || (this._shouldBackoff() ? this._logDebug("warn", "Raven dropped error due to backoff: ", e) : "number" == typeof t.sampleRate ? Math.random() < t.sampleRate && this._sendProcessedPayload(e) : this._sendProcessedPayload(e)))
                        }, _sanitizeData: function (e) {
                            return I(e, this._globalOptions.sanitizeKeys)
                        }, _getUuid: function () {
                            return F()
                        }, _sendProcessedPayload: function (e, t) {
                            var n = this, i = this._globalOptions;
                            if (this.isSetup()) if (e = this._trimPacket(e), this._globalOptions.allowDuplicates || !this._isRepeatData(e)) {
                                this._lastEventId = e.event_id || (e.event_id = this._getUuid()), this._lastData = e, this._logDebug("debug", "Raven about to send:", e);
                                var r = {
                                    sentry_version: "7",
                                    sentry_client: "raven-js/" + this.VERSION,
                                    sentry_key: this._globalKey
                                };
                                this._globalSecret && (r.sentry_secret = this._globalSecret);
                                var o = e.exception && e.exception.values[0];
                                this._globalOptions.autoBreadcrumbs && this._globalOptions.autoBreadcrumbs.sentry && this.captureBreadcrumb({
                                    category: "sentry",
                                    message: o ? (o.type ? o.type + ": " : "") + o.value : e.message,
                                    event_id: e.event_id,
                                    level: e.level || "error"
                                });
                                var a = this._globalEndpoint;
                                (i.transport || this._makeRequest).call(this, {
                                    url: a,
                                    auth: r,
                                    data: e,
                                    options: i,
                                    onSuccess: function () {
                                        n._resetBackoff(), n._triggerEvent("success", {data: e, src: a}), t && t()
                                    },
                                    onError: function (i) {
                                        n._logDebug("error", "Raven transport failed to send: ", i), i.request && n._setBackoffState(i.request), n._triggerEvent("failure", {
                                            data: e,
                                            src: a
                                        }), i = i || new Error("Raven send failed (no additional details provided)"), t && t(i)
                                    }
                                })
                            } else this._logDebug("warn", "Raven dropped repeat event: ", e)
                        }, _makeRequest: function (e) {
                            var t = e.url + "?" + E(e.auth), n = null, i = {};
                            if (e.options.headers && (n = this._evaluateHash(e.options.headers)), e.options.fetchParameters && (i = this._evaluateHash(e.options.fetchParameters)), L()) {
                                i.body = r(e.data);
                                var o = w({}, this._fetchDefaults), a = w(o, i);
                                return n && (a.headers = n), U.fetch(t, a).then(function (t) {
                                    if (t.ok) e.onSuccess && e.onSuccess(); else {
                                        var n = new Error("Sentry error code: " + t.status);
                                        n.request = t, e.onError && e.onError(n)
                                    }
                                }).catch(function () {
                                    e.onError && e.onError(new Error("Sentry error code: network unavailable"))
                                })
                            }
                            var s = U.XMLHttpRequest && new U.XMLHttpRequest;
                            if (s) {
                                ("withCredentials" in s || "undefined" != typeof XDomainRequest) && ("withCredentials" in s ? s.onreadystatechange = function () {
                                    if (4 === s.readyState) if (200 === s.status) e.onSuccess && e.onSuccess(); else if (e.onError) {
                                        var t = new Error("Sentry error code: " + s.status);
                                        t.request = s, e.onError(t)
                                    }
                                } : (s = new XDomainRequest, t = t.replace(/^https?:/, ""), e.onSuccess && (s.onload = e.onSuccess), e.onError && (s.onerror = function () {
                                    var t = new Error("Sentry error code: XDomainRequest");
                                    t.request = s, e.onError(t)
                                })), s.open("POST", t), n && b(n, function (e, t) {
                                    s.setRequestHeader(e, t)
                                }), s.send(r(e.data)))
                            }
                        }, _evaluateHash: function (e) {
                            var t = {};
                            for (var n in e) if (e.hasOwnProperty(n)) {
                                var i = e[n];
                                t[n] = "function" == typeof i ? i() : i
                            }
                            return t
                        }, _logDebug: function (e) {
                            this._originalConsoleMethods[e] && (this.debug || this._globalOptions.debug) && Function.prototype.apply.call(this._originalConsoleMethods[e], this._originalConsole, [].slice.call(arguments, 1))
                        }, _mergeContext: function (e, t) {
                            p(t) ? delete this._globalContext[e] : this._globalContext[e] = w(this._globalContext[e] || {}, t)
                        }
                    }, z.prototype.setUser = z.prototype.setUserContext, z.prototype.setReleaseContext = z.prototype.setRelease, t.exports = z
                }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {})
            }, {1: 1, 2: 2, 5: 5, 6: 6, 7: 7, 8: 8}], 4: [function (e, t, n) {
                (function (n) {
                    var i = e(3),
                        r = "undefined" != typeof window ? window : void 0 !== n ? n : "undefined" != typeof self ? self : {},
                        o = r.Raven, a = new i;
                    a.noConflict = function () {
                        return r.Raven = o, a
                    }, a.afterLoad(), t.exports = a, t.exports.Client = i
                }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {})
            }, {3: 3}], 5: [function (e, t, n) {
                (function (n) {
                    var i = e(7),
                        r = "undefined" != typeof window ? window : void 0 !== n ? n : "undefined" != typeof self ? self : {};

                    function o(e) {
                        return void 0 === e
                    }

                    function a(e) {
                        return "[object Object]" === Object.prototype.toString.call(e)
                    }

                    function s(e) {
                        return "[object String]" === Object.prototype.toString.call(e)
                    }

                    function l(e) {
                        return "[object Array]" === Object.prototype.toString.call(e)
                    }

                    function c() {
                        if (!("fetch" in r)) return !1;
                        try {
                            return new Headers, new Request(""), new Response, !0
                        } catch (e) {
                            return !1
                        }
                    }

                    function d(e, t) {
                        var n, i;
                        if (o(e.length)) for (n in e) h(e, n) && t.call(null, n, e[n]); else if (i = e.length) for (n = 0; n < i; n++) t.call(null, n, e[n])
                    }

                    function u(e, t) {
                        if ("number" != typeof t) throw new Error("2nd argument to `truncate` function should be a number");
                        return "string" != typeof e || 0 === t ? e : e.length <= t ? e : e.substr(0, t) + "…"
                    }

                    function h(e, t) {
                        return Object.prototype.hasOwnProperty.call(e, t)
                    }

                    function f(e) {
                        for (var t, n = [], i = 0, r = e.length; i < r; i++) s(t = e[i]) ? n.push(t.replace(/([.*+?^=!:${}()|\[\]\/\\])/g, "\\$1")) : t && t.source && n.push(t.source);
                        return new RegExp(n.join("|"), "i")
                    }

                    function p(e) {
                        var t, n, i, r, o, a = [];
                        if (!e || !e.tagName) return "";
                        if (a.push(e.tagName.toLowerCase()), e.id && a.push("#" + e.id), (t = e.className) && s(t)) for (n = t.split(/\s+/), o = 0; o < n.length; o++) a.push("." + n[o]);
                        var l = ["type", "name", "title", "alt"];
                        for (o = 0; o < l.length; o++) i = l[o], (r = e.getAttribute(i)) && a.push("[" + i + '="' + r + '"]');
                        return a.join("")
                    }

                    function m(e, t) {
                        return !!(!!e ^ !!t)
                    }

                    function g(e, t) {
                        if (m(e, t)) return !1;
                        var n = e.frames, i = t.frames;
                        if (void 0 === n || void 0 === i) return !1;
                        if (n.length !== i.length) return !1;
                        for (var r, o, a = 0; a < n.length; a++) if (r = n[a], o = i[a], r.filename !== o.filename || r.lineno !== o.lineno || r.colno !== o.colno || r.function !== o.function) return !1;
                        return !0
                    }

                    var v = 3, y = 51200, b = 40;

                    function w(e) {
                        return t = JSON.stringify(e), ~-encodeURI(t).split(/%..|./).length;
                        var t
                    }

                    function C(e) {
                        if ("string" == typeof e) {
                            return u(e, 40)
                        }
                        if ("number" == typeof e || "boolean" == typeof e || void 0 === e) return e;
                        var t = Object.prototype.toString.call(e);
                        return "[object Object]" === t ? "[Object]" : "[object Array]" === t ? "[Array]" : "[object Function]" === t ? e.name ? "[Function: " + e.name + "]" : "[Function]" : e
                    }

                    t.exports = {
                        isObject: function (e) {
                            return "object" == typeof e && null !== e
                        }, isError: function (e) {
                            switch (Object.prototype.toString.call(e)) {
                                case"[object Error]":
                                case"[object Exception]":
                                case"[object DOMException]":
                                    return !0;
                                default:
                                    return e instanceof Error
                            }
                        }, isErrorEvent: function (e) {
                            return "[object ErrorEvent]" === Object.prototype.toString.call(e)
                        }, isDOMError: function (e) {
                            return "[object DOMError]" === Object.prototype.toString.call(e)
                        }, isDOMException: function (e) {
                            return "[object DOMException]" === Object.prototype.toString.call(e)
                        }, isUndefined: o, isFunction: function (e) {
                            return "function" == typeof e
                        }, isPlainObject: a, isString: s, isArray: l, isEmptyObject: function (e) {
                            if (!a(e)) return !1;
                            for (var t in e) if (e.hasOwnProperty(t)) return !1;
                            return !0
                        }, supportsErrorEvent: function () {
                            try {
                                return new ErrorEvent(""), !0
                            } catch (e) {
                                return !1
                            }
                        }, supportsDOMError: function () {
                            try {
                                return new DOMError(""), !0
                            } catch (e) {
                                return !1
                            }
                        }, supportsDOMException: function () {
                            try {
                                return new DOMException(""), !0
                            } catch (e) {
                                return !1
                            }
                        }, supportsFetch: c, supportsReferrerPolicy: function () {
                            if (!c()) return !1;
                            try {
                                return new Request("pickleRick", {referrerPolicy: "origin"}), !0
                            } catch (e) {
                                return !1
                            }
                        }, supportsPromiseRejectionEvent: function () {
                            return "function" == typeof PromiseRejectionEvent
                        }, wrappedCallback: function (e) {
                            return function (t, n) {
                                var i = e(t) || t;
                                return n ? n(i) || i : i
                            }
                        }, each: d, objectMerge: function (e, t) {
                            return t ? (d(t, function (t, n) {
                                e[t] = n
                            }), e) : e
                        }, truncate: u, objectFrozen: function (e) {
                            return !!Object.isFrozen && Object.isFrozen(e)
                        }, hasKey: h, joinRegExp: f, urlencode: function (e) {
                            var t = [];
                            return d(e, function (e, n) {
                                t.push(encodeURIComponent(e) + "=" + encodeURIComponent(n))
                            }), t.join("&")
                        }, uuid4: function () {
                            var e = r.crypto || r.msCrypto;
                            if (!o(e) && e.getRandomValues) {
                                var t = new Uint16Array(8);
                                e.getRandomValues(t), t[3] = 4095 & t[3] | 16384, t[4] = 16383 & t[4] | 32768;
                                var n = function (e) {
                                    for (var t = e.toString(16); t.length < 4;) t = "0" + t;
                                    return t
                                };
                                return n(t[0]) + n(t[1]) + n(t[2]) + n(t[3]) + n(t[4]) + n(t[5]) + n(t[6]) + n(t[7])
                            }
                            return "xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g, function (e) {
                                var t = 16 * Math.random() | 0;
                                return ("x" === e ? t : 3 & t | 8).toString(16)
                            })
                        }, htmlTreeAsString: function (e) {
                            for (var t, n = [], i = 0, r = 0, o = " > ".length; e && i++ < 5 && !("html" === (t = p(e)) || i > 1 && r + n.length * o + t.length >= 80);) n.push(t), r += t.length, e = e.parentNode;
                            return n.reverse().join(" > ")
                        }, htmlElementAsString: p, isSameException: function (e, t) {
                            if (m(e, t)) return !1;
                            if (e = e.values[0], t = t.values[0], e.type !== t.type || e.value !== t.value) return !1;
                            if (n = e.stacktrace, i = t.stacktrace, o(n) && o(i)) return !1;
                            var n, i;
                            return g(e.stacktrace, t.stacktrace)
                        }, isSameStacktrace: g, parseUrl: function (e) {
                            if ("string" != typeof e) return {};
                            var t = e.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/),
                                n = t[6] || "", i = t[8] || "";
                            return {protocol: t[2], host: t[4], path: t[5], relative: t[5] + n + i}
                        }, fill: function (e, t, n, i) {
                            if (null != e) {
                                var r = e[t];
                                e[t] = n(r), e[t].__raven__ = !0, e[t].__orig__ = r, i && i.push([e, t, r])
                            }
                        }, safeJoin: function (e, t) {
                            if (!l(e)) return "";
                            for (var n = [], i = 0; i < e.length; i++) try {
                                n.push(String(e[i]))
                            } catch (e) {
                                n.push("[value cannot be serialized]")
                            }
                            return n.join(t)
                        }, serializeException: function e(t, n, r) {
                            if (!a(t)) return t;
                            r = "number" != typeof(n = "number" != typeof n ? v : n) ? y : r;
                            var o = function e(t, n) {
                                return 0 === n ? C(t) : a(t) ? Object.keys(t).reduce(function (i, r) {
                                    return i[r] = e(t[r], n - 1), i
                                }, {}) : Array.isArray(t) ? t.map(function (t) {
                                    return e(t, n - 1)
                                }) : C(t)
                            }(t, n);
                            return w(i(o)) > r ? e(t, n - 1) : o
                        }, serializeKeysForMessage: function (e, t) {
                            if ("number" == typeof e || "string" == typeof e) return e.toString();
                            if (!Array.isArray(e)) return "";
                            if (0 === (e = e.filter(function (e) {
                                return "string" == typeof e
                            })).length) return "[object has no keys]";
                            if (t = "number" != typeof t ? b : t, e[0].length >= t) return e[0];
                            for (var n = e.length; n > 0; n--) {
                                var i = e.slice(0, n).join(", ");
                                if (!(i.length > t)) return n === e.length ? i : i + "…"
                            }
                            return ""
                        }, sanitize: function (e, t) {
                            if (!l(t) || l(t) && 0 === t.length) return e;
                            var n, r = f(t), o = "********";
                            try {
                                n = JSON.parse(i(e))
                            } catch (t) {
                                return e
                            }
                            return function e(t) {
                                return l(t) ? t.map(function (t) {
                                    return e(t)
                                }) : a(t) ? Object.keys(t).reduce(function (n, i) {
                                    return r.test(i) ? n[i] = o : n[i] = e(t[i]), n
                                }, {}) : t
                            }(n)
                        }
                    }
                }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {})
            }, {7: 7}], 6: [function (e, t, n) {
                (function (n) {
                    var i = e(5), r = {collectWindowErrors: !0, debug: !1},
                        o = "undefined" != typeof window ? window : void 0 !== n ? n : "undefined" != typeof self ? self : {},
                        a = [].slice, s = "?",
                        l = /^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/;

                    function c() {
                        return "undefined" == typeof document || null == document.location ? "" : document.location.href
                    }

                    r.report = function () {
                        var e = [], t = null, n = null, d = null;

                        function u(t, n) {
                            var i = null;
                            if (!n || r.collectWindowErrors) {
                                for (var o in e) if (e.hasOwnProperty(o)) try {
                                    e[o].apply(null, [t].concat(a.call(arguments, 2)))
                                } catch (e) {
                                    i = e
                                }
                                if (i) throw i
                            }
                        }

                        var h, f;

                        function p(e, t, n, o, a) {
                            var f = i.isErrorEvent(a) ? a.error : a, p = i.isErrorEvent(e) ? e.message : e;
                            if (d) r.computeStackTrace.augmentStackTraceWithInitialElement(d, t, n, p), m(); else if (f && i.isError(f)) u(r.computeStackTrace(f), !0); else {
                                var g = {url: t, line: n, column: o}, v = void 0;
                                if ("[object String]" === {}.toString.call(p)) {
                                    var y;
                                    (y = p.match(l)) && (v = y[1], p = y[2])
                                }
                                g.func = s, u({name: v, message: p, url: c(), stack: [g]}, !0)
                            }
                            return !!h && h.apply(this, arguments)
                        }

                        function m() {
                            var e = d, i = t;
                            t = null, d = null, n = null, u.apply(null, [e, !1].concat(i))
                        }

                        function g(e, i) {
                            var o = a.call(arguments, 1);
                            if (d) {
                                if (n === e) return;
                                m()
                            }
                            var s = r.computeStackTrace(e);
                            if (d = s, n = e, t = o, setTimeout(function () {
                                n === e && m()
                            }, s.incomplete ? 2e3 : 0), !1 !== i) throw e
                        }

                        return g.subscribe = function (t) {
                            f || (h = o.onerror, o.onerror = p, f = !0), e.push(t)
                        }, g.unsubscribe = function (t) {
                            for (var n = e.length - 1; n >= 0; --n) e[n] === t && e.splice(n, 1)
                        }, g.uninstall = function () {
                            f && (o.onerror = h, f = !1, h = void 0), e = []
                        }, g
                    }(), r.computeStackTrace = function () {
                        function e(e) {
                            if (void 0 !== e.stack && e.stack) {
                                for (var t, n, i, r = /^\s*at (?:(.*?) ?\()?((?:file|https?|blob|chrome-extension|native|eval|webpack|<anonymous>|[a-z]:|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i, o = /^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx(?:-web)|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i, a = /^\s*(.*?)(?:\((.*?)\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|moz-extension).*?:\/.*?|\[native code\]|[^@]*bundle)(?::(\d+))?(?::(\d+))?\s*$/i, l = /(\S+) line (\d+)(?: > eval line \d+)* > eval/i, d = /\((\S*)(?::(\d+))(?::(\d+))\)/, u = e.stack.split("\n"), h = [], f = (/^(.*) is undefined$/.exec(e.message), 0), p = u.length; f < p; ++f) {
                                    if (n = r.exec(u[f])) {
                                        var m = n[2] && 0 === n[2].indexOf("native");
                                        n[2] && 0 === n[2].indexOf("eval") && (t = d.exec(n[2])) && (n[2] = t[1], n[3] = t[2], n[4] = t[3]), i = {
                                            url: m ? null : n[2],
                                            func: n[1] || s,
                                            args: m ? [n[2]] : [],
                                            line: n[3] ? +n[3] : null,
                                            column: n[4] ? +n[4] : null
                                        }
                                    } else if (n = o.exec(u[f])) i = {
                                        url: n[2],
                                        func: n[1] || s,
                                        args: [],
                                        line: +n[3],
                                        column: n[4] ? +n[4] : null
                                    }; else {
                                        if (!(n = a.exec(u[f]))) continue;
                                        n[3] && n[3].indexOf(" > eval") > -1 && (t = l.exec(n[3])) ? (n[3] = t[1], n[4] = t[2], n[5] = null) : 0 !== f || n[5] || void 0 === e.columnNumber || (h[0].column = e.columnNumber + 1), i = {
                                            url: n[3],
                                            func: n[1] || s,
                                            args: n[2] ? n[2].split(",") : [],
                                            line: n[4] ? +n[4] : null,
                                            column: n[5] ? +n[5] : null
                                        }
                                    }
                                    if (!i.func && i.line && (i.func = s), i.url && "blob:" === i.url.substr(0, 5)) {
                                        var g = new XMLHttpRequest;
                                        if (g.open("GET", i.url, !1), g.send(null), 200 === g.status) {
                                            var v = g.responseText || "",
                                                y = (v = v.slice(-300)).match(/\/\/# sourceMappingURL=(.*)$/);
                                            if (y) {
                                                var b = y[1];
                                                "~" === b.charAt(0) && (b = ("undefined" == typeof document || null == document.location ? "" : document.location.origin ? document.location.origin : document.location.protocol + "//" + document.location.hostname + (document.location.port ? ":" + document.location.port : "")) + b.slice(1)), i.url = b.slice(0, -4)
                                            }
                                        }
                                    }
                                    h.push(i)
                                }
                                return h.length ? {name: e.name, message: e.message, url: c(), stack: h} : null
                            }
                        }

                        function t(e, t, n, i) {
                            var r = {url: t, line: n};
                            if (r.url && r.line) {
                                if (e.incomplete = !1, r.func || (r.func = s), e.stack.length > 0 && e.stack[0].url === r.url) {
                                    if (e.stack[0].line === r.line) return !1;
                                    if (!e.stack[0].line && e.stack[0].func === r.func) return e.stack[0].line = r.line, !1
                                }
                                return e.stack.unshift(r), e.partial = !0, !0
                            }
                            return e.incomplete = !0, !1
                        }

                        function n(e, o) {
                            for (var a, l, d = /function\s+([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)?\s*\(/i, u = [], h = {}, f = !1, p = n.caller; p && !f; p = p.caller) if (p !== i && p !== r.report) {
                                if (l = {
                                    url: null,
                                    func: s,
                                    line: null,
                                    column: null
                                }, p.name ? l.func = p.name : (a = d.exec(p.toString())) && (l.func = a[1]), void 0 === l.func) try {
                                    l.func = a.input.substring(0, a.input.indexOf("{"))
                                } catch (e) {
                                }
                                h["" + p] ? f = !0 : h["" + p] = !0, u.push(l)
                            }
                            o && u.splice(0, o);
                            var m = {name: e.name, message: e.message, url: c(), stack: u};
                            return t(m, e.sourceURL || e.fileName, e.line || e.lineNumber, e.message || e.description), m
                        }

                        function i(t, i) {
                            var o = null;
                            i = null == i ? 0 : +i;
                            try {
                                if (o = e(t)) return o
                            } catch (e) {
                                if (r.debug) throw e
                            }
                            try {
                                if (o = n(t, i + 1)) return o
                            } catch (e) {
                                if (r.debug) throw e
                            }
                            return {name: t.name, message: t.message, url: c()}
                        }

                        return i.augmentStackTraceWithInitialElement = t, i.computeStackTraceFromStackProp = e, i
                    }(), t.exports = r
                }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {})
            }, {5: 5}], 7: [function (e, t, n) {
                (t.exports = function (e, t, n, i) {
                    return JSON.stringify(e, r(t, i), n)
                }).getSerialize = r;

                function i(e, t) {
                    for (var n = 0; n < e.length; ++n) if (e[n] === t) return n;
                    return -1
                }

                function r(e, t) {
                    var n = [], r = [];
                    return null == t && (t = function (e, t) {
                        return n[0] === t ? "[Circular ~]" : "[Circular ~." + r.slice(0, i(n, t)).join(".") + "]"
                    }), function (o, a) {
                        if (n.length > 0) {
                            var s = i(n, this);
                            ~s ? n.splice(s + 1) : n.push(this), ~s ? r.splice(s, 1 / 0, o) : r.push(o), ~i(n, a) && (a = t.call(this, o, a))
                        } else n.push(a);
                        return null == e ? a instanceof Error ? function (e) {
                            var t = {stack: e.stack, message: e.message, name: e.name};
                            for (var n in e) Object.prototype.hasOwnProperty.call(e, n) && (t[n] = e[n]);
                            return t
                        }(a) : a : e.call(this, o, a)
                    }
                }
            }, {}], 8: [function (e, t, n) {
                function i(e, t) {
                    var n = (65535 & e) + (65535 & t);
                    return (e >> 16) + (t >> 16) + (n >> 16) << 16 | 65535 & n
                }

                function r(e, t, n, r, o, a) {
                    return i((s = i(i(t, e), i(r, a))) << (l = o) | s >>> 32 - l, n);
                    var s, l
                }

                function o(e, t, n, i, o, a, s) {
                    return r(t & n | ~t & i, e, t, o, a, s)
                }

                function a(e, t, n, i, o, a, s) {
                    return r(t & i | n & ~i, e, t, o, a, s)
                }

                function s(e, t, n, i, o, a, s) {
                    return r(t ^ n ^ i, e, t, o, a, s)
                }

                function l(e, t, n, i, o, a, s) {
                    return r(n ^ (t | ~i), e, t, o, a, s)
                }

                function c(e, t) {
                    e[t >> 5] |= 128 << t % 32, e[14 + (t + 64 >>> 9 << 4)] = t;
                    var n, r, c, d, u, h = 1732584193, f = -271733879, p = -1732584194, m = 271733878;
                    for (n = 0; n < e.length; n += 16) r = h, c = f, d = p, u = m, f = l(f = l(f = l(f = l(f = s(f = s(f = s(f = s(f = a(f = a(f = a(f = a(f = o(f = o(f = o(f = o(f, p = o(p, m = o(m, h = o(h, f, p, m, e[n], 7, -680876936), f, p, e[n + 1], 12, -389564586), h, f, e[n + 2], 17, 606105819), m, h, e[n + 3], 22, -1044525330), p = o(p, m = o(m, h = o(h, f, p, m, e[n + 4], 7, -176418897), f, p, e[n + 5], 12, 1200080426), h, f, e[n + 6], 17, -1473231341), m, h, e[n + 7], 22, -45705983), p = o(p, m = o(m, h = o(h, f, p, m, e[n + 8], 7, 1770035416), f, p, e[n + 9], 12, -1958414417), h, f, e[n + 10], 17, -42063), m, h, e[n + 11], 22, -1990404162), p = o(p, m = o(m, h = o(h, f, p, m, e[n + 12], 7, 1804603682), f, p, e[n + 13], 12, -40341101), h, f, e[n + 14], 17, -1502002290), m, h, e[n + 15], 22, 1236535329), p = a(p, m = a(m, h = a(h, f, p, m, e[n + 1], 5, -165796510), f, p, e[n + 6], 9, -1069501632), h, f, e[n + 11], 14, 643717713), m, h, e[n], 20, -373897302), p = a(p, m = a(m, h = a(h, f, p, m, e[n + 5], 5, -701558691), f, p, e[n + 10], 9, 38016083), h, f, e[n + 15], 14, -660478335), m, h, e[n + 4], 20, -405537848), p = a(p, m = a(m, h = a(h, f, p, m, e[n + 9], 5, 568446438), f, p, e[n + 14], 9, -1019803690), h, f, e[n + 3], 14, -187363961), m, h, e[n + 8], 20, 1163531501), p = a(p, m = a(m, h = a(h, f, p, m, e[n + 13], 5, -1444681467), f, p, e[n + 2], 9, -51403784), h, f, e[n + 7], 14, 1735328473), m, h, e[n + 12], 20, -1926607734), p = s(p, m = s(m, h = s(h, f, p, m, e[n + 5], 4, -378558), f, p, e[n + 8], 11, -2022574463), h, f, e[n + 11], 16, 1839030562), m, h, e[n + 14], 23, -35309556), p = s(p, m = s(m, h = s(h, f, p, m, e[n + 1], 4, -1530992060), f, p, e[n + 4], 11, 1272893353), h, f, e[n + 7], 16, -155497632), m, h, e[n + 10], 23, -1094730640), p = s(p, m = s(m, h = s(h, f, p, m, e[n + 13], 4, 681279174), f, p, e[n], 11, -358537222), h, f, e[n + 3], 16, -722521979), m, h, e[n + 6], 23, 76029189), p = s(p, m = s(m, h = s(h, f, p, m, e[n + 9], 4, -640364487), f, p, e[n + 12], 11, -421815835), h, f, e[n + 15], 16, 530742520), m, h, e[n + 2], 23, -995338651), p = l(p, m = l(m, h = l(h, f, p, m, e[n], 6, -198630844), f, p, e[n + 7], 10, 1126891415), h, f, e[n + 14], 15, -1416354905), m, h, e[n + 5], 21, -57434055), p = l(p, m = l(m, h = l(h, f, p, m, e[n + 12], 6, 1700485571), f, p, e[n + 3], 10, -1894986606), h, f, e[n + 10], 15, -1051523), m, h, e[n + 1], 21, -2054922799), p = l(p, m = l(m, h = l(h, f, p, m, e[n + 8], 6, 1873313359), f, p, e[n + 15], 10, -30611744), h, f, e[n + 6], 15, -1560198380), m, h, e[n + 13], 21, 1309151649), p = l(p, m = l(m, h = l(h, f, p, m, e[n + 4], 6, -145523070), f, p, e[n + 11], 10, -1120210379), h, f, e[n + 2], 15, 718787259), m, h, e[n + 9], 21, -343485551), h = i(h, r), f = i(f, c), p = i(p, d), m = i(m, u);
                    return [h, f, p, m]
                }

                function d(e) {
                    var t, n = "", i = 32 * e.length;
                    for (t = 0; t < i; t += 8) n += String.fromCharCode(e[t >> 5] >>> t % 32 & 255);
                    return n
                }

                function u(e) {
                    var t, n = [];
                    for (n[(e.length >> 2) - 1] = void 0, t = 0; t < n.length; t += 1) n[t] = 0;
                    var i = 8 * e.length;
                    for (t = 0; t < i; t += 8) n[t >> 5] |= (255 & e.charCodeAt(t / 8)) << t % 32;
                    return n
                }

                function h(e) {
                    var t, n, i = "";
                    for (n = 0; n < e.length; n += 1) t = e.charCodeAt(n), i += "0123456789abcdef".charAt(t >>> 4 & 15) + "0123456789abcdef".charAt(15 & t);
                    return i
                }

                function f(e) {
                    return unescape(encodeURIComponent(e))
                }

                function p(e) {
                    return d(c(u(t = f(e)), 8 * t.length));
                    var t
                }

                function m(e, t) {
                    return function (e, t) {
                        var n, i, r = u(e), o = [], a = [];
                        for (o[15] = a[15] = void 0, r.length > 16 && (r = c(r, 8 * e.length)), n = 0; n < 16; n += 1) o[n] = 909522486 ^ r[n], a[n] = 1549556828 ^ r[n];
                        return i = c(o.concat(u(t)), 512 + 8 * t.length), d(c(a.concat(i), 640))
                    }(f(e), f(t))
                }

                t.exports = function (e, t, n) {
                    return t ? n ? m(t, e) : h(m(t, e)) : n ? p(e) : h(p(e))
                }
            }, {}]
        }, {}, [4])(4)
    }), $__System.registerDynamic("31", ["50", "13", "28"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i = e("50"), r = e("13"), o = e("28"), a = window.reqnode ? reqnode("electron").remote : null, s = {
            NSChangeDone: 0,
            NSChangeUndone: 1,
            NSChangeCleared: 2,
            NSChangeReadOtherContents: 3,
            NSChangeAutosaved: 4,
            NSChangeRedone: 5,
            NodeSaveFailed: -1
        }, l = function () {
            this.doneStack = [], this.undoneStack = [], this.curState = [s.NSChangeAutosaved, new Date - 0], this.lastSaved = this.curState[1]
        };
        l.prototype.isDocumentEdited = function () {
            return !this.curState
        }, l.prototype.clone = function () {
            return {
                doneStack: this.doneStack.clone(),
                undoneStack: this.undoneStack.clone(),
                curState: this.curState,
                lastSaved: this.lastSaved
            }
        }, l.prototype.reset = function (e) {
            this.doneStack = e ? e.doneStack : [], this.undoneStack = e ? e.undoneStack : [], this.curState = e ? e.curState : [s.NSChangeAutosaved, new Date - 0], this.lastSaved = e ? e.lastSaved : this.curState[1]
        }, l.prototype.isDiscardableUntitled = function () {
            return !(File.isDocumentEdited() || File.filePath)
        }, l.prototype.updateChangeCount = function (e) {
            var t, n = this.curState;
            switch (File.fileHasModified = File.filePath || !0, e) {
                case s.NSChangeDone:
                    this.curState && this.curState[0] === s.NSChangeAutosaved && (this.doneStack.push(this.curState), this.curState = null), this.doneStack.push([e]), this.doneStack.length > 200 && this.doneStack.splice(0, this.doneStack.length - 200), this.undoneStack = [];
                    break;
                case s.NSChangeUndone:
                    for (this.curState && this.curState[0] === s.NSChangeAutosaved && (this.undoneStack.push(this.curState), this.curState = null), this.doneStack.pop(), this.undoneStack.push([e]); (t = this.doneStack.last()) && t && t[0] === s.NSChangeAutosaved;) this.doneStack.pop(), this.lastSaved === t[1] && (this.curState = t);
                    break;
                case s.NSChangeRedone:
                    for (this.curState && this.curState[0] === s.NSChangeAutosaved && (this.doneStack.push(this.curState), this.curState = null), this.undoneStack.pop(), this.doneStack.push([e]); (t = this.undoneStack.last()) && t && t[0] === s.NSChangeAutosaved;) this.undoneStack.pop(), this.lastSaved === t[1] && (this.curState = t);
                    break;
                case s.NSChangeCleared:
                    this.doneStack = [], this.undoneStack = [], this.curState = [s.NSChangeAutosaved, new Date - 0], this.lastSaved = this.curState[1];
                    break;
                case s.NodeSaveFailed:
                    this.curState && (this.lastSaved = null, this.curState = null);
                    break;
                case s.NSChangeAutosaved:
                    if (this.curState) return;
                    this.curState = [s.NSChangeAutosaved, new Date - 0], this.lastSaved = this.curState[1];
                    break;
                case s.NSChangeReadOtherContents:
                    for (var i = [], r = [], o = 0; o < this.doneStack.length; o++) this.doneStack[o][0] !== s.NSChangeAutosaved && i.push(this.doneStack[o]);
                    for (o = 0; o < this.undoneStack.length; o++) this.undoneStack[o][0] !== s.NSChangeAutosaved && r.push(this.undoneStack[o]);
                    this.doneStack = i, this.undoneStack = r, this.curState = null
            }
            n !== this.curState && File.isNodeHtml && c()
        };
        var c = function () {
            if (File.changeCounter) if (File.changeCounter.curState) {
                if ((File.filePath || File.fileName) && File.isNode) {
                    (e = a.getCurrentWindow()).setTitle(e.getTitle().replace(/•? - Typora$/, " - Typora"))
                }
                document.querySelector("#title-text").classList.remove("title-modified"), document.querySelector("#m-saved").parentElement.classList.add("saved")
            } else {
                if (document.querySelector("#title-text").classList.add("title-modified"), File.isNode) {
                    var e;
                    (e = a.getCurrentWindow()).setTitle(e.getTitle().replace(/•? - Typora$/, "• - Typora"))
                }
                document.querySelector("#m-saved").parentElement.classList.remove("saved")
            }
        };
        t.showExportDialog = function (e, t, n, i, s) {
            var l = a.getCurrentWindow(), c = (a.app, File.getSuggestedFileName()), d = a.dialog,
                u = reqnode("electron").ipcRenderer;
            c = c + "." + (e = e || "md");
            var h = $.isFunction(t) ? t : function (a) {
                var s = i || function (e) {
                    e && (o.getDialog($.localize.getString("Error"), $.localize.getString("Failed to export file to <em>{0}</em>", "Panel").format(r.escape(a)), !0, "error-dialog").modal({backdrop: "static"}), console.sendError(e))
                }, l = t;
                a && File.fs.writeFile(a, l, n, s), u.send("countly_add_event", {
                    key: "export",
                    segmentation: {format: e}
                })
            };
            d.showSaveDialog(l, {
                properties: ["saveFile"],
                title: $.localize.getString("Save", "Menu"),
                defaultPath: c,
                filters: s ? [{
                    name: e.toUpperCase(),
                    extensions: [e]
                }, {name: $.localize.getString("All Files", "Panel"), extensions: []}] : []
            }, h)
        };
        t.showSaveDialog = function (e, t) {
            var n = a.getCurrentWindow(), i = a.app, r = File.getFilePathUseNode(), o = a.dialog;
            r || (r = function (e) {
                try {
                    return (File.mountFolder_ || e.getPath("documents")) + "/" + File.getSuggestedFileName() + ".md"
                } catch (e) {
                }
                try {
                    return (File.mountFolder_ || e.getPath("desktop")) + "/" + File.getSuggestedFileName() + ".md"
                } catch (e) {
                }
            }(i)), o.showSaveDialog(n, {
                properties: ["saveFile"],
                title: d(r) || File.getSuggestedFileName(),
                defaultPath: r,
                filters: [{
                    name: $.localize.getString("Markdown File", "Panel"),
                    extensions: ["md", "markdown", "mmd", "mdown"]
                }, {
                    name: $.localize.getString("Plain Text File", "Panel"),
                    extensions: ["txt", "text", ""]
                }, {name: $.localize.getString("All Files", "Panel"), extensions: []}]
            }, function (r) {
                if (r) {
                    i.setPath("documents", reqnode("path").dirname(r));
                    try {
                        File.fs.writeFileSync(r, File.editor.getMarkdown(), "utf8")
                    } catch (e) {
                        return console.sendError(e), void alert($.localize.getString("Save File Failed", "Panel") + "\n" + e.stack)
                    }
                    i.getDocumentController().getDocument(r) || (i.getDocumentController().getDocumentFromWindowId(n.id).rename(r), File.FileInfoPanel.setFileTitle(r), File.updateChangeCount(File.ChangeType.NSChangeAutosaved)), e && e()
                } else t && t()
            })
        };
        var d = function (e) {
            return (e = e && e.replace(/\\/g, "/").replace(/\/$/, "")) && e.substring(e.lastIndexOf("/") + 1)
        }, u = function () {
            return File.isMac ? app.document.currentFilePath() : File.isNode ? File.filePath || "" : ""
        }, h = null, f = function (e, t) {
            if (File.inSavingProcess) setTimeout(function () {
                File.inSavingProcess && (File.inSavingProcess = !1, File.updateChangeCount(File.ChangeType.NodeSaveFailed)), f(e)
            }, 500); else if (File.unsupported) e(); else {
                var n = File.getCurrentDocByNode();
                if (File.fileHasModified && File.changeCounter.isDocumentEdited() && n.windows.size <= 1) {
                    if (t && (File.option.enableAutoSave || File.option.saveFileOnSwitch) && File.filePath) return File.buildDocumentSnap(), void File.saveUseNode(e);
                    File.backupWindow();
                    var i = o.getDialog($.localize.getString("Save", "Menu"), $.localize.getString("Do you want to save the changes made to this document ?<br> Your changes will be lost if you don't save them.", "Panel"), !0, "three-way-dialog", $.localize.getString("Save", "Menu"), $.localize.getString(File.path ? "Discard Changes" : "Discard", "Panel"));
                    i.modal({
                        backdrop: !1,
                        keyboard: !0
                    }), i.off("click", "#three-way-dialog-yes-btn").off("click", "#three-way-dialog-no-btn").one("click", "#three-way-dialog-yes-btn", function () {
                        i.modal("hide"), File.buildDocumentSnap(), File.saveUseNode(e)
                    }).one("click", "#three-way-dialog-no-btn", function () {
                        i.modal("hide"), File.buildDocumentSnap(), n.setLastSync(-1), e()
                    })
                } else e()
            }
        }, p = ["", "md", "markdown", "mmd", "text", "txt", "mdown"], m = function (e) {
            return !(!e || "." == e[0]) && ~p.indexOf(g(e).toLowerCase())
        }, g = function (e) {
            return (e.split(/[\/\\]/).last().match(/\.([^.]+)$/) || [])[1] || ""
        };
        !function () {
            function e() {
                File.option.copyMarkdownByDefault = !0, window.ClientCommand.selectAll(), setTimeout(function () {
                    window.ClientCommand.copy(), setTimeout(function () {
                        File.editor.EditHelper.showNotification("Context copied to clipboard.")
                    }, 500)
                }, 500)
            }

            $("#save-error-banner").on("click", ".btn", e).on("click", "#trigger-save-error-dialog", function () {
                $("#save-error-dialog").modal("show"), $("#save-error-banner").hide()
            }), $("#save-error-dialog").on("click", ".btn-primary", e).on("hidden.bs.modal", function () {
                $("#save-error-banner").show()
            })
        }();
        var v = function () {
            this.sendInterval = -1, this.lastSend = 0, this.install()
        };
        v.prototype.isEnabled = function () {
            return File && File.option && File.option.sendAnonymousUsage
        }, v.prototype.record = function (e) {
            try {
                if (!e) return;
                "string" == typeof e && (e = {message: e}), e.fromApp = !0, i.captureBreadcrumb(e)
            } catch (e) {
            }
        }, v.prototype.error = function (e, t) {
            "string" == typeof e ? i.captureMessage(e, t) : i.captureException(e, t)
        }, v.prototype.sanitizeDom = function (e) {
            var t = "<dom>";
            return e ? (e.nodeType !== e.ELEMENT_NODE ? t += "[nodeType=" + e.nodeType + "]" : (t += e.tagName, e.getAttribute("cid") && (t += "[cid=" + e.getAttribute("cid") + "]", t += "[type=" + e.getAttribute("mdtype") + "]", t += "[class=" + e.getAttribute("class") + "]")), t) : t + "null"
        }, v.prototype.sanitizeData = function (e) {
            if (e) {
                var t = e.stacktrace || [];
                ((e.exception || {}).values || []).forEach(function (e, n) {
                    e && (e.value && (e.value = e.value.replace(/([^\\\/\s]+[\\\/]){3,}[^\s'"]+['"]*/g, "{filepath}").replace(/[^\s."'{]+\.(md|mmd|markdown|txt|text)/g, "{filepath}")), e.stacktrace && e.stacktrace.frames && (t = t.concat(e.stacktrace.frames)))
                }), t.length && t.forEach(function (e) {
                    var t = -1;
                    File.isNode && (t = e.filename.lastIndexOf("resources/app")), -1 == t && (t = e.filename.lastIndexOf("TypeMark")), t > -1 && (e.filename = e.filename.substring(t).replace(/\\/g, "/").replace(/#[^.\/]*$/, "").replace("lib.asar", "lib").replace(/^(TypeMark(?:\/dist\/?)|resources\/app)\/(.+)$/, "http://typora/$2").replace(/([^\/:])(?:\/{2,})/g, "$1/"))
                })
            }
        }, v.prototype.install = function () {
            var e = this;
            var t = {
                autoBreadcrumbs: {xhr: !1, console: !1, location: !1, dom: !1},
                logger: "render",
                release: "<%= releaseHash %>" == window._releaseNo ? void 0 : window._releaseNo,
                sanitizeKeys: []
            };
            window.debugMode && (t.instrument = {tryCatch: !1}), i.config("https://d0d9715b99a0479dbe56658b193c1f5a@sentry.typora.io/2", t).install(), i.setTagsContext({
                conversation: function () {
                    var e = (new Date).getTime();
                    return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function (t) {
                        var n = (e + 16 * Math.random()) % 16 | 0;
                        return e = Math.floor(e / 16), ("x" == t ? n : 3 & n | 8).toString(16)
                    })
                }()
            }), i.setShouldSendCallback(function () {
                return !!e.isEnabled() && new Date - e.lastSend > e.sendInterval
            }), i.setDataCallback(function (t) {
                try {
                    if (e.lastSend = new Date, !t) return;
                    if (t.request && (t.request.url = "http://typora/"), t.mechanism && delete t.mechanism, t.transaction) {
                        var n = t.transaction.split(/[\/\\]/) || [];
                        t.transaction = n.last().replace(/[#][^.\/]*$/, ""), n.length >= 2 && (t.transaction = n[n.length - 2] + "/" + t.transaction)
                    }
                    return t.exception && e.sanitizeData(t), t
                } catch (e) {
                }
                return {}
            }), i.setBreadcrumbCallback(function (e) {
                try {
                    return !(!e.fromApp && "sentry" != e.category) && (delete e.fromApp, e)
                } catch (e) {
                }
            });
            var n = null;
            window.reqnode && (n = reqnode("electron").ipcRenderer), window.onerror = function (e, t, r, o, a) {
                n && n.send("errorInWindow", a ? a.stack : t + ":" + r + "\n" + e), a ? i.captureException(a) : i.captureMessage(t + ":" + r + "\n" + e)
            }
        };
        var y = !1;
        window.Reporter = new v, t.getFileNameFromPath = d, t.normalizePath = function (e, t) {
            return !t && /^([a-z][a-z0-9+\-]+):\/\//gi.exec(e) ? e : File.isNode ? reqnode("path").normalize(e) : app.path.normalize(e)
        }, t.getFileFolderPath = function (e) {
            return File.isNode ? reqnode("path").dirname(e) : (e = (e = (e || "").replace(/\\/g, "/")) && e.substring(0, e.lastIndexOf("/") + 1), File.isNode && "win32" == process.platform ? e.replace(/\//g, "\\") : e)
        }, t.getCurrentFilePath = u, t.getCurrentFileFolderPath = function () {
            return File.isMac ? app.document.currentFolderPath() : File.isNode && File.filePath ? reqnode("path").dirname(File.filePath) : ""
        }, t.getUnsavedDraftsPath = function () {
            return h || (h = reqnode("path").resolve(a.app.getPath("userData"), "draftsRecover"), reqnode("fs-extra").ensureDirSync(h)), h
        }, t.ChangeType = s, t.ChangeCounter = l, t.tryLeaveDocument = f, t.refreshTitlebarText = c, t.allowedExtensions = p, t.isSupportedFile = m, t.detectEncodeByNode = function (e) {
            if (r.isUTF8(e)) return "utf8";
            var t = reqnode("jschardet"), n = reqnode("iconv-lite");
            t.Constants.MINIMUM_THRESHOLD = .3;
            var i = t.detect(e).encoding || "utf8";
            return "ascii" == i.toLowerCase() && (i = "utf8"), n.encodingExists(i) || (i = i.replace(/-/g, "_")), i = n.encodingExists(i) ? i : "utf8"
        }, t.getContentFromBuffer = function (e, t) {
            return "utf8" == t || "uft16le" == t ? e.toString(t) : reqnode("iconv-lite").decode(e, t)
        }, t.statWrapper = function (e, t) {
            var n = {}, i = reqnode("path").basename(e), r = e === File.getMountFolder();
            if (!r && i && "." == i[0]) return n.shouldIgnore = !r, t(n);
            if (File.isWin) reqnode("fswin-aio").getAttributes(e, function (e) {
                if (!e) return t(null);
                n.shouldIgnore = e.IS_HIDDEN || e.IS_SYSTEM || e.IS_TEMPORARY, n.isDir = e.IS_DIRECTORY, n.isFile = !n.isDir, n.mtime = e.LAST_WRITE_TIME, n.size = e.SIZE / 1e3, n.shouldIgnore || (n.isDir ? n.shouldIgnore = "node_modules" == i : n.isFile && !n.shouldIgnore && (n.shouldIgnore = !m(i))), r && (n.shouldIgnore = !1), t(n)
            }); else {
                var o = reqnode("util");
                reqnode("fs").stat(e, function (e, a) {
                    if (e || !a) return t(null);
                    n.isDir = a.isDirectory(), n.isFile = a.isFile(), n.mtime = new Date(o.inspect(a.mtime)), n.size = a.size / 1e3, /\.asar[/\\]*$/.exec(i) && (n.isFile = !0, n.isDir = !1, n.shouldIgnore = !0), n.isDir ? n.shouldIgnore = "node_modules" == i : n.isFile && (n.shouldIgnore = n.shouldIgnore || !m(i) || 1e3 * n.size > 1e3 * File.MAX_FILE_SIZE), r && (n.shouldIgnore = !1), t(n)
                })
            }
        }, t.saveFileFailedOnNode = function () {
            $("#save-error-dialog").modal("show"), File.editor.library.hideSidebar(!0), File.lock(), File.isBroken = !0
        }, t.bindOversizePlaceholder = function () {
            File.isLinux || y || (File.isMac ? $("#ty-oversize-file-quick-look").css("display", "inline-block").on("click", function () {
                app.window.previewFile(u())
            }) : File.isWin && $("#ty-oversize-file-open-in").css("display", "inline-block").on("click", function () {
                reqnode("win-shell").openAs(File.filePath)
            }), y = !0)
        }
    }), $__System.registerDynamic("28", ["e", "12", "13", "25", "11"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i = e("e"), r = (e("12").Node, e("13"));
        e("25").map, e("11");

        function o(e) {
            for (var t = [], n = e.length, i = 0; i < n; i++) t.push(e[i]);
            return t
        }

        function a(e, t, n) {
            var r, a = e.cloneNode(!0), l = e.getBoundingClientRect(), c = window.getComputedStyle(e);
            if (e.querySelector("[*|href='#raphael-marker-block']") && !e.querySelector("#raphael-marker-block") && a.querySelector("defs").appendChild(document.querySelector("path#raphael-marker-block").cloneNode()), t && function e(t, n) {
                var i = window.getComputedStyle(t);
                ["backgroundColor", "color", "fill", "stroke", "strokeWidth", "opacity", "stroke-dasharray", "fontSize", "fontFamily", "textAnchor", "textSize", "padding", "margin"].forEach(function (e) {
                    n.style[e] = i[e]
                });
                var r = o(n.children || []);
                r.length && o(t.children || []).forEach(function (t, n) {
                    e(t, r[n])
                })
            }(e, a), a.setAttribute("height", l.bottom - l.top), a.style.color || (a.style.color = c.color), c.getPropertyValue && (r = window.getComputedStyle(document.body).backgroundColor), !a.style.background && (a.style.background = c.backgroundColor, "rgba(0, 0, 0, 0)" !== c.backgroundColor && (r = a.style.background), r)) {
                var d = r.match(/\d+/gi);
                if (d.length) {
                    (299 * d[0] + 587 * d[1] + 114 * d[2]) / 256e3 < .5 ? (a.style.background = r, i(a).find("[fill='var(--bg-color)']").attr("fill", r || "none")) : i(a).find("[fill='var(--bg-color)']").attr("fill", "white")
                }
            }
            var u = s(a.outerHTML);
            return n ? u : "data:image/svg+xml;charset=utf-8," + u
        }

        function s(e) {
            return e.replace(/xmlns:NS\d+/gi, "xmlns:xlink").replace(/NS\d+:href/gi, "xlink:href").replace(/NS\d+:space/gi, "xml:space").replace(/NS\d+:/gi, "")
        }

        var l = !1;
        var c, d = i("#ty-tooltip");
        var u, h = !1;

        function f(e, t) {
            var n = document.querySelector("#ty-enter-mode-warning-temp").innerText;
            i("#md-notification").html(n).find("[data-lg='Front']").localize("Front", i.localize.localeOption).end().find(".ty-enter-mode-warning-header").html(i.localize.getString("<strong>%@</strong> has been turned on.", "Front").replace("%@", i.localize.getString(t, "Menu"))).end().show(), h || (h = !0, i("#md-notification").on("change", "#ty-surpress-mode-warning-input", function () {
                var e = i(this).prop("checked"), t = window.app;
                File.isMac ? t.setting.put(u, e) : File.isNode && (t = reqnode("electron").remote.app).setting.put(u, e)
            }).on("click", "#ty-surpress-mode-warning-close-btn", function () {
                i("#md-notification").fadeOut()
            })), u = e
        }

        i("body").on("mouseenter", "[ty-hint]", function () {
            var e = i(this), t = i.Event("before-show-ty-hint", {cancel: !1});
            if (e.trigger(t), !t.cancel) {
                d.text(this.getAttribute("ty-hint")).addClass("shown").attr("style", ""), this.getAttribute("ty-hint-html") && d.html(this.getAttribute("ty-hint"));
                var n = this.getBoundingClientRect(), r = {left: n.left, top: n.top}, o = d[0].clientWidth,
                    a = r.left + this.clientWidth / 2;
                "right" == e.attr("ty-hint-pos") ? r.left += this.clientWidth + 4 : "left" == e.attr("ty-hint-pos") ? r.left -= this.clientWidth + 4 : (r.top > window.innerHeight / 2 ? r.top = r.top - d[0].clientHeight - 6 : r.top += n.height, o / 2 + a > window.innerWidth ? r.left = window.innerWidth - o - 4 : (r.left = a - o / 2 - 2, r.left = Math.max(2, r.left))), d.offset(r), new Date - c < 2e3 || this.getAttribute("ty-hint-instant") ? d.addClass("instant") : d.removeClass("instant")
            }
        }).on("mouseleave click", "[ty-hint]", function () {
            c = new Date, d.removeClass("shown")
        }), t.getDialog = function (e, t, n, r, o, a) {
            var s = i("#" + (r = r || "quick-dialog"));
            return s.find("#" + r + "-title").text(e), n ? s.find("#" + r + "-message").html(t) : s.find("#" + r + "-message").text(t), s.find(".btn-primary").text(o || "OK").off("click"), s.find("#three-way-dialog-no-btn").text(a || "No").off("click"), s
        }, t.replaceTag = function (e, t) {
            var n = e[0].outerHTML, r = new RegExp("<" + e[0].tagName, "i"), o = n.replace(r, "<" + t);
            r = new RegExp("</" + e[0].tagName + ">$", "i"), o = o.replace(r, "</" + t + ">");
            var a = i(o);
            return e.replaceWith(a), a
        }, t.getEditParent = function (e, t) {
            return t.getClosetBlock(!0)
        }, t.fixPopoverPosition = function (e, t, n) {
            var r, o = e.offset(), a = i(editor.sessionStr).offset().left + 10, s = i(editor.sessionStr).width(),
                l = e.find(".md-arrow");
            return (t = t || ".code-tooltip.md-hover-tip").jquery ? l = (r = t).find(".md-arrow") : r = e.find(t), e.length ? (r.css("max-width", s - 60), o.top += e.height() * (n ? 1 : 1.5) + (n ? 0 : 4), o.left += (e.width() - r.width()) / 2, o.left + r.width() > window.innerWidth - 10 ? o.left = window.innerWidth - 10 - r.width() : o.left < a && (o.left = a), r.css("position", "absolute").offset(o), !n && l.offset(function (t, n) {
                var i = {};
                return i.left = e.offset().left + e.width() / 2, i.top = n.top, i
            }), r) : (console.sendError("cannot fixPopoverPosition on empty $parent"), r.hide())
        }, t.showNotification = function (e, t) {
            var n = "<p>" + e + "<span class='btn close-btn btn-xs' aria-label='" + i.localize.getString("Close") + "'></span></p><span class='ty-icon-close-btn'><span class='ion-close-round'></span></span>";
            i("#md-notification").html(n).show().delay(8e3).fadeOut()
        }, t.resetClick = function (e) {
            var t = File.editor;
            if (l) return !(l = !1);
            if (e.target && ("CONTENT" == e.target.tagName || "HTML" == e.target.tagName)) {
                var n = e.clientX, r = e.clientY, o = document.querySelector(t.sessionStr), a = i(o).offset(),
                    s = document.createEvent("MouseEvents"), c = a.left, d = a.left + o.clientWidth, u = a.top,
                    h = a.top + o.clientHeight;
                if (n >= c && n <= d || r >= u && r <= h) return;
                if (l = !0, n = n < a.left ? a.left + 1 : a.left + o.clientWidth - 1, r = r < a.top ? a.top + 1 : a.top + o.clientHeight - 1, e.stopPropagation(), s = document.createEvent("MouseEvents"), !(o = document.elementFromPoint(n, r))) return;
                s.initMouseEvent("click", !0, !0, o.ownerDocument.defaultView, 1, e.screenX + (n - e.clientX), e.screenY + (r - e.clientY), n, r, e.ctrlKey, e.altKey, e.shiftKey, e.metaKey, e.button), o.dispatchEvent(s)
            }
        }, t.getWordCount = function (e) {
            if (0 === e.trim().length) return 0;
            var t = 0, n = ["d", e.replace(/[\u3040-\uABFF\uD7A4-\uFAFF]/gi, function (e) {
                return t++, " "
            }).replace(/(^|\s+)[(\u3000-\u303F)!-\/:-@\[-`{-~]+(\s+|$)/gm, " "), "d"].join(" ").split(/[(\u3000-\u303F)\s!-,\.\\:-@\[-`{-~]+/g).length;
            return t + n - 2
        }, t.SVG2HtmlImg = function (e) {
            if (!e) return "";
            var t = a(e, !0), n = document.createElement("img"), i = e.getBoundingClientRect();
            return n.width = i.width, n.height = i.height, n.setAttribute("src", "data:image/svg+xml;base64," + btoa(t)), n.outerHTML
        }, t.svg2DataURL = a, t.processExportedSVG = s, t.findAnchorElem = function (e, t) {
            if (e.match(/^#/)) {
                if (!t) {
                    var n = i("#write [name='" + r.escapeSelector(e.substr(1)) + "']");
                    if (n.length) return n
                }
                var o = (e.substr(1) || "").toLowerCase().trim().replace(/-/g, " ");
                return i("#write").find("h1, h2, h3, h4, h5, h6").filter(function () {
                    var e = i(this).text().toLowerCase().trim().replace(/-/g, " ");
                    return e == o || e == decodeURI(o)
                })
            }
        }, t.keyOnControl = function (e) {
            var t, n, r;

            function o() {
                var e = i(".modal-dialog:visible");
                return e.length || (e = i("#md-notification:visible")), e
            }

            if ("Tab" == e) {
                if ((t = o()).length) return r = (n = t.find("button")).index(document.activeElement), n.length ? (r = ++r >= n.length ? 0 : r, n.eq(r).focus(), !0) : void 0
            } else if ("Esc" == e) {
                var a = document.querySelector("#md-notification");
                "block" == a.style.display && i(a).fadeOut()
            } else if ("Enter" == e && document.activeElement && (document.activeElement == document.body || "DIV" == document.activeElement.tagName) && (t = o()).length) return t.find("button.btn-primary").eq(0).focus().trigger("click"), !0
        }, t.showTypeWriterModeWarning = function () {
            f("noWarnigForTypeWriterMode", "Typewriter Mode")
        }, t.showFocusModeWarning = function () {
            f("noWarnigForFocusMode", "Focus Mode")
        }
    }), $__System.registerDynamic("25", [], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i, r = {}, o = {16: !1, 18: !1, 17: !1, 91: !1}, a = "all", s = {
            "⇧": 16,
            shift: 16,
            "⌥": 18,
            alt: 18,
            option: 18,
            "⌃": 17,
            ctrl: 17,
            control: 17,
            "⌘": 91,
            command: 91
        }, l = {
            backspace: 8,
            tab: 9,
            clear: 12,
            enter: 13,
            return: 13,
            esc: 27,
            escape: 27,
            space: 32,
            left: 37,
            up: 38,
            right: 39,
            down: 40,
            del: 46,
            delete: 46,
            home: 36,
            end: 35,
            pageup: 33,
            pagedown: 34,
            ",": 188,
            ".": 190,
            "/": 191,
            "`": 192,
            "-": 189,
            "=": 187,
            ";": 186,
            "'": 222,
            "[": 219,
            "]": 221,
            "\\": 220
        }, c = function (e) {
            return l[e] || e.toUpperCase().charCodeAt(0)
        }, d = [];
        for (i = 1; i < 20; i++) l["f" + i] = 111 + i;

        function u(e, t) {
            for (var n = e.length; n--;) if (e[n] === t) return n;
            return -1
        }

        function h(e, t) {
            if (e.length != t.length) return !1;
            for (var n = 0; n < e.length; n++) if (e[n] !== t[n]) return !1;
            return !0
        }

        var f = {16: "shiftKey", 18: "altKey", 17: "ctrlKey", 91: "metaKey"};

        function p(e) {
            var t, n, a, l, c, h;
            if (t = e.keyCode, -1 == u(d, t) && d.push(t), 93 != t && 224 != t || (t = 91), t in o) {
                o[t] = !0;
                for (a in s) s[a] == t && (m[a] = !0)
            } else if (function (e) {
                for (i in o) o[i] = e[f[i]]
            }(e), m.filter.call(this, e) && t in r) for (h = g(), l = 0; l < r[t].length; l++) if ((n = r[t][l]).scope == h || "all" == n.scope) {
                c = n.mods.length > 0;
                for (a in o) (!o[a] && u(n.mods, +a) > -1 || o[a] && -1 == u(n.mods, +a)) && (c = !1);
                (0 != n.mods.length || o[16] || o[18] || o[17] || o[91]) && !c || !1 === n.method(e, n) && (e.preventDefault ? e.preventDefault() : e.returnValue = !1, e.stopPropagation && e.stopPropagation(), e.cancelBubble && (e.cancelBubble = !0))
            }
        }

        function m(e, t, n) {
            var i, o;
            i = v(e), void 0 === n && (n = t, t = "all");
            for (var a = 0; a < i.length; a++) o = [], (e = i[a].split("+")).length > 1 && (o = y(e), e = [e[e.length - 1]]), e = e[0], (e = c(e)) in r || (r[e] = []), r[e].push({
                shortcut: i[a],
                scope: t,
                method: n,
                key: i[a],
                mods: o
            })
        }

        for (i in s) m[i] = !1;

        function g() {
            return a || "all"
        }

        function v(e) {
            var t;
            return "" == (t = (e = e.replace(/\s/g, "")).split(","))[t.length - 1] && (t[t.length - 2] += ","), t
        }

        function y(e) {
            for (var t = e.slice(0, e.length - 1), n = 0; n < t.length; n++) t[n] = s[t[n]];
            return t
        }

        function b(e, t, n) {
            e.addEventListener ? e.addEventListener(t, n, !1) : e.attachEvent && e.attachEvent("on" + t, function () {
                n(window.event)
            })
        }

        b(document, "keydown", function (e) {
            p(e)
        }), b(document, "keyup", function (e) {
            var t, n = e.keyCode, i = u(d, n);
            if (i >= 0 && d.splice(i, 1), 93 != n && 224 != n || (n = 91), n in o) {
                o[n] = !1;
                for (t in s) s[t] == n && (m[t] = !1)
            }
        }), b(window, "focus", function () {
            for (i in o) o[i] = !1;
            for (i in s) m[i] = !1
        });
        var w = m;
        n.exports = w, w.setScope = function (e) {
            a = e || "all"
        }, w.getScope = g, w.deleteScope = function (e) {
            var t, n, i;
            for (t in r) for (n = r[t], i = 0; i < n.length;) n[i].scope === e ? n.splice(i, 1) : i++
        }, w.filter = function (e) {
            return !("SELECT" == (e.target || e.srcElement).tagName)
        }, w.isPressed = function (e) {
            return "string" == typeof e && (e = c(e)), -1 != u(d, e)
        }, w.getPressedKeyCodes = function () {
            return d.slice(0)
        }, w.unbind = function (e, t) {
            var n, i, o, a, s, l = [];
            for (n = v(e), a = 0; a < n.length; a++) {
                if ((i = n[a].split("+")).length > 1 && (l = y(i), e = i[i.length - 1]), e = c(e), void 0 === t && (t = g()), !r[e]) return;
                for (o in r[e]) (s = r[e][o]).scope === t && h(s.mods, l) && (r[e][o] = {})
            }
        }, void 0 !== n && (n.exports = w);
        w.map = {
            3: "Enter",
            8: "Backspace",
            9: "Tab",
            13: "Enter",
            16: "Shift",
            17: "Ctrl",
            18: "Alt",
            19: "Pause",
            20: "CapsLock",
            27: "Esc",
            32: "Space",
            33: "PageUp",
            34: "PageDown",
            35: "End",
            36: "Home",
            37: "Left",
            38: "Up",
            39: "Right",
            40: "Down",
            44: "PrintScrn",
            45: "Insert",
            46: "Delete",
            59: ";",
            91: "Command",
            107: "=",
            109: "-",
            127: "Delete",
            186: ";",
            187: "=",
            188: ",",
            189: "-",
            190: ".",
            191: "/",
            192: "`",
            219: "[",
            220: "\\",
            221: "]",
            222: "'",
            63232: "Up",
            63233: "Down",
            63234: "Left",
            63235: "Right",
            63272: "Delete",
            63273: "Home",
            63275: "End",
            63276: "PageUp",
            63277: "PageDown",
            63302: "Insert"
        }, w.functionKey = ["Command", "Ctrl", "Shift", "Alt", "Home", "End", "PageUp", "PageDown", "CapsLock", "Esc", "PrintScrn", "Insert", "Pause"], w.handleCtrlDown = function (e) {
            $(e.sessionStr + " a").attr("contenteditable", !0)
        }, w.isCommand = function (e) {
            return String.fromCharCode(e.which).length > 0 && (e.ctrlKey || e.metaKey)
        }, w.handleCtrlUp = function (e) {
            $(e.sessionStr + " a").attr("contenteditable", !1)
        }
    }), $__System.registerDynamic("3e", ["13", "11", "31", "28", "25"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i, r = e("13"), o = (e("11"), e("31")),
            a = (e("28"), e("25").map, window.reqnode ? reqnode("electron").remote : null),
            s = (r.date2NatrualLang, null), l = null, c = function (e) {
                var t = new Date;
                return i = r.formateDateOnly(new Date) + " " + (e || "untitled").replace(/\.[^.]*$/, "") + " " + r.formateTimeOnly(t, !0).replace(/:/g, "") + ".md"
            };

        function d(e) {
            try {
                var t = reqnode("fs");
                l && t.unwatchFile(l), t.watchFile(e, function (n, i) {
                    i && i.mtime == n.mtime || (t.existsSync(e) ? File.presentedItemChanged() : h())
                })
            } catch (e) {
                console.log(e)
            }
        }

        function u(e) {
            if (reqnode) {
                var t = reqnode("fs");
                if (s && (s.removeAllListeners(), s.close(), s._handle = null, s = null), l && t.unwatchFile(l), e) try {
                    (s = t.watch(e, {persistent: !1})).on("change", function (n, i) {
                        File.inSavingProcess && "rename" == n ? u(e) : "change" == n || t.existsSync(e) ? (File.presentedItemChanged(), "rename" == n && u(e)) : (u(null), h())
                    }), s.on("error", function (t) {
                        d(e), s.close(), s._handle = null, s = null
                    })
                } catch (t) {
                    d(e)
                }
            }
        }

        var h = function () {
            File.getCurrentDocByNode().switchToUntitled(), Reporter.record("current file is moved/deleted")
        };
        window.clientHanlderOnPresentationMoved = function () {
            File.isNode && (File.updateChangeCount(File.ChangeType.NSChangeReadOtherContents), u(null)), File.editor.imgEdit.onFileMoved()
        };
        var f = function (e) {
            e && window.debugMode && console.warn(e)
        }, p = function (e) {
            if (i && e) {
                var t = reqnode("fs"), n = reqnode("path"), r = o.getUnsavedDraftsPath(), a = n.resolve(r, i);
                t.stat(a, function (i, o) {
                    !i && t.rename(a, n.resolve(r, c(e)), f)
                })
            }
        }, m = function (e, t, n) {
            var r = $("#title-text"), s = a.app, l = a.getCurrentWindow(),
                d = {"File→Open File Location": {enabled: !!e}, "File→Reveal in Sidebar": {enabled: !!e}};
            if (File.isWin && (d["File→Properties"] = {enabled: !!e}), File.fileEncode = void 0, e) {
                n = o.getFileNameFromPath(e);
                File.filePath = e, File.fileName = n, File.fileEncode = t, s.getDocumentController().hasDuplicateName(n) ? (r.text(e), l.setTitle(e + " - Typora")) : (r.text(n), l.setTitle(n + " - Typora")), u(e), p(n), File.editor.library && File.editor.library.markCurrentFile()
            } else (n = n || File.fileName) ? (File.fileName = n, r.text(n), l.setTitle(n + "• - Typora")) : (r.text($.localize.getString("Untitled")), l.setTitle($.localize.getString("Untitled") + " - Typora")), File.filePath = void 0, i || c();
            o.refreshTitlebarText(), File.updateMenuToUI(d)
        };
        t.watchFileChange = u, t.onPresentationMoved = h, t.setFileTitle = m, t.saveToRecover = function (e) {
            e.trim().length && -1 == (File.filePath || "").indexOf(o.getUnsavedDraftsPath()) && reqnode("fs").writeFile(o.getUnsavedDraftsPath() + "/" + (i || c()), e, "utf8", function (e) {
                e ? f(e) : p(File.fileName || File.getSuggestedFileName())
            })
        }, t.prepareInfoPanel = function () {
            document.querySelector("#file-library").style.display = "", document.querySelector("#file-info-content").style.display = "none";

            function e(e) {
                $(".info-panel-tab.active").removeClass("active"), "file" == e ? File.editor.library.switch("files", !0) : File.editor.library.switch("outline")
            }

            $("#info-panel-tab-file").click(function () {
                e("file")
            }), $("#info-panel-tab-outline").click(function () {
                e("outline")
            })
        }
    }), $__System.registerDynamic("53", ["13", "28", "31", "3e"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i = void 0;
        if (window.reqnode) {
            var r = reqnode("child_process").spawn, o = reqnode("electron").remote, a = o.app, s = o.getCurrentWindow(),
                l = (o.BrowserWindow, o.dialog), c = e("13"), d = e("28"), u = e("31"), h = e("3e"), f = null,
                p = function (e, t, n, i) {
                    m();
                    var o = [], a = [];
                    return (f = r("pandoc", e, i)).on("close", function (e) {
                        var i = Buffer.concat(o), r = Buffer.concat(a).toString();
                        t(n, i, r, e), f = null
                    }), f.stdout.on("data", function (e) {
                        o.push(e)
                    }), f.stderr.on("data", function (e) {
                        a.push(e)
                    }), f
                }, m = function () {
                    f && f.kill && (f.removeAllListeners("close"), f.kill()), f = null
                }, g = function (e) {
                    var t = a.setting.isPandocValid();
                    if (e && void 0 !== t) return t;
                    if (t) return !0;
                    t = !0;
                    var n, i = reqnode("child_process").spawnSync("pandoc", ["--version"]);
                    if (i.error ? t = !1 : (n = (i = i.stdout.toString("utf8").split(/\r|\n|\r\n/)[0]).match(/[\d.]+/)[0], t = a.setting.compareVersion(n, "1.16") >= 0), !t && !e) {
                        var r = d.getDialog($.localize.getString("Require Pandoc to Continue...", "Panel"), $.localize.getString("Import or some export features requires <a href='http://pandoc.org/' target='_blank'>Pandoc</a> (≥ v1.16) to be installed.", "Panel"), !0, null, $.localize.getString("Follow Instructions to Install/Update Pandoc", "Panel")).modal({backdrop: !1});
                        r.find(".btn-primary").one("click", function () {
                            o.app.openFile(window.__dirname + "/Docs/Install and Use Pandoc.md", {forceCreateWindow: !0}), r.modal("hide")
                        })
                    }
                    return a.setting.setPandocValid(t), t
                };
            i = {
                prepImport: function () {
                    if (g()) {
                        var e = File.changeCounter.isDiscardableUntitled(),
                            t = e ? o.getCurrentWindow() : a.openFile("", {syncAndPrepOnly: !0}).activeWindow, n = e;
                        t.webContents.once("did-finish-load", function () {
                            n = !0
                        }), l.showOpenDialog(s, {
                            title: $.localize.getString("Import", "Menu"),
                            properties: ["openFile"],
                            filters: [{
                                name: $.localize.getString("All Supported Formats", "Panel"),
                                extensions: ["docx", "latex", "tex", "ltx", "rst", "rest", "org", "wiki", "dokuwiki", "textile", "opml", "epub"]
                            }, {name: "MS Word", extensions: ["docx"]}, {
                                name: "TeX/LaTeX",
                                extensions: ["latex", "tex", "ltx"]
                            }, {name: "reStructuredText", extensions: ["rst", "rest"]}, {
                                name: "org-mode",
                                extensions: ["org"]
                            }, {name: "Wiki", extensions: ["wiki", "dokuwiki"]}, {
                                name: "Epub",
                                extensions: ["epub"]
                            }, {name: "Textile", extensions: ["textile"]}, {name: "OPML", extensions: ["opml"]}]
                        }, function (r) {
                            if (r && r.length) {
                                var o = r[0];
                                if (e) return void i(o);
                                t.show(), n ? i(o) : t.webContents.once("did-finish-load", function () {
                                    i(o)
                                })
                            } else e || t.close()
                        })
                    }

                    function i(e) {
                        t.webContents.executeJavaScript('window.getSelection().removeAllRanges();ClientCommand.doImport("' + c.escapeInQuote(e) + '")')
                    }
                }, import: function (e) {
                    File.lock(), File.blockUI = !0, v = $("#import-process-dialog"), f = p([e, "--wrap=none", "--atx-headers", "-t", "markdown"], b, e), h.setFileTitle(null, null, u.getFileNameFromPath(e).replace(/\..+$/, "")), setTimeout(function () {
                        f && (v.modal({backdrop: "static", keyboard: !1}), v.find(".btn").one("click", function () {
                            m(), s.close()
                        }))
                    }, 200)
                }, export: function (e) {
                    if (g()) {
                        File.megaMenu.hide(), File.sync();
                        var t = [e];
                        "latex" == e ? t = ["tex", "latex"] : "wiki" == e ? t = ["wiki", "txt"] : "rst" == e ? t = ["rst", "text", "rest", "reStructuredText"] : "opml" == e ? t = ["opml", "xml"] : "textile" == e && (t = ["textile"]);
                        var n = function () {
                            try {
                                return (u.getCurrentFileFolderPath() || a.getPath("documents")) + "/" + File.getSuggestedFileName(!0) + (t ? "." + t[0] : "")
                            } catch (e) {
                            }
                            try {
                                return (u.getCurrentFileFolderPath() || a.getPath("desktop")) + "/" + File.getSuggestedFileName(!0) + (t ? "." + t[0] : "")
                            } catch (e) {
                            }
                        }();
                        l.showSaveDialog(s, {
                            title: $.localize.getString("Export to...", "Panel"),
                            defaultPath: n,
                            filters: [{name: e, extensions: t}, {
                                name: $.localize.getString("All Files", "Panel"),
                                extensions: []
                            }]
                        }, function (t) {
                            if (t) {
                                File.blockUI = !0;
                                var n = ["-f", "native", "-s", "-o", t, "-t", e];
                                "wiki" == e && (n.pop(), n.push("mediawiki"));
                                var i = new Date;
                                File.editor.export.exportToNative(e, function (e) {
                                    (f = p(n, y, t, {stdio: "pipe"})).stdin.end(e, "utf8"), v = $("#export-process-dialog");
                                    var r = Math.max(500 - new Date + i, 0);
                                    setTimeout(function () {
                                        f && (v.modal({
                                            backdrop: "static",
                                            keyboard: !1
                                        }), v.find(".btn").one("click", function () {
                                            File.blockUI = !1, m(), v.modal("hide")
                                        }))
                                    }, r)
                                }, reqnode("path").dirname(t))
                            }
                        })
                    }
                }
            };
            var v, y = function (e, t, n, i) {
                v.modal("hide"), File.blockUI = !1;
                0 !== i ? (r = n, d.getDialog($.localize.getString("Export Failed", "Panel"), $.localize.getString("Failed to export file to <em>{0}</em>").format(c.escape(e)) + "<br />" + c.escape(r.substring(0, 500)), !0, "error-dialog").modal({backdrop: "static"}), console.sendError(r)) : o.shell.showItemInFolder(e);
                var r;
                File.editor.export.cleanUpTempFiles()
            }, b = function (e, t, n, i) {
                v.modal("hide"), File.unlock(), File.blockUI = !1, t && 0 != t.length ? File.reloadContent(t.toString(), !0) : d.getDialog($.localize.getString("Import Failed", "Panel"), $.localize.getString("Failed to import file from <em>{0}</em>", "Panel").format(c.escape(e)) + "<br />" + c.escape(n), !0, "error-dialog").modal({backdrop: "static"}), File.updateChangeCount(File.ChangeType.NSChangeDone), m()
            };
            i.slientQuit = m, i.validatePandocInstall = g
        }
        n.exports = i
    }), $__System.registerDynamic("2c", [], !0, function (e, t, n) {
        this || self;
        var i, r = "http://www.w3.org/1999/xhtml", o = "undefined" == typeof document ? void 0 : document,
            a = o ? o.body || o.createElement("div") : {}, s = a.hasAttributeNS ? function (e, t, n) {
                return e.hasAttributeNS(t, n)
            } : a.hasAttribute ? function (e, t, n) {
                return e.hasAttribute(n)
            } : function (e, t, n) {
                return null != e.getAttributeNode(t, n)
            };

        function l(e, t) {
            var n = e.nodeName, i = t.nodeName;
            return n === i || !!(t.actualize && n.charCodeAt(0) < 91 && i.charCodeAt(0) > 90) && n === i.toUpperCase()
        }

        function c(e, t, n) {
            e[n] !== t[n] && (e[n] = t[n], e[n] ? e.setAttribute(n, "") : e.removeAttribute(n, ""))
        }

        var d = {
            OPTION: function (e, t) {
                c(e, t, "selected")
            }, INPUT: function (e, t) {
                c(e, t, "checked"), c(e, t, "disabled"), e.value !== t.value && (e.value = t.value), s(t, null, "value") || e.removeAttribute("value")
            }, TEXTAREA: function (e, t) {
                var n = t.value;
                e.value !== n && (e.value = n);
                var i = e.firstChild;
                if (i) {
                    var r = i.nodeValue;
                    if (r == n || !n && r == e.placeholder) return;
                    i.nodeValue = n
                }
            }, SELECT: function (e, t) {
                if (!s(t, null, "multiple")) {
                    for (var n = 0, i = t.firstChild; i;) {
                        var r = i.nodeName;
                        if (r && "OPTION" === r.toUpperCase()) {
                            if (s(i, null, "selected")) {
                                n;
                                break
                            }
                            n++
                        }
                        i = i.nextSibling
                    }
                    e.selectedIndex = n
                }
            }
        }, u = 1, h = 3, f = 8;

        function p() {
        }

        function m(e) {
            return e.id
        }

        var g, v = (g = function (e, t) {
            var n, i, r, o, a, l = t.attributes;
            for (n = l.length - 1; n >= 0; --n) r = (i = l[n]).name, o = i.namespaceURI, a = i.value, o ? (r = i.localName || r, e.getAttributeNS(o, r) !== a && e.setAttributeNS(o, r, a)) : e.getAttribute(r) !== a && e.setAttribute(r, a);
            for (n = (l = e.attributes).length - 1; n >= 0; --n) !1 !== (i = l[n]).specified && (r = i.name, (o = i.namespaceURI) ? (r = i.localName || r, s(t, o, r) || e.removeAttributeNS(o, r)) : s(t, null, r) || e.removeAttribute(r))
        }, function (e, t, n) {
            if (n || (n = {}), "string" == typeof t) if ("#document" === e.nodeName || "HTML" === e.nodeName) {
                var a = t;
                (t = o.createElement("html")).innerHTML = a
            } else t = function (e) {
                !i && o.createRange && (i = o.createRange()).selectNode(o.body);
                var t;
                return i && i.createContextualFragment ? t = i.createContextualFragment(e) : (t = o.createElement("body")).innerHTML = e, t.childNodes[0]
            }(t);
            var s, c = n.getNodeKey || m, v = n.onBeforeNodeAdded || p, y = n.onNodeAdded || p,
                b = n.onBeforeElUpdated || p, w = n.onElUpdated || p, C = n.onBeforeNodeDiscarded || p,
                x = n.onNodeDiscarded || p, k = n.onBeforeElChildrenUpdated || p, S = !0 === n.childrenOnly, E = {};

            function F(e) {
                s ? s.push(e) : s = [e]
            }

            function _(e, t, n) {
                !1 !== C(e) && (t && t.removeChild(e), x(e), function e(t, n) {
                    if (t.nodeType === u) for (var i = t.firstChild; i;) {
                        var r = void 0;
                        n && (r = c(i)) ? F(r) : (x(i), i.firstChild && e(i, n)), i = i.nextSibling
                    }
                }(e, n))
            }

            !function e(t) {
                if (t.nodeType === u) for (var n = t.firstChild; n;) {
                    var i = c(n);
                    i && (E[i] = n), e(n), n = n.nextSibling
                }
            }(e);

            function T(e) {
                y(e);
                for (var t = e.firstChild; t;) {
                    var n = t.nextSibling, i = c(t);
                    if (i) {
                        var r = E[i];
                        r && l(t, r) && (t.parentNode.replaceChild(r, t), M(r, t))
                    }
                    T(t), t = n
                }
            }

            function M(n, i, r) {
                var a, s = c(i);
                if (s && delete E[s], !t.isSameNode || !t.isSameNode(e)) {
                    if (!r) {
                        if (!1 === b(n, i)) return;
                        if (g(n, i), w(n), !1 === k(n, i)) return
                    }
                    if ("TEXTAREA" !== n.nodeName) {
                        var p, m, y, C, x = i.firstChild, S = n.firstChild;
                        e:for (; x;) {
                            for (y = x.nextSibling, p = c(x); S;) {
                                if (m = S.nextSibling, x.isSameNode && x.isSameNode(S)) {
                                    x = y, S = m;
                                    continue e
                                }
                                a = c(S);
                                var A = S.nodeType, N = void 0;
                                if (A === x.nodeType && (A === u ? (p ? p !== a && ((C = E[p]) ? S.nextSibling === C ? N = !1 : (n.insertBefore(C, S), m = S.nextSibling, a ? F(a) : _(S, n, !0), S = C) : N = !1) : a && (N = !1), (N = !1 !== N && l(S, x)) && ("svg" == S.tagName && "svg" == x.tagName ? N = S.innerHTML == x.innerHTML : M(S, x))) : A !== h && A != f || (N = !0, S.nodeValue !== x.nodeValue && (S.nodeValue = x.nodeValue))), N) {
                                    x = y, S = m;
                                    continue e
                                }
                                a ? F(a) : _(S, n, !0), S = m
                            }
                            if (p && (C = E[p]) && l(C, x)) n.appendChild(C), M(C, x); else {
                                var L = v(x);
                                !1 !== L && (L && (x = L), x.actualize && (x = x.actualize(n.ownerDocument || o)), n.appendChild(x), T(x))
                            }
                            x = y, S = m
                        }
                        for (; S;) m = S.nextSibling, (a = c(S)) ? F(a) : _(S, n, !0), S = m
                    }
                    var R = d[n.nodeName];
                    R && R(n, i)
                }
            }

            var A = e, N = A.nodeType, L = t.nodeType;
            if (!S) if (N === u) L === u ? l(e, t) || (x(e), A = function (e, t) {
                for (var n = e.firstChild; n;) {
                    var i = n.nextSibling;
                    t.appendChild(n), n = i
                }
                return t
            }(e, (R = t.nodeName, D = t.namespaceURI, D && D !== r ? o.createElementNS(D, R) : o.createElement(R)))) : A = t; else if (N === h || N === f) {
                if (L === N) return A.nodeValue !== t.nodeValue && (A.nodeValue = t.nodeValue), A;
                A = t
            }
            var R, D;
            if (A === t) x(e); else if (M(A, t, S), s) for (var O = 0, I = s.length; O < I; O++) {
                var P = E[s[O]];
                P && _(P, P.parentNode, !1)
            }
            return !S && A !== e && e.parentNode && (A.actualize && (A = A.actualize(e.ownerDocument || o)), e.parentNode.replaceChild(A, e)), A
        });
        n.exports = v
    }), function (e, t) {
        "use strict";
        "object" == typeof module && "object" == typeof module.exports ? module.exports = e.document ? t(e, !0) : function (e) {
            if (!e.document) throw new Error("jQuery requires a window with a document");
            return t(e)
        } : t(e)
    }("undefined" != typeof window ? window : this, function (e, t) {
        "use strict";
        var n = [], i = e.document, r = Object.getPrototypeOf, o = n.slice, a = n.concat, s = n.push, l = n.indexOf,
            c = {}, d = c.toString, u = c.hasOwnProperty, h = u.toString, f = h.call(Object), p = {}, m = function (e) {
                return "function" == typeof e && "number" != typeof e.nodeType
            }, g = function (e) {
                return null != e && e === e.window
            }, v = {type: !0, src: !0, noModule: !0};

        function y(e, t, n) {
            var r, o = (t = t || i).createElement("script");
            if (o.text = e, n) for (r in v) n[r] && (o[r] = n[r]);
            t.head.appendChild(o).parentNode.removeChild(o)
        }

        function b(e) {
            return null == e ? e + "" : "object" == typeof e || "function" == typeof e ? c[d.call(e)] || "object" : typeof e
        }

        var w = function (e, t) {
            return new w.fn.init(e, t)
        }, C = /^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;
        w.fn = w.prototype = {
            jquery: "3.3.1", constructor: w, length: 0, toArray: function () {
                return o.call(this)
            }, get: function (e) {
                return null == e ? o.call(this) : e < 0 ? this[e + this.length] : this[e]
            }, pushStack: function (e) {
                var t = w.merge(this.constructor(), e);
                return t.prevObject = this, t
            }, each: function (e) {
                return w.each(this, e)
            }, map: function (e) {
                return this.pushStack(w.map(this, function (t, n) {
                    return e.call(t, n, t)
                }))
            }, slice: function () {
                return this.pushStack(o.apply(this, arguments))
            }, first: function () {
                return this.eq(0)
            }, last: function () {
                return this.eq(-1)
            }, eq: function (e) {
                var t = this.length, n = +e + (e < 0 ? t : 0);
                return this.pushStack(n >= 0 && n < t ? [this[n]] : [])
            }, end: function () {
                return this.prevObject || this.constructor()
            }, push: s, sort: n.sort, splice: n.splice
        }, w.extend = w.fn.extend = function () {
            var e, t, n, i, r, o, a = arguments[0] || {}, s = 1, l = arguments.length, c = !1;
            for ("boolean" == typeof a && (c = a, a = arguments[s] || {}, s++), "object" == typeof a || m(a) || (a = {}), s === l && (a = this, s--); s < l; s++) if (null != (e = arguments[s])) for (t in e) n = a[t], a !== (i = e[t]) && (c && i && (w.isPlainObject(i) || (r = Array.isArray(i))) ? (r ? (r = !1, o = n && Array.isArray(n) ? n : []) : o = n && w.isPlainObject(n) ? n : {}, a[t] = w.extend(c, o, i)) : void 0 !== i && (a[t] = i));
            return a
        }, w.extend({
            expando: "jQuery" + ("3.3.1" + Math.random()).replace(/\D/g, ""),
            isReady: !0,
            error: function (e) {
                throw new Error(e)
            },
            noop: function () {
            },
            isPlainObject: function (e) {
                var t, n;
                return !(!e || "[object Object]" !== d.call(e) || (t = r(e)) && ("function" != typeof(n = u.call(t, "constructor") && t.constructor) || h.call(n) !== f))
            },
            isEmptyObject: function (e) {
                var t;
                for (t in e) return !1;
                return !0
            },
            globalEval: function (e) {
                y(e)
            },
            each: function (e, t) {
                var n, i = 0;
                if (x(e)) for (n = e.length; i < n && !1 !== t.call(e[i], i, e[i]); i++) ; else for (i in e) if (!1 === t.call(e[i], i, e[i])) break;
                return e
            },
            trim: function (e) {
                return null == e ? "" : (e + "").replace(C, "")
            },
            makeArray: function (e, t) {
                var n = t || [];
                return null != e && (x(Object(e)) ? w.merge(n, "string" == typeof e ? [e] : e) : s.call(n, e)), n
            },
            inArray: function (e, t, n) {
                return null == t ? -1 : l.call(t, e, n)
            },
            merge: function (e, t) {
                for (var n = +t.length, i = 0, r = e.length; i < n; i++) e[r++] = t[i];
                return e.length = r, e
            },
            grep: function (e, t, n) {
                for (var i = [], r = 0, o = e.length, a = !n; r < o; r++) !t(e[r], r) !== a && i.push(e[r]);
                return i
            },
            map: function (e, t, n) {
                var i, r, o = 0, s = [];
                if (x(e)) for (i = e.length; o < i; o++) null != (r = t(e[o], o, n)) && s.push(r); else for (o in e) null != (r = t(e[o], o, n)) && s.push(r);
                return a.apply([], s)
            },
            guid: 1,
            support: p
        }), "function" == typeof Symbol && (w.fn[Symbol.iterator] = n[Symbol.iterator]), w.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "), function (e, t) {
            c["[object " + t + "]"] = t.toLowerCase()
        });

        function x(e) {
            var t = !!e && "length" in e && e.length, n = b(e);
            return !m(e) && !g(e) && ("array" === n || 0 === t || "number" == typeof t && t > 0 && t - 1 in e)
        }

        var k = function (e) {
            var t, n, i, r, o, a, s, l, c, d, u, h, f, p, m, g, v, y, b, w = "sizzle" + 1 * new Date, C = e.document,
                x = 0, k = 0, S = ae(), E = ae(), F = ae(), _ = function (e, t) {
                    return e === t && (u = !0), 0
                }, T = {}.hasOwnProperty, M = [], A = M.pop, N = M.push, L = M.push, R = M.slice, D = function (e, t) {
                    for (var n = 0, i = e.length; n < i; n++) if (e[n] === t) return n;
                    return -1
                },
                O = "checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",
                I = "[\\x20\\t\\r\\n\\f]", P = "(?:\\\\.|[\\w-]|[^\0-\\xa0])+",
                B = "\\[" + I + "*(" + P + ")(?:" + I + "*([*^$|!~]?=)" + I + "*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|(" + P + "))|)" + I + "*\\]",
                $ = ":(" + P + ")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|" + B + ")*)|.*)\\)|)",
                H = new RegExp(I + "+", "g"), U = new RegExp("^" + I + "+|((?:^|[^\\\\])(?:\\\\.)*)" + I + "+$", "g"),
                j = new RegExp("^" + I + "*," + I + "*"), W = new RegExp("^" + I + "*([>+~]|" + I + ")" + I + "*"),
                q = new RegExp("=" + I + "*([^\\]'\"]*?)" + I + "*\\]", "g"), z = new RegExp($),
                V = new RegExp("^" + P + "$"), K = {
                    ID: new RegExp("^#(" + P + ")"),
                    CLASS: new RegExp("^\\.(" + P + ")"),
                    TAG: new RegExp("^(" + P + "|[*])"),
                    ATTR: new RegExp("^" + B),
                    PSEUDO: new RegExp("^" + $),
                    CHILD: new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\(" + I + "*(even|odd|(([+-]|)(\\d*)n|)" + I + "*(?:([+-]|)" + I + "*(\\d+)|))" + I + "*\\)|)", "i"),
                    bool: new RegExp("^(?:" + O + ")$", "i"),
                    needsContext: new RegExp("^" + I + "*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\(" + I + "*((?:-\\d)?\\d*)" + I + "*\\)|)(?=[^-]|$)", "i")
                }, Y = /^(?:input|select|textarea|button)$/i, Q = /^h\d$/i, G = /^[^{]+\{\s*\[native \w/,
                J = /^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/, X = /[+~]/,
                Z = new RegExp("\\\\([\\da-f]{1,6}" + I + "?|(" + I + ")|.)", "ig"), ee = function (e, t, n) {
                    var i = "0x" + t - 65536;
                    return i != i || n ? t : i < 0 ? String.fromCharCode(i + 65536) : String.fromCharCode(i >> 10 | 55296, 1023 & i | 56320)
                }, te = /([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g, ne = function (e, t) {
                    return t ? "\0" === e ? "�" : e.slice(0, -1) + "\\" + e.charCodeAt(e.length - 1).toString(16) + " " : "\\" + e
                }, ie = function () {
                    h()
                }, re = ye(function (e) {
                    return !0 === e.disabled && ("form" in e || "label" in e)
                }, {dir: "parentNode", next: "legend"});
            try {
                L.apply(M = R.call(C.childNodes), C.childNodes), M[C.childNodes.length].nodeType
            } catch (e) {
                L = {
                    apply: M.length ? function (e, t) {
                        N.apply(e, R.call(t))
                    } : function (e, t) {
                        for (var n = e.length, i = 0; e[n++] = t[i++];) ;
                        e.length = n - 1
                    }
                }
            }

            function oe(e, t, i, r) {
                var o, s, c, d, u, p, v, y = t && t.ownerDocument, x = t ? t.nodeType : 9;
                if (i = i || [], "string" != typeof e || !e || 1 !== x && 9 !== x && 11 !== x) return i;
                if (!r && ((t ? t.ownerDocument || t : C) !== f && h(t), t = t || f, m)) {
                    if (11 !== x && (u = J.exec(e))) if (o = u[1]) {
                        if (9 === x) {
                            if (!(c = t.getElementById(o))) return i;
                            if (c.id === o) return i.push(c), i
                        } else if (y && (c = y.getElementById(o)) && b(t, c) && c.id === o) return i.push(c), i
                    } else {
                        if (u[2]) return L.apply(i, t.getElementsByTagName(e)), i;
                        if ((o = u[3]) && n.getElementsByClassName && t.getElementsByClassName) return L.apply(i, t.getElementsByClassName(o)), i
                    }
                    if (n.qsa && !F[e + " "] && (!g || !g.test(e))) {
                        if (1 !== x) y = t, v = e; else if ("object" !== t.nodeName.toLowerCase()) {
                            for ((d = t.getAttribute("id")) ? d = d.replace(te, ne) : t.setAttribute("id", d = w), s = (p = a(e)).length; s--;) p[s] = "#" + d + " " + ve(p[s]);
                            v = p.join(","), y = X.test(e) && me(t.parentNode) || t
                        }
                        if (v) try {
                            return L.apply(i, y.querySelectorAll(v)), i
                        } catch (e) {
                        } finally {
                            d === w && t.removeAttribute("id")
                        }
                    }
                }
                return l(e.replace(U, "$1"), t, i, r)
            }

            function ae() {
                var e = [];
                return function t(n, r) {
                    return e.push(n + " ") > i.cacheLength && delete t[e.shift()], t[n + " "] = r
                }
            }

            function se(e) {
                return e[w] = !0, e
            }

            function le(e) {
                var t = f.createElement("fieldset");
                try {
                    return !!e(t)
                } catch (e) {
                    return !1
                } finally {
                    t.parentNode && t.parentNode.removeChild(t), t = null
                }
            }

            function ce(e, t) {
                for (var n = e.split("|"), r = n.length; r--;) i.attrHandle[n[r]] = t
            }

            function de(e, t) {
                var n = t && e, i = n && 1 === e.nodeType && 1 === t.nodeType && e.sourceIndex - t.sourceIndex;
                if (i) return i;
                if (n) for (; n = n.nextSibling;) if (n === t) return -1;
                return e ? 1 : -1
            }

            function ue(e) {
                return function (t) {
                    return "input" === t.nodeName.toLowerCase() && t.type === e
                }
            }

            function he(e) {
                return function (t) {
                    var n = t.nodeName.toLowerCase();
                    return ("input" === n || "button" === n) && t.type === e
                }
            }

            function fe(e) {
                return function (t) {
                    return "form" in t ? t.parentNode && !1 === t.disabled ? "label" in t ? "label" in t.parentNode ? t.parentNode.disabled === e : t.disabled === e : t.isDisabled === e || t.isDisabled !== !e && re(t) === e : t.disabled === e : "label" in t && t.disabled === e
                }
            }

            function pe(e) {
                return se(function (t) {
                    return t = +t, se(function (n, i) {
                        for (var r, o = e([], n.length, t), a = o.length; a--;) n[r = o[a]] && (n[r] = !(i[r] = n[r]))
                    })
                })
            }

            function me(e) {
                return e && void 0 !== e.getElementsByTagName && e
            }

            n = oe.support = {}, o = oe.isXML = function (e) {
                var t = e && (e.ownerDocument || e).documentElement;
                return !!t && "HTML" !== t.nodeName
            }, h = oe.setDocument = function (e) {
                var t, r, a = e ? e.ownerDocument || e : C;
                return a !== f && 9 === a.nodeType && a.documentElement ? (p = (f = a).documentElement, m = !o(f), C !== f && (r = f.defaultView) && r.top !== r && (r.addEventListener ? r.addEventListener("unload", ie, !1) : r.attachEvent && r.attachEvent("onunload", ie)), n.attributes = le(function (e) {
                    return e.className = "i", !e.getAttribute("className")
                }), n.getElementsByTagName = le(function (e) {
                    return e.appendChild(f.createComment("")), !e.getElementsByTagName("*").length
                }), n.getElementsByClassName = G.test(f.getElementsByClassName), n.getById = le(function (e) {
                    return p.appendChild(e).id = w, !f.getElementsByName || !f.getElementsByName(w).length
                }), n.getById ? (i.filter.ID = function (e) {
                    var t = e.replace(Z, ee);
                    return function (e) {
                        return e.getAttribute("id") === t
                    }
                }, i.find.ID = function (e, t) {
                    if (void 0 !== t.getElementById && m) {
                        var n = t.getElementById(e);
                        return n ? [n] : []
                    }
                }) : (i.filter.ID = function (e) {
                    var t = e.replace(Z, ee);
                    return function (e) {
                        var n = void 0 !== e.getAttributeNode && e.getAttributeNode("id");
                        return n && n.value === t
                    }
                }, i.find.ID = function (e, t) {
                    if (void 0 !== t.getElementById && m) {
                        var n, i, r, o = t.getElementById(e);
                        if (o) {
                            if ((n = o.getAttributeNode("id")) && n.value === e) return [o];
                            for (r = t.getElementsByName(e), i = 0; o = r[i++];) if ((n = o.getAttributeNode("id")) && n.value === e) return [o]
                        }
                        return []
                    }
                }), i.find.TAG = n.getElementsByTagName ? function (e, t) {
                    return void 0 !== t.getElementsByTagName ? t.getElementsByTagName(e) : n.qsa ? t.querySelectorAll(e) : void 0
                } : function (e, t) {
                    var n, i = [], r = 0, o = t.getElementsByTagName(e);
                    if ("*" === e) {
                        for (; n = o[r++];) 1 === n.nodeType && i.push(n);
                        return i
                    }
                    return o
                }, i.find.CLASS = n.getElementsByClassName && function (e, t) {
                    if (void 0 !== t.getElementsByClassName && m) return t.getElementsByClassName(e)
                }, v = [], g = [], (n.qsa = G.test(f.querySelectorAll)) && (le(function (e) {
                    p.appendChild(e).innerHTML = "<a id='" + w + "'></a><select id='" + w + "-\r\\' msallowcapture=''><option selected=''></option></select>", e.querySelectorAll("[msallowcapture^='']").length && g.push("[*^$]=" + I + "*(?:''|\"\")"), e.querySelectorAll("[selected]").length || g.push("\\[" + I + "*(?:value|" + O + ")"), e.querySelectorAll("[id~=" + w + "-]").length || g.push("~="), e.querySelectorAll(":checked").length || g.push(":checked"), e.querySelectorAll("a#" + w + "+*").length || g.push(".#.+[+~]")
                }), le(function (e) {
                    e.innerHTML = "<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";
                    var t = f.createElement("input");
                    t.setAttribute("type", "hidden"), e.appendChild(t).setAttribute("name", "D"), e.querySelectorAll("[name=d]").length && g.push("name" + I + "*[*^$|!~]?="), 2 !== e.querySelectorAll(":enabled").length && g.push(":enabled", ":disabled"), p.appendChild(e).disabled = !0, 2 !== e.querySelectorAll(":disabled").length && g.push(":enabled", ":disabled"), e.querySelectorAll("*,:x"), g.push(",.*:")
                })), (n.matchesSelector = G.test(y = p.matches || p.webkitMatchesSelector || p.mozMatchesSelector || p.oMatchesSelector || p.msMatchesSelector)) && le(function (e) {
                    n.disconnectedMatch = y.call(e, "*"), y.call(e, "[s!='']:x"), v.push("!=", $)
                }), g = g.length && new RegExp(g.join("|")), v = v.length && new RegExp(v.join("|")), t = G.test(p.compareDocumentPosition), b = t || G.test(p.contains) ? function (e, t) {
                    var n = 9 === e.nodeType ? e.documentElement : e, i = t && t.parentNode;
                    return e === i || !(!i || 1 !== i.nodeType || !(n.contains ? n.contains(i) : e.compareDocumentPosition && 16 & e.compareDocumentPosition(i)))
                } : function (e, t) {
                    if (t) for (; t = t.parentNode;) if (t === e) return !0;
                    return !1
                }, _ = t ? function (e, t) {
                    if (e === t) return u = !0, 0;
                    var i = !e.compareDocumentPosition - !t.compareDocumentPosition;
                    return i || (1 & (i = (e.ownerDocument || e) === (t.ownerDocument || t) ? e.compareDocumentPosition(t) : 1) || !n.sortDetached && t.compareDocumentPosition(e) === i ? e === f || e.ownerDocument === C && b(C, e) ? -1 : t === f || t.ownerDocument === C && b(C, t) ? 1 : d ? D(d, e) - D(d, t) : 0 : 4 & i ? -1 : 1)
                } : function (e, t) {
                    if (e === t) return u = !0, 0;
                    var n, i = 0, r = e.parentNode, o = t.parentNode, a = [e], s = [t];
                    if (!r || !o) return e === f ? -1 : t === f ? 1 : r ? -1 : o ? 1 : d ? D(d, e) - D(d, t) : 0;
                    if (r === o) return de(e, t);
                    for (n = e; n = n.parentNode;) a.unshift(n);
                    for (n = t; n = n.parentNode;) s.unshift(n);
                    for (; a[i] === s[i];) i++;
                    return i ? de(a[i], s[i]) : a[i] === C ? -1 : s[i] === C ? 1 : 0
                }, f) : f
            }, oe.matches = function (e, t) {
                return oe(e, null, null, t)
            }, oe.matchesSelector = function (e, t) {
                if ((e.ownerDocument || e) !== f && h(e), t = t.replace(q, "='$1']"), n.matchesSelector && m && !F[t + " "] && (!v || !v.test(t)) && (!g || !g.test(t))) try {
                    var i = y.call(e, t);
                    if (i || n.disconnectedMatch || e.document && 11 !== e.document.nodeType) return i
                } catch (e) {
                }
                return oe(t, f, null, [e]).length > 0
            }, oe.contains = function (e, t) {
                return (e.ownerDocument || e) !== f && h(e), b(e, t)
            }, oe.attr = function (e, t) {
                (e.ownerDocument || e) !== f && h(e);
                var r = i.attrHandle[t.toLowerCase()],
                    o = r && T.call(i.attrHandle, t.toLowerCase()) ? r(e, t, !m) : void 0;
                return void 0 !== o ? o : n.attributes || !m ? e.getAttribute(t) : (o = e.getAttributeNode(t)) && o.specified ? o.value : null
            }, oe.escape = function (e) {
                return (e + "").replace(te, ne)
            }, oe.error = function (e) {
                throw new Error("Syntax error, unrecognized expression: " + e)
            }, oe.uniqueSort = function (e) {
                var t, i = [], r = 0, o = 0;
                if (u = !n.detectDuplicates, d = !n.sortStable && e.slice(0), e.sort(_), u) {
                    for (; t = e[o++];) t === e[o] && (r = i.push(o));
                    for (; r--;) e.splice(i[r], 1)
                }
                return d = null, e
            }, r = oe.getText = function (e) {
                var t, n = "", i = 0, o = e.nodeType;
                if (o) {
                    if (1 === o || 9 === o || 11 === o) {
                        if ("string" == typeof e.textContent) return e.textContent;
                        for (e = e.firstChild; e; e = e.nextSibling) n += r(e)
                    } else if (3 === o || 4 === o) return e.nodeValue
                } else for (; t = e[i++];) n += r(t);
                return n
            }, (i = oe.selectors = {
                cacheLength: 50,
                createPseudo: se,
                match: K,
                attrHandle: {},
                find: {},
                relative: {
                    ">": {dir: "parentNode", first: !0},
                    " ": {dir: "parentNode"},
                    "+": {dir: "previousSibling", first: !0},
                    "~": {dir: "previousSibling"}
                },
                preFilter: {
                    ATTR: function (e) {
                        return e[1] = e[1].replace(Z, ee), e[3] = (e[3] || e[4] || e[5] || "").replace(Z, ee), "~=" === e[2] && (e[3] = " " + e[3] + " "), e.slice(0, 4)
                    }, CHILD: function (e) {
                        return e[1] = e[1].toLowerCase(), "nth" === e[1].slice(0, 3) ? (e[3] || oe.error(e[0]), e[4] = +(e[4] ? e[5] + (e[6] || 1) : 2 * ("even" === e[3] || "odd" === e[3])), e[5] = +(e[7] + e[8] || "odd" === e[3])) : e[3] && oe.error(e[0]), e
                    }, PSEUDO: function (e) {
                        var t, n = !e[6] && e[2];
                        return K.CHILD.test(e[0]) ? null : (e[3] ? e[2] = e[4] || e[5] || "" : n && z.test(n) && (t = a(n, !0)) && (t = n.indexOf(")", n.length - t) - n.length) && (e[0] = e[0].slice(0, t), e[2] = n.slice(0, t)), e.slice(0, 3))
                    }
                },
                filter: {
                    TAG: function (e) {
                        var t = e.replace(Z, ee).toLowerCase();
                        return "*" === e ? function () {
                            return !0
                        } : function (e) {
                            return e.nodeName && e.nodeName.toLowerCase() === t
                        }
                    }, CLASS: function (e) {
                        var t = S[e + " "];
                        return t || (t = new RegExp("(^|" + I + ")" + e + "(" + I + "|$)")) && S(e, function (e) {
                            return t.test("string" == typeof e.className && e.className || void 0 !== e.getAttribute && e.getAttribute("class") || "")
                        })
                    }, ATTR: function (e, t, n) {
                        return function (i) {
                            var r = oe.attr(i, e);
                            return null == r ? "!=" === t : !t || (r += "", "=" === t ? r === n : "!=" === t ? r !== n : "^=" === t ? n && 0 === r.indexOf(n) : "*=" === t ? n && r.indexOf(n) > -1 : "$=" === t ? n && r.slice(-n.length) === n : "~=" === t ? (" " + r.replace(H, " ") + " ").indexOf(n) > -1 : "|=" === t && (r === n || r.slice(0, n.length + 1) === n + "-"))
                        }
                    }, CHILD: function (e, t, n, i, r) {
                        var o = "nth" !== e.slice(0, 3), a = "last" !== e.slice(-4), s = "of-type" === t;
                        return 1 === i && 0 === r ? function (e) {
                            return !!e.parentNode
                        } : function (t, n, l) {
                            var c, d, u, h, f, p, m = o !== a ? "nextSibling" : "previousSibling", g = t.parentNode,
                                v = s && t.nodeName.toLowerCase(), y = !l && !s, b = !1;
                            if (g) {
                                if (o) {
                                    for (; m;) {
                                        for (h = t; h = h[m];) if (s ? h.nodeName.toLowerCase() === v : 1 === h.nodeType) return !1;
                                        p = m = "only" === e && !p && "nextSibling"
                                    }
                                    return !0
                                }
                                if (p = [a ? g.firstChild : g.lastChild], a && y) {
                                    for (b = (f = (c = (d = (u = (h = g)[w] || (h[w] = {}))[h.uniqueID] || (u[h.uniqueID] = {}))[e] || [])[0] === x && c[1]) && c[2], h = f && g.childNodes[f]; h = ++f && h && h[m] || (b = f = 0) || p.pop();) if (1 === h.nodeType && ++b && h === t) {
                                        d[e] = [x, f, b];
                                        break
                                    }
                                } else if (y && (b = f = (c = (d = (u = (h = t)[w] || (h[w] = {}))[h.uniqueID] || (u[h.uniqueID] = {}))[e] || [])[0] === x && c[1]), !1 === b) for (; (h = ++f && h && h[m] || (b = f = 0) || p.pop()) && ((s ? h.nodeName.toLowerCase() !== v : 1 !== h.nodeType) || !++b || (y && ((d = (u = h[w] || (h[w] = {}))[h.uniqueID] || (u[h.uniqueID] = {}))[e] = [x, b]), h !== t));) ;
                                return (b -= r) === i || b % i == 0 && b / i >= 0
                            }
                        }
                    }, PSEUDO: function (e, t) {
                        var n,
                            r = i.pseudos[e] || i.setFilters[e.toLowerCase()] || oe.error("unsupported pseudo: " + e);
                        return r[w] ? r(t) : r.length > 1 ? (n = [e, e, "", t], i.setFilters.hasOwnProperty(e.toLowerCase()) ? se(function (e, n) {
                            for (var i, o = r(e, t), a = o.length; a--;) e[i = D(e, o[a])] = !(n[i] = o[a])
                        }) : function (e) {
                            return r(e, 0, n)
                        }) : r
                    }
                },
                pseudos: {
                    not: se(function (e) {
                        var t = [], n = [], i = s(e.replace(U, "$1"));
                        return i[w] ? se(function (e, t, n, r) {
                            for (var o, a = i(e, null, r, []), s = e.length; s--;) (o = a[s]) && (e[s] = !(t[s] = o))
                        }) : function (e, r, o) {
                            return t[0] = e, i(t, null, o, n), t[0] = null, !n.pop()
                        }
                    }), has: se(function (e) {
                        return function (t) {
                            return oe(e, t).length > 0
                        }
                    }), contains: se(function (e) {
                        return e = e.replace(Z, ee), function (t) {
                            return (t.textContent || t.innerText || r(t)).indexOf(e) > -1
                        }
                    }), lang: se(function (e) {
                        return V.test(e || "") || oe.error("unsupported lang: " + e), e = e.replace(Z, ee).toLowerCase(), function (t) {
                            var n;
                            do {
                                if (n = m ? t.lang : t.getAttribute("xml:lang") || t.getAttribute("lang")) return (n = n.toLowerCase()) === e || 0 === n.indexOf(e + "-")
                            } while ((t = t.parentNode) && 1 === t.nodeType);
                            return !1
                        }
                    }), target: function (t) {
                        var n = e.location && e.location.hash;
                        return n && n.slice(1) === t.id
                    }, root: function (e) {
                        return e === p
                    }, focus: function (e) {
                        return e === f.activeElement && (!f.hasFocus || f.hasFocus()) && !!(e.type || e.href || ~e.tabIndex)
                    }, enabled: fe(!1), disabled: fe(!0), checked: function (e) {
                        var t = e.nodeName.toLowerCase();
                        return "input" === t && !!e.checked || "option" === t && !!e.selected
                    }, selected: function (e) {
                        return e.parentNode && e.parentNode.selectedIndex, !0 === e.selected
                    }, empty: function (e) {
                        for (e = e.firstChild; e; e = e.nextSibling) if (e.nodeType < 6) return !1;
                        return !0
                    }, parent: function (e) {
                        return !i.pseudos.empty(e)
                    }, header: function (e) {
                        return Q.test(e.nodeName)
                    }, input: function (e) {
                        return Y.test(e.nodeName)
                    }, button: function (e) {
                        var t = e.nodeName.toLowerCase();
                        return "input" === t && "button" === e.type || "button" === t
                    }, text: function (e) {
                        var t;
                        return "input" === e.nodeName.toLowerCase() && "text" === e.type && (null == (t = e.getAttribute("type")) || "text" === t.toLowerCase())
                    }, first: pe(function () {
                        return [0]
                    }), last: pe(function (e, t) {
                        return [t - 1]
                    }), eq: pe(function (e, t, n) {
                        return [n < 0 ? n + t : n]
                    }), even: pe(function (e, t) {
                        for (var n = 0; n < t; n += 2) e.push(n);
                        return e
                    }), odd: pe(function (e, t) {
                        for (var n = 1; n < t; n += 2) e.push(n);
                        return e
                    }), lt: pe(function (e, t, n) {
                        for (var i = n < 0 ? n + t : n; --i >= 0;) e.push(i);
                        return e
                    }), gt: pe(function (e, t, n) {
                        for (var i = n < 0 ? n + t : n; ++i < t;) e.push(i);
                        return e
                    })
                }
            }).pseudos.nth = i.pseudos.eq;
            for (t in{radio: !0, checkbox: !0, file: !0, password: !0, image: !0}) i.pseudos[t] = ue(t);
            for (t in{submit: !0, reset: !0}) i.pseudos[t] = he(t);

            function ge() {
            }

            ge.prototype = i.filters = i.pseudos, i.setFilters = new ge, a = oe.tokenize = function (e, t) {
                var n, r, o, a, s, l, c, d = E[e + " "];
                if (d) return t ? 0 : d.slice(0);
                for (s = e, l = [], c = i.preFilter; s;) {
                    n && !(r = j.exec(s)) || (r && (s = s.slice(r[0].length) || s), l.push(o = [])), n = !1, (r = W.exec(s)) && (n = r.shift(), o.push({
                        value: n,
                        type: r[0].replace(U, " ")
                    }), s = s.slice(n.length));
                    for (a in i.filter) !(r = K[a].exec(s)) || c[a] && !(r = c[a](r)) || (n = r.shift(), o.push({
                        value: n,
                        type: a,
                        matches: r
                    }), s = s.slice(n.length));
                    if (!n) break
                }
                return t ? s.length : s ? oe.error(e) : E(e, l).slice(0)
            };

            function ve(e) {
                for (var t = 0, n = e.length, i = ""; t < n; t++) i += e[t].value;
                return i
            }

            function ye(e, t, n) {
                var i = t.dir, r = t.next, o = r || i, a = n && "parentNode" === o, s = k++;
                return t.first ? function (t, n, r) {
                    for (; t = t[i];) if (1 === t.nodeType || a) return e(t, n, r);
                    return !1
                } : function (t, n, l) {
                    var c, d, u, h = [x, s];
                    if (l) {
                        for (; t = t[i];) if ((1 === t.nodeType || a) && e(t, n, l)) return !0
                    } else for (; t = t[i];) if (1 === t.nodeType || a) if (u = t[w] || (t[w] = {}), d = u[t.uniqueID] || (u[t.uniqueID] = {}), r && r === t.nodeName.toLowerCase()) t = t[i] || t; else {
                        if ((c = d[o]) && c[0] === x && c[1] === s) return h[2] = c[2];
                        if (d[o] = h, h[2] = e(t, n, l)) return !0
                    }
                    return !1
                }
            }

            function be(e) {
                return e.length > 1 ? function (t, n, i) {
                    for (var r = e.length; r--;) if (!e[r](t, n, i)) return !1;
                    return !0
                } : e[0]
            }

            function we(e, t, n, i, r) {
                for (var o, a = [], s = 0, l = e.length, c = null != t; s < l; s++) (o = e[s]) && (n && !n(o, i, r) || (a.push(o), c && t.push(s)));
                return a
            }

            function Ce(e, t, n, i, r, o) {
                return i && !i[w] && (i = Ce(i)), r && !r[w] && (r = Ce(r, o)), se(function (o, a, s, l) {
                    var c, d, u, h = [], f = [], p = a.length, m = o || function (e, t, n) {
                            for (var i = 0, r = t.length; i < r; i++) oe(e, t[i], n);
                            return n
                        }(t || "*", s.nodeType ? [s] : s, []), g = !e || !o && t ? m : we(m, h, e, s, l),
                        v = n ? r || (o ? e : p || i) ? [] : a : g;
                    if (n && n(g, v, s, l), i) for (c = we(v, f), i(c, [], s, l), d = c.length; d--;) (u = c[d]) && (v[f[d]] = !(g[f[d]] = u));
                    if (o) {
                        if (r || e) {
                            if (r) {
                                for (c = [], d = v.length; d--;) (u = v[d]) && c.push(g[d] = u);
                                r(null, v = [], c, l)
                            }
                            for (d = v.length; d--;) (u = v[d]) && (c = r ? D(o, u) : h[d]) > -1 && (o[c] = !(a[c] = u))
                        }
                    } else v = we(v === a ? v.splice(p, v.length) : v), r ? r(null, a, v, l) : L.apply(a, v)
                })
            }

            function xe(e) {
                for (var t, n, r, o = e.length, a = i.relative[e[0].type], s = a || i.relative[" "], l = a ? 1 : 0, d = ye(function (e) {
                    return e === t
                }, s, !0), u = ye(function (e) {
                    return D(t, e) > -1
                }, s, !0), h = [function (e, n, i) {
                    var r = !a && (i || n !== c) || ((t = n).nodeType ? d(e, n, i) : u(e, n, i));
                    return t = null, r
                }]; l < o; l++) if (n = i.relative[e[l].type]) h = [ye(be(h), n)]; else {
                    if ((n = i.filter[e[l].type].apply(null, e[l].matches))[w]) {
                        for (r = ++l; r < o && !i.relative[e[r].type]; r++) ;
                        return Ce(l > 1 && be(h), l > 1 && ve(e.slice(0, l - 1).concat({value: " " === e[l - 2].type ? "*" : ""})).replace(U, "$1"), n, l < r && xe(e.slice(l, r)), r < o && xe(e = e.slice(r)), r < o && ve(e))
                    }
                    h.push(n)
                }
                return be(h)
            }

            return s = oe.compile = function (e, t) {
                var n, r = [], o = [], s = F[e + " "];
                if (!s) {
                    for (t || (t = a(e)), n = t.length; n--;) (s = xe(t[n]))[w] ? r.push(s) : o.push(s);
                    (s = F(e, function (e, t) {
                        var n = t.length > 0, r = e.length > 0, o = function (o, a, s, l, d) {
                            var u, p, g, v = 0, y = "0", b = o && [], w = [], C = c, k = o || r && i.find.TAG("*", d),
                                S = x += null == C ? 1 : Math.random() || .1, E = k.length;
                            for (d && (c = a === f || a || d); y !== E && null != (u = k[y]); y++) {
                                if (r && u) {
                                    for (p = 0, a || u.ownerDocument === f || (h(u), s = !m); g = e[p++];) if (g(u, a || f, s)) {
                                        l.push(u);
                                        break
                                    }
                                    d && (x = S)
                                }
                                n && ((u = !g && u) && v--, o && b.push(u))
                            }
                            if (v += y, n && y !== v) {
                                for (p = 0; g = t[p++];) g(b, w, a, s);
                                if (o) {
                                    if (v > 0) for (; y--;) b[y] || w[y] || (w[y] = A.call(l));
                                    w = we(w)
                                }
                                L.apply(l, w), d && !o && w.length > 0 && v + t.length > 1 && oe.uniqueSort(l)
                            }
                            return d && (x = S, c = C), b
                        };
                        return n ? se(o) : o
                    }(o, r))).selector = e
                }
                return s
            }, l = oe.select = function (e, t, n, r) {
                var o, l, c, d, u, h = "function" == typeof e && e, f = !r && a(e = h.selector || e);
                if (n = n || [], 1 === f.length) {
                    if ((l = f[0] = f[0].slice(0)).length > 2 && "ID" === (c = l[0]).type && 9 === t.nodeType && m && i.relative[l[1].type]) {
                        if (!(t = (i.find.ID(c.matches[0].replace(Z, ee), t) || [])[0])) return n;
                        h && (t = t.parentNode), e = e.slice(l.shift().value.length)
                    }
                    for (o = K.needsContext.test(e) ? 0 : l.length; o-- && (c = l[o], !i.relative[d = c.type]);) if ((u = i.find[d]) && (r = u(c.matches[0].replace(Z, ee), X.test(l[0].type) && me(t.parentNode) || t))) {
                        if (l.splice(o, 1), !(e = r.length && ve(l))) return L.apply(n, r), n;
                        break
                    }
                }
                return (h || s(e, f))(r, t, !m, n, !t || X.test(e) && me(t.parentNode) || t), n
            }, n.sortStable = w.split("").sort(_).join("") === w, n.detectDuplicates = !!u, h(), n.sortDetached = le(function (e) {
                return 1 & e.compareDocumentPosition(f.createElement("fieldset"))
            }), le(function (e) {
                return e.innerHTML = "<a href='#'></a>", "#" === e.firstChild.getAttribute("href")
            }) || ce("type|href|height|width", function (e, t, n) {
                if (!n) return e.getAttribute(t, "type" === t.toLowerCase() ? 1 : 2)
            }), n.attributes && le(function (e) {
                return e.innerHTML = "<input/>", e.firstChild.setAttribute("value", ""), "" === e.firstChild.getAttribute("value")
            }) || ce("value", function (e, t, n) {
                if (!n && "input" === e.nodeName.toLowerCase()) return e.defaultValue
            }), le(function (e) {
                return null == e.getAttribute("disabled")
            }) || ce(O, function (e, t, n) {
                var i;
                if (!n) return !0 === e[t] ? t.toLowerCase() : (i = e.getAttributeNode(t)) && i.specified ? i.value : null
            }), oe
        }(e);
        w.find = k, w.expr = k.selectors, w.expr[":"] = w.expr.pseudos, w.uniqueSort = w.unique = k.uniqueSort, w.text = k.getText, w.isXMLDoc = k.isXML, w.contains = k.contains, w.escapeSelector = k.escape;
        var S = function (e, t, n) {
            for (var i = [], r = void 0 !== n; (e = e[t]) && 9 !== e.nodeType;) if (1 === e.nodeType) {
                if (r && w(e).is(n)) break;
                i.push(e)
            }
            return i
        }, E = function (e, t) {
            for (var n = []; e; e = e.nextSibling) 1 === e.nodeType && e !== t && n.push(e);
            return n
        }, F = w.expr.match.needsContext;

        function _(e, t) {
            return e.nodeName && e.nodeName.toLowerCase() === t.toLowerCase()
        }

        var T = /^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;

        function M(e, t, n) {
            return m(t) ? w.grep(e, function (e, i) {
                return !!t.call(e, i, e) !== n
            }) : t.nodeType ? w.grep(e, function (e) {
                return e === t !== n
            }) : "string" != typeof t ? w.grep(e, function (e) {
                return l.call(t, e) > -1 !== n
            }) : w.filter(t, e, n)
        }

        w.filter = function (e, t, n) {
            var i = t[0];
            return n && (e = ":not(" + e + ")"), 1 === t.length && 1 === i.nodeType ? w.find.matchesSelector(i, e) ? [i] : [] : w.find.matches(e, w.grep(t, function (e) {
                return 1 === e.nodeType
            }))
        }, w.fn.extend({
            find: function (e) {
                var t, n, i = this.length, r = this;
                if ("string" != typeof e) return this.pushStack(w(e).filter(function () {
                    for (t = 0; t < i; t++) if (w.contains(r[t], this)) return !0
                }));
                for (n = this.pushStack([]), t = 0; t < i; t++) w.find(e, r[t], n);
                return i > 1 ? w.uniqueSort(n) : n
            }, filter: function (e) {
                return this.pushStack(M(this, e || [], !1))
            }, not: function (e) {
                return this.pushStack(M(this, e || [], !0))
            }, is: function (e) {
                return !!M(this, "string" == typeof e && F.test(e) ? w(e) : e || [], !1).length
            }
        });
        var A, N = /^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;
        (w.fn.init = function (e, t, n) {
            var r, o;
            if (!e) return this;
            if (n = n || A, "string" == typeof e) {
                if (!(r = "<" === e[0] && ">" === e[e.length - 1] && e.length >= 3 ? [null, e, null] : N.exec(e)) || !r[1] && t) return !t || t.jquery ? (t || n).find(e) : this.constructor(t).find(e);
                if (r[1]) {
                    if (t = t instanceof w ? t[0] : t, w.merge(this, w.parseHTML(r[1], t && t.nodeType ? t.ownerDocument || t : i, !0)), T.test(r[1]) && w.isPlainObject(t)) for (r in t) m(this[r]) ? this[r](t[r]) : this.attr(r, t[r]);
                    return this
                }
                return (o = i.getElementById(r[2])) && (this[0] = o, this.length = 1), this
            }
            return e.nodeType ? (this[0] = e, this.length = 1, this) : m(e) ? void 0 !== n.ready ? n.ready(e) : e(w) : w.makeArray(e, this)
        }).prototype = w.fn, A = w(i);
        var L = /^(?:parents|prev(?:Until|All))/, R = {children: !0, contents: !0, next: !0, prev: !0};
        w.fn.extend({
            has: function (e) {
                var t = w(e, this), n = t.length;
                return this.filter(function () {
                    for (var e = 0; e < n; e++) if (w.contains(this, t[e])) return !0
                })
            }, closest: function (e, t) {
                var n, i = 0, r = this.length, o = [], a = "string" != typeof e && w(e);
                if (!F.test(e)) for (; i < r; i++) for (n = this[i]; n && n !== t; n = n.parentNode) if (n.nodeType < 11 && (a ? a.index(n) > -1 : 1 === n.nodeType && w.find.matchesSelector(n, e))) {
                    o.push(n);
                    break
                }
                return this.pushStack(o.length > 1 ? w.uniqueSort(o) : o)
            }, index: function (e) {
                return e ? "string" == typeof e ? l.call(w(e), this[0]) : l.call(this, e.jquery ? e[0] : e) : this[0] && this[0].parentNode ? this.first().prevAll().length : -1
            }, add: function (e, t) {
                return this.pushStack(w.uniqueSort(w.merge(this.get(), w(e, t))))
            }, addBack: function (e) {
                return this.add(null == e ? this.prevObject : this.prevObject.filter(e))
            }
        });

        function D(e, t) {
            for (; (e = e[t]) && 1 !== e.nodeType;) ;
            return e
        }

        w.each({
            parent: function (e) {
                var t = e.parentNode;
                return t && 11 !== t.nodeType ? t : null
            }, parents: function (e) {
                return S(e, "parentNode")
            }, parentsUntil: function (e, t, n) {
                return S(e, "parentNode", n)
            }, next: function (e) {
                return D(e, "nextSibling")
            }, prev: function (e) {
                return D(e, "previousSibling")
            }, nextAll: function (e) {
                return S(e, "nextSibling")
            }, prevAll: function (e) {
                return S(e, "previousSibling")
            }, nextUntil: function (e, t, n) {
                return S(e, "nextSibling", n)
            }, prevUntil: function (e, t, n) {
                return S(e, "previousSibling", n)
            }, siblings: function (e) {
                return E((e.parentNode || {}).firstChild, e)
            }, children: function (e) {
                return E(e.firstChild)
            }, contents: function (e) {
                return _(e, "iframe") ? e.contentDocument : (_(e, "template") && (e = e.content || e), w.merge([], e.childNodes))
            }
        }, function (e, t) {
            w.fn[e] = function (n, i) {
                var r = w.map(this, t, n);
                return "Until" !== e.slice(-5) && (i = n), i && "string" == typeof i && (r = w.filter(i, r)), this.length > 1 && (R[e] || w.uniqueSort(r), L.test(e) && r.reverse()), this.pushStack(r)
            }
        });
        var O = /[^\x20\t\r\n\f]+/g;
        w.Callbacks = function (e) {
            e = "string" == typeof e ? function (e) {
                var t = {};
                return w.each(e.match(O) || [], function (e, n) {
                    t[n] = !0
                }), t
            }(e) : w.extend({}, e);
            var t, n, i, r, o = [], a = [], s = -1, l = function () {
                for (r = r || e.once, i = t = !0; a.length; s = -1) for (n = a.shift(); ++s < o.length;) !1 === o[s].apply(n[0], n[1]) && e.stopOnFalse && (s = o.length, n = !1);
                e.memory || (n = !1), t = !1, r && (o = n ? [] : "")
            }, c = {
                add: function () {
                    return o && (n && !t && (s = o.length - 1, a.push(n)), function t(n) {
                        w.each(n, function (n, i) {
                            m(i) ? e.unique && c.has(i) || o.push(i) : i && i.length && "string" !== b(i) && t(i)
                        })
                    }(arguments), n && !t && l()), this
                }, remove: function () {
                    return w.each(arguments, function (e, t) {
                        for (var n; (n = w.inArray(t, o, n)) > -1;) o.splice(n, 1), n <= s && s--
                    }), this
                }, has: function (e) {
                    return e ? w.inArray(e, o) > -1 : o.length > 0
                }, empty: function () {
                    return o && (o = []), this
                }, disable: function () {
                    return r = a = [], o = n = "", this
                }, disabled: function () {
                    return !o
                }, lock: function () {
                    return r = a = [], n || t || (o = n = ""), this
                }, locked: function () {
                    return !!r
                }, fireWith: function (e, n) {
                    return r || (n = [e, (n = n || []).slice ? n.slice() : n], a.push(n), t || l()), this
                }, fire: function () {
                    return c.fireWith(this, arguments), this
                }, fired: function () {
                    return !!i
                }
            };
            return c
        };

        function I(e) {
            return e
        }

        function P(e) {
            throw e
        }

        function B(e, t, n, i) {
            var r;
            try {
                e && m(r = e.promise) ? r.call(e).done(t).fail(n) : e && m(r = e.then) ? r.call(e, t, n) : t.apply(void 0, [e].slice(i))
            } catch (e) {
                n.apply(void 0, [e])
            }
        }

        w.extend({
            Deferred: function (t) {
                var n = [["notify", "progress", w.Callbacks("memory"), w.Callbacks("memory"), 2], ["resolve", "done", w.Callbacks("once memory"), w.Callbacks("once memory"), 0, "resolved"], ["reject", "fail", w.Callbacks("once memory"), w.Callbacks("once memory"), 1, "rejected"]],
                    i = "pending", r = {
                        state: function () {
                            return i
                        }, always: function () {
                            return o.done(arguments).fail(arguments), this
                        }, catch: function (e) {
                            return r.then(null, e)
                        }, pipe: function () {
                            var e = arguments;
                            return w.Deferred(function (t) {
                                w.each(n, function (n, i) {
                                    var r = m(e[i[4]]) && e[i[4]];
                                    o[i[1]](function () {
                                        var e = r && r.apply(this, arguments);
                                        e && m(e.promise) ? e.promise().progress(t.notify).done(t.resolve).fail(t.reject) : t[i[0] + "With"](this, r ? [e] : arguments)
                                    })
                                }), e = null
                            }).promise()
                        }, then: function (t, i, r) {
                            var o = 0;

                            function a(t, n, i, r) {
                                return function () {
                                    var s = this, l = arguments, c = function () {
                                        var e, c;
                                        if (!(t < o)) {
                                            if ((e = i.apply(s, l)) === n.promise()) throw new TypeError("Thenable self-resolution");
                                            c = e && ("object" == typeof e || "function" == typeof e) && e.then, m(c) ? r ? c.call(e, a(o, n, I, r), a(o, n, P, r)) : (o++, c.call(e, a(o, n, I, r), a(o, n, P, r), a(o, n, I, n.notifyWith))) : (i !== I && (s = void 0, l = [e]), (r || n.resolveWith)(s, l))
                                        }
                                    }, d = r ? c : function () {
                                        try {
                                            c()
                                        } catch (e) {
                                            w.Deferred.exceptionHook && w.Deferred.exceptionHook(e, d.stackTrace), t + 1 >= o && (i !== P && (s = void 0, l = [e]), n.rejectWith(s, l))
                                        }
                                    };
                                    t ? d() : (w.Deferred.getStackHook && (d.stackTrace = w.Deferred.getStackHook()), e.setTimeout(d))
                                }
                            }

                            return w.Deferred(function (e) {
                                n[0][3].add(a(0, e, m(r) ? r : I, e.notifyWith)), n[1][3].add(a(0, e, m(t) ? t : I)), n[2][3].add(a(0, e, m(i) ? i : P))
                            }).promise()
                        }, promise: function (e) {
                            return null != e ? w.extend(e, r) : r
                        }
                    }, o = {};
                return w.each(n, function (e, t) {
                    var a = t[2], s = t[5];
                    r[t[1]] = a.add, s && a.add(function () {
                        i = s
                    }, n[3 - e][2].disable, n[3 - e][3].disable, n[0][2].lock, n[0][3].lock), a.add(t[3].fire), o[t[0]] = function () {
                        return o[t[0] + "With"](this === o ? void 0 : this, arguments), this
                    }, o[t[0] + "With"] = a.fireWith
                }), r.promise(o), t && t.call(o, o), o
            }, when: function (e) {
                var t = arguments.length, n = t, i = Array(n), r = o.call(arguments), a = w.Deferred(),
                    s = function (e) {
                        return function (n) {
                            i[e] = this, r[e] = arguments.length > 1 ? o.call(arguments) : n, --t || a.resolveWith(i, r)
                        }
                    };
                if (t <= 1 && (B(e, a.done(s(n)).resolve, a.reject, !t), "pending" === a.state() || m(r[n] && r[n].then))) return a.then();
                for (; n--;) B(r[n], s(n), a.reject);
                return a.promise()
            }
        });
        var $ = /^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;
        w.Deferred.exceptionHook = function (t, n) {
            e.console && e.console.warn && t && $.test(t.name) && e.console.warn("jQuery.Deferred exception: " + t.message, t.stack, n)
        }, w.readyException = function (t) {
            e.setTimeout(function () {
                throw t
            })
        };
        var H = w.Deferred();
        w.fn.ready = function (e) {
            return H.then(e).catch(function (e) {
                w.readyException(e)
            }), this
        }, w.extend({
            isReady: !1, readyWait: 1, ready: function (e) {
                (!0 === e ? --w.readyWait : w.isReady) || (w.isReady = !0, !0 !== e && --w.readyWait > 0 || H.resolveWith(i, [w]))
            }
        }), w.ready.then = H.then;

        function U() {
            i.removeEventListener("DOMContentLoaded", U), e.removeEventListener("load", U), w.ready()
        }

        "complete" === i.readyState || "loading" !== i.readyState && !i.documentElement.doScroll ? e.setTimeout(w.ready) : (i.addEventListener("DOMContentLoaded", U), e.addEventListener("load", U));
        var j = function (e, t, n, i, r, o, a) {
            var s = 0, l = e.length, c = null == n;
            if ("object" === b(n)) {
                r = !0;
                for (s in n) j(e, t, s, n[s], !0, o, a)
            } else if (void 0 !== i && (r = !0, m(i) || (a = !0), c && (a ? (t.call(e, i), t = null) : (c = t, t = function (e, t, n) {
                return c.call(w(e), n)
            })), t)) for (; s < l; s++) t(e[s], n, a ? i : i.call(e[s], s, t(e[s], n)));
            return r ? e : c ? t.call(e) : l ? t(e[0], n) : o
        }, W = /^-ms-/, q = /-([a-z])/g;

        function z(e, t) {
            return t.toUpperCase()
        }

        function V(e) {
            return e.replace(W, "ms-").replace(q, z)
        }

        var K = function (e) {
            return 1 === e.nodeType || 9 === e.nodeType || !+e.nodeType
        };

        function Y() {
            this.expando = w.expando + Y.uid++
        }

        Y.uid = 1, Y.prototype = {
            cache: function (e) {
                var t = e[this.expando];
                return t || (t = {}, K(e) && (e.nodeType ? e[this.expando] = t : Object.defineProperty(e, this.expando, {
                    value: t,
                    configurable: !0
                }))), t
            }, set: function (e, t, n) {
                var i, r = this.cache(e);
                if ("string" == typeof t) r[V(t)] = n; else for (i in t) r[V(i)] = t[i];
                return r
            }, get: function (e, t) {
                return void 0 === t ? this.cache(e) : e[this.expando] && e[this.expando][V(t)]
            }, access: function (e, t, n) {
                return void 0 === t || t && "string" == typeof t && void 0 === n ? this.get(e, t) : (this.set(e, t, n), void 0 !== n ? n : t)
            }, remove: function (e, t) {
                var n, i = e[this.expando];
                if (void 0 !== i) {
                    if (void 0 !== t) {
                        n = (t = Array.isArray(t) ? t.map(V) : (t = V(t)) in i ? [t] : t.match(O) || []).length;
                        for (; n--;) delete i[t[n]]
                    }
                    (void 0 === t || w.isEmptyObject(i)) && (e.nodeType ? e[this.expando] = void 0 : delete e[this.expando])
                }
            }, hasData: function (e) {
                var t = e[this.expando];
                return void 0 !== t && !w.isEmptyObject(t)
            }
        };
        var Q = new Y, G = new Y, J = /^(?:\{[\w\W]*\}|\[[\w\W]*\])$/, X = /[A-Z]/g;

        function Z(e, t, n) {
            var i;
            if (void 0 === n && 1 === e.nodeType) if (i = "data-" + t.replace(X, "-$&").toLowerCase(), "string" == typeof(n = e.getAttribute(i))) {
                try {
                    n = "true" === (r = n) || "false" !== r && ("null" === r ? null : r === +r + "" ? +r : J.test(r) ? JSON.parse(r) : r)
                } catch (e) {
                }
                G.set(e, t, n)
            } else n = void 0;
            var r;
            return n
        }

        w.extend({
            hasData: function (e) {
                return G.hasData(e) || Q.hasData(e)
            }, data: function (e, t, n) {
                return G.access(e, t, n)
            }, removeData: function (e, t) {
                G.remove(e, t)
            }, _data: function (e, t, n) {
                return Q.access(e, t, n)
            }, _removeData: function (e, t) {
                Q.remove(e, t)
            }
        }), w.fn.extend({
            data: function (e, t) {
                var n, i, r, o = this[0], a = o && o.attributes;
                if (void 0 === e) {
                    if (this.length && (r = G.get(o), 1 === o.nodeType && !Q.get(o, "hasDataAttrs"))) {
                        for (n = a.length; n--;) a[n] && 0 === (i = a[n].name).indexOf("data-") && (i = V(i.slice(5)), Z(o, i, r[i]));
                        Q.set(o, "hasDataAttrs", !0)
                    }
                    return r
                }
                return "object" == typeof e ? this.each(function () {
                    G.set(this, e)
                }) : j(this, function (t) {
                    var n;
                    if (o && void 0 === t) {
                        if (void 0 !== (n = G.get(o, e))) return n;
                        if (void 0 !== (n = Z(o, e))) return n
                    } else this.each(function () {
                        G.set(this, e, t)
                    })
                }, null, t, arguments.length > 1, null, !0)
            }, removeData: function (e) {
                return this.each(function () {
                    G.remove(this, e)
                })
            }
        }), w.extend({
            queue: function (e, t, n) {
                var i;
                if (e) return t = (t || "fx") + "queue", i = Q.get(e, t), n && (!i || Array.isArray(n) ? i = Q.access(e, t, w.makeArray(n)) : i.push(n)), i || []
            }, dequeue: function (e, t) {
                t = t || "fx";
                var n = w.queue(e, t), i = n.length, r = n.shift(), o = w._queueHooks(e, t);
                "inprogress" === r && (r = n.shift(), i--), r && ("fx" === t && n.unshift("inprogress"), delete o.stop, r.call(e, function () {
                    w.dequeue(e, t)
                }, o)), !i && o && o.empty.fire()
            }, _queueHooks: function (e, t) {
                var n = t + "queueHooks";
                return Q.get(e, n) || Q.access(e, n, {
                    empty: w.Callbacks("once memory").add(function () {
                        Q.remove(e, [t + "queue", n])
                    })
                })
            }
        }), w.fn.extend({
            queue: function (e, t) {
                var n = 2;
                return "string" != typeof e && (t = e, e = "fx", n--), arguments.length < n ? w.queue(this[0], e) : void 0 === t ? this : this.each(function () {
                    var n = w.queue(this, e, t);
                    w._queueHooks(this, e), "fx" === e && "inprogress" !== n[0] && w.dequeue(this, e)
                })
            }, dequeue: function (e) {
                return this.each(function () {
                    w.dequeue(this, e)
                })
            }, clearQueue: function (e) {
                return this.queue(e || "fx", [])
            }, promise: function (e, t) {
                var n, i = 1, r = w.Deferred(), o = this, a = this.length, s = function () {
                    --i || r.resolveWith(o, [o])
                };
                for ("string" != typeof e && (t = e, e = void 0), e = e || "fx"; a--;) (n = Q.get(o[a], e + "queueHooks")) && n.empty && (i++, n.empty.add(s));
                return s(), r.promise(t)
            }
        });
        var ee = /[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,
            te = new RegExp("^(?:([+-])=|)(" + ee + ")([a-z%]*)$", "i"), ne = ["Top", "Right", "Bottom", "Left"],
            ie = function (e, t) {
                return "none" === (e = t || e).style.display || "" === e.style.display && w.contains(e.ownerDocument, e) && "none" === w.css(e, "display")
            }, re = function (e, t, n, i) {
                var r, o, a = {};
                for (o in t) a[o] = e.style[o], e.style[o] = t[o];
                r = n.apply(e, i || []);
                for (o in t) e.style[o] = a[o];
                return r
            };

        function oe(e, t, n, i) {
            var r, o, a = 20, s = i ? function () {
                    return i.cur()
                } : function () {
                    return w.css(e, t, "")
                }, l = s(), c = n && n[3] || (w.cssNumber[t] ? "" : "px"),
                d = (w.cssNumber[t] || "px" !== c && +l) && te.exec(w.css(e, t));
            if (d && d[3] !== c) {
                for (l /= 2, c = c || d[3], d = +l || 1; a--;) w.style(e, t, d + c), (1 - o) * (1 - (o = s() / l || .5)) <= 0 && (a = 0), d /= o;
                d *= 2, w.style(e, t, d + c), n = n || []
            }
            return n && (d = +d || +l || 0, r = n[1] ? d + (n[1] + 1) * n[2] : +n[2], i && (i.unit = c, i.start = d, i.end = r)), r
        }

        var ae = {};

        function se(e) {
            var t, n = e.ownerDocument, i = e.nodeName, r = ae[i];
            return r || (t = n.body.appendChild(n.createElement(i)), r = w.css(t, "display"), t.parentNode.removeChild(t), "none" === r && (r = "block"), ae[i] = r, r)
        }

        function le(e, t) {
            for (var n, i, r = [], o = 0, a = e.length; o < a; o++) (i = e[o]).style && (n = i.style.display, t ? ("none" === n && (r[o] = Q.get(i, "display") || null, r[o] || (i.style.display = "")), "" === i.style.display && ie(i) && (r[o] = se(i))) : "none" !== n && (r[o] = "none", Q.set(i, "display", n)));
            for (o = 0; o < a; o++) null != r[o] && (e[o].style.display = r[o]);
            return e
        }

        w.fn.extend({
            show: function () {
                return le(this, !0)
            }, hide: function () {
                return le(this)
            }, toggle: function (e) {
                return "boolean" == typeof e ? e ? this.show() : this.hide() : this.each(function () {
                    ie(this) ? w(this).show() : w(this).hide()
                })
            }
        });
        var ce = /^(?:checkbox|radio)$/i, de = /<([a-z][^\/\0>\x20\t\r\n\f]+)/i,
            ue = /^$|^module$|\/(?:java|ecma)script/i, he = {
                option: [1, "<select multiple='multiple'>", "</select>"],
                thead: [1, "<table>", "</table>"],
                col: [2, "<table><colgroup>", "</colgroup></table>"],
                tr: [2, "<table><tbody>", "</tbody></table>"],
                td: [3, "<table><tbody><tr>", "</tr></tbody></table>"],
                _default: [0, "", ""]
            };
        he.optgroup = he.option, he.tbody = he.tfoot = he.colgroup = he.caption = he.thead, he.th = he.td;

        function fe(e, t) {
            var n;
            return n = void 0 !== e.getElementsByTagName ? e.getElementsByTagName(t || "*") : void 0 !== e.querySelectorAll ? e.querySelectorAll(t || "*") : [], void 0 === t || t && _(e, t) ? w.merge([e], n) : n
        }

        function pe(e, t) {
            for (var n = 0, i = e.length; n < i; n++) Q.set(e[n], "globalEval", !t || Q.get(t[n], "globalEval"))
        }

        var me = /<|&#?\w+;/;

        function ge(e, t, n, i, r) {
            for (var o, a, s, l, c, d, u = t.createDocumentFragment(), h = [], f = 0, p = e.length; f < p; f++) if ((o = e[f]) || 0 === o) if ("object" === b(o)) w.merge(h, o.nodeType ? [o] : o); else if (me.test(o)) {
                for (a = a || u.appendChild(t.createElement("div")), s = (de.exec(o) || ["", ""])[1].toLowerCase(), l = he[s] || he._default, a.innerHTML = l[1] + w.htmlPrefilter(o) + l[2], d = l[0]; d--;) a = a.lastChild;
                w.merge(h, a.childNodes), (a = u.firstChild).textContent = ""
            } else h.push(t.createTextNode(o));
            for (u.textContent = "", f = 0; o = h[f++];) if (i && w.inArray(o, i) > -1) r && r.push(o); else if (c = w.contains(o.ownerDocument, o), a = fe(u.appendChild(o), "script"), c && pe(a), n) for (d = 0; o = a[d++];) ue.test(o.type || "") && n.push(o);
            return u
        }

        !function () {
            var e = i.createDocumentFragment().appendChild(i.createElement("div")), t = i.createElement("input");
            t.setAttribute("type", "radio"), t.setAttribute("checked", "checked"), t.setAttribute("name", "t"), e.appendChild(t), p.checkClone = e.cloneNode(!0).cloneNode(!0).lastChild.checked, e.innerHTML = "<textarea>x</textarea>", p.noCloneChecked = !!e.cloneNode(!0).lastChild.defaultValue
        }();
        var ve = i.documentElement, ye = /^key/, be = /^(?:mouse|pointer|contextmenu|drag|drop)|click/,
            we = /^([^.]*)(?:\.(.+)|)/;

        function Ce() {
            return !0
        }

        function xe() {
            return !1
        }

        function ke() {
            try {
                return i.activeElement
            } catch (e) {
            }
        }

        function Se(e, t, n, i, r, o) {
            var a, s;
            if ("object" == typeof t) {
                "string" != typeof n && (i = i || n, n = void 0);
                for (s in t) Se(e, s, n, i, t[s], o);
                return e
            }
            if (null == i && null == r ? (r = n, i = n = void 0) : null == r && ("string" == typeof n ? (r = i, i = void 0) : (r = i, i = n, n = void 0)), !1 === r) r = xe; else if (!r) return e;
            return 1 === o && (a = r, (r = function (e) {
                return w().off(e), a.apply(this, arguments)
            }).guid = a.guid || (a.guid = w.guid++)), e.each(function () {
                w.event.add(this, t, r, i, n)
            })
        }

        w.event = {
            global: {}, add: function (e, t, n, i, r) {
                var o, a, s, l, c, d, u, h, f, p, m, g = Q.get(e);
                if (g) for (n.handler && (n = (o = n).handler, r = o.selector), r && w.find.matchesSelector(ve, r), n.guid || (n.guid = w.guid++), (l = g.events) || (l = g.events = {}), (a = g.handle) || (a = g.handle = function (t) {
                    return void 0 !== w && w.event.triggered !== t.type ? w.event.dispatch.apply(e, arguments) : void 0
                }), c = (t = (t || "").match(O) || [""]).length; c--;) f = m = (s = we.exec(t[c]) || [])[1], p = (s[2] || "").split(".").sort(), f && (u = w.event.special[f] || {}, f = (r ? u.delegateType : u.bindType) || f, u = w.event.special[f] || {}, d = w.extend({
                    type: f,
                    origType: m,
                    data: i,
                    handler: n,
                    guid: n.guid,
                    selector: r,
                    needsContext: r && w.expr.match.needsContext.test(r),
                    namespace: p.join(".")
                }, o), (h = l[f]) || ((h = l[f] = []).delegateCount = 0, u.setup && !1 !== u.setup.call(e, i, p, a) || e.addEventListener && e.addEventListener(f, a)), u.add && (u.add.call(e, d), d.handler.guid || (d.handler.guid = n.guid)), r ? h.splice(h.delegateCount++, 0, d) : h.push(d), w.event.global[f] = !0)
            }, remove: function (e, t, n, i, r) {
                var o, a, s, l, c, d, u, h, f, p, m, g = Q.hasData(e) && Q.get(e);
                if (g && (l = g.events)) {
                    for (c = (t = (t || "").match(O) || [""]).length; c--;) if (s = we.exec(t[c]) || [], f = m = s[1], p = (s[2] || "").split(".").sort(), f) {
                        for (u = w.event.special[f] || {}, h = l[f = (i ? u.delegateType : u.bindType) || f] || [], s = s[2] && new RegExp("(^|\\.)" + p.join("\\.(?:.*\\.|)") + "(\\.|$)"), a = o = h.length; o--;) d = h[o], !r && m !== d.origType || n && n.guid !== d.guid || s && !s.test(d.namespace) || i && i !== d.selector && ("**" !== i || !d.selector) || (h.splice(o, 1), d.selector && h.delegateCount--, u.remove && u.remove.call(e, d));
                        a && !h.length && (u.teardown && !1 !== u.teardown.call(e, p, g.handle) || w.removeEvent(e, f, g.handle), delete l[f])
                    } else for (f in l) w.event.remove(e, f + t[c], n, i, !0);
                    w.isEmptyObject(l) && Q.remove(e, "handle events")
                }
            }, dispatch: function (e) {
                var t, n, i, r, o, a, s = w.event.fix(e), l = new Array(arguments.length),
                    c = (Q.get(this, "events") || {})[s.type] || [], d = w.event.special[s.type] || {};
                for (l[0] = s, t = 1; t < arguments.length; t++) l[t] = arguments[t];
                if (s.delegateTarget = this, !d.preDispatch || !1 !== d.preDispatch.call(this, s)) {
                    for (a = w.event.handlers.call(this, s, c), t = 0; (r = a[t++]) && !s.isPropagationStopped();) for (s.currentTarget = r.elem, n = 0; (o = r.handlers[n++]) && !s.isImmediatePropagationStopped();) s.rnamespace && !s.rnamespace.test(o.namespace) || (s.handleObj = o, s.data = o.data, void 0 !== (i = ((w.event.special[o.origType] || {}).handle || o.handler).apply(r.elem, l)) && !1 === (s.result = i) && (s.preventDefault(), s.stopPropagation()));
                    return d.postDispatch && d.postDispatch.call(this, s), s.result
                }
            }, handlers: function (e, t) {
                var n, i, r, o, a, s = [], l = t.delegateCount, c = e.target;
                if (l && c.nodeType && !("click" === e.type && e.button >= 1)) for (; c !== this; c = c.parentNode || this) if (1 === c.nodeType && ("click" !== e.type || !0 !== c.disabled)) {
                    for (o = [], a = {}, n = 0; n < l; n++) void 0 === a[r = (i = t[n]).selector + " "] && (a[r] = i.needsContext ? w(r, this).index(c) > -1 : w.find(r, this, null, [c]).length), a[r] && o.push(i);
                    o.length && s.push({elem: c, handlers: o})
                }
                return c = this, l < t.length && s.push({elem: c, handlers: t.slice(l)}), s
            }, addProp: function (e, t) {
                Object.defineProperty(w.Event.prototype, e, {
                    enumerable: !0, configurable: !0, get: m(t) ? function () {
                        if (this.originalEvent) return t(this.originalEvent)
                    } : function () {
                        if (this.originalEvent) return this.originalEvent[e]
                    }, set: function (t) {
                        Object.defineProperty(this, e, {enumerable: !0, configurable: !0, writable: !0, value: t})
                    }
                })
            }, fix: function (e) {
                return e[w.expando] ? e : new w.Event(e)
            }, special: {
                load: {noBubble: !0}, focus: {
                    trigger: function () {
                        if (this !== ke() && this.focus) return this.focus(), !1
                    }, delegateType: "focusin"
                }, blur: {
                    trigger: function () {
                        if (this === ke() && this.blur) return this.blur(), !1
                    }, delegateType: "focusout"
                }, click: {
                    trigger: function () {
                        if ("checkbox" === this.type && this.click && _(this, "input")) return this.click(), !1
                    }, _default: function (e) {
                        return _(e.target, "a")
                    }
                }, beforeunload: {
                    postDispatch: function (e) {
                        void 0 !== e.result && e.originalEvent && (e.originalEvent.returnValue = e.result)
                    }
                }
            }
        }, w.removeEvent = function (e, t, n) {
            e.removeEventListener && e.removeEventListener(t, n)
        }, w.Event = function (e, t) {
            if (!(this instanceof w.Event)) return new w.Event(e, t);
            e && e.type ? (this.originalEvent = e, this.type = e.type, this.isDefaultPrevented = e.defaultPrevented || void 0 === e.defaultPrevented && !1 === e.returnValue ? Ce : xe, this.target = e.target && 3 === e.target.nodeType ? e.target.parentNode : e.target, this.currentTarget = e.currentTarget, this.relatedTarget = e.relatedTarget) : this.type = e, t && w.extend(this, t), this.timeStamp = e && e.timeStamp || Date.now(), this[w.expando] = !0
        }, w.Event.prototype = {
            constructor: w.Event,
            isDefaultPrevented: xe,
            isPropagationStopped: xe,
            isImmediatePropagationStopped: xe,
            isSimulated: !1,
            preventDefault: function () {
                var e = this.originalEvent;
                this.isDefaultPrevented = Ce, e && !this.isSimulated && e.preventDefault()
            },
            stopPropagation: function () {
                var e = this.originalEvent;
                this.isPropagationStopped = Ce, e && !this.isSimulated && e.stopPropagation()
            },
            stopImmediatePropagation: function () {
                var e = this.originalEvent;
                this.isImmediatePropagationStopped = Ce, e && !this.isSimulated && e.stopImmediatePropagation(), this.stopPropagation()
            }
        }, w.each({
            altKey: !0,
            bubbles: !0,
            cancelable: !0,
            changedTouches: !0,
            ctrlKey: !0,
            detail: !0,
            eventPhase: !0,
            metaKey: !0,
            pageX: !0,
            pageY: !0,
            shiftKey: !0,
            view: !0,
            char: !0,
            charCode: !0,
            key: !0,
            keyCode: !0,
            button: !0,
            buttons: !0,
            clientX: !0,
            clientY: !0,
            offsetX: !0,
            offsetY: !0,
            pointerId: !0,
            pointerType: !0,
            screenX: !0,
            screenY: !0,
            targetTouches: !0,
            toElement: !0,
            touches: !0,
            which: function (e) {
                var t = e.button;
                return null == e.which && ye.test(e.type) ? null != e.charCode ? e.charCode : e.keyCode : !e.which && void 0 !== t && be.test(e.type) ? 1 & t ? 1 : 2 & t ? 3 : 4 & t ? 2 : 0 : e.which
            }
        }, w.event.addProp), w.each({
            mouseenter: "mouseover",
            mouseleave: "mouseout",
            pointerenter: "pointerover",
            pointerleave: "pointerout"
        }, function (e, t) {
            w.event.special[e] = {
                delegateType: t, bindType: t, handle: function (e) {
                    var n, i = e.relatedTarget, r = e.handleObj;
                    return i && (i === this || w.contains(this, i)) || (e.type = r.origType, n = r.handler.apply(this, arguments), e.type = t), n
                }
            }
        }), w.fn.extend({
            on: function (e, t, n, i) {
                return Se(this, e, t, n, i)
            }, one: function (e, t, n, i) {
                return Se(this, e, t, n, i, 1)
            }, off: function (e, t, n) {
                var i, r;
                if (e && e.preventDefault && e.handleObj) return i = e.handleObj, w(e.delegateTarget).off(i.namespace ? i.origType + "." + i.namespace : i.origType, i.selector, i.handler), this;
                if ("object" == typeof e) {
                    for (r in e) this.off(r, t, e[r]);
                    return this
                }
                return !1 !== t && "function" != typeof t || (n = t, t = void 0), !1 === n && (n = xe), this.each(function () {
                    w.event.remove(this, e, n, t)
                })
            }
        });
        var Ee = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,
            Fe = /<script|<style|<link/i, _e = /checked\s*(?:[^=]|=\s*.checked.)/i,
            Te = /^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;

        function Me(e, t) {
            return _(e, "table") && _(11 !== t.nodeType ? t : t.firstChild, "tr") ? w(e).children("tbody")[0] || e : e
        }

        function Ae(e) {
            return e.type = (null !== e.getAttribute("type")) + "/" + e.type, e
        }

        function Ne(e) {
            return "true/" === (e.type || "").slice(0, 5) ? e.type = e.type.slice(5) : e.removeAttribute("type"), e
        }

        function Le(e, t) {
            var n, i, r, o, a, s, l, c;
            if (1 === t.nodeType) {
                if (Q.hasData(e) && (o = Q.access(e), a = Q.set(t, o), c = o.events)) {
                    delete a.handle, a.events = {};
                    for (r in c) for (n = 0, i = c[r].length; n < i; n++) w.event.add(t, r, c[r][n])
                }
                G.hasData(e) && (s = G.access(e), l = w.extend({}, s), G.set(t, l))
            }
        }

        function Re(e, t) {
            var n = t.nodeName.toLowerCase();
            "input" === n && ce.test(e.type) ? t.checked = e.checked : "input" !== n && "textarea" !== n || (t.defaultValue = e.defaultValue)
        }

        function De(e, t, n, i) {
            t = a.apply([], t);
            var r, o, s, l, c, d, u = 0, h = e.length, f = h - 1, g = t[0], v = m(g);
            if (v || h > 1 && "string" == typeof g && !p.checkClone && _e.test(g)) return e.each(function (r) {
                var o = e.eq(r);
                v && (t[0] = g.call(this, r, o.html())), De(o, t, n, i)
            });
            if (h && (r = ge(t, e[0].ownerDocument, !1, e, i), o = r.firstChild, 1 === r.childNodes.length && (r = o), o || i)) {
                for (l = (s = w.map(fe(r, "script"), Ae)).length; u < h; u++) c = r, u !== f && (c = w.clone(c, !0, !0), l && w.merge(s, fe(c, "script"))), n.call(e[u], c, u);
                if (l) for (d = s[s.length - 1].ownerDocument, w.map(s, Ne), u = 0; u < l; u++) c = s[u], ue.test(c.type || "") && !Q.access(c, "globalEval") && w.contains(d, c) && (c.src && "module" !== (c.type || "").toLowerCase() ? w._evalUrl && w._evalUrl(c.src) : y(c.textContent.replace(Te, ""), d, c))
            }
            return e
        }

        function Oe(e, t, n) {
            for (var i, r = t ? w.filter(t, e) : e, o = 0; null != (i = r[o]); o++) n || 1 !== i.nodeType || w.cleanData(fe(i)), i.parentNode && (n && w.contains(i.ownerDocument, i) && pe(fe(i, "script")), i.parentNode.removeChild(i));
            return e
        }

        w.extend({
            htmlPrefilter: function (e) {
                return e.replace(Ee, "<$1></$2>")
            }, clone: function (e, t, n) {
                var i, r, o, a, s = e.cloneNode(!0), l = w.contains(e.ownerDocument, e);
                if (!(p.noCloneChecked || 1 !== e.nodeType && 11 !== e.nodeType || w.isXMLDoc(e))) for (a = fe(s), i = 0, r = (o = fe(e)).length; i < r; i++) Re(o[i], a[i]);
                if (t) if (n) for (o = o || fe(e), a = a || fe(s), i = 0, r = o.length; i < r; i++) Le(o[i], a[i]); else Le(e, s);
                return (a = fe(s, "script")).length > 0 && pe(a, !l && fe(e, "script")), s
            }, cleanData: function (e) {
                for (var t, n, i, r = w.event.special, o = 0; void 0 !== (n = e[o]); o++) if (K(n)) {
                    if (t = n[Q.expando]) {
                        if (t.events) for (i in t.events) r[i] ? w.event.remove(n, i) : w.removeEvent(n, i, t.handle);
                        n[Q.expando] = void 0
                    }
                    n[G.expando] && (n[G.expando] = void 0)
                }
            }
        }), w.fn.extend({
            detach: function (e) {
                return Oe(this, e, !0)
            }, remove: function (e) {
                return Oe(this, e)
            }, text: function (e) {
                return j(this, function (e) {
                    return void 0 === e ? w.text(this) : this.empty().each(function () {
                        1 !== this.nodeType && 11 !== this.nodeType && 9 !== this.nodeType || (this.textContent = e)
                    })
                }, null, e, arguments.length)
            }, append: function () {
                return De(this, arguments, function (e) {
                    1 !== this.nodeType && 11 !== this.nodeType && 9 !== this.nodeType || Me(this, e).appendChild(e)
                })
            }, prepend: function () {
                return De(this, arguments, function (e) {
                    if (1 === this.nodeType || 11 === this.nodeType || 9 === this.nodeType) {
                        var t = Me(this, e);
                        t.insertBefore(e, t.firstChild)
                    }
                })
            }, before: function () {
                return De(this, arguments, function (e) {
                    this.parentNode && this.parentNode.insertBefore(e, this)
                })
            }, after: function () {
                return De(this, arguments, function (e) {
                    this.parentNode && this.parentNode.insertBefore(e, this.nextSibling)
                })
            }, empty: function () {
                for (var e, t = 0; null != (e = this[t]); t++) 1 === e.nodeType && (w.cleanData(fe(e, !1)), e.textContent = "");
                return this
            }, clone: function (e, t) {
                return e = null != e && e, t = null == t ? e : t, this.map(function () {
                    return w.clone(this, e, t)
                })
            }, html: function (e) {
                return j(this, function (e) {
                    var t = this[0] || {}, n = 0, i = this.length;
                    if (void 0 === e && 1 === t.nodeType) return t.innerHTML;
                    if ("string" == typeof e && !Fe.test(e) && !he[(de.exec(e) || ["", ""])[1].toLowerCase()]) {
                        e = w.htmlPrefilter(e);
                        try {
                            for (; n < i; n++) 1 === (t = this[n] || {}).nodeType && (w.cleanData(fe(t, !1)), t.innerHTML = e);
                            t = 0
                        } catch (e) {
                        }
                    }
                    t && this.empty().append(e)
                }, null, e, arguments.length)
            }, replaceWith: function () {
                var e = [];
                return De(this, arguments, function (t) {
                    var n = this.parentNode;
                    w.inArray(this, e) < 0 && (w.cleanData(fe(this)), n && n.replaceChild(t, this))
                }, e)
            }
        }), w.each({
            appendTo: "append",
            prependTo: "prepend",
            insertBefore: "before",
            insertAfter: "after",
            replaceAll: "replaceWith"
        }, function (e, t) {
            w.fn[e] = function (e) {
                for (var n, i = [], r = w(e), o = r.length - 1, a = 0; a <= o; a++) n = a === o ? this : this.clone(!0), w(r[a])[t](n), s.apply(i, n.get());
                return this.pushStack(i)
            }
        });
        var Ie = new RegExp("^(" + ee + ")(?!px)[a-z%]+$", "i"), Pe = function (t) {
            var n = t.ownerDocument.defaultView;
            return n && n.opener || (n = e), n.getComputedStyle(t)
        }, Be = new RegExp(ne.join("|"), "i");
        !function () {
            function t() {
                if (d) {
                    c.style.cssText = "position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0", d.style.cssText = "position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%", ve.appendChild(c).appendChild(d);
                    var t = e.getComputedStyle(d);
                    r = "1%" !== t.top, l = 12 === n(t.marginLeft), d.style.right = "60%", s = 36 === n(t.right), o = 36 === n(t.width), d.style.position = "absolute", a = 36 === d.offsetWidth || "absolute", ve.removeChild(c), d = null
                }
            }

            function n(e) {
                return Math.round(parseFloat(e))
            }

            var r, o, a, s, l, c = i.createElement("div"), d = i.createElement("div");
            d.style && (d.style.backgroundClip = "content-box", d.cloneNode(!0).style.backgroundClip = "", p.clearCloneStyle = "content-box" === d.style.backgroundClip, w.extend(p, {
                boxSizingReliable: function () {
                    return t(), o
                }, pixelBoxStyles: function () {
                    return t(), s
                }, pixelPosition: function () {
                    return t(), r
                }, reliableMarginLeft: function () {
                    return t(), l
                }, scrollboxSize: function () {
                    return t(), a
                }
            }))
        }();

        function $e(e, t, n) {
            var i, r, o, a, s = e.style;
            return (n = n || Pe(e)) && ("" !== (a = n.getPropertyValue(t) || n[t]) || w.contains(e.ownerDocument, e) || (a = w.style(e, t)), !p.pixelBoxStyles() && Ie.test(a) && Be.test(t) && (i = s.width, r = s.minWidth, o = s.maxWidth, s.minWidth = s.maxWidth = s.width = a, a = n.width, s.width = i, s.minWidth = r, s.maxWidth = o)), void 0 !== a ? a + "" : a
        }

        function He(e, t) {
            return {
                get: function () {
                    if (!e()) return (this.get = t).apply(this, arguments);
                    delete this.get
                }
            }
        }

        var Ue = /^(none|table(?!-c[ea]).+)/, je = /^--/,
            We = {position: "absolute", visibility: "hidden", display: "block"},
            qe = {letterSpacing: "0", fontWeight: "400"}, ze = ["Webkit", "Moz", "ms"],
            Ve = i.createElement("div").style;

        function Ke(e) {
            var t = w.cssProps[e];
            return t || (t = w.cssProps[e] = function (e) {
                if (e in Ve) return e;
                for (var t = e[0].toUpperCase() + e.slice(1), n = ze.length; n--;) if ((e = ze[n] + t) in Ve) return e
            }(e) || e), t
        }

        function Ye(e, t, n) {
            var i = te.exec(t);
            return i ? Math.max(0, i[2] - (n || 0)) + (i[3] || "px") : t
        }

        function Qe(e, t, n, i, r, o) {
            var a = "width" === t ? 1 : 0, s = 0, l = 0;
            if (n === (i ? "border" : "content")) return 0;
            for (; a < 4; a += 2) "margin" === n && (l += w.css(e, n + ne[a], !0, r)), i ? ("content" === n && (l -= w.css(e, "padding" + ne[a], !0, r)), "margin" !== n && (l -= w.css(e, "border" + ne[a] + "Width", !0, r))) : (l += w.css(e, "padding" + ne[a], !0, r), "padding" !== n ? l += w.css(e, "border" + ne[a] + "Width", !0, r) : s += w.css(e, "border" + ne[a] + "Width", !0, r));
            return !i && o >= 0 && (l += Math.max(0, Math.ceil(e["offset" + t[0].toUpperCase() + t.slice(1)] - o - l - s - .5))), l
        }

        function Ge(e, t, n) {
            var i = Pe(e), r = $e(e, t, i), o = "border-box" === w.css(e, "boxSizing", !1, i), a = o;
            if (Ie.test(r)) {
                if (!n) return r;
                r = "auto"
            }
            return a = a && (p.boxSizingReliable() || r === e.style[t]), ("auto" === r || !parseFloat(r) && "inline" === w.css(e, "display", !1, i)) && (r = e["offset" + t[0].toUpperCase() + t.slice(1)], a = !0), (r = parseFloat(r) || 0) + Qe(e, t, n || (o ? "border" : "content"), a, i, r) + "px"
        }

        w.extend({
            cssHooks: {
                opacity: {
                    get: function (e, t) {
                        if (t) {
                            var n = $e(e, "opacity");
                            return "" === n ? "1" : n
                        }
                    }
                }
            },
            cssNumber: {
                animationIterationCount: !0,
                columnCount: !0,
                fillOpacity: !0,
                flexGrow: !0,
                flexShrink: !0,
                fontWeight: !0,
                lineHeight: !0,
                opacity: !0,
                order: !0,
                orphans: !0,
                widows: !0,
                zIndex: !0,
                zoom: !0
            },
            cssProps: {},
            style: function (e, t, n, i) {
                if (e && 3 !== e.nodeType && 8 !== e.nodeType && e.style) {
                    var r, o, a, s = V(t), l = je.test(t), c = e.style;
                    if (l || (t = Ke(s)), a = w.cssHooks[t] || w.cssHooks[s], void 0 === n) return a && "get" in a && void 0 !== (r = a.get(e, !1, i)) ? r : c[t];
                    "string" == (o = typeof n) && (r = te.exec(n)) && r[1] && (n = oe(e, t, r), o = "number"), null != n && n == n && ("number" === o && (n += r && r[3] || (w.cssNumber[s] ? "" : "px")), p.clearCloneStyle || "" !== n || 0 !== t.indexOf("background") || (c[t] = "inherit"), a && "set" in a && void 0 === (n = a.set(e, n, i)) || (l ? c.setProperty(t, n) : c[t] = n))
                }
            },
            css: function (e, t, n, i) {
                var r, o, a, s = V(t);
                return je.test(t) || (t = Ke(s)), (a = w.cssHooks[t] || w.cssHooks[s]) && "get" in a && (r = a.get(e, !0, n)), void 0 === r && (r = $e(e, t, i)), "normal" === r && t in qe && (r = qe[t]), "" === n || n ? (o = parseFloat(r), !0 === n || isFinite(o) ? o || 0 : r) : r
            }
        }), w.each(["height", "width"], function (e, t) {
            w.cssHooks[t] = {
                get: function (e, n, i) {
                    if (n) return !Ue.test(w.css(e, "display")) || e.getClientRects().length && e.getBoundingClientRect().width ? Ge(e, t, i) : re(e, We, function () {
                        return Ge(e, t, i)
                    })
                }, set: function (e, n, i) {
                    var r, o = Pe(e), a = "border-box" === w.css(e, "boxSizing", !1, o), s = i && Qe(e, t, i, a, o);
                    return a && p.scrollboxSize() === o.position && (s -= Math.ceil(e["offset" + t[0].toUpperCase() + t.slice(1)] - parseFloat(o[t]) - Qe(e, t, "border", !1, o) - .5)), s && (r = te.exec(n)) && "px" !== (r[3] || "px") && (e.style[t] = n, n = w.css(e, t)), Ye(0, n, s)
                }
            }
        }), w.cssHooks.marginLeft = He(p.reliableMarginLeft, function (e, t) {
            if (t) return (parseFloat($e(e, "marginLeft")) || e.getBoundingClientRect().left - re(e, {marginLeft: 0}, function () {
                return e.getBoundingClientRect().left
            })) + "px"
        }), w.each({margin: "", padding: "", border: "Width"}, function (e, t) {
            w.cssHooks[e + t] = {
                expand: function (n) {
                    for (var i = 0, r = {}, o = "string" == typeof n ? n.split(" ") : [n]; i < 4; i++) r[e + ne[i] + t] = o[i] || o[i - 2] || o[0];
                    return r
                }
            }, "margin" !== e && (w.cssHooks[e + t].set = Ye)
        }), w.fn.extend({
            css: function (e, t) {
                return j(this, function (e, t, n) {
                    var i, r, o = {}, a = 0;
                    if (Array.isArray(t)) {
                        for (i = Pe(e), r = t.length; a < r; a++) o[t[a]] = w.css(e, t[a], !1, i);
                        return o
                    }
                    return void 0 !== n ? w.style(e, t, n) : w.css(e, t)
                }, e, t, arguments.length > 1)
            }
        });

        function Je(e, t, n, i, r) {
            return new Je.prototype.init(e, t, n, i, r)
        }

        w.Tween = Je, Je.prototype = {
            constructor: Je, init: function (e, t, n, i, r, o) {
                this.elem = e, this.prop = n, this.easing = r || w.easing._default, this.options = t, this.start = this.now = this.cur(), this.end = i, this.unit = o || (w.cssNumber[n] ? "" : "px")
            }, cur: function () {
                var e = Je.propHooks[this.prop];
                return e && e.get ? e.get(this) : Je.propHooks._default.get(this)
            }, run: function (e) {
                var t, n = Je.propHooks[this.prop];
                return this.options.duration ? this.pos = t = w.easing[this.easing](e, this.options.duration * e, 0, 1, this.options.duration) : this.pos = t = e, this.now = (this.end - this.start) * t + this.start, this.options.step && this.options.step.call(this.elem, this.now, this), n && n.set ? n.set(this) : Je.propHooks._default.set(this), this
            }
        }, Je.prototype.init.prototype = Je.prototype, Je.propHooks = {
            _default: {
                get: function (e) {
                    var t;
                    return 1 !== e.elem.nodeType || null != e.elem[e.prop] && null == e.elem.style[e.prop] ? e.elem[e.prop] : (t = w.css(e.elem, e.prop, "")) && "auto" !== t ? t : 0
                }, set: function (e) {
                    w.fx.step[e.prop] ? w.fx.step[e.prop](e) : 1 !== e.elem.nodeType || null == e.elem.style[w.cssProps[e.prop]] && !w.cssHooks[e.prop] ? e.elem[e.prop] = e.now : w.style(e.elem, e.prop, e.now + e.unit)
                }
            }
        }, Je.propHooks.scrollTop = Je.propHooks.scrollLeft = {
            set: function (e) {
                e.elem.nodeType && e.elem.parentNode && (e.elem[e.prop] = e.now)
            }
        }, w.easing = {
            linear: function (e) {
                return e
            }, swing: function (e) {
                return .5 - Math.cos(e * Math.PI) / 2
            }, _default: "swing"
        }, w.fx = Je.prototype.init, w.fx.step = {};
        var Xe, Ze, et = /^(?:toggle|show|hide)$/, tt = /queueHooks$/;

        function nt() {
            Ze && (!1 === i.hidden && e.requestAnimationFrame ? e.requestAnimationFrame(nt) : e.setTimeout(nt, w.fx.interval), w.fx.tick())
        }

        function it() {
            return e.setTimeout(function () {
                Xe = void 0
            }), Xe = Date.now()
        }

        function rt(e, t) {
            var n, i = 0, r = {height: e};
            for (t = t ? 1 : 0; i < 4; i += 2 - t) r["margin" + (n = ne[i])] = r["padding" + n] = e;
            return t && (r.opacity = r.width = e), r
        }

        function ot(e, t, n) {
            for (var i, r = (at.tweeners[t] || []).concat(at.tweeners["*"]), o = 0, a = r.length; o < a; o++) if (i = r[o].call(n, t, e)) return i
        }

        function at(e, t, n) {
            var i, r, o = 0, a = at.prefilters.length, s = w.Deferred().always(function () {
                delete l.elem
            }), l = function () {
                if (r) return !1;
                for (var t = Xe || it(), n = Math.max(0, c.startTime + c.duration - t), i = 1 - (n / c.duration || 0), o = 0, a = c.tweens.length; o < a; o++) c.tweens[o].run(i);
                return s.notifyWith(e, [c, i, n]), i < 1 && a ? n : (a || s.notifyWith(e, [c, 1, 0]), s.resolveWith(e, [c]), !1)
            }, c = s.promise({
                elem: e,
                props: w.extend({}, t),
                opts: w.extend(!0, {specialEasing: {}, easing: w.easing._default}, n),
                originalProperties: t,
                originalOptions: n,
                startTime: Xe || it(),
                duration: n.duration,
                tweens: [],
                createTween: function (t, n) {
                    var i = w.Tween(e, c.opts, t, n, c.opts.specialEasing[t] || c.opts.easing);
                    return c.tweens.push(i), i
                },
                stop: function (t) {
                    var n = 0, i = t ? c.tweens.length : 0;
                    if (r) return this;
                    for (r = !0; n < i; n++) c.tweens[n].run(1);
                    return t ? (s.notifyWith(e, [c, 1, 0]), s.resolveWith(e, [c, t])) : s.rejectWith(e, [c, t]), this
                }
            }), d = c.props;
            for (function (e, t) {
                var n, i, r, o, a;
                for (n in e) if (i = V(n), r = t[i], o = e[n], Array.isArray(o) && (r = o[1], o = e[n] = o[0]), n !== i && (e[i] = o, delete e[n]), (a = w.cssHooks[i]) && "expand" in a) {
                    o = a.expand(o), delete e[i];
                    for (n in o) n in e || (e[n] = o[n], t[n] = r)
                } else t[i] = r
            }(d, c.opts.specialEasing); o < a; o++) if (i = at.prefilters[o].call(c, e, d, c.opts)) return m(i.stop) && (w._queueHooks(c.elem, c.opts.queue).stop = i.stop.bind(i)), i;
            return w.map(d, ot, c), m(c.opts.start) && c.opts.start.call(e, c), c.progress(c.opts.progress).done(c.opts.done, c.opts.complete).fail(c.opts.fail).always(c.opts.always), w.fx.timer(w.extend(l, {
                elem: e,
                anim: c,
                queue: c.opts.queue
            })), c
        }

        w.Animation = w.extend(at, {
            tweeners: {
                "*": [function (e, t) {
                    var n = this.createTween(e, t);
                    return oe(n.elem, e, te.exec(t), n), n
                }]
            }, tweener: function (e, t) {
                m(e) ? (t = e, e = ["*"]) : e = e.match(O);
                for (var n, i = 0, r = e.length; i < r; i++) n = e[i], at.tweeners[n] = at.tweeners[n] || [], at.tweeners[n].unshift(t)
            }, prefilters: [function (e, t, n) {
                var i, r, o, a, s, l, c, d, u = "width" in t || "height" in t, h = this, f = {}, p = e.style,
                    m = e.nodeType && ie(e), g = Q.get(e, "fxshow");
                n.queue || (null == (a = w._queueHooks(e, "fx")).unqueued && (a.unqueued = 0, s = a.empty.fire, a.empty.fire = function () {
                    a.unqueued || s()
                }), a.unqueued++, h.always(function () {
                    h.always(function () {
                        a.unqueued--, w.queue(e, "fx").length || a.empty.fire()
                    })
                }));
                for (i in t) if (r = t[i], et.test(r)) {
                    if (delete t[i], o = o || "toggle" === r, r === (m ? "hide" : "show")) {
                        if ("show" !== r || !g || void 0 === g[i]) continue;
                        m = !0
                    }
                    f[i] = g && g[i] || w.style(e, i)
                }
                if ((l = !w.isEmptyObject(t)) || !w.isEmptyObject(f)) {
                    u && 1 === e.nodeType && (n.overflow = [p.overflow, p.overflowX, p.overflowY], null == (c = g && g.display) && (c = Q.get(e, "display")), "none" === (d = w.css(e, "display")) && (c ? d = c : (le([e], !0), c = e.style.display || c, d = w.css(e, "display"), le([e]))), ("inline" === d || "inline-block" === d && null != c) && "none" === w.css(e, "float") && (l || (h.done(function () {
                        p.display = c
                    }), null == c && (d = p.display, c = "none" === d ? "" : d)), p.display = "inline-block")), n.overflow && (p.overflow = "hidden", h.always(function () {
                        p.overflow = n.overflow[0], p.overflowX = n.overflow[1], p.overflowY = n.overflow[2]
                    })), l = !1;
                    for (i in f) l || (g ? "hidden" in g && (m = g.hidden) : g = Q.access(e, "fxshow", {display: c}), o && (g.hidden = !m), m && le([e], !0), h.done(function () {
                        m || le([e]), Q.remove(e, "fxshow");
                        for (i in f) w.style(e, i, f[i])
                    })), l = ot(m ? g[i] : 0, i, h), i in g || (g[i] = l.start, m && (l.end = l.start, l.start = 0))
                }
            }], prefilter: function (e, t) {
                t ? at.prefilters.unshift(e) : at.prefilters.push(e)
            }
        }), w.speed = function (e, t, n) {
            var i = e && "object" == typeof e ? w.extend({}, e) : {
                complete: n || !n && t || m(e) && e,
                duration: e,
                easing: n && t || t && !m(t) && t
            };
            return w.fx.off ? i.duration = 0 : "number" != typeof i.duration && (i.duration in w.fx.speeds ? i.duration = w.fx.speeds[i.duration] : i.duration = w.fx.speeds._default), null != i.queue && !0 !== i.queue || (i.queue = "fx"), i.old = i.complete, i.complete = function () {
                m(i.old) && i.old.call(this), i.queue && w.dequeue(this, i.queue)
            }, i
        }, w.fn.extend({
            fadeTo: function (e, t, n, i) {
                return this.filter(ie).css("opacity", 0).show().end().animate({opacity: t}, e, n, i)
            }, animate: function (e, t, n, i) {
                var r = w.isEmptyObject(e), o = w.speed(t, n, i), a = function () {
                    var t = at(this, w.extend({}, e), o);
                    (r || Q.get(this, "finish")) && t.stop(!0)
                };
                return a.finish = a, r || !1 === o.queue ? this.each(a) : this.queue(o.queue, a)
            }, stop: function (e, t, n) {
                var i = function (e) {
                    var t = e.stop;
                    delete e.stop, t(n)
                };
                return "string" != typeof e && (n = t, t = e, e = void 0), t && !1 !== e && this.queue(e || "fx", []), this.each(function () {
                    var t = !0, r = null != e && e + "queueHooks", o = w.timers, a = Q.get(this);
                    if (r) a[r] && a[r].stop && i(a[r]); else for (r in a) a[r] && a[r].stop && tt.test(r) && i(a[r]);
                    for (r = o.length; r--;) o[r].elem !== this || null != e && o[r].queue !== e || (o[r].anim.stop(n), t = !1, o.splice(r, 1));
                    !t && n || w.dequeue(this, e)
                })
            }, finish: function (e) {
                return !1 !== e && (e = e || "fx"), this.each(function () {
                    var t, n = Q.get(this), i = n[e + "queue"], r = n[e + "queueHooks"], o = w.timers,
                        a = i ? i.length : 0;
                    for (n.finish = !0, w.queue(this, e, []), r && r.stop && r.stop.call(this, !0), t = o.length; t--;) o[t].elem === this && o[t].queue === e && (o[t].anim.stop(!0), o.splice(t, 1));
                    for (t = 0; t < a; t++) i[t] && i[t].finish && i[t].finish.call(this);
                    delete n.finish
                })
            }
        }), w.each(["toggle", "show", "hide"], function (e, t) {
            var n = w.fn[t];
            w.fn[t] = function (e, i, r) {
                return null == e || "boolean" == typeof e ? n.apply(this, arguments) : this.animate(rt(t, !0), e, i, r)
            }
        }), w.each({
            slideDown: rt("show"),
            slideUp: rt("hide"),
            slideToggle: rt("toggle"),
            fadeIn: {opacity: "show"},
            fadeOut: {opacity: "hide"},
            fadeToggle: {opacity: "toggle"}
        }, function (e, t) {
            w.fn[e] = function (e, n, i) {
                return this.animate(t, e, n, i)
            }
        }), w.timers = [], w.fx.tick = function () {
            var e, t = 0, n = w.timers;
            for (Xe = Date.now(); t < n.length; t++) (e = n[t])() || n[t] !== e || n.splice(t--, 1);
            n.length || w.fx.stop(), Xe = void 0
        }, w.fx.timer = function (e) {
            w.timers.push(e), w.fx.start()
        }, w.fx.interval = 13, w.fx.start = function () {
            Ze || (Ze = !0, nt())
        }, w.fx.stop = function () {
            Ze = null
        }, w.fx.speeds = {slow: 600, fast: 200, _default: 400}, w.fn.delay = function (t, n) {
            return t = w.fx ? w.fx.speeds[t] || t : t, n = n || "fx", this.queue(n, function (n, i) {
                var r = e.setTimeout(n, t);
                i.stop = function () {
                    e.clearTimeout(r)
                }
            })
        }, function () {
            var e = i.createElement("input"), t = i.createElement("select").appendChild(i.createElement("option"));
            e.type = "checkbox", p.checkOn = "" !== e.value, p.optSelected = t.selected, (e = i.createElement("input")).value = "t", e.type = "radio", p.radioValue = "t" === e.value
        }();
        var st, lt = w.expr.attrHandle;
        w.fn.extend({
            attr: function (e, t) {
                return j(this, w.attr, e, t, arguments.length > 1)
            }, removeAttr: function (e) {
                return this.each(function () {
                    w.removeAttr(this, e)
                })
            }
        }), w.extend({
            attr: function (e, t, n) {
                var i, r, o = e.nodeType;
                if (3 !== o && 8 !== o && 2 !== o) return void 0 === e.getAttribute ? w.prop(e, t, n) : (1 === o && w.isXMLDoc(e) || (r = w.attrHooks[t.toLowerCase()] || (w.expr.match.bool.test(t) ? st : void 0)), void 0 !== n ? null === n ? void w.removeAttr(e, t) : r && "set" in r && void 0 !== (i = r.set(e, n, t)) ? i : (e.setAttribute(t, n + ""), n) : r && "get" in r && null !== (i = r.get(e, t)) ? i : null == (i = w.find.attr(e, t)) ? void 0 : i)
            }, attrHooks: {
                type: {
                    set: function (e, t) {
                        if (!p.radioValue && "radio" === t && _(e, "input")) {
                            var n = e.value;
                            return e.setAttribute("type", t), n && (e.value = n), t
                        }
                    }
                }
            }, removeAttr: function (e, t) {
                var n, i = 0, r = t && t.match(O);
                if (r && 1 === e.nodeType) for (; n = r[i++];) e.removeAttribute(n)
            }
        }), st = {
            set: function (e, t, n) {
                return !1 === t ? w.removeAttr(e, n) : e.setAttribute(n, n), n
            }
        }, w.each(w.expr.match.bool.source.match(/\w+/g), function (e, t) {
            var n = lt[t] || w.find.attr;
            lt[t] = function (e, t, i) {
                var r, o, a = t.toLowerCase();
                return i || (o = lt[a], lt[a] = r, r = null != n(e, t, i) ? a : null, lt[a] = o), r
            }
        });
        var ct = /^(?:input|select|textarea|button)$/i, dt = /^(?:a|area)$/i;
        w.fn.extend({
            prop: function (e, t) {
                return j(this, w.prop, e, t, arguments.length > 1)
            }, removeProp: function (e) {
                return this.each(function () {
                    delete this[w.propFix[e] || e]
                })
            }
        }), w.extend({
            prop: function (e, t, n) {
                var i, r, o = e.nodeType;
                if (3 !== o && 8 !== o && 2 !== o) return 1 === o && w.isXMLDoc(e) || (t = w.propFix[t] || t, r = w.propHooks[t]), void 0 !== n ? r && "set" in r && void 0 !== (i = r.set(e, n, t)) ? i : e[t] = n : r && "get" in r && null !== (i = r.get(e, t)) ? i : e[t]
            }, propHooks: {
                tabIndex: {
                    get: function (e) {
                        var t = w.find.attr(e, "tabindex");
                        return t ? parseInt(t, 10) : ct.test(e.nodeName) || dt.test(e.nodeName) && e.href ? 0 : -1
                    }
                }
            }, propFix: {for: "htmlFor", class: "className"}
        }), p.optSelected || (w.propHooks.selected = {
            get: function (e) {
                var t = e.parentNode;
                return t && t.parentNode && t.parentNode.selectedIndex, null
            }, set: function (e) {
                var t = e.parentNode;
                t && (t.selectedIndex, t.parentNode && t.parentNode.selectedIndex)
            }
        }), w.each(["tabIndex", "readOnly", "maxLength", "cellSpacing", "cellPadding", "rowSpan", "colSpan", "useMap", "frameBorder", "contentEditable"], function () {
            w.propFix[this.toLowerCase()] = this
        });

        function ut(e) {
            return (e.match(O) || []).join(" ")
        }

        function ht(e) {
            return e.getAttribute && e.getAttribute("class") || ""
        }

        function ft(e) {
            return Array.isArray(e) ? e : "string" == typeof e ? e.match(O) || [] : []
        }

        w.fn.extend({
            addClass: function (e) {
                var t, n, i, r, o, a, s, l = 0;
                if (m(e)) return this.each(function (t) {
                    w(this).addClass(e.call(this, t, ht(this)))
                });
                if ((t = ft(e)).length) for (; n = this[l++];) if (r = ht(n), i = 1 === n.nodeType && " " + ut(r) + " ") {
                    for (a = 0; o = t[a++];) i.indexOf(" " + o + " ") < 0 && (i += o + " ");
                    r !== (s = ut(i)) && n.setAttribute("class", s)
                }
                return this
            }, removeClass: function (e) {
                var t, n, i, r, o, a, s, l = 0;
                if (m(e)) return this.each(function (t) {
                    w(this).removeClass(e.call(this, t, ht(this)))
                });
                if (!arguments.length) return this.attr("class", "");
                if ((t = ft(e)).length) for (; n = this[l++];) if (r = ht(n), i = 1 === n.nodeType && " " + ut(r) + " ") {
                    for (a = 0; o = t[a++];) for (; i.indexOf(" " + o + " ") > -1;) i = i.replace(" " + o + " ", " ");
                    r !== (s = ut(i)) && n.setAttribute("class", s)
                }
                return this
            }, toggleClass: function (e, t) {
                var n = typeof e, i = "string" === n || Array.isArray(e);
                return "boolean" == typeof t && i ? t ? this.addClass(e) : this.removeClass(e) : m(e) ? this.each(function (n) {
                    w(this).toggleClass(e.call(this, n, ht(this), t), t)
                }) : this.each(function () {
                    var t, r, o, a;
                    if (i) for (r = 0, o = w(this), a = ft(e); t = a[r++];) o.hasClass(t) ? o.removeClass(t) : o.addClass(t); else void 0 !== e && "boolean" !== n || ((t = ht(this)) && Q.set(this, "__className__", t), this.setAttribute && this.setAttribute("class", t || !1 === e ? "" : Q.get(this, "__className__") || ""))
                })
            }, hasClass: function (e) {
                var t, n, i = 0;
                for (t = " " + e + " "; n = this[i++];) if (1 === n.nodeType && (" " + ut(ht(n)) + " ").indexOf(t) > -1) return !0;
                return !1
            }
        });
        var pt = /\r/g;
        w.fn.extend({
            val: function (e) {
                var t, n, i, r = this[0];
                return arguments.length ? (i = m(e), this.each(function (n) {
                    var r;
                    1 === this.nodeType && (null == (r = i ? e.call(this, n, w(this).val()) : e) ? r = "" : "number" == typeof r ? r += "" : Array.isArray(r) && (r = w.map(r, function (e) {
                        return null == e ? "" : e + ""
                    })), (t = w.valHooks[this.type] || w.valHooks[this.nodeName.toLowerCase()]) && "set" in t && void 0 !== t.set(this, r, "value") || (this.value = r))
                })) : r ? (t = w.valHooks[r.type] || w.valHooks[r.nodeName.toLowerCase()]) && "get" in t && void 0 !== (n = t.get(r, "value")) ? n : "string" == typeof(n = r.value) ? n.replace(pt, "") : null == n ? "" : n : void 0
            }
        }), w.extend({
            valHooks: {
                option: {
                    get: function (e) {
                        var t = w.find.attr(e, "value");
                        return null != t ? t : ut(w.text(e))
                    }
                }, select: {
                    get: function (e) {
                        var t, n, i, r = e.options, o = e.selectedIndex, a = "select-one" === e.type, s = a ? null : [],
                            l = a ? o + 1 : r.length;
                        for (i = o < 0 ? l : a ? o : 0; i < l; i++) if (((n = r[i]).selected || i === o) && !n.disabled && (!n.parentNode.disabled || !_(n.parentNode, "optgroup"))) {
                            if (t = w(n).val(), a) return t;
                            s.push(t)
                        }
                        return s
                    }, set: function (e, t) {
                        for (var n, i, r = e.options, o = w.makeArray(t), a = r.length; a--;) ((i = r[a]).selected = w.inArray(w.valHooks.option.get(i), o) > -1) && (n = !0);
                        return n || (e.selectedIndex = -1), o
                    }
                }
            }
        }), w.each(["radio", "checkbox"], function () {
            w.valHooks[this] = {
                set: function (e, t) {
                    if (Array.isArray(t)) return e.checked = w.inArray(w(e).val(), t) > -1
                }
            }, p.checkOn || (w.valHooks[this].get = function (e) {
                return null === e.getAttribute("value") ? "on" : e.value
            })
        }), p.focusin = "onfocusin" in e;
        var mt = /^(?:focusinfocus|focusoutblur)$/, gt = function (e) {
            e.stopPropagation()
        };
        w.extend(w.event, {
            trigger: function (t, n, r, o) {
                var a, s, l, c, d, h, f, p, v = [r || i], y = u.call(t, "type") ? t.type : t,
                    b = u.call(t, "namespace") ? t.namespace.split(".") : [];
                if (s = p = l = r = r || i, 3 !== r.nodeType && 8 !== r.nodeType && !mt.test(y + w.event.triggered) && (y.indexOf(".") > -1 && (y = (b = y.split(".")).shift(), b.sort()), d = y.indexOf(":") < 0 && "on" + y, t = t[w.expando] ? t : new w.Event(y, "object" == typeof t && t), t.isTrigger = o ? 2 : 3, t.namespace = b.join("."), t.rnamespace = t.namespace ? new RegExp("(^|\\.)" + b.join("\\.(?:.*\\.|)") + "(\\.|$)") : null, t.result = void 0, t.target || (t.target = r), n = null == n ? [t] : w.makeArray(n, [t]), f = w.event.special[y] || {}, o || !f.trigger || !1 !== f.trigger.apply(r, n))) {
                    if (!o && !f.noBubble && !g(r)) {
                        for (c = f.delegateType || y, mt.test(c + y) || (s = s.parentNode); s; s = s.parentNode) v.push(s), l = s;
                        l === (r.ownerDocument || i) && v.push(l.defaultView || l.parentWindow || e)
                    }
                    for (a = 0; (s = v[a++]) && !t.isPropagationStopped();) p = s, t.type = a > 1 ? c : f.bindType || y, (h = (Q.get(s, "events") || {})[t.type] && Q.get(s, "handle")) && h.apply(s, n), (h = d && s[d]) && h.apply && K(s) && (t.result = h.apply(s, n), !1 === t.result && t.preventDefault());
                    return t.type = y, o || t.isDefaultPrevented() || f._default && !1 !== f._default.apply(v.pop(), n) || !K(r) || d && m(r[y]) && !g(r) && ((l = r[d]) && (r[d] = null), w.event.triggered = y, t.isPropagationStopped() && p.addEventListener(y, gt), r[y](), t.isPropagationStopped() && p.removeEventListener(y, gt), w.event.triggered = void 0, l && (r[d] = l)), t.result
                }
            }, simulate: function (e, t, n) {
                var i = w.extend(new w.Event, n, {type: e, isSimulated: !0});
                w.event.trigger(i, null, t)
            }
        }), w.fn.extend({
            trigger: function (e, t) {
                return this.each(function () {
                    w.event.trigger(e, t, this)
                })
            }, triggerHandler: function (e, t) {
                var n = this[0];
                if (n) return w.event.trigger(e, t, n, !0)
            }
        }), p.focusin || w.each({focus: "focusin", blur: "focusout"}, function (e, t) {
            var n = function (e) {
                w.event.simulate(t, e.target, w.event.fix(e))
            };
            w.event.special[t] = {
                setup: function () {
                    var i = this.ownerDocument || this, r = Q.access(i, t);
                    r || i.addEventListener(e, n, !0), Q.access(i, t, (r || 0) + 1)
                }, teardown: function () {
                    var i = this.ownerDocument || this, r = Q.access(i, t) - 1;
                    r ? Q.access(i, t, r) : (i.removeEventListener(e, n, !0), Q.remove(i, t))
                }
            }
        });
        var vt = e.location, yt = Date.now(), bt = /\?/;
        w.parseXML = function (t) {
            var n;
            if (!t || "string" != typeof t) return null;
            try {
                n = (new e.DOMParser).parseFromString(t, "text/xml")
            } catch (e) {
                n = void 0
            }
            return n && !n.getElementsByTagName("parsererror").length || w.error("Invalid XML: " + t), n
        };
        var wt = /\[\]$/, Ct = /\r?\n/g, xt = /^(?:submit|button|image|reset|file)$/i,
            kt = /^(?:input|select|textarea|keygen)/i;

        function St(e, t, n, i) {
            var r;
            if (Array.isArray(t)) w.each(t, function (t, r) {
                n || wt.test(e) ? i(e, r) : St(e + "[" + ("object" == typeof r && null != r ? t : "") + "]", r, n, i)
            }); else if (n || "object" !== b(t)) i(e, t); else for (r in t) St(e + "[" + r + "]", t[r], n, i)
        }

        w.param = function (e, t) {
            var n, i = [], r = function (e, t) {
                var n = m(t) ? t() : t;
                i[i.length] = encodeURIComponent(e) + "=" + encodeURIComponent(null == n ? "" : n)
            };
            if (Array.isArray(e) || e.jquery && !w.isPlainObject(e)) w.each(e, function () {
                r(this.name, this.value)
            }); else for (n in e) St(n, e[n], t, r);
            return i.join("&")
        }, w.fn.extend({
            serialize: function () {
                return w.param(this.serializeArray())
            }, serializeArray: function () {
                return this.map(function () {
                    var e = w.prop(this, "elements");
                    return e ? w.makeArray(e) : this
                }).filter(function () {
                    var e = this.type;
                    return this.name && !w(this).is(":disabled") && kt.test(this.nodeName) && !xt.test(e) && (this.checked || !ce.test(e))
                }).map(function (e, t) {
                    var n = w(this).val();
                    return null == n ? null : Array.isArray(n) ? w.map(n, function (e) {
                        return {name: t.name, value: e.replace(Ct, "\r\n")}
                    }) : {name: t.name, value: n.replace(Ct, "\r\n")}
                }).get()
            }
        });
        var Et = /%20/g, Ft = /#.*$/, _t = /([?&])_=[^&]*/, Tt = /^(.*?):[ \t]*([^\r\n]*)$/gm, Mt = /^(?:GET|HEAD)$/,
            At = /^\/\//, Nt = {}, Lt = {}, Rt = "*/".concat("*"), Dt = i.createElement("a");
        Dt.href = vt.href;

        function Ot(e) {
            return function (t, n) {
                "string" != typeof t && (n = t, t = "*");
                var i, r = 0, o = t.toLowerCase().match(O) || [];
                if (m(n)) for (; i = o[r++];) "+" === i[0] ? (i = i.slice(1) || "*", (e[i] = e[i] || []).unshift(n)) : (e[i] = e[i] || []).push(n)
            }
        }

        function It(e, t, n, i) {
            var r = {}, o = e === Lt;

            function a(s) {
                var l;
                return r[s] = !0, w.each(e[s] || [], function (e, s) {
                    var c = s(t, n, i);
                    return "string" != typeof c || o || r[c] ? o ? !(l = c) : void 0 : (t.dataTypes.unshift(c), a(c), !1)
                }), l
            }

            return a(t.dataTypes[0]) || !r["*"] && a("*")
        }

        function Pt(e, t) {
            var n, i, r = w.ajaxSettings.flatOptions || {};
            for (n in t) void 0 !== t[n] && ((r[n] ? e : i || (i = {}))[n] = t[n]);
            return i && w.extend(!0, e, i), e
        }

        w.extend({
            active: 0,
            lastModified: {},
            etag: {},
            ajaxSettings: {
                url: vt.href,
                type: "GET",
                isLocal: /^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(vt.protocol),
                global: !0,
                processData: !0,
                async: !0,
                contentType: "application/x-www-form-urlencoded; charset=UTF-8",
                accepts: {
                    "*": Rt,
                    text: "text/plain",
                    html: "text/html",
                    xml: "application/xml, text/xml",
                    json: "application/json, text/javascript"
                },
                contents: {xml: /\bxml\b/, html: /\bhtml/, json: /\bjson\b/},
                responseFields: {xml: "responseXML", text: "responseText", json: "responseJSON"},
                converters: {"* text": String, "text html": !0, "text json": JSON.parse, "text xml": w.parseXML},
                flatOptions: {url: !0, context: !0}
            },
            ajaxSetup: function (e, t) {
                return t ? Pt(Pt(e, w.ajaxSettings), t) : Pt(w.ajaxSettings, e)
            },
            ajaxPrefilter: Ot(Nt),
            ajaxTransport: Ot(Lt),
            ajax: function (t, n) {
                "object" == typeof t && (n = t, t = void 0), n = n || {};
                var r, o, a, s, l, c, d, u, h, f, p = w.ajaxSetup({}, n), m = p.context || p,
                    g = p.context && (m.nodeType || m.jquery) ? w(m) : w.event, v = w.Deferred(),
                    y = w.Callbacks("once memory"), b = p.statusCode || {}, C = {}, x = {}, k = "canceled", S = {
                        readyState: 0, getResponseHeader: function (e) {
                            var t;
                            if (d) {
                                if (!s) for (s = {}; t = Tt.exec(a);) s[t[1].toLowerCase()] = t[2];
                                t = s[e.toLowerCase()]
                            }
                            return null == t ? null : t
                        }, getAllResponseHeaders: function () {
                            return d ? a : null
                        }, setRequestHeader: function (e, t) {
                            return null == d && (e = x[e.toLowerCase()] = x[e.toLowerCase()] || e, C[e] = t), this
                        }, overrideMimeType: function (e) {
                            return null == d && (p.mimeType = e), this
                        }, statusCode: function (e) {
                            var t;
                            if (e) if (d) S.always(e[S.status]); else for (t in e) b[t] = [b[t], e[t]];
                            return this
                        }, abort: function (e) {
                            var t = e || k;
                            return r && r.abort(t), E(0, t), this
                        }
                    };
                if (v.promise(S), p.url = ((t || p.url || vt.href) + "").replace(At, vt.protocol + "//"), p.type = n.method || n.type || p.method || p.type, p.dataTypes = (p.dataType || "*").toLowerCase().match(O) || [""], null == p.crossDomain) {
                    c = i.createElement("a");
                    try {
                        c.href = p.url, c.href = c.href, p.crossDomain = Dt.protocol + "//" + Dt.host != c.protocol + "//" + c.host
                    } catch (e) {
                        p.crossDomain = !0
                    }
                }
                if (p.data && p.processData && "string" != typeof p.data && (p.data = w.param(p.data, p.traditional)), It(Nt, p, n, S), d) return S;
                (u = w.event && p.global) && 0 == w.active++ && w.event.trigger("ajaxStart"), p.type = p.type.toUpperCase(), p.hasContent = !Mt.test(p.type), o = p.url.replace(Ft, ""), p.hasContent ? p.data && p.processData && 0 === (p.contentType || "").indexOf("application/x-www-form-urlencoded") && (p.data = p.data.replace(Et, "+")) : (f = p.url.slice(o.length), p.data && (p.processData || "string" == typeof p.data) && (o += (bt.test(o) ? "&" : "?") + p.data, delete p.data), !1 === p.cache && (o = o.replace(_t, "$1"), f = (bt.test(o) ? "&" : "?") + "_=" + yt++ + f), p.url = o + f), p.ifModified && (w.lastModified[o] && S.setRequestHeader("If-Modified-Since", w.lastModified[o]), w.etag[o] && S.setRequestHeader("If-None-Match", w.etag[o])), (p.data && p.hasContent && !1 !== p.contentType || n.contentType) && S.setRequestHeader("Content-Type", p.contentType), S.setRequestHeader("Accept", p.dataTypes[0] && p.accepts[p.dataTypes[0]] ? p.accepts[p.dataTypes[0]] + ("*" !== p.dataTypes[0] ? ", " + Rt + "; q=0.01" : "") : p.accepts["*"]);
                for (h in p.headers) S.setRequestHeader(h, p.headers[h]);
                if (p.beforeSend && (!1 === p.beforeSend.call(m, S, p) || d)) return S.abort();
                if (k = "abort", y.add(p.complete), S.done(p.success), S.fail(p.error), r = It(Lt, p, n, S)) {
                    if (S.readyState = 1, u && g.trigger("ajaxSend", [S, p]), d) return S;
                    p.async && p.timeout > 0 && (l = e.setTimeout(function () {
                        S.abort("timeout")
                    }, p.timeout));
                    try {
                        d = !1, r.send(C, E)
                    } catch (e) {
                        if (d) throw e;
                        E(-1, e)
                    }
                } else E(-1, "No Transport");

                function E(t, n, i, s) {
                    var c, h, f, C, x, k = n;
                    d || (d = !0, l && e.clearTimeout(l), r = void 0, a = s || "", S.readyState = t > 0 ? 4 : 0, c = t >= 200 && t < 300 || 304 === t, i && (C = function (e, t, n) {
                        for (var i, r, o, a, s = e.contents, l = e.dataTypes; "*" === l[0];) l.shift(), void 0 === i && (i = e.mimeType || t.getResponseHeader("Content-Type"));
                        if (i) for (r in s) if (s[r] && s[r].test(i)) {
                            l.unshift(r);
                            break
                        }
                        if (l[0] in n) o = l[0]; else {
                            for (r in n) {
                                if (!l[0] || e.converters[r + " " + l[0]]) {
                                    o = r;
                                    break
                                }
                                a || (a = r)
                            }
                            o = o || a
                        }
                        if (o) return o !== l[0] && l.unshift(o), n[o]
                    }(p, S, i)), C = function (e, t, n, i) {
                        var r, o, a, s, l, c = {}, d = e.dataTypes.slice();
                        if (d[1]) for (a in e.converters) c[a.toLowerCase()] = e.converters[a];
                        for (o = d.shift(); o;) if (e.responseFields[o] && (n[e.responseFields[o]] = t), !l && i && e.dataFilter && (t = e.dataFilter(t, e.dataType)), l = o, o = d.shift()) if ("*" === o) o = l; else if ("*" !== l && l !== o) {
                            if (!(a = c[l + " " + o] || c["* " + o])) for (r in c) if ((s = r.split(" "))[1] === o && (a = c[l + " " + s[0]] || c["* " + s[0]])) {
                                !0 === a ? a = c[r] : !0 !== c[r] && (o = s[0], d.unshift(s[1]));
                                break
                            }
                            if (!0 !== a) if (a && e.throws) t = a(t); else try {
                                t = a(t)
                            } catch (e) {
                                return {state: "parsererror", error: a ? e : "No conversion from " + l + " to " + o}
                            }
                        }
                        return {state: "success", data: t}
                    }(p, C, S, c), c ? (p.ifModified && ((x = S.getResponseHeader("Last-Modified")) && (w.lastModified[o] = x), (x = S.getResponseHeader("etag")) && (w.etag[o] = x)), 204 === t || "HEAD" === p.type ? k = "nocontent" : 304 === t ? k = "notmodified" : (k = C.state, h = C.data, c = !(f = C.error))) : (f = k, !t && k || (k = "error", t < 0 && (t = 0))), S.status = t, S.statusText = (n || k) + "", c ? v.resolveWith(m, [h, k, S]) : v.rejectWith(m, [S, k, f]), S.statusCode(b), b = void 0, u && g.trigger(c ? "ajaxSuccess" : "ajaxError", [S, p, c ? h : f]), y.fireWith(m, [S, k]), u && (g.trigger("ajaxComplete", [S, p]), --w.active || w.event.trigger("ajaxStop")))
                }

                return S
            },
            getJSON: function (e, t, n) {
                return w.get(e, t, n, "json")
            },
            getScript: function (e, t) {
                return w.get(e, void 0, t, "script")
            }
        }), w.each(["get", "post"], function (e, t) {
            w[t] = function (e, n, i, r) {
                return m(n) && (r = r || i, i = n, n = void 0), w.ajax(w.extend({
                    url: e,
                    type: t,
                    dataType: r,
                    data: n,
                    success: i
                }, w.isPlainObject(e) && e))
            }
        }), w._evalUrl = function (e) {
            return w.ajax({url: e, type: "GET", dataType: "script", cache: !0, async: !1, global: !1, throws: !0})
        }, w.fn.extend({
            wrapAll: function (e) {
                var t;
                return this[0] && (m(e) && (e = e.call(this[0])), t = w(e, this[0].ownerDocument).eq(0).clone(!0), this[0].parentNode && t.insertBefore(this[0]), t.map(function () {
                    for (var e = this; e.firstElementChild;) e = e.firstElementChild;
                    return e
                }).append(this)), this
            }, wrapInner: function (e) {
                return m(e) ? this.each(function (t) {
                    w(this).wrapInner(e.call(this, t))
                }) : this.each(function () {
                    var t = w(this), n = t.contents();
                    n.length ? n.wrapAll(e) : t.append(e)
                })
            }, wrap: function (e) {
                var t = m(e);
                return this.each(function (n) {
                    w(this).wrapAll(t ? e.call(this, n) : e)
                })
            }, unwrap: function (e) {
                return this.parent(e).not("body").each(function () {
                    w(this).replaceWith(this.childNodes)
                }), this
            }
        }), w.expr.pseudos.hidden = function (e) {
            return !w.expr.pseudos.visible(e)
        }, w.expr.pseudos.visible = function (e) {
            return !!(e.offsetWidth || e.offsetHeight || e.getClientRects().length)
        }, w.ajaxSettings.xhr = function () {
            try {
                return new e.XMLHttpRequest
            } catch (e) {
            }
        };
        var Bt = {0: 200, 1223: 204}, $t = w.ajaxSettings.xhr();
        p.cors = !!$t && "withCredentials" in $t, p.ajax = $t = !!$t, w.ajaxTransport(function (t) {
            var n, i;
            if (p.cors || $t && !t.crossDomain) return {
                send: function (r, o) {
                    var a, s = t.xhr();
                    if (s.open(t.type, t.url, t.async, t.username, t.password), t.xhrFields) for (a in t.xhrFields) s[a] = t.xhrFields[a];
                    t.mimeType && s.overrideMimeType && s.overrideMimeType(t.mimeType), t.crossDomain || r["X-Requested-With"] || (r["X-Requested-With"] = "XMLHttpRequest");
                    for (a in r) s.setRequestHeader(a, r[a]);
                    n = function (e) {
                        return function () {
                            n && (n = i = s.onload = s.onerror = s.onabort = s.ontimeout = s.onreadystatechange = null, "abort" === e ? s.abort() : "error" === e ? "number" != typeof s.status ? o(0, "error") : o(s.status, s.statusText) : o(Bt[s.status] || s.status, s.statusText, "text" !== (s.responseType || "text") || "string" != typeof s.responseText ? {binary: s.response} : {text: s.responseText}, s.getAllResponseHeaders()))
                        }
                    }, s.onload = n(), i = s.onerror = s.ontimeout = n("error"), void 0 !== s.onabort ? s.onabort = i : s.onreadystatechange = function () {
                        4 === s.readyState && e.setTimeout(function () {
                            n && i()
                        })
                    }, n = n("abort");
                    try {
                        s.send(t.hasContent && t.data || null)
                    } catch (e) {
                        if (n) throw e
                    }
                }, abort: function () {
                    n && n()
                }
            }
        }), w.ajaxPrefilter(function (e) {
            e.crossDomain && (e.contents.script = !1)
        }), w.ajaxSetup({
            accepts: {script: "text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},
            contents: {script: /\b(?:java|ecma)script\b/},
            converters: {
                "text script": function (e) {
                    return w.globalEval(e), e
                }
            }
        }), w.ajaxPrefilter("script", function (e) {
            void 0 === e.cache && (e.cache = !1), e.crossDomain && (e.type = "GET")
        }), w.ajaxTransport("script", function (e) {
            if (e.crossDomain) {
                var t, n;
                return {
                    send: function (r, o) {
                        t = w("<script>").prop({
                            charset: e.scriptCharset,
                            src: e.url
                        }).on("load error", n = function (e) {
                            t.remove(), n = null, e && o("error" === e.type ? 404 : 200, e.type)
                        }), i.head.appendChild(t[0])
                    }, abort: function () {
                        n && n()
                    }
                }
            }
        });
        var Ht = [], Ut = /(=)\?(?=&|$)|\?\?/;
        w.ajaxSetup({
            jsonp: "callback", jsonpCallback: function () {
                var e = Ht.pop() || w.expando + "_" + yt++;
                return this[e] = !0, e
            }
        }), w.ajaxPrefilter("json jsonp", function (t, n, i) {
            var r, o, a,
                s = !1 !== t.jsonp && (Ut.test(t.url) ? "url" : "string" == typeof t.data && 0 === (t.contentType || "").indexOf("application/x-www-form-urlencoded") && Ut.test(t.data) && "data");
            if (s || "jsonp" === t.dataTypes[0]) return r = t.jsonpCallback = m(t.jsonpCallback) ? t.jsonpCallback() : t.jsonpCallback, s ? t[s] = t[s].replace(Ut, "$1" + r) : !1 !== t.jsonp && (t.url += (bt.test(t.url) ? "&" : "?") + t.jsonp + "=" + r), t.converters["script json"] = function () {
                return a || w.error(r + " was not called"), a[0]
            }, t.dataTypes[0] = "json", o = e[r], e[r] = function () {
                a = arguments
            }, i.always(function () {
                void 0 === o ? w(e).removeProp(r) : e[r] = o, t[r] && (t.jsonpCallback = n.jsonpCallback, Ht.push(r)), a && m(o) && o(a[0]), a = o = void 0
            }), "script"
        }), p.createHTMLDocument = function () {
            var e = i.implementation.createHTMLDocument("").body;
            return e.innerHTML = "<form></form><form></form>", 2 === e.childNodes.length
        }(), w.parseHTML = function (e, t, n) {
            if ("string" != typeof e) return [];
            "boolean" == typeof t && (n = t, t = !1);
            var r, o, a;
            return t || (p.createHTMLDocument ? ((r = (t = i.implementation.createHTMLDocument("")).createElement("base")).href = i.location.href, t.head.appendChild(r)) : t = i), o = T.exec(e), a = !n && [], o ? [t.createElement(o[1])] : (o = ge([e], t, a), a && a.length && w(a).remove(), w.merge([], o.childNodes))
        }, w.fn.load = function (e, t, n) {
            var i, r, o, a = this, s = e.indexOf(" ");
            return s > -1 && (i = ut(e.slice(s)), e = e.slice(0, s)), m(t) ? (n = t, t = void 0) : t && "object" == typeof t && (r = "POST"), a.length > 0 && w.ajax({
                url: e,
                type: r || "GET",
                dataType: "html",
                data: t
            }).done(function (e) {
                o = arguments, a.html(i ? w("<div>").append(w.parseHTML(e)).find(i) : e)
            }).always(n && function (e, t) {
                a.each(function () {
                    n.apply(this, o || [e.responseText, t, e])
                })
            }), this
        }, w.each(["ajaxStart", "ajaxStop", "ajaxComplete", "ajaxError", "ajaxSuccess", "ajaxSend"], function (e, t) {
            w.fn[t] = function (e) {
                return this.on(t, e)
            }
        }), w.expr.pseudos.animated = function (e) {
            return w.grep(w.timers, function (t) {
                return e === t.elem
            }).length
        }, w.offset = {
            setOffset: function (e, t, n) {
                var i, r, o, a, s, l, c = w.css(e, "position"), d = w(e), u = {};
                "static" === c && (e.style.position = "relative"), s = d.offset(), o = w.css(e, "top"), l = w.css(e, "left"), ("absolute" === c || "fixed" === c) && (o + l).indexOf("auto") > -1 ? (a = (i = d.position()).top, r = i.left) : (a = parseFloat(o) || 0, r = parseFloat(l) || 0), m(t) && (t = t.call(e, n, w.extend({}, s))), null != t.top && (u.top = t.top - s.top + a), null != t.left && (u.left = t.left - s.left + r), "using" in t ? t.using.call(e, u) : d.css(u)
            }
        }, w.fn.extend({
            offset: function (e) {
                if (arguments.length) return void 0 === e ? this : this.each(function (t) {
                    w.offset.setOffset(this, e, t)
                });
                var t, n, i = this[0];
                return i ? i.getClientRects().length ? (t = i.getBoundingClientRect(), n = i.ownerDocument.defaultView, {
                    top: t.top + n.pageYOffset,
                    left: t.left + n.pageXOffset
                }) : {top: 0, left: 0} : void 0
            }, position: function () {
                if (this[0]) {
                    var e, t, n, i = this[0], r = {top: 0, left: 0};
                    if ("fixed" === w.css(i, "position")) t = i.getBoundingClientRect(); else {
                        for (t = this.offset(), n = i.ownerDocument, e = i.offsetParent || n.documentElement; e && (e === n.body || e === n.documentElement) && "static" === w.css(e, "position");) e = e.parentNode;
                        e && e !== i && 1 === e.nodeType && ((r = w(e).offset()).top += w.css(e, "borderTopWidth", !0), r.left += w.css(e, "borderLeftWidth", !0))
                    }
                    return {
                        top: t.top - r.top - w.css(i, "marginTop", !0),
                        left: t.left - r.left - w.css(i, "marginLeft", !0)
                    }
                }
            }, offsetParent: function () {
                return this.map(function () {
                    for (var e = this.offsetParent; e && "static" === w.css(e, "position");) e = e.offsetParent;
                    return e || ve
                })
            }
        }), w.each({scrollLeft: "pageXOffset", scrollTop: "pageYOffset"}, function (e, t) {
            var n = "pageYOffset" === t;
            w.fn[e] = function (i) {
                return j(this, function (e, i, r) {
                    var o;
                    if (g(e) ? o = e : 9 === e.nodeType && (o = e.defaultView), void 0 === r) return o ? o[t] : e[i];
                    o ? o.scrollTo(n ? o.pageXOffset : r, n ? r : o.pageYOffset) : e[i] = r
                }, e, i, arguments.length)
            }
        }), w.each(["top", "left"], function (e, t) {
            w.cssHooks[t] = He(p.pixelPosition, function (e, n) {
                if (n) return n = $e(e, t), Ie.test(n) ? w(e).position()[t] + "px" : n
            })
        }), w.each({Height: "height", Width: "width"}, function (e, t) {
            w.each({padding: "inner" + e, content: t, "": "outer" + e}, function (n, i) {
                w.fn[i] = function (r, o) {
                    var a = arguments.length && (n || "boolean" != typeof r),
                        s = n || (!0 === r || !0 === o ? "margin" : "border");
                    return j(this, function (t, n, r) {
                        var o;
                        return g(t) ? 0 === i.indexOf("outer") ? t["inner" + e] : t.document.documentElement["client" + e] : 9 === t.nodeType ? (o = t.documentElement, Math.max(t.body["scroll" + e], o["scroll" + e], t.body["offset" + e], o["offset" + e], o["client" + e])) : void 0 === r ? w.css(t, n, s) : w.style(t, n, r, s)
                    }, t, a ? r : void 0, a)
                }
            })
        }), w.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "), function (e, t) {
            w.fn[t] = function (e, n) {
                return arguments.length > 0 ? this.on(t, null, e, n) : this.trigger(t)
            }
        }), w.fn.extend({
            hover: function (e, t) {
                return this.mouseenter(e).mouseleave(t || e)
            }
        }), w.fn.extend({
            bind: function (e, t, n) {
                return this.on(e, null, t, n)
            }, unbind: function (e, t) {
                return this.off(e, null, t)
            }, delegate: function (e, t, n, i) {
                return this.on(t, e, n, i)
            }, undelegate: function (e, t, n) {
                return 1 === arguments.length ? this.off(e, "**") : this.off(t, e || "**", n)
            }
        }), w.proxy = function (e, t) {
            var n, i, r;
            if ("string" == typeof t && (n = e[t], t = e, e = n), m(e)) return i = o.call(arguments, 2), r = function () {
                return e.apply(t || this, i.concat(o.call(arguments)))
            }, r.guid = e.guid = e.guid || w.guid++, r
        }, w.holdReady = function (e) {
            e ? w.readyWait++ : w.ready(!0)
        }, w.isArray = Array.isArray, w.parseJSON = JSON.parse, w.nodeName = _, w.isFunction = m, w.isWindow = g, w.camelCase = V, w.type = b, w.now = Date.now, w.isNumeric = function (e) {
            var t = w.type(e);
            return ("number" === t || "string" === t) && !isNaN(e - parseFloat(e))
        }, $__System.registerDynamic("e", [], !1, function (e, t, n) {
            return function () {
                return w
            }.call(this)
        });
        var jt = e.jQuery, Wt = e.$;
        return w.noConflict = function (t) {
            return e.$ === w && (e.$ = Wt), t && e.jQuery === w && (e.jQuery = jt), w
        }, t || (e.jQuery = e.$ = w), w
    }), $__System.registerDynamic("11", ["e"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i, r = window, o = e("e"), a = n.exports, s = r.Backbone, l = r.Exoskeleton, c = a.utils = i = i || {};
        a.$ = o;
        var d = [], u = d.slice, h = {}.toString;
        a.noConflict = function () {
            return r.Backbone = s, r.Exoskeleton = l, this
        }, a.extend = function (e, t) {
            var n, r = this;
            n = e && i.has(e, "constructor") ? e.constructor : function () {
                return r.apply(this, arguments)
            }, i.extend(n, r, t);
            var o = function () {
                this.constructor = n
            };
            return o.prototype = r.prototype, n.prototype = new o, e && i.extend(n.prototype, e), n.__super__ = r.prototype, n
        };
        var f = function (e, t) {
            var n = t.error;
            t.error = function (i) {
                n && n(e, i, t), e.trigger("error", e, i, t)
            }
        }, p = function (e) {
            return "function" == typeof i[e]
        };
        c.result = function (e, t) {
            var n = e ? e[t] : void 0;
            return "function" == typeof n ? e[t]() : n
        }, c.defaults = function (e) {
            return u.call(arguments, 1).forEach(function (t) {
                for (var n in t) void 0 === e[n] && (e[n] = t[n])
            }), e
        }, c.extend = function (e) {
            return u.call(arguments, 1).forEach(function (t) {
                for (var n in t) e[n] = t[n]
            }), e
        }, c.clone = function (e) {
            return !e instanceof Object ? e : Array.isArray(e) ? e.slice() : c.extend({}, e)
        };
        var m = {"&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#39;"};
        c.escape = function (e) {
            return null == e ? "" : String(e).replace(/[&<>"']/g, function (e) {
                return m[e]
            })
        }, c.sortBy = function (e, t, n) {
            var i = "function" == typeof t ? t : function (e) {
                return e[t]
            };
            return e.map(function (e, t, r) {
                return {value: e, index: t, criteria: i.call(n, e, t, r)}
            }).sort(function (e, t) {
                var n = e.criteria, i = t.criteria;
                if (n !== i) {
                    if (n > i || void 0 === n) return 1;
                    if (n < i || void 0 === i) return -1
                }
                return e.index - t.index
            }).map(function (e) {
                return e.value
            })
        };
        var g = 0;
        c.uniqueId = function (e) {
            var t = ++g + "";
            return e ? e + t : t
        }, c.has = function (e, t) {
            return Object.hasOwnProperty.call(e, t)
        };
        var v = function (e, t, n, r) {
            if (e === t) return 0 !== e || 1 / e == 1 / t;
            if (null == e || null == t) return e === t;
            var o = h.call(e);
            if (o != h.call(t)) return !1;
            switch (o) {
                case"[object String]":
                    return e == String(t);
                case"[object Number]":
                    return e !== +e ? t !== +t : 0 === e ? 1 / e == 1 / t : e === +t;
                case"[object Date]":
                case"[object Boolean]":
                    return +e == +t;
                case"[object RegExp]":
                    return e.source == t.source && e.global == t.global && e.multiline == t.multiline && e.ignoreCase == t.ignoreCase
            }
            if ("object" != typeof e || "object" != typeof t) return !1;
            for (var a = n.length; a--;) if (n[a] == e) return r[a] == t;
            var s = e.constructor, l = t.constructor;
            if (s !== l && !("function" == typeof s && s instanceof s && "function" == typeof l && l instanceof l)) return !1;
            n.push(e), r.push(t);
            var c = 0, d = !0;
            if ("[object Array]" === o) {
                if (d = (c = e.length) === t.length) for (; c-- && (d = v(e[c], t[c], n, r));) ;
            } else {
                for (var u in e) if (i.has(e, u) && (c++, !(d = i.has(t, u) && v(e[u], t[u], n, r)))) break;
                if (d) {
                    for (u in t) if (i.has(t, u) && !c--) break;
                    d = !c
                }
            }
            return n.pop(), r.pop(), d
        };
        c.isEqual = function (e, t) {
            return v(e, t, [], [])
        };
        var y = a.Events = {
            on: function (e, t, n) {
                if (!w(this, "on", e, [t, n]) || !t) return this;
                this._events || (this._events = {});
                return (this._events[e] || (this._events[e] = [])).push({callback: t, context: n, ctx: n || this}), this
            }, once: function (e, t, n) {
                if (!w(this, "once", e, [t, n]) || !t) return this;
                var i, r = this, o = function () {
                    i || (i = !0, r.off(e, o), t.apply(this, arguments))
                };
                return o._callback = t, this.on(e, o, n)
            }, off: function (e, t, n) {
                var i, r, o, a, s, l, c, d;
                if (!this._events || !w(this, "off", e, [t, n])) return this;
                if (!e && !t && !n) return this._events = void 0, this;
                for (s = 0, l = (a = e ? [e] : Object.keys(this._events)).length; s < l; s++) if (e = a[s], o = this._events[e]) {
                    if (this._events[e] = i = [], t || n) for (c = 0, d = o.length; c < d; c++) r = o[c], (t && t !== r.callback && t !== r.callback._callback || n && n !== r.context) && i.push(r);
                    i.length || delete this._events[e]
                }
                return this
            }, trigger: function (e) {
                if (!this._events) return this;
                var t = u.call(arguments, 1);
                if (!w(this, "trigger", e, t)) return this;
                var n = this._events[e], i = this._events.all;
                return n && C(n, t), i && C(i, arguments), this
            }, stopListening: function (e, t, n) {
                var i = this._listeningTo;
                if (!i) return this;
                var r = !t && !n;
                n || "object" != typeof t || (n = this), e && ((i = {})[e._listenId] = e);
                for (var o in i) (e = i[o]).off(t, n, this), !r && Object.keys(e._events).length || delete this._listeningTo[o];
                return this
            }
        }, b = /\s+/, w = function (e, t, n, i) {
            if (!n) return !0;
            if ("object" == typeof n) {
                for (var r in n) e[t].apply(e, [r, n[r]].concat(i));
                return !1
            }
            if (b.test(n)) {
                for (var o = n.split(b), a = 0, s = o.length; a < s; a++) e[t].apply(e, [o[a]].concat(i));
                return !1
            }
            return !0
        }, C = function (e, t) {
            var n, i = -1, r = e.length, o = t[0], a = t[1], s = t[2];
            switch (t.length) {
                case 0:
                    for (; ++i < r;) (n = e[i]).callback.call(n.ctx);
                    return;
                case 1:
                    for (; ++i < r;) (n = e[i]).callback.call(n.ctx, o);
                    return;
                case 2:
                    for (; ++i < r;) (n = e[i]).callback.call(n.ctx, o, a);
                    return;
                case 3:
                    for (; ++i < r;) (n = e[i]).callback.call(n.ctx, o, a, s);
                    return;
                default:
                    for (; ++i < r;) (n = e[i]).callback.apply(n.ctx, t);
                    return
            }
        }, x = {listenTo: "on", listenToOnce: "once"};
        Object.keys(x).forEach(function (e) {
            var t = x[e];
            y[e] = function (e, n, r) {
                return (this._listeningTo || (this._listeningTo = {}))[e._listenId || (e._listenId = i.uniqueId("l"))] = e, r || "object" != typeof n || (r = this), e[t](n, r, this), this
            }
        }), y.bind = y.on, y.unbind = y.off, i.extend(a, y);
        var k = a.Model = function (e, t) {
            var n = e || {};
            t || (t = {}), this.cid = i.uniqueId("c"), this.attributes = Object.create(null), t.collection && (this.collection = t.collection), t.parse && (n = this.parse(n, t) || {}), n = i.defaults({}, n, i.result(this, "defaults")), this.set(n, t), this.changed = Object.create(null), this.initialize.apply(this, arguments)
        };
        if (i.extend(k.prototype, y, {
            changed: null, validationError: null, idAttribute: "id", initialize: function () {
            }, toJSON: function (e) {
                return i.extend({}, this.attributes)
            }, sync: function () {
                return a.sync.apply(this, arguments)
            }, get: function (e) {
                return this.attributes[e]
            }, escape: function (e) {
                return i.escape(this.get(e))
            }, has: function (e) {
                return null != this.get(e)
            }, set: function (e, t, n) {
                var r, o, a, s, l, c, d, u;
                if (null == e) return this;
                if ("object" == typeof e ? (o = e, n = t) : (o = {})[e] = t, n || (n = {}), !this._validate(o, n)) return !1;
                a = n.unset, l = n.broadcast, s = [], c = this._changing, this._changing = !0, c || (this._previousAttributes = i.extend(Object.create(null), this.attributes), this.changed = {}), u = this.attributes, d = this._previousAttributes, this.idAttribute in o && (this.id = o[this.idAttribute]);
                for (r in o) t = o[r], i.isEqual(u[r], t) || s.push(r), i.isEqual(d[r], t) ? delete this.changed[r] : this.changed[r] = t, a ? delete u[r] : u[r] = t;
                if (l) {
                    s.length && (this._pending = n);
                    for (var h = 0, f = s.length; h < f; h++) this.trigger("change:" + s[h], this, u[s[h]], n)
                }
                if (c) return this;
                if (l) for (; this._pending;) n = this._pending, this._pending = !1, this.trigger("change", this, n);
                return this._pending = !1, this._changing = !1, this
            }, unset: function (e, t) {
                return this.set(e, void 0, i.extend({}, t, {unset: !0}))
            }, clear: function (e) {
                var t = {};
                for (var n in this.attributes) t[n] = void 0;
                return this.set(t, i.extend({}, e, {unset: !0}))
            }, hasChanged: function (e) {
                return null == e ? !!Object.keys(this.changed).length : i.has(this.changed, e)
            }, changedAttributes: function (e) {
                if (!e) return !!this.hasChanged() && i.extend(Object.create(null), this.changed);
                var t, n = !1, r = this._changing ? this._previousAttributes : this.attributes;
                for (var o in e) i.isEqual(r[o], t = e[o]) || ((n || (n = {}))[o] = t);
                return n
            }, previous: function (e) {
                return null != e && this._previousAttributes ? this._previousAttributes[e] : null
            }, previousAttributes: function () {
                return i.extend(Object.create(null), this._previousAttributes)
            }, fetch: function (e) {
                void 0 === (e = e ? i.extend({}, e) : {}).parse && (e.parse = !0);
                var t = this, n = e.success;
                return e.success = function (i) {
                    if (!t.set(t.parse(i, e), e)) return !1;
                    n && n(t, i, e), t.trigger("sync", t, i, e)
                }, f(this, e), this.sync("read", this, e)
            }, save: function (e, t, n) {
                var r, o, a, s = this.attributes;
                if (null == e || "object" == typeof e ? (r = e, n = t) : (r = {})[e] = t, n = i.extend({validate: !0}, n), r && !n.wait) {
                    if (!this.set(r, n)) return !1
                } else if (!this._validate(r, n)) return !1;
                r && n.wait && (this.attributes = i.extend(Object.create(null), s, r)), void 0 === n.parse && (n.parse = !0);
                var l = this, c = n.success;
                return n.success = function (e) {
                    l.attributes = s;
                    var t = l.parse(e, n);
                    if (n.wait && (t = i.extend(r || {}, t)), t && "object" == typeof t && !l.set(t, n)) return !1;
                    c && c(l, e, n), l.trigger("sync", l, e, n)
                }, f(this, n), "patch" === (o = this.isNew() ? "create" : n.patch ? "patch" : "update") && (n.attrs = r), a = this.sync(o, this, n), r && n.wait && (this.attributes = s), a
            }, destroy: function (e) {
                var t = this, n = (e = e ? i.extend({}, e) : {}).success, r = function () {
                    t.trigger("destroy", t, t.collection, e)
                };
                if (e.success = function (i) {
                    (e.wait || t.isNew()) && r(), n && n(t, i, e), t.isNew() || t.trigger("sync", t, i, e)
                }, this.isNew()) return e.success(), !1;
                f(this, e);
                var o = this.sync("delete", this, e);
                return e.wait || r(), o
            }, url: function () {
                var e = i.result(this, "urlRoot") || i.result(this.collection, "url") || function () {
                    throw new Error('A "url" property or function must be specified')
                }();
                return this.isNew() ? e : e.replace(/([^\/])$/, "$1/") + encodeURIComponent(this.id)
            }, parse: function (e, t) {
                return e
            }, clone: function () {
                return new this.constructor(this.attributes)
            }, isNew: function () {
                return !this.has(this.idAttribute)
            }, isValid: function (e) {
                return this._validate({}, i.extend(e || {}, {validate: !0}))
            }, _validate: function (e, t) {
                if (!t.validate || !this.validate) return !0;
                e = i.extend(Object.create(null), this.attributes, e);
                var n = this.validationError = this.validate(e, t) || null;
                return !n || (this.trigger("invalid", this, n, i.extend(t, {validationError: n})), !1)
            }
        }), i.keys) {
            ["keys", "values", "pairs", "invert", "pick", "omit"].filter(p).forEach(function (e) {
                k.prototype[e] = function () {
                    var t = u.call(arguments);
                    return t.unshift(this.attributes), i[e].apply(i, t)
                }
            })
        }
        var S = a.Collection = function (e, t) {
            t || (t = {}), t.model && (this.model = t.model), void 0 !== t.comparator && (this.comparator = t.comparator), this._reset(), this.initialize.apply(this, arguments), e && this.reset(e, i.extend({broadcast: !0}, t))
        }, E = {add: !0, remove: !0, merge: !0}, F = {add: !0, remove: !1};
        if (i.extend(S.prototype, y, {
            model: void 0 === k ? null : k, initialize: function () {
            }, toJSON: function (e) {
                return this.map(function (t) {
                    return t.toJSON(e)
                })
            }, sync: function () {
                return a.sync.apply(this, arguments)
            }, add: function (e, t) {
                return this.set(e, i.extend({merge: !1}, t, F))
            }, remove: function (e, t) {
                var n = !Array.isArray(e);
                e = n ? [e] : e.slice(), t || (t = {});
                var i, r, o, a;
                for (i = 0, r = e.length; i < r; i++) (a = e[i] = this.get(e[i])) && (delete this._byId[a.id], delete this._byId[a.cid], o = this.indexOf(a), this.models.splice(o, 1), this.length--, t.broadcast && (t.index = o, a.trigger("remove", a, this, t)), this._removeReference(a, t));
                return n ? e[0] : e
            }, set: function (e, t) {
                (t = i.defaults({}, t, E)).parse && (e = this.parse(e, t));
                var n = !Array.isArray(e);
                e = n ? e ? [e] : [] : e.slice();
                var r, o, a, s, l, c, d, u = t.at, h = this.model, f = this.comparator && null == u && !1 !== t.sort,
                    p = "string" == typeof this.comparator ? this.comparator : null, m = [], g = [], v = {}, y = t.add,
                    b = t.merge, w = t.remove, C = !(f || !y || !w) && [];
                for (r = 0, o = e.length; r < o; r++) {
                    if (a = (l = e[r] || {}) instanceof k ? s = l : l[h.prototype.idAttribute || "id"], c = this.get(a)) w && (v[c.cid] = !0), b && (l = l === s ? s.attributes : l, t.parse && (l = c.parse(l, t)), c.set(l, t), f && !d && c.hasChanged(p) && (d = !0)), e[r] = c; else if (y) {
                        if (!(s = e[r] = this._prepareModel(l, t))) continue;
                        m.push(s), this._addReference(s, t)
                    }
                    s = c || s, !C || !s.isNew() && v[s.id] || C.push(s), v[s.id] = !0
                }
                if (w) {
                    for (r = 0, o = this.length; r < o; ++r) v[(s = this.models[r]).cid] || g.push(s);
                    g.length && this.remove(g, t)
                }
                if (m.length || C && C.length) if (f && (d = !0), this.length += m.length, null != u) for (r = 0, o = m.length; r < o; r++) this.models.splice(u + r, 0, m[r]); else {
                    C && (this.models.length = 0);
                    var x = C || m;
                    for (r = 0, o = x.length; r < o; r++) this.models.push(x[r])
                }
                if (d && this.sort({broadcast: !1}), t.broadcast) {
                    for (r = 0, o = m.length; r < o; r++) (s = m[r]).trigger("add", s, this, t);
                    (d || C && C.length) && this.trigger("sort", this, t)
                }
                return n ? e[0] : e
            }, reset: function (e, t) {
                t || (t = {});
                for (var n = 0, r = this.models.length; n < r; n++) this._removeReference(this.models[n], t);
                return t.previousModels = this.models, this._reset(), e = this.add(e, i.extend({broadcast: !1}, t)), t.broadcast && this.trigger("reset", this, t), e
            }, push: function (e, t) {
                return this.add(e, i.extend({at: this.length}, t))
            }, pop: function (e) {
                var t = this.at(this.length - 1);
                return this.remove(t, e), t
            }, unshift: function (e, t) {
                return this.add(e, i.extend({at: 0}, t))
            }, shift: function (e) {
                var t = this.at(0);
                return this.remove(t, e), t
            }, slice: function () {
                return u.apply(this.models, arguments)
            }, get: function (e) {
                if (null != e) return this._byId[e] || this._byId[e.id] || this._byId[e.cid]
            }, at: function (e) {
                return this.models[e]
            }, where: function (e, t) {
                return e && Object.keys(e).length ? this[t ? "find" : "filter"](function (t) {
                    for (var n in e) if (e[n] !== t.get(n)) return !1;
                    return !0
                }) : t ? void 0 : []
            }, findWhere: function (e) {
                return this.where(e, !0)
            }, sort: function (e) {
                if (!this.comparator) throw new Error("Cannot sort a set without a comparator");
                return e || (e = {}), "string" == typeof this.comparator || 1 === this.comparator.length ? this.models = this.sortBy(this.comparator, this) : this.models.sort(this.comparator.bind(this)), e.broadcast && this.trigger("sort", this, e), this
            }, pluck: function (e) {
                return this.models.map(function (t) {
                    return t.get(e)
                })
            }, fetch: function (e) {
                void 0 === (e = e ? i.extend({}, e) : {}).parse && (e.parse = !0);
                var t = e.success, n = this;
                return e.success = function (i) {
                    var r = e.reset ? "reset" : "set";
                    n[r](i, e), t && t(n, i, e), n.trigger("sync", n, i, e)
                }, f(this, e), this.sync("read", this, e)
            }, create: function (e, t) {
                if (t = t ? i.extend({}, t) : {}, !(e = this._prepareModel(e, t))) return !1;
                t.wait || this.add(e, t);
                var n = this, r = t.success;
                return t.success = function (e, i) {
                    t.wait && n.add(e, t), r && r(e, i, t)
                }, e.save(null, t), e
            }, parse: function (e, t) {
                return e
            }, clone: function () {
                return new this.constructor(this.models)
            }, _reset: function () {
                this.length = 0, this.models = [], this._byId = Object.create(null)
            }, _prepareModel: function (e, t) {
                if (e instanceof k) return e;
                (t = i.extend({}, t)).collection = this;
                var n = new this.model(e, t);
                return n.validationError ? (this.trigger("invalid", this, n.validationError, t), !1) : n
            }, _addReference: function (e, t) {
                this._byId[e.cid] = e, null != e.id && (this._byId[e.id] = e), e.collection || (e.collection = this), e.on("all", this._onModelEvent, this)
            }, _removeReference: function (e, t) {
                this === e.collection && delete e.collection, e.off("all", this._onModelEvent, this)
            }, _onModelEvent: function (e, t, n, i) {
                ("add" !== e && "remove" !== e || n === this) && ("destroy" === e && this.remove(t, i), t && e === "change:" + t.idAttribute && (delete this._byId[t.previous(t.idAttribute)], null != t.id && (this._byId[t.id] = t)), this.trigger.apply(this, arguments))
            }, toArray: function () {
                return this.models || []
            }
        }), p("each")) {
            ["forEach", "each", "map", "collect", "reduce", "foldl", "inject", "reduceRight", "foldr", "find", "detect", "filter", "select", "reject", "every", "all", "some", "any", "include", "contains", "invoke", "max", "min", "toArray", "size", "first", "head", "take", "initial", "rest", "tail", "drop", "last", "without", "difference", "indexOf", "shuffle", "lastIndexOf", "isEmpty", "chain"].filter(p).forEach(function (e) {
                S.prototype[e] = function () {
                    var t = u.call(arguments);
                    return t.unshift(this.models), i[e].apply(i, t)
                }
            });
            ["groupBy", "countBy", "sortBy"].filter(p).forEach(function (e) {
                S.prototype[e] = function (t, n) {
                    var r = "function" == typeof t ? t : function (e) {
                        return e.get(t)
                    };
                    return i[e](this.models, r, n)
                }
            })
        } else ["forEach", "map", "filter", "some", "every", "reduce", "reduceRight", "indexOf", "lastIndexOf"].forEach(function (e) {
            S.prototype[e] = function (t, n) {
                return this.models[e](t, n)
            }
        }), S.prototype.find = function (e, t) {
            var n;
            return this.some(function (i, r, o) {
                if (e.call(t, i, r, o)) return n = i, !0
            }), n
        }, ["sortBy"].forEach(function (e) {
            S.prototype[e] = function (t, n) {
                var r = "function" == typeof t ? t : function (e) {
                    return e.get(t)
                };
                return i[e](this.models, r, n)
            }
        });
        ["Model", "Collection", "Router", "View", "History"].forEach(function (e) {
            var t = a[e];
            t && (t.extend = a.extend)
        }), i.extend(a, y)
    }), $__System.registerDynamic("13", [], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i = /^[\s\u200b]+$/, r = function (e) {
                return null == e || void 0 == e || "" === e || "​" === e
            }, o = function (e, t, n) {
                return null == e || void 0 == e || "" == e ? "" : "string" != typeof e && "number" != typeof e ? e : (e = (e + "").replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#39;"), t && (e = a(e)), e)
            }, a = function (e) {
                return e.replace(/[[\]~`*\\$<]/g, "\\$&").replace(/(\b_)|(_(?=\s))/g, "\\$&")
            }, s = /^\s*(([\w-_]+:\/\/)|(www\.)|\w*\/)[\w-.\/?%&=:@]*/i,
            l = /^\s*(([\w-_]+:\/\/)|(www\.)|\w*\/)?[\w-.\/?%&=:@]+(\.jpe?g|png|gif|webp|svg|tiff)/i,
            c = function (e, t, n) {
                return e.replace(new RegExp("\\b" + t + "\\b", "gi"), n)
            }, d = function (e, t) {
                var n = e.getHours() + "", i = e.getMinutes() + "", r = e.getSeconds() + "";
                return (n.length < 2 ? "0" : "") + n + ":" + (i.length < 2 ? "0" : "") + i + (t ? (r.length < 2 ? "0" : "") + r : "")
            }, u = function (e, t) {
                if (!e) return t;
                t = t || "";
                var n = e.split("/"), i = t.split("/");
                n.pop();
                for (var r = 0; r < i.length; r++) "." != i[r] && (".." == i[r] ? n.pop() : n.push(i[r]));
                return n.join("/")
            };
        String.prototype.replaceExact = function (e, t) {
            return c(this, e, t)
        }, String.prototype.repeat = function (e) {
            return (!$.isNumeric(e) || e < 0) && (console.sendError("String.prototype.repeat only accepts non-nagitive number"), e = 0), new Array(e - 0 + 1).join(this)
        }, String.prototype.startsWith = String.prototype.startsWith || function (e) {
            return this.match("^" + e) === e
        }, String.prototype.endsWith = String.prototype.endsWith || function (e) {
            return this.match(e + "$") === e
        }, String.prototype.format = function () {
            var e = arguments;
            return this.replace(/\{\d+\}/g, function (t) {
                return e[t.match(/\d+/)]
            })
        }, String.prototype.trim = function () {
            return this.replace(/^\s+|\s+$/g, "")
        };
        for (var h = [{base: "A", letters: "AⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ"}, {
            base: "AA",
            letters: "Ꜳ"
        }, {base: "AE", letters: "ÆǼǢ"}, {base: "AO", letters: "Ꜵ"}, {base: "AU", letters: "Ꜷ"}, {
            base: "AV",
            letters: "ꜸꜺ"
        }, {base: "AY", letters: "Ꜽ"}, {base: "B", letters: "BⒷＢḂḄḆɃƂƁ"}, {
            base: "C",
            letters: "CⒸＣĆĈĊČÇḈƇȻꜾ"
        }, {base: "D", letters: "DⒹＤḊĎḌḐḒḎĐƋƊƉꝹ"}, {base: "DZ", letters: "ǱǄ"}, {base: "Dz", letters: "ǲǅ"}, {
            base: "E",
            letters: "EⒺＥÈÉÊỀẾỄỂẼĒḔḖĔĖËẺĚȄȆẸỆȨḜĘḘḚƐƎ"
        }, {base: "F", letters: "FⒻＦḞƑꝻ"}, {base: "G", letters: "GⒼＧǴĜḠĞĠǦĢǤƓꞠꝽꝾ"}, {
            base: "H",
            letters: "HⒽＨĤḢḦȞḤḨḪĦⱧⱵꞍ"
        }, {base: "I", letters: "IⒾＩÌÍÎĨĪĬİÏḮỈǏȈȊỊĮḬƗ"}, {base: "J", letters: "JⒿＪĴɈ"}, {
            base: "K",
            letters: "KⓀＫḰǨḲĶḴƘⱩꝀꝂꝄꞢ"
        }, {base: "L", letters: "LⓁＬĿĹĽḶḸĻḼḺŁȽⱢⱠꝈꝆꞀ"}, {base: "LJ", letters: "Ǉ"}, {
            base: "Lj",
            letters: "ǈ"
        }, {base: "M", letters: "MⓂＭḾṀṂⱮƜ"}, {base: "N", letters: "NⓃＮǸŃÑṄŇṆŅṊṈȠƝꞐꞤ"}, {
            base: "NJ",
            letters: "Ǌ"
        }, {base: "Nj", letters: "ǋ"}, {base: "O", letters: "OⓄＯÒÓÔỒỐỖỔÕṌȬṎŌṐṒŎȮȰÖȪỎŐǑȌȎƠỜỚỠỞỢỌỘǪǬØǾƆƟꝊꝌ"}, {
            base: "OI",
            letters: "Ƣ"
        }, {base: "OO", letters: "Ꝏ"}, {base: "OU", letters: "Ȣ"}, {base: "OE", letters: "Œ"}, {
            base: "oe",
            letters: "œ"
        }, {base: "P", letters: "PⓅＰṔṖƤⱣꝐꝒꝔ"}, {base: "Q", letters: "QⓆＱꝖꝘɊ"}, {
            base: "R",
            letters: "RⓇＲŔṘŘȐȒṚṜŖṞɌⱤꝚꞦꞂ"
        }, {base: "S", letters: "SⓈＳẞŚṤŜṠŠṦṢṨȘŞⱾꞨꞄ"}, {base: "T", letters: "TⓉＴṪŤṬȚŢṰṮŦƬƮȾꞆ"}, {
            base: "TZ",
            letters: "Ꜩ"
        }, {base: "U", letters: "UⓊＵÙÚÛŨṸŪṺŬÜǛǗǕǙỦŮŰǓȔȖƯỪỨỮỬỰỤṲŲṶṴɄ"}, {base: "V", letters: "VⓋＶṼṾƲꝞɅ"}, {
            base: "VY",
            letters: "Ꝡ"
        }, {base: "W", letters: "WⓌＷẀẂŴẆẄẈⱲ"}, {base: "X", letters: "XⓍＸẊẌ"}, {
            base: "Y",
            letters: "YⓎＹỲÝŶỸȲẎŸỶỴƳɎỾ"
        }, {base: "Z", letters: "ZⓏＺŹẐŻŽẒẔƵȤⱿⱫꝢ"}, {
            base: "a",
            letters: "aⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐ"
        }, {base: "aa", letters: "ꜳ"}, {base: "ae", letters: "æǽǣ"}, {base: "ao", letters: "ꜵ"}, {
            base: "au",
            letters: "ꜷ"
        }, {base: "av", letters: "ꜹꜻ"}, {base: "ay", letters: "ꜽ"}, {base: "b", letters: "bⓑｂḃḅḇƀƃɓ"}, {
            base: "c",
            letters: "cⓒｃćĉċčçḉƈȼꜿↄ"
        }, {base: "d", letters: "dⓓｄḋďḍḑḓḏđƌɖɗꝺ"}, {base: "dz", letters: "ǳǆ"}, {
            base: "e",
            letters: "eⓔｅèéêềếễểẽēḕḗĕėëẻěȅȇẹệȩḝęḙḛɇɛǝ"
        }, {base: "f", letters: "fⓕｆḟƒꝼ"}, {base: "g", letters: "gⓖｇǵĝḡğġǧģǥɠꞡᵹꝿ"}, {
            base: "h",
            letters: "hⓗｈĥḣḧȟḥḩḫẖħⱨⱶɥ"
        }, {base: "hv", letters: "ƕ"}, {base: "i", letters: "iⓘｉìíîĩīĭïḯỉǐȉȋịįḭɨı"}, {
            base: "j",
            letters: "jⓙｊĵǰɉ"
        }, {base: "k", letters: "kⓚｋḱǩḳķḵƙⱪꝁꝃꝅꞣ"}, {base: "l", letters: "lⓛｌŀĺľḷḹļḽḻſłƚɫⱡꝉꞁꝇ"}, {
            base: "lj",
            letters: "ǉ"
        }, {base: "m", letters: "mⓜｍḿṁṃɱɯ"}, {base: "n", letters: "nⓝｎǹńñṅňṇņṋṉƞɲŉꞑꞥ"}, {
            base: "nj",
            letters: "ǌ"
        }, {base: "o", letters: "oⓞｏòóôồốỗổõṍȭṏōṑṓŏȯȱöȫỏőǒȍȏơờớỡởợọộǫǭøǿɔꝋꝍɵ"}, {base: "oi", letters: "ƣ"}, {
            base: "ou",
            letters: "ȣ"
        }, {base: "oo", letters: "ꝏ"}, {base: "p", letters: "pⓟｐṕṗƥᵽꝑꝓꝕ"}, {base: "q", letters: "qⓠｑɋꝗꝙ"}, {
            base: "r",
            letters: "rⓡｒŕṙřȑȓṛṝŗṟɍɽꝛꞧꞃ"
        }, {base: "s", letters: "sⓢｓßśṥŝṡšṧṣṩșşȿꞩꞅẛ"}, {base: "t", letters: "tⓣｔṫẗťṭțţṱṯŧƭʈⱦꞇ"}, {
            base: "tz",
            letters: "ꜩ"
        }, {base: "u", letters: "uⓤｕùúûũṹūṻŭüǜǘǖǚủůűǔȕȗưừứữửựụṳųṷṵʉ"}, {base: "v", letters: "vⓥｖṽṿʋꝟʌ"}, {
            base: "vy",
            letters: "ꝡ"
        }, {base: "w", letters: "wⓦｗẁẃŵẇẅẘẉⱳ"}, {base: "x", letters: "xⓧｘẋẍ"}, {
            base: "y",
            letters: "yⓨｙỳýŷỹȳẏÿỷẙỵƴɏỿ"
        }, {
            base: "z",
            letters: "zⓩｚźẑżžẓẕƶȥɀⱬꝣ"
        }], f = {}, p = 0; p < h.length; p++) for (var m = h[p].letters, g = 0; g < m.length; g++) f[m[g]] = h[p].base;
        var v = {"\b": "\\b", "\t": "\\t", "\n": "\\n", "\f": "\\f", "\r": "\\r", '"': '\\"', "'": "\\'", "\\": "\\\\"},
            y = {"&newline;": null, "&tab;": "\t", "&copy;": "©", "&amp;": "&", "&gt": ">", "&lt": "<", "&num;": "#"},
            b = document.createElement("textarea");

        function w(e, t) {
            var n = /\.[^.\\\/]+$/, i = (n.exec(e) || [""])[0], r = (n.exec(e) || [""])[0];
            i.length && i == r && (e = e.replace(n, ""), t = t.replace(n, ""));

            function o(e) {
                for (var t, n, i = [], r = 0, o = -1, a = 0; t = (n = e.charAt(r++)).charCodeAt(0);) {
                    var s = 46 == t || t >= 48 && t <= 57;
                    s !== a && (i[++o] = "", a = s), i[o] += n
                }
                return i
            }

            for (var a = o(e), s = o(t), l = 0; a[l] && s[l]; l++) if (a[l] !== s[l]) {
                var c = Number(a[l]), d = Number(s[l]);
                return c == a[l] && d == s[l] ? c - d : a[l].localeCompare(s[l])
            }
            return a.length - s.length
        }

        w.insensitive = !0;
        var C = [[768, 879], [1155, 1158], [1160, 1161], [1425, 1469], [1471, 1471], [1473, 1474], [1476, 1477], [1479, 1479], [1536, 1539], [1552, 1557], [1611, 1630], [1648, 1648], [1750, 1764], [1767, 1768], [1770, 1773], [1807, 1807], [1809, 1809], [1840, 1866], [1958, 1968], [2027, 2035], [2305, 2306], [2364, 2364], [2369, 2376], [2381, 2381], [2385, 2388], [2402, 2403], [2433, 2433], [2492, 2492], [2497, 2500], [2509, 2509], [2530, 2531], [2561, 2562], [2620, 2620], [2625, 2626], [2631, 2632], [2635, 2637], [2672, 2673], [2689, 2690], [2748, 2748], [2753, 2757], [2759, 2760], [2765, 2765], [2786, 2787], [2817, 2817], [2876, 2876], [2879, 2879], [2881, 2883], [2893, 2893], [2902, 2902], [2946, 2946], [3008, 3008], [3021, 3021], [3134, 3136], [3142, 3144], [3146, 3149], [3157, 3158], [3260, 3260], [3263, 3263], [3270, 3270], [3276, 3277], [3298, 3299], [3393, 3395], [3405, 3405], [3530, 3530], [3538, 3540], [3542, 3542], [3633, 3633], [3636, 3642], [3655, 3662], [3761, 3761], [3764, 3769], [3771, 3772], [3784, 3789], [3864, 3865], [3893, 3893], [3895, 3895], [3897, 3897], [3953, 3966], [3968, 3972], [3974, 3975], [3984, 3991], [3993, 4028], [4038, 4038], [4141, 4144], [4146, 4146], [4150, 4151], [4153, 4153], [4184, 4185], [4448, 4607], [4959, 4959], [5906, 5908], [5938, 5940], [5970, 5971], [6002, 6003], [6068, 6069], [6071, 6077], [6086, 6086], [6089, 6099], [6109, 6109], [6155, 6157], [6313, 6313], [6432, 6434], [6439, 6440], [6450, 6450], [6457, 6459], [6679, 6680], [6912, 6915], [6964, 6964], [6966, 6970], [6972, 6972], [6978, 6978], [7019, 7027], [7616, 7626], [7678, 7679], [8203, 8207], [8234, 8238], [8288, 8291], [8298, 8303], [8400, 8431], [12330, 12335], [12441, 12442], [43014, 43014], [43019, 43019], [43045, 43046], [64286, 64286], [65024, 65039], [65056, 65059], [65279, 65279], [65529, 65531], [68097, 68099], [68101, 68102], [68108, 68111], [68152, 68154], [68159, 68159], [119143, 119145], [119155, 119170], [119173, 119179], [119210, 119213], [119362, 119364], [917505, 917505], [917536, 917631], [917760, 917999]],
            x = {nul: 0, control: 0, tabSize: 4};
        var k = function (e, t) {
            return 0 === e ? t.nul : 9 === e ? t.tabSize : e < 32 || e >= 127 && e < 160 ? t.control : function (e) {
                var t, n = 0, i = C.length - 1;
                if (e < C[0][0] || e > C[i][1]) return !1;
                for (; i >= n;) if (t = Math.floor((n + i) / 2), e > C[t][1]) n = t + 1; else {
                    if (!(e < C[t][0])) return !0;
                    i = t - 1
                }
                return !1
            }(e) ? 0 : 1 + (e >= 4352 && (e <= 4447 || 9001 == e || 9002 == e || e >= 11904 && e <= 42191 && 12351 != e || e >= 44032 && e <= 55203 || e >= 63744 && e <= 64255 || e >= 65040 && e <= 65049 || e >= 65072 && e <= 65135 || e >= 65280 && e <= 65376 || e >= 65504 && e <= 65510 || e >= 131072 && e <= 196605 || e >= 196608 && e <= 262141))
        };
        t.decodeHtmlEntity = function (e) {
            e = e.toLowerCase();
            var t = y[e];
            return t || (b.innerHTML = e, (t = b.value) != e ? y[e] = t : t = null), t
        }, t.formateDateTime = function (e) {
            return e.getFullYear() + "/" + (e.getMonth() + 1) + "/" + e.getDate() + "  " + d(e)
        }, t.formateTimeOnly = d, t.formateDateOnly = function (e) {
            return e.getFullYear() + "-" + (e.getMonth() + 1) + "-" + e.getDate()
        }, t.insert = function (e, t, n) {
            return t < (e = e || "").length ? e.substring(0, t) + n + e.substring(t) : e + n
        }, t.escape = function (e, t, n) {
            return e = o(e, t)
        }, t.escapeForPreWrap = o, t.unescape = function (e) {
            return null == e || void 0 == e || "" == e ? "" : (e + "").replace(/&amp;/g, "&").replace(/&lt;/g, "<").replace(/&gt;/g, ">").replace(/&quot;/g, '"').replace(/&#39;/g, "'")
        }, t.escapeHead = function (e) {
            return e.replace(/(^ *)((#+)|(\+ +)|(\- +)|(\* +)|(\d+\. +)|(```|~~~)|(>)|(-+\s*$))/, "$1\\$2")
        }, t.escapeMark = a, t.escapeSelector = function (e) {
            return window.CSS && CSS.escape ? CSS.escape(e) : $.escapeSelector(e)
        }, t.escapeRegExp = function (e) {
            return e.replace(/[.*+?^${}()|[\]\\]/g, "\\$&")
        }, t.isNullOrEmpty = r, t.isNotNullOrEmpty = function (e) {
            return !r(e)
        }, t.isNullOrBlank = function (e) {
            return null == e || void 0 == e || "" === e || i.exec(e)
        }, t.replaceExact = c, t.splitExact = function (e, t) {
            return e.split(new RegExp("\\b" + t + "\\b", "gi"))
        }, t.trimArr = function (e) {
            if (e && e.length) {
                for (var t = 0, n = e.length - 1; 0 === e[t].trim().length && t < n;) t++;
                for (; n > t && 0 === e[n].trim().length;) n--;
                return e.slice(t, n + 1)
            }
            return e
        }, t.isURL = function (e) {
            return !!s.exec(e)
        }, t.isImg = function (e) {
            return !!l.exec(e)
        }, t.camelize = function (e) {
            return e.replace(/(?:^|_|-)(\w)/g, function (e, t, n) {
                return 0 == n ? t.toLowerCase() : t.toUpperCase()
            })
        }, t.getRelativePath = function (e, t, n) {
            if (!e) return t;
            var i;
            if (File.isNode) return "" == (i = reqnode("path").relative(e, t)) && (i = "./"), i;
            e = e.replace(/\\\\/g, "/").replace(/^\.\//, "");
            var r, o = (t = t.replace(/\\\\/g, "/")).split(/\//g), a = e.split(/\//g), s = o.pop(), l = "";
            for ("" == a.last() && a.pop(), "" == a[0] && a.shift(), "" == o[0] && o.shift(), r = o.join("/"); 0 !== r.indexOf(a.join("/"));) a.pop(), l += "../";
            var c = o.slice(a.length);
            return c.length && (l += c.join("/") + "/"), i = l + s, n && !i.match(/^\.\.\//) && (i = "./" + i), i
        }, t.getAbsolutePath = u, t.getAbsoluteURL = function (e, t) {
            if (!t) return "";
            var n = t.replace(/^[\\\/]{2}/, "http://");
            return e = e || "", n.match(/^[^:]+:\/\//) ? n : n.match(/^[\\\/]/) ? e.replace(/(^[^:]+:\/\/[^\/]+)\/.*/, "$1" + t) : u(e, n)
        }, t.useOrDefault = function (e, t) {
            return e.trim().length ? e : t
        }, t.removeDiacritics = function (e) {
            return (e || "").replace(/[^\u0000-\u007E]/g, function (e) {
                return f[e] || e
            })
        }, t.escapeInQuote = function (e) {
            return e.replace(/["'\\\b\t\n\f\r]/g, function (e) {
                return v[e]
            }).replace(/\u200b/g, "")
        }, t.pathByDeleteLastComponent = function (e) {
            return File.isMac ? e.split("/").slice(0, -1).join("/") : reqnode("path").join(e, "..")
        }, t.getFolder = function (e) {
            return File.isMac ? (e.replace(/[\/]+$/, "").split("/") || []).last() : reqnode("path").basename(e)
        }, t.date2NatrualLang = function (e, t) {
            var n, i, r, o, a, s = new Date, l = (s - e) / 1e3;
            return l < 30 ? n = "just now" : l < 60 ? n = "1 minutes ago" : l < 3600 ? n = Math.floor((l + 30) / 60).toString() + " minutes ago" : l < 18e3 && s.getDay() == e.getDay() ? (i = e.getHours(), r = e.getMinutes(), n = [(i > 9 ? "" : "0") + i, (r > 9 ? "" : "0") + r].join(":")) : l < 172800 && s.getDay() == (e.getDay() + 1) % 7 ? n = t ? "Yesterday" : "yesterday" : l < 518400 ? n = Math.floor(l / 86400) + " days ago" : s.getYear() == e.getYear() ? (a = e.getDate(), n = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"][e.getMonth()] + " " + (a > 9 ? "" : "0") + a) : (o = e.getMonth() + 1, a = e.getDate(), n = [e.getFullYear(), (o > 9 ? "" : "0") + o, (a > 9 ? "" : "0") + a].join("-")), n
        }, t.abbreviatingWithTilde = function (e) {
            return File.isMac ? app.path.abbreviatingWithTilde(e) : File.isUnixNode ? reqnode("fs-plus").tildify(e) : e
        }, t.naturalSort = w, t.wcswidth = function (e) {
            if (!e) return 0;
            var t, n, i, r = 0;
            if ("string" != typeof e) return k(e, x);
            for (var o = 0; o < e.length; o++) {
                if ((t = e.charCodeAt(o)) >= 55296 && t <= 56319 && ((n = e.charCodeAt(++o)) >= 56320 && n <= 57343 ? t = 1024 * (t - 55296) + (n - 56320) + 65536 : o--), (i = k(t, x)) < 0) return -1;
                r += i
            }
            return r
        }, t.removeInvalidPathCh = function (e) {
            return e.replace(/[\u200b\u0000~\u0019\u007f~\u009f\\\/<>:"|?*]/g, "").replace(/[\t\r\n]/g, " ").replace(/([ .]+)$/, "")
        }, t.isFullUrl = function (e) {
            return /^([a-z][a-z0-9+\-.]+):([^\/\/]{2}|\/{2})/i.exec(e)
        }, t.escapeURL = function (e) {
            return e = e || "", encodeURI(e.replace(/\\/g, "/")).replace(/'/, "%27").replace('"', "%22").replace(/#/g, "%23")
        }, t.findLine = function (e, t) {
            for (var n = e.split(/\n/), i = 0, r = 0; t > 0 && i < n.length && t > r + n[i].length;) r += n[i].length + 1, i++;
            return {line: n[i] || "", start: r}
        }, t.isUTF8 = function (e) {
            for (var t = 0, n = Math.min(e.length, 12e3); t < n;) if (9 == e[t] || 10 == e[t] || 13 == e[t] || 32 <= e[t] && e[t] <= 126) t += 1; else if (194 <= e[t] && e[t] <= 223 && 128 <= e[t + 1] && e[t + 1] <= 191) t += 2; else if (224 == e[t] && 160 <= e[t + 1] && e[t + 1] <= 191 && 128 <= e[t + 2] && e[t + 2] <= 191 || (225 <= e[t] && e[t] <= 236 || 238 == e[t] || 239 == e[t]) && 128 <= e[t + 1] && e[t + 1] <= 191 && 128 <= e[t + 2] && e[t + 2] <= 191 || 237 == e[t] && 128 <= e[t + 1] && e[t + 1] <= 159 && 128 <= e[t + 2] && e[t + 2] <= 191) t += 3; else {
                if (!(240 == e[t] && 144 <= e[t + 1] && e[t + 1] <= 191 && 128 <= e[t + 2] && e[t + 2] <= 191 && 128 <= e[t + 3] && e[t + 3] <= 191 || 241 <= e[t] && e[t] <= 243 && 128 <= e[t + 1] && e[t + 1] <= 191 && 128 <= e[t + 2] && e[t + 2] <= 191 && 128 <= e[t + 3] && e[t + 3] <= 191 || 244 == e[t] && 128 <= e[t + 1] && e[t + 1] <= 143 && 128 <= e[t + 2] && e[t + 2] <= 191 && 128 <= e[t + 3] && e[t + 3] <= 191)) return !1;
                t += 4
            }
            return !0
        }, t.WESTERN_WORD_SPLITER = /([\u3040-\uABFF\uD7A4-\uFAFF\s!-#%-\*,-\/:;\?@\[-\]\{\}\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E49\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65])/, t.NOT_WORD = /[\s!-#%-\*,-\/:;\?@\[-\]\{\}\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E49\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]/, t.WORD_LETTER = /[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/
    }), $__System.registerDynamic("12", ["11", "13"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i = e("11"), r = e("13"), o = {
            paragraph: "paragraph",
            heading: "heading",
            blockquote: "blockquote",
            fences: "fences",
            hr: "hr",
            def_link: "def_link",
            def_footnote: "def_footnote",
            table: "table",
            raw_edit: "raw_edit",
            meta_block: "meta_block",
            math_block: "math_block",
            html_block: "html_block",
            list: "list",
            toc: "toc",
            iframe: "iframe"
        }, a = {list_item: "list_item", table_row: "table_row", table_cell: "table_cell"}, s = {};
        i.utils.extend(s, o, a, {
            tab: "tab",
            plain: "plain",
            strong: "strong",
            em: "em",
            code: "code",
            underline: "underline",
            escape: "escape",
            autolink: "autolink",
            reflink: "reflink",
            refimg: "refimg",
            link: "link",
            url: "url",
            br: "br",
            tag: "tag",
            comment: "comment",
            atag: "atag",
            imgtag: "imgtag",
            del: "del",
            todo: "todo",
            image: "image",
            footnote: "footnote",
            attr: "attr",
            emoji: "emoji",
            inline_math: "inline_math",
            subscript: "subscript",
            superscript: "superscript",
            linebreak: "linebreak",
            highlight: "highlight",
            html_entity: "html_entity",
            pants: "pants",
            emptyline: "emptyline",
            softbreak: "softbreak",
            html_inline: "html_inline",
            ruby: "ruby"
        });
        var l = 0, c = function () {
                return "n" + l++
            }, d = i.Model.extend({
                initialize: function () {
                    var e = this.get("id") || c();
                    this.get("id") || this.set("id", e), d.pool[e] && console.warn("Duplicate Model"), d.pool[e] = this, this.TYPE = s, this.set("text", this.get("text") || ""), this.set("broadcast", !1), this.set("children", new h)
                }, isBlock: function (e) {
                    return d.isBlock(this.get("type"), e)
                }, isTopBlock: function () {
                    return this.get("attachTo") && !this.get("parent")
                }, isVirtualBlock: function () {
                    return d.isVirtualBlock(this.get("type"))
                }, getClosetBlock: function (e) {
                    return this.isBlock(e) ? this : this.get("parent").getClosetBlock(e)
                }, getTopBlock: function () {
                    return this.isTopBlock() ? this : this.get("parent").getTopBlock()
                }, isInline: function () {
                    return !this.isBlock(!0)
                }, getLastChild: function () {
                    try {
                        return this.get("children").at(this.get("children").length - 1).getLastBrother(!1)
                    } catch (e) {
                        return null
                    }
                }, getFirstChild: function () {
                    try {
                        var e = this.get("children").at(0);
                        return e && e.getLastBrother(!0)
                    } catch (e) {
                        return null
                    }
                }, escapedMark: function (e) {
                    return e.replace(/\*/g, "*").replace(/_/g, "_").replace(/`/g, "`")
                }, isLoose: function (e) {
                    function t(e) {
                        for (var t = e.getFirstChild(), n = 0, i = 0; t;) {
                            if (d.isType(t, s.paragraph)) n++; else {
                                if (!d.isType(t, s.list)) return !0;
                                if (d.isType(t.get("after"), s.paragraph) || t.isLoose()) return !0;
                                i++
                            }
                            t = t.get("after")
                        }
                        return !(n <= 1 && i <= 1)
                    }

                    for (var n = this.getFirstChild(), i = n, r = !1; i;) {
                        if (t(i)) {
                            r = !0;
                            break
                        }
                        i = i.get("after")
                    }
                    if (e) for (i = n; i;) i.set("tight", !r), i = i.get("after");
                    return r
                }, safeGetStrAttr: function (e, t) {
                    if ("href-title" == e) return this.safeGetStrAttr("href") + " " + this.safeGetStrAttr("title");
                    var n = this.get(e) ? this.get(e) : "";
                    return t ? r.escape(n) : n
                }, replaceWith: function (e) {
                    e.id != this.id && (e.get("after") && e.get("after").set("before", e.get("before")), e.get("before") && e.get("before").set("after", e.get("after")), e.set("parent", this.get("parent")), e.set("before", this.get("before")), e.set("after", this.get("after")), this.remove())
                }, giveChildrenTo: function (e, t, n, i) {
                    if (0 != this.get("children").length) {
                        var r = t || this.getFirstChild();
                        for (i && (t = t || r, n = n || this.getLastChild(), t.get("before") && t.get("before").set("after", n.get("after")), t.set("before", null), t.set("in", this.get("in")), n.set("after", null), n.set("in", this.get("in"))), e.set("text", ""); r;) r.set("parent", e), r = r.get("after")
                    }
                }, append: function (e, t) {
                    if (e) return e.detach(), this.get("children").length ? t ? this.getFirstChild().insert(e, !0) : this.getLastChild().insert(e) : (e.set("in", this.get("in")), e.set("parent", this)), e
                }, appendTillEnd: function (e, t) {
                    if (e) {
                        var n = null, i = this.getLastChild();
                        do {
                            n = e.get("after"), e.detach(), i ? i.insert(e) : (e.set("parent", this), e.set("in", this.get("in"))), t && e.unset("userIndent"), i = e, e = n
                        } while (n)
                    }
                }, insertTillEnd: function (e) {
                    if (e) {
                        var t = null, n = this;
                        do {
                            t = e.get("after"), e.detach(), n.insert(e), n = e, e = t
                        } while (t)
                    }
                }, insert: function (e, t) {
                    if (e) {
                        if (e instanceof Array) return console.warning("deprecate, use insertArray"), this.insertArray(e, t);
                        var n = t ? "before" : "after";
                        return this.get(n) !== e && (e.detach(), e.set(n, this.get(n)), this.set(n, e)), e.set("in", this.get("in")), e.set("parent", this.get("parent")), e.set("attachTo", this.get("attachTo")), e
                    }
                }, insertArray: function (e, t, n) {
                    if (e && e.length) {
                        var i = t ? "before" : "after", r = n ? e[0] : e[0].getLastBrother(!0),
                            o = n ? e.last() : e.last().getLastBrother(!1);
                        "before" === i ? (r.set("before", this.get("before")), o.set("after", this)) : (o.set("after", this.get("after")), r.set("before", this));
                        for (var a = 0; a < e.length; a++) e[a].set("in", this.get("in")), e[a].set("parent", this.get("parent")), e[a].set("attachTo", this.get("attachTo")), n && a > 0 && e[a].set("before", e[a - 1]);
                        return r
                    }
                }, clearChildren: function () {
                    this.get("in");
                    this.get("children").forEach(function (e) {
                        e.delete()
                    })
                }, canContainBlock: function (e) {
                    return d.canContainBlock(this.get("type"), e)
                }, canNotDirectEdit: function () {
                    return d.isType(this, s.hr, s.math_block, s.list, s.list_item, s.toc)
                }, getText: function (e, t) {
                    var n = [], i = this.get("children");
                    if (t = t || "", this.canContainBlock(!0) || i && i.length > 0) i.forEach(function (t) {
                        n.push(t.getText(e))
                    }), n = n.join(t), this.unset("text"); else {
                        if (this.get("type") == s.def_link) return this.get("href") + (this.get("title") || "");
                        n = this.get("text") || "", e && d.isType(this, s.heading, s.paragraph) && (n = r.escapeHead(n))
                    }
                    return n
                }, getNthChild: function (e) {
                    try {
                        for (var t = this.get("children").at(0).getLastBrother(!0), n = 0; t && n < e;) n++, t = t.get("after");
                        return t
                    } catch (e) {
                    }
                    return null
                }, getChildIndex: function () {
                    for (var e = this.get("before"), t = 0; e;) e = e.get("before"), t++;
                    return t
                }, getVeryFirst: function (e) {
                    return 0 == this.get("children").length ? this : (e ? this.getLastChild() : this.getFirstChild()).getVeryFirst(e)
                }, getLastBrother: function (e, t, n) {
                    var i = e ? "before" : "after", r = this.get("in").blocks;
                    if (this.isTopBlock()) {
                        if (t) return null;
                        if (!n && r.length) return r.at(e ? 0 : r.length - 1).getLastBrother(e, !1, !0)
                    }
                    return this.get(i) ? this.attributes[i].getLastBrother(e, t, !0) : this
                }, getVeryFirstBrotherIncludeTopBlock: function (e) {
                    return this.getVeryFirstBrother(e, !0)
                }, getVeryFirstBrother: function (e, t) {
                    var n = e ? "before" : "after";
                    return !t && this.isTopBlock() ? null : !this.get(n) && this.get("parent") ? this.get("parent").getVeryFirstBrother(e, t) : this.get(n) ? this.get(n).getVeryFirst(e) : null
                }, getClosetParagraphLevel: function () {
                    return this
                }, contains: function (e) {
                    return !!e && (this.id == e.id || this.contains(e.get("parent")))
                }, closest: function () {
                    for (var e = this.get("type"), t = 0; t < arguments.length; t++) if (e == arguments[t]) return this;
                    var n = this.get("parent");
                    return n ? d.prototype.closest.apply(n, arguments) : null
                }, isStyled: function () {
                    var e = this.get("type");
                    return e == s.strong || e == s.em || e == s.code
                }, isSeperated: function () {
                    var e = this.get("type");
                    return this.canNotDirectEdit() || e == s.code || e == s.escape
                }, isDeleted: function () {
                    return void 0 == this.attributes
                }, delete: function (e) {
                    this.attributes && (this.set("parent", null), this.set("after", null), this.set("before", null), this.set("in", null), e ? this.get("children").toArray().map(function (e) {
                        e.attributes.parent = null
                    }) : this.clearChildren()), d.pool[this.cid] = void 0, this.attributes = void 0
                }, remove: function (e) {
                    var t = this.get("before"), n = this.get("after");
                    this.delete(e), t && t.set("after", n), n && n.set("before", t)
                }, detach: function () {
                    var e = this.get("before"), t = this.get("after");
                    e && e.set("after", t), t && t.set("before", e), this.set("parent", null), this.set("attachTo", null)
                }, clearEmptyChar: function () {
                    var e = this.attributes.text;
                    e && (e = this.get("type") == s.paragraph ? e.replace(/\u200B([^\s]|$)/g, "$1") : e.replace(/\u200B/g, ""), this.attributes.text = e)
                }, get: function (e) {
                    if (!this.attributes) return console.stackError("attributes for node has been deleted"), null;
                    var t = this.attributes[e];
                    switch (e) {
                        case"text":
                            return t = t || "", d.isType(this, s.math_block) && (t = t.replace(/^(\w*)\$\$(\w*)$/m, "$1\\$$$$$2")), t;
                        default:
                            return t
                    }
                }, set: function (e, t) {
                    var n, i, r = this, o = this.get("in"), a = function (e) {
                        e && e.attributes && (d.isType(e, s.blockquote, s.list_item) ? e.unset("userIndent") : d.isType(e, s.list) && !e.get("isFixed") && l(e), a(e.get("parent")))
                    }, l = function (e) {
                        if (e && e.attributes && !e.get("type") != s.list && e.attributes.style) for (var t = e.getFirstChild(); t;) t.unset("userIndent"), t = t.get("after")
                    };
                    if ("string" == typeof e) {
                        switch (i = this.get(e), e) {
                            case"parent":
                                i && i.attributes && (i.get("children").remove(this), a(i)), t && t.get("children").add(this);
                                break;
                            case"before":
                                i && i.attributes && (i.attributes.after = null), t && (t && t.attributes.after && t.attributes.after.attributes && (t.attributes.after.attributes.before = null), t.attributes.after = this);
                                break;
                            case"after":
                                i && i.attributes && (i.attributes.before = null), t && (t && t.attributes.before && t.attributes.before.attributes && (t.attributes.before.attributes.after = null), t.attributes.before = this);
                                break;
                            case"attachTo":
                                i && i.blocks.remove(this), t && t.blocks.add(this);
                                break;
                            case"in":
                                var h = this.get("attachTo");
                                i && (i.foot_list.remove(this), i.link_list.remove(this), i.blocks.remove(this), i.allNodes.remove(this)), t && (this.get("type") != s.def_footnote || t.foot_list.get(this.id) ? this.get("type") != s.def_link || t.link_list.get(this.id) || t.link_list.push(this) : t.foot_list.push(this), t.allNodes.add(this), h && this.set("attachTo", h));
                                break;
                            case"id":
                                t && (this.id = t, this.cid = t);
                                break;
                            case"ref":
                                t = t ? t.replace(/\u200b/gi, "").replace(/\\?\]/gi, "\\]") : t;
                                break;
                            case"href":
                                t = t && this.get("type") === s.def_link ? t.replace(/\[|\]|"]/gi, "") : t;
                                break;
                            case"title":
                                break;
                            case"type":
                                t != i && (u.forEach(function (e) {
                                    this.attributes[e] = void 0
                                }, this), this.attributes.ahead = void 0, this.attributes.tail = void 0, this.attributes.mathLabel = void 0, this.attributes.mathEqLabel = void 0);
                                break;
                            case"text":
                                (function (e) {
                                    if (this.get("type") == s.table_cell && void 0 !== this.attributes.text) {
                                        var t = (e || "").length - (this.attributes.text || "").length;
                                        if (t) {
                                            d.tryResetTable(this.closest(s.table));
                                            var n = this.attributes.marginLeft, i = this.attributes.marginRight, r = 0;
                                            n && (i.length > n.length && (r = Math.min(i.length - 1, t), i = i.substring(0, i.length - r), t -= r), t > 0 && n.length > i.length && (r = Math.min(n.length - 1, t), n = n.substring(0, n.length - r)), !i && n.length && (i = " ", n = " "), this.attributes.marginLeft = n, this.attributes.marginRight = i)
                                        }
                                    }
                                }).call(this, t);
                                break;
                            case"style":
                                l(this)
                        }
                        this.attributes[e] = t, function () {
                            var n = this.get("in") || o,
                                a = "type" === e && i === s.heading || this.get("type") == s.heading && d.isType(e, "depth", "text", "parent", "before", "after");
                            n && n.toc && i != t && a && ("text" == e ? setTimeout(function () {
                                n.toc.updateHeaderText(r)
                            }, 10) : n.toc.refresh(!1)), this.get("type") === s.def_link && i != t && ("ref" === e ? (File.editor.imgEdit.willUpdateImgRef(i), File.editor.imgEdit.willUpdateImgRef(t)) : "text" === e && File.editor.imgEdit.willUpdateImgRef(this.get("ref"))), n && n.toc && "type" == e && t == s.toc && setTimeout(function () {
                                n.toc.refresh()
                            }, 20)
                        }.call(this), function () {
                            var n = this.get("in") || o;
                            "type" === e && n && (i === s.def_footnote && n.foot_list.remove(this), i === s.def_link && n.link_list.remove(this), t === s.def_footnote && n.foot_list.push(this), t === s.def_link && n.link_list.push(this)), d.isType(this.get("type"), s.def_link, s.def_link) && File.editor.docMenu.resizeFooter()
                        }.call(this), function () {
                            this.get("in");
                            (this.get("type") == s.meta_block && "text" == e || "type" == e && (i == s.meta_block || t == s.meta_block)) && File.isNode && File.refreshImageCopyStatus(!0)
                        }.call(this)
                    } else {
                        this.id || e.id || (e.id = c()), e.id && this.set("id", e.id), e.in && this.set("in", e.in), e.attachTo && this.set("attachTo", e.attachTo), e.type && this.set("type", e.type);
                        for (n in e) -1 == ["id", "in", "attachTo", "type", "marginLeft", "marginRight"].indexOf(n) && d.prototype.set.call(this, n, e[n]);
                        void 0 !== e.marginLeft && (this.set("marginLeft", e.marginLeft), this.set("marginRight", e.marginRight))
                    }
                    return this
                }
            }),
            u = ["depth", "lang", "pattern", "align", "style", "displayStyle", "checked", "history", "alt", "attr", "prespace", "subindent", "markindent", "marginLeft", "marginRight", "alignText", "userText", "userIndent", "isFixed", "tagBefore", "tagAfter"];
        d.property = ["text", "type", "ahead", "tail", "header", "href", "title", "ref", "start", "width", "height"].concat(u), d.isBlock = function (e, t) {
            return o[e] || t && a[e]
        }, d.isVirtualBlock = function (e) {
            return a[e]
        }, d.canContainBlock = function (e, t) {
            return e == s.blockquote || e == s.list || e == s.list_item || t && (e == s.table_row || e == s.table)
        }, d.noChangeLine = function (e) {
            for (var t = e; t;) {
                if (d.isType(e, s.table_cell, s.def_footnote, s.def_link)) return !0;
                t = t.get("parent")
            }
            return !1
        }, d.isType = function (e) {
            if (null !== e && void 0 !== e && !1 !== e) {
                var t = "object" == typeof e && e.attributes ? e.attributes.type : e;
                if (arguments[1] instanceof Array) return d.isType.apply(null, [t].concat(arguments[1]));
                for (var n = 1; n < arguments.length; n++) if (t == arguments[n]) return !0;
                return !(arguments.length > 1) && void 0
            }
        };
        var h = function () {
            this.reset(), Object.defineProperty(this, "length", {
                get: function () {
                    return this._set.length
                }
            })
        };
        h.prototype.get = function (e) {
            return this._map.get(e)
        }, h.prototype.add = function (e) {
            e.cid && this._map.set(e.cid, e), this._set.push(e)
        }, h.prototype.remove = function (e) {
            this._set.remove(e), e.cid && this._map.delete(e.cid)
        }, h.prototype.at = function (e) {
            return this._set[e]
        }, h.prototype.first = function () {
            return this._set[0]
        }, h.prototype.sortedFirst = function () {
            for (var e = this.first(); e && e.get("before");) e = e.get("before");
            return e
        }, h.prototype.toArray = function () {
            return this._set.clone()
        }, h.prototype.reset = function () {
            this._set = [], this._map = new Map
        }, h.prototype.forEach = function (e, t) {
            this._set.clone().forEach(e, t)
        }, h.prototype.map = function (e, t) {
            return this._set.clone().map(e, t)
        }, h.prototype.sortedForEach = function (e, t) {
            for (var n = this.sortedFirst(); n;) e.call(t, n), n = n.get("after")
        }, h.prototype.update = function (e) {
            e.cid && this._map.set(e.cid, e)
        }, d.pool = {};
        var f = {
            toHTML: function (e) {
                var t = [], n = "";
                if (e.length) {
                    var i = e instanceof Array, r = i ? e[0] : e.at(0);
                    if (!i) for (; r.get("before");) r = r.get("before");
                    File.option.ignoreLineBreak && (n = "\n");
                    do {
                        t.push(r.toHTML()), r = r.get("after")
                    } while (r && (!i || e.indexOf(r) > -1))
                }
                return t.join(n || "")
            }
        }, p = function () {
            this.blocks = new h, this.allNodes = new h, this.foot_list = [], this.link_list = []
        };
        p.prototype.storeToJson = function () {
            return {
                blocks: this.blocks.map(function (e) {
                    return e.storeToJson()
                }), nid: l
            }
        }, p.prototype.restoreFromJson = function (e) {
            this.reset();
            e.blocks.map(function (e) {
                return d.readFromJson(e, this, !0)
            }, this).map(function (t, n) {
                t.set("before", this.allNodes.get(e.blocks[n].relation.before_id)), t.set("after", this.allNodes.get(e.blocks[n].relation.after_id))
            }, this), l = e.nid - 0, this.toc && this.toc.refresh(!0, !0)
        }, p.prototype.get = function (e) {
            switch (e) {
                case"allNodes":
                    return this.allNodes;
                case"blocks":
                    return this.blocks
            }
        }, p.prototype.reset = function (e, t) {
            this.blocks.forEach(function (e) {
                e.delete()
            }), this.blocks.reset(), !e && this.allNodes.length && console.warn("nodeMap not clean"), this.allNodes.reset(), this.foot_list instanceof Array ? (this.foot_list = [], this.link_list = []) : (this.foot_list.reset(), this.link_list.reset()), d.pool = {}, t && (l = 0)
        }, p.prototype.getFirst = function () {
            return this.blocks.sortedFirst()
        }, p.prototype.getLast = function () {
            if (this.blocks.length > 0) {
                var e = this.blocks.at(this.blocks.length - 1);
                return e = e.getLastBrother(!1)
            }
            return null
        }, d.backToParagraphBeforeDelete = [s.heading, s.def_footnote, s.def_link, s.meta_block, s.fences], d.ListType = {
            ol: "ol",
            ul: "ul",
            task: "tasklist"
        }, t.Node = d, t.NodeMap = p, t.NodeCollection = h, t.NodeCollectionUtils = f, t.TYPE = s, d.TYPE = s
    }), $__System.registerDynamic("1a", ["11", "13", "2c", "12"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i = e("11"), r = (e("13"), e("2c")), o = e("12"), a = o.Node, s = o.TYPE, l = {
            NONE: 0,
            ADD: 1,
            REPLACE: 2,
            CURSOR_CHANGE: 4,
            DELETE: -1,
            DELETE_ACCROSS_BLOCK: -2,
            HAS_UNDO_TO_PREPEND: -9
        }, c = i.Model.extend({
            commandStack: void 0,
            index: void 0,
            undoManagerContext: !1,
            stackSize: 100,
            UndoManager: c,
            initialize: function (e) {
                this.commandStack = [], this.stackSize = 100, this.set({index: -1}), this.editor = e, this.UndoManager = c, this.clearSnap()
            },
            reset: function () {
                this.commandStack = [], this.stackSize = 100, this.set({index: -1}), this.clearSnap()
            },
            restoreFromJson: function (e) {
                this.set("index", e.index), this.commandStack = JSON.parse(e.commandStackJson)
            },
            storeToJson: function () {
                return {index: this.get("index"), commandStackJson: JSON.stringify(this.commandStack)}
            },
            callCommand: function (e, t) {
                var n, i;
                try {
                    if (t) for (var r = e.undo.length - 1; r > -1; r--) i = this.exeCommand(e.undo[r], e.redo), n || (n = void 0 === n ? i : !!i); else for (r = 0; r < e.redo.length; r++) i = this.exeCommand(e.redo[r], e.undo), n || (n = void 0 === n ? i : !!i)
                } catch (e) {
                    console.error(e.stack)
                }
                return n
            }
        });
        c.prototype.register = function (e, t, n, i) {
            !this.undoManagerContext && e && ("sync" !== n && (this.commandStack.splice(this.get("index") + 1, this.commandStack.length - this.get("index")), this.commandStack.length > this.stackSize && this.commandStack.splice(0, this.commandStack.length - this.stackSize), i ? this.commandStack.unshift(e) : this.commandStack.push(e), this.set({index: this.commandStack.length - 1})), t || "sync" !== n && "restore" !== n && File.updateChangeCount(File.ChangeType.NSChangeDone), "undo" !== n && "input" !== n && this.editor.syncChange(e.redo))
        }, c.prototype.lastRegisteredOperationCommand = function () {
            return this.commandStack.length == this.get("index") + 1 ? this.commandStack[this.get("index")] : null
        }, c.prototype.removeLastRegisteredOperationCommand = function () {
            this.commandStack.length == this.get("index") + 1 && (this.commandStack.pop(), this.set({index: this.get("index") - 1}))
        }, c.prototype.undoLastDiscardable = function () {
            if (!this.editor.sourceView.inSourceMode && !File.isLocked) {
                if (this.completeSnap(!0), "INPUT" == document.activeElement.tagName && "checkbox" != document.activeElement.getAttribute("type")) return !0;
                var e = this.commandStack[this.get("index")];
                e && e.discardable && this.undo()
            }
        };

        function d() {
            return "INPUT" == document.activeElement.tagName && "checkbox" != document.activeElement.getAttribute("type") || "IFRAME" == document.activeElement.tagName && "BODY" != document.activeElement.ownerDocument.activeElement.tagName
        }

        c.prototype.undo = function (e) {
            if (this.editor.selection.clearGlobalColumn(), this.editor.sourceView.inSourceMode) return this.editor.sourceView.cm.undo(), e && e.preventDefault();
            if (this.completeSnap(!0), d()) {
                if (File.isNode) return reqnode("electron").remote.getCurrentWindow().webContents.undo(), e && e.preventDefault(), !1
            } else this.editor.mathBlock.currentCm ? this.editor.mathBlock.tryAddTagUndo(void 0, $(document.activeElement)) : document.activeElement.classList.contains("ty-cm-lang-input") && this.editor.fences.tryAddLangUndo();
            e && e.preventDefault();
            var t = this.commandStack[this.get("index")];
            if (t) {
                this.editor.brush.pause();
                var n = this.callCommand(t, !0);
                this.set({index: this.get("index") - 1}), File.updateChangeCount(File.ChangeType.NSChangeUndone), n && (this.editor.quickRefresh(), this.editor.selection.scrollAdjust()), this.editor.brush.resume(!0), void 0 === n ? this.undo() : (this.editor.refocus(void 0, null, null, !0, !0), this.editor.syncChange(t.undo.clone().reverse()))
            }
        }, c.prototype.redo = function (e) {
            if (this.editor.selection.clearGlobalColumn(), this.editor.sourceView.inSourceMode) return this.editor.sourceView.cm.redo(), e && e.preventDefault();
            if (d()) {
                if (File.isNode) return reqnode("electron").remote.getCurrentWindow().webContents.redo(), e && e.preventDefault(), !1
            } else if (this.editor.mathBlock.currentCm) {
                if (this.editor.mathBlock.tryAddTagUndo(void 0, $(document.activeElement))) return !1
            } else if (document.activeElement.classList.contains("ty-cm-lang-input") && this.editor.fences.tryAddLangUndo(void 0, document.activeElement)) return !1;
            if (e && e.preventDefault(), this.snapFlag == l.CURSOR_CHANGE && (this.snapFlag = 0), !this.snapFlag) {
                var t = this.commandStack[this.get("index") + 1];
                if (t) {
                    this.editor.brush.pause();
                    var n = this.callCommand(t, !1);
                    this.set({index: this.get("index") + 1}), File.updateChangeCount(File.ChangeType.NSChangeRedone), n && (this.editor.quickRefresh(), this.editor.selection.scrollAdjust()), this.editor.brush.resume(!0), void 0 === n ? this.redo() : (this.editor.refocus(void 0, null, null, !0, !0), this.editor.syncChange(t.redo))
                }
            }
        }, c.prototype.hasUndo = function () {
            return !!(this.snapFlag && this.snapFlag != l.CURSOR_CHANGE || -1 !== this.get("index"))
        }, c.prototype.hasRedo = function () {
            return !(this.snapFlag && this.snapFlag != l.CURSOR_CHANGE || !(this.get("index") < this.commandStack.length - 1))
        }, c.prototype.exeCommand = function (e, t, n) {
            var i, l, c, d = this.editor, u = !1, h = d.sourceView.inSourceMode;

            function f(t, n) {
                n = n || [], t = t || d.nodeMap, e.json.map(function (e) {
                    n.push(a.readFromJson(e, t, !0))
                }), e.json.map(function (e) {
                    var t = d.getNode(e.id);
                    t.set("before", d.getNode(e.relation.before_id)), t.set("after", d.getNode(e.relation.after_id)), t.set("parent", d.getNode(e.relation.parent_id))
                })
            }

            if (!e) return !1;
            switch (e.type) {
                case"initSrc":
                    if (h) return !1;
                    d.brush.queue = [], u = !1, File.reloadContent(e.src, !0, !0, !0, !0, !0);
                    break;
                case"reload":
                    if (h) return !1;
                    d.nodeMap.reset(d), f(), d.brush.queue = [], u = !0, $(d.sessionStr).html(o.NodeCollectionUtils.toHTML(d.nodeMap.blocks)), d.focusCid = null, d.lastCursor = null, window.getSelection().removeAllRanges(), File.fileEncode = e.encode;
                    break;
                case"replace":
                    if (h) return !1;
                    if (!(c = d.getNode(e.id))) return console.error(e.id + " not found in  replace");
                    c.get("type") == c.TYPE.fences && d.fences.beforeDeleteFences(c, t), c.get("type") == c.TYPE.math_block && d.mathBlock.beforeDeleteFences(c, t), c.get("type") == c.TYPE.html_block && d.htmlBlock.beforeDeleteFences(c, t), e.id != e.json.id ? (d.getNode(e.id).remove(), c = a.readFromJson(e.json, d.nodeMap)) : c.readFromJson(e.json, d.nodeMap);
                    var p = d.findElemById(e.id)[0];
                    p && r(p, d.MarkParser.renderHtmlWithBlockMeta(c, d.brush)), File.inBusyMode || d.writingArea.setAttribute("contenteditable", "true"), u = !0, d.brush.restart(), !n && d.brush.addToQueue(c.id, !0);
                    break;
                case"insert":
                    if (h) return !1;
                    var m = d.nodeMap, g = [], v = [];
                    if (f(m, g), e.after && (v = d.findElemById(e.after)).before(o.NodeCollectionUtils.toHTML(g)), !v.length && e.before && (v = d.findElemById(e.before)).after(o.NodeCollectionUtils.toHTML(g)), !v.length) {
                        var y = g[0].get("parent");
                        y ? d.findElemById(y.id).replaceWith(y.toHTML()) : 0 === $(d.sessionStr).children().length && ($(d.sessionStr).html(o.NodeCollectionUtils.toHTML(g)), d.focusCid = null, d.lastCursor = null)
                    }
                    u = !0;
                    break;
                case"remove":
                    if (h) return !1;
                    e.idArray.map(function (e) {
                        var n = d.getNode(e);
                        a.isType(n, s.fences) && d.fences.beforeDeleteFences(n, t), a.isType(n, s.math_block) && d.mathBlock.beforeDeleteFences(n, t), n.get("type") == n.TYPE.html_block && d.htmlBlock.beforeDeleteFences(n, t);
                        var r = (i = d.findElemById(e)).parent("li");
                        r.length && r.css("margin", "0.1px"), i.remove(), r.length && r.css("margin", ""), n && n.remove()
                    }), u = !0;
                    break;
                case"text":
                    if (h) return !1;
                    i = d.findElemById(e.id), d.getNode(e.id).set("text", e.text), e.html && i.html(e.html), u = !1, "def-footnote" != i.attr("mdtype") && "def-link" != i.attr("mdtype") || (u = !0), !n && d.brush.addToQueue(e.id, !0);
                    break;
                case"cursor":
                    if (n) return !1;
                    if (h) return void(e.inSourceMode && d.sourceView.cm.setCursor(e.pos));
                    if (e.inSourceMode) return;
                    try {
                        if (void 0 == e.end && (e.end = e.start), void 0 == e.startId && void 0 == e.id && (e.id = e.cid), e.focus) return setTimeout(function () {
                            d.findElemById(e.id).children("[tabindex]").addBack("[tabindex]").focus()
                        }, 100), d.findElemById(e.id).children("[tabindex]").addBack("[tabindex]").focus(), !1;
                        if (e.id || e.startId == e.endId) {
                            if (e.id = e.id || e.startId, i = d.findElemById(e.id), a.isType(i.attr("mdtype"), s.fences, s.math_block, s.html_block)) {
                                var b;
                                i.attr("mdtype") == s.fences ? (d.fences.refreshEditor(), (b = d.fences.getCm(e.id)).focus()) : i.attr("mdtype") == s.math_block ? b = d.mathBlock.startEditing(i) : i.attr("mdtype") == s.html_block && (b = d.htmlBlock.startEditing(i)), e.selections && e.selections.length ? b.setSelection(e.selections[0].head, e.selections[0].anchor) : e.pos ? (b.setCursor(e.pos), e.selections && b.setSelections(e.selections)) : e.start > -1 ? (b.setCursor(b.posFromIndex(e.start)), e.end > -1 && b.setSelection(b.posFromIndex(e.start), b.posFromIndex(e.end))) : d.selection.jumpIntoElemEnd(i)
                            } else if (i.length && void 0 !== e.end) {
                                var w = i.text().length;
                                e.start > w && (e.start = w), e.end > w && (e.end = w), d.selection.restoreSelection(i[0], {
                                    start: e.start,
                                    end: e.end
                                })
                            } else window.getSelection().removeAllRanges();
                            t || d.refocus(e.id)
                        } else if (e.startId) {
                            File.inBusyMode && !File.isLocked && d.writingArea.setAttribute("contenteditable", "true");
                            try {
                                var C = d.selection.restoreEdge(d.findElemById(e.startId), e.start);
                                C = d.selection.restoreEdge(d.findElemById(e.endId), e.end, !0, C), d.selection.fixSafariRange(C), d.selection.setRange(C), d.refocus()
                            } catch (e) {
                                console.log(e.stack)
                            }
                        }
                        File.isTypeWriterMode && d.selection.scrollAdjust(), u = !1
                    } catch (e) {
                        console.warn(e.stack)
                    }
                    break;
                case"fences":
                    if (h) return !1;
                    c = d.getNode(e.id), a.isType(c, c.TYPE.math_block) ? (d.mathBlock.startEditing(e.id), l = d.mathBlock.currentCm) : a.isType(c, c.TYPE.html_block) ? (d.htmlBlock.startEditing(e.id), l = d.htmlBlock.currentCm) : l = d.fences.getCm(e.id), l.focus(), "undo" == e.cmd && l.undo(), "redo" == e.cmd && l.redo(), u = !1;
                    break;
                case"fences-pos":
                    if (h || n) return !1;
                    c = d.getNode(e.id), a.isType(c, c.TYPE.math_block) ? (d.mathBlock.startEditing(e.id), l = d.mathBlock.currentCm) : a.isType(c, c.TYPE.html_block) ? (d.htmlBlock.startEditing(e.id), l = d.htmlBlock.currentCm) : (d.fences.refreshEditor(), l = d.fences.getCm(e.id)), l.focus(), l.setCursor(e.pos), u = !1;
                    break;
                case"attr":
                    if (h) return !1;
                    e.value = e.value, (c = this.editor.getNode(e.id)).attr(e.key, e.value, this.editor, !0), !n && d.brush.addToQueue(e.id, !0);
                    break;
                case"wrap":
                    if (h) return !1;
                    var x = {};
                    x.type = "insert", x.json = [e.json], e.json.children.map(function (n, i) {
                        var r = d.getNode(n.id);
                        0 === i ? x.before = r.get("before") ? r.get("before").id : null : i === e.json.children.length - 1 && (x.after = r.get("after") ? r.get("after").id : null), r && (r.get("type") == r.TYPE.fences && (u = !0, d.fences.beforeDeleteFences(r, t)), r.get("type") == r.TYPE.math_block && (u = !0, d.mathBlock.beforeDeleteFences(r, t)), r.remove(), d.findElemById(n.id).remove())
                    }), this.exeCommand(x, t);
                    break;
                case"unwrap":
                    if (h) return !1;
                    var k = (c = d.getNode(e.id)).unwrap();
                    !e.skipHTML && d.findElemById(e.id).replaceWith(o.NodeCollectionUtils.toHTML(k)), u = !0;
                    break;
                case"scroll":
                    if (h || n) return !1;
                    d.selection.scrollAdjust(e.id ? d.findElemById(e.id) : void 0, e.marginTop);
                    break;
                case"sync":
                    if (!n) return !1;
                    if (void 0 !== e.html) d.findElemById(e.id).html(e.html).find(".md-expand, .md-focus").removeClass("md-expand md-focus"); else if (void 0 !== e.allHtml) d.nodeMap.reset(), f(), $("#write").html(e.allHtml); else if (void 0 !== e.cmChanges) l = d.fences.getCm(e.id), e.cmChanges.forEach(function (e) {
                        l.replaceRange(e.text, e.from, e.to)
                    }); else {
                        if (void 0 !== e.tex) return (c = d.getNode(e.id)).set("text", e.tex), d.findElemById(e.id).replaceWith(c.toHTML()), !0;
                        if (void 0 !== e.srcChanges) h && e.srcChanges.forEach(function (e) {
                            d.sourceView.cm.replaceRange(e.text, e.from, e.to)
                        }); else if (void 0 !== e.content) {
                            if (h && !e.fromSourceMode) {
                                var S = d.sourceView.cm.getScrollInfo().top;
                                d.sourceView.cm.setValue(e.content, "sync"), d.sourceView.cm.scrollTo(0, S)
                            }
                            !h && e.fromSourceMode && (d.nodeMap.reset(), d.reset(e.content))
                        }
                    }
                default:
                    return !1
            }
            return u
        }, c.prototype.clearSnap = function () {
            this.snapNode = {}, this.snapFlag = 0, this.snapDate = 0, this.snapSelection = null
        }, c.prototype.completeSnap = function (e, t) {
            if (e && !this.snapFlag || !this.snapNode || !this.snapNode.id) return this.snapFlag = 0;
            var n = null;
            if (this.snapFlag == l.HAS_UNDO_TO_PREPEND) return n = u, t || this.register(n, !1), u = null, this.clearSnap(), n;
            if (n = c.makeEmptyCommand(), this.snapFlag == l.CURSOR_CHANGE) {
                if (t) return null;
                if (this.snapFlag = 0, !this.snapSelection) return null;
                var i = this.snapSelection.id;
                return n.undo.push(this.snapSelection), this.buildSnap(this.snapNode.id, l.CURSOR_CHANGE), n.redo.push(this.snapSelection), this.snapSelection && !t && i !== this.snapSelection.id && this.register(n, !0, "input"), this.snapFlag = 0, n
            }
            return a.isType(this.snapNode.content.type, s.fences, s.math_block, s.html_block) ? void 0 : (this.snapSelection && n.undo.push(this.snapSelection), n.undo.push({
                type: "replace",
                id: this.snapNode.id,
                json: this.snapNode
            }), this.buildSnap(this.snapNode.id, 0), n.redo.push({
                type: "replace",
                id: this.snapNode.id,
                json: this.snapNode
            }), this.snapSelection && n.redo.push(this.snapSelection), t || this.register(n, !0, "input"), this.snapFlag = 0, n)
        }, c.prototype.buildSnap = function (e, t, n) {
            this.snapSelection = this.editor.selection.buildUndo();
            var i = this.editor.getNode(e);
            if (!i) return this.clearSnap();
            void 0 !== n && null !== n ? i.set("text", n) : t != l.CURSOR_CHANGE && this.editor.store(e, !0), this.snapNode = i.storeToJson(), this.snapFlag = t || 0, t !== l.CURSOR_CHANGE && (this.snapDate = (new Date).getTime())
        };
        var u, h = null;
        c.prototype.noStashedUndo = function () {
            return this.snapFlag !== l.HAS_UNDO_TO_PREPEND
        }, c.prototype.stashUndo = function (e) {
            u ? c.append(u, e) : u = e, this.snapFlag = l.HAS_UNDO_TO_PREPEND
        }, c.prototype.clearEventTimer = function () {
            h && clearTimeout(h), h = null
        }, c.prototype.snap = function (e, t, n, i) {
            var r = this;
            this.snapFlag == l.HAS_UNDO_TO_PREPEND && (this.completeSnap(), File.updateChangeCount(File.ChangeType.NSChangeDone)), !e && this.snapNode && (e = this.snapNode.id), e ? (i = i || t && t != l.CURSOR_CHANGE, this.snapFlag ? (this.snapNode.id != e ? (this.completeSnap(), (t || n) && this.buildSnap(e, t, n), File.updateChangeCount(File.ChangeType.NSChangeDone)) : t != this.snapFlag || this.snapFlag == l.REPLACE ? (this.completeSnap(), File.updateChangeCount(File.ChangeType.NSChangeDone)) : t && this.snapDate && (new Date).getTime() - this.snapDate > 3e3 && (this.completeSnap(), File.updateChangeCount(File.ChangeType.NSChangeDone)), this.snapFlag = t) : t && (this.buildSnap(e, t, n), File.updateChangeCount(File.ChangeType.NSChangeDone)), t && !i && (this.clearEventTimer(), t == l.DELETE_ACCROSS_BLOCK ? (this.editor.selection.scrollAdjust(), h = null) : t != l.CURSOR_CHANGE && t != l.HAS_UNDO_TO_PREPEND && (h = setTimeout(function () {
                r.editor.findElemById(e).trigger("inline-input"), h = null
            }, 50)))) : this.clearSnap()
        }, c.prototype.buildReplaceUndo = function (e) {
            return c.buildReplaceUndo(e)
        }, c.buildReplaceUndo = function (e, t) {
            if (!e) throw new Error("empty node");
            return {type: "replace", id: t || e.id, json: e.storeToJson()}
        }, c.addUndoForInsert = function (e, t, n, i) {
            t && (e.redo.push({
                type: "insert",
                after: i ? i.id : t.get("after") ? t.get("after").id : null,
                before: n ? n.id : t.get("before") ? t.get("before").id : null,
                json: [t.storeToJson()]
            }), e.undo.push({type: "remove", idArray: [t.id]}))
        }, c.addUndoForWrap = function (e, t, n) {
            t && (e.redo.push({type: "wrap", json: t.storeToJson(), skipHTML: n}), e.undo.push({
                type: "unwrap",
                id: t.id,
                skipHTML: n
            }))
        }, c.addUndoForUnwrap = function (e, t) {
            t && (e.undo.push({type: "wrap", json: t.storeToJson()}), e.redo.push({type: "unwrap", id: t.id}))
        }, c.buildAllDoc = function (e, t) {
            var n = e.blocks.at(0), i = [];
            for (n = n.getLastBrother(!0); n;) i.push(n.storeToJson()), n = n.get("after");
            return {type: "reload", json: i, reloadFromDisk: t, encode: File.fileEncode}
        }, c.addUndoForInsertArray = function (e, t, n, i) {
            t && 0 != t.length && (e.redo.push({
                type: "insert",
                after: i ? i.id : t[t.length - 1].get("after") ? t[t.length - 1].get("after").id : null,
                before: n ? n.id : t[0].get("before") ? t[0].get("before").id : null,
                json: t.reduce(function (e, t) {
                    return e.push(t.storeToJson()), e
                }, [])
            }), e.undo.push({
                type: "remove", idArray: t.reduce(function (e, t) {
                    return e.push(t.id), e
                }, [])
            }))
        }, c.addUndoForRemoveArray = function (e, t, n, i) {
            t && 0 != t.length && (e.undo.push({
                type: "insert",
                after: i ? i.id : t[t.length - 1].get("after") ? t[t.length - 1].get("after").id : null,
                before: n ? n.id : t[0].get("before") ? t[0].get("before").id : null,
                json: t.reduce(function (e, t) {
                    return e.push(t.storeToJson()), e
                }, [])
            }), e.redo.push({
                type: "remove", idArray: t.reduce(function (e, t) {
                    return e.push(t.id), e
                }, [])
            }))
        }, c.addUndoForRemove = function (e, t, n, i) {
            e.undo.push({
                type: "insert",
                after: i ? i.id : t.get("after") ? t.get("after").id : null,
                before: n ? n.id : t.get("before") ? t.get("before").id : null,
                json: [t.storeToJson()]
            }), e.redo.push({type: "remove", idArray: [t.id]})
        }, c.makeEmptyCommand = function (e) {
            var t = {undo: [], redo: []};
            return e && t.undo.push(e), t
        }, c.isEmptyCommand = function (e) {
            return !(e && e.undo && e.redo && (e.undo.length || e.redo.length))
        }, c.append = function (e, t) {
            return t && (e.undo = e.undo.concat(t.undo), e.redo = e.redo.concat(t.redo)), e
        }, a.storeToJson = function (e) {
            var t = {};
            return t.content = {}, t.relation = {}, t.children = [], a.property.map(function (n) {
                var i = e.get(n);
                void 0 !== i && null !== i && (i instanceof Array ? t.content[n] = $.merge([], i) : typeof i == Object ? t.content[n] = $.extend({}, i) : t.content[n] = i)
            }), t.relation.before_id = e.get("before") ? e.get("before").id : null, t.relation.after_id = e.get("after") ? e.get("after").id : null, t.relation.parent_id = e.get("parent") ? e.get("parent").id : null, t.is_top = !!e.get("attachTo"), e.get("children").toArray().map(function (e) {
                var n = a.storeToJson(e);
                t.children.push(n)
            }), t.id = e.id, t
        }, a.readFromJson = function (e, t, n) {
            var i = function (e) {
                var n = t.allNodes.get(e);
                return n && !n.attributes && (console.assert(null, "node deleted"), n.attributes = {}), n
            }(e.id) || new a({id: e.id});
            return i.set("in", t), e.is_top && i.set("attachTo", t), a.property.map(function (e) {
                i.attributes[e] = void 0
            }), i.set(e.content), i.clearChildren(!0), e.relation.parent_id || i.set("attachTo", t), e.children.map(function (e) {
                a.readFromJson(e, t, !0)
            }), e.children.map(function (e) {
                var n = t.allNodes.get(e.id);
                n.set("before", t.allNodes.get(e.relation.before_id)), n.set("after", t.allNodes.get(e.relation.after_id)), n.set("parent", i)
            }), n || (i.set("before", t.allNodes.get(e.relation.before_id)), i.set("after", t.allNodes.get(e.relation.after_id)), i.set("parent", t.allNodes.get(e.relation.parent_id))), i
        }, a.prototype.storeToJson = function () {
            return a.storeToJson(this)
        }, a.prototype.readFromJson = function (e, t) {
            this.clearChildren();
            var n = a.readFromJson(e, t || this.get("in"));
            this.replaceWith(n)
        }, c.SnapFlag = l, n.exports = c
    }), $__System.registerDynamic("1b", [], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i = function (e) {
            var t = "object", n = "function", i = "undefined",
                r = ["startContainer", "startOffset", "endContainer", "endOffset", "collapsed", "commonAncestorContainer"],
                o = ["setStart", "setStartBefore", "setStartAfter", "setEnd", "setEndBefore", "setEndAfter", "collapse", "selectNode", "selectNodeContents", "compareBoundaryPoints", "deleteContents", "extractContents", "cloneContents", "insertNode", "surroundContents", "cloneRange", "toString", "detach"],
                a = ["boundingHeight", "boundingLeft", "boundingTop", "boundingWidth", "htmlText", "text"],
                s = ["collapse", "compareEndPoints", "duplicate", "moveToElementText", "parentElement", "select", "setEndPoint", "getBoundingClientRect"];

            function l(e, i) {
                var r = typeof e[i];
                return r == n || !(r != t || !e[i]) || "unknown" == r
            }

            function c(e, n) {
                return !(typeof e[n] != t || !e[n])
            }

            function d(e, t) {
                return typeof e[t] != i
            }

            function u(e) {
                return function (t, n) {
                    for (var i = n.length; i--;) if (!e(t, n[i])) return !1;
                    return !0
                }
            }

            var h = u(l), f = u(c), p = u(d);

            function m(e) {
                return e && h(e, s) && p(e, a)
            }

            function g(e) {
                return c(e, "body") ? e.body : e.getElementsByTagName("body")[0]
            }

            var v = {}, y = {
                version: "1.3alpha.20140716",
                initialized: !1,
                supported: !0,
                util: {
                    isHostMethod: l,
                    isHostObject: c,
                    isHostProperty: d,
                    areHostMethods: h,
                    areHostObjects: f,
                    areHostProperties: p,
                    isTextRange: m,
                    getBody: g
                },
                features: {},
                modules: v,
                config: {alertOnFail: !0, alertOnWarn: !1, preferTextRange: !1}
            };

            function b(e) {
                c(window, "console") && l(window.console, "log") && window.console.log(e)
            }

            function w(e, t) {
                t ? window.alert(e) : b(e)
            }

            function C(e) {
                y.initialized = !0, y.supported = !1, w("Rangy is not supported on this page in your browser. Reason: " + e, y.config.alertOnFail)
            }

            y.fail = C;
            y.warn = function (e) {
                w("Rangy warning: " + e, y.config.alertOnWarn)
            }, !{}.hasOwnProperty ? C("hasOwnProperty not supported") : y.util.extend = function (e, t, n) {
                var i, r;
                for (var o in t) t.hasOwnProperty(o) && (i = e[o], r = t[o], n && null !== i && "object" == typeof i && null !== r && "object" == typeof r && y.util.extend(i, r, !0), e[o] = r);
                return t.hasOwnProperty("toString") && (e.toString = t.toString), e
            }, function () {
                var e = document.createElement("div");
                e.appendChild(document.createElement("span"));
                var t, n = [].slice;
                try {
                    1 == n.call(e.childNodes, 0)[0].nodeType && (t = function (e) {
                        return n.call(e, 0)
                    })
                } catch (e) {
                }
                t || (t = function (e) {
                    for (var t = [], n = 0, i = e.length; n < i; ++n) t[n] = e[n];
                    return t
                }), y.util.toArray = t
            }();
            var x;
            l(document, "addEventListener") ? x = function (e, t, n) {
                e.addEventListener(t, n, !1)
            } : l(document, "attachEvent") ? x = function (e, t, n) {
                e.attachEvent("on" + t, n)
            } : C("Document does not have required addEventListener or attachEvent method"), y.util.addListener = x;
            var k = [];

            function S(e) {
                return e.message || e.description || String(e)
            }

            function E() {
                if (!y.initialized) {
                    var e, t = !1, n = !1;
                    l(document, "createRange") && (e = document.createRange(), h(e, o) && p(e, r) && (t = !0));
                    var i = g(document);
                    if (i && "body" == i.nodeName.toLowerCase()) if (i && l(i, "createTextRange") && m(e = i.createTextRange()) && (n = !0), t || n) {
                        y.initialized = !0, y.features = {implementsDomRange: t, implementsTextRange: n};
                        var a;
                        for (var s in v) (a = v[s]) instanceof _ && a.init(a, y);
                        for (var c = 0, d = k.length; c < d; ++c) try {
                            k[c](y)
                        } catch (e) {
                            b("Rangy init listener threw an exception. Continuing. Detail: " + S(e))
                        }
                    } else C("Neither Range nor TextRange are available"); else C("No body element found")
                }
            }

            y.init = E, y.addInitListener = function (e) {
                y.initialized ? e(y) : k.push(e)
            };
            var F = [];
            y.addCreateMissingNativeApiListener = function (e) {
                F.push(e)
            };
            y.createMissingNativeApi = function (e) {
                e = e || window, E();
                for (var t = 0, n = F.length; t < n; ++t) F[t](e)
            };

            function _(e, t, n) {
                this.name = e, this.dependencies = t, this.initialized = !1, this.supported = !1, this.initializer = n
            }

            _.prototype = {
                init: function (e) {
                    for (var t, n, i = this.dependencies || [], r = 0, o = i.length; r < o; ++r) {
                        if (n = i[r], !((t = v[n]) && t instanceof _)) throw new Error("required module '" + n + "' not found");
                        if (t.init(), !t.supported) throw new Error("required module '" + n + "' not supported")
                    }
                    this.initializer(this)
                }, fail: function (e) {
                    throw this.initialized = !0, this.supported = !1, new Error("Module '" + this.name + "' failed to load: " + e)
                }, warn: function (e) {
                    y.warn("Module " + this.name + ": " + e)
                }, deprecationNotice: function (e, t) {
                    y.warn("DEPRECATED: " + e + " in module " + this.name + "is deprecated. Please use " + t + " instead")
                }, createError: function (e) {
                    return new Error("Error in Rangy " + this.name + " module: " + e)
                }
            };

            function T(e, t, n, i) {
                var r = new _(t, n, function (e) {
                    if (!e.initialized) {
                        e.initialized = !0;
                        try {
                            i(y, e), e.supported = !0
                        } catch (e) {
                            b("Module '" + t + "' failed to load: " + S(e))
                        }
                    }
                });
                v[t] = r
            }

            y.createModule = function (e) {
                var t, n;
                2 == arguments.length ? (t = arguments[1], n = []) : (t = arguments[2], n = arguments[1]), T(0, e, n, t)
            }, y.createCoreModule = function (e, t, n) {
                T(0, e, t, n)
            };

            function M() {
            }

            y.RangePrototype = M, y.rangePrototype = new M;
            y.selectionPrototype = new function () {
            };
            var A = !1, N = function (e) {
                A || (A = !0, y.initialized || E())
            };
            if (typeof window != i) {
                if (typeof document != i) return l(document, "addEventListener") && document.addEventListener("DOMContentLoaded", N, !1), x(window, "load", N), y;
                C("No document found")
            } else C("No window found")
        }();
        i.createCoreModule("DomUtil", [], function (e, t) {
            var n = "undefined", i = e.util;
            i.areHostMethods(document, ["createDocumentFragment", "createElement", "createTextNode"]) || t.fail("document missing a Node creation method"), i.isHostMethod(document, "getElementsByTagName") || t.fail("document missing getElementsByTagName method");
            var r = document.createElement("div");
            i.areHostMethods(r, ["insertBefore", "appendChild", "cloneNode"] || !i.areHostObjects(r, ["previousSibling", "nextSibling", "childNodes", "parentNode"])) || t.fail("Incomplete Element implementation"), i.isHostProperty(r, "innerHTML") || t.fail("Element is missing innerHTML property");
            var o = document.createTextNode("test");
            i.areHostMethods(o, ["splitText", "deleteData", "insertData", "appendData", "cloneNode"] || !i.areHostObjects(r, ["previousSibling", "nextSibling", "childNodes", "parentNode"]) || !i.areHostProperties(o, ["data"])) || t.fail("Incomplete Text Node implementation");
            var a = function (e, t) {
                for (var n = e.length; n--;) if (e[n] === t) return !0;
                return !1
            };

            function s(e) {
                for (var t = 0; e = e.previousSibling;) ++t;
                return t
            }

            function l(e, t) {
                var n, i = [];
                for (n = e; n; n = n.parentNode) i.push(n);
                for (n = t; n; n = n.parentNode) if (a(i, n)) return n;
                return null
            }

            function c(e, t, n) {
                for (var i = n ? t : t.parentNode; i;) {
                    if (i === e) return !0;
                    i = i.parentNode
                }
                return !1
            }

            function d(e, t, n) {
                for (var i, r = n ? e : e.parentNode; r;) {
                    if ((i = r.parentNode) === t) return r;
                    r = i
                }
                return null
            }

            function u(e) {
                var t = e.nodeType;
                return 3 == t || 4 == t || 8 == t
            }

            function h(e, t) {
                var n = t.nextSibling, i = t.parentNode;
                return n ? i.insertBefore(e, n) : i.appendChild(e), e
            }

            function f(e) {
                if (9 == e.nodeType) return e;
                if (typeof e.ownerDocument != n) return e.ownerDocument;
                if (typeof e.document != n) return e.document;
                if (e.parentNode) return f(e.parentNode);
                throw t.createError("getDocument: no document found for node")
            }

            function p(e) {
                var i = f(e);
                if (typeof i.defaultView != n) return i.defaultView;
                if (typeof i.parentWindow != n) return i.parentWindow;
                throw t.createError("Cannot get a window object for node")
            }

            function m(e) {
                if (typeof e.contentDocument != n) return e.contentDocument;
                if (typeof e.contentWindow != n) return e.contentWindow.document;
                throw t.createError("getIframeDocument: No Document object found for iframe element")
            }

            function g(e) {
                return e && i.isHostMethod(e, "setTimeout") && i.isHostObject(e, "document")
            }

            var v = !1;

            function y(e) {
                try {
                    return e.parentNode, !1
                } catch (e) {
                    return !0
                }
            }

            !function () {
                var t = document.createElement("b");
                t.innerHTML = "1";
                var n = t.firstChild;
                t.innerHTML = "<br>", v = y(n), e.features.crashyTextNodes = v
            }();

            function b(e) {
                if (!e) return "[No node]";
                if (v && y(e)) return "[Broken node]";
                if (u(e)) return '"' + e.data + '"';
                if (1 == e.nodeType) {
                    var t = e.id ? ' id="' + e.id + '"' : "";
                    return "<" + e.nodeName + t + ">[index:" + s(e) + ",length:" + e.childNodes.length + "][" + (e.innerHTML || "[innerHTML not supported]").slice(0, 25) + "]"
                }
                return e.nodeName
            }

            var w;
            typeof window.getComputedStyle != n ? w = function (e, t) {
                return p(e).getComputedStyle(e, null)[t]
            } : typeof document.documentElement.currentStyle != n ? w = function (e, t) {
                return e.currentStyle[t]
            } : t.fail("No means of obtaining computed style properties found");

            function C(e) {
                this.root = e, this._next = e
            }

            C.prototype = {
                _current: null, hasNext: function () {
                    return !!this._next
                }, next: function () {
                    var e, t, n = this._current = this._next;
                    if (this._current) if (e = n.firstChild) this._next = e; else {
                        for (t = null; n !== this.root && !(t = n.nextSibling);) n = n.parentNode;
                        this._next = t
                    }
                    return this._current
                }, detach: function () {
                    this._current = this._next = this.root = null
                }
            };

            function x(e, t) {
                this.node = e, this.offset = t
            }

            x.prototype = {
                equals: function (e) {
                    return !!e && this.node === e.node && this.offset == e.offset
                }, inspect: function () {
                    return "[DomPosition(" + b(this.node) + ":" + this.offset + ")]"
                }, toString: function () {
                    return this.inspect()
                }
            };

            function k(e) {
                this.code = this[e], this.codeName = e, this.message = "DOMException: " + this.codeName
            }

            k.prototype = {
                INDEX_SIZE_ERR: 1,
                HIERARCHY_REQUEST_ERR: 3,
                WRONG_DOCUMENT_ERR: 4,
                NO_MODIFICATION_ALLOWED_ERR: 7,
                NOT_FOUND_ERR: 8,
                NOT_SUPPORTED_ERR: 9,
                INVALID_STATE_ERR: 11,
                INVALID_NODE_TYPE_ERR: 24
            }, k.prototype.toString = function () {
                return this.message
            }, e.dom = {
                arrayContains: a,
                isHtmlNamespace: function (e) {
                    var t;
                    return typeof e.namespaceURI == n || null === (t = e.namespaceURI) || "http://www.w3.org/1999/xhtml" == t
                },
                parentElement: function (e) {
                    var t = e.parentNode;
                    return 1 == t.nodeType ? t : null
                },
                getNodeIndex: s,
                getNodeLength: function (e) {
                    switch (e.nodeType) {
                        case 7:
                        case 10:
                            return 0;
                        case 3:
                        case 8:
                            return e.length;
                        default:
                            return e.childNodes.length
                    }
                },
                getCommonAncestor: l,
                isAncestorOf: c,
                isOrIsAncestorOf: function (e, t) {
                    return c(e, t, !0)
                },
                getClosestAncestorIn: d,
                isCharacterDataNode: u,
                isTextOrCommentNode: function (e) {
                    if (!e) return !1;
                    var t = e.nodeType;
                    return 3 == t || 8 == t
                },
                insertAfter: h,
                splitDataNode: function (e, t, n) {
                    var i = e.cloneNode(!1);
                    if (i.deleteData(0, t), e.deleteData(t, e.length - t), h(i, e), n) for (var r, o = 0; r = n[o++];) r.node == e && r.offset > t ? (r.node = i, r.offset -= t) : r.node == e.parentNode && r.offset > s(e) && ++r.offset;
                    return i
                },
                getDocument: f,
                getWindow: p,
                getIframeWindow: function (e) {
                    if (typeof e.contentWindow != n) return e.contentWindow;
                    if (typeof e.contentDocument != n) return e.contentDocument.defaultView;
                    throw t.createError("getIframeWindow: No Window object found for iframe element")
                },
                getIframeDocument: m,
                getBody: i.getBody,
                isWindow: g,
                getContentDocument: function (e, t, n) {
                    var r;
                    if (e ? i.isHostProperty(e, "nodeType") ? r = 1 == e.nodeType && "iframe" == e.tagName.toLowerCase() ? m(e) : f(e) : g(e) && (r = e.document) : r = document, !r) throw t.createError(n + "(): Parameter must be a Window object or DOM node");
                    return r
                },
                getRootContainer: function (e) {
                    for (var t; t = e.parentNode;) e = t;
                    return e
                },
                comparePoints: function (e, n, i, r) {
                    var o, a, c, u, h;
                    if (e == i) return n === r ? 0 : n < r ? -1 : 1;
                    if (o = d(i, e, !0)) return n <= s(o) ? -1 : 1;
                    if (o = d(e, i, !0)) return s(o) < r ? -1 : 1;
                    if (!(a = l(e, i))) throw new Error("comparePoints error: nodes have no common ancestor");
                    if ((c = e === a ? a : d(e, a, !0)) === (u = i === a ? a : d(i, a, !0))) throw t.createError("comparePoints got to case 4 and childA and childB are the same!");
                    for (h = a.firstChild; h;) {
                        if (h === c) return -1;
                        if (h === u) return 1;
                        h = h.nextSibling
                    }
                },
                isBrokenNode: y,
                inspectNode: b,
                getComputedStyleProperty: w,
                fragmentFromNodeChildren: function (e) {
                    for (var t, n = f(e).createDocumentFragment(); t = e.firstChild;) n.appendChild(t);
                    return n
                },
                createIterator: function (e) {
                    return new C(e)
                },
                DomPosition: x
            }, e.DOMException = k
        }), i.createCoreModule("DomRange", ["DomUtil"], function (e, t) {
            var n = e.dom, i = e.util, r = n.DomPosition, o = e.DOMException, a = n.isCharacterDataNode,
                s = n.getNodeIndex, l = n.isOrIsAncestorOf, c = n.getDocument, d = n.comparePoints, u = n.splitDataNode,
                h = n.getClosestAncestorIn, f = n.getNodeLength, p = n.arrayContains, m = n.getRootContainer,
                g = e.features.crashyTextNodes;

            function v(e, t) {
                return 3 != e.nodeType && (l(e, t.startContainer) || l(e, t.endContainer))
            }

            function y(e) {
                return e.document || c(e.startContainer)
            }

            function b(e) {
                return new r(e.parentNode, s(e))
            }

            function w(e) {
                return new r(e.parentNode, s(e) + 1)
            }

            function C(e, t, i) {
                var r = 11 == e.nodeType ? e.firstChild : e;
                return a(t) ? i == t.length ? n.insertAfter(e, t) : t.parentNode.insertBefore(e, 0 == i ? t : u(t, i)) : i >= t.childNodes.length ? t.appendChild(e) : t.insertBefore(e, t.childNodes[i]), r
            }

            function x(e, t, n) {
                if (z(e), z(t), y(t) != y(e)) throw new o("WRONG_DOCUMENT_ERR");
                var i = d(e.startContainer, e.startOffset, t.endContainer, t.endOffset),
                    r = d(e.endContainer, e.endOffset, t.startContainer, t.startOffset);
                return n ? i <= 0 && r >= 0 : i < 0 && r > 0
            }

            function k(e, t, i) {
                var r, o;
                i = i || {stop: !1};
                for (var a, s; a = e.next();) if (e.isPartiallySelectedSubtree()) {
                    if (!1 === t(a)) return void(i.stop = !0);
                    if (k(s = e.getSubtreeIterator(), t, i), s.detach(), i.stop) return
                } else for (r = n.createIterator(a); o = r.next();) if (!1 === t(o)) return void(i.stop = !0)
            }

            function S(e) {
                for (var t; e.next();) e.isPartiallySelectedSubtree() ? (S(t = e.getSubtreeIterator()), t.detach()) : e.remove()
            }

            function E(e) {
                for (var t, n, i = y(e.range).createDocumentFragment(); t = e.next();) {
                    if (e.isPartiallySelectedSubtree() ? (t = t.cloneNode(!1), n = e.getSubtreeIterator(), t.appendChild(E(n)), n.detach()) : e.remove(), 10 == t.nodeType) throw new o("HIERARCHY_REQUEST_ERR");
                    i.appendChild(t)
                }
                return i
            }

            function F(e) {
                return "[" + (void 0 === e.getName ? "Range" : e.getName()) + "(" + n.inspectNode(e.startContainer) + ":" + e.startOffset + ", " + n.inspectNode(e.endContainer) + ":" + e.endOffset + ")]"
            }

            function _(e, t) {
                if (this.range = e, this.clonePartiallySelectedTextNodes = t, !e.collapsed) {
                    this.sc = e.startContainer, this.so = e.startOffset, this.ec = e.endContainer, this.eo = e.endOffset;
                    var n = e.commonAncestorContainer;
                    this.sc === this.ec && a(this.sc) ? (this.isSingleCharacterDataNode = !0, this._first = this._last = this._next = this.sc) : (this._first = this._next = this.sc !== n || a(this.sc) ? h(this.sc, n, !0) : this.sc.childNodes[this.so], this._last = this.ec !== n || a(this.ec) ? h(this.ec, n, !0) : this.ec.childNodes[this.eo - 1])
                }
            }

            _.prototype = {
                _current: null,
                _next: null,
                _first: null,
                _last: null,
                isSingleCharacterDataNode: !1,
                reset: function () {
                    this._current = null, this._next = this._first
                },
                hasNext: function () {
                    return !!this._next
                },
                next: function () {
                    var e = this._current = this._next;
                    return e && (this._next = e !== this._last ? e.nextSibling : null, a(e) && this.clonePartiallySelectedTextNodes && (e === this.ec && (e = e.cloneNode(!0)).deleteData(this.eo, e.length - this.eo), this._current === this.sc && (e = e.cloneNode(!0)).deleteData(0, this.so))), e
                },
                remove: function () {
                    var e, t, n = this._current;
                    !a(n) || n !== this.sc && n !== this.ec ? n.parentNode && n.parentNode.removeChild(n) : (e = n === this.sc ? this.so : 0) != (t = n === this.ec ? this.eo : n.length) && n.deleteData(e, t - e)
                },
                isPartiallySelectedSubtree: function () {
                    return v(this._current, this.range)
                },
                getSubtreeIterator: function () {
                    var e;
                    if (this.isSingleCharacterDataNode) (e = this.range.cloneRange()).collapse(!1); else {
                        e = new ue(y(this.range));
                        var t = this._current, n = t, i = 0, r = t, o = f(t);
                        l(t, this.sc) && (n = this.sc, i = this.so), l(t, this.ec) && (r = this.ec, o = this.eo), de(e, n, i, r, o)
                    }
                    return new _(e, this.clonePartiallySelectedTextNodes)
                },
                detach: function () {
                    this.range = this._current = this._next = this._first = this._last = this.sc = this.so = this.ec = this.eo = null
                }
            };
            var T = [1, 3, 4, 5, 7, 8, 10], M = [2, 9, 11], A = [1, 3, 4, 5, 7, 8, 10, 11], N = [1, 3, 4, 5, 7, 8];

            function L(e) {
                return function (t, n) {
                    for (var i, r = n ? t : t.parentNode; r;) {
                        if (i = r.nodeType, p(e, i)) return r;
                        r = r.parentNode
                    }
                    return null
                }
            }

            var R = L([9, 11]), D = L([5, 6, 10, 12]), O = L([6, 10, 12]);

            function I(e, t) {
                if (O(e, t)) throw new o("INVALID_NODE_TYPE_ERR")
            }

            function P(e, t) {
                if (!p(t, e.nodeType)) throw new o("INVALID_NODE_TYPE_ERR")
            }

            function B(e, t) {
                if (t < 0 || t > (a(e) ? e.length : e.childNodes.length)) throw new o("INDEX_SIZE_ERR")
            }

            function $(e, t) {
                if (R(e, !0) !== R(t, !0)) throw new o("WRONG_DOCUMENT_ERR")
            }

            function H(e) {
                if (D(e, !0)) throw new o("NO_MODIFICATION_ALLOWED_ERR")
            }

            function U(e, t) {
                if (!e) throw new o(t)
            }

            function j(e) {
                return g && n.isBrokenNode(e) || !p(M, e.nodeType) && !R(e, !0)
            }

            function W(e, t) {
                return t <= (a(e) ? e.length : e.childNodes.length)
            }

            function q(e) {
                return !!e.startContainer && !!e.endContainer && !j(e.startContainer) && !j(e.endContainer) && W(e.startContainer, e.startOffset) && W(e.endContainer, e.endOffset)
            }

            function z(e) {
                if (!q(e)) throw new Error("Range error: Range is no longer valid after DOM mutation (" + e.inspect() + ")")
            }

            var V = document.createElement("style"), K = !1;
            try {
                V.innerHTML = "<b>x</b>", K = 3 == V.firstChild.nodeType
            } catch (e) {
            }
            e.features.htmlParsingConforms = K;
            var Y = K ? function (e) {
                var t = this.startContainer, i = c(t);
                if (!t) throw new o("INVALID_STATE_ERR");
                var r = null;
                return 1 == t.nodeType ? r = t : a(t) && (r = n.parentElement(t)), (r = null === r || "HTML" == r.nodeName && n.isHtmlNamespace(c(r).documentElement) && n.isHtmlNamespace(r) ? i.createElement("body") : r.cloneNode(!1)).innerHTML = e, n.fragmentFromNodeChildren(r)
            } : function (e) {
                var t = y(this).createElement("body");
                return t.innerHTML = e, n.fragmentFromNodeChildren(t)
            };

            function Q(e, t) {
                z(e);
                var n = e.startContainer, i = e.startOffset, r = e.endContainer, o = e.endOffset, l = n === r;
                a(r) && o > 0 && o < r.length && u(r, o, t), a(n) && i > 0 && i < n.length && (n = u(n, i, t), l ? (o -= i, r = n) : r == n.parentNode && o >= s(n) && o++, i = 0), e.setStartAndEnd(n, i, r, o)
            }

            var G = ["startContainer", "startOffset", "endContainer", "endOffset", "collapsed", "commonAncestorContainer"],
                J = 0, X = 1, Z = 2, ee = 3, te = 0, ne = 1, ie = 2, re = 3;
            i.extend(e.rangePrototype, {
                compareBoundaryPoints: function (e, t) {
                    z(this), $(this.startContainer, t.startContainer);
                    var n, i, r, o, a = e == ee || e == J ? "start" : "end", s = e == X || e == J ? "start" : "end";
                    return n = this[a + "Container"], i = this[a + "Offset"], r = t[s + "Container"], o = t[s + "Offset"], d(n, i, r, o)
                }, insertNode: function (e) {
                    if (z(this), P(e, A), H(this.startContainer), l(e, this.startContainer)) throw new o("HIERARCHY_REQUEST_ERR");
                    var t = C(e, this.startContainer, this.startOffset);
                    this.setStartBefore(t)
                }, cloneContents: function () {
                    z(this);
                    var e, t;
                    if (this.collapsed) return y(this).createDocumentFragment();
                    if (this.startContainer === this.endContainer && a(this.startContainer)) return (e = this.startContainer.cloneNode(!0)).data = e.data.slice(this.startOffset, this.endOffset), (t = y(this).createDocumentFragment()).appendChild(e), t;
                    var n = new _(this, !0);
                    return e = function e(t) {
                        for (var n, i, r, a = y(t.range).createDocumentFragment(); i = t.next();) {
                            if (n = t.isPartiallySelectedSubtree(), i = i.cloneNode(!n), n && (r = t.getSubtreeIterator(), i.appendChild(e(r)), r.detach()), 10 == i.nodeType) throw new o("HIERARCHY_REQUEST_ERR");
                            a.appendChild(i)
                        }
                        return a
                    }(n), n.detach(), e
                }, canSurroundContents: function () {
                    z(this), H(this.startContainer), H(this.endContainer);
                    var e = new _(this, !0), t = e._first && v(e._first, this) || e._last && v(e._last, this);
                    return e.detach(), !t
                }, surroundContents: function (e) {
                    if (P(e, N), !this.canSurroundContents()) throw new o("INVALID_STATE_ERR");
                    var t = this.extractContents();
                    if (e.hasChildNodes()) for (; e.lastChild;) e.removeChild(e.lastChild);
                    C(e, this.startContainer, this.startOffset), e.appendChild(t), this.selectNode(e)
                }, cloneRange: function () {
                    z(this);
                    for (var e, t = new ue(y(this)), n = G.length; n--;) t[e = G[n]] = this[e];
                    return t.isBackward = this.isBackward, t
                }, toString: function () {
                    z(this);
                    var e = this.startContainer;
                    if (e === this.endContainer && a(e)) return 3 == e.nodeType || 4 == e.nodeType ? e.data.slice(this.startOffset, this.endOffset) : "";
                    var t = [], n = new _(this, !0);
                    return k(n, function (e) {
                        3 != e.nodeType && 4 != e.nodeType || t.push(e.data)
                    }), n.detach(), t.join("")
                }, compareNode: function (e) {
                    z(this);
                    var t = e.parentNode, n = s(e);
                    if (!t) throw new o("NOT_FOUND_ERR");
                    var i = this.comparePoint(t, n), r = this.comparePoint(t, n + 1);
                    return i < 0 ? r > 0 ? ie : te : r > 0 ? ne : re
                }, comparePoint: function (e, t) {
                    return z(this), U(e, "HIERARCHY_REQUEST_ERR"), $(e, this.startContainer), d(e, t, this.startContainer, this.startOffset) < 0 ? -1 : d(e, t, this.endContainer, this.endOffset) > 0 ? 1 : 0
                }, createContextualFragment: Y, toHtml: function () {
                    z(this);
                    var e = this.commonAncestorContainer.parentNode.cloneNode(!1);
                    return e.appendChild(this.cloneContents()), e.innerHTML
                }, intersectsNode: function (e, t) {
                    if (z(this), U(e, "NOT_FOUND_ERR"), c(e) !== y(this)) return !1;
                    var n = e.parentNode, i = s(e);
                    U(n, "NOT_FOUND_ERR");
                    var r = d(n, i, this.endContainer, this.endOffset),
                        o = d(n, i + 1, this.startContainer, this.startOffset);
                    return t ? r <= 0 && o >= 0 : r < 0 && o > 0
                }, isPointInRange: function (e, t) {
                    return z(this), U(e, "HIERARCHY_REQUEST_ERR"), $(e, this.startContainer), d(e, t, this.startContainer, this.startOffset) >= 0 && d(e, t, this.endContainer, this.endOffset) <= 0
                }, intersectsRange: function (e) {
                    return x(this, e, !1)
                }, intersectsOrTouchesRange: function (e) {
                    return x(this, e, !0)
                }, intersection: function (e) {
                    if (this.intersectsRange(e)) {
                        var t = d(this.startContainer, this.startOffset, e.startContainer, e.startOffset),
                            n = d(this.endContainer, this.endOffset, e.endContainer, e.endOffset),
                            i = this.cloneRange();
                        return -1 == t && i.setStart(e.startContainer, e.startOffset), 1 == n && i.setEnd(e.endContainer, e.endOffset), i
                    }
                    return null
                }, union: function (e) {
                    if (this.intersectsOrTouchesRange(e)) {
                        var t = this.cloneRange();
                        return -1 == d(e.startContainer, e.startOffset, this.startContainer, this.startOffset) && t.setStart(e.startContainer, e.startOffset), 1 == d(e.endContainer, e.endOffset, this.endContainer, this.endOffset) && t.setEnd(e.endContainer, e.endOffset), t
                    }
                    throw new o("Ranges do not intersect")
                }, containsNode: function (e, t) {
                    return t ? this.intersectsNode(e, !1) : this.compareNode(e) == re
                }, containsNodeContents: function (e) {
                    return this.comparePoint(e, 0) >= 0 && this.comparePoint(e, f(e)) <= 0
                }, containsRange: function (e) {
                    var t = this.intersection(e);
                    return null !== t && e.equals(t)
                }, containsNodeText: function (e) {
                    var t = this.cloneRange();
                    t.selectNode(e);
                    var n = t.getNodes([3]);
                    if (n.length > 0) {
                        t.setStart(n[0], 0);
                        var i = n.pop();
                        return t.setEnd(i, i.length), this.containsRange(t)
                    }
                    return this.containsNodeContents(e)
                }, getNodes: function (e, t) {
                    return z(this), function (e, t, n) {
                        var i, r = !(!t || !t.length), o = !!n;
                        r && (i = new RegExp("^(" + t.join("|") + ")$"));
                        var s = [];
                        return k(new _(e, !1), function (t) {
                            if ((!r || i.test(t.nodeType)) && (!o || n(t))) {
                                var l = e.startContainer;
                                if (t != l || !a(l) || e.startOffset != l.length) {
                                    var c = e.endContainer;
                                    t == c && a(c) && 0 == e.endOffset || s.push(t)
                                }
                            }
                        }), s
                    }(this, e, t)
                }, getDocument: function () {
                    return y(this)
                }, collapseBefore: function (e) {
                    this.setEndBefore(e), this.collapse(!1)
                }, collapseAfter: function (e) {
                    this.setStartAfter(e), this.collapse(!0)
                }, getBookmark: function (t) {
                    if (!t) return {};

                    function i(e) {
                        var t = e.cloneContents();
                        if (t.querySelector("text, ruby")) {
                            for (var n = t.querySelectorAll("svg, ruby"), i = 0; i < n.length; i++) n[i].parentElement.removeChild(n[i]);
                            return t.textContent.length
                        }
                        return e.toString().length
                    }

                    var r = y(this), o = e.createRange(r);
                    t = t || n.getBody(r), o.selectNodeContents(t);
                    var a = this.intersection(o), s = t.querySelectorAll("text, ruby").length, l = 0, c = 0;
                    return a && (o.setEnd(a.startContainer, a.startOffset), c = (l = s ? i(o) : o.toString().length) + (s ? i(a) : a.toString().length)), {
                        start: l,
                        end: c,
                        containerNode: t
                    }
                }, moveToBookmark: function (e) {
                    var t = e.containerNode, n = 0;
                    this.setStart(t, 0), this.collapse(!0);
                    for (var i, r, o, a, s = [t], l = !1, c = !1; !c && (i = s.pop());) if (3 == i.nodeType) r = n + i.length, !l && e.start >= n && e.start <= r && (this.setStart(i, e.start - n), l = !0), l && e.end >= n && e.end <= r && (this.setEnd(i, e.end - n), c = !0), n = r; else if (!/^(text|RUBY)$/i.exec(i.tagName || "")) for (o = (a = i.childNodes).length; o--;) s.push(a[o])
                }, getName: function () {
                    return "DomRange"
                }, equals: function (e) {
                    return ue.rangesEqual(this, e)
                }, isValid: function () {
                    return q(this)
                }, inspect: function () {
                    return F(this)
                }, detach: function () {
                }
            });

            function oe(e) {
                e.START_TO_START = J, e.START_TO_END = X, e.END_TO_END = Z, e.END_TO_START = ee, e.NODE_BEFORE = te, e.NODE_AFTER = ne, e.NODE_BEFORE_AND_AFTER = ie, e.NODE_INSIDE = re
            }

            function ae(e) {
                oe(e), oe(e.prototype)
            }

            function se(e, t) {
                return function () {
                    z(this);
                    var n, i = this.startContainer, r = this.startOffset, o = this.commonAncestorContainer,
                        a = new _(this, !0);
                    i !== o && (i = (n = w(h(i, o, !0))).node, r = n.offset), k(a, H), a.reset();
                    var s = e(a);
                    return a.detach(), t(this, i, r, i, r), s
                }
            }

            function le(t, n) {
                function r(e, t) {
                    return function (n) {
                        P(n, T), P(m(n), M);
                        var i = (e ? b : w)(n);
                        (t ? o : l)(this, i.node, i.offset)
                    }
                }

                function o(e, t, i) {
                    var r = e.endContainer, o = e.endOffset;
                    t === e.startContainer && i === e.startOffset || (m(t) == m(r) && 1 != d(t, i, r, o) || (r = t, o = i), n(e, t, i, r, o))
                }

                function l(e, t, i) {
                    var r = e.startContainer, o = e.startOffset;
                    t === e.endContainer && i === e.endOffset || (m(t) == m(r) && -1 != d(t, i, r, o) || (r = t, o = i), n(e, r, o, t, i))
                }

                var c = function () {
                };
                c.prototype = e.rangePrototype, t.prototype = new c, i.extend(t.prototype, {
                    setStart: function (e, t) {
                        I(e, !0), B(e, t), o(this, e, t)
                    },
                    setEnd: function (e, t) {
                        I(e, !0), B(e, t), l(this, e, t)
                    },
                    setStartAndEnd: function () {
                        var e = arguments, t = e[0], i = e[1], r = t, o = i;
                        switch (e.length) {
                            case 3:
                                o = e[2];
                                break;
                            case 4:
                                r = e[2], o = e[3]
                        }
                        n(this, t, i, r, o)
                    },
                    setBoundary: function (e, t, n) {
                        this["set" + (n ? "Start" : "End")](e, t)
                    },
                    setStartBefore: r(!0, !0),
                    setStartAfter: r(!1, !0),
                    setEndBefore: r(!0, !1),
                    setEndAfter: r(!1, !1),
                    collapse: function (e) {
                        z(this), e ? n(this, this.startContainer, this.startOffset, this.startContainer, this.startOffset) : n(this, this.endContainer, this.endOffset, this.endContainer, this.endOffset)
                    },
                    selectNodeContents: function (e) {
                        I(e, !0), n(this, e, 0, e, f(e))
                    },
                    selectNode: function (e) {
                        I(e, !1), P(e, T);
                        var t = b(e), i = w(e);
                        n(this, t.node, t.offset, i.node, i.offset)
                    },
                    extractContents: se(E, n),
                    deleteContents: se(S, n),
                    canSurroundContents: function () {
                        z(this), H(this.startContainer), H(this.endContainer);
                        var e = new _(this, !0), t = e._first && v(e._first, this) || e._last && v(e._last, this);
                        return e.detach(), !t
                    },
                    splitBoundaries: function () {
                        Q(this)
                    },
                    splitBoundariesPreservingPositions: function (e) {
                        Q(this, e)
                    },
                    normalizeBoundaries: function () {
                        z(this);
                        var e = this.startContainer, t = this.startOffset, i = this.endContainer, r = this.endOffset,
                            o = function (e) {
                                var t = e.nextSibling;
                                t && t.nodeType == e.nodeType && (i = e, r = e.length, e.appendData(t.data), t.parentNode.removeChild(t))
                            }, l = function (n) {
                                var o = n.previousSibling;
                                if (o && o.nodeType == n.nodeType) {
                                    e = n;
                                    var a = n.length;
                                    if (t = o.length, n.insertData(0, o.data), o.parentNode.removeChild(o), e == i) r += t, i = e; else if (i == n.parentNode) {
                                        var l = s(n);
                                        r == l ? (i = n, r = a) : r > l && r--
                                    }
                                }
                            }, c = !0;
                        if (a(i)) i.length == r && o(i); else {
                            if (r > 0) {
                                var d = i.childNodes[r - 1];
                                d && a(d) && o(d)
                            }
                            c = !this.collapsed
                        }
                        if (c) {
                            if (a(e)) 0 == t && l(e); else if (t < e.childNodes.length) {
                                var u = e.childNodes[t];
                                u && a(u) && l(u)
                            }
                        } else e = i, t = r;
                        n(this, e, t, i, r)
                    },
                    collapseToPoint: function (e, t) {
                        I(e, !0), B(e, t), this.setStartAndEnd(e, t)
                    }
                }), ae(t)
            }

            function ce(e) {
                e.collapsed = e.startContainer === e.endContainer && e.startOffset === e.endOffset, e.commonAncestorContainer = e.collapsed ? e.startContainer : n.getCommonAncestor(e.startContainer, e.endContainer)
            }

            function de(e, t, i, r, o) {
                e.startContainer = t, e.startOffset = i, e.endContainer = r, e.endOffset = o, e.document = n.getDocument(t), ce(e)
            }

            function ue(e) {
                this.startContainer = e, this.startOffset = 0, this.endContainer = e, this.endOffset = 0, this.document = e, ce(this)
            }

            le(ue, de), i.extend(ue, {
                rangeProperties: G,
                RangeIterator: _,
                copyComparisonConstants: ae,
                createPrototypeRange: le,
                inspect: F,
                getRangeDocument: y,
                rangesEqual: function (e, t) {
                    return e.startContainer === t.startContainer && e.startOffset === t.startOffset && e.endContainer === t.endContainer && e.endOffset === t.endOffset
                }
            }), e.DomRange = ue
        }), i.createCoreModule("WrappedRange", ["DomRange"], function (e, t) {
            var n, i, r = e.dom, o = e.util, a = r.DomPosition, s = e.DomRange, l = r.getBody, c = r.getContentDocument,
                d = r.isCharacterDataNode;
            if (e.features.implementsDomRange && function () {
                var i, a = s.rangeProperties;

                function d(e) {
                    for (var t, n = a.length; n--;) e[t = a[n]] = e.nativeRange[t];
                    e.collapsed = e.startContainer === e.endContainer && e.startOffset === e.endOffset
                }

                var u;
                n = function (e) {
                    if (!e) throw t.createError("WrappedRange: Range must be specified");
                    this.nativeRange = e, d(this)
                }, s.createPrototypeRange(n, function (e, t, n, i, r) {
                    var o = e.startContainer !== t || e.startOffset != n, a = e.endContainer !== i || e.endOffset != r,
                        s = !e.equals(e.nativeRange);
                    (o || a || s) && (e.setEnd(i, r), e.setStart(t, n))
                }), (i = n.prototype).selectNode = function (e) {
                    this.nativeRange.selectNode(e), d(this)
                }, i.cloneContents = function () {
                    return this.nativeRange.cloneContents()
                }, i.surroundContents = function (e) {
                    this.nativeRange.surroundContents(e), d(this)
                }, i.collapse = function (e) {
                    this.nativeRange.collapse(e), d(this)
                }, i.cloneRange = function () {
                    var e = new n(this.nativeRange.cloneRange());
                    return e.isBackward = this.isBackward, e
                }, i.refresh = function () {
                    d(this)
                }, i.toString = function () {
                    return this.nativeRange.toString()
                };
                var h = document.createTextNode("test");
                l(document).appendChild(h);
                var f = document.createRange();
                f.setStart(h, 0), f.setEnd(h, 0);
                try {
                    f.setStart(h, 1), i.setStart = function (e, t) {
                        this.nativeRange.setStart(e, t), d(this)
                    }, i.setEnd = function (e, t) {
                        this.nativeRange.setEnd(e, t), d(this)
                    }, u = function (e) {
                        return function (t) {
                            this.nativeRange[e](t), d(this)
                        }
                    }
                } catch (e) {
                    i.setStart = function (e, t) {
                        try {
                            this.nativeRange.setStart(e, t)
                        } catch (n) {
                            this.nativeRange.setEnd(e, t), this.nativeRange.setStart(e, t)
                        }
                        d(this)
                    }, i.setEnd = function (e, t) {
                        try {
                            this.nativeRange.setEnd(e, t)
                        } catch (n) {
                            this.nativeRange.setStart(e, t), this.nativeRange.setEnd(e, t)
                        }
                        d(this)
                    }, u = function (e, t) {
                        return function (n) {
                            try {
                                this.nativeRange[e](n)
                            } catch (i) {
                                this.nativeRange[t](n), this.nativeRange[e](n)
                            }
                            d(this)
                        }
                    }
                }
                i.setStartBefore = u("setStartBefore", "setEndBefore"), i.setStartAfter = u("setStartAfter", "setEndAfter"), i.setEndBefore = u("setEndBefore", "setStartBefore"), i.setEndAfter = u("setEndAfter", "setStartAfter"), i.selectNodeContents = function (e) {
                    this.setStartAndEnd(e, 0, r.getNodeLength(e))
                }, f.selectNodeContents(h), f.setEnd(h, 3);
                var p = document.createRange();
                p.selectNodeContents(h), p.setEnd(h, 4), p.setStart(h, 2), -1 == f.compareBoundaryPoints(f.START_TO_END, p) && 1 == f.compareBoundaryPoints(f.END_TO_START, p) ? i.compareBoundaryPoints = function (e, t) {
                    return e == (t = t.nativeRange || t).START_TO_END ? e = t.END_TO_START : e == t.END_TO_START && (e = t.START_TO_END), this.nativeRange.compareBoundaryPoints(e, t)
                } : i.compareBoundaryPoints = function (e, t) {
                    return this.nativeRange.compareBoundaryPoints(e, t.nativeRange || t)
                };
                var m = document.createElement("div");
                m.innerHTML = "123";
                var g = m.firstChild, v = l(document);
                v.appendChild(m), f.setStart(g, 1), f.setEnd(g, 2), f.deleteContents(), "13" == g.data && (i.deleteContents = function () {
                    this.nativeRange.deleteContents(), d(this)
                }, i.extractContents = function () {
                    var e = this.nativeRange.extractContents();
                    return d(this), e
                }), v.removeChild(m), v = null, o.isHostMethod(f, "createContextualFragment") && (i.createContextualFragment = function (e) {
                    return this.nativeRange.createContextualFragment(e)
                }), l(document).removeChild(h), i.getName = function () {
                    return "WrappedRange"
                }, e.WrappedRange = n, e.createNativeRange = function (e) {
                    return (e = c(e, t, "createNativeRange")).createRange()
                }
            }(), e.features.implementsTextRange) {
                var u = function (e, t, n, i, o) {
                    var s = e.duplicate();
                    s.collapse(n);
                    var l = s.parentElement();
                    if (r.isOrIsAncestorOf(t, l) || (l = t), !l.canHaveHTML) {
                        var c = new a(l.parentNode, r.getNodeIndex(l));
                        return {boundaryPosition: c, nodeInfo: {nodeIndex: c.offset, containerElement: c.node}}
                    }
                    var u = r.getDocument(l).createElement("span");
                    u.parentNode && u.parentNode.removeChild(u);
                    for (var h, f, p, m, g, v = n ? "StartToStart" : "StartToEnd", y = o && o.containerElement == l ? o.nodeIndex : 0, b = l.childNodes.length, w = b, C = w; C == b ? l.appendChild(u) : l.insertBefore(u, l.childNodes[C]), s.moveToElementText(u), 0 != (h = s.compareEndPoints(v, e)) && y != w;) {
                        if (-1 == h) {
                            if (w == y + 1) break;
                            y = C
                        } else w = w == y + 1 ? y : C;
                        C = Math.floor((y + w) / 2), l.removeChild(u)
                    }
                    if (g = u.nextSibling, -1 == h && g && d(g)) {
                        s.setEndPoint(n ? "EndToStart" : "EndToEnd", e);
                        var x;
                        if (/[\r\n]/.test(g.data)) {
                            var k = s.duplicate(), S = k.text.replace(/\r\n/g, "\r").length;
                            for (x = k.moveStart("character", S); -1 == (h = k.compareEndPoints("StartToEnd", k));) x++, k.moveStart("character", 1)
                        } else x = s.text.length;
                        m = new a(g, x)
                    } else f = (i || !n) && u.previousSibling, m = (p = (i || n) && u.nextSibling) && d(p) ? new a(p, 0) : f && d(f) ? new a(f, f.data.length) : new a(l, r.getNodeIndex(u));
                    return u.parentNode.removeChild(u), {
                        boundaryPosition: m,
                        nodeInfo: {nodeIndex: C, containerElement: l}
                    }
                }, h = function (e, t) {
                    var n, i, o, a, s = e.offset, c = r.getDocument(e.node), u = l(c).createTextRange(), h = d(e.node);
                    return h ? i = (n = e.node).parentNode : (n = s < (a = e.node.childNodes).length ? a[s] : null, i = e.node), (o = c.createElement("span")).innerHTML = "&#feff;", n ? i.insertBefore(o, n) : i.appendChild(o), u.moveToElementText(o), u.collapse(!t), i.removeChild(o), h && u[t ? "moveStart" : "moveEnd"]("character", s), u
                };
                if ((i = function (e) {
                    this.textRange = e, this.refresh()
                }).prototype = new s(document), i.prototype.refresh = function () {
                    var e, t, n, i = function (e) {
                        var t = e.parentElement(), n = e.duplicate();
                        n.collapse(!0);
                        var i = n.parentElement();
                        (n = e.duplicate()).collapse(!1);
                        var o = n.parentElement(), a = i == o ? i : r.getCommonAncestor(i, o);
                        return a == t ? a : r.getCommonAncestor(t, a)
                    }(this.textRange);
                    0 == (o = this.textRange).compareEndPoints("StartToEnd", o) ? t = e = u(this.textRange, i, !0, !0).boundaryPosition : (e = (n = u(this.textRange, i, !0, !1)).boundaryPosition, t = u(this.textRange, i, !1, !1, n.nodeInfo).boundaryPosition);
                    var o;
                    this.setStart(e.node, e.offset), this.setEnd(t.node, t.offset)
                }, i.prototype.getName = function () {
                    return "WrappedTextRange"
                }, s.copyComparisonConstants(i), i.rangeToTextRange = function (e) {
                    if (e.collapsed) return h(new a(e.startContainer, e.startOffset), !0);
                    var t = h(new a(e.startContainer, e.startOffset), !0),
                        n = h(new a(e.endContainer, e.endOffset), !1), i = l(s.getRangeDocument(e)).createTextRange();
                    return i.setEndPoint("StartToStart", t), i.setEndPoint("EndToEnd", n), i
                }, e.WrappedTextRange = i, !e.features.implementsDomRange || e.config.preferTextRange) {
                    var f = function () {
                        return this
                    }();
                    void 0 === f.Range && (f.Range = i), e.createNativeRange = function (e) {
                        return e = c(e, t, "createNativeRange"), l(e).createTextRange()
                    }, e.WrappedRange = i
                }
            }
            e.createRange = function (n) {
                return n = c(n, t, "createRange"), new e.WrappedRange(e.createNativeRange(n))
            }, e.createRangyRange = function (e) {
                return e = c(e, t, "createRangyRange"), new s(e)
            }, e.createIframeRange = function (n) {
                return t.deprecationNotice("createIframeRange()", "createRange(iframeEl)"), e.createRange(n)
            }, e.createIframeRangyRange = function (n) {
                return t.deprecationNotice("createIframeRangyRange()", "createRangyRange(iframeEl)"), e.createRangyRange(n)
            }, e.addCreateMissingNativeApiListener(function (t) {
                var n = t.document;
                void 0 === n.createRange && (n.createRange = function () {
                    return e.createRange(n)
                }), n = t = null
            })
        }), i.createCoreModule("WrappedSelection", ["DomRange", "WrappedRange"], function (e, t) {
            e.config.checkSelectionRanges = !0;
            var n, i, r = e.dom, o = e.util, a = o.isHostMethod, s = e.DomRange, l = e.WrappedRange, c = e.DOMException,
                d = r.DomPosition, u = e.features, h = r.getDocument, f = r.getBody, p = s.rangesEqual;

            function m(e) {
                return "string" == typeof e ? /^backward(s)?$/i.test(e) : !!e
            }

            function g(e, n) {
                if (e) {
                    if (r.isWindow(e)) return e;
                    if (e instanceof H) return e.win;
                    var i = r.getContentDocument(e, t, n);
                    return r.getWindow(i)
                }
                return window
            }

            function v(e) {
                return g(e, "getDocSelection").document.selection
            }

            function y(e) {
                var t = !1;
                return e.anchorNode && (t = 1 == r.comparePoints(e.anchorNode, e.anchorOffset, e.focusNode, e.focusOffset)), t
            }

            var b = a(window, "getSelection"), w = o.isHostObject(document, "selection");
            u.implementsWinGetSelection = b, u.implementsDocSelection = w;
            var C = w && (!b || e.config.preferTextRange);
            C ? (n = v, e.isSelectionValid = function (e) {
                var t = g(e, "isSelectionValid").document, n = t.selection;
                return "None" != n.type || h(n.createRange().parentElement()) == t
            }) : b ? (n = function (e) {
                return g(e, "getWinSelection").getSelection()
            }, e.isSelectionValid = function () {
                return !0
            }) : t.fail("Neither document.selection or window.getSelection() detected."), e.getNativeSelection = n;
            var x = n(), k = e.createNativeRange(document), S = f(document),
                E = o.areHostProperties(x, ["anchorNode", "focusNode", "anchorOffset", "focusOffset"]);
            u.selectionHasAnchorAndFocus = E;
            var F = a(x, "extend");
            u.selectionHasExtend = F;
            var _ = "number" == typeof x.rangeCount;
            u.selectionHasRangeCount = _;
            var T = F ? function (t, n) {
                var i = s.getRangeDocument(n), r = e.createRange(i);
                r.collapseToPoint(n.endContainer, n.endOffset), t.addRange(R(r)), t.extend(n.startContainer, n.startOffset)
            } : null;
            o.areHostMethods(x, ["addRange", "getRangeAt", "removeAllRanges"]) && "number" == typeof x.rangeCount && u.implementsDomRange && function () {
                var t = window.getSelection();
                if (t) {
                    for (var n = t.rangeCount, i = [], r = y(t), o = 0; o < n; ++o) i[o] = t.getRangeAt(o);
                    for (o = 0; o < n; ++o) 0 == o && r ? T ? T(t, i[o]) : (e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"), t.addRange(i[o])) : t.addRange(i[o])
                }
            }(), u.selectionSupportsMultipleRanges = !1, u.collapsedNonEditableSelectionsSupported = !0;
            var M, A = !1;
            S && a(S, "createControlRange") && (M = S.createControlRange(), o.areHostProperties(M, ["item", "add"]) && (A = !0)), u.implementsControlRange = A, i = E ? function (e) {
                return e.anchorNode === e.focusNode && e.anchorOffset === e.focusOffset
            } : function (e) {
                return !!e.rangeCount && e.getRangeAt(e.rangeCount - 1).collapsed
            };

            function N(e, t, n) {
                var i = n ? "end" : "start", r = n ? "start" : "end";
                e.anchorNode = t[i + "Container"], e.anchorOffset = t[i + "Offset"], e.focusNode = t[r + "Container"], e.focusOffset = t[r + "Offset"]
            }

            function L(e) {
                e.anchorNode = e.focusNode = null, e.anchorOffset = e.focusOffset = 0, e.rangeCount = 0, e.isCollapsed = !0, e._ranges.length = 0
            }

            function R(t) {
                var n;
                return t instanceof s ? ((n = e.createNativeRange(t.getDocument())).setEnd(t.endContainer, t.endOffset), n.setStart(t.startContainer, t.startOffset)) : t instanceof l ? n = t.nativeRange : u.implementsDomRange && t instanceof r.getWindow(t.startContainer).Range && (n = t), n
            }

            function D(e) {
                var n = e.getNodes();
                if (!function (e) {
                    if (!e.length || 1 != e[0].nodeType) return !1;
                    for (var t = 1, n = e.length; t < n; ++t) if (!r.isAncestorOf(e[0], e[t])) return !1;
                    return !0
                }(n)) throw t.createError("getSingleElementFromRange: range " + e.inspect() + " did not consist of a single element");
                return n[0]
            }

            function O(e) {
                return !!e && void 0 !== e.text
            }

            function I(e, t) {
                var n = new l(t);
                e._ranges = [n], N(e, n, !1), e.rangeCount = 1, e.isCollapsed = n.collapsed
            }

            function P(t) {
                if (t._ranges.length = 0, "None" == t.docSelection.type) L(t); else {
                    var n = t.docSelection.createRange();
                    if (O(n)) I(t, n); else {
                        t.rangeCount = n.length;
                        for (var i, r = h(n.item(0)), o = 0; o < t.rangeCount; ++o) (i = e.createRange(r)).selectNode(n.item(o)), t._ranges.push(i);
                        t.isCollapsed = 1 == t.rangeCount && t._ranges[0].collapsed, N(t, t._ranges[t.rangeCount - 1], !1)
                    }
                }
            }

            function B(e, n) {
                for (var i = e.docSelection.createRange(), r = D(n), o = h(i.item(0)), a = f(o).createControlRange(), s = 0, l = i.length; s < l; ++s) a.add(i.item(s));
                try {
                    a.add(r)
                } catch (e) {
                    throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")
                }
                newControlrange.select(n.isBackward), P(e)
            }

            var $;
            a(x, "getRangeAt") ? $ = function (e, t) {
                try {
                    return e.getRangeAt(t)
                } catch (e) {
                    return null
                }
            } : E && ($ = function (t) {
                var n = h(t.anchorNode), i = e.createRange(n);
                return i.setStartAndEnd(t.anchorNode, t.anchorOffset, t.focusNode, t.focusOffset), i.collapsed !== this.isCollapsed && i.setStartAndEnd(t.focusNode, t.focusOffset, t.anchorNode, t.anchorOffset), i
            });

            function H(e, t, n) {
                this.nativeSelection = e, this.docSelection = t, this._ranges = [], this.win = n, this.refresh()
            }

            H.prototype = e.selectionPrototype;

            function U(e) {
                e.win = e.anchorNode = e.focusNode = e._ranges = null, e.rangeCount = e.anchorOffset = e.focusOffset = 0, e.detached = !0
            }

            var j = [];

            function W(e, t) {
                for (var n, i, r = j.length; r--;) if (i = (n = j[r]).selection, "deleteAll" == t) U(i); else if (n.win == e) return "delete" == t ? (j.splice(r, 1), !0) : i;
                return "deleteAll" == t && (j.length = 0), null
            }

            var q = function (e) {
                if (e && e instanceof H) return e.refresh(), e;
                var t = W(e = g(e, "getNativeSelection")), i = n(e), r = w ? v(e) : null;
                return t ? (t.nativeSelection = i, t.docSelection = r, t.refresh()) : (t = new H(i, r, e), j.push({
                    win: e,
                    selection: t
                })), t
            };
            e.getSelection = q, e.getIframeSelection = function (n) {
                return t.deprecationNotice("getIframeSelection()", "getSelection(iframeEl)"), e.getSelection(r.getIframeWindow(n))
            };
            var z = H.prototype;

            function V(e, n) {
                for (var i, r = h(n[0].startContainer), o = f(r).createControlRange(), a = 0, s = n.length; a < s; ++a) {
                    i = D(n[a]);
                    try {
                        o.add(i)
                    } catch (e) {
                        throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")
                    }
                }
                controlrange.select(range.isBackward), P(e)
            }

            if (!C && E && o.areHostMethods(x, ["removeAllRanges", "addRange"])) {
                z.removeAllRanges = function () {
                    this.nativeSelection.removeAllRanges(), L(this)
                };
                var K = function (e, t) {
                    T(e.nativeSelection, t), e.refresh()
                };
                z.addRange = _ ? function (t, n) {
                    if (A && w && "Control" == this.docSelection.type) B(this, t); else if (m(n) && F) K(this, t); else {
                        var r;
                        if (this.removeAllRanges(), r = 0, this.nativeSelection.addRange(R(t).cloneRange()), this.rangeCount = this.nativeSelection.rangeCount, this.rangeCount == r + 1) {
                            if (e.config.checkSelectionRanges) {
                                var o = $(this.nativeSelection, this.rangeCount - 1);
                                o && !p(o, t) && (t = new l(o))
                            }
                            this._ranges[this.rangeCount - 1] = t, N(this, t, G(this.nativeSelection)), this.isCollapsed = i(this)
                        } else this.refresh()
                    }
                } : function (e, t) {
                    m(t) && F ? K(this, e) : (this.nativeSelection.addRange(R(e)), this.refresh())
                }, z.setRanges = function (e) {
                    if (A && e.length > 1) V(this, e); else {
                        this.removeAllRanges();
                        for (var t = 0, n = e.length; t < n; ++t) this.addRange(e[t])
                    }
                }
            } else {
                if (!(a(x, "empty") && a(k, "select") && A && C)) return t.fail("No means of selecting a Range or TextRange was found"), !1;
                z.removeAllRanges = function () {
                    try {
                        if (this.docSelection.empty(), "None" != this.docSelection.type) {
                            var e;
                            if (this.anchorNode) e = h(this.anchorNode); else if ("Control" == this.docSelection.type) {
                                var t = this.docSelection.createRange();
                                t.length && (e = h(t.item(0)))
                            }
                            if (e) {
                                f(e).createTextRange();
                                textrange.select(range.isBackward), this.docSelection.empty()
                            }
                        }
                    } catch (e) {
                    }
                    L(this)
                }, z.addRange = function (t) {
                    "Control" == this.docSelection.type ? B(this, t) : (e.WrappedTextRange.rangeToTextRange(t).select(), this._ranges[0] = t, this.rangeCount = 1, this.isCollapsed = this._ranges[0].collapsed, N(this, t, !1))
                }, z.setRanges = function (e) {
                    this.removeAllRanges();
                    var t = e.length;
                    t > 1 ? V(this, e) : t && this.addRange(e[0])
                }
            }
            z.getRangeAt = function (e) {
                if (e < 0 || e >= this.rangeCount) throw new c("INDEX_SIZE_ERR");
                return this._ranges[e].cloneRange()
            };
            var Y;
            if (C) Y = function (t) {
                var n;
                e.isSelectionValid(t.win) ? n = t.docSelection.createRange() : (n = f(t.win.document).createTextRange()).collapse(!0), "Control" == t.docSelection.type ? P(t) : O(n) ? I(t, n) : L(t)
            }; else if (a(x, "getRangeAt") && "number" == typeof x.rangeCount) Y = function (t) {
                if (A && w && "Control" == t.docSelection.type) P(t); else if (t._ranges.length = t.rangeCount = t.nativeSelection.rangeCount, t.rangeCount) {
                    for (var n = 0, r = t.rangeCount; n < r; ++n) t._ranges[n] = new e.WrappedRange(t.nativeSelection.getRangeAt(n));
                    N(t, t._ranges[t.rangeCount - 1], G(t.nativeSelection)), t.isCollapsed = i(t)
                } else L(t)
            }; else {
                if (!E || "boolean" != typeof x.isCollapsed || "boolean" != typeof k.collapsed || !u.implementsDomRange) return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"), !1;
                Y = function (e) {
                    var t, n = e.nativeSelection;
                    n.anchorNode ? (t = $(n, 0), e._ranges = [t], e.rangeCount = 1, function (e) {
                        var t = e.nativeSelection;
                        e.anchorNode = t.anchorNode, e.anchorOffset = t.anchorOffset, e.focusNode = t.focusNode, e.focusOffset = t.focusOffset
                    }(e), e.isCollapsed = i(e)) : L(e)
                }
            }
            z.refresh = function (e) {
                var t = e ? this._ranges.slice(0) : null, n = this.anchorNode, i = this.anchorOffset;
                if (Y(this), e) {
                    var r = t.length;
                    if (r != this._ranges.length) return !0;
                    if (this.anchorNode != n || this.anchorOffset != i) return !0;
                    for (; r--;) if (!p(t[r], this._ranges[r])) return !0;
                    return !1
                }
            };
            var Q = function (e, t) {
                var n = e.getAllRanges();
                e.removeAllRanges();
                for (var i = 0, r = n.length; i < r; ++i) p(t, n[i]) || e.addRange(n[i]);
                e.rangeCount || L(e)
            };
            z.removeRange = A ? function (e) {
                if ("Control" == this.docSelection.type) {
                    for (var t = this.docSelection.createRange(), n = D(e), i = h(t.item(0)), r = f(i).createControlRange(), o = !1, a = 0, s = t.length; a < s; ++a) t.item(a) !== n || o ? r.add(t.item(a)) : o = !0;
                    newControlrange.select(e.isBackward), P(this)
                } else Q(this, e)
            } : function (e) {
                Q(this, e)
            };
            var G;
            !C && E && u.implementsDomRange ? (G = y, z.isBackward = function () {
                return G(this)
            }) : G = z.isBackward = function () {
                return !1
            }, z.isBackwards = z.isBackward, z.toString = function () {
                for (var e = [], t = 0, n = this.rangeCount; t < n; ++t) e[t] = "" + this._ranges[t];
                return e.join("")
            };

            function J(e, t) {
                if (e.win.document != h(t)) throw new c("WRONG_DOCUMENT_ERR")
            }

            z.collapse = function (t, n) {
                J(this, t);
                var i = e.createRange(t);
                i.collapseToPoint(t, n), this.setSingleRange(i), this.isCollapsed = !0
            }, z.collapseToStart = function () {
                if (!this.rangeCount) throw new c("INVALID_STATE_ERR");
                var e = this._ranges[0];
                this.collapse(e.startContainer, e.startOffset)
            }, z.collapseToEnd = function () {
                if (!this.rangeCount) throw new c("INVALID_STATE_ERR");
                var e = this._ranges[this.rangeCount - 1];
                this.collapse(e.endContainer, e.endOffset)
            }, z.selectAllChildren = function (t) {
                J(this, t);
                var n = e.createRange(t);
                n.selectNodeContents(t), this.setSingleRange(n)
            }, z.deleteFromDocument = function () {
                if (A && w && "Control" == this.docSelection.type) {
                    for (var e, t = this.docSelection.createRange(); t.length;) e = t.item(0), t.remove(e), e.parentNode.removeChild(e);
                    this.refresh()
                } else if (this.rangeCount) {
                    var n = this.getAllRanges();
                    if (n.length) {
                        this.removeAllRanges();
                        for (var i = 0, r = n.length; i < r; ++i) n[i].deleteContents();
                        this.addRange(n[r - 1])
                    }
                }
            }, z.eachRange = function (e, t) {
                for (var n = 0, i = this._ranges.length; n < i; ++n) if (e(this.getRangeAt(n))) return t
            }, z.getAllRanges = function () {
                var e = [];
                return this.eachRange(function (t) {
                    e.push(t)
                }), e
            }, z.setSingleRange = function (e, t) {
                this.removeAllRanges(), this.addRange(e, t)
            }, z.callMethodOnEachRange = function (e, t) {
                var n = [];
                return this.eachRange(function (i) {
                    n.push(i[e].apply(i, t))
                }), n
            };

            function X(t) {
                return function (n, i) {
                    var r;
                    this.rangeCount ? (r = this.getRangeAt(0))["set" + (t ? "Start" : "End")](n, i) : (r = e.createRange(this.win.document)).setStartAndEnd(n, i), this.setSingleRange(r, this.isBackward())
                }
            }

            z.setStart = X(!0), z.setEnd = X(!1), e.rangePrototype.select = function (e) {
                q(this.getDocument()).setSingleRange(this, e)
            }, z.changeEachRange = function (e) {
                var t = [], n = this.isBackward();
                this.eachRange(function (n) {
                    e(n), t.push(n)
                }), this.removeAllRanges(), n && 1 == t.length ? this.addRange(t[0], "backward") : this.setRanges(t)
            }, z.containsNode = function (e, t) {
                return this.eachRange(function (n) {
                    return n.containsNode(e, t)
                }, !0)
            }, z.getBookmark = function (e) {
                return {backward: this.isBackward(), rangeBookmarks: this.callMethodOnEachRange("getBookmark", [e])}
            }, z.moveToBookmark = function (t) {
                for (var n, i, r = [], o = 0; n = t.rangeBookmarks[o++];) (i = e.createRange(this.win)).moveToBookmark(n), r.push(i);
                t.backward ? this.setSingleRange(r[0], "backward") : this.setRanges(r)
            }, z.toHtml = function () {
                return this.callMethodOnEachRange("toHtml").join("")
            };

            function Z(e) {
                var t = [], n = new d(e.anchorNode, e.anchorOffset), i = new d(e.focusNode, e.focusOffset),
                    r = "function" == typeof e.getName ? e.getName() : "Selection";
                if (void 0 !== e.rangeCount) for (var o = 0, a = e.rangeCount; o < a; ++o) t[o] = s.inspect(e.getRangeAt(o));
                return "[" + r + "(Ranges: " + t.join(", ") + ")(anchor: " + n.inspect() + ", focus: " + i.inspect() + "]"
            }

            z.getName = function () {
                return "WrappedSelection"
            }, z.inspect = function () {
                return Z(this)
            }, z.detach = function () {
                W(this.win, "delete"), U(this)
            }, H.detachAll = function () {
                W(null, "deleteAll")
            }, H.inspect = Z, H.isDirectionBackward = m, e.Selection = H, e.selectionPrototype = z, e.addCreateMissingNativeApiListener(function (e) {
                void 0 === e.getSelection && (e.getSelection = function () {
                    return q(e)
                }), e = null
            })
        }), n.exports = i
    }), $__System.registerDynamic("1c", ["11", "13", "12", "1a", "1b"], !0, function (e, t, n) {
        "use strict";
        this || self, e("11"), e("13");
        var i, r, o = e("12"), a = (e("1a").SnapFlag, o.Node, o.TYPE, e("1b")), s = ["“", "”", "‘", "’"], l = {
            isSmartQuote: function (e) {
                return !!l.shouldTriggerReplaceQuote() && [l.userQuote(0), l.userQuote(1), l.userQuote(2), l.userQuote(3)].indexOf(e) > -1
            }, shouldTriggerReplaceQuote: function (e) {
                return !File.option.convertSmartOnRender && (e || !File.isMac) && File.option.smartQuote
            }, replaceQuote: function (e, t) {
                if (!File.option.convertSmartOnRender && File.option.smartQuote) {
                    var n = "'" == e.textContent.toString()[0];
                    e && (2 == e.textContent.length ? e.nodeValue = l.userQuote(n ? 2 : 0, !1, !0) + l.userQuote(n ? 3 : 1, !1, !0) : e.nodeValue = l.userQuote(n ? 2 : 0, !1, !0)), t && (t.nodeValue = l.userQuote(n ? 3 : 1, !1, !0))
                }
            }, userQuote: function (e, t, n) {
                var i = (File.option.userQuotesArray || s)[e] || s[e];
                return !t || '"' != i && "'" != i ? n ? i : i.trim() : null
            }, shouldTriggerReplace: function (e, t) {
                var n = e.getJQueryElem(t.commonAncestorContainer);
                return !n.closest("code, script, pre, [md-inline='escape']").length && !n.find("code, script, [md-inline='escape']").length
            }, clearLastQuoteState: function () {
                i = !1, r = !1
            }, handlerCh: function (e, t, n, o, s, c) {
                var d, u = function (e, t) {
                    var n = e[e.length - 1] || "";
                    return !(!/(^|[\(\{\[\s\-/\u2018])$/.exec(n) && !/(^|\s)[*`~+^$_]$/.exec(e)) || (!(!t || l.userQuote(0) != n) || !t && l.userQuote(2) == n)
                }, h = function () {
                    return void 0 !== d ? d : d = f().replace(/\\[-."']/g, "")
                }, f = function () {
                    try {
                        var e = a.createRange();
                        return e.setEnd(c.startContainer, c.startOffset), e.setStart($(c.startContainer).closest("[md-inline], [cid]")[0], 0), e.toString()
                    } catch (e) {
                    }
                    return ""
                }, p = function (i, r) {
                    var o = function () {
                        var n = e.selection.buildUndo(c);
                        return c.insertNode(document.createTextNode(t)), n.end = n.start + 1, n.start = n.end, n
                    }();
                    o.start -= 1 + i, e.selection.restoreSelection(e.findElemById(n.cid)[0], {
                        start: o.end,
                        end: o.end
                    }), e.undo.snap(n.cid, 2, void 0, !0);
                    var a = e.selection.restoreSelection(e.findElemById(n.cid)[0], {start: o.start, end: o.end});
                    if (a) {
                        var s = document.createTextNode(r);
                        a.deleteContents(), a.insertNode(s), a.setStartAndEnd(s, 1), a.select()
                    }
                }, m = function (t, n) {
                    var o = e.getMarkElem(t.startContainer), a = e.selection.getOffset(o, t);
                    return n ? !(!i || i.startContainer != o[0] || i.startOffset != a) || (i = {
                        startContainer: o[0],
                        startOffset: a
                    }, !1) : !(!r || r.startContainer != o[0] || r.startOffset != a) || (r = {
                        startContainer: o[0],
                        startOffset: a
                    }, !1)
                };
                if (!File.option.convertSmartOnRender && !File.isMac) {
                    if ("-" == t && File.option.smartDash) {
                        if (!l.shouldTriggerReplace(e, c)) return;
                        var g;
                        if (/\\$/.exec(h())) return;
                        if (g = /(--|–)$/.exec(h())) return p(g[0].length, "—"), !0;
                        if (/-$/.exec(h())) return p(1, "–"), !0
                    }
                    if ("." == t && File.option.smartDash) {
                        if (!l.shouldTriggerReplace(e, c)) return;
                        if (/\\$/.exec(h())) return;
                        if (/\.\.$/.exec(h())) return p(2, "…"), !0
                    }
                    var v;
                    if ("'" == t && File.option.smartQuote) {
                        if (!l.shouldTriggerReplace(e, c)) return;
                        if (/\\$/.exec(h())) return;
                        return v = u(h(), !0), m(c, !0) && (i = null, v = !v), v ? (p(0, l.userQuote(2)), !0) : (p(0, l.userQuote(3)), !0)
                    }
                    if ('"' == t && File.option.smartQuote) {
                        if (!l.shouldTriggerReplace(e, c)) return;
                        if (/\\$/.exec(h())) return;
                        return v = u(h(), !1), m(c, !1) && (r = null, v = !v), v ? (p(0, l.userQuote(0)), !0) : (p(0, l.userQuote(1)), !0)
                    }
                }
            }
        };
        n.exports = l
    }), $__System.registerDynamic("54", ["4d", "4e", "13", "28", "31", "25", "52", "53", "1c"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i = e("4d"), r = e("4e"), o = e("13"), a = e("28"), s = e("31"), l = e("25").map, c = e("52"), d = e("53"),
            u = e("1c"), h = window.reqnode ? reqnode("electron").remote : null, f = h && h.app, p = function (e) {
                File.isNodeHtml && (this.sessionStr = e, $(document).ready(k.bind(this)))
            }, m = !1, g = function (e, t) {
                var n = f.setting.get("SmartyPantsOnRendering") || !1, i = f.setting.get("smartQuote") || !1,
                    r = f.setting.get("smartDash") || !1, o = f.setting.get("remapPunctuation") || !n && (i || r),
                    a = !n && (i || r);
                if (!t) {
                    var s = (e = e || v()).getItem("Remap Unicode Punctuation on Parse");
                    s.setState(o), s.setEnabled(!a)
                }
                $("#remap-punctuation").prop("checked", o), $("#remap-punctuation").prop("disabled", a)
            }, v = function () {
                return h.Menu.getApplicationMenu().getItem("Edit").submenu.getItem("Smart Punctuation").submenu
            }, y = function (e) {
                var t = v(), n = t.getItem("Convert on Input"), i = t.getItem("Convert on Rendering");
                h.app.setting.put("SmartyPantsOnRendering", e || !1), e ? (n.setState(!1), i.setState(!0), c.execForAll("function() {            File.option.convertSmartOnRender = true;        }")) : (n.setState(!0), i.setState(!1), c.execForAll("function() {            File.option.convertSmartOnRender = false;        }")), g(t), File.MenuHelper.forceRefreshMenu()
            }, b = function (e) {
                var t = v();
                t.getItem("Smart Dashes").setState(e || !1), h.app.setting.put("smartDash", e || !1), e ? c.execForAll("function() {            File.option.smartDash = true;        }") : c.execForAll("function() {            File.option.smartDash = false;        }"), g(t), File.MenuHelper.forceRefreshMenu()
            }, w = function (e) {
                var t = v();
                t.getItem("Smart Quotes").setState(e || !1), h.app.setting.put("smartQuote", e || !1), e ? c.execForAll("function() {            File.option.smartQuote = true;        }") : c.execForAll("function() {            File.option.smartQuote = false;        }"), g(t), File.MenuHelper.forceRefreshMenu()
            }, C = function (e) {
                var t = v();
                h.app.setting.put("remapPunctuation", e || !1), e ? c.execForAll("function() {            File.option.remapUnicodePunctuation = true;        }") : c.execForAll("function() {            File.option.remapUnicodePunctuation = false;        }"), g(t), File.MenuHelper.forceRefreshMenu()
            };
        p.prototype.setSmartyPantsTiming = y, p.prototype.setSmartDash = b, p.prototype.setSmartQuote = w, p.prototype.setRemapPunctuation = C;
        var x = null;
        p.prototype.hide = function () {
            fastdom.mutate(function () {
                if (!$("#megamenu-section-preference.hide").length && !N()) return !1;
                document.body.classList.remove("megamenu-opened"), File.editor.lastCursor && File.editor.undo.exeCommand(File.editor.lastCursor), m = !1
            })
        }, p.prototype.show = function () {
            File.editor.lastCursor = File.editor.selection.buildUndo(), document.body.classList.add("megamenu-opened"), $(".dropdown-menu").removeClass("open").removeClass("show"), File.editor.cleanTooltip(), $("#md-notification").hide()
        }, p.prototype.highlight = function (e) {
            c.showPreferencePanel();
            var t = "#preference-dialog";
            document.body.classList.contains("unibody-window") && (t = "#megamenu-content");
            var n = $("#" + e);
            setTimeout(function () {
                $(t).scrollTop($(t).scrollTop() + n[0].getBoundingClientRect().top - 100), n.addClass("blink-area"), setTimeout(function () {
                    n.removeClass("blink-area")
                }, 3e3)
            }, 500)
        };
        var k = function () {
            function e() {
                if (!$("#megamenu-section-preference.hide").length && !N()) return !1;
                var e = this.getAttribute("id").substr(2);
                $(".megamenu-section").addClass("hide"), $("#megamenu-section-" + e).removeClass("hide"), $("#megamenu-menu-list a").removeClass("active"), $(this).addClass("active")
            }

            if ($(document).on("keydown", function (e) {
                "Esc" === l[e.keyCode || e.which] && File.megaMenu.hide()
            }), $(".megamenu-menu-panel").on("keydown", "input, button", function (e) {
                "Esc" === l[e.keyCode || e.which] && File.megaMenu.hide()
            }), $("#w-menu-btn").click(function () {
                return File.megaMenu.show(), $("#m-open").trigger("click"), !1
            }), $(".megamenu-menu-header").click(function () {
                return File.megaMenu.hide(), !1
            }).mouseleave(function () {
                $(this).blur()
            }), $("#m-open").on("active", function () {
                if (!1 === e.call(this)) return !1;
                !function () {
                    $("#recent-document-table");
                    if (File.isNode) {
                        h.getCurrentWindow();
                        var e = h.app, t = e.setting.getRecentDocuments(), n = e.setting.getRecentFolders(),
                            a = reqnode("fs-plus");
                        if (t.map(function (e) {
                            e["recent-file-dir"] = a.tildify(e.path.substr(0, e.path.length - e.name.length)), e["recent-file-name"] = o.escape(e.name), e["recent-file-path"] = o.escape(e.path)
                        }), n.map(function (e) {
                            e["recent-file-dir"] = "(folder)", e["recent-file-name"] = o.escape(e.name), e["recent-file-path"] = o.escape(e.path)
                        }), t = (t = t.concat(n)).filter(function (e) {
                            return e["recent-file-name"].trim().length > 0
                        }).sort(function (e, t) {
                            return -e.date + t.date
                        }), x) x.clear(), x.add(t); else {
                            var s = {
                                item: "recent-file-item-pattern",
                                listClass: "list-js-list",
                                valueNames: ["name"],
                                plugins: [r()]
                            };
                            x = new i("recent-file-panel", s, t)
                        }
                    }
                }()
            }).on("click", function () {
                $(this).trigger("active");
                !$("#megamenu-section-open").removeClass("hide").is(":visible") && $("#m-open-local").trigger("click")
            }), $("#m-export, #m-about").click(e), $("#m-theme").click(function () {
                if (F(), !1 === e.call(this)) return !1
            }), $("#m-preference").click(function () {
                File.megaMenu.prepPreferencePanel(), e.call(this)
            }), File.isNode) {
                h.getCurrentWindow();
                var t = h.app;
                $("#m-close").click(c.close), $("#m-new").click(c.newFile), $("#recent-file-panel").on("click", ".recent-file-item", function () {
                    var e = this.querySelector(".recent-file-path").innerHTML, n = o.unescape(e);
                    File.fs.existsSync(n) ? (c.openWithPath(n), File.megaMenu.hide()) : (a.getDialog($.localize.getString("Error"), $.localize.getString("File does not exist at <em>{0}</em>", "Panel").format(e), !0, "error-dialog").modal({backdrop: "static"}), t.setting.removeRecentDocument(n), x && x.remove("path", n))
                }), $("#megamenu-clear-recet-documents").click(function () {
                    t.setting.clearRecentDocuments(), x.clear()
                }), $("#m-open-local").click(c.open), $("#m-import-local").click(c.import), $("#m-save").click(c.save), $("#m-save-as").click(c.saveAs), $("#export-as-pdf").click(c.exportPDF), $("#export-as-html").click(c.exportHTML), $("#export-as-html-plain").click(c.exportHTMLPlain), $("#export-as-image").click(c.exportImage), $("#export-as-docx").click(c.exportDocx), $("#export-as-odt").click(c.exportOdt), $("#export-as-rtf").click(c.exportRTF), $("#export-as-epub").click(c.exportEpub), $("#export-as-latex").click(c.exportLaTeX), $("#export-as-wiki").click(c.exportWiki), $("#export-as-rst").click(c.exportRST), $("#export-as-opml").click(c.exportOPML), $("#export-as-textile").click(c.exportTextile), $("#m-print").click(c.print), A(), S()
            }
        }, S = function () {
            $("#about-page-version-label").text("version " + h.app.getVersion() + "(beta)"), h.app.setting.get("framelessWindow") || $("#about-content-about-section").appendTo("#about-dialog .modal-body"), $("#typora-help-md-table tr").click(function () {
                this.textContent.trim() == $.localize.getString("Support Documentation", "Panel") ? h.shell.openExternal("http://support.typora.io") : h.app.openFile(window.__dirname + "/Docs/" + this.textContent.trim() + ".md", {forceCreateWindow: !0})
            })
        }, E = !1, F = function () {
            var e = f.setting.getAllThemes(), t = "";
            E || (e.map(function (e) {
                t += '<div class="theme-preview-div" data-theme="$theme$" ><iframe class="theme-preview-content" src="html/preview.html?$src$""></iframe><div style="position:absolute; top:0;left:0;bottom:0;right:0;background:white;opacity:0;padding:0;margin:0;"></div><i class="fa fa-check-circle"></i></div>'.replace("$src$", encodeURI("folder=" + f.getPath("userData").replace(/\\/g, "\\\\") + "/themes&&css=" + e)).replace("$theme$", e)
            }), $("#theme-preview-grid").html(t).on("click", ".theme-preview-div", function () {
                $("#theme-preview-grid").find(".active").removeClass("active");
                var e = $(this).addClass("active").attr("data-theme");
                c.setTheme(e, e.replace(/\.css$/, "").replace(/(?:^|_|-)(\w)/g, function (e, t, n) {
                    return t.toUpperCase()
                }))
            }), E = !0), $("#theme-preview-grid [data-theme='" + f.setting.getCurrentTheme() + "']").addClass("active")
        }, _ = function () {
            var e = f.setting.get("image_save_location");
            $("#image_save_location").val(e || ""), $("#custom-image-folder").val(f.setting.get("custom_image_save_location") || "./"), "custom" == e ? $(".ty-image-folder-input-group").show() : $(".ty-image-folder-input-group, .ty-image-folder-hint-group").hide()
        }, T = function (e) {
            e = e || "", $("#pin-folder-val").attr("ty-hint", e).val(reqnode("path").basename(e))
        }, M = function (e, t) {
            e = void 0 === e ? File.option.indentByTab ? -1 : File.option.indentSize : e;
            var n = (t = void 0 == t ? File.option.prettyIndent : t) ? ["> Quote\n- List item\n  1. sub-bullet\n     line2", ">  Quote\n-  List item\n   1. sub-bullet\n      line2", ">   Quote\n-   List item\n    1.  sub-bullet\n        line2", ">    Quote\n-    List item\n     1.   sub-bullet\n          line2"] : ["> Quote\n- List item\n  1. sub-bullet\n     line2", "> Quote\n- List item\n   1. sub-bullet\n      line2", "> Quote\n- List item\n    1. sub-bullet\n        line2", "> Quote\n- List item\n     1. sub-bullet\n          line2"];
            e < 0 ? $("#preference-indent-size-pre").text("> Quote\n- List item\n\t1. sub-bullet\n\t\tline2") : $("#preference-indent-size-pre").text(n[(e || 2) - 2])
        }, A = function () {
            var e = h.getCurrentWindow(), t = h.app, n = reqnode("fs-extra"),
                i = (reqnode("electron").ipcRenderer, function () {
                }), r = function (e) {
                    n.copy(window.__dirname + "/conf.default.json", t.getPath("userData") + "/conf/conf.default.json", {overwrite: !0}, e || i), n.copy(window.__dirname + "/conf.default.json", t.getPath("userData") + "/conf/conf.user.json", {overwrite: !0}, i)
                };
            $("#preference-content").on("change", "input[name='windowStyleType']", function () {
                t.setting.put("framelessWindow", "framelessWindow" == $("input[name='windowStyleType']:checked").val())
            }).on("change", "#show-status-bar-btn", function () {
                var e = $("#show-status-bar-btn:checked").length > 0;
                t.setting.put("showStatusBar", e), c.execForAll('function() {            document.body.classList.toggle("show-footer");        }')
            }).on("change", "input[name='fontSize']", function () {
                var e = $("#use-custom-font-size-btn").prop("checked");
                t.setting.put("useCustomFontSize", e), c.execForAll('function() {            var app = reqnode("electron").remote.app,                useCustomFontSize = app.setting.get("useCustomFontSize");            if (useCustomFontSize) {                document.body.parentElement.style.fontSize = (app.setting.get("customFontSize") || 14) + "px";            } else {                document.body.parentElement.style.fontSize = "";            }        }')
            }).on("keypress", "#custom-font-size-input", function (e) {
                if (!/\d/.exec(String.fromCharCode(e.which))) return !1
            }).on("blur", "#custom-font-size-input", function (e) {
                var n = /\d+/.exec(this.value)[0];
                t.setting.put("customFontSize", n), c.execForAll('function() {            var app = reqnode("electron").remote.app;            document.body.parentElement.style.fontSize = app.setting.get("customFontSize") + "px";        }')
            }).on("change", "#collapsible-outline-btn", function () {
                var e = $("#collapsible-outline-btn:checked").length > 0;
                t.setting.put("can_collapse_outline_panel", e), c.execForAll("function() {            File.setCanCollapsePinnedOutline(" + !!e + ");        }")
            }).on("change", "[name='enable_inline_math'], [name='enable_subscript'],[name='enable_superscript'],[name='enable_highlight'],[name='enable_diagram'],[name='copy_markdown_by_default'], [name='show_line_numbers_for_fence'],[name='auto_correct_misspell'], [name='auto_numbering_for_math'], [name='use_relative_path_for_img'], [name='strict_mode']", function () {
                var e = this.getAttribute("name"), n = $(this).prop("checked");
                t.setting.put(e, n), "strict_mode" != e && c.execForAll("function(){File.option." + o.camelize(e) + " = " + n + ";}")
            }).on("change", "#preLinebreakOnExport", function () {
                var e = $(this).val();
                t.setting.put("preLinebreakOnExport", 1 == e || "true" == e), c.execForAll("function() {            File.option.preLinebreakOnExport = $1;        }", e + "")
            }).on("change", "#ignoreLineBreak", function () {
                var e = $(this).val();
                t.setting.put("ignoreLineBreak", e)
            }).on("change", "[name='no_line_wrapping']", function () {
                var e = $(this).prop("checked");
                t.setting.put("no_line_wrapping", !e)
            }).on("change", "#preference-indent-size-btn", function () {
                var e = this.value - 0;
                t.setting.put("indentSize", e), M(e), c.execForAll('function() {            File.setIndentSize("$1");        }', e)
            }).on("change", "#preference-pretty-indent-btn", function () {
                var e = $(this).prop("checked");
                t.setting.put("prettyIndent", e), M(void 0, e), c.execForAll("function() {            File.option.prettyIndent = $1;        }", e)
            }).on("change", "#preference-code-indent-size-btn", function () {
                var e = this.value - 0;
                t.setting.put("codeIndentSize", e), c.execForAll("function() {            File.option.codeIndentSize = $1;        }", e)
            }).on("change", "#preference-trigger-debug-btn", function () {
                var e = $("#preference-trigger-debug-btn:checked").length > 0;
                t.setting.put("debug", e), e ? c.execForAll("function() {$(\"[data-group='dev-tool']\").show();}") : c.execForAll("function() {$(\"[data-group='dev-tool']\").hide();}")
            }).on("change", "#preference-send-anony-info-btn", function () {
                t.setting.put("send_usage_info", $("#preference-send-anony-info-btn:checked").length > 0)
            }).on("change", "#spellcheck-option", function () {
                var e = $(this).val();
                t.setting.put("preset_spell_check", e), File.option.presetSpellCheck = e, File.editor.spellChecker.setLangMode(e)
            }).on("change", "#preference_auto_pair", function () {
                var e = !$(this).prop("checked");
                t.setting.put("no_pairing_match", e), c.execForAll("function(){File.option.noPairingMatch = " + e + ";}"), e && $("#preference_auto_pair_markdown").prop("checked", !1), $("#preference_auto_pair_markdown").prop("disabled", e)
            }).on("change", "#preference_auto_pair_markdown", function () {
                var e = $(this).prop("checked");
                t.setting.put("match_pari_markdown", e), c.execForAll("function(){File.option.autoPairExtendSymbol = " + e + ";}")
            }).on("change", "[name='defaultLineEnding']", function () {
                var e = $("#trigger-line-ending-crlf").prop("checked");
                t.setting.put("line_ending_crlf", e), c.execForAll("function(){File.option.preferCRLF = " + e + ";}")
            }).on("change", "#preference_expand_block", function () {
                var e = $(this).prop("checked");
                t.setting.put("auto_expand_block", e), c.execForAll("function(){File.option.expandSimpleBlock = " + e + ";}")
            }).on("change", "#preference-heading-style", function () {
                var e = $(this).val() - 0;
                t.setting.put("heading_style", e), c.execForAll("function(){File.option.headingStyle = " + e + ";}")
            }).on("change", "#preference-ul-style", function () {
                var e = $(this).val() - 0;
                t.setting.put("ul_style", e), c.execForAll("function(){File.option.ulStyle = " + e + ";}")
            }).on("change", "#preference-ol-style", function () {
                var e = $(this).val() - 0;
                t.setting.put("ol_style", e), c.execForAll("function(){File.option.olStyle = " + e + ";}")
            }).on("change", "[name='autocompleteTrigger']", function () {
                var e = $("#trigger-emoji-autocomplete-on").prop("checked");
                t.setting.put("trigger_emoji_autocomplete", e), c.execForAll("function(){File.option.autoToggleEmojiAutoComplete = " + e + ";}")
            }).on("click", "#preference-open-draft-folder", function () {
                h.shell.openItem(s.getUnsavedDraftsPath())
            }).on("change", "#preference-auto-save", function () {
                var e = $(this).prop("checked");
                t.setting.put("enableAutoSave", e), File.option.enableAutoSave = e, c.execForAll("function(){File.option.enableAutoSave = " + e + ";}"), $("#preference-auto-save-on-switch").prop("checked", File.option.enableAutoSave || File.option.saveFileOnSwitch), $("#preference-auto-save-on-switch").prop("disabled", File.option.enableAutoSave)
            }).on("change", "#preference-auto-save-on-switch", function () {
                var e = $(this).prop("checked");
                t.setting.put("save_file_on_switch", e), c.execForAll("function(){File.option.saveFileOnSwitch = " + e + ";}")
            }).on("click", "#open-conf-folder-btn", function () {
                var e = t.getPath("userData") + "/conf/conf.user.json";
                reqnode("fs-plus").isFileSync(e) ? h.shell.showItemInFolder(e) : r(function () {
                    h.shell.showItemInFolder(e)
                })
            }).on("click", "#reset-conf-folder-btn", function () {
                $(".modal:not(.block-modal)").modal("hide");
                var e = a.getDialog($.localize.getString("Confrim"), $.localize.getString("Revert advanced setting file to default one ?")).modal({backdrop: !1});
                e.find(".btn-primary").one("click", function () {
                    r(), e.modal("hide")
                })
            }).on("change", "[name='scroll_with_cursor']", function () {
                var e = !$(this).prop("checked");
                t.setting.put("no_mid_caret", e), c.execForAll("function(){File.option.scrollWithCursor = !" + e + ";}")
            }).on("change", "#preference-lanuage", function () {
                t.setting.put("userLanguage", $("#preference-lanuage").val())
            }).on("change", "#apply_image_move_for_web", function () {
                var e = $(this).prop("checked");
                t.setting.put("apply_image_move_for_web", e), c.execForAll("function(){File.option.applyImageMoveForWeb = " + e + ";}")
            }).on("change", "#apply_image_move_for_local", function () {
                var e = $(this).prop("checked");
                t.setting.put("no_image_move_for_local", !e), c.execForAll("function(){File.option.applyImageMoveForLocal = " + e + ";}")
            }).on("change", "#restoreWhenLaunch", function () {
                var e = t.setting.get("restoreWhenLaunch") || 0, n = (this.value || "0") - 0;
                if (t.setting.put("restoreWhenLaunch", n), 3 == n) {
                    var i = t.setting.get("pinFolder");
                    $("#select-pin-input-group").show(), i ? T(i) : d(function () {
                        e != n && ($("#select-pin-input-group").hide(), $("#restoreWhenLaunch").val(e), t.setting.put("restoreWhenLaunch", e))
                    })
                } else $("#select-pin-input-group").hide()
            }).on("click", ".open-pandoc-guide", function () {
                t.openFile(window.__dirname + "/Docs/Install and Use Pandoc.md")
            }).on("click", "#select-pin-folder", d), $("body").on("click", ".ty-open-theme-folder-btn", function () {
                h.shell.openItem(h.app.getPath("userData") + "/themes")
            });

            function d(n) {
                h.dialog.showOpenDialog(e, {
                    defaultPath: t.setting.get("pinFolder") || File.mountFolder_,
                    properties: ["openDirectory", "promptToCreate"]
                }, function (e) {
                    e && 0 != e.length ? (t.setting.put("pinFolder", e[0]), T(e[0])) : n && n()
                })
            }

            !function () {
                function i(e) {
                    if (/^\.\.?[\/\\]/.exec(e)) return !1;
                    var t = e.indexOf("${filename}"), i = e;
                    return t > -1 && (i = e.substr(0, t)), i ? "/" == i ? $.localize.getString("Cannot use root path.", "Panel") : !function (e) {
                        try {
                            return n.lstatSync(e).isDirectory()
                        } catch (e) {
                        }
                        return !1
                    }(i) && $.localize.getString("Folder not exist at %@, please input another path.", "Panel").replace("%@", "<em>" + o.escape(i) + "</em>") : $.localize.getString("Please input the folder path for images.", "Panel")
                }

                function r() {
                    var e = $("#custom-image-folder").val().trim();
                    if (e) {
                        var n = i(e);
                        n ? ($(".ty-image-folder-group").addClass("ty-error"), $(".ty-image-folder-error-group .ty-msg").html(n)) : ($(".ty-image-folder-group").removeClass("ty-error"), t.setting.put("image_save_location", "custom"), t.setting.put("custom_image_save_location", e), c.execForAll("function(){File.setDefaultImageStorage('" + e + "');}"))
                    }
                }

                $("#preference-content").on("change", "#image_save_location", function () {
                    var e = $(this).val();
                    "custom" !== e ? (t.setting.put("image_save_location", e), c.execForAll("function(){File.setDefaultImageStorage('" + e + "');}"), $(".ty-image-folder-input-group, .ty-image-folder-hint-group").hide(), $(".ty-image-folder-group").removeClass("ty-error")) : ($(".ty-image-folder-input-group, .ty-image-folder-hint-group").show(), $("#custom-image-folder").val(t.setting.get("custom_image_save_location") || "./").blur().select())
                }).on("blur", "#custom-image-folder", function () {
                    r()
                }).on("focus", "#custom-image-folder", function () {
                    $(".ty-image-folder-hint-group").show(), m = !0
                }).on("keydown", "#custom-image-folder", function (e) {
                    "Enter" !== l[e.keyCode || e.which] && "Esc" !== l[e.keyCode || e.which] || r()
                }).on("click", "#restore-ty-image-folde-btn", function () {
                    _(), $(".ty-image-folder-group").removeClass("ty-error")
                }).on("click", "#select-image-folder", function () {
                    h.dialog.showOpenDialog(e, {
                        defaultPath: t.setting.get("custom_image_save_location") || File.mountFolder_,
                        properties: ["openDirectory", "promptToCreate"]
                    }, function (e) {
                        e && e.length > 0 && $("#custom-image-folder").val(e[0])
                    })
                }), $("#preference-dialog").on("hide.bs.modal", N)
            }(), function () {
                try {
                    var e = File.isWin && reqnode("winsparkle-node");
                    $(document).on("click", "#preference-trigger-check-update", function () {
                        File.isWin && (e.setAppcastUrl("https://www.typora.io/windows/dev_update.xml"), e.checkUpdateWithUI())
                    }).on("change", "#preference-enable-auto-update", function () {
                        $("#preference-enable-auto-update:checked").length ? (e.setAutomaticCheckForUpdates(!0), t.setting.put("enableAutoUpdate", !0)) : (e.setAutomaticCheckForUpdates(!1), t.setting.put("enableAutoUpdate", !1))
                    })
                } catch (e) {
                    console.sendError(e)
                }
            }(), $("#preference-content").on("change", "#smart-quote", function () {
                var e = $(this).prop("checked");
                w(e)
            }).on("change", "#smart-dash", function () {
                var e = $(this).prop("checked");
                b(e)
            }).on("change", "[name='convertSmartyPantsTiming']", function () {
                $("#smarty-pants-on-render").prop("checked") ? y(!0) : y(!1)
            }).on("change", "#remap-punctuation", function () {
                C($(this).prop("checked"))
            }).on("change", "#double-quote-style, #single-quote-style", function () {
                !function () {
                    var e = ($("#double-quote-style").val() + $("#single-quote-style").val()).split("");
                    4 == e.length && (h.app.setting.put("userQuotesArray", e), c.execForAll('function() {        var app = reqnode("electron").remote.app;        File.option.userQuotesArray = app.setting.get("userQuotesArray");    }'))
                }()
            })
        };

        function N() {
            return m && $("#custom-image-folder").blur(), $(".ty-image-folder-group").hasClass("ty-error") ? (setTimeout(function () {
                $("#custom-image-folder").select()
            }, 10), !1) : (m = !1, !0)
        }

        p.prototype.prepPreferencePanel = function () {
            h.getCurrentWindow();
            var e = h.app;
            if (d.validatePandocInstall(!0) && $(".hide-when-pandoc-installed").hide(), document.body.classList.contains("native-window") && $("#preference-content").appendTo("#preference-dialog .modal-body"), $("input[name='windowStyleType'][value='framelessWindow']").prop("checked", e.setting.get("framelessWindow")), $("input[name='windowStyleType'][value='nativeWindow']").prop("checked", !e.setting.get("framelessWindow")), $("#show-status-bar-btn").prop("checked", !1 !== e.setting.get("showStatusBar")), $("#custom-font-size-input").val(e.setting.get("customFontSize") || 14), e.setting.get("useCustomFontSize") ? $("#use-custom-font-size-btn").prop("checked", !0) : $("#use-auto-font-size-btn").prop("checked", !0), $("#collapsible-outline-btn").prop("checked", e.setting.get("can_collapse_outline_panel")), File.option.autoToggleEmojiAutoComplete ? $("#trigger-emoji-autocomplete-on").prop("checked", !0) : $("#trigger-emoji-autocomplete-off").prop("checked", !0), $("input[name='copy_markdown_by_default']").prop("checked", File.option.copyMarkdownByDefault), ["enable_subscript", "enable_superscript", "show_line_numbers_for_fence", "auto_numbering_for_math", "enable_highlight", "use_relative_path_for_img", "apply_image_move_for_web", "strict_mode"].map(function (t) {
                $("input[name='" + t + "']").prop("checked", e.setting.get(t))
            }), $("#preLinebreakOnExport").val((File.option.preLinebreakOnExport || !1) + ""), $("#ignoreLineBreak").val((File.option.ignoreLineBreak || !1) + ""), $("#apply_image_move_for_local").prop("checked", !e.setting.get("no_image_move_for_local")), $("input[name='no_line_wrapping']").prop("checked", !e.setting.get("no_line_wrapping")), $("input[name='enable_diagram']").prop("checked", File.option.enableDiagram), $("input[name='enable_inline_math']").prop("checked", File.option.enableInlineMath), $("#preference-auto-save").prop("checked", File.option.enableAutoSave), $("#preference-auto-save-on-switch").prop("checked", File.option.enableAutoSave || File.option.saveFileOnSwitch), $("#preference-auto-save-on-switch").prop("disabled", File.option.enableAutoSave), $("#spellcheck-option").val(e.setting.get("preset_spell_check") || "auto"), $("input[name='auto_correct_misspell']").prop("checked", !1), $("input[name='scroll_with_cursor']").prop("checked", !e.setting.get("no_mid_caret")), $("#preference_auto_pair").prop("checked", !e.setting.get("no_pairing_match")), e.setting.get("no_pairing_match") ? ($("#preference_auto_pair_markdown").prop("checked", !1), $("#preference_auto_pair_markdown").prop("disabled", !0)) : ($("#preference_auto_pair_markdown").prop("checked", e.setting.get("match_pari_markdown")), $("#preference_auto_pair_markdown").prop("disabled", !1)), $("#preference_expand_block").prop("checked", e.setting.get("auto_expand_block")), $("#preference-indent-size-btn").val((e.setting.get("indentSize") || 2) + ""), $("#preference-pretty-indent-btn").prop("checked", e.setting.get("prettyIndent") || !1), $("#preference-code-indent-size-btn").val((e.setting.get("codeIndentSize") || 4) + ""), File.isWin) try {
                var t = reqnode("winsparkle-node");
                $("#preference-enable-auto-update").prop("checked", t.getAutomaticCheckForUpdates())
            } catch (e) {
                console.sendError(e)
            } else $("#preference-enable-auto-update").parent().hide();
            $("#preference-trigger-debug-btn").prop("checked", e.setting.get("debug", !1)), $("#preference-send-anony-info-btn").prop("checked", e.setting.get("send_usage_info", !0)), $("#preference-heading-style").val(File.option.headingStyle), $("#preference-ul-style").val(File.option.ulStyle), $("#preference-ol-style").val(File.option.olStyle), $("#trigger-line-ending-crlf").prop("checked", File.option.preferCRLF), $("#trigger-line-ending-lf").prop("checked", !File.option.preferCRLF), $("#preference-lanuage").val(e.setting.get("userLanguage") || "auto");
            var n = e.setting.get("restoreWhenLaunch") || 0;
            $("#restoreWhenLaunch").val(n + ""), T(e.setting.get("pinFolder")), 3 == n ? $("#select-pin-input-group").show() : $("#select-pin-input-group").hide(), $("#smart-quote").prop("checked", File.option.smartDash), $("#smart-dash").prop("checked", File.option.smartDash), $("#smarty-pants-on-render").prop("checked", File.option.convertSmartOnRender), $("#smarty-pants-on-input").prop("checked", !File.option.convertSmartOnRender), $("#double-quote-style").val(u.userQuote(0) + u.userQuote(1)), $("#single-quote-style").val(u.userQuote(2) + u.userQuote(3)), File.option.smartDash || $("#single-quote-style, #double-quote-style").prop("disabled", !0), g(void 0, !0), M(), _()
        }, n.exports = p
    }), $__System.registerDynamic("a", ["47", "25", "44", "12", "3e", "28", "31", "52", "46", "53", "54"], !0, function (e, t, n) {
        "use strict";
        this || self;
        var i = e("47"), r = (e("25"), e("44")), o = (e("12"), e("3e")), a = (e("28"), e("31")), s = e("52"),
            l = (e("46"), e("53")), c = e("54"), d = window.reqnode ? reqnode("electron").remote : null;

        function u() {
            var e = d.getCurrentWindow(), t = d.app;
            $("#w-min").on("click", function () {
                d.getCurrentWindow().minimize()
            }), $("#w-close").on("click", function () {
                d.getCurrentWindow().close()
            }), $("#w-restore").on("click", function () {
                d.getCurrentWindow().unmaximize(), d.getCurrentWindow().setFullScreen(!1)
            });
            var n = null;
            $("#w-max-group").on("mouseenter", ".btn", function () {
                this.classList.add("hover")
            }).on("mouseleave", ".btn", function () {
                this.classList.remove("hover")
            }), $("#w-max").on("mouseup", function (e) {
                1 === e.which && ($("#w-traffic-lights").addClass("on-win-fullsize"), n && clearTimeout(n), $("#w-max-group").removeClass("w-show-more"), d.getCurrentWindow().maximize())
            }).on("mousedown", function () {
                n = setTimeout(function () {
                    $("#w-max-group").addClass("w-show-more")
                }, 300)
            }), $("#w-full").on("mouseup", function (e) {
                1 === e.which && ($("#w-traffic-lights").addClass("on-win-fullsize"), n && clearTimeout(n), $("#w-max-group").removeClass("w-show-more"), d.getCurrentWindow().setFullScreen(!0))
            }), $("#w-pin").on("mouseup", function (e) {
                1 === e.which && s.pinWindow()
            }), $("#w-unpin").on("click", function () {
                s.unpinWindow()
            }), $("#top-titlebar").on("mouseleave", function () {
                n && clearTimeout(n), $("#w-max-group").removeClass("w-show-more")
            }), $("#ty-top-placeholder").on("mouseenter", function () {
                t.setting.config.autoHideMenuBar || e.setMenuBarVisibility(!0)
            }), e.on("maximize", function () {
                $("#w-traffic-lights").addClass("on-win-fullsize")
            }), e.isMaximized() && $("#w-traffic-lights").addClass("on-win-fullsize"), e.on("enter-full-screen", function () {
                e.setAutoHideMenuBar(!0), e.setMenuBarVisibility(!1), $("#w-traffic-lights").addClass("on-win-fullsize"), document.body.classList.add("typora-fullscreen"), document.body.classList.contains("native-window") && $("#ty-top-placeholder").show()
            }), e.on("unmaximize", function () {
                $("#w-traffic-lights").removeClass("on-win-fullsize")
            }), e.on("leave-full-screen", function () {
                e.setAutoHideMenuBar(t.setting.config.autoHideMenuBar || !1), e.setMenuBarVisibility(!t.setting.config.autoHideMenuBar), $("#w-traffic-lights").removeClass("on-win-fullsize"), document.body.classList.remove("typora-fullscreen"), $("#ty-top-placeholder").hide()
            }), window.onbeforeunload = function (t) {
                return r.backupVersionWorker(), r.backupWindow(), e.focus(), a.tryLeaveDocument(function (t) {
                    t || (!function () {
                        var t = r.mountFolder_;
                        r.backupDocumentSnap(), r.editor.library.end(), o.watchFileChange(null), l.slientQuit(), d.app.onCloseWin(e.id, t)
                    }(), releasePrintWin_(), releaseCaptureWin_(), r.fileHasModified = !1, r.updateChangeCount(r.ChangeType.NSChangeAutosaved), e.destroy())
                }), !1
            }
        }

        r.resetZoom = function () {
            reqnode("electron").webFrame.setZoomFactor(1), d.app.setting.put("zoomFactor", 1), d.app.setting.put("zoomLevel", 1)
        };

        function h() {
            var e = d.app;
            !0 === e.setting.get("framelessWindow") ? (document.body.classList.remove("native-window"), document.body.classList.add("unibody-window")) : (document.body.classList.add("native-window"), document.body.classList.remove("unibody-window")), !1 !== e.setting.get("showStatusBar") && document.body.classList.add("show-footer"), -1 != window.navigator.userAgent.indexOf("Windows NT") ? (document.body.classList.add("os-windows"), -1 != window.navigator.userAgent.indexOf("Windows NT 6.1") ? document.body.classList.add("os-windows-7") : -1 != window.navigator.userAgent.indexOf("Windows NT 6.2") ? document.body.classList.add("os-windows-8") : -1 != window.navigator.userAgent.indexOf("Windows NT 6.3") ? (document.body.classList.add("os-windows-8"), document.body.classList.add("os-windows-8.1")) : -1 != window.navigator.userAgent.indexOf("Windows NT 10") && document.body.classList.add("os-windows-10")) : process && "linux" == process.platform ? document.body.classList.add("os-linux") : process && "darwin" == process.platform && document.body.classList.add("os-mac"), -1 == window.navigator.userAgent.indexOf("Windows NT 6.2") && -1 == window.navigator.userAgent.indexOf("Windows NT 6.3") || document.body.classList.add("paint-border")
        }

        function f() {
            $("footer").on("click", "#outline-btn", function () {
                r.editor.library.toggleSidebar(), r.isNode && s.refreshViewMenu()
            }).on("click", "#toggle-sourceview-btn", function () {
                r.toggleSourceMode()
            }).on("click", "#toggle-focus-mode-btn", function () {
                r.editor.toggleFocusMode()
            }).on("click", "#toggle-typewriter-mode-btn", function () {
                r.editor.toggleTypeWriterMode()
            }).on("click", function (e) {
                e.target == this && r.editor && r.editor.cleanTooltip()
            }), $("#footer-word-count").on("click", function () {
                if (document.body.classList.contains("ty-show-word-count")) document.body.classList.remove("ty-show-word-count"), document.body.classList.remove("ty-show-word-count-in-selection"); else {
                    document.body.classList.remove("ty-show-spell-check"), document.body.classList.add("ty-show-word-count"), r.sync(), r.editor.brush.updateWordCount();
                    var e = r.editor.getMarkdown(), t = Math.round(($("#footer-word-count-td").text() - 0) / 270);
                    $("#footer-read-time-count-td").text(t || "≤ 1"), $("#footer-line-count-td").text((e.match(/\n/g) || []).length + 1), $("#footer-char-count-td").text(e.length);
                    var n = r.editor.selection.getTextInSelection();
                    n.length ? ($("#footer-char-count-td-sel").text(n.length), $("#footer-word-count-td-sel").text(r.editor.selection.getWordCountInSelection(n)), document.body.classList.add("ty-show-word-count-in-selection")) : document.body.classList.remove("ty-show-word-count-in-selection")
                }
            }), $("#footer-word-count").on("before-show-ty-hint", function (e) {
                document.body.classList.contains("ty-show-word-count") && (e.cancel = !0)
            })
        }

        $(document).ready(function () {
            reqnode ? h() : (document.body.classList.remove("native-window"), document.body.classList.add("show-footer")), i.init(), r.isNodeHtml && (r.contextMenu = r.editor.contextMenu, r.megaMenu = new c(r.editor.sessionStr)), reqnode && (u(), function () {
                if (r.isWin) {
                    var e = d.app, t = [{type: "recent"}, {
                        type: "tasks",
                        items: [{
                            type: "task",
                            program: process.execPath,
                            arguments: "",
                            iconPath: process.execPath,
                            iconIndex: 0,
                            title: "New Document",
                            description: "Create a new window"
                        }]
                    }];
                    e.setAppUserModelId("abnerworks.Typora"), e.setJumpList(t)
                }
            }(), function () {
                var e = reqnode("electron").ipcRenderer;

                function t(e) {
                    var t = d.getCurrentWindow(), n = d.app;
                    e = reqnode("path").normalize(e), n.getDocumentController().getDocumentFromWindowId(t.id).rename(e), e ? o.setFileTitle(e) : (r.filePath = void 0, r.updateChangeCount(r.ChangeType.NSChangeReadOtherContents), o.watchFileChange(null)), r.editor.library.markCurrentFile()
                }

                window.doApplyRename = t;
                var n = r.isWin ? "\\" : "/";

                function i(e) {
                    return r.filePath && (r.filePath == e || 0 == r.filePath.indexOf(e + n))
                }

                e.on("willRename", function (e, t) {
                    i(t.oldPath) && o.watchFileChange(null)
                }), e.on("didRename", function (e, n) {
                    i(n.oldPath) && (t(n.newPath + r.filePath.substr(n.oldPath.length)), n.oldPath == r.getMountFolder() && r.editor.library.onRootChanged(n.newPath))
                }), e.on("willSave", function (e, t) {
                    try {
                        r.editor.library.pauseOnChange()
                    } catch (e) {
                    }
                }), e.on("didSave", function (e, t) {
                    try {
                        var n = t.path, i = r.editor.library.fileList.findElemFromPath(n);
                        n == r.filePath && (r.lastModifiedDate = t.lastModifiedDate), i.length && r.editor.library.fileList.appendItemToView({
                            path: n,
                            folderPath: i.attr("data-parent-path"),
                            folderName: i.children(".file-list-item-parent-loc").text(),
                            lastModified: new Date,
                            name: i.find(".file-list-item-file-name").text(),
                            summary: t.summary,
                            oldPath: n
                        }, !0)
                    } catch (e) {
                        console.warn(e)
                    }
                    try {
                        r.editor.library.pauseOnChange(!0)
                    } catch (e) {
                    }
                }), e.on("saveFromUntitled", function (e, n) {
                    r.filePath != n && t()
                })
            }()), $("html, body, #top-titlebar").click(function () {
                $("#main-menu").removeClass("open")
            }), o.prepareInfoPanel(), f()
        })
    })
})(function (e) {
    "function" == typeof define && define.amd ? define([], e) : "object" == typeof module && module.exports && "function" == typeof require ? module.exports = e() : e()
});
//# sourceMappingURL=http://typora/app/window/frame.js.map